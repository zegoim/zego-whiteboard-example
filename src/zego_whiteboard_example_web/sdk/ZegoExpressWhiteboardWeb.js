/*! For license information please see ZegoExpressWhiteboardWeb.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var o in r)("object"==typeof exports?exports:e)[o]=r[o]}}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=370)}([function(e,t,r){"use strict";r.d(t,"d",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return n})),r.d(t,"e",(function(){return s})),r.d(t,"f",(function(){return a})),r.d(t,"g",(function(){return l})),r.d(t,"h",(function(){return u})),r.d(t,"c",(function(){return h})),r.d(t,"k",(function(){return p})),r.d(t,"l",(function(){return f}));var o,i,n,s,a,c,d,l,u,h,p,f,g=r(27);r.d(t,"i",(function(){return g.a})),r.d(t,"j",(function(){return g.b})),r.d(t,"m",(function(){return g.c})),r.d(t,"n",(function(){return g.d})),r.d(t,"o",(function(){return g.e})),function(e){e[e.PPT=1]="PPT",e[e.DOC=2]="DOC",e[e.ELS=4]="ELS",e[e.PDF=8]="PDF",e[e.IMG=16]="IMG",e[e.TXT=32]="TXT",e[e.PPTH5=512]="PPTH5",e[e.CUSTOM_H5=4096]="CUSTOM_H5"}(o||(o={})),function(e){e[e.Single=1]="Single",e[e.Multi=2]="Multi",e[e.Other=4]="Other"}(i||(i={})),function(e){e[e.Append=1]="Append",e[e.Update=2]="Update",e[e.Delete=4]="Delete",e[e.Move=8]="Move",e[e.Create=32]="Create"}(n||(n={})),function(e){e[e.Local=0]="Local",e[e.Remote=1]="Remote",e[e.UnReDo=2]="UnReDo",e[e.Reload=3]="Reload"}(s||(s={})),function(e){e[e.Pencil=1]="Pencil",e[e.Text=2]="Text",e[e.Line=4]="Line",e[e.Rect=8]="Rect",e[e.Ellipse=16]="Ellipse",e[e.Laser=128]="Laser",e[e.Image=256]="Image",e[e.BgImage=512]="BgImage",e[e.RealTime=999]="RealTime"}(a||(a={})),function(e){e[e.Pc=1]="Pc",e[e.Mobile=2]="Mobile"}(c||(c={})),function(e){e[e.Init=1]="Init",e[e.Down=2]="Down",e[e.Move=3]="Move",e[e.DownMove=4]="DownMove",e[e.DownMoveUp=5]="DownMoveUp",e[e.DownNoMoveUp=6]="DownNoMoveUp",e[e.Leave=7]="Leave",e[e.DownLeave=8]="DownLeave"}(d||(d={})),function(e){e[e.success=1]="success",e[e.error=2]="error"}(l||(l={})),function(e){e[e.InProgress=1]="InProgress",e[e.Pending=2]="Pending"}(u||(u={})),function(e){e[e.BatchSelete=0]="BatchSelete",e[e.ClearPage=1]="ClearPage",e[e.EraserTool=2]="EraserTool"}(h||(h={})),function(e){e[e.None=0]="None",e[e.Scale=1]="Scale",e[e.Scroll=2]="Scroll"}(p||(p={})),function(e){e[e.None=0]="None",e[e.Append=1]="Append",e[e.Update=2]="Update",e[e.Delete=4]="Delete",e[e.Move=8]="Move",e[e.Clear=16]="Clear",e[e.Create=32]="Create"}(f||(f={}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return p}));r(40),r(32),r(280),r(38),r(44),r(283),r(285),r(286),r(287),r(288),r(289),r(291),r(292),r(293),r(294),r(295),r(296),r(297),r(57),r(75),r(63),r(41),r(70),r(170),r(51),r(52);var o=r(208),i=(r(99),r(94),r(84),function(){return(i=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}),n=function(){function e(e,t){this.appid="",this.roomid="",this.userid="",this.token="",this.version="",this.platform="",this.extra={},this.isProd=!1,this.isElectron=!1,this.logLevel=1,this.logCacheSend=[],this.logCacheMax=100,this.platform=e||"",this.isElectron=t,this.openLogServer()}return e.prototype.init=function(e){var t=e.appid,r=e.version,o=e.isProd,i=e.liveroom;this.appid=(t||this.appid)+"",this.version=r||this.version,this.isProd=o,i&&!this.platform.includes("liveroom")&&(this.platform+=",liveroom")},e.prototype.initRoom=function(e){var t=e.roomid,r=e.userid,o=e.token,i=e.logLevel;this.roomid=t||this.roomid,this.userid=r||this.userid,this.token=o||this.token,"number"==typeof i&&(this.logLevel=i)},e.prototype.setLogConfig=function(e){"number"==typeof e&&(this.logLevel=e)},e.prototype.setExtraConfig=function(e){Object.assign(this.extra,e)},e.prototype.getConfig=function(){return{appid:+this.appid,roomid:this.roomid,userid:this.userid,token:this.token}},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.log(0,e);if(this.logLevel>0);else{var o=console.debug;o(r)}},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.log(1,e);if(this.logLevel>1);else{var o=console.info;o(r)}},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.log(2,e);if(this.logLevel>2);else{var o=console.warn;o(r)}},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.log(3,e);if(this.logLevel>3);else{var o=console.error;o(r)}},e.prototype.writeLocalLog=function(e){},e.prototype.log=function(e,t){var r=this.isProd||this.isElectron?this.logParamList(e,t.join("")):t.join("");return this.isProd&&this.remoteWebSocketLog(e,r),this.isElectron&&this.writeLocalLog(r),r},e.prototype.openLogServer=function(){this.stopWebSocketServer(),this.websocket=new WebSocket("wss://weblogger-edu.zego.im/log")},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.close(),this.websocket=null)},e.prototype.remoteWebSocketLog=function(e,t){if(!("string"==typeof t&&t.length>4e3))if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState)this.openLogServer(),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var r="",o=0;o<this.logCacheSend.length;o++)(r+this.logCacheSend[o]).length>4e3&&(this.websocket.send(r),r=""),r=r+this.logCacheSend[o]+"\n";t=r+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.logParamList=function(e,t){var r=(new Date).toLocaleString(),o=t.indexOf(" "),n=t.substr(0,o)||t,s=t.substr(o+1,4500),a=i(i({time:r,level:e,action:n,content:s,appid:this.appid,userid:this.userid,roomid:this.roomid},this.extra),{version:this.version,platform:this.platform});return JSON.stringify(a)},e}(),s=function(e,t,r){var o=!(!e||!e.versions.electron);return{electron:o,platform:(o?e.platform:t)+","+r[r.length-2]+","+r[r.length-1]}}(window.process,navigator.platform,navigator.userAgent.split(" ")),a=s.electron,c=s.platform;var d,l=window.zegoLogger||(window.zegoLogger=new n(c,a)),u=function(){return(u=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};!function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(d||(d={}));var h=function(){function e(t,r){if(this.appID="",this.roomID="",this.userID="",this.token="",this.isTestEnv=!0,this.logLevel=1,this.version="",this.platform="",this.extra={},e.instance)return e.instance;e.env=t,e.product=r,this.logger=new o.ZegoLogger(t,r),this.logger.setDebugVerbose(!1),e.instance=this}return e.getInstance=function(){return window.zegoAddonLogger||(window.zegoAddonLogger=new e(e.env,e.product))},e.prototype.setLogConfig=function(e){switch(this.logger.setLogLevel(e.logLevel),this.logger.setRemoteLogLevel(e.remoteLogLevel),e.logLevel){case"debug":this.logLevel=0;break;case"info":this.logLevel=1;break;case"warn":this.logLevel=2;break;case"error":this.logLevel=3;break;case"report":this.logLevel=99;break;case"disable":this.logLevel=100}l.setLogConfig(this.logLevel)},e.prototype.initLogger=function(t,r){var o=navigator.userAgent,i=t.appID,n=t.userID,s=t.token;this.header={version:r,appID:i,userID:n,device:o},this.logger.setCommonField(new Map([["userID",n]])),this.logger.setHeaderInfo(this.formatContent(JSON.stringify(this.header))),s&&(e.uploadConfig={appID:i,userID:n,token:s,product:e.product,uploadURL:"https://detaillog"+t.appID+"-api.zego.im/zglog/zip",deviceID:this.generateUUID()})},e.prototype.updateLoggerHeader=function(e){Object.assign(this.header.version,e),this.logger.setHeaderInfo(this.formatContent(JSON.stringify(this.header)))},e.startTimingUpload=function(){e.uploadTimer||(e.uploadTimer=setInterval((function(){e.instance.upload(e.uploadConfig,e.product)}),e.uploadInterval))},e.stopTimingUpload=function(){e.uploadTimer&&(clearInterval(e.uploadTimer),e.uploadTimer=null)},e.prototype.generateUUID=function(){var e=localStorage.getItem("z_deviceID");if(e)return e;var t=(new Date).getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(36)}));return localStorage.setItem("z_deviceID",r),r},e.prototype.getConfig=function(){return{appID:+this.appID,roomID:this.roomID,userID:this.userID,token:this.token}},e.prototype.initInfo=function(e){var t=e.appID,r=e.version,o=(e.isProd,e.liveroom);this.appID=(t||this.appID)+"",this.version=r||this.version,o&&!this.platform.includes("liveroom")&&(this.platform+=",liveroom"),l.init({appid:t,version:r,isProd:!0,liveroom:o})},e.prototype.initRoomInfo=function(t){var r=t.roomID,o=t.userID,i=t.token,n=t.logLevel;this.roomID=r||this.roomID,this.userID=o||this.userID,this.token=i||this.token,"SuperBoard"!==e.product&&"number"==typeof n&&(this.logLevel=n),"SuperBoard"!==e.product&&l.initRoom({roomid:this.roomID,userid:this.userID,token:this.token,logLevel:n})},e.prototype.upload=function(e,t){this.logger.upload(u(u({},e),{appID:e.appID+"",product:t}))},e.prototype.report=function(e,t,r){this.logger.write(e,"report",t,this.formatContent(r))},e.prototype.debug=function(e,t,r){this.logger.write(e,"debug",t,this.formatContent(r)),l.debug(t,r)},e.prototype.info=function(e,t,r){this.logger.write(e,"info",t,this.formatContent(r)),l.info(e+"_"+t+":",r)},e.prototype.warn=function(e,t,r){this.logger.write(e,"warn",t,this.formatContent(r)),l.warn(e+t,r)},e.prototype.error=function(e,t,r){this.logger.write(e,"error",t,this.formatContent(r)),l.error(t,r)},e.prototype.formatContent=function(e){return e?String(e).replace(/\"/g,"'"):""},e.uploadInterval=3e5,e}(),p=function(e,t,r){if(window.zegoAddonLogger){var o=localStorage.getItem("ZEGO_SDK_VER");if(o){var i=Object.assign(JSON.parse(o),r);h.getInstance().updateLoggerHeader(i)}}else window.zegoAddonLogger=new h(0,t),h.getInstance().initLogger(e,r),h.getInstance().initInfo(e),localStorage.setItem("ZEGO_SDK_VER",JSON.stringify(r)),l.init({appid:e.appID,version:r,isProd:!0})}},,function(e,t,r){"use strict";var o=r(0),i="ontouchstart"in window||navigator.maxTouchPoints>0;t.a={reservedPrefix:{whiteboardZoom:"zego-whiteboard-zoom",fileWhiteboardCon:"zego-docsview-con",whiteboardCon:"zego-whiteboard-con",whiteboard:"zego-whiteboard",laserContainer:"zego-other-container",graphicsBgContainer:"zego-graphics-bg-container",graphicsBgImageContainer:"zego-graphics-bgImage-container",graphicsContainer:"zego-graphics-container",graphicsSvg:"zego-svg",textareaCon:"zego-textarea",laserCon:"zego-laser",graphics:"zego-graphics",boxContainer:"zego-box-container",graphicsBox:"zego-graphics-box"},basicState:{type:o.j.ZegoWhiteboardViewToolPen,size:6,fontSize:24,color:"#f54326",bgColor:"rgb(241, 243, 244)",attributes:'{"bold": false, "italic": false, "stroke": false}'},basicExtraState:{drawSize:0,drawFontSize:0,customImage:{url:"",w:80,h:80},defaultFileBgColor:"rgb(255, 255, 255, 0)"},realTimeState:{localDrawCount:10,remoteDrawDelay:4,remoteDrawCount:2,remoteDrawEndDelay:1e4},scaleModes:{sync:!1,response:!1},handWritingFactor:{step:.016,max_speed:1.2,min_speed:.05,max_width_factor:1.2,min_width_factor:.5,last_size:0,lastX:0,lastY:0},svgPath:{tops:[],bottoms:[]},isTouch:i,boxPadding:0,textareaBoxPadding:24,textareaHPadding:0,textareaVPadding:0,textareaConBorderWidth:1,lineHeight:1,boxBorderWidth:2,selectedBorderCss:"2px solid #b0b3b8",unSelectedBorderCss:"2px solid transparent",maxlength:200,scrollbarSize:20,initLaserX:0,initLaserY:0,hiddenLaserX:-100,hiddenLaserY:-100,hiddenLaserDelay:5e3,mouseEvents:{down:"mousedown",move:"mousemove",up:"mouseup",leave:"mouseleave",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend",mouseleave:"touchcancel"},calStandard:{sizeWidth:1280,placeWidth:128e4,minFontSize:i?1:12,maxFontSize:100,minLineWidth:1,maxLineWidth:100}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return s}));var o,i,n,s;r(117),r(94),r(48),r(49);!function(e){e.Upload="onUpload",e.LoadFile="onLoadFile",e.StepChange="onStepChange",e.Scroll="onScroll",e.PlayAnimation="onPlayAnimation"}(o||(o={})),function(e){e.Error="error",e.ViewAdd="viewAdd",e.ViewRemoved="viewRemoved",e.ViewScroll="viewScroll",e.ViewScale="viewScale",e.WhiteboardAuthChange="whiteboardAuthChange",e.WhiteboardGraphicAuthChange="whiteboardGraphicAuthChange"}(i||(i={})),function(e){e.PushAddMod="pushAddMod",e.PushRemovedMod="pushRemovedMod",e.PushDrawPageGraphics="pushDrawPageGraphics",e.PushClearPageGraphics="pushClearPageGraphics",e.PushScroll="pushScroll",e.PushScale="pushScale",e.PushH5ExtraAppended="pushH5ExtraAppended",e.PushAuthChange="pushAuthChange",e.GetPageGraphicsList="getPageGraphicsList",e.AppendH5Extra="appendH5Extra",e.Scroll="scroll",e.Scale="scale",e.RoomConnected="roomConnected",e.RoomDisConnected="roomDisConnected",e.AttachedView="attachedView",e.SuperRoomConnected="SuperRoomConnected",e.SuperRoomDisConnected="SuperRoomDisConnected"}(n||(n={})),function(e){e.SubViewScrollChanged="superBoardSubViewScrollChanged",e.SubViewScaleChanged="superBoardSubViewScaleChanged",e.RemoteSubViewAdd="remoteSuperBoardSubViewAdded",e.RemoteSubViewRemoved="remoteSuperBoardSubViewRemoved",e.RemoteSubViewSwitched="remoteSuperBoardSubViewSwitched",e.RemoteSubViewExcelSwitched="remoteSuperBoardSubViewExcelSwitched",e.RemoteAuthChange="remoteSuperBoardAuthChanged",e.RemoteGraphicAuthChange="remoteSuperBoardGraphicAuthChanged",e.SyncSwitchMod="syncSwitchMod",e.RemoteSwitchMod="remoteSwitchMod",e.RemoteModAdd="remoteModAdd",e.RemoteModRemoved="remoteModRemoved",e.SyncSwitchModWithWhiteboardID="SyncSwitchModWithWhiteboardID"}(s||(s={}));var a=function(){function e(){var e;this.listeners=((e={})[i.Error]=[],e[o.LoadFile]=[],e[o.Upload]=[],e[o.Scroll]=[],e[o.StepChange]=[],e[o.PlayAnimation]=[],e[n.PushAddMod]=[],e[n.PushRemovedMod]=[],e[n.PushDrawPageGraphics]=[],e[n.PushClearPageGraphics]=[],e[n.PushScroll]=[],e[n.PushScale]=[],e[n.PushH5ExtraAppended]=[],e[n.PushAuthChange]=[],e[n.GetPageGraphicsList]=[],e[n.AppendH5Extra]=[],e[n.Scroll]=[],e[n.Scale]=[],e[n.RoomConnected]=[],e[n.RoomDisConnected]=[],e[n.AttachedView]=[],e[n.SuperRoomConnected]=[],e[n.SuperRoomDisConnected]=[],e[i.ViewAdd]=[],e[i.ViewRemoved]=[],e[i.ViewScroll]=[],e[i.ViewScale]=[],e[i.WhiteboardAuthChange]=[],e[i.WhiteboardGraphicAuthChange]=[],e[s.RemoteSubViewAdd]=[],e[s.RemoteSubViewRemoved]=[],e[s.RemoteSubViewSwitched]=[],e[s.RemoteSubViewExcelSwitched]=[],e[s.RemoteAuthChange]=[],e[s.RemoteGraphicAuthChange]=[],e[s.SyncSwitchMod]=[],e[s.SyncSwitchModWithWhiteboardID]=[],e[s.RemoteSwitchMod]=[],e[s.RemoteModAdd]=[],e[s.RemoteModRemoved]=[],e[s.SubViewScrollChanged]=[],e[s.SubViewScaleChanged]=[],e)}return e.prototype.on=function(e,t){return!!this.listeners[e]&&("function"==typeof t&&(this.listeners[e][0]=t,!0))},e.prototype.off=function(e,t){if(!this.listeners[e])return!1;var r=this.listeners[e];return t?r.splice(r.indexOf(t),1):this.listeners[e]=[],!0},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.listeners[e]&&this.listeners[e].forEach((function(e){e.apply(void 0,t)}))},e}();t.e=new a},function(e,t,r){var o=r(7),i=r(64).f,n=r(28),s=r(25),a=r(109),c=r(160),d=r(100);e.exports=function(e,t){var r,l,u,h,p,f=e.target,g=e.global,m=e.stat;if(r=g?o:m?o[f]||a(f,{}):(o[f]||{}).prototype)for(l in t){if(h=t[l],u=e.noTargetGet?(p=i(r,l))&&p.value:r[l],!d(g?l:f+(m?".":"#")+l,e.forced)&&void 0!==u){if(typeof h==typeof u)continue;c(h,u)}(e.sham||u&&u.sham)&&n(h,"sham",!0),s(r,l,h,e)}}},function(e,t,r){"use strict";r.d(t,"k",(function(){return D})),r.d(t,"d",(function(){return v})),r.d(t,"n",(function(){return y})),r.d(t,"g",(function(){return S})),r.d(t,"c",(function(){return T})),r.d(t,"l",(function(){return R})),r.d(t,"o",(function(){return I})),r.d(t,"e",(function(){return O})),r.d(t,"p",(function(){return L})),r.d(t,"q",(function(){return w})),r.d(t,"a",(function(){return M})),r.d(t,"b",(function(){return A})),r.d(t,"h",(function(){return N})),r.d(t,"i",(function(){return k})),r.d(t,"t",(function(){return P})),r.d(t,"s",(function(){return x})),r.d(t,"r",(function(){return U})),r.d(t,"f",(function(){return E})),r.d(t,"m",(function(){return C})),r.d(t,"j",(function(){return B}));r(95),r(94),r(99),r(174),r(48),r(49),r(41),r(84),r(105),r(343),r(70),r(345),r(63),r(38),r(170),r(347);var o,i=new Uint8Array(16);function n(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(i)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var a=function(e){return"string"==typeof e&&s.test(e)},c=[],d=0;d<256;++d)c.push((d+256).toString(16).substr(1));var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(r))throw TypeError("Stringified UUID is invalid");return r};var u=function(e,t,r){var o=(e=e||{}).random||(e.rng||n)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=o[i];return t}return l(o)},h=r(331),p=r.n(h),f=r(312),g=r.n(f),m=r(3),_=r(0),v=function(){return""+g()(u())},E=function(){var e=Math.sqrt(Math.sqrt(+g()(u())))*Math.random()|0;return e>99?.3*e|0:e<3?e+10*Math.random()|0:e},y=function(e){if(e){var t=e.parentNode;t?t.removeChild(e):e.remove?e.remove():e.removeNode()}},S=function(e){return e.children||e.childNodes},T=function(e,t,r,o){var i,n=m.a.calStandard,s=n.sizeWidth,a=n.minFontSize,c=n.minLineWidth;return o?i=Math.round(e*s/r):(i=Math.round(r*e/s),_.f.Text===t?i<a&&(i=a):i<c&&(i=c)),i},b=function(e){var t=e[0],r=e[1],o=e[2],i=e[3];return[Math.min(t,o||t),Math.min(r,i||r)]},R=function(e,t){var r;switch(e){case _.f.Pencil:r=function(e){for(var t=e.length,r=.1,o=t-4,i="M"+e[0]+", "+e[1],n=0;n<t-2;n+=2){var s=n?e[n-2]:e[0],a=n?e[n-1]:e[1],c=e[n+0],d=e[n+1],l=e[n+2],u=e[n+3],h=n!==o?e[n+4]:l,p=n!==o?e[n+5]:u;i+=" C"+(Number(c)+(l-s)/6*r)+","+(Number(d)+(u-a)/6*r)+","+(Number(l)-(h-c)/6*r)+","+(Number(u)-(p-d)/6*r)+","+l+","+u}return i}(t);break;case _.f.Line:r={x1:t[0],y1:t[1],x2:t[2]||t[0],y2:t[3]||t[1]};break;case _.f.Rect:var o=Math.abs((t[2]||t[0])-t[0])||1,i=Math.abs((t[3]||t[1])-t[1])||1,n=b(t);r={x:n[0],y:n[1],width:o,height:i};break;case _.f.Ellipse:var s=Math.abs((t[2]||t[0])-t[0])/2||.5,a=Math.abs((t[3]||t[1])-t[1])/2||.5,c=b(t);r={cx:c[0]+s,cy:c[1]+a,rx:s,ry:a};break;default:r=""}return r},C=function(e,t,r){var o=1,i=m.a.handWritingFactor,n=i.step,s=i.max_width_factor,a=i.min_width_factor,c=i.max_speed,d=i.min_speed,l=m.a.handWritingFactor,u=l.lastX,h=l.lastY,p=e.data,f=p.length,g=!0;m.a.svgPath.tops=[],m.a.svgPath.bottoms=[];for(var _={tx1:0,ty1:0,tx2:0,ty2:0,bx1:0,by1:0,bx2:0,by2:0,mtx1:0,mty1:0,mbx1:0,mby1:0},v=2;v<f;v+=2){2===v&&(u=p[0],h=p[1]);var E=u,y=h,S=p[v]-E,T=p[v+1]-y,b=Math.sqrt(Math.pow(S,2)+Math.pow(T,2));if(!(b<r/1280*3*2.5)){if(o++,v===f-2&&2==o)return;var R=b*n;R>c&&(R=c),R<d&&(R=d);var C=s*t,I=a*t,O=(C-I)*(1-R/c)+I;O>C&&(O=C),O<I&&(O=I);var L,w;if(L=O/2*T/b,w=O/2*S/b,_.tx1=u+L,_.ty1=h-w,_.tx2=p[v]+L,_.ty2=p[v+1]-w,_.bx1=u-L,_.by1=h+w,_.bx2=p[v]-L,_.by2=p[v+1]+w,g&&(_.tx1=u,_.ty1=h,_.bx1=u,_.by1=h),_.mtx1=(_.tx1+_.tx2)/2,_.mty1=(_.ty1+_.ty2)/2,_.mbx1=(_.bx1+_.bx2)/2,_.mby1=(_.by1+_.by2)/2,g)m.a.svgPath.tops.push("M"+u+" "+h+" L"+_.mtx1+" "+_.mty1),m.a.svgPath.bottoms.unshift("Q"+_.bx2+" "+_.by2+" "+_.mbx1+" "+_.mby1+" L"+u+" "+h);else if(m.a.svgPath.tops.join("").indexOf("M")<0&&m.a.svgPath.tops.push("M"+_.mtx1+" "+_.mty1),v===f-2){var M=p[f-2],A=p[f-1];R===d?m.a.svgPath.tops.push("Q"+M+" "+A+" "+M+" "+A):m.a.svgPath.tops.push("Q"+_.tx1+" "+_.ty1+" "+M+" "+A)}else m.a.svgPath.tops.push("Q"+_.tx1+" "+_.ty1+" "+_.mtx1+" "+_.mty1),m.a.svgPath.bottoms.unshift("Q"+_.bx2+" "+_.by2+" "+_.mbx1+" "+_.mby1);u=p[v],h=p[v+1],g=!1}}return m.a.svgPath.tops.concat(m.a.svgPath.bottoms).join(" ")},I=function(e,t){t.forEach((function(t){e.setAttribute(t.attr,t.value)}))},O=function(e,t,r,o){var i,n=document.querySelector("#"+e);if(n)return o&&n.setAttribute("data-z",o+""),[i=n.querySelector("#"+t)];n=document.createElementNS("http://www.w3.org/2000/svg","svg");var s=document.createElementNS("http://www.w3.org/2000/svg","g");return i=document.createElementNS("http://www.w3.org/2000/svg",r),n.id=e,n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("version","1.1"),o&&n.setAttribute("data-z",o+""),i.id=t,s.appendChild(i),n.appendChild(s),[i,n]},L=function(e,t){void 0===t&&(t=1);var r=[],o=[];return e.forEach((function(e,t,r){t%2==0&&o.push({x:e,y:r[t+1]})})),p()(o,t).forEach((function(e){r=r.concat([e.x,e.y])})),r},w=function(e){var t=e.split(",");return{beginX:t[0],beginY:t[1],text:t.slice(2).join(",")}},M=function(e,t,r){return parseInt(t)+","+parseInt(r)+","+e},A=function(e,t){t.forEach((function(t){e.addEventListener(t,(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}))}))},N=function(e){var t=0,r=0;if(e)for(t+=e.offsetTop,r+=e.offsetLeft;e.offsetParent;)t+=e.offsetParent.offsetTop,r+=e.offsetParent.offsetLeft,e=e.offsetParent;return{offsetTop:t,offsetLeft:r}},k=function(e){var t=0,r=0;if(e)for(t+=e.scrollTop,r+=e.scrollLeft;e.parentNode;)t+=e.parentNode.scrollTop||0,r+=e.parentNode.scrollLeft||0,e=e.parentNode;return{scrollTop:t,scrollLeft:r}},P=function(e,t){var r=e.length>1?_.b.Multi:_.b.Single,o=JSON.parse(JSON.stringify(e));return o.forEach((function(e){e.action_type=r,t&&(e.action=t),delete e.selected,delete e.fontSize,delete e.bgColor})),o},x=function(e,t){return t?e?"#"+(e=e.toString(16)).slice(2).padStart(6,"0"):m.a.basicState.color:(e=function(e){if(0===e.indexOf("#"))return e;var t=e.replace(/rgba?/,"").replace(/\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),r=parseFloat(t[3]||"1"),o=Math.floor(r*parseInt(t[0])+255*(1-r)),i=Math.floor(r*parseInt(t[1])+255*(1-r)),n=Math.floor(r*parseInt(t[2])+255*(1-r));return"#"+("0"+o.toString(16)).slice(-2)+("0"+i.toString(16)).slice(-2)+("0"+n.toString(16)).slice(-2)}(e),parseInt("0xFF"+e.split("#")[1]))},D=function(e){return"number"==typeof e&&!isNaN(e)},U=function(e){for(var t=e.length,r=.1,o=t-4,i=[e[0],e[1]],n=[],s=0;s<t-2;s+=2){var a=s?e[s-2]:e[0],c=s?e[s-1]:e[1],d=e[s+0],l=e[s+1],u=e[s+2],h=e[s+3],p=s!==o?e[s+4]:u,f=s!==o?e[s+5]:h,g=Number(d)+(u-a)/6*r,m=Number(l)+(h-c)/6*r,_=Number(u)-(p-d)/6*r,v=Number(h)-(f-l)/6*r;n.push([g,m,_,v,u,h])}return{moveTo:i,path:n}},B=function(e){var t=e.type,r=e.attributes;return(t==_.f.Pencil||t==_.f.RealTime)&&JSON.parse(r||m.a.basicState.attributes).stroke}},function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,r(61))},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){"use strict";r.d(t,"b",(function(){return c})),r.d(t,"a",(function(){return d}));var o,i=r(4),n=r(0),s=((o={})[n.i.ZegoWhiteboardViewErrorInternal]="内部错误",o[n.i.ZegoWhiteboardViewErrorParamInvalid]="参数错误",o[n.i.ZegoWhiteboardViewErrorNetworkTimeout]="网络超时",o[n.i.ZegoWhiteboardViewErrorNetworkDisconnect]="网络断开",o[n.i.ZegoWhiteboardViewErrorInvalidRsp]="网络回包错误",o[n.i.ZegoWhiteboardViewErrorRequestTooMany]="请求过于频繁",o[n.i.ZegoWhiteboardViewErrorNoLoginRoom]="未登录房间",o[n.i.ZegoWhiteboardViewErrorUserNotExist]="用户不存在",o[n.i.ZegoWhiteboardViewErrorViewNotExist]="白板view不存在",o[n.i.ZegoWhiteboardViewErrorViewCreateFail]="创建白板view失败",o[n.i.ZegoWhiteboardViewErrorViewModifyFail]="修改白板view失败",o[n.i.ZegoWhiteboardViewErrorViewNameLimit]="白板view名称或者content过长",o[n.i.ZegoWhiteboardViewErrorViewParentNotExist]="白板view的parent不存在",o[n.i.ZegoWhiteboardViewErrorViewNumLimit]="超过白板最大数量限制",o[n.i.ZegoWhiteboardViewErrorGraphicNotExist]="图元不存在",o[n.i.ZegoWhiteboardViewErrorGraphicCreateFail]="创建图元错误",o[n.i.ZegoWhiteboardViewErrorGraphicModifyFail]="修改图元错误",o[n.i.ZegoWhiteboardViewErrorGraphicUnableDraw]="未开启绘制",o[n.i.ZegoWhiteboardViewErrorGraphicDataLimit]="图元数据大小超过限制",o[n.i.ZegoWhiteboardViewErrorGraphicNumLimit]="超过图元最大数量限制",o[n.i.ZegoWhiteboardViewErrorGraphicTextLimit]="文本字数超过上限",o[n.i.ZegoWhiteboardViewErrorGraphicImageSizeLimit]="图片图元大小超限制",o[n.i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport]="不支持的图片类型",o[n.i.ZegoWhiteboardViewErrorGraphicIllegalUrl]="无效图片地址",o[n.i.ZegoWhiteboardViewErrorInitFail]="初始化失败",o[n.i.ZegoWhiteboardViewErrorGetListFail]="拉取白板view列表失败",o[n.i.ZegoWhiteboardViewErrorCreateFail]="创建白板view失败",o[n.i.ZegoWhiteboardViewErrorDestroyFail]="销毁白板view失败",o[n.i.ZegoWhiteboardViewErrorAttachFail]="attach白板view失败",o[n.i.ZegoWhiteboardViewErrorClearFail]="清空白板view失败",o[n.i.ZegoWhiteboardViewErrorScrollFail]="滚动白板view失败",o[n.i.ZegoWhiteboardViewErrorUndoFail]="撤销操作失败",o[n.i.ZegoWhiteboardViewErrorRedoFail]="重做操作失败",o[n.i.ZegoWhiteboardViewErrorLogFolderNotAccess]="日志目录无法创建或写入",o[n.i.ZegoWhiteboardViewErrorCacheFolderNotAccess]="缓目录径无法创建或写入",o[n.i.ZegoWhiteboardViewErrorNoAuthScale]="无白板缩放权限",o[n.i.ZegoWhiteboardViewErrorNoAuthScroll]="无白板滚动权限",o[n.i.ZegoWhiteboardViewErrorNoAuthCreateGraphic]="无图元创建权限",o[n.i.ZegoWhiteboardViewErrorNoAuthUpdateGraphic]="无图元编辑权限",o[n.i.ZegoWhiteboardViewErrorNoAuthMoveGraphic]="无图元移动权限",o[n.i.ZegoWhiteboardViewErrorNoAuthDeleteGraphic]="无图元删除权限",o[n.i.ZegoWhiteboardViewErrorNoAuthClearGraphic]="无白板清空权限",o),a={1003:n.i.ZegoWhiteboardViewErrorNoLoginRoom,1014:n.i.ZegoWhiteboardViewErrorUserNotExist,1101:n.i.ZegoWhiteboardViewErrorViewNotExist,1102:n.i.ZegoWhiteboardViewErrorViewCreateFail,1104:n.i.ZegoWhiteboardViewErrorViewModifyFail,1114:n.i.ZegoWhiteboardViewErrorViewNumLimit,1201:n.i.ZegoWhiteboardViewErrorGraphicModifyFail,1202:n.i.ZegoWhiteboardViewErrorGraphicModifyFail,1212:n.i.ZegoWhiteboardViewErrorGraphicCreateFail,1217:n.i.ZegoWhiteboardViewErrorGraphicDataLimit,1219:n.i.ZegoWhiteboardViewErrorGraphicModifyFail,1222:n.i.ZegoWhiteboardViewErrorGraphicDataLimit,1223:n.i.ZegoWhiteboardViewErrorGraphicNumLimit,60003001:n.i.ZegoWhiteboardViewErrorInvalidRsp,10001e3:n.i.ZegoWhiteboardViewErrorInternal,10001001:n.i.ZegoWhiteboardViewErrorParamInvalid,110000001:n.i.ZegoWhiteboardViewErrorGraphicIllegalUrl,110000003:n.i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport,110000004:n.i.ZegoWhiteboardViewErrorGraphicImageSizeLimit,110000005:n.i.ZegoWhiteboardViewErrorGraphicIllegalUrl,110000007:n.i.ZegoWhiteboardViewErrorLogFolderNotAccess,110000008:n.i.ZegoWhiteboardViewErrorCacheFolderNotAccess,110000009:n.i.ZegoWhiteboardViewErrorViewNameLimit,111001001:n.i.ZegoWhiteboardViewErrorNetworkDisconnect,111001002:n.i.ZegoWhiteboardViewErrorNetworkTimeout,111101001:n.i.ZegoWhiteboardViewErrorRequestTooMany,112001003:n.i.ZegoWhiteboardViewErrorNoLoginRoom,112001014:n.i.ZegoWhiteboardViewErrorUserNotExist,112001101:n.i.ZegoWhiteboardViewErrorViewNotExist,112001102:n.i.ZegoWhiteboardViewErrorViewCreateFail,112001104:n.i.ZegoWhiteboardViewErrorViewModifyFail,112001114:n.i.ZegoWhiteboardViewErrorViewNumLimit,112001201:n.i.ZegoWhiteboardViewErrorGraphicModifyFail,112001202:n.i.ZegoWhiteboardViewErrorGraphicModifyFail,112001212:n.i.ZegoWhiteboardViewErrorGraphicCreateFail,112001217:n.i.ZegoWhiteboardViewErrorGraphicDataLimit,112001219:n.i.ZegoWhiteboardViewErrorGraphicModifyFail,112001222:n.i.ZegoWhiteboardViewErrorGraphicDataLimit,112001223:n.i.ZegoWhiteboardViewErrorGraphicNumLimit},c=function(e,t,r){return{code:e=a[e]||e,msg:t=s[e]&&r&&t?t:s[e]||t||s[n.i.ZegoWhiteboardViewErrorInternal]}},d=function(e,t,r){var o=c(e,t,r);return i.e.emit(i.b.Error,o),o}},function(e,t,r){var o=r(14);e.exports=function(e){if(!o(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t,r){"use strict";var o,i,n,s=r(166),a=r(19),c=r(7),d=r(14),l=r(16),u=r(83),h=r(28),p=r(25),f=r(18).f,g=r(90),m=r(60),_=r(12),v=r(79),E=c.Int8Array,y=E&&E.prototype,S=c.Uint8ClampedArray,T=S&&S.prototype,b=E&&g(E),R=y&&g(y),C=Object.prototype,I=C.isPrototypeOf,O=_("toStringTag"),L=v("TYPED_ARRAY_TAG"),w=v("TYPED_ARRAY_CONSTRUCTOR"),M=s&&!!m&&"Opera"!==u(c.opera),A=!1,N={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},k={BigInt64Array:8,BigUint64Array:8},P=function(e){if(!d(e))return!1;var t=u(e);return l(N,t)||l(k,t)};for(o in N)(n=(i=c[o])&&i.prototype)?h(n,w,i):M=!1;for(o in k)(n=(i=c[o])&&i.prototype)&&h(n,w,i);if((!M||"function"!=typeof b||b===Function.prototype)&&(b=function(){throw TypeError("Incorrect invocation")},M))for(o in N)c[o]&&m(c[o],b);if((!M||!R||R===C)&&(R=b.prototype,M))for(o in N)c[o]&&m(c[o].prototype,R);if(M&&g(T)!==R&&m(T,R),a&&!l(R,O))for(o in A=!0,f(R,O,{get:function(){return d(this)?this[L]:void 0}}),N)c[o]&&h(c[o],L,o);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:M,TYPED_ARRAY_CONSTRUCTOR:w,TYPED_ARRAY_TAG:A&&L,aTypedArray:function(e){if(P(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(m&&!I.call(b,e))throw TypeError("Target is not a typed array constructor");return e},exportTypedArrayMethod:function(e,t,r){if(a){if(r)for(var o in N){var i=c[o];if(i&&l(i.prototype,e))try{delete i.prototype[e]}catch(e){}}R[e]&&!r||p(R,e,r?t:M&&y[e]||t)}},exportTypedArrayStaticMethod:function(e,t,r){var o,i;if(a){if(m){if(r)for(o in N)if((i=c[o])&&l(i,e))try{delete i[e]}catch(e){}if(b[e]&&!r)return;try{return p(b,e,r?t:M&&b[e]||t)}catch(e){}}for(o in N)!(i=c[o])||i[e]&&!r||p(i,e,t)}},isView:function(e){if(!d(e))return!1;var t=u(e);return"DataView"===t||l(N,t)||l(k,t)},isTypedArray:P,TypedArray:b,TypedArrayPrototype:R}},function(e,t,r){var o=r(7),i=r(86),n=r(16),s=r(79),a=r(107),c=r(158),d=i("wks"),l=o.Symbol,u=c?l:l&&l.withoutSetter||s;e.exports=function(e){return n(d,e)&&(a||"string"==typeof d[e])||(a&&n(l,e)?d[e]=l[e]:d[e]=u("Symbol."+e)),d[e]}},function(e,t,r){var o=r(34),i=Math.min;e.exports=function(e){return e>0?i(o(e),9007199254740991):0}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},,function(e,t,r){var o=r(20),i={}.hasOwnProperty;e.exports=Object.hasOwn||function(e,t){return i.call(o(e),t)}},function(e,t){e.exports=!1},function(e,t,r){var o=r(19),i=r(159),n=r(10),s=r(77),a=Object.defineProperty;t.f=o?a:function(e,t,r){if(n(e),t=s(t),n(r),i)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var o=r(8);e.exports=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){var o=r(37);e.exports=function(e){return Object(o(e))}},function(e,t,r){var o=r(67);e.exports=function(e){if(o(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)}},function(e,t,r){var o=r(30),i=r(76),n=r(20),s=r(13),a=r(119),c=[].push,d=function(e){var t=1==e,r=2==e,d=3==e,l=4==e,u=6==e,h=7==e,p=5==e||u;return function(f,g,m,_){for(var v,E,y=n(f),S=i(y),T=o(g,m,3),b=s(S.length),R=0,C=_||a,I=t?C(f,b):r||h?C(f,0):void 0;b>R;R++)if((p||R in S)&&(E=T(v=S[R],R,y),e))if(t)I[R]=E;else if(E)switch(e){case 3:return!0;case 5:return v;case 6:return R;case 2:c.call(I,v)}else switch(e){case 4:return!1;case 7:c.call(I,v)}return u?-1:d||l?l:I}};e.exports={forEach:d(0),map:d(1),filter:d(2),some:d(3),every:d(4),find:d(5),findIndex:d(6),filterReject:d(7)}},function(e,t,r){"use strict";e.exports=r(349)},function(e,t,r){"use strict";var o,i;r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return i})),function(e){e.Docs="zegoeventdocs",e.Whiteboard="zegoeventwb"}(o||(o={})),function(e){e.WbInit="wbinit",e.WbDragTool="wbdragtool",e.WbScale="wbscale",e.WbDestroy="wbdestroy",e.WbSwitch="wbSwitch",e.WbError="wberror",e.Snapshot="snapshot",e.Page="page",e.Step="step",e.SyncDrag="syncDrag",e.Animation="targetclick",e.H5Snapshot="getH5SnapshotResult",e.DocsAspect="getAspectCache",e.ReloadView="reloadview"}(i||(i={}))},function(e,t,r){var o=r(7),i=r(28),n=r(16),s=r(109),a=r(114),c=r(36),d=c.get,l=c.enforce,u=String(String).split("String");(e.exports=function(e,t,r,a){var c,d=!!a&&!!a.unsafe,h=!!a&&!!a.enumerable,p=!!a&&!!a.noTargetGet;"function"==typeof r&&("string"!=typeof t||n(r,"name")||i(r,"name",t),(c=l(r)).source||(c.source=u.join("string"==typeof t?t:""))),e!==o?(d?!p&&e[t]&&(h=!0):delete e[t],h?e[t]=r:i(e,t,r)):h?e[t]=r:s(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&d(this).source||a(this)}))},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t,r){"use strict";var o,i,n,s,a,c;r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"d",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"e",(function(){return c})),function(e){e[e.ZegoWhiteboardViewSuccess=0]="ZegoWhiteboardViewSuccess",e[e.ZegoWhiteboardViewErrorInternal=3000001]="ZegoWhiteboardViewErrorInternal",e[e.ZegoWhiteboardViewErrorParamInvalid=3000002]="ZegoWhiteboardViewErrorParamInvalid",e[e.ZegoWhiteboardViewErrorNetworkTimeout=3000003]="ZegoWhiteboardViewErrorNetworkTimeout",e[e.ZegoWhiteboardViewErrorNetworkDisconnect=3000004]="ZegoWhiteboardViewErrorNetworkDisconnect",e[e.ZegoWhiteboardViewErrorInvalidRsp=3000005]="ZegoWhiteboardViewErrorInvalidRsp",e[e.ZegoWhiteboardViewErrorRequestTooMany=3000006]="ZegoWhiteboardViewErrorRequestTooMany",e[e.ZegoWhiteboardViewErrorVersionMismatch=3000007]="ZegoWhiteboardViewErrorVersionMismatch",e[e.ZegoWhiteboardViewErrorNoLoginRoom=3010001]="ZegoWhiteboardViewErrorNoLoginRoom",e[e.ZegoWhiteboardViewErrorUserNotExist=3010002]="ZegoWhiteboardViewErrorUserNotExist",e[e.ZegoWhiteboardViewErrorViewNotExist=3020001]="ZegoWhiteboardViewErrorViewNotExist",e[e.ZegoWhiteboardViewErrorViewCreateFail=3020002]="ZegoWhiteboardViewErrorViewCreateFail",e[e.ZegoWhiteboardViewErrorViewModifyFail=3020003]="ZegoWhiteboardViewErrorViewModifyFail",e[e.ZegoWhiteboardViewErrorViewNameLimit=3020004]="ZegoWhiteboardViewErrorViewNameLimit",e[e.ZegoWhiteboardViewErrorViewParentNotExist=3020005]="ZegoWhiteboardViewErrorViewParentNotExist",e[e.ZegoWhiteboardViewErrorViewNumLimit=3020006]="ZegoWhiteboardViewErrorViewNumLimit",e[e.ZegoWhiteboardViewErrorAnimationInfoLimit=3020007]="ZegoWhiteboardViewErrorAnimationInfoLimit",e[e.ZegoWhiteboardViewErrorGraphicNotExist=3030001]="ZegoWhiteboardViewErrorGraphicNotExist",e[e.ZegoWhiteboardViewErrorGraphicCreateFail=3030002]="ZegoWhiteboardViewErrorGraphicCreateFail",e[e.ZegoWhiteboardViewErrorGraphicModifyFail=3030003]="ZegoWhiteboardViewErrorGraphicModifyFail",e[e.ZegoWhiteboardViewErrorGraphicUnableDraw=3030004]="ZegoWhiteboardViewErrorGraphicUnableDraw",e[e.ZegoWhiteboardViewErrorGraphicDataLimit=3030005]="ZegoWhiteboardViewErrorGraphicDataLimit",e[e.ZegoWhiteboardViewErrorGraphicNumLimit=3030006]="ZegoWhiteboardViewErrorGraphicNumLimit",e[e.ZegoWhiteboardViewErrorGraphicTextLimit=3030007]="ZegoWhiteboardViewErrorGraphicTextLimit",e[e.ZegoWhiteboardViewErrorGraphicImageSizeLimit=3030008]="ZegoWhiteboardViewErrorGraphicImageSizeLimit",e[e.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport=3030009]="ZegoWhiteboardViewErrorGraphicImageTypeNotSupport",e[e.ZegoWhiteboardViewErrorGraphicIllegalUrl=3030010]="ZegoWhiteboardViewErrorGraphicIllegalUrl",e[e.ZegoWhiteboardViewErrorInitFail=3040001]="ZegoWhiteboardViewErrorInitFail",e[e.ZegoWhiteboardViewErrorGetListFail=3040002]="ZegoWhiteboardViewErrorGetListFail",e[e.ZegoWhiteboardViewErrorCreateFail=3040003]="ZegoWhiteboardViewErrorCreateFail",e[e.ZegoWhiteboardViewErrorDestroyFail=3040004]="ZegoWhiteboardViewErrorDestroyFail",e[e.ZegoWhiteboardViewErrorAttachFail=3040005]="ZegoWhiteboardViewErrorAttachFail",e[e.ZegoWhiteboardViewErrorClearFail=3040006]="ZegoWhiteboardViewErrorClearFail",e[e.ZegoWhiteboardViewErrorScrollFail=3040007]="ZegoWhiteboardViewErrorScrollFail",e[e.ZegoWhiteboardViewErrorUndoFail=3040008]="ZegoWhiteboardViewErrorUndoFail",e[e.ZegoWhiteboardViewErrorRedoFail=3040009]="ZegoWhiteboardViewErrorRedoFail",e[e.ZegoWhiteboardViewErrorLogFolderNotAccess=3040010]="ZegoWhiteboardViewErrorLogFolderNotAccess",e[e.ZegoWhiteboardViewErrorCacheFolderNotAccess=3040011]="ZegoWhiteboardViewErrorCacheFolderNotAccess",e[e.ZegoWhiteboardViewErrorNoAuthScale=3050001]="ZegoWhiteboardViewErrorNoAuthScale",e[e.ZegoWhiteboardViewErrorNoAuthScroll=3050002]="ZegoWhiteboardViewErrorNoAuthScroll",e[e.ZegoWhiteboardViewErrorNoAuthCreateGraphic=3050003]="ZegoWhiteboardViewErrorNoAuthCreateGraphic",e[e.ZegoWhiteboardViewErrorNoAuthUpdateGraphic=3050004]="ZegoWhiteboardViewErrorNoAuthUpdateGraphic",e[e.ZegoWhiteboardViewErrorNoAuthMoveGraphic=3050005]="ZegoWhiteboardViewErrorNoAuthMoveGraphic",e[e.ZegoWhiteboardViewErrorNoAuthDeleteGraphic=3050006]="ZegoWhiteboardViewErrorNoAuthDeleteGraphic",e[e.ZegoWhiteboardViewErrorNoAuthClearGraphic=3050007]="ZegoWhiteboardViewErrorNoAuthClearGraphic"}(o||(o={})),function(e){e[e.ZegoWhiteboardViewToolPen=1]="ZegoWhiteboardViewToolPen",e[e.ZegoWhiteboardViewToolText=2]="ZegoWhiteboardViewToolText",e[e.ZegoWhiteboardViewToolLine=4]="ZegoWhiteboardViewToolLine",e[e.ZegoWhiteboardViewToolRect=8]="ZegoWhiteboardViewToolRect",e[e.ZegoWhiteboardViewToolEllipse=16]="ZegoWhiteboardViewToolEllipse",e[e.ZegoWhiteboardViewToolSelector=32]="ZegoWhiteboardViewToolSelector",e[e.ZegoWhiteboardViewToolEraser=64]="ZegoWhiteboardViewToolEraser",e[e.ZegoWhiteboardViewToolLaser=128]="ZegoWhiteboardViewToolLaser",e[e.ZegoWhiteboardViewToolClick=256]="ZegoWhiteboardViewToolClick",e[e.ZegoWhitebaordViewToolCustomImage=512]="ZegoWhitebaordViewToolCustomImage"}(i||(i={})),function(e){e[e.ZegoWhiteboardOperationModeNone=1]="ZegoWhiteboardOperationModeNone",e[e.ZegoWhiteboardOperationModeScroll=2]="ZegoWhiteboardOperationModeScroll",e[e.ZegoWhiteboardOperationModeDraw=4]="ZegoWhiteboardOperationModeDraw",e[e.ZegoWhiteboardOperationModeZoom=8]="ZegoWhiteboardOperationModeZoom"}(n||(n={})),function(e){e[e.ZegoWhiteboardViewImageGraphic=0]="ZegoWhiteboardViewImageGraphic",e[e.ZegoWhiteboardViewImageCustom=1]="ZegoWhiteboardViewImageCustom"}(s||(s={})),function(e){e[e.ZegoWhiteboardViewImageFitModeLeft=0]="ZegoWhiteboardViewImageFitModeLeft",e[e.ZegoWhiteboardViewImageFitModeRight=1]="ZegoWhiteboardViewImageFitModeRight",e[e.ZegoWhiteboardViewImageFitModeBottom=2]="ZegoWhiteboardViewImageFitModeBottom",e[e.ZegoWhiteboardViewImageFitModeTop=3]="ZegoWhiteboardViewImageFitModeTop",e[e.ZegoWhiteboardViewImageFitModeCenter=4]="ZegoWhiteboardViewImageFitModeCenter"}(a||(a={})),function(e){e[e.Center=0]="Center",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(c||(c={}))},function(e,t,r){var o=r(19),i=r(18),n=r(55);e.exports=o?function(e,t,r){return i.f(e,t,n(1,r))}:function(e,t,r){return e[t]=r,e}},,function(e,t,r){var o=r(26);e.exports=function(e,t,r){if(o(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,o){return e.call(t,r,o)};case 3:return function(r,o,i){return e.call(t,r,o,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var o=r(10),i=r(124),n=r(13),s=r(30),a=r(103),c=r(85),d=r(195),l=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,r){var u,h,p,f,g,m,_,v=r&&r.that,E=!(!r||!r.AS_ENTRIES),y=!(!r||!r.IS_ITERATOR),S=!(!r||!r.INTERRUPTED),T=s(t,v,1+E+S),b=function(e){return u&&d(u,"normal",e),new l(!0,e)},R=function(e){return E?(o(e),S?T(e[0],e[1],b):T(e[0],e[1])):S?T(e,b):T(e)};if(y)u=e;else{if("function"!=typeof(h=c(e)))throw TypeError("Target is not iterable");if(i(h)){for(p=0,f=n(e.length);f>p;p++)if((g=R(e[p]))&&g instanceof l)return g;return new l(!1)}u=a(e,h)}for(m=u.next;!(_=m.call(u)).done;){try{g=R(_.value)}catch(e){d(u,"throw",e)}if("object"==typeof g&&g&&g instanceof l)return g}return new l(!1)}},function(e,t,r){"use strict";var o=r(39),i=r(93),n=r(78),s=r(36),a=r(115),c=s.set,d=s.getterFor("Array Iterator");e.exports=a(Array,"Array",(function(e,t){c(this,{type:"Array Iterator",target:o(e),index:0,kind:t})}),(function(){var e=d(this),t=e.target,r=e.kind,o=e.index++;return!t||o>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:o,done:!1}:"values"==r?{value:t[o],done:!1}:{value:[o,t[o]],done:!1}}),"values"),n.Arguments=n.Array,i("keys"),i("values"),i("entries")},function(e,t,r){"use strict";var o=r(199),i=Object.prototype.toString;function n(e){return"[object Array]"===i.call(e)}function s(e){return void 0===e}function a(e){return null!==e&&"object"==typeof e}function c(e){return"[object Function]"===i.call(e)}function d(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),n(e))for(var r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:n,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:function(e){return null!==e&&!s(e)&&null!==e.constructor&&!s(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:a,isUndefined:s,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:c,isStream:function(e){return a(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:d,merge:function e(){var t={};function r(r,o){"object"==typeof t[o]&&"object"==typeof r?t[o]=e(t[o],r):t[o]=r}for(var o=0,i=arguments.length;o<i;o++)d(arguments[o],r);return t},deepMerge:function e(){var t={};function r(r,o){"object"==typeof t[o]&&"object"==typeof r?t[o]=e(t[o],r):t[o]="object"==typeof r?e({},r):r}for(var o=0,i=arguments.length;o<i;o++)d(arguments[o],r);return t},extend:function(e,t,r){return d(t,(function(t,i){e[i]=r&&"function"==typeof t?o(t,r):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t){var r=Math.ceil,o=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?o:r)(e)}},function(e,t,r){var o=r(7),i=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?i(o[e]):o[e]&&o[e][t]}},function(e,t,r){var o,i,n,s=r(224),a=r(7),c=r(14),d=r(28),l=r(16),u=r(108),h=r(87),p=r(80),f=a.WeakMap;if(s||u.state){var g=u.state||(u.state=new f),m=g.get,_=g.has,v=g.set;o=function(e,t){if(_.call(g,e))throw new TypeError("Object already initialized");return t.facade=e,v.call(g,e,t),t},i=function(e){return m.call(g,e)||{}},n=function(e){return _.call(g,e)}}else{var E=h("state");p[E]=!0,o=function(e,t){if(l(e,E))throw new TypeError("Object already initialized");return t.facade=e,d(e,E,t),t},i=function(e){return l(e,E)?e[E]:{}},n=function(e){return l(e,E)}}e.exports={set:o,get:i,has:n,enforce:function(e){return n(e)?i(e):o(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=i(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,r){var o=r(112),i=r(25),n=r(232);o||i(Object.prototype,"toString",n,{unsafe:!0})},function(e,t,r){var o=r(76),i=r(37);e.exports=function(e){return o(i(e))}},function(e,t,r){var o=r(5),i=r(181);o({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},function(e,t,r){"use strict";var o=r(5),i=r(89);o({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},function(e,t,r){"use strict";r.d(t,"e",(function(){return a})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return l})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return h})),r.d(t,"a",(function(){return p})),r.d(t,"h",(function(){return f})),r.d(t,"o",(function(){return g})),r.d(t,"j",(function(){return m})),r.d(t,"k",(function(){return _})),r.d(t,"n",(function(){return v})),r.d(t,"l",(function(){return E})),r.d(t,"m",(function(){return y})),r.d(t,"i",(function(){return S}));r(310),r(311),r(51),r(52),r(248);var o=r(3),i=r(9),n=r(0),s=function(e){return/^#[0-9a-fA-F]{6}|rgba?\(*.+\d\)$/.test(e)};function a(){return o.a.basicState.type||null}function c(){return o.a.basicState.color}function d(){return o.a.basicState.size}function l(){return o.a.basicState.fontSize}function u(){return JSON.parse(o.a.basicState.attributes).bold}function h(){return JSON.parse(o.a.basicState.attributes).italic}function p(){return o.a.basicState.bgColor}function f(){return JSON.parse(o.a.basicState.attributes).stroke}function g(e){return!e||Object.keys(n.j).includes(String(e))?(o.a.basicState.type=e||0,!0):(Object(i.a)(n.i.ZegoWhiteboardViewErrorParamInvalid),!1)}function m(e){return s(e)?(o.a.basicState.color=e,!0):(Object(i.a)(n.i.ZegoWhiteboardViewErrorParamInvalid,"参数错误：color仅支持16进制、rgba",!0),!1)}function _(e){return/^([1-9]|[1-9]\d|100)$/.test(""+(t=e))&&"number"==typeof t?(o.a.basicState.size=e,!0):(Object(i.a)(n.i.ZegoWhiteboardViewErrorParamInvalid,"参数错误: 画笔粗细为100内的正整数",!0),!1);var t}function v(e){return/^([1-9]|[1-9]\d|100)$/.test(""+(t=e))&&"number"==typeof t?(o.a.basicState.fontSize=e,!0):(Object(i.a)(n.i.ZegoWhiteboardViewErrorParamInvalid,"参数错误: 文本大小为100内的正整数",!0),!1);var t}function E(e){if("boolean"!=typeof e)return Object(i.a)(n.i.ZegoWhiteboardViewErrorParamInvalid),!1;var t=o.a.basicState.attributes,r=JSON.parse(t);return r.bold=e,o.a.basicState.attributes=JSON.stringify(r),!0}function y(e){if("boolean"!=typeof e)return Object(i.a)(n.i.ZegoWhiteboardViewErrorParamInvalid),!1;var t=o.a.basicState.attributes,r=JSON.parse(t);return r.italic=e,o.a.basicState.attributes=JSON.stringify(r),!0}function S(e){return s(e)?(o.a.basicState.bgColor=e,!0):(Object(i.a)(n.i.ZegoWhiteboardViewErrorParamInvalid,"参数错误: color仅支持16进制、rgba",!0),!1)}},function(e,t,r){var o;e.exports=(o=o||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),o={},i=o.lib={},n=i.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,o=this.sigBytes,i=e.sigBytes;if(this.clamp(),o%4)for(var n=0;n<i;n++){var s=r[n>>>2]>>>24-n%4*8&255;t[o+n>>>2]|=s<<24-(o+n)%4*8}else for(n=0;n<i;n+=4)t[o+n>>>2]=r[n>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,o=[],i=function(t){t=t;var r=987654321,o=4294967295;return function(){var i=((r=36969*(65535&r)+(r>>16)&o)<<16)+(t=18e3*(65535&t)+(t>>16)&o)&o;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},n=0;n<t;n+=4){var a=i(4294967296*(r||e.random()));r=987654071*a(),o.push(4294967296*a()|0)}return new s.init(o,t)}}),a=o.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,o=[],i=0;i<r;i++){var n=t[i>>>2]>>>24-i%4*8&255;o.push((n>>>4).toString(16)),o.push((15&n).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o+=2)r[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new s.init(r,t/2)}},d=a.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,o=[],i=0;i<r;i++){var n=t[i>>>2]>>>24-i%4*8&255;o.push(String.fromCharCode(n))}return o.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o++)r[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new s.init(r,t)}},l=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},u=i.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,o=r.words,i=r.sigBytes,n=this.blockSize,a=i/(4*n),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*n,d=e.min(4*c,i);if(c){for(var l=0;l<c;l+=n)this._doProcessBlock(o,l);var u=o.splice(0,c);r.sigBytes-=d}return new s.init(u,d)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(i.Hasher=u.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}}),o.algo={});return o}(Math),o)},function(e,t,r){"use strict";var o=r(122).charAt,i=r(21),n=r(36),s=r(115),a=n.set,c=n.getterFor("String Iterator");s(String,"String",(function(e){a(this,{type:"String Iterator",string:i(e),index:0})}),(function(){var e,t=c(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=o(r,i),t.index+=e.length,{value:e,done:!1})}))},function(e,t){e.exports=function(e){return Map.prototype.entries.call(e)}},function(e,t,r){var o=r(35);e.exports=o("navigator","userAgent")||""},function(e,t,r){var o,i=r(10),n=r(182),s=r(110),a=r(80),c=r(176),d=r(113),l=r(87),u=l("IE_PROTO"),h=function(){},p=function(e){return"<script>"+e+"<\/script>"},f=function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{o=new ActiveXObject("htmlfile")}catch(e){}var e,t;g="undefined"!=typeof document?document.domain&&o?f(o):((t=d("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F):f(o);for(var r=s.length;r--;)delete g.prototype[s[r]];return g()};a[u]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(h.prototype=i(e),r=new h,h.prototype=null,r[u]=e):r=g(),void 0===t?r:n(r,t)}},function(e,t,r){"use strict";var o=r(5),i=r(169);o({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},function(e,t,r){var o=r(7),i=r(171),n=r(169),s=r(28);for(var a in i){var c=o[a],d=c&&c.prototype;if(d&&d.forEach!==n)try{s(d,"forEach",n)}catch(e){d.forEach=n}}},function(e,t,r){"use strict";var o,i,n,s,a=r(5),c=r(17),d=r(7),l=r(35),u=r(253),h=r(25),p=r(101),f=r(60),g=r(54),m=r(125),_=r(14),v=r(26),E=r(69),y=r(114),S=r(31),T=r(102),b=r(62),R=r(196).set,C=r(254),I=r(257),O=r(258),L=r(198),w=r(259),M=r(36),A=r(100),N=r(12),k=r(260),P=r(126),x=r(68),D=N("species"),U="Promise",B=M.get,Z=M.set,H=M.getterFor(U),G=u&&u.prototype,W=u,z=G,q=d.TypeError,j=d.document,V=d.process,F=L.f,Y=F,X=!!(j&&j.createEvent&&d.dispatchEvent),J="function"==typeof PromiseRejectionEvent,K=!1,Q=A(U,(function(){var e=y(W),t=e!==String(W);if(!t&&66===x)return!0;if(c&&!z.finally)return!0;if(x>=51&&/native code/.test(e))return!1;var r=new W((function(e){e(1)})),o=function(e){e((function(){}),(function(){}))};return(r.constructor={})[D]=o,!(K=r.then((function(){}))instanceof o)||!t&&k&&!J})),$=Q||!T((function(e){W.all(e).catch((function(){}))})),ee=function(e){var t;return!(!_(e)||"function"!=typeof(t=e.then))&&t},te=function(e,t){if(!e.notified){e.notified=!0;var r=e.reactions;C((function(){for(var o=e.value,i=1==e.state,n=0;r.length>n;){var s,a,c,d=r[n++],l=i?d.ok:d.fail,u=d.resolve,h=d.reject,p=d.domain;try{l?(i||(2===e.rejection&&ne(e),e.rejection=1),!0===l?s=o:(p&&p.enter(),s=l(o),p&&(p.exit(),c=!0)),s===d.promise?h(q("Promise-chain cycle")):(a=ee(s))?a.call(s,u,h):u(s)):h(o)}catch(e){p&&!c&&p.exit(),h(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&oe(e)}))}},re=function(e,t,r){var o,i;X?((o=j.createEvent("Event")).promise=t,o.reason=r,o.initEvent(e,!1,!0),d.dispatchEvent(o)):o={promise:t,reason:r},!J&&(i=d["on"+e])?i(o):"unhandledrejection"===e&&O("Unhandled promise rejection",r)},oe=function(e){R.call(d,(function(){var t,r=e.facade,o=e.value;if(ie(e)&&(t=w((function(){P?V.emit("unhandledRejection",o,r):re("unhandledrejection",r,o)})),e.rejection=P||ie(e)?2:1,t.error))throw t.value}))},ie=function(e){return 1!==e.rejection&&!e.parent},ne=function(e){R.call(d,(function(){var t=e.facade;P?V.emit("rejectionHandled",t):re("rejectionhandled",t,e.value)}))},se=function(e,t,r){return function(o){e(t,o,r)}},ae=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,te(e,!0))},ce=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw q("Promise can't be resolved itself");var o=ee(t);o?C((function(){var r={done:!1};try{o.call(t,se(ce,r,e),se(ae,r,e))}catch(t){ae(r,t,e)}})):(e.value=t,e.state=1,te(e,!1))}catch(t){ae({done:!1},t,e)}}};if(Q&&(z=(W=function(e){E(this,W,U),v(e),o.call(this);var t=B(this);try{e(se(ce,t),se(ae,t))}catch(e){ae(t,e)}}).prototype,(o=function(e){Z(this,{type:U,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=p(z,{then:function(e,t){var r=H(this),o=F(b(this,W));return o.ok="function"!=typeof e||e,o.fail="function"==typeof t&&t,o.domain=P?V.domain:void 0,r.parent=!0,r.reactions.push(o),0!=r.state&&te(r,!1),o.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new o,t=B(e);this.promise=e,this.resolve=se(ce,t),this.reject=se(ae,t)},L.f=F=function(e){return e===W||e===n?new i(e):Y(e)},!c&&"function"==typeof u&&G!==Object.prototype)){s=G.then,K||(h(G,"then",(function(e,t){var r=this;return new W((function(e,t){s.call(r,e,t)})).then(e,t)}),{unsafe:!0}),h(G,"catch",z.catch,{unsafe:!0}));try{delete G.constructor}catch(e){}f&&f(G,z)}a({global:!0,wrap:!0,forced:Q},{Promise:W}),g(W,U,!1,!0),m(U),n=l(U),a({target:U,stat:!0,forced:Q},{reject:function(e){var t=F(this);return t.reject.call(void 0,e),t.promise}}),a({target:U,stat:!0,forced:c||Q},{resolve:function(e){return I(c&&this===n?W:this,e)}}),a({target:U,stat:!0,forced:$},{all:function(e){var t=this,r=F(t),o=r.resolve,i=r.reject,n=w((function(){var r=v(t.resolve),n=[],s=0,a=1;S(e,(function(e){var c=s++,d=!1;n.push(void 0),a++,r.call(t,e).then((function(e){d||(d=!0,n[c]=e,--a||o(n))}),i)})),--a||o(n)}));return n.error&&i(n.value),r.promise},race:function(e){var t=this,r=F(t),o=r.reject,i=w((function(){var i=v(t.resolve);S(e,(function(e){i.call(t,e).then(r.resolve,o)}))}));return i.error&&o(i.value),r.promise}})},function(e,t,r){"use strict";var o=r(5),i=r(82).includes,n=r(93);o({target:"Array",proto:!0},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n("includes")},function(e,t,r){"use strict";var o=r(5),i=r(214),n=r(37),s=r(21);o({target:"String",proto:!0,forced:!r(215)("includes")},{includes:function(e){return!!~s(n(this)).indexOf(s(i(e)),arguments.length>1?arguments[1]:void 0)}})},,function(e,t,r){var o=r(18).f,i=r(16),n=r(12)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,n)&&o(e,n,{configurable:!0,value:t})}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var o=r(34),i=Math.max,n=Math.min;e.exports=function(e,t){var r=o(e);return r<0?i(r+t,0):n(r,t)}},function(e,t,r){var o=r(7),i=r(171),n=r(32),s=r(28),a=r(12),c=a("iterator"),d=a("toStringTag"),l=n.values;for(var u in i){var h=o[u],p=h&&h.prototype;if(p){if(p[c]!==l)try{s(p,c,l)}catch(e){p[c]=l}if(p[d]||s(p,d,u),i[u])for(var f in n)if(p[f]!==n[f])try{s(p,f,n[f])}catch(e){p[f]=n[f]}}}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var o=r(161),i=r(110).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return o(e,i)}},function(e,t,r){var o=r(10),i=r(230);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return o(r),i(n),t?e.call(r,n):r.__proto__=n,r}}():void 0)},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var o=r(10),i=r(26),n=r(12)("species");e.exports=function(e,t){var r,s=o(e).constructor;return void 0===s||null==(r=o(s)[n])?t:i(r)}},function(e,t,r){var o=r(25),i=Date.prototype,n=i.toString,s=i.getTime;"Invalid Date"!=String(new Date(NaN))&&o(i,"toString",(function(){var e=s.call(this);return e==e?n.call(this):"Invalid Date"}))},function(e,t,r){var o=r(19),i=r(98),n=r(55),s=r(39),a=r(77),c=r(16),d=r(159),l=Object.getOwnPropertyDescriptor;t.f=o?l:function(e,t){if(e=s(e),t=a(t),d)try{return l(e,t)}catch(e){}if(c(e,t))return n(!i.f.call(e,t),e[t])}},function(e,t,r){"use strict";var o=r(5),i=r(22).map;o({target:"Array",proto:!0,forced:!r(88)("map")},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var o=r(8);e.exports=function(e,t){var r=[][e];return!!r&&o((function(){r.call(null,t||function(){throw 1},1)}))}},function(e,t,r){var o=r(35),i=r(158);e.exports=i?function(e){return"symbol"==typeof e}:function(e){var t=o("Symbol");return"function"==typeof t&&Object(e)instanceof t}},function(e,t,r){var o,i,n=r(7),s=r(46),a=n.process,c=n.Deno,d=a&&a.versions||c&&c.version,l=d&&d.v8;l?i=(o=l.split("."))[0]<4?1:o[0]+o[1]:s&&(!(o=s.match(/Edge\/(\d+)/))||o[1]>=74)&&(o=s.match(/Chrome\/(\d+)/))&&(i=o[1]),e.exports=i&&+i},function(e,t){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}},function(e,t,r){"use strict";var o=r(120),i=r(8),n=r(10),s=r(34),a=r(13),c=r(21),d=r(37),l=r(121),u=r(279),h=r(123),p=r(12)("replace"),f=Math.max,g=Math.min,m="$0"==="a".replace(/./,"$0"),_=!!/./[p]&&""===/./[p]("a","$0");o("replace",(function(e,t,r){var o=_?"$":"$0";return[function(e,r){var o=d(this),i=null==e?void 0:e[p];return void 0!==i?i.call(e,o,r):t.call(c(o),e,r)},function(e,i){var d=n(this),p=c(e);if("string"==typeof i&&-1===i.indexOf(o)&&-1===i.indexOf("$<")){var m=r(t,d,p,i);if(m.done)return m.value}var _="function"==typeof i;_||(i=c(i));var v=d.global;if(v){var E=d.unicode;d.lastIndex=0}for(var y=[];;){var S=h(d,p);if(null===S)break;if(y.push(S),!v)break;""===c(S[0])&&(d.lastIndex=l(p,a(d.lastIndex),E))}for(var T,b="",R=0,C=0;C<y.length;C++){S=y[C];for(var I=c(S[0]),O=f(g(s(S.index),p.length),0),L=[],w=1;w<S.length;w++)L.push(void 0===(T=S[w])?T:String(T));var M=S.groups;if(_){var A=[I].concat(L,O,p);void 0!==M&&A.push(M);var N=c(i.apply(void 0,A))}else N=u(I,p,O,L,M,i);O>=R&&(b+=p.slice(R,O)+N,R=O+I.length)}return b+p.slice(R)}]}),!!i((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!m||_)},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var o={host:{main:"zego.im"},ca_root:"http://flexible.zego.im/root/cert.2017",save_local:1,max_virtual_page_size:31457280,virtual_page_count:3,file_type_size_limit:[[1,524288e3],[2,104857600],[4,10485760],[8,104857600],[16,104857600],[32,2097152],[4096,52428800]],dynamicPPT_config:{retry_time:1,timeout:60}}},function(e,t,r){"use strict";var o=r(5),i=r(7),n=r(35),s=r(17),a=r(19),c=r(107),d=r(8),l=r(16),u=r(81),h=r(14),p=r(67),f=r(10),g=r(20),m=r(39),_=r(77),v=r(21),E=r(55),y=r(47),S=r(92),T=r(59),b=r(178),R=r(111),C=r(64),I=r(18),O=r(98),L=r(28),w=r(25),M=r(86),A=r(87),N=r(80),k=r(79),P=r(12),x=r(172),D=r(173),U=r(54),B=r(36),Z=r(22).forEach,H=A("hidden"),G=P("toPrimitive"),W=B.set,z=B.getterFor("Symbol"),q=Object.prototype,j=i.Symbol,V=n("JSON","stringify"),F=C.f,Y=I.f,X=b.f,J=O.f,K=M("symbols"),Q=M("op-symbols"),$=M("string-to-symbol-registry"),ee=M("symbol-to-string-registry"),te=M("wks"),re=i.QObject,oe=!re||!re.prototype||!re.prototype.findChild,ie=a&&d((function(){return 7!=y(Y({},"a",{get:function(){return Y(this,"a",{value:7}).a}})).a}))?function(e,t,r){var o=F(q,t);o&&delete q[t],Y(e,t,r),o&&e!==q&&Y(q,t,o)}:Y,ne=function(e,t){var r=K[e]=y(j.prototype);return W(r,{type:"Symbol",tag:e,description:t}),a||(r.description=t),r},se=function(e,t,r){e===q&&se(Q,t,r),f(e);var o=_(t);return f(r),l(K,o)?(r.enumerable?(l(e,H)&&e[H][o]&&(e[H][o]=!1),r=y(r,{enumerable:E(0,!1)})):(l(e,H)||Y(e,H,E(1,{})),e[H][o]=!0),ie(e,o,r)):Y(e,o,r)},ae=function(e,t){f(e);var r=m(t),o=S(r).concat(ue(r));return Z(o,(function(t){a&&!ce.call(r,t)||se(e,t,r[t])})),e},ce=function(e){var t=_(e),r=J.call(this,t);return!(this===q&&l(K,t)&&!l(Q,t))&&(!(r||!l(this,t)||!l(K,t)||l(this,H)&&this[H][t])||r)},de=function(e,t){var r=m(e),o=_(t);if(r!==q||!l(K,o)||l(Q,o)){var i=F(r,o);return!i||!l(K,o)||l(r,H)&&r[H][o]||(i.enumerable=!0),i}},le=function(e){var t=X(m(e)),r=[];return Z(t,(function(e){l(K,e)||l(N,e)||r.push(e)})),r},ue=function(e){var t=e===q,r=X(t?Q:m(e)),o=[];return Z(r,(function(e){!l(K,e)||t&&!l(q,e)||o.push(K[e])})),o};(c||(w((j=function(){if(this instanceof j)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?v(arguments[0]):void 0,t=k(e),r=function(e){this===q&&r.call(Q,e),l(this,H)&&l(this[H],t)&&(this[H][t]=!1),ie(this,t,E(1,e))};return a&&oe&&ie(q,t,{configurable:!0,set:r}),ne(t,e)}).prototype,"toString",(function(){return z(this).tag})),w(j,"withoutSetter",(function(e){return ne(k(e),e)})),O.f=ce,I.f=se,C.f=de,T.f=b.f=le,R.f=ue,x.f=function(e){return ne(P(e),e)},a&&(Y(j.prototype,"description",{configurable:!0,get:function(){return z(this).description}}),s||w(q,"propertyIsEnumerable",ce,{unsafe:!0}))),o({global:!0,wrap:!0,forced:!c,sham:!c},{Symbol:j}),Z(S(te),(function(e){D(e)})),o({target:"Symbol",stat:!0,forced:!c},{for:function(e){var t=v(e);if(l($,t))return $[t];var r=j(t);return $[t]=r,ee[r]=t,r},keyFor:function(e){if(!p(e))throw TypeError(e+" is not a symbol");if(l(ee,e))return ee[e]},useSetter:function(){oe=!0},useSimple:function(){oe=!1}}),o({target:"Object",stat:!0,forced:!c,sham:!a},{create:function(e,t){return void 0===t?y(e):ae(y(e),t)},defineProperty:se,defineProperties:ae,getOwnPropertyDescriptor:de}),o({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:le,getOwnPropertySymbols:ue}),o({target:"Object",stat:!0,forced:d((function(){R.f(1)}))},{getOwnPropertySymbols:function(e){return R.f(g(e))}}),V)&&o({target:"JSON",stat:!0,forced:!c||d((function(){var e=j();return"[null]"!=V([e])||"{}"!=V({a:e})||"{}"!=V(Object(e))}))},{stringify:function(e,t,r){for(var o,i=[e],n=1;arguments.length>n;)i.push(arguments[n++]);if(o=t,(h(t)||void 0!==e)&&!p(e))return u(t)||(t=function(e,t){if("function"==typeof o&&(t=o.call(this,e,t)),!p(t))return t}),i[1]=t,V.apply(null,i)}});j.prototype[G]||L(j.prototype,G,j.prototype.valueOf),U(j,"Symbol"),N[H]=!0},function(e,t,r){"use strict";var o=r(5),i=r(19),n=r(7),s=r(16),a=r(14),c=r(18).f,d=r(160),l=n.Symbol;if(i&&"function"==typeof l&&(!("description"in l.prototype)||void 0!==l().description)){var u={},h=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof h?new l(e):void 0===e?l():l(e);return""===e&&(u[t]=!0),t};d(h,l);var p=h.prototype=l.prototype;p.constructor=h;var f=p.toString,g="Symbol(test)"==String(l("test")),m=/^Symbol\((.*)\)[^)]+$/;c(p,"description",{configurable:!0,get:function(){var e=a(this)?this.valueOf():this,t=f.call(e);if(s(u,e))return"";var r=g?t.slice(7,-1):t.replace(m,"$1");return""===r?void 0:r}}),o({global:!0,forced:!0},{Symbol:h})}},function(e,t,r){r(173)("iterator")},function(e,t,r){var o=r(5),i=r(7),n=r(46),s=[].slice,a=function(e){return function(t,r){var o=arguments.length>2,i=o?s.call(arguments,2):void 0;return e(o?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,r)}};o({global:!0,bind:!0,forced:/MSIE .\./.test(n)},{setTimeout:a(i.setTimeout),setInterval:a(i.setInterval)})},function(e,t,r){var o=r(8),i=r(58),n="".split;e.exports=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?n.call(e,""):Object(e)}:Object},function(e,t,r){var o=r(180),i=r(67);e.exports=function(e){var t=o(e,"string");return i(t)?t:String(t)}},function(e,t){e.exports={}},function(e,t){var r=0,o=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++r+o).toString(36)}},function(e,t){e.exports={}},function(e,t,r){var o=r(58);e.exports=Array.isArray||function(e){return"Array"==o(e)}},function(e,t,r){var o=r(39),i=r(13),n=r(56),s=function(e){return function(t,r,s){var a,c=o(t),d=i(c.length),l=n(s,d);if(e&&r!=r){for(;d>l;)if((a=c[l++])!=a)return!0}else for(;d>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},function(e,t,r){var o=r(112),i=r(58),n=r(12)("toStringTag"),s="Arguments"==i(function(){return arguments}());e.exports=o?i:function(e){var t,r,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),n))?r:s?i(t):"Object"==(o=i(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,r){"use strict";var o=r(120),i=r(177),n=r(10),s=r(37),a=r(62),c=r(121),d=r(13),l=r(21),u=r(123),h=r(89),p=r(163),f=r(8),g=p.UNSUPPORTED_Y,m=[].push,_=Math.min;o("split",(function(e,t,r){var o;return o="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var o=l(s(this)),n=void 0===r?4294967295:r>>>0;if(0===n)return[];if(void 0===e)return[o];if(!i(e))return t.call(o,e,n);for(var a,c,d,u=[],p=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,g=new RegExp(e.source,p+"g");(a=h.call(g,o))&&!((c=g.lastIndex)>f&&(u.push(o.slice(f,a.index)),a.length>1&&a.index<o.length&&m.apply(u,a.slice(1)),d=a[0].length,f=c,u.length>=n));)g.lastIndex===a.index&&g.lastIndex++;return f===o.length?!d&&g.test("")||u.push(""):u.push(o.slice(f)),u.length>n?u.slice(0,n):u}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:t.call(this,e,r)}:t,[function(t,r){var i=s(this),n=null==t?void 0:t[e];return void 0!==n?n.call(t,i,r):o.call(l(i),t,r)},function(e,i){var s=n(this),h=l(e),p=r(o,s,h,i,o!==t);if(p.done)return p.value;var f=a(s,RegExp),m=s.unicode,v=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(g?"g":"y"),E=new f(g?"^(?:"+s.source+")":s,v),y=void 0===i?4294967295:i>>>0;if(0===y)return[];if(0===h.length)return null===u(E,h)?[h]:[];for(var S=0,T=0,b=[];T<h.length;){E.lastIndex=g?0:T;var R,C=u(E,g?h.slice(T):h);if(null===C||(R=_(d(E.lastIndex+(g?T:0)),h.length))===S)T=c(h,T,m);else{if(b.push(h.slice(S,T)),b.length===y)return b;for(var I=1;I<=C.length-1;I++)if(b.push(C[I]),b.length===y)return b;T=S=R}}return b.push(h.slice(S)),b}]}),!!f((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),g)},function(e,t,r){var o=r(83),i=r(78),n=r(12)("iterator");e.exports=function(e){if(null!=e)return e[n]||e["@@iterator"]||i[o(e)]}},function(e,t,r){var o=r(17),i=r(108);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.17.2",mode:o?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var o=r(86),i=r(79),n=o("keys");e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t,r){var o=r(8),i=r(12),n=r(68),s=i("species");e.exports=function(e){return n>=51||!o((function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,r){"use strict";var o,i,n=r(21),s=r(162),a=r(163),c=r(86),d=r(47),l=r(36).get,u=r(227),h=r(228),p=RegExp.prototype.exec,f=c("native-string-replace",String.prototype.replace),g=p,m=(o=/a/,i=/b*/g,p.call(o,"a"),p.call(i,"a"),0!==o.lastIndex||0!==i.lastIndex),_=a.UNSUPPORTED_Y||a.BROKEN_CARET,v=void 0!==/()??/.exec("")[1];(m||v||_||u||h)&&(g=function(e){var t,r,o,i,a,c,u,h=this,E=l(h),y=n(e),S=E.raw;if(S)return S.lastIndex=h.lastIndex,t=g.call(S,y),h.lastIndex=S.lastIndex,t;var T=E.groups,b=_&&h.sticky,R=s.call(h),C=h.source,I=0,O=y;if(b&&(-1===(R=R.replace("y","")).indexOf("g")&&(R+="g"),O=y.slice(h.lastIndex),h.lastIndex>0&&(!h.multiline||h.multiline&&"\n"!==y.charAt(h.lastIndex-1))&&(C="(?: "+C+")",O=" "+O,I++),r=new RegExp("^(?:"+C+")",R)),v&&(r=new RegExp("^"+C+"$(?!\\s)",R)),m&&(o=h.lastIndex),i=p.call(b?r:h,O),b?i?(i.input=i.input.slice(I),i[0]=i[0].slice(I),i.index=h.lastIndex,h.lastIndex+=i[0].length):h.lastIndex=0:m&&i&&(h.lastIndex=h.global?i.index+i[0].length:o),v&&i&&i.length>1&&f.call(i[0],r,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&T)for(i.groups=c=d(null),a=0;a<T.length;a++)c[(u=T[a])[0]]=i[u[1]];return i}),e.exports=g},function(e,t,r){var o=r(16),i=r(20),n=r(87),s=r(229),a=n("IE_PROTO"),c=Object.prototype;e.exports=s?Object.getPrototypeOf:function(e){return e=i(e),o(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?c:null}},function(e,t,r){var o=r(11),i=r(62),n=o.TYPED_ARRAY_CONSTRUCTOR,s=o.aTypedArrayConstructor;e.exports=function(e){return s(i(e,e[n]))}},function(e,t,r){var o=r(161),i=r(110);e.exports=Object.keys||function(e){return o(e,i)}},function(e,t,r){var o=r(12),i=r(47),n=r(18),s=o("unscopables"),a=Array.prototype;null==a[s]&&n.f(a,s,{configurable:!0,value:i(null)}),e.exports=function(e){a[s][e]=!0}},function(e,t,r){"use strict";var o=r(5),i=r(82).indexOf,n=r(66),s=[].indexOf,a=!!s&&1/[1].indexOf(1,-0)<0,c=n("indexOf");o({target:"Array",proto:!0,forced:a||!c},{indexOf:function(e){return a?s.apply(this,arguments)||0:i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var o=r(19),i=r(7),n=r(100),s=r(25),a=r(16),c=r(58),d=r(127),l=r(67),u=r(180),h=r(8),p=r(47),f=r(59).f,g=r(64).f,m=r(18).f,_=r(241).trim,v=i.Number,E=v.prototype,y="Number"==c(p(E)),S=function(e){if(l(e))throw TypeError("Cannot convert a Symbol value to a number");var t,r,o,i,n,s,a,c,d=u(e,"number");if("string"==typeof d&&d.length>2)if(43===(t=(d=_(d)).charCodeAt(0))||45===t){if(88===(r=d.charCodeAt(2))||120===r)return NaN}else if(48===t){switch(d.charCodeAt(1)){case 66:case 98:o=2,i=49;break;case 79:case 111:o=8,i=55;break;default:return+d}for(s=(n=d.slice(2)).length,a=0;a<s;a++)if((c=n.charCodeAt(a))<48||c>i)return NaN;return parseInt(n,o)}return+d};if(n("Number",!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var T,b=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof b&&(y?h((function(){E.valueOf.call(r)})):"Number"!=c(r))?d(new v(S(t)),r,b):S(t)},R=o?f(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),C=0;R.length>C;C++)a(v,T=R[C])&&!a(b,T)&&m(b,T,g(v,T));b.prototype=E,E.constructor=b,s(i,"Number",b)}},function(e,t,r){var o=r(19),i=r(18).f,n=Function.prototype,s=n.toString,a=/^\s*function ([^ (]*)/;o&&!("name"in n)&&i(n,"name",{configurable:!0,get:function(){try{return s.call(this).match(a)[1]}catch(e){return""}}})},function(e,t,r){"use strict";var o=r(5),i=r(22).filter;o({target:"Array",proto:!0,forced:!r(88)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var o={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,n=i&&!o.call({1:2},1);t.f=n?function(e){var t=i(this,e);return!!t&&t.enumerable}:o},function(e,t,r){"use strict";var o=r(5),i=r(76),n=r(39),s=r(66),a=[].join,c=i!=Object,d=s("join",",");o({target:"Array",proto:!0,forced:c||!d},{join:function(e){return a.call(n(this),void 0===e?",":e)}})},function(e,t,r){var o=r(8),i=/#|\.prototype\./,n=function(e,t){var r=a[s(e)];return r==d||r!=c&&("function"==typeof t?o(t):!!t)},s=n.normalize=function(e){return String(e).replace(i,".").toLowerCase()},a=n.data={},c=n.NATIVE="N",d=n.POLYFILL="P";e.exports=n},function(e,t,r){var o=r(25);e.exports=function(e,t,r){for(var i in t)o(e,i,t[i],r);return e}},function(e,t,r){var o=r(12)("iterator"),i=!1;try{var n=0,s={next:function(){return{done:!!n++}},return:function(){i=!0}};s[o]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var n={};n[o]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r}},function(e,t,r){var o=r(10),i=r(85);e.exports=function(e,t){var r=arguments.length<2?i(e):t;if("function"!=typeof r)throw TypeError(String(e)+" is not iterable");return o(r.call(e))}},function(e,t,r){"use strict";var o=r(77),i=r(18),n=r(55);e.exports=function(e,t,r){var s=o(t);s in e?i.f(e,s,n(0,r)):e[s]=r}},function(e,t,r){"use strict";var o=r(5),i=r(14),n=r(81),s=r(56),a=r(13),c=r(39),d=r(104),l=r(12),u=r(88)("slice"),h=l("species"),p=[].slice,f=Math.max;o({target:"Array",proto:!0,forced:!u},{slice:function(e,t){var r,o,l,u=c(this),g=a(u.length),m=s(e,g),_=s(void 0===t?g:t,g);if(n(u)&&("function"!=typeof(r=u.constructor)||r!==Array&&!n(r.prototype)?i(r)&&null===(r=r[h])&&(r=void 0):r=void 0,r===Array||void 0===r))return p.call(u,m,_);for(o=new(void 0===r?Array:r)(f(_-m,0)),l=0;m<_;m++,l++)m in u&&d(o,l,u[m]);return o.length=l,o}})},function(e,t,r){var o,i,n;e.exports=(n=r(43),i=(o=n).lib.WordArray,o.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,o=this._map;e.clamp();for(var i=[],n=0;n<r;n+=3)for(var s=(t[n>>>2]>>>24-n%4*8&255)<<16|(t[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|t[n+2>>>2]>>>24-(n+2)%4*8&255,a=0;a<4&&n+.75*a<r;a++)i.push(o.charAt(s>>>6*(3-a)&63));var c=o.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var n=0;n<r.length;n++)o[r.charCodeAt(n)]=n}var s=r.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return function(e,t,r){for(var o=[],n=0,s=0;s<t;s++)if(s%4){var a=r[e.charCodeAt(s-1)]<<s%4*2,c=r[e.charCodeAt(s)]>>>6-s%4*2;o[n>>>2]|=(a|c)<<24-n%4*8,n++}return i.create(o,n)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)},function(e,t,r){var o=r(68),i=r(8);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&o&&o<41}))},function(e,t,r){var o=r(7),i=r(109),n=o["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=n},function(e,t,r){var o=r(7);e.exports=function(e,t){try{Object.defineProperty(o,e,{value:t,configurable:!0,writable:!0})}catch(r){o[e]=t}return t}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var o={};o[r(12)("toStringTag")]="z",e.exports="[object z]"===String(o)},function(e,t,r){var o=r(7),i=r(14),n=o.document,s=i(n)&&i(n.createElement);e.exports=function(e){return s?n.createElement(e):{}}},function(e,t,r){var o=r(108),i=Function.toString;"function"!=typeof o.inspectSource&&(o.inspectSource=function(e){return i.call(e)}),e.exports=o.inspectSource},function(e,t,r){"use strict";var o=r(5),i=r(183),n=r(90),s=r(60),a=r(54),c=r(28),d=r(25),l=r(12),u=r(17),h=r(78),p=r(164),f=p.IteratorPrototype,g=p.BUGGY_SAFARI_ITERATORS,m=l("iterator"),_=function(){return this};e.exports=function(e,t,r,l,p,v,E){i(r,t,l);var y,S,T,b=function(e){if(e===p&&L)return L;if(!g&&e in I)return I[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},R=t+" Iterator",C=!1,I=e.prototype,O=I[m]||I["@@iterator"]||p&&I[p],L=!g&&O||b(p),w="Array"==t&&I.entries||O;if(w&&(y=n(w.call(new e)),f!==Object.prototype&&y.next&&(u||n(y)===f||(s?s(y,f):"function"!=typeof y[m]&&c(y,m,_)),a(y,R,!0,!0),u&&(h[R]=_))),"values"==p&&O&&"values"!==O.name&&(C=!0,L=function(){return O.call(this)}),u&&!E||I[m]===L||c(I,m,L),h[t]=L,p)if(S={values:b("values"),keys:v?L:b("keys"),entries:b("entries")},E)for(T in S)(g||C||!(T in I))&&d(I,T,S[T]);else o({target:t,proto:!0,forced:g||C},S);return S}},function(e,t,r){"use strict";var o=r(20),i=r(56),n=r(13);e.exports=function(e){for(var t=o(this),r=n(t.length),s=arguments.length,a=i(s>1?arguments[1]:void 0,r),c=s>2?arguments[2]:void 0,d=void 0===c?r:i(c,r);d>a;)t[a++]=e;return t}},function(e,t,r){"use strict";var o=r(5),i=r(56),n=r(34),s=r(13),a=r(20),c=r(119),d=r(104),l=r(88)("splice"),u=Math.max,h=Math.min;o({target:"Array",proto:!0,forced:!l},{splice:function(e,t){var r,o,l,p,f,g,m=a(this),_=s(m.length),v=i(e,_),E=arguments.length;if(0===E?r=o=0:1===E?(r=0,o=_-v):(r=E-2,o=h(u(n(t),0),_-v)),_+r-o>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(l=c(m,o),p=0;p<o;p++)(f=v+p)in m&&d(l,p,m[f]);if(l.length=o,r<o){for(p=v;p<_-o;p++)g=p+r,(f=p+o)in m?m[g]=m[f]:delete m[g];for(p=_;p>_-o+r;p--)delete m[p-1]}else if(r>o)for(p=_-o;p>v;p--)g=p+r-1,(f=p+o-1)in m?m[g]=m[f]:delete m[g];for(p=0;p<r;p++)m[p+v]=arguments[p+2];return m.length=_-o+r,l}})},function(e,t,r){"use strict";r.d(t,"b",(function(){return p})),r.d(t,"a",(function(){return f}));r(63),r(306),r(65),r(38),r(50);var o=r(209),i=r.n(o),n=r(106),s=r.n(n),a=r(210),c=r.n(a),d=r(211),l=r.n(d),u=r(71),h=function(e,t){return s.a.stringify(c()(t,e))},p=function(e){var t=Math.max.apply(Math,u.a.file_type_size_limit.map((function(e){return e[1]})))/1024/1024,r=e.access_key_id,o=e.access_key_secret,n=e.bucket_name,s=e.security_token,a=e.endpoint,c=e.object_name,d=e.timeout,l=void 0===d?1:d,p=e.maxSize,f=function(e,t){var r=new Date;r.setHours(r.getHours()+e);var o={expiration:r.toISOString(),conditions:[["content-length-range",0,1024*t*1024]]};return i.a.Base64.encode(JSON.stringify(o))}(l,void 0===p?t:p);return{url:"https://"+n+"."+a,signature:h(o,f),securityToken:s,policy:f,key:c,OSSAccessKeyId:r,successActionStatus:"200",objectName:c}},f=function(e){return new Promise((function(t,r){try{var o=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,i=Math.ceil(e.size/1048576),n=new l.a.ArrayBuffer,s=0,a=new FileReader;a.onload=function(){var e=a.result||a.content;e?(n.append(e),++s<i?c():t(n.end())):r({code:2020006,message:"文件内容为空"})},a.onerror=function(){r({code:2010001,message:"找不到对应的本地文件"})};var c=function(){var t=1048576*s,r=t+1048576>=e.size?e.size:t+1048576,i=o.call(e,t,r);a.readAsArrayBuffer(i)};c()}catch(e){r(e)}}))}},function(e,t,r){var o=r(226);e.exports=function(e,t){return new(o(e))(0===t?0:t)}},function(e,t,r){"use strict";r(41);var o=r(25),i=r(89),n=r(8),s=r(12),a=r(28),c=s("species"),d=RegExp.prototype;e.exports=function(e,t,r,l){var u=s(e),h=!n((function(){var t={};return t[u]=function(){return 7},7!=""[e](t)})),p=h&&!n((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[c]=function(){return r},r.flags="",r[u]=/./[u]),r.exec=function(){return t=!0,null},r[u](""),!t}));if(!h||!p||r){var f=/./[u],g=t(u,""[e],(function(e,t,r,o,n){var s=t.exec;return s===i||s===d.exec?h&&!n?{done:!0,value:f.call(t,r,o)}:{done:!0,value:e.call(r,t,o)}:{done:!1}}));o(String.prototype,e,g[0]),o(d,u,g[1])}l&&a(d[u],"sham",!0)}},function(e,t,r){"use strict";var o=r(122).charAt;e.exports=function(e,t,r){return t+(r?o(e,t).length:1)}},function(e,t,r){var o=r(34),i=r(21),n=r(37),s=function(e){return function(t,r){var s,a,c=i(n(t)),d=o(r),l=c.length;return d<0||d>=l?e?"":void 0:(s=c.charCodeAt(d))<55296||s>56319||d+1===l||(a=c.charCodeAt(d+1))<56320||a>57343?e?c.charAt(d):s:e?c.slice(d,d+2):a-56320+(s-55296<<10)+65536}};e.exports={codeAt:s(!1),charAt:s(!0)}},function(e,t,r){var o=r(58),i=r(89);e.exports=function(e,t){var r=e.exec;if("function"==typeof r){var n=r.call(e,t);if("object"!=typeof n)throw TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==o(e))throw TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},function(e,t,r){var o=r(12),i=r(78),n=o("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||s[n]===e)}},function(e,t,r){"use strict";var o=r(35),i=r(18),n=r(12),s=r(19),a=n("species");e.exports=function(e){var t=o(e),r=i.f;s&&t&&!t[a]&&r(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,r){var o=r(58),i=r(7);e.exports="process"==o(i.process)},function(e,t,r){var o=r(14),i=r(60);e.exports=function(e,t,r){var n,s;return i&&"function"==typeof(n=t.constructor)&&n!==r&&o(s=n.prototype)&&s!==r.prototype&&i(e,s),e}},function(e,t,r){var o=r(26),i=r(20),n=r(76),s=r(13),a=function(e){return function(t,r,a,c){o(r);var d=i(t),l=n(d),u=s(d.length),h=e?u-1:0,p=e?-1:1;if(a<2)for(;;){if(h in l){c=l[h],h+=p;break}if(h+=p,e?h<0:u<=h)throw TypeError("Reduce of empty array with no initial value")}for(;e?h>=0:u>h;h+=p)h in l&&(c=r(c,l[h],h,d));return c}};e.exports={left:a(!1),right:a(!0)}},function(e,t,r){"use strict";var o=r(5),i=r(22).findIndex,n=r(93),s=!0;"findIndex"in[]&&Array(1).findIndex((function(){s=!1})),o({target:"Array",proto:!0,forced:s},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n("findIndex")},function(e,t,r){"use strict";var o=r(5),i=r(81),n=[].reverse,s=[1,2];o({target:"Array",proto:!0,forced:String(s)===String(s.reverse())},{reverse:function(){return i(this)&&(this.length=this.length),n.call(this)}})},function(e,t,r){"use strict";var o=r(5),i=r(8),n=r(165),s=r(10),a=r(56),c=r(13),d=r(62),l=n.ArrayBuffer,u=n.DataView,h=l.prototype.slice;o({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:i((function(){return!new l(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(void 0!==h&&void 0===t)return h.call(s(this),e);for(var r=s(this).byteLength,o=a(e,r),i=a(void 0===t?r:t,r),n=new(d(this,l))(c(i-o)),p=new u(this),f=new u(n),g=0;o<i;)f.setUint8(g++,p.getUint8(o++));return n}})},function(e,t,r){r(191)("Uint8",(function(e){return function(t,r,o){return e(this,t,r,o)}}))},function(e,t,r){"use strict";var o=r(11),i=r(234),n=o.aTypedArray;(0,o.exportTypedArrayMethod)("copyWithin",(function(e,t){return i.call(n(this),e,t,arguments.length>2?arguments[2]:void 0)}))},function(e,t,r){"use strict";var o=r(11),i=r(22).every,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("every",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var o=r(11),i=r(116),n=o.aTypedArray;(0,o.exportTypedArrayMethod)("fill",(function(e){return i.apply(n(this),arguments)}))},function(e,t,r){"use strict";var o=r(11),i=r(22).filter,n=r(235),s=o.aTypedArray;(0,o.exportTypedArrayMethod)("filter",(function(e){var t=i(s(this),e,arguments.length>1?arguments[1]:void 0);return n(this,t)}))},function(e,t,r){"use strict";var o=r(11),i=r(22).find,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("find",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var o=r(11),i=r(22).findIndex,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("findIndex",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var o=r(11),i=r(22).forEach,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("forEach",(function(e){i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var o=r(11),i=r(82).includes,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("includes",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var o=r(11),i=r(82).indexOf,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("indexOf",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var o=r(7),i=r(11),n=r(32),s=r(12)("iterator"),a=o.Uint8Array,c=n.values,d=n.keys,l=n.entries,u=i.aTypedArray,h=i.exportTypedArrayMethod,p=a&&a.prototype[s],f=!!p&&("values"==p.name||null==p.name),g=function(){return c.call(u(this))};h("entries",(function(){return l.call(u(this))})),h("keys",(function(){return d.call(u(this))})),h("values",g,!f),h(s,g,!f)},function(e,t,r){"use strict";var o=r(11),i=o.aTypedArray,n=o.exportTypedArrayMethod,s=[].join;n("join",(function(e){return s.apply(i(this),arguments)}))},function(e,t,r){"use strict";var o=r(11),i=r(194),n=o.aTypedArray;(0,o.exportTypedArrayMethod)("lastIndexOf",(function(e){return i.apply(n(this),arguments)}))},function(e,t,r){"use strict";var o=r(11),i=r(22).map,n=r(91),s=o.aTypedArray;(0,o.exportTypedArrayMethod)("map",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(n(e))(t)}))}))},function(e,t,r){"use strict";var o=r(11),i=r(128).left,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("reduce",(function(e){return i(n(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var o=r(11),i=r(128).right,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("reduceRight",(function(e){return i(n(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var o=r(11),i=o.aTypedArray,n=o.exportTypedArrayMethod,s=Math.floor;n("reverse",(function(){for(var e,t=i(this).length,r=s(t/2),o=0;o<r;)e=this[o],this[o++]=this[--t],this[t]=e;return this}))},function(e,t,r){"use strict";var o=r(11),i=r(13),n=r(168),s=r(20),a=r(8),c=o.aTypedArray;(0,o.exportTypedArrayMethod)("set",(function(e){c(this);var t=n(arguments.length>1?arguments[1]:void 0,1),r=this.length,o=s(e),a=i(o.length),d=0;if(a+t>r)throw RangeError("Wrong length");for(;d<a;)this[t+d]=o[d++]}),a((function(){new Int8Array(1).set({})})))},function(e,t,r){"use strict";var o=r(11),i=r(91),n=r(8),s=o.aTypedArray,a=o.exportTypedArrayMethod,c=[].slice;a("slice",(function(e,t){for(var r=c.call(s(this),e,t),o=i(this),n=0,a=r.length,d=new o(a);a>n;)d[n]=r[n++];return d}),n((function(){new Int8Array(1).slice()})))},function(e,t,r){"use strict";var o=r(11),i=r(22).some,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("some",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var o=r(11),i=r(7),n=r(8),s=r(26),a=r(13),c=r(184),d=r(185),l=r(186),u=r(68),h=r(187),p=o.aTypedArray,f=o.exportTypedArrayMethod,g=i.Uint16Array,m=g&&g.prototype.sort,_=!!m&&!n((function(){var e=new g(2);e.sort(null),e.sort({})})),v=!!m&&!n((function(){if(u)return u<74;if(d)return d<67;if(l)return!0;if(h)return h<602;var e,t,r=new g(516),o=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,o[e]=e-2*t+3;for(r.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==o[e])return!0}));f("sort",(function(e){if(void 0!==e&&s(e),v)return m.call(this,e);p(this);var t,r=a(this.length),o=Array(r);for(t=0;t<r;t++)o[t]=this[t];for(o=c(this,function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e)),t=0;t<r;t++)this[t]=o[t];return this}),!v||_)},function(e,t,r){"use strict";var o=r(11),i=r(13),n=r(56),s=r(91),a=o.aTypedArray;(0,o.exportTypedArrayMethod)("subarray",(function(e,t){var r=a(this),o=r.length,c=n(e,o);return new(s(r))(r.buffer,r.byteOffset+c*r.BYTES_PER_ELEMENT,i((void 0===t?o:n(t,o))-c))}))},function(e,t,r){"use strict";var o=r(7),i=r(11),n=r(8),s=o.Int8Array,a=i.aTypedArray,c=i.exportTypedArrayMethod,d=[].toLocaleString,l=[].slice,u=!!s&&n((function(){d.call(new s(1))}));c("toLocaleString",(function(){return d.apply(u?l.call(a(this)):a(this),arguments)}),n((function(){return[1,2].toLocaleString()!=new s([1,2]).toLocaleString()}))||!n((function(){s.prototype.toLocaleString.call([1,2])})))},function(e,t,r){"use strict";var o=r(11).exportTypedArrayMethod,i=r(8),n=r(7).Uint8Array,s=n&&n.prototype||{},a=[].toString,c=[].join;i((function(){a.call({})}))&&(a=function(){return c.call(this)});var d=s.toString!=a;o("toString",a,d)},function(e,t,r){"use strict";var o=r(5),i=r(22).some;o({target:"Array",proto:!0,forced:!r(66)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";(function(e){var o=t;function i(e,t,r){for(var o=Object.keys(t),i=0;i<o.length;++i)void 0!==e[o[i]]&&r||(e[o[i]]=t[o[i]]);return e}function n(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}o.asPromise=r(350),o.base64=r(351),o.EventEmitter=r(352),o.float=r(353),o.inquire=r(354),o.utf8=r(355),o.pool=r(356),o.LongBits=r(357),o.isNode=Boolean(void 0!==e&&e&&e.process&&e.process.versions&&e.process.versions.node),o.global=o.isNode&&e||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,o.emptyArray=Object.freeze?Object.freeze([]):[],o.emptyObject=Object.freeze?Object.freeze({}):{},o.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},o.isString=function(e){return"string"==typeof e||e instanceof String},o.isObject=function(e){return e&&"object"==typeof e},o.isset=o.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},o.Buffer=function(){try{var e=o.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),o._Buffer_from=null,o._Buffer_allocUnsafe=null,o.newBuffer=function(e){return"number"==typeof e?o.Buffer?o._Buffer_allocUnsafe(e):new o.Array(e):o.Buffer?o._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},o.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,o.Long=o.global.dcodeIO&&o.global.dcodeIO.Long||o.global.Long||o.inquire("long"),o.key2Re=/^true|false|0|1$/,o.key32Re=/^-?(?:0|[1-9][0-9]*)$/,o.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,o.longToHash=function(e){return e?o.LongBits.from(e).toHash():o.LongBits.zeroHash},o.longFromHash=function(e,t){var r=o.LongBits.fromHash(e);return o.Long?o.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},o.merge=i,o.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},o.newError=n,o.ProtocolError=n("ProtocolError"),o.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},o.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},o.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},o._configure=function(){var e=o.Buffer;e?(o._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},o._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):o._Buffer_from=o._Buffer_allocUnsafe=null}}).call(this,r(61))},function(e,t,r){var o=r(107);e.exports=o&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var o=r(19),i=r(8),n=r(113);e.exports=!o&&!i((function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var o=r(16),i=r(225),n=r(64),s=r(18);e.exports=function(e,t){for(var r=i(t),a=s.f,c=n.f,d=0;d<r.length;d++){var l=r[d];o(e,l)||a(e,l,c(t,l))}}},function(e,t,r){var o=r(16),i=r(39),n=r(82).indexOf,s=r(80);e.exports=function(e,t){var r,a=i(e),c=0,d=[];for(r in a)!o(s,r)&&o(a,r)&&d.push(r);for(;t.length>c;)o(a,r=t[c++])&&(~n(d,r)||d.push(r));return d}},function(e,t,r){"use strict";var o=r(10);e.exports=function(){var e=o(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,r){var o=r(8),i=r(7).RegExp;t.UNSUPPORTED_Y=o((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),t.BROKEN_CARET=o((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},function(e,t,r){"use strict";var o,i,n,s=r(8),a=r(90),c=r(28),d=r(16),l=r(12),u=r(17),h=l("iterator"),p=!1;[].keys&&("next"in(n=[].keys())?(i=a(a(n)))!==Object.prototype&&(o=i):p=!0);var f=null==o||s((function(){var e={};return o[h].call(e)!==e}));f&&(o={}),u&&!f||d(o,h)||c(o,h,(function(){return this})),e.exports={IteratorPrototype:o,BUGGY_SAFARI_ITERATORS:p}},function(e,t,r){"use strict";var o=r(7),i=r(19),n=r(166),s=r(28),a=r(101),c=r(8),d=r(69),l=r(34),u=r(13),h=r(167),p=r(231),f=r(90),g=r(60),m=r(59).f,_=r(18).f,v=r(116),E=r(54),y=r(36),S=y.get,T=y.set,b=o.ArrayBuffer,R=b,C=o.DataView,I=C&&C.prototype,O=Object.prototype,L=o.RangeError,w=p.pack,M=p.unpack,A=function(e){return[255&e]},N=function(e){return[255&e,e>>8&255]},k=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},P=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},x=function(e){return w(e,23,4)},D=function(e){return w(e,52,8)},U=function(e,t){_(e.prototype,t,{get:function(){return S(this)[t]}})},B=function(e,t,r,o){var i=h(r),n=S(e);if(i+t>n.byteLength)throw L("Wrong index");var s=S(n.buffer).bytes,a=i+n.byteOffset,c=s.slice(a,a+t);return o?c:c.reverse()},Z=function(e,t,r,o,i,n){var s=h(r),a=S(e);if(s+t>a.byteLength)throw L("Wrong index");for(var c=S(a.buffer).bytes,d=s+a.byteOffset,l=o(+i),u=0;u<t;u++)c[d+u]=l[n?u:t-u-1]};if(n){if(!c((function(){b(1)}))||!c((function(){new b(-1)}))||c((function(){return new b,new b(1.5),new b(NaN),"ArrayBuffer"!=b.name}))){for(var H,G=(R=function(e){return d(this,R),new b(h(e))}).prototype=b.prototype,W=m(b),z=0;W.length>z;)(H=W[z++])in R||s(R,H,b[H]);G.constructor=R}g&&f(I)!==O&&g(I,O);var q=new C(new R(2)),j=I.setInt8;q.setInt8(0,2147483648),q.setInt8(1,2147483649),!q.getInt8(0)&&q.getInt8(1)||a(I,{setInt8:function(e,t){j.call(this,e,t<<24>>24)},setUint8:function(e,t){j.call(this,e,t<<24>>24)}},{unsafe:!0})}else R=function(e){d(this,R,"ArrayBuffer");var t=h(e);T(this,{bytes:v.call(new Array(t),0),byteLength:t}),i||(this.byteLength=t)},C=function(e,t,r){d(this,C,"DataView"),d(e,R,"DataView");var o=S(e).byteLength,n=l(t);if(n<0||n>o)throw L("Wrong offset");if(n+(r=void 0===r?o-n:u(r))>o)throw L("Wrong length");T(this,{buffer:e,byteLength:r,byteOffset:n}),i||(this.buffer=e,this.byteLength=r,this.byteOffset=n)},i&&(U(R,"byteLength"),U(C,"buffer"),U(C,"byteLength"),U(C,"byteOffset")),a(C.prototype,{getInt8:function(e){return B(this,1,e)[0]<<24>>24},getUint8:function(e){return B(this,1,e)[0]},getInt16:function(e){var t=B(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=B(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return P(B(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return P(B(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return M(B(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return M(B(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Z(this,1,e,A,t)},setUint8:function(e,t){Z(this,1,e,A,t)},setInt16:function(e,t){Z(this,2,e,N,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Z(this,2,e,N,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Z(this,4,e,k,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Z(this,4,e,k,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Z(this,4,e,x,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Z(this,8,e,D,t,arguments.length>2?arguments[2]:void 0)}});E(R,"ArrayBuffer"),E(C,"DataView"),e.exports={ArrayBuffer:R,DataView:C}},function(e,t){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},function(e,t,r){var o=r(34),i=r(13);e.exports=function(e){if(void 0===e)return 0;var t=o(e),r=i(t);if(t!==r)throw RangeError("Wrong length or index");return r}},function(e,t,r){var o=r(233);e.exports=function(e,t){var r=o(e);if(r%t)throw RangeError("Wrong offset");return r}},function(e,t,r){"use strict";var o=r(22).forEach,i=r(66)("forEach");e.exports=i?[].forEach:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,r){"use strict";var o=r(25),i=r(10),n=r(21),s=r(8),a=r(162),c=RegExp.prototype,d=c.toString,l=s((function(){return"/a/b"!=d.call({source:"a",flags:"b"})})),u="toString"!=d.name;(l||u)&&o(RegExp.prototype,"toString",(function(){var e=i(this),t=n(e.source),r=e.flags;return"/"+t+"/"+n(void 0===r&&e instanceof RegExp&&!("flags"in c)?a.call(e):r)}),{unsafe:!0})},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,r){var o=r(12);t.f=o},function(e,t,r){var o=r(237),i=r(16),n=r(172),s=r(18).f;e.exports=function(e){var t=o.Symbol||(o.Symbol={});i(t,e)||s(t,e,{value:n.f(e)})}},function(e,t,r){"use strict";var o=r(5),i=r(8),n=r(81),s=r(14),a=r(20),c=r(13),d=r(104),l=r(119),u=r(88),h=r(12),p=r(68),f=h("isConcatSpreadable"),g=p>=51||!i((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),m=u("concat"),_=function(e){if(!s(e))return!1;var t=e[f];return void 0!==t?!!t:n(e)};o({target:"Array",proto:!0,forced:!g||!m},{concat:function(e){var t,r,o,i,n,s=a(this),u=l(s,0),h=0;for(t=-1,o=arguments.length;t<o;t++)if(_(n=-1===t?s:arguments[t])){if(h+(i=c(n.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(r=0;r<i;r++,h++)r in n&&d(u,h,n[r])}else{if(h>=9007199254740991)throw TypeError("Maximum allowed index exceeded");d(u,h++,n)}return u.length=h,u}})},function(e,t,r){var o=r(5),i=r(80),n=r(14),s=r(16),a=r(18).f,c=r(59),d=r(178),l=r(79),u=r(219),h=!1,p=l("meta"),f=0,g=Object.isExtensible||function(){return!0},m=function(e){a(e,p,{value:{objectID:"O"+f++,weakData:{}}})},_=e.exports={enable:function(){_.enable=function(){},h=!0;var e=c.f,t=[].splice,r={};r[p]=1,e(r).length&&(c.f=function(r){for(var o=e(r),i=0,n=o.length;i<n;i++)if(o[i]===p){t.call(o,i,1);break}return o},o({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:d.f}))},fastKey:function(e,t){if(!n(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,p)){if(!g(e))return"F";if(!t)return"E";m(e)}return e[p].objectID},getWeakData:function(e,t){if(!s(e,p)){if(!g(e))return!0;if(!t)return!1;m(e)}return e[p].weakData},onFreeze:function(e){return u&&h&&g(e)&&!s(e,p)&&m(e),e}};i[p]=!0},function(e,t,r){var o=r(35);e.exports=o("document","documentElement")},function(e,t,r){var o=r(14),i=r(58),n=r(12)("match");e.exports=function(e){var t;return o(e)&&(void 0!==(t=e[n])?!!t:"RegExp"==i(e))}},function(e,t,r){var o=r(39),i=r(59).f,n={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==n.call(e)?function(e){try{return i(e)}catch(e){return s.slice()}}(e):i(o(e))}},function(e,t,r){e.exports=r(263)},function(e,t,r){var o=r(14),i=r(67),n=r(223),s=r(12)("toPrimitive");e.exports=function(e,t){if(!o(e)||i(e))return e;var r,a=e[s];if(void 0!==a){if(void 0===t&&(t="default"),r=a.call(e,t),!o(r)||i(r))return r;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}},function(e,t,r){"use strict";var o=r(19),i=r(8),n=r(92),s=r(111),a=r(98),c=r(20),d=r(76),l=Object.assign,u=Object.defineProperty;e.exports=!l||i((function(){if(o&&1!==l({b:1},l(u({},"a",{enumerable:!0,get:function(){u(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol();return e[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=l({},e)[r]||"abcdefghijklmnopqrst"!=n(l({},t)).join("")}))?function(e,t){for(var r=c(e),i=arguments.length,l=1,u=s.f,h=a.f;i>l;)for(var p,f=d(arguments[l++]),g=u?n(f).concat(u(f)):n(f),m=g.length,_=0;m>_;)p=g[_++],o&&!h.call(f,p)||(r[p]=f[p]);return r}:l},function(e,t,r){var o=r(19),i=r(18),n=r(10),s=r(92);e.exports=o?Object.defineProperties:function(e,t){n(e);for(var r,o=s(t),a=o.length,c=0;a>c;)i.f(e,r=o[c++],t[r]);return e}},function(e,t,r){"use strict";var o=r(164).IteratorPrototype,i=r(47),n=r(55),s=r(54),a=r(78),c=function(){return this};e.exports=function(e,t,r){var d=t+" Iterator";return e.prototype=i(o,{next:n(1,r)}),s(e,d,!1,!0),a[d]=c,e}},function(e,t){var r=Math.floor,o=function(e,t){var s=e.length,a=r(s/2);return s<8?i(e,t):n(o(e.slice(0,a),t),o(e.slice(a),t),t)},i=function(e,t){for(var r,o,i=e.length,n=1;n<i;){for(o=n,r=e[n];o&&t(e[o-1],r)>0;)e[o]=e[--o];o!==n++&&(e[o]=r)}return e},n=function(e,t,r){for(var o=e.length,i=t.length,n=0,s=0,a=[];n<o||s<i;)n<o&&s<i?a.push(r(e[n],t[s])<=0?e[n++]:t[s++]):a.push(n<o?e[n++]:t[s++]);return a};e.exports=o},function(e,t,r){var o=r(46).match(/firefox\/(\d+)/i);e.exports=!!o&&+o[1]},function(e,t,r){var o=r(46);e.exports=/MSIE|Trident/.test(o)},function(e,t,r){var o=r(46).match(/AppleWebKit\/(\d+)\./);e.exports=!!o&&+o[1]},function(e,t,r){r(5)({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},function(e,t,r){"use strict";var o=r(5),i=r(34),n=r(322),s=r(220),a=r(8),c=1..toFixed,d=Math.floor,l=function(e,t,r){return 0===t?r:t%2==1?l(e,t-1,r*e):l(e*e,t/2,r)},u=function(e,t,r){for(var o=-1,i=r;++o<6;)i+=t*e[o],e[o]=i%1e7,i=d(i/1e7)},h=function(e,t){for(var r=6,o=0;--r>=0;)o+=e[r],e[r]=d(o/t),o=o%t*1e7},p=function(e){for(var t=6,r="";--t>=0;)if(""!==r||0===t||0!==e[t]){var o=String(e[t]);r=""===r?o:r+s.call("0",7-o.length)+o}return r};o({target:"Number",proto:!0,forced:c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!a((function(){c.call({})}))},{toFixed:function(e){var t,r,o,a,c=n(this),d=i(e),f=[0,0,0,0,0,0],g="",m="0";if(d<0||d>20)throw RangeError("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(g="-",c=-c),c>1e-21)if(r=(t=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t}(c*l(2,69,1))-69)<0?c*l(2,-t,1):c/l(2,t,1),r*=4503599627370496,(t=52-t)>0){for(u(f,0,r),o=d;o>=7;)u(f,1e7,0),o-=7;for(u(f,l(10,o,1),0),o=t-1;o>=23;)h(f,1<<23),o-=23;h(f,1<<o),u(f,1,1),h(f,2),m=p(f)}else u(f,0,r),u(f,1<<-t,0),m=p(f)+s.call("0",d);return m=d>0?g+((a=m.length)<=d?"0."+s.call("0",d-a)+m:m.slice(0,a-d)+"."+m.slice(a-d)):g+m}})},function(e,t,r){"use strict";var o=r(5),i=r(26),n=r(20),s=r(13),a=r(21),c=r(8),d=r(184),l=r(66),u=r(185),h=r(186),p=r(68),f=r(187),g=[],m=g.sort,_=c((function(){g.sort(void 0)})),v=c((function(){g.sort(null)})),E=l("sort"),y=!c((function(){if(p)return p<70;if(!(u&&u>3)){if(h)return!0;if(f)return f<603;var e,t,r,o,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(o=0;o<47;o++)g.push({k:t+o,v:r})}for(g.sort((function(e,t){return t.v-e.v})),o=0;o<g.length;o++)t=g[o].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));o({target:"Array",proto:!0,forced:_||!v||!E||!y},{sort:function(e){void 0!==e&&i(e);var t=n(this);if(y)return void 0===e?m.call(t):m.call(t,e);var r,o,c=[],l=s(t.length);for(o=0;o<l;o++)o in t&&c.push(t[o]);for(r=(c=d(c,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:a(t)>a(r)?1:-1}}(e))).length,o=0;o<r;)t[o]=c[o++];for(;o<l;)delete t[o++];return t}})},function(e,t,r){"use strict";var o=r(5),i=r(7),n=r(19),s=r(192),a=r(11),c=r(165),d=r(69),l=r(55),u=r(28),h=r(213),p=r(13),f=r(167),g=r(168),m=r(77),_=r(16),v=r(83),E=r(14),y=r(67),S=r(47),T=r(60),b=r(59).f,R=r(193),C=r(22).forEach,I=r(125),O=r(18),L=r(64),w=r(36),M=r(127),A=w.get,N=w.set,k=O.f,P=L.f,x=Math.round,D=i.RangeError,U=c.ArrayBuffer,B=c.DataView,Z=a.NATIVE_ARRAY_BUFFER_VIEWS,H=a.TYPED_ARRAY_CONSTRUCTOR,G=a.TYPED_ARRAY_TAG,W=a.TypedArray,z=a.TypedArrayPrototype,q=a.aTypedArrayConstructor,j=a.isTypedArray,V=function(e,t){for(var r=0,o=t.length,i=new(q(e))(o);o>r;)i[r]=t[r++];return i},F=function(e,t){k(e,t,{get:function(){return A(this)[t]}})},Y=function(e){var t;return e instanceof U||"ArrayBuffer"==(t=v(e))||"SharedArrayBuffer"==t},X=function(e,t){return j(e)&&!y(t)&&t in e&&h(+t)&&t>=0},J=function(e,t){return t=m(t),X(e,t)?l(2,e[t]):P(e,t)},K=function(e,t,r){return t=m(t),!(X(e,t)&&E(r)&&_(r,"value"))||_(r,"get")||_(r,"set")||r.configurable||_(r,"writable")&&!r.writable||_(r,"enumerable")&&!r.enumerable?k(e,t,r):(e[t]=r.value,e)};n?(Z||(L.f=J,O.f=K,F(z,"buffer"),F(z,"byteOffset"),F(z,"byteLength"),F(z,"length")),o({target:"Object",stat:!0,forced:!Z},{getOwnPropertyDescriptor:J,defineProperty:K}),e.exports=function(e,t,r){var n=e.match(/\d+$/)[0]/8,a=e+(r?"Clamped":"")+"Array",c="get"+e,l="set"+e,h=i[a],m=h,_=m&&m.prototype,v={},y=function(e,t){k(e,t,{get:function(){return function(e,t){var r=A(e);return r.view[c](t*n+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,o){var i=A(e);r&&(o=(o=x(o))<0?0:o>255?255:255&o),i.view[l](t*n+i.byteOffset,o,!0)}(this,t,e)},enumerable:!0})};Z?s&&(m=t((function(e,t,r,o){return d(e,m,a),M(E(t)?Y(t)?void 0!==o?new h(t,g(r,n),o):void 0!==r?new h(t,g(r,n)):new h(t):j(t)?V(m,t):R.call(m,t):new h(f(t)),e,m)})),T&&T(m,W),C(b(h),(function(e){e in m||u(m,e,h[e])})),m.prototype=_):(m=t((function(e,t,r,o){d(e,m,a);var i,s,c,l=0,u=0;if(E(t)){if(!Y(t))return j(t)?V(m,t):R.call(m,t);i=t,u=g(r,n);var h=t.byteLength;if(void 0===o){if(h%n)throw D("Wrong length");if((s=h-u)<0)throw D("Wrong length")}else if((s=p(o)*n)+u>h)throw D("Wrong length");c=s/n}else c=f(t),i=new U(s=c*n);for(N(e,{buffer:i,byteOffset:u,byteLength:s,length:c,view:new B(i)});l<c;)y(e,l++)})),T&&T(m,W),_=m.prototype=S(z)),_.constructor!==m&&u(_,"constructor",m),u(_,H,m),G&&u(_,G,a),v[a]=m,o({global:!0,forced:m!=h,sham:!Z},v),"BYTES_PER_ELEMENT"in m||u(m,"BYTES_PER_ELEMENT",n),"BYTES_PER_ELEMENT"in _||u(_,"BYTES_PER_ELEMENT",n),I(a)}):e.exports=function(){}},function(e,t,r){var o=r(7),i=r(8),n=r(102),s=r(11).NATIVE_ARRAY_BUFFER_VIEWS,a=o.ArrayBuffer,c=o.Int8Array;e.exports=!s||!i((function(){c(1)}))||!i((function(){new c(-1)}))||!n((function(e){new c,new c(null),new c(1.5),new c(e)}),!0)||i((function(){return 1!==new c(new a(2),1,void 0).length}))},function(e,t,r){var o=r(20),i=r(13),n=r(103),s=r(85),a=r(124),c=r(30),d=r(11).aTypedArrayConstructor;e.exports=function(e){var t,r,l,u,h,p,f=o(e),g=arguments.length,m=g>1?arguments[1]:void 0,_=void 0!==m,v=s(f);if(null!=v&&!a(v))for(p=(h=n(f,v)).next,f=[];!(u=p.call(h)).done;)f.push(u.value);for(_&&g>2&&(m=c(m,arguments[2],2)),r=i(f.length),l=new(d(this))(r),t=0;r>t;t++)l[t]=_?m(f[t],t):f[t];return l}},function(e,t,r){"use strict";var o=r(39),i=r(34),n=r(13),s=r(66),a=Math.min,c=[].lastIndexOf,d=!!c&&1/[1].lastIndexOf(1,-0)<0,l=s("lastIndexOf"),u=d||!l;e.exports=u?function(e){if(d)return c.apply(this,arguments)||0;var t=o(this),r=n(t.length),s=r-1;for(arguments.length>1&&(s=a(s,i(arguments[1]))),s<0&&(s=r+s);s>=0;s--)if(s in t&&t[s]===e)return s||0;return-1}:c},function(e,t,r){var o=r(10);e.exports=function(e,t,r){var i,n;o(e);try{if(void 0===(i=e.return)){if("throw"===t)throw r;return r}i=i.call(e)}catch(e){n=!0,i=e}if("throw"===t)throw r;if(n)throw i;return o(i),r}},function(e,t,r){var o,i,n,s,a=r(7),c=r(8),d=r(30),l=r(176),u=r(113),h=r(197),p=r(126),f=a.setImmediate,g=a.clearImmediate,m=a.process,_=a.MessageChannel,v=a.Dispatch,E=0,y={};try{o=a.location}catch(e){}var S=function(e){if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},T=function(e){return function(){S(e)}},b=function(e){S(e.data)},R=function(e){a.postMessage(String(e),o.protocol+"//"+o.host)};f&&g||(f=function(e){for(var t=[],r=arguments.length,o=1;r>o;)t.push(arguments[o++]);return y[++E]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},i(E),E},g=function(e){delete y[e]},p?i=function(e){m.nextTick(T(e))}:v&&v.now?i=function(e){v.now(T(e))}:_&&!h?(s=(n=new _).port2,n.port1.onmessage=b,i=d(s.postMessage,s,1)):a.addEventListener&&"function"==typeof postMessage&&!a.importScripts&&o&&"file:"!==o.protocol&&!c(R)?(i=R,a.addEventListener("message",b,!1)):i="onreadystatechange"in u("script")?function(e){l.appendChild(u("script")).onreadystatechange=function(){l.removeChild(this),S(e)}}:function(e){setTimeout(T(e),0)}),e.exports={set:f,clear:g}},function(e,t,r){var o=r(46);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(o)},function(e,t,r){"use strict";var o=r(26),i=function(e){var t,r;this.promise=new e((function(e,o){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=o})),this.resolve=o(t),this.reject=o(r)};e.exports.f=function(e){return new i(e)}},function(e,t,r){"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),o=0;o<r.length;o++)r[o]=arguments[o];return e.apply(t,r)}}},function(e,t,r){"use strict";var o=r(33);function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(o.isURLSearchParams(t))n=t.toString();else{var s=[];o.forEach(t,(function(e,t){null!=e&&(o.isArray(e)?t+="[]":e=[e],o.forEach(e,(function(e){o.isDate(e)?e=e.toISOString():o.isObject(e)&&(e=JSON.stringify(e)),s.push(i(t)+"="+i(e))})))})),n=s.join("&")}if(n){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}},function(e,t,r){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,r){"use strict";(function(t){var o=r(33),i=r(268),n={"Content-Type":"application/x-www-form-urlencoded"};function s(e,t){!o.isUndefined(e)&&o.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var a,c={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(a=r(204)),a),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),o.isFormData(e)||o.isArrayBuffer(e)||o.isBuffer(e)||o.isStream(e)||o.isFile(e)||o.isBlob(e)?e:o.isArrayBufferView(e)?e.buffer:o.isURLSearchParams(e)?(s(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):o.isObject(e)?(s(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};c.headers={common:{Accept:"application/json, text/plain, */*"}},o.forEach(["delete","get","head"],(function(e){c.headers[e]={}})),o.forEach(["post","put","patch"],(function(e){c.headers[e]=o.merge(n)})),e.exports=c}).call(this,r(203))},function(e,t){var r,o,i=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===n||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:n}catch(e){r=n}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var c,d=[],l=!1,u=-1;function h(){l&&c&&(l=!1,c.length?d=c.concat(d):u=-1,d.length&&p())}function p(){if(!l){var e=a(h);l=!0;for(var t=d.length;t;){for(c=d,d=[];++u<t;)c&&c[u].run();u=-1,t=d.length}c=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new f(e,t)),1!==d.length||l||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";var o=r(33),i=r(269),n=r(200),s=r(271),a=r(274),c=r(275),d=r(205);e.exports=function(e){return new Promise((function(t,l){var u=e.data,h=e.headers;o.isFormData(u)&&delete h["Content-Type"];var p=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",g=e.auth.password||"";h.Authorization="Basic "+btoa(f+":"+g)}var m=s(e.baseURL,e.url);if(p.open(e.method.toUpperCase(),n(m,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,p.onreadystatechange=function(){if(p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in p?a(p.getAllResponseHeaders()):null,o={data:e.responseType&&"text"!==e.responseType?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:r,config:e,request:p};i(t,l,o),p=null}},p.onabort=function(){p&&(l(d("Request aborted",e,"ECONNABORTED",p)),p=null)},p.onerror=function(){l(d("Network Error",e,null,p)),p=null},p.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),l(d(t,e,"ECONNABORTED",p)),p=null},o.isStandardBrowserEnv()){var _=r(276),v=(e.withCredentials||c(m))&&e.xsrfCookieName?_.read(e.xsrfCookieName):void 0;v&&(h[e.xsrfHeaderName]=v)}if("setRequestHeader"in p&&o.forEach(h,(function(e,t){void 0===u&&"content-type"===t.toLowerCase()?delete h[t]:p.setRequestHeader(t,e)})),o.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),e.responseType)try{p.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){p&&(p.abort(),l(e),p=null)})),void 0===u&&(u=null),p.send(u)}))}},function(e,t,r){"use strict";var o=r(270);e.exports=function(e,t,r,i,n){var s=new Error(e);return o(s,t,r,i,n)}},function(e,t,r){"use strict";var o=r(33);e.exports=function(e,t){t=t||{};var r={},i=["url","method","params","data"],n=["headers","auth","proxy"],s=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];o.forEach(i,(function(e){void 0!==t[e]&&(r[e]=t[e])})),o.forEach(n,(function(i){o.isObject(t[i])?r[i]=o.deepMerge(e[i],t[i]):void 0!==t[i]?r[i]=t[i]:o.isObject(e[i])?r[i]=o.deepMerge(e[i]):void 0!==e[i]&&(r[i]=e[i])})),o.forEach(s,(function(o){void 0!==t[o]?r[o]=t[o]:void 0!==e[o]&&(r[o]=e[o])}));var a=i.concat(n).concat(s),c=Object.keys(t).filter((function(e){return-1===a.indexOf(e)}));return o.forEach(c,(function(o){void 0!==t[o]?r[o]=t[o]:void 0!==e[o]&&(r[o]=e[o])})),r}},function(e,t,r){"use strict";function o(e){this.message=e}o.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},o.prototype.__CANCEL__=!0,e.exports=o},function(e,t,r){var o,i;"undefined"!=typeof self&&self,e.exports=(o=r(298),i=r(299),function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.E_CLIENT_TYPE=t.getSeq=t.ENUM_LOG_LEVEL=t.ENUM_REMOTE_TYPE=t.ZEGO_ENV=t.ZEGO_BROWSER_TYPE=void 0,function(e){e[e.IE=0]="IE",e[e.FIREFOX=1]="FIREFOX",e[e.CHROME=2]="CHROME",e[e.SAFARI=3]="SAFARI",e[e.OPERA=4]="OPERA",e[e.WEIXIN=5]="WEIXIN",e[e.WEIXINMINI=6]="WEIXINMINI",e[e.UNKOWN=7]="UNKOWN"}(t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={})),function(e){e[e.BROWSER=0]="BROWSER",e[e.WEIXINMINI=1]="WEIXINMINI"}(t.ZEGO_ENV||(t.ZEGO_ENV={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.HTTPS=2]="HTTPS"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},t.getSeq=(o=1,function(){return o++}),function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLogger=void 0;var o=r(2);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return o.ZegoLogger}})},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,i,n=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return s};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLogger=void 0;var c=r(3),d=r(0),l=r(4),u=r(5),h=r(6),p=r(9),f=r(10),g=function(){function e(e,t,r){this.env=e,this.product=t,this.logLevel=d.ENUM_LOG_LEVEL.INFO,this.logRemoteLevel=0,this.isDebug=!0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.tempBuffer=[],this.isUserIDExist=!1,this.uploadURL="http://106.14.207.58:8011/zglog/zip",this.uploading=!1,this.postFailCount=0,this.basePath="",this.filePath="",this.curFile=0,this.limitKeys={},this.limitMs=500,this.stateCenter=u.LoggerStateCenter.getInstance(),this.init(r)}return e.prototype.init=function(e){return i(this,void 0,void 0,(function(){var t=this;return n(this,(function(r){return this.env%2==0?(this.fileConfig=o(o({},l.WebFileConfig),e),this.storeHandler=new h.ZegoStoreHandler(this.product,this.fileConfig),this.storeHandler.setDataDroped((function(){t.headerInfo&&t.dumpData(t.headerInfo)}))):(this.fileConfig=o(o({},l.WechatFileConfig),e),this.basePath=wx.env.USER_DATA_PATH+"/logger",this.fileHandler=new p.ZegoFileHandler(this.product,this.fileConfig,(function(){t.bufferDump()}))),[2]}))}))},e.prototype.setLogLevel=function(e){var t=d.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logLevel=t,!0)},e.prototype.setRemoteLogLevel=function(e){var t=d.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logRemoteLevel=t,!0)},e.prototype.setDebugVerbose=function(e){this.stateCenter.debug=e},e.prototype.setHeaderInfo=function(e){this.headerInfo=e,!(this.env%2!=0||this.commonField&&"string"==typeof this.commonField.get("userID"))||this.env%2==1&&this.fileHandler&&!this.fileHandler.inited?this.tempBuffer.push(e):this.dumpData(e)},e.prototype.setLimitConfig=function(e){this.limitMs=e},e.prototype.setCommonField=function(e){return"[object Map]"===Object.prototype.toString.call(e)&&null!=e.get("userID")&&"string"==typeof e.get("userID")&&""!==e.get("userID")&&(this.commonField=e,this.bufferDump(),this.isUserIDExist=!0,!0)},e.prototype.write=function(e,t,r,o){var i=d.ENUM_LOG_LEVEL[t];if(void 0===i)return!1;var n=this.logParams(e,t,r,o);if(this.logLevel!==d.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i)switch(t){case"debug":case"report":case"info":case"warn":break;case"error":this.logError(n,o)}if(this.logRemoteLevel!==d.ENUM_LOG_LEVEL.DISABLE&&this.logRemoteLevel<=i){if(this.uploading)return this.tempBuffer.push(n),!0;if(this.env%2==0&&(!this.commonField||"string"!=typeof this.commonField.get("userID")))return this.tempBuffer.push(n),!0;if(this.env%2==1&&this.fileHandler&&!this.fileHandler.inited)return this.tempBuffer.push(n),!0;this.dumpData(n)}return!0},e.prototype.writeLimit=function(e,t,r,o,i){return this.limitKeys[e]?(new Date).getTime()-this.limitKeys[e]>this.limitMs&&(this.limitKeys[e]=(new Date).getTime(),this.write(t,r,o,i)):(this.limitKeys[e]=(new Date).getTime(),this.write(t,r,o,i))},e.prototype.upload=function(e){var t=this;return this.uploading=!0,this.setUploadState(!0),new Promise((function(r,o){e.uploadURL||(t.setUploadState(!1),o({code:1001})),t.env%2!=0||t.isUserIDExist||(t.setUploadState(!1),o({code:1001})),t.env%2==0?t.uploadWeb(e).then((function(e){t.setUploadState(!1),r(e)})).catch((function(e){t.setUploadState(!1),o(e)})):t.uploadWechatMini(e).then((function(e){t.setUploadState(!1),r(e)})).catch((function(e){t.setUploadState(!1),o(e)}))}))},e.prototype.setUploadState=function(e){this.env%2==0?this.storeHandler.setUploadState(e):wx.setStorageSync("uploading",!0)},e.prototype.getUploadState=function(){if(this.env%2==0)return this.storeHandler.getUploadState();try{return wx.getStorageSync("uploading")}catch(e){return!1}},e.prototype.uploadWeb=function(e){return i(this,void 0,void 0,(function(){var t=this;return n(this,(function(r){return[2,new Promise((function(r,o){return i(t,void 0,void 0,(function(){var t,s,a,c=this;return n(this,(function(d){switch(d.label){case 0:return[4,this.readData()];case 1:return null!==(t=d.sent())&&(s=(new Date).getTime()+"",(a=new FormData).append("logs",t),a.append("id_name",e.userID),a.append("appid",e.appID),a.append("timestamp",s),a.append("token",e.token),a.append("deviceid",e.deviceID||""),a.append("product",e.product),a.append("req_sdk","1"),this.postFile(e.uploadURL||this.uploadURL,a).then((function(){return i(c,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,this.storeHandler.clearStore()];case 1:return e.sent(),this.bufferDump(),this.uploading=!1,r({code:0}),[2]}}))}))})).catch((function(e){c.uploading=!1,o({code:e.code})}))),[2]}}))}))}))]}))}))},e.prototype.postFile=function(e,t){var r=this;return new Promise((function(o,i){f.postFile(e,t).then((function(e){o()})).catch((function(o){r.postFailCount++,4==o.code&&r.postFailCount<3?r.postFile(e,t):i(o)}))}))},e.prototype.bufferDump=function(){var e,t,r=this.tempBuffer.shift();if(r){var o="";if(this.env%2==0&&this.commonField&&"string"==typeof this.commonField.get("userID")&&""!==this.commonField.get("userID")){var i=r.indexOf("]:");if(-1==i)o=r;else{var n="";try{for(var c=s(this.commonField),d=c.next();!d.done;d=c.next()){var l=a(d.value,2);l[0],n+="["+l[1]+"]"}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}o=r.slice(0,i+2)+n+r.slice(i+2)}}else this.env%2==1&&(o=r);this.dumpData(o),this.bufferDump()}},e.prototype.uploadWechatMini=function(e){return i(this,void 0,void 0,(function(){var t=this;return n(this,(function(r){return[2,new Promise((function(r,o){return i(t,void 0,void 0,(function(){var t,s,a,c=this;return n(this,(function(d){switch(d.label){case 0:t=function(t){var a;return n(this,(function(d){switch(d.label){case 0:return a=s.basePath+"/"+e.product+t+".txt",[4,s.fileHandler.accessFile(a)];case 1:return d.sent()>0&&s.uploadFileWechat(e.uploadURL||s.uploadURL,a,e).then((function(){return i(c,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,this.fileHandler.delFile(a)];case 1:return e.sent(),[4,this.fileHandler.accessFile(a)];case 2:return e.sent(),this.bufferDump(),this.uploading=!1,r({code:0}),[2]}}))}))})).catch((function(e){c.uploading=!1,o({code:e.code})})),[2]}}))},s=this,a=0,d.label=1;case 1:return a<this.fileConfig.maxFiles?[5,t(a)]:[3,4];case 2:d.sent(),d.label=3;case 3:return a++,[3,1];case 4:return[2]}}))}))}))]}))}))},e.prototype.uploadFileWechat=function(e,t,r){var o=this;return new Promise((function(i,n){f.postFileWechat(e,t,r).then((function(e){i()})).catch((function(i){o.postFailCount++,4==i.code&&o.postFailCount<3?o.uploadFileWechat(e,t,r):n(i)}))}))},e.prototype.dumpData=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return this.env%2==0?this.writeDataStorage(e):this.writeFileWechat(e),[2]}))}))},e.prototype.readData=function(){return this.storeHandler.readData()},e.prototype.writeDataStorage=function(e){this.storeHandler.storeData(e)},e.prototype.writeFileWechat=function(e){this.fileHandler.storeData(e)},e.prototype.logParams=function(e,t,r,o){var i,n,d,l=c.getCurrentTime(),u=t.substr(0,1).toUpperCase(),h="";if(this.env%2==0&&this.commonField){var p="";try{for(var f=s(this.commonField),g=f.next();!g.done;g=f.next()){var m=a(g.value,2);m[0],p+="["+m[1]+"]"}}catch(e){i={error:e}}finally{try{g&&!g.done&&(n=f.return)&&n.call(f)}finally{if(i)throw i.error}}h=p}var _="";e.forEach((function(e){_+="["+e+"]"}));var v="";return"function"==typeof(null===(d=null===window||void 0===window?void 0:window.performance)||void 0===d?void 0:d.now)&&(v="["+window.performance.now().toFixed(1)+"]"),"["+l+"]"+v+"["+u+"]["+r+"]"+_+":"+h+o},e.prototype.logError=function(e,t){this.env%2==0?this.stateCenter.debug&&window.alert(t):this.stateCenter.debug&&wx.showModal({title:"",content:t})},e}();t.ZegoLogger=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTime=t.getCurrentEnv=t.getBrowser=void 0;var o=r(0);t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),i=null!=window.opr,n=e.indexOf("Chrome")&&window.chrome,s=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version"),a=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0];return t?o.ZEGO_BROWSER_TYPE.IE:r?o.ZEGO_BROWSER_TYPE.FIREFOX:i?o.ZEGO_BROWSER_TYPE.OPERA:n?o.ZEGO_BROWSER_TYPE.CHROME:s?o.ZEGO_BROWSER_TYPE.SAFARI:a?o.ZEGO_BROWSER_TYPE.WEIXIN:o.ZEGO_BROWSER_TYPE.UNKOWN},t.getCurrentEnv=function(){var e=window.navigator.userAgent;return new Promise((function(t){-1==e.indexOf("MicroMessage")?t(o.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv((function(e){e.miniprogram}))}))};var i=["00","01","02","03","04","05","06","07","08","09"];t.getCurrentTime=function(){var e=new Date;return[i[e.getMonth()+1]||e.getMonth()+1,(i[e.getDate()]||e.getDate())+" ",(i[e.getHours()]||e.getHours())+":",(i[e.getMinutes()]||e.getMinutes())+":",i[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WechatFileConfig=t.WebFileConfig=void 0,t.WebFileConfig={maxSize:5242880,maxFiles:3,dropPer:1},t.WechatFileConfig={maxSize:2097152,maxFiles:3,dropPer:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=void 0;var o=function(){function e(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}return e.getInstance=function(){return e.instance||(e.instance=new e,e.instance.init()),e.instance},e.prototype.init=function(){},Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._ENV},set:function(e){this._ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!1,configurable:!0}),e.instance=new e,e}();t.LoggerStateCenter=o},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStoreHandler=void 0;var s=r(7),a=r(0),c=n(r(8)),d=function(){function e(e,t){this.product=e,this.fileConfig=t,this.storeBuffer=[],this.droping=!1,this.init()}return e.prototype.init=function(){return o(this,void 0,void 0,(function(){var e,t=this;return i(this,(function(r){switch(r.label){case 0:this.storeCommon=s.createInstance({name:"logger_common"}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.storeCommon.getItem(this.product+"_logger")];case 2:return e=r.sent(),this.storeSize=e||0,[3,4];case 3:return r.sent(),[3,4];case 4:return this.store=s.createInstance({name:this.product+"_logger"}),this.storeBuffer.length>0&&this.storeBuffer.forEach((function(e){t.storeData(e)})),[2]}}))}))},e.prototype.setDataDroped=function(e){this.dataDropCallback=e},e.prototype.storeData=function(e){return o(this,void 0,void 0,(function(){var t,r;return i(this,(function(o){switch(o.label){case 0:if(!e)return[2,Promise.resolve()];if(!this.store)return this.storeBuffer.push(e),[2,Promise.resolve()];t=(new Date).getTime(),r=t+"_"+a.getSeq(),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.store.setItem(r,e)];case 2:return o.sent(),this.storeSize+=e.length+1,this.refreshStoreSize(),this.storeSize>=this.fileConfig.maxSize*this.fileConfig.maxFiles&&!this.droping&&this.dropData(),[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}}))}))},e.prototype.readData=function(){return o(this,void 0,void 0,(function(){var e,t,r,o,n,s,a=this;return i(this,(function(i){switch(i.label){case 0:e=new c.default,t=e.folder("log"),r="",o=0,n=0,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.store.iterate((function(e,i,s){r+=e+"\n",(o+=e.length+1)>a.fileConfig.maxSize&&(n++,r="",o=0),t&&t.file(""+a.product+n+".txt",r)}))];case 2:case 3:return i.sent(),[3,4];case 4:return i.trys.push([4,6,,7]),[4,e.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})];case 5:return s=i.sent(),[2,new Blob([s])];case 6:return i.sent(),[2,null];case 7:return[2]}}))}))},e.prototype.clearStore=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.store.clear()];case 1:return e.sent(),this.storeSize=0,this.refreshStoreSize(),[3,3];case 2:return e.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.refreshStoreSize=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.storeCommon.setItem(this.product+"_logger",this.storeSize)];case 1:return e.sent(),[2]}}))}))},e.prototype.dropData=function(){return o(this,void 0,void 0,(function(){var e,t,r,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,8,,9]),this.droping=!0,[4,this.store.keys()];case 1:e=i.sent(),t=0,r=0,i.label=2;case 2:return r<e.length?[4,this.store.getItem(e[r])]:[3,7];case 3:return(o=i.sent())?(t+=o.length+1)<this.fileConfig.maxSize*this.fileConfig.dropPer?[4,this.store.removeItem(e[r])]:[3,5]:[3,6];case 4:return i.sent(),this.storeSize-=o.length+1,this.refreshStoreSize(),[3,6];case 5:return this.droping=!1,this.dataDropCallback(),[3,7];case 6:return r++,[3,2];case 7:return[3,9];case 8:return i.sent(),[3,9];case 9:return[2]}}))}))},e.prototype.setUploadState=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.storeCommon?[4,this.storeCommon.setItem("uploading",e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.getUploadState=function(){if(this.storeCommon)return this.storeCommon.getItem("uploading")},e}();t.ZegoStoreHandler=d},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoFileHandler=void 0;var n=function(){function e(e,t,r){this.product=e,this.fileConfig=t,this.initCallback=r,this.basePath="",this.filePath="",this.curFile=0,this.inited=!1,this.init()}return e.prototype.init=function(){return o(this,void 0,void 0,(function(){var e,t;return i(this,(function(r){switch(r.label){case 0:this.basePath=wx.env.USER_DATA_PATH+"/logger",this.fileManager=wx.getFileSystemManager(),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.accessDir(this.basePath)];case 2:return r.sent(),[3,4];case 3:return r.sent(),[2];case 4:this.fileManager.readdir({dirPath:this.basePath,success:function(e){},fail:function(e){}}),e=0,r.label=5;case 5:if(!(e<this.fileConfig.maxFiles))return[3,10];t=this.basePath+"/"+this.product+e+".txt",r.label=6;case 6:return r.trys.push([6,8,,9]),[4,this.accessFile(t)];case 7:return r.sent()<this.fileConfig.maxSize?(this.filePath=t,this.curFile=e,[3,10]):[3,9];case 8:return r.sent(),[3,9];case 9:return e++,[3,5];case 10:return this.filePath,this.inited=!0,this.initCallback&&this.initCallback(),[2]}}))}))},e.prototype.storeData=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:try{this.fileManager.appendFileSync(this.filePath,e+"\n")}catch(e){}return[4,this.getFileSize(this.filePath)];case 1:return t.sent()>=this.fileConfig.maxSize?(this.curFile++,this.curFile>=this.fileConfig.maxFiles&&(this.curFile=0),this.filePath=this.basePath+"/"+this.product+this.curFile+".txt",[4,this.accessFile(this.filePath)]):[3,4];case 2:return t.sent()>=this.fileConfig.maxSize?(this.fileManager.unlinkSync(this.filePath),[4,this.accessFile(this.filePath)]):[3,4];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},e.prototype.getFileSize=function(e){return new Promise((function(t,r){wx.getFileSystemManager().getFileInfo({filePath:e,success:function(e){t(e.size)},fail:function(e){r(e)}})}))},e.prototype.accessDir=function(e){var t=wx.getFileSystemManager();return new Promise((function(r,o){t.access({path:e,success:function(e){r()},fail:function(i){t.mkdir({dirPath:e,success:function(e){r()},fail:function(e){o(e)}})}})}))},e.prototype.accessFile=function(e){var t=this,r=wx.getFileSystemManager();return new Promise((function(n,s){r.access({path:e,success:function(r){return o(t,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return[4,this.getFileSize(e)];case 1:return t=r.sent(),n(t),[2]}}))}))},fail:function(t){r.writeFile({filePath:e,data:"",success:function(e){n(0)},fail:function(e){s(e)}})}})}))},e.prototype.delFile=function(e){var t=this;return new Promise((function(r,o){t.fileManager.unlink({filePath:e,success:function(e){r()},fail:function(e){o(e)}})}))},e}();t.ZegoFileHandler=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.postFileWechat=t.postFile=void 0;var o={code:1001,msg:"upload fail"};t.postFile=function(e,t){return new Promise((function(r,i){var n=new XMLHttpRequest;n.open("post",e),n.onreadystatechange=function(){if(4==n.readyState)if(n.status>=200&&n.status<300||304==n.status){var e=JSON.parse(n.responseText),t=e.code,s=e.message;0===t?r({code:t,msg:s}):i({code:t,msg:s})}else i(o)},n.send(t)}))},t.postFileWechat=function(e,t,r){return new Promise((function(i,n){var s=(new Date).getTime();wx.uploadFile({url:e,filePath:t,name:"logs",formData:{id_name:r.userID,appid:r.appID,timestamp:s+"",token:r.token,deviceid:"",product:r.product,req_sdk:"1"},success:function(e){var t=e.data;if(200===e.statusCode&&t)try{var r=JSON.parse(t),o=r.code,s=r.message;0===o?i({code:o,msg:s}):n({code:o,msg:s})}catch(e){n(e)}else n({code:e.statusCode,msg:"upload fail"})},fail:function(e){n(o)}})}))}}]))},function(e,t,r){(function(r){var o;!function(r,i){e.exports=function(r){"use strict";var i,n=(r=r||{}).Base64,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=function(e){for(var t={},r=0,o=e.length;r<o;r++)t[e.charAt(r)]=r;return t}(s),c=String.fromCharCode,d=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?c(192|t>>>6)+c(128|63&t):c(224|t>>>12&15)+c(128|t>>>6&63)+c(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return c(240|t>>>18&7)+c(128|t>>>12&63)+c(128|t>>>6&63)+c(128|63&t)},l=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,u=function(e){return e.replace(l,d)},h=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[s.charAt(r>>>18),s.charAt(r>>>12&63),t>=2?"=":s.charAt(r>>>6&63),t>=1?"=":s.charAt(63&r)].join("")},p=r.btoa&&"function"==typeof r.btoa?function(e){return r.btoa(e)}:function(e){if(e.match(/[^\x00-\xFF]/))throw new RangeError("The string contains invalid characters.");return e.replace(/[\s\S]{1,3}/g,h)},f=function(e){return p(u(String(e)))},g=function(e){return e.replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"})).replace(/=/g,"")},m=function(e,t){return t?g(f(e)):f(e)};r.Uint8Array&&(i=function(e,t){for(var r="",o=0,i=e.length;o<i;o+=3){var n=e[o],a=e[o+1],c=e[o+2],d=n<<16|a<<8|c;r+=s.charAt(d>>>18)+s.charAt(d>>>12&63)+(void 0!==a?s.charAt(d>>>6&63):"=")+(void 0!==c?s.charAt(63&d):"=")}return t?g(r):r});var _,v=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,E=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return c(55296+(t>>>10))+c(56320+(1023&t));case 3:return c((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return c((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},y=function(e){return e.replace(v,E)},S=function(e){var t=e.length,r=t%4,o=(t>0?a[e.charAt(0)]<<18:0)|(t>1?a[e.charAt(1)]<<12:0)|(t>2?a[e.charAt(2)]<<6:0)|(t>3?a[e.charAt(3)]:0),i=[c(o>>>16),c(o>>>8&255),c(255&o)];return i.length-=[0,0,2,1][r],i.join("")},T=r.atob&&"function"==typeof r.atob?function(e){return r.atob(e)}:function(e){return e.replace(/\S{1,4}/g,S)},b=function(e){return T(String(e).replace(/[^A-Za-z0-9\+\/]/g,""))},R=function(e){return String(e).replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,"")},C=function(e){return function(e){return y(T(e))}(R(e))};r.Uint8Array&&(_=function(e){return Uint8Array.from(b(R(e)),(function(e){return e.charCodeAt(0)}))});var I=function(){var e=r.Base64;return r.Base64=n,e};if(r.Base64={VERSION:"2.6.4",atob:b,btoa:p,fromBase64:C,toBase64:m,utob:u,encode:m,encodeURI:function(e){return m(e,!0)},btou:y,decode:C,noConflict:I,fromUint8Array:i,toUint8Array:_},"function"==typeof Object.defineProperty){var O=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};r.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",O((function(){return C(this)}))),Object.defineProperty(String.prototype,"toBase64",O((function(e){return m(this,e)}))),Object.defineProperty(String.prototype,"toBase64URI",O((function(){return m(this,!0)})))}}r.Meteor&&(Base64=r.Base64);e.exports?e.exports.Base64=r.Base64:void 0===(o=function(){return r.Base64}.apply(t,[]))||(e.exports=o);return{Base64:r.Base64}}(r)}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:this)}).call(this,r(61))},function(e,t,r){var o;e.exports=(o=r(43),r(217),r(218),o.HmacSHA1)},function(e,t,r){e.exports=function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],o=e[1],i=e[2],n=e[3];o=((o+=((i=((i+=((n=((n+=((r=((r+=(o&i|~o&n)+t[0]-680876936|0)<<7|r>>>25)+o|0)&o|~r&i)+t[1]-389564586|0)<<12|n>>>20)+r|0)&r|~n&o)+t[2]+606105819|0)<<17|i>>>15)+n|0)&n|~i&r)+t[3]-1044525330|0)<<22|o>>>10)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o&i|~o&n)+t[4]-176418897|0)<<7|r>>>25)+o|0)&o|~r&i)+t[5]+1200080426|0)<<12|n>>>20)+r|0)&r|~n&o)+t[6]-1473231341|0)<<17|i>>>15)+n|0)&n|~i&r)+t[7]-45705983|0)<<22|o>>>10)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o&i|~o&n)+t[8]+1770035416|0)<<7|r>>>25)+o|0)&o|~r&i)+t[9]-1958414417|0)<<12|n>>>20)+r|0)&r|~n&o)+t[10]-42063|0)<<17|i>>>15)+n|0)&n|~i&r)+t[11]-1990404162|0)<<22|o>>>10)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o&i|~o&n)+t[12]+1804603682|0)<<7|r>>>25)+o|0)&o|~r&i)+t[13]-40341101|0)<<12|n>>>20)+r|0)&r|~n&o)+t[14]-1502002290|0)<<17|i>>>15)+n|0)&n|~i&r)+t[15]+1236535329|0)<<22|o>>>10)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o&n|i&~n)+t[1]-165796510|0)<<5|r>>>27)+o|0)&i|o&~i)+t[6]-1069501632|0)<<9|n>>>23)+r|0)&o|r&~o)+t[11]+643717713|0)<<14|i>>>18)+n|0)&r|n&~r)+t[0]-373897302|0)<<20|o>>>12)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o&n|i&~n)+t[5]-701558691|0)<<5|r>>>27)+o|0)&i|o&~i)+t[10]+38016083|0)<<9|n>>>23)+r|0)&o|r&~o)+t[15]-660478335|0)<<14|i>>>18)+n|0)&r|n&~r)+t[4]-405537848|0)<<20|o>>>12)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o&n|i&~n)+t[9]+568446438|0)<<5|r>>>27)+o|0)&i|o&~i)+t[14]-1019803690|0)<<9|n>>>23)+r|0)&o|r&~o)+t[3]-187363961|0)<<14|i>>>18)+n|0)&r|n&~r)+t[8]+1163531501|0)<<20|o>>>12)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o&n|i&~n)+t[13]-1444681467|0)<<5|r>>>27)+o|0)&i|o&~i)+t[2]-51403784|0)<<9|n>>>23)+r|0)&o|r&~o)+t[7]+1735328473|0)<<14|i>>>18)+n|0)&r|n&~r)+t[12]-1926607734|0)<<20|o>>>12)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o^i^n)+t[5]-378558|0)<<4|r>>>28)+o|0)^o^i)+t[8]-2022574463|0)<<11|n>>>21)+r|0)^r^o)+t[11]+1839030562|0)<<16|i>>>16)+n|0)^n^r)+t[14]-35309556|0)<<23|o>>>9)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o^i^n)+t[1]-1530992060|0)<<4|r>>>28)+o|0)^o^i)+t[4]+1272893353|0)<<11|n>>>21)+r|0)^r^o)+t[7]-155497632|0)<<16|i>>>16)+n|0)^n^r)+t[10]-1094730640|0)<<23|o>>>9)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o^i^n)+t[13]+681279174|0)<<4|r>>>28)+o|0)^o^i)+t[0]-358537222|0)<<11|n>>>21)+r|0)^r^o)+t[3]-722521979|0)<<16|i>>>16)+n|0)^n^r)+t[6]+76029189|0)<<23|o>>>9)+i|0,o=((o+=((i=((i+=((n=((n+=((r=((r+=(o^i^n)+t[9]-640364487|0)<<4|r>>>28)+o|0)^o^i)+t[12]-421815835|0)<<11|n>>>21)+r|0)^r^o)+t[15]+530742520|0)<<16|i>>>16)+n|0)^n^r)+t[2]-995338651|0)<<23|o>>>9)+i|0,o=((o+=((n=((n+=(o^((r=((r+=(i^(o|~n))+t[0]-198630844|0)<<6|r>>>26)+o|0)|~i))+t[7]+1126891415|0)<<10|n>>>22)+r|0)^((i=((i+=(r^(n|~o))+t[14]-1416354905|0)<<15|i>>>17)+n|0)|~r))+t[5]-57434055|0)<<21|o>>>11)+i|0,o=((o+=((n=((n+=(o^((r=((r+=(i^(o|~n))+t[12]+1700485571|0)<<6|r>>>26)+o|0)|~i))+t[3]-1894986606|0)<<10|n>>>22)+r|0)^((i=((i+=(r^(n|~o))+t[10]-1051523|0)<<15|i>>>17)+n|0)|~r))+t[1]-2054922799|0)<<21|o>>>11)+i|0,o=((o+=((n=((n+=(o^((r=((r+=(i^(o|~n))+t[8]+1873313359|0)<<6|r>>>26)+o|0)|~i))+t[15]-30611744|0)<<10|n>>>22)+r|0)^((i=((i+=(r^(n|~o))+t[6]-1560198380|0)<<15|i>>>17)+n|0)|~r))+t[13]+1309151649|0)<<21|o>>>11)+i|0,o=((o+=((n=((n+=(o^((r=((r+=(i^(o|~n))+t[4]-145523070|0)<<6|r>>>26)+o|0)|~i))+t[11]-1120210379|0)<<10|n>>>22)+r|0)^((i=((i+=(r^(n|~o))+t[2]+718787259|0)<<15|i>>>17)+n|0)|~r))+t[9]-343485551|0)<<21|o>>>11)+i|0,e[0]=r+e[0]|0,e[1]=o+e[1]|0,e[2]=i+e[2]|0,e[3]=n+e[3]|0}function o(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function i(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function n(e){var t,i,n,s,a,c,d=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=d;t+=64)r(l,o(e.substring(t-64,t)));for(i=(e=e.substring(t-64)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(r(l,n),t=0;t<16;t+=1)n[t]=0;return s=(s=8*d).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),c=parseInt(s[1],16)||0,n[14]=a,n[15]=c,r(l,n),l}function s(e){var r,o="";for(r=0;r<4;r+=1)o+=t[e>>8*r+4&15]+t[e>>8*r&15];return o}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function c(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function d(e){var t,r=[],o=e.length;for(t=0;t<o-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function l(){this.reset()}return a(n("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,o){var i,n,s,a,c=this.byteLength,d=t(r,c),l=c;return o!==e&&(l=t(o,c)),d>l?new ArrayBuffer(0):(i=l-d,n=new ArrayBuffer(i),s=new Uint8Array(n),a=new Uint8Array(this,d,i),s.set(a),n)}}(),l.prototype.append=function(e){return this.appendBinary(c(e)),this},l.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)r(this._hash,o(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},l.prototype.end=function(e){var t,r,o=this._buff,i=o.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)n[t>>2]|=o.charCodeAt(t)<<(t%4<<3);return this._finish(n,i),r=a(this._hash),e&&(r=d(r)),this.reset(),r},l.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},l.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},l.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},l.prototype._finish=function(e,t){var o,i,n,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(r(this._hash,e),s=0;s<16;s+=1)e[s]=0;o=(o=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(o[2],16),n=parseInt(o[1],16)||0,e[14]=i,e[15]=n,r(this._hash,e)},l.hash=function(e,t){return l.hashBinary(c(e),t)},l.hashBinary=function(e,t){var r=a(n(e));return t?d(r):r},l.ArrayBuffer=function(){this.reset()},l.ArrayBuffer.prototype.append=function(e){var t,o,n,s,a,c=(o=this._buff.buffer,n=e,s=!0,(a=new Uint8Array(o.byteLength+n.byteLength)).set(new Uint8Array(o)),a.set(new Uint8Array(n),o.byteLength),s?a:a.buffer),d=c.length;for(this._length+=e.byteLength,t=64;t<=d;t+=64)r(this._hash,i(c.subarray(t-64,t)));return this._buff=t-64<d?new Uint8Array(c.buffer.slice(t-64)):new Uint8Array(0),this},l.ArrayBuffer.prototype.end=function(e){var t,r,o=this._buff,i=o.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)n[t>>2]|=o[t]<<(t%4<<3);return this._finish(n,i),r=a(this._hash),e&&(r=d(r)),this.reset(),r},l.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.ArrayBuffer.prototype.getState=function(){var e,t=l.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},l.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var r,o=e.length,i=new ArrayBuffer(o),n=new Uint8Array(i);for(r=0;r<o;r+=1)n[r]=e.charCodeAt(r);return t?n:i}(e.buff,!0),l.prototype.setState.call(this,e)},l.ArrayBuffer.prototype.destroy=l.prototype.destroy,l.ArrayBuffer.prototype._finish=l.prototype._finish,l.ArrayBuffer.hash=function(e,t){var o=a(function(e){var t,o,n,s,a,c,d=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=d;t+=64)r(l,i(e.subarray(t-64,t)));for(e=t-64<d?e.subarray(t-64):new Uint8Array(0),o=e.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<o;t+=1)n[t>>2]|=e[t]<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(r(l,n),t=0;t<16;t+=1)n[t]=0;return s=(s=8*d).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),c=parseInt(s[1],16)||0,n[14]=a,n[15]=c,r(l,n),l}(new Uint8Array(e)));return t?d(o):o},l}()},,function(e,t,r){var o=r(14),i=Math.floor;e.exports=function(e){return!o(e)&&isFinite(e)&&i(e)===e}},function(e,t,r){var o=r(177);e.exports=function(e){if(o(e))throw TypeError("The method doesn't accept regular expressions");return e}},function(e,t,r){var o=r(12)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[o]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,r){"use strict";var o=r(120),i=r(10),n=r(13),s=r(21),a=r(37),c=r(121),d=r(123);o("match",(function(e,t,r){return[function(t){var r=a(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,r):new RegExp(t)[e](s(r))},function(e){var o=i(this),a=s(e),l=r(t,o,a);if(l.done)return l.value;if(!o.global)return d(o,a);var u=o.unicode;o.lastIndex=0;for(var h,p=[],f=0;null!==(h=d(o,a));){var g=s(h[0]);p[f]=g,""===g&&(o.lastIndex=c(a,n(o.lastIndex),u)),f++}return 0===f?null:p}]}))},function(e,t,r){var o,i,n,s,a,c,d,l;e.exports=(l=r(43),i=(o=l).lib,n=i.WordArray,s=i.Hasher,a=o.algo,c=[],d=a.SHA1=s.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,o=r[0],i=r[1],n=r[2],s=r[3],a=r[4],d=0;d<80;d++){if(d<16)c[d]=0|e[t+d];else{var l=c[d-3]^c[d-8]^c[d-14]^c[d-16];c[d]=l<<1|l>>>31}var u=(o<<5|o>>>27)+a+c[d];u+=d<20?1518500249+(i&n|~i&s):d<40?1859775393+(i^n^s):d<60?(i&n|i&s|n&s)-1894007588:(i^n^s)-899497514,a=s,s=n,n=i<<30|i>>>2,i=o,o=u}r[0]=r[0]+o|0,r[1]=r[1]+i|0,r[2]=r[2]+n|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(o+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),o.SHA1=s._createHelper(d),o.HmacSHA1=s._createHmacHelper(d),l.SHA1)},function(e,t,r){var o,i,n,s;e.exports=(o=r(43),n=(i=o).lib.Base,s=i.enc.Utf8,void(i.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var r=e.blockSize,o=4*r;t.sigBytes>o&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),n=this._iKey=t.clone(),a=i.words,c=n.words,d=0;d<r;d++)a[d]^=1549556828,c[d]^=909522486;i.sigBytes=n.sigBytes=o,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))},function(e,t,r){var o=r(8);e.exports=!o((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(e,t,r){"use strict";var o=r(34),i=r(21),n=r(37);e.exports=function(e){var t=i(n(this)),r="",s=o(e);if(s<0||s==1/0)throw RangeError("Wrong number of repetitions");for(;s>0;(s>>>=1)&&(t+=t))1&s&&(r+=t);return r}},function(e,t,r){var o=r(5),i=r(238);o({target:"Array",stat:!0,forced:!r(102)((function(e){Array.from(e)}))},{from:i})},function(e,t,r){"use strict";var o=r(5),i=r(22).find,n=r(93),s=!0;"find"in[]&&Array(1).find((function(){s=!1})),o({target:"Array",proto:!0,forced:s},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n("find")},function(e,t,r){var o=r(14);e.exports=function(e,t){var r,i;if("string"===t&&"function"==typeof(r=e.toString)&&!o(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!o(i=r.call(e)))return i;if("string"!==t&&"function"==typeof(r=e.toString)&&!o(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){var o=r(7),i=r(114),n=o.WeakMap;e.exports="function"==typeof n&&/native code/.test(i(n))},function(e,t,r){var o=r(35),i=r(59),n=r(111),s=r(10);e.exports=o("Reflect","ownKeys")||function(e){var t=i.f(s(e)),r=n.f;return r?t.concat(r(e)):t}},function(e,t,r){var o=r(14),i=r(81),n=r(12)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)?o(t)&&null===(t=t[n])&&(t=void 0):t=void 0),void 0===t?Array:t}},function(e,t,r){var o=r(8),i=r(7).RegExp;e.exports=o((function(){var e=i(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},function(e,t,r){var o=r(8),i=r(7).RegExp;e.exports=o((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},function(e,t,r){var o=r(8);e.exports=!o((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){var o=r(14);e.exports=function(e){if(!o(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t){var r=Math.abs,o=Math.pow,i=Math.floor,n=Math.log,s=Math.LN2;e.exports={pack:function(e,t,a){var c,d,l,u=new Array(a),h=8*a-t-1,p=(1<<h)-1,f=p>>1,g=23===t?o(2,-24)-o(2,-77):0,m=e<0||0===e&&1/e<0?1:0,_=0;for((e=r(e))!=e||e===1/0?(d=e!=e?1:0,c=p):(c=i(n(e)/s),e*(l=o(2,-c))<1&&(c--,l*=2),(e+=c+f>=1?g/l:g*o(2,1-f))*l>=2&&(c++,l/=2),c+f>=p?(d=0,c=p):c+f>=1?(d=(e*l-1)*o(2,t),c+=f):(d=e*o(2,f-1)*o(2,t),c=0));t>=8;u[_++]=255&d,d/=256,t-=8);for(c=c<<t|d,h+=t;h>0;u[_++]=255&c,c/=256,h-=8);return u[--_]|=128*m,u},unpack:function(e,t){var r,i=e.length,n=8*i-t-1,s=(1<<n)-1,a=s>>1,c=n-7,d=i-1,l=e[d--],u=127&l;for(l>>=7;c>0;u=256*u+e[d],d--,c-=8);for(r=u&(1<<-c)-1,u>>=-c,c+=t;c>0;r=256*r+e[d],d--,c-=8);if(0===u)u=1-a;else{if(u===s)return r?NaN:l?-1/0:1/0;r+=o(2,t),u-=a}return(l?-1:1)*r*o(2,u-t)}}},function(e,t,r){"use strict";var o=r(112),i=r(83);e.exports=o?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,r){var o=r(34);e.exports=function(e){var t=o(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}},function(e,t,r){"use strict";var o=r(20),i=r(56),n=r(13),s=Math.min;e.exports=[].copyWithin||function(e,t){var r=o(this),a=n(r.length),c=i(e,a),d=i(t,a),l=arguments.length>2?arguments[2]:void 0,u=s((void 0===l?a:i(l,a))-d,a-c),h=1;for(d<c&&c<d+u&&(h=-1,d+=u-1,c+=u-1);u-- >0;)d in r?r[c]=r[d]:delete r[c],c+=h,d+=h;return r}},function(e,t,r){var o=r(236),i=r(91);e.exports=function(e,t){return o(i(e),t)}},function(e,t){e.exports=function(e,t){for(var r=0,o=t.length,i=new e(o);o>r;)i[r]=t[r++];return i}},function(e,t,r){var o=r(7);e.exports=o},function(e,t,r){"use strict";var o=r(30),i=r(20),n=r(262),s=r(124),a=r(13),c=r(104),d=r(103),l=r(85);e.exports=function(e){var t,r,u,h,p,f,g=i(e),m="function"==typeof this?this:Array,_=arguments.length,v=_>1?arguments[1]:void 0,E=void 0!==v,y=l(g),S=0;if(E&&(v=o(v,_>2?arguments[2]:void 0,2)),null==y||m==Array&&s(y))for(r=new m(t=a(g.length));t>S;S++)f=E?v(g[S],S):g[S],c(r,S,f);else for(p=(h=d(g,y)).next,r=new m;!(u=p.call(h)).done;S++)f=E?n(h,v,[u.value,S],!0):u.value,c(r,S,f);return r.length=S,r}},function(e,t,r){var o=r(13),i=r(21),n=r(220),s=r(37),a=Math.ceil,c=function(e){return function(t,r,c){var d,l,u=i(s(t)),h=u.length,p=void 0===c?" ":i(c),f=o(r);return f<=h||""==p?u:(d=f-h,(l=n.call(p,a(d/p.length))).length>d&&(l=l.slice(0,d)),e?u+l:l+u)}};e.exports={start:c(!1),end:c(!0)}},function(e,t,r){var o=r(5),i=r(219),n=r(8),s=r(14),a=r(175).onFreeze,c=Object.freeze;o({target:"Object",stat:!0,forced:n((function(){c(1)})),sham:!i},{freeze:function(e){return c&&s(e)?c(a(e)):e}})},function(e,t,r){var o=r(37),i=r(21),n="["+r(242)+"]",s=RegExp("^"+n+n+"*"),a=RegExp(n+n+"*$"),c=function(e){return function(t){var r=i(o(t));return 1&e&&(r=r.replace(s,"")),2&e&&(r=r.replace(a,"")),r}};e.exports={start:c(1),end:c(2),trim:c(3)}},function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},function(e,t,r){"use strict";var o,i=r(5),n=r(64).f,s=r(13),a=r(21),c=r(214),d=r(37),l=r(215),u=r(17),h="".startsWith,p=Math.min,f=l("startsWith");i({target:"String",proto:!0,forced:!!(u||f||(o=n(String.prototype,"startsWith"),!o||o.writable))&&!f},{startsWith:function(e){var t=a(d(this));c(e);var r=s(p(arguments.length>1?arguments[1]:void 0,t.length)),o=a(e);return h?h.call(t,o,r):t.slice(r,r+o.length)===o}})},function(e,t,r){var o=r(5),i=r(116),n=r(93);o({target:"Array",proto:!0},{fill:i}),n("fill")},,,,function(e,t,r){var o=r(5),i=r(20),n=r(92);o({target:"Object",stat:!0,forced:r(8)((function(){n(1)}))},{keys:function(e){return n(i(e))}})},,,,,function(e,t,r){var o=r(7);e.exports=o.Promise},function(e,t,r){var o,i,n,s,a,c,d,l,u=r(7),h=r(64).f,p=r(196).set,f=r(197),g=r(255),m=r(256),_=r(126),v=u.MutationObserver||u.WebKitMutationObserver,E=u.document,y=u.process,S=u.Promise,T=h(u,"queueMicrotask"),b=T&&T.value;b||(o=function(){var e,t;for(_&&(e=y.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?s():n=void 0,e}}n=void 0,e&&e.enter()},f||_||m||!v||!E?!g&&S&&S.resolve?((d=S.resolve(void 0)).constructor=S,l=d.then,s=function(){l.call(d,o)}):s=_?function(){y.nextTick(o)}:function(){p.call(u,o)}:(a=!0,c=E.createTextNode(""),new v(o).observe(c,{characterData:!0}),s=function(){c.data=a=!a})),e.exports=b||function(e){var t={fn:e,next:void 0};n&&(n.next=t),i||(i=t,s()),n=t}},function(e,t,r){var o=r(46),i=r(7);e.exports=/ipad|iphone|ipod/i.test(o)&&void 0!==i.Pebble},function(e,t,r){var o=r(46);e.exports=/web0s(?!.*chrome)/i.test(o)},function(e,t,r){var o=r(10),i=r(14),n=r(198);e.exports=function(e,t){if(o(e),i(t)&&t.constructor===e)return t;var r=n.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var o=r(7);e.exports=function(e,t){var r=o.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t){e.exports="object"==typeof window},,function(e,t,r){var o=r(10),i=r(195);e.exports=function(e,t,r,n){try{return n?t(o(r)[0],r[1]):t(r)}catch(t){i(e,"throw",t)}}},function(e,t,r){"use strict";var o=r(33),i=r(199),n=r(264),s=r(206);function a(e){var t=new n(e),r=i(n.prototype.request,t);return o.extend(r,n.prototype,t),o.extend(r,t),r}var c=a(r(202));c.Axios=n,c.create=function(e){return a(s(c.defaults,e))},c.Cancel=r(207),c.CancelToken=r(277),c.isCancel=r(201),c.all=function(e){return Promise.all(e)},c.spread=r(278),e.exports=c,e.exports.default=c},function(e,t,r){"use strict";var o=r(33),i=r(200),n=r(265),s=r(266),a=r(206);function c(e){this.defaults=e,this.interceptors={request:new n,response:new n}}c.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=a(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[s,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)r=r.then(t.shift(),t.shift());return r},c.prototype.getUri=function(e){return e=a(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},o.forEach(["delete","get","head","options"],(function(e){c.prototype[e]=function(t,r){return this.request(o.merge(r||{},{method:e,url:t}))}})),o.forEach(["post","put","patch"],(function(e){c.prototype[e]=function(t,r,i){return this.request(o.merge(i||{},{method:e,url:t,data:r}))}})),e.exports=c},function(e,t,r){"use strict";var o=r(33);function i(){this.handlers=[]}i.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){o.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},function(e,t,r){"use strict";var o=r(33),i=r(267),n=r(201),s=r(202);function a(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return a(e),e.headers=e.headers||{},e.data=i(e.data,e.headers,e.transformRequest),e.headers=o.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),o.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||s.adapter)(e).then((function(t){return a(e),t.data=i(t.data,t.headers,e.transformResponse),t}),(function(t){return n(t)||(a(e),t&&t.response&&(t.response.data=i(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,r){"use strict";var o=r(33);e.exports=function(e,t,r){return o.forEach(r,(function(r){e=r(e,t)})),e}},function(e,t,r){"use strict";var o=r(33);e.exports=function(e,t){o.forEach(e,(function(r,o){o!==t&&o.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[o])}))}},function(e,t,r){"use strict";var o=r(205);e.exports=function(e,t,r){var i=r.config.validateStatus;!i||i(r.status)?e(r):t(o("Request failed with status code "+r.status,r.config,null,r.request,r))}},function(e,t,r){"use strict";e.exports=function(e,t,r,o,i){return e.config=t,r&&(e.code=r),e.request=o,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,r){"use strict";var o=r(272),i=r(273);e.exports=function(e,t){return e&&!o(t)?i(e,t):t}},function(e,t,r){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,r){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,r){"use strict";var o=r(33),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,n,s={};return e?(o.forEach(e.split("\n"),(function(e){if(n=e.indexOf(":"),t=o.trim(e.substr(0,n)).toLowerCase(),r=o.trim(e.substr(n+1)),t){if(s[t]&&i.indexOf(t)>=0)return;s[t]="set-cookie"===t?(s[t]?s[t]:[]).concat([r]):s[t]?s[t]+", "+r:r}})),s):s}},function(e,t,r){"use strict";var o=r(33);e.exports=o.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var o=e;return t&&(r.setAttribute("href",o),o=r.href),r.setAttribute("href",o),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=i(window.location.href),function(t){var r=o.isString(t)?i(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},function(e,t,r){"use strict";var o=r(33);e.exports=o.isStandardBrowserEnv()?{write:function(e,t,r,i,n,s){var a=[];a.push(e+"="+encodeURIComponent(t)),o.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),o.isString(i)&&a.push("path="+i),o.isString(n)&&a.push("domain="+n),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";var o=r(207);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;e((function(e){r.reason||(r.reason=new o(e),t(r.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},function(e,t,r){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,r){var o=r(20),i=Math.floor,n="".replace,s=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,a=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,r,c,d,l){var u=r+e.length,h=c.length,p=a;return void 0!==d&&(d=o(d),p=s),n.call(l,p,(function(o,n){var s;switch(n.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(u);case"<":s=d[n.slice(1,-1)];break;default:var a=+n;if(0===a)return o;if(a>h){var l=i(a/10);return 0===l?o:l<=h?void 0===c[l-1]?n.charAt(1):c[l-1]+n.charAt(1):o}s=c[a-1]}return void 0===s?"":s}))}},function(e,t,r){"use strict";var o=r(281),i=r(282);e.exports=o("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),i)},function(e,t,r){"use strict";var o=r(5),i=r(7),n=r(100),s=r(25),a=r(175),c=r(31),d=r(69),l=r(14),u=r(8),h=r(102),p=r(54),f=r(127);e.exports=function(e,t,r){var g=-1!==e.indexOf("Map"),m=-1!==e.indexOf("Weak"),_=g?"set":"add",v=i[e],E=v&&v.prototype,y=v,S={},T=function(e){var t=E[e];s(E,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(m&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return m&&!l(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(m&&!l(e))&&t.call(this,0===e?0:e)}:function(e,r){return t.call(this,0===e?0:e,r),this})};if(n(e,"function"!=typeof v||!(m||E.forEach&&!u((function(){(new v).entries().next()})))))y=r.getConstructor(t,e,g,_),a.enable();else if(n(e,!0)){var b=new y,R=b[_](m?{}:-0,1)!=b,C=u((function(){b.has(1)})),I=h((function(e){new v(e)})),O=!m&&u((function(){for(var e=new v,t=5;t--;)e[_](t,t);return!e.has(-0)}));I||((y=t((function(t,r){d(t,y,e);var o=f(new v,t,y);return null!=r&&c(r,o[_],{that:o,AS_ENTRIES:g}),o}))).prototype=E,E.constructor=y),(C||O)&&(T("delete"),T("has"),g&&T("get")),(O||R)&&T(_),m&&E.clear&&delete E.clear}return S[e]=y,o({global:!0,forced:y!=v},S),p(y,e),m||r.setStrong(y,e,g),y}},function(e,t,r){"use strict";var o=r(18).f,i=r(47),n=r(101),s=r(30),a=r(69),c=r(31),d=r(115),l=r(125),u=r(19),h=r(175).fastKey,p=r(36),f=p.set,g=p.getterFor;e.exports={getConstructor:function(e,t,r,d){var l=e((function(e,o){a(e,l,t),f(e,{type:t,index:i(null),first:void 0,last:void 0,size:0}),u||(e.size=0),null!=o&&c(o,e[d],{that:e,AS_ENTRIES:r})})),p=g(t),m=function(e,t,r){var o,i,n=p(e),s=_(e,t);return s?s.value=r:(n.last=s={index:i=h(t,!0),key:t,value:r,previous:o=n.last,next:void 0,removed:!1},n.first||(n.first=s),o&&(o.next=s),u?n.size++:e.size++,"F"!==i&&(n.index[i]=s)),e},_=function(e,t){var r,o=p(e),i=h(t);if("F"!==i)return o.index[i];for(r=o.first;r;r=r.next)if(r.key==t)return r};return n(l.prototype,{clear:function(){for(var e=p(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,u?e.size=0:this.size=0},delete:function(e){var t=p(this),r=_(this,e);if(r){var o=r.next,i=r.previous;delete t.index[r.index],r.removed=!0,i&&(i.next=o),o&&(o.previous=i),t.first==r&&(t.first=o),t.last==r&&(t.last=i),u?t.size--:this.size--}return!!r},forEach:function(e){for(var t,r=p(this),o=s(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:r.first;)for(o(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!_(this,e)}}),n(l.prototype,r?{get:function(e){var t=_(this,e);return t&&t.value},set:function(e,t){return m(this,0===e?0:e,t)}}:{add:function(e){return m(this,e=0===e?0:e,e)}}),u&&o(l.prototype,"size",{get:function(){return p(this).size}}),l},setStrong:function(e,t,r){var o=t+" Iterator",i=g(t),n=g(o);d(e,t,(function(e,t){f(this,{type:o,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=n(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),l(t)}}},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(284);o({target:"Map",proto:!0,real:!0,forced:i},{deleteAll:function(){return n.apply(this,arguments)}})},function(e,t,r){"use strict";var o=r(10),i=r(26);e.exports=function(){for(var e,t=o(this),r=i(t.delete),n=!0,s=0,a=arguments.length;s<a;s++)e=r.call(t,arguments[s]),n=n&&e;return!!n}},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(10),s=r(30),a=r(45),c=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{every:function(e){var t=n(this),r=a(t),o=s(e,arguments.length>1?arguments[1]:void 0,3);return!c(r,(function(e,r,i){if(!o(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(35),s=r(10),a=r(26),c=r(30),d=r(62),l=r(45),u=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{filter:function(e){var t=s(this),r=l(t),o=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(d(t,n("Map"))),h=a(i.set);return u(r,(function(e,r){o(r,e,t)&&h.call(i,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(10),s=r(30),a=r(45),c=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{find:function(e){var t=n(this),r=a(t),o=s(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(o(r,e,t))return i(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(10),s=r(30),a=r(45),c=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{findKey:function(e){var t=n(this),r=a(t),o=s(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(o(r,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(10),s=r(45),a=r(290),c=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{includes:function(e){return c(s(n(this)),(function(t,r,o){if(a(r,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(10),s=r(45),a=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{keyOf:function(e){return a(s(n(this)),(function(t,r,o){if(r===e)return o(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(35),s=r(10),a=r(26),c=r(30),d=r(62),l=r(45),u=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{mapKeys:function(e){var t=s(this),r=l(t),o=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(d(t,n("Map"))),h=a(i.set);return u(r,(function(e,r){h.call(i,o(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(35),s=r(10),a=r(26),c=r(30),d=r(62),l=r(45),u=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{mapValues:function(e){var t=s(this),r=l(t),o=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(d(t,n("Map"))),h=a(i.set);return u(r,(function(e,r){h.call(i,e,o(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(10),s=r(26),a=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{merge:function(e){for(var t=n(this),r=s(t.set),o=arguments.length,i=0;i<o;)a(arguments[i++],r,{that:t,AS_ENTRIES:!0});return t}})},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(10),s=r(26),a=r(45),c=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{reduce:function(e){var t=n(this),r=a(t),o=arguments.length<2,i=o?void 0:arguments[1];if(s(e),c(r,(function(r,n){o?(o=!1,i=n):i=e(i,n,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o)throw TypeError("Reduce of empty map with no initial value");return i}})},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(10),s=r(30),a=r(45),c=r(31);o({target:"Map",proto:!0,real:!0,forced:i},{some:function(e){var t=n(this),r=a(t),o=s(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(o(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){"use strict";var o=r(5),i=r(17),n=r(10),s=r(26);o({target:"Map",proto:!0,real:!0,forced:i},{update:function(e,t){var r=n(this),o=arguments.length;s(t);var i=r.has(e);if(!i&&o<3)throw TypeError("Updating absent value");var a=i?r.get(e):s(o>2?arguments[2]:void 0)(e,r);return r.set(e,t(a,e,r)),r}})},function(e,t,r){(function(t){e.exports=function e(t,r,o){function i(s,a){if(!r[s]){if(!t[s]){if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=r[s]={exports:{}};t[s][0].call(d.exports,(function(e){var r=t[s][1][e];return i(r||e)}),d,d.exports,e,t,r,o)}return r[s].exports}for(var n=!1,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,r,o){(function(e){"use strict";var t,o,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var n=0,s=new i(l),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),t=function(){a.data=n=++n%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var c=new e.MessageChannel;c.port1.onmessage=l,t=function(){c.port2.postMessage(0)}}var d=[];function l(){var e,t;o=!0;for(var r=d.length;r;){for(t=d,d=[],e=-1;++e<r;)t[e]();r=d.length}o=!1}r.exports=function(e){1!==d.push(e)||o||t()}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";var o=e(1);function i(){}var n={},s=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&p(this,e)}function l(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function u(e,t,r){o((function(){var o;try{o=t(r)}catch(t){return n.reject(e,t)}o===e?n.reject(e,new TypeError("Cannot resolve promise with itself")):n.resolve(e,o)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var r=!1;function o(t){r||(r=!0,n.reject(e,t))}function i(t){r||(r=!0,n.resolve(e,t))}var s=f((function(){t(i,o)}));"error"===s.status&&o(s.value)}function f(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}t.exports=d,d.prototype.catch=function(e){return this.then(null,e)},d.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var r=new this.constructor(i);return this.state!==c?u(r,this.state===a?e:t,this.outcome):this.queue.push(new l(r,e,t)),r},l.prototype.callFulfilled=function(e){n.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){n.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},n.resolve=function(e,t){var r=f(h,t);if("error"===r.status)return n.reject(e,r.value);var o=r.value;if(o)p(e,o);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},n.reject=function(e,t){e.state=s,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callRejected(t);return e},d.resolve=function(e){return e instanceof this?e:n.resolve(new this(i),e)},d.reject=function(e){var t=new this(i);return n.reject(t,e)},d.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var s=new Array(r),a=0,c=-1,d=new this(i);++c<r;)l(e[c],c);return d;function l(e,i){t.resolve(e).then((function(e){s[i]=e,++a!==r||o||(o=!0,n.resolve(d,s))}),(function(e){o||(o=!0,n.reject(d,e))}))}},d.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var s,a=-1,c=new this(i);++a<r;)s=e[a],t.resolve(s).then((function(e){o||(o=!0,n.resolve(c,e))}),(function(e){o||(o=!0,n.reject(c,e))}));return c}},{1:1}],3:[function(e,r,o){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),o=0;o<e.length;o+=1)r.append(e[o]);return r.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var s=Promise;function a(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function d(e){return"string"!=typeof e&&(e=String(e)),e}function l(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var u=void 0,h={},p=Object.prototype.toString;function f(e){return"boolean"==typeof u?s.resolve(u):function(e){return new s((function(t){var r=e.transaction("local-forage-detect-blob-support","readwrite"),o=n([""]);r.objectStore("local-forage-detect-blob-support").put(o,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return u=e}))}function g(e){var t=h[e.name],r={};r.promise=new s((function(e,t){r.resolve=e,r.reject=t})),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then((function(){return r.promise})):t.dbReady=r.promise}function m(e){var t=h[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function _(e,t){var r=h[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function v(e,t){return new s((function(r,o){if(h[e.name]=h[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return r(e.db);g(e),e.db.close()}var n=[e.name];t&&n.push(e.version);var s=i.open.apply(i,n);t&&(s.onupgradeneeded=function(t){var r=s.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore("local-forage-detect-blob-support")}catch(e){if("ConstraintError"!==e.name)throw e}}),s.onerror=function(e){e.preventDefault(),o(s.error)},s.onsuccess=function(){var t=s.result;t.onversionchange=function(e){e.target.close()},r(t),m(e)}}))}function E(e){return v(e,!1)}function y(e){return v(e,!0)}function S(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),o=e.version<e.db.version,i=e.version>e.db.version;if(o&&(e.version,e.version=e.db.version),i||r){if(r){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}function T(e){return n([function(e){for(var t=e.length,r=new ArrayBuffer(t),o=new Uint8Array(r),i=0;i<t;i++)o[i]=e.charCodeAt(i);return r}(atob(e.data))],{type:e.type})}function b(e){return e&&e.__local_forage_encoded_blob}function R(e){var t=this,r=t._initReady().then((function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(r,e,e),r}function C(e,t,r,o){void 0===o&&(o=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(i){if(o>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return s.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),y(e)})).then((function(){return function(e){g(e);for(var t=h[e.name],r=t.forages,o=0;o<r.length;o++){var i=r[o];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,E(e).then((function(t){return e.db=t,S(e)?y(e):t})).then((function(o){e.db=t.db=o;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=o})).catch((function(t){throw _(e,t),t}))}(e).then((function(){C(e,t,r,o-1)}))})).catch(r);r(i)}}var I={_driver:"asyncStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var o in e)r[o]=e[o];var i=h[r.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},h[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=R);var n=[];function a(){return s.resolve()}for(var c=0;c<i.forages.length;c++){var d=i.forages[c];d!==t&&n.push(d._initReady().catch(a))}var l=i.forages.slice(0);return s.all(n).then((function(){return r.db=i.db,E(r)})).then((function(e){return r.db=e,S(r,t._defaultConfig.version)?y(r):e})).then((function(e){r.db=i.db=e,t._dbInfo=r;for(var o=0;o<l.length;o++){var n=l[o];n!==t&&(n._dbInfo.db=r.db,n._dbInfo.version=r.version)}}))},_support:function(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var r=this,o=new s((function(t,o){r.ready().then((function(){C(r._dbInfo,"readonly",(function(i,n){if(i)return o(i);try{var s=n.objectStore(r._dbInfo.storeName).openCursor(),a=1;s.onsuccess=function(){var r=s.result;if(r){var o=r.value;b(o)&&(o=T(o));var i=e(o,r.key,a++);void 0!==i?t(i):r.continue()}else t()},s.onerror=function(){o(s.error)}}catch(e){o(e)}}))})).catch(o)}));return a(o,t),o},getItem:function(e,t){var r=this;e=d(e);var o=new s((function(t,o){r.ready().then((function(){C(r._dbInfo,"readonly",(function(i,n){if(i)return o(i);try{var s=n.objectStore(r._dbInfo.storeName).get(e);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),b(e)&&(e=T(e)),t(e)},s.onerror=function(){o(s.error)}}catch(e){o(e)}}))})).catch(o)}));return a(o,t),o},setItem:function(e,t,r){var o=this;e=d(e);var i=new s((function(r,i){var n;o.ready().then((function(){return n=o._dbInfo,"[object Blob]"===p.call(t)?f(n.db).then((function(e){return e?t:(r=t,new s((function(e,t){var o=new FileReader;o.onerror=t,o.onloadend=function(t){var o=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:o,type:r.type})},o.readAsBinaryString(r)})));var r})):t})).then((function(t){C(o._dbInfo,"readwrite",(function(n,s){if(n)return i(n);try{var a=s.objectStore(o._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);s.oncomplete=function(){void 0===t&&(t=null),r(t)},s.onabort=s.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return a(i,r),i},removeItem:function(e,t){var r=this;e=d(e);var o=new s((function(t,o){r.ready().then((function(){C(r._dbInfo,"readwrite",(function(i,n){if(i)return o(i);try{var s=n.objectStore(r._dbInfo.storeName).delete(e);n.oncomplete=function(){t()},n.onerror=function(){o(s.error)},n.onabort=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return a(o,t),o},clear:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){C(t._dbInfo,"readwrite",(function(o,i){if(o)return r(o);try{var n=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=n.error?n.error:n.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return a(r,e),r},length:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){C(t._dbInfo,"readonly",(function(o,i){if(o)return r(o);try{var n=i.objectStore(t._dbInfo.storeName).count();n.onsuccess=function(){e(n.result)},n.onerror=function(){r(n.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,e),r},key:function(e,t){var r=this,o=new s((function(t,o){e<0?t(null):r.ready().then((function(){C(r._dbInfo,"readonly",(function(i,n){if(i)return o(i);try{var s=n.objectStore(r._dbInfo.storeName),a=!1,c=s.openKeyCursor();c.onsuccess=function(){var r=c.result;r?0===e||a?t(r.key):(a=!0,r.advance(e)):t(null)},c.onerror=function(){o(c.error)}}catch(e){o(e)}}))})).catch(o)}));return a(o,t),o},keys:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){C(t._dbInfo,"readonly",(function(o,i){if(o)return r(o);try{var n=i.objectStore(t._dbInfo.storeName).openKeyCursor(),s=[];n.onsuccess=function(){var t=n.result;t?(s.push(t.key),t.continue()):e(s)},n.onerror=function(){r(n.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,e),r},dropInstance:function(e,t){t=l.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var o,n=this;if(e.name){var c=e.name===r.name&&n._dbInfo.db,d=c?s.resolve(n._dbInfo.db):E(e).then((function(t){var r=h[e.name],o=r.forages;r.db=t;for(var i=0;i<o.length;i++)o[i]._dbInfo.db=t;return t}));o=e.storeName?d.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;g(e);var o=h[e.name],n=o.forages;t.close();for(var a=0;a<n.length;a++){var c=n[a];c._dbInfo.db=null,c._dbInfo.version=r}return new s((function(t,o){var n=i.open(e.name,r);n.onerror=function(e){n.result.close(),o(e)},n.onupgradeneeded=function(){n.result.deleteObjectStore(e.storeName)},n.onsuccess=function(){var e=n.result;e.close(),t(e)}})).then((function(e){o.db=e;for(var t=0;t<n.length;t++){var r=n[t];r._dbInfo.db=e,m(r._dbInfo)}})).catch((function(t){throw(_(e,t)||s.resolve()).catch((function(){})),t}))}})):d.then((function(t){g(e);var r=h[e.name],o=r.forages;t.close();for(var n=0;n<o.length;n++)o[n]._dbInfo.db=null;return new s((function(t,r){var o=i.deleteDatabase(e.name);o.onerror=function(){var e=o.result;e&&e.close(),r(o.error)},o.onblocked=function(){},o.onsuccess=function(){var e=o.result;e&&e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<o.length;t++)m(o[t]._dbInfo)})).catch((function(t){throw(_(e,t)||s.resolve()).catch((function(){})),t}))}))}else o=s.reject("Invalid arguments");return a(o,t),o}},O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=/^~~local_forage_type~([^~]+)~/,w="__lfsc__:".length,M=w+"arbf".length,A=Object.prototype.toString;function N(e){var t,r,o,i,n,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var d=new ArrayBuffer(s),l=new Uint8Array(d);for(t=0;t<a;t+=4)r=O.indexOf(e[t]),o=O.indexOf(e[t+1]),i=O.indexOf(e[t+2]),n=O.indexOf(e[t+3]),l[c++]=r<<2|o>>4,l[c++]=(15&o)<<4|i>>2,l[c++]=(3&i)<<6|63&n;return d}function k(e){var t,r=new Uint8Array(e),o="";for(t=0;t<r.length;t+=3)o+=O[r[t]>>2],o+=O[(3&r[t])<<4|r[t+1]>>4],o+=O[(15&r[t+1])<<2|r[t+2]>>6],o+=O[63&r[t+2]];return r.length%3==2?o=o.substring(0,o.length-1)+"=":r.length%3==1&&(o=o.substring(0,o.length-2)+"=="),o}var P={serialize:function(e,t){var r="";if(e&&(r=A.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===A.call(e.buffer))){var o,i="__lfsc__:";e instanceof ArrayBuffer?(o=e,i+="arbf"):(o=e.buffer,"[object Int8Array]"===r?i+="si08":"[object Uint8Array]"===r?i+="ui08":"[object Uint8ClampedArray]"===r?i+="uic8":"[object Int16Array]"===r?i+="si16":"[object Uint16Array]"===r?i+="ur16":"[object Int32Array]"===r?i+="si32":"[object Uint32Array]"===r?i+="ui32":"[object Float32Array]"===r?i+="fl32":"[object Float64Array]"===r?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+k(o))}else if("[object Blob]"===r){var n=new FileReader;n.onload=function(){var r="~~local_forage_type~"+e.type+"~"+k(this.result);t("__lfsc__:blob"+r)},n.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(e){t(null,e)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,w))return JSON.parse(e);var t,r=e.substring(M),o=e.substring(w,M);if("blob"===o&&L.test(r)){var i=r.match(L);t=i[1],r=r.substring(i[0].length)}var s=N(r);switch(o){case"arbf":return s;case"blob":return n([s],{type:t});case"si08":return new Int8Array(s);case"ui08":return new Uint8Array(s);case"uic8":return new Uint8ClampedArray(s);case"si16":return new Int16Array(s);case"ur16":return new Uint16Array(s);case"si32":return new Int32Array(s);case"ui32":return new Uint32Array(s);case"fl32":return new Float32Array(s);case"fl64":return new Float64Array(s);default:throw new Error("Unkown type: "+o)}},stringToBuffer:N,bufferToString:k};function x(e,t,r,o){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,o)}function D(e,t,r,o,i,n){e.executeSql(r,o,i,(function(e,s){s.code===s.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?n(e,s):x(e,t,(function(){e.executeSql(r,o,i,n)}),n)}),n):n(e,s)}),n)}function U(e,t,r,o){var i=this;e=d(e);var n=new s((function(n,s){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,d){d?s(d):c.db.transaction((function(r){D(r,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){n(a)}),(function(e,t){s(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(o>0)return void n(U.apply(i,[e,a,r,o-1]));s(t)}}))}))})).catch(s)}));return a(n,r),n}function B(e){return new s((function(t,r){e.transaction((function(o){o.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(r,o){for(var i=[],n=0;n<o.rows.length;n++)i.push(o.rows.item(n).name);t({db:e,storeNames:i})}),(function(e,t){r(t)}))}),(function(e){r(e)}))}))}var Z={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var o in e)r[o]="string"!=typeof e[o]?e[o].toString():e[o];var i=new s((function(e,o){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return o(e)}r.db.transaction((function(i){x(i,r,(function(){t._dbInfo=r,e()}),(function(e,t){o(t)}))}),o)}));return r.serializer=P,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var r=this,o=new s((function(t,o){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){D(r,i,"SELECT * FROM "+i.storeName,[],(function(r,o){for(var n=o.rows,s=n.length,a=0;a<s;a++){var c=n.item(a),d=c.value;if(d&&(d=i.serializer.deserialize(d)),void 0!==(d=e(d,c.key,a+1)))return void t(d)}t()}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,t),o},getItem:function(e,t){var r=this;e=d(e);var o=new s((function(t,o){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){D(r,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,r){var o=r.rows.length?r.rows.item(0).value:null;o&&(o=i.serializer.deserialize(o)),t(o)}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,t),o},setItem:function(e,t,r){return U.apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this;e=d(e);var o=new s((function(t,o){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){D(r,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,t),o},clear:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){var o=t._dbInfo;o.db.transaction((function(t){D(t,o,"DELETE FROM "+o.storeName,[],(function(){e()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,e),r},length:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){var o=t._dbInfo;o.db.transaction((function(t){D(t,o,"SELECT COUNT(key) as c FROM "+o.storeName,[],(function(t,r){var o=r.rows.item(0).c;e(o)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,e),r},key:function(e,t){var r=this,o=new s((function(t,o){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){D(r,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,r){var o=r.rows.length?r.rows.item(0).key:null;t(o)}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,t),o},keys:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){var o=t._dbInfo;o.db.transaction((function(t){D(t,o,"SELECT key FROM "+o.storeName,[],(function(t,r){for(var o=[],i=0;i<r.rows.length;i++)o.push(r.rows.item(i).key);e(o)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,e),r},dropInstance:function(e,t){t=l.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var o,i=this;return a(o=e.name?new s((function(t){var o;o=e.name===r.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:o,storeNames:[e.storeName]}):t(B(o))})).then((function(e){return new s((function(t,r){e.db.transaction((function(o){function i(e){return new s((function(t,r){o.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){r(t)}))}))}for(var n=[],a=0,c=e.storeNames.length;a<c;a++)n.push(i(e.storeNames[a]));s.all(n).then((function(){t()})).catch((function(e){r(e)}))}),(function(e){r(e)}))}))})):s.reject("Invalid arguments"),t),o}};function H(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function G(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var W={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=H(e,this._defaultConfig),G()?(this._dbInfo=t,t.serializer=P,s.resolve()):s.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var r=this,o=r.ready().then((function(){for(var t=r._dbInfo,o=t.keyPrefix,i=o.length,n=localStorage.length,s=1,a=0;a<n;a++){var c=localStorage.key(a);if(0===c.indexOf(o)){var d=localStorage.getItem(c);if(d&&(d=t.serializer.deserialize(d)),void 0!==(d=e(d,c.substring(i),s++)))return d}}}));return a(o,t),o},getItem:function(e,t){var r=this;e=d(e);var o=r.ready().then((function(){var t=r._dbInfo,o=localStorage.getItem(t.keyPrefix+e);return o&&(o=t.serializer.deserialize(o)),o}));return a(o,t),o},setItem:function(e,t,r){var o=this;e=d(e);var i=o.ready().then((function(){void 0===t&&(t=null);var r=t;return new s((function(i,n){var s=o._dbInfo;s.serializer.serialize(t,(function(t,o){if(o)n(o);else try{localStorage.setItem(s.keyPrefix+e,t),i(r)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||n(e),n(e)}}))}))}));return a(i,r),i},removeItem:function(e,t){var r=this;e=d(e);var o=r.ready().then((function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return a(o,t),o},clear:function(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var o=localStorage.key(r);0===o.indexOf(e)&&localStorage.removeItem(o)}}));return a(r,e),r},length:function(e){var t=this.keys().then((function(e){return e.length}));return a(t,e),t},key:function(e,t){var r=this,o=r.ready().then((function(){var t,o=r._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(o.keyPrefix.length)),t}));return a(o,t),o},keys:function(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo,r=localStorage.length,o=[],i=0;i<r;i++){var n=localStorage.key(i);0===n.indexOf(e.keyPrefix)&&o.push(n.substring(e.keyPrefix.length))}return o}));return a(r,e),r},dropInstance:function(e,t){if(t=l.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var o,i=this;return a(o=e.name?new s((function(t){e.storeName?t(H(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}})):s.reject("Invalid arguments"),t),o}},z=function(e,t){for(var r,o,i=e.length,n=0;n<i;){if((r=e[n])===(o=t)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;n++}return!1},q=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},j={},V={},F={INDEXEDDB:I,WEBSQL:Z,LOCALSTORAGE:W},Y=[F.INDEXEDDB._driver,F.WEBSQL._driver,F.LOCALSTORAGE._driver],X=["dropInstance"],J=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(X),K={description:"",driver:Y.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Q(e,t){e[t]=function(){var r=arguments;return e.ready().then((function(){return e[t].apply(e,r)}))}}function $(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(q(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r])}return arguments[0]}var ee=new(function(){function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),F)if(F.hasOwnProperty(r)){var o=F[r],i=o._driver;this[r]=i,j[i]||this.defineDriver(o)}this._defaultConfig=$({},K),this._config=$({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":o(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var o=new s((function(t,r){try{var o=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(i);for(var n=J.concat("_initStorage"),c=0,d=n.length;c<d;c++){var l=n[c];if((!z(X,l)||e[l])&&"function"!=typeof e[l])return void r(i)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),r=s.reject(t);return a(r,arguments[arguments.length-1]),r}},r=0,o=X.length;r<o;r++){var i=X[r];e[i]||(e[i]=t(i))}}();var u=function(r){j[o],j[o]=e,V[o]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(u,r):u(!!e._support):u(!0)}catch(e){r(e)}}));return c(o,t,r),o},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var o=j[e]?s.resolve(j[e]):s.reject(new Error("Driver not found."));return c(o,t,r),o},e.prototype.getSerializer=function(e){var t=s.resolve(P);return c(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(r,e,e),r},e.prototype.setDriver=function(e,t,r){var o=this;q(e)||(e=[e]);var i=this._getSupportedDrivers(e);function n(){o._config.driver=o.driver()}function a(e){return o._extend(e),n(),o._ready=o._initStorage(o._config),o._ready}var d=null!==this._driverSet?this._driverSet.catch((function(){return s.resolve()})):s.resolve();return this._driverSet=d.then((function(){var e=i[0];return o._dbInfo=null,o._ready=null,o.getDriver(e).then((function(e){o._driver=e._driver,n(),o._wrapLibraryMethodsWithReady(),o._initDriver=function(e){return function(){var t=0;return function r(){for(;t<e.length;){var i=e[t];return t++,o._dbInfo=null,o._ready=null,o.getDriver(i).then(a).catch(r)}n();var c=new Error("No available storage method found.");return o._driverSet=s.reject(c),o._driverSet}()}}(i)}))})).catch((function(){n();var e=new Error("No available storage method found.");return o._driverSet=s.reject(e),o._driverSet})),c(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!V[e]},e.prototype._extend=function(e){$(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,o=e.length;r<o;r++){var i=e[r];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=J.length;e<t;e++)Q(this,J[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ee},{3:3}]},{},[4])(4)}).call(this,r(61))},function(e,t,r){(function(t,r,o){e.exports=function e(t,r,o){function i(s,a){if(!r[s]){if(!t[s]){if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=r[s]={exports:{}};t[s][0].call(d.exports,(function(e){return i(t[s][1][e]||e)}),d,d.exports,e,t,r,o)}return r[s].exports}for(var n=!1,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,r){"use strict";var o=e("./utils"),i=e("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,s,a,c,d,l=[],u=0,h=e.length,p=h,f="string"!==o.getTypeOf(e);u<e.length;)p=h-u,i=f?(t=e[u++],r=u<h?e[u++]:0,u<h?e[u++]:0):(t=e.charCodeAt(u++),r=u<h?e.charCodeAt(u++):0,u<h?e.charCodeAt(u++):0),s=t>>2,a=(3&t)<<4|r>>4,c=1<p?(15&r)<<2|i>>6:64,d=2<p?63&i:64,l.push(n.charAt(s)+n.charAt(a)+n.charAt(c)+n.charAt(d));return l.join("")},r.decode=function(e){var t,r,o,s,a,c,d=0,l=0,u="data:";if(e.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var h,p=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===n.charAt(64)&&p--,e.charAt(e.length-2)===n.charAt(64)&&p--,p%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=i.uint8array?new Uint8Array(0|p):new Array(0|p);d<e.length;)t=n.indexOf(e.charAt(d++))<<2|(s=n.indexOf(e.charAt(d++)))>>4,r=(15&s)<<4|(a=n.indexOf(e.charAt(d++)))>>2,o=(3&a)<<6|(c=n.indexOf(e.charAt(d++))),h[l++]=t,64!==a&&(h[l++]=r),64!==c&&(h[l++]=o);return h}},{"./support":30,"./utils":32}],2:[function(e,t,r){"use strict";var o=e("./external"),i=e("./stream/DataWorker"),n=e("./stream/Crc32Probe"),s=e("./stream/DataLengthProbe");function a(e,t,r,o,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=o,this.compressedContent=i}a.prototype={getContentWorker:function(){var e=new i(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new i(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,r){return e.pipe(new n).pipe(new s("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new s("compressedSize")).withStreamInfo("compression",t)},t.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,r){"use strict";var o=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(e){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,r){"use strict";var o=e("./utils"),i=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==o.getTypeOf(e)?function(e,t,r,o){var n=i,s=0+r;e^=-1;for(var a=0;a<s;a++)e=e>>>8^n[255&(e^t[a])];return-1^e}(0|t,e,e.length):function(e,t,r,o){var n=i,s=0+r;e^=-1;for(var a=0;a<s;a++)e=e>>>8^n[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length):0}},{"./utils":32}],5:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){"use strict";var o;o="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:o}},{lie:37}],7:[function(e,t,r){"use strict";var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako"),n=e("./utils"),s=e("./stream/GenericWorker"),a=o?"uint8array":"array";function c(e,t){s.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}r.magic="\b\0",n.inherits(c,s),c.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(n.transformTo(a,e.data),!1)},c.prototype.flush=function(){s.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},r.compressWorker=function(e){return new c("Deflate",e)},r.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,r){"use strict";function o(e,t){var r,o="";for(r=0;r<t;r++)o+=String.fromCharCode(255&e),e>>>=8;return o}function i(e,t,r,i,s,l){var u,h,p=e.file,f=e.compression,g=l!==a.utf8encode,m=n.transformTo("string",l(p.name)),_=n.transformTo("string",a.utf8encode(p.name)),v=p.comment,E=n.transformTo("string",l(v)),y=n.transformTo("string",a.utf8encode(v)),S=_.length!==p.name.length,T=y.length!==v.length,b="",R="",C="",I=p.dir,O=p.date,L={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(L.crc32=e.crc32,L.compressedSize=e.compressedSize,L.uncompressedSize=e.uncompressedSize);var w=0;t&&(w|=8),g||!S&&!T||(w|=2048);var M=0,A=0;I&&(M|=16),"UNIX"===s?(A=798,M|=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16}(p.unixPermissions,I)):(A=20,M|=function(e){return 63&(e||0)}(p.dosPermissions)),u=O.getUTCHours(),u<<=6,u|=O.getUTCMinutes(),u<<=5,u|=O.getUTCSeconds()/2,h=O.getUTCFullYear()-1980,h<<=4,h|=O.getUTCMonth()+1,h<<=5,h|=O.getUTCDate(),S&&(R=o(1,1)+o(c(m),4)+_,b+="up"+o(R.length,2)+R),T&&(C=o(1,1)+o(c(E),4)+y,b+="uc"+o(C.length,2)+C);var N="";return N+="\n\0",N+=o(w,2),N+=f.magic,N+=o(u,2),N+=o(h,2),N+=o(L.crc32,4),N+=o(L.compressedSize,4),N+=o(L.uncompressedSize,4),N+=o(m.length,2),N+=o(b.length,2),{fileRecord:d.LOCAL_FILE_HEADER+N+m+b,dirRecord:d.CENTRAL_FILE_HEADER+o(A,2)+N+o(E.length,2)+"\0\0\0\0"+o(M,4)+o(i,4)+m+b+E}}var n=e("../utils"),s=e("../stream/GenericWorker"),a=e("../utf8"),c=e("../crc32"),d=e("../signature");function l(e,t,r,o){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=o,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(l,s),l.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,o=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,s.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-o-1))/r:100}}))},l.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=i(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},l.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=i(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return d.DATA_DESCRIPTOR+o(e.crc32,4)+o(e.compressedSize,4)+o(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},l.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,i=function(e,t,r,i,s){var a=n.transformTo("string",s(i));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(e,2)+o(e,2)+o(t,4)+o(r,4)+o(a.length,2)+a}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},l.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},l.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},l.prototype.error=function(e){var t=this._sources;if(!s.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},l.prototype.lock=function(){s.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=l},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,r){"use strict";var o=e("../compressions"),i=e("./ZipFileWorker");r.generateWorker=function(e,t,r){var n=new i(t.streamFiles,r,t.platform,t.encodeFileName),s=0;try{e.forEach((function(e,r){s++;var i=function(e,t){var r=e||t,i=o[r];if(!i)throw new Error(r+" is not a valid compression method !");return i}(r.options.compression,t.compression),a=r.options.compressionOptions||t.compressionOptions||{},c=r.dir,d=r.date;r._compressWorker(i,a).withStreamInfo("file",{name:e,dir:c,date:d,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(n)})),n.entriesCount=s}catch(e){n.error(e)}return n}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){"use strict";function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new o;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(o.prototype=e("./object")).loadAsync=e("./load"),o.support=e("./support"),o.defaults=e("./defaults"),o.version="3.7.1",o.loadAsync=function(e,t){return(new o).loadAsync(e,t)},o.external=e("./external"),t.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,r){"use strict";var o=e("./utils"),i=e("./external"),n=e("./utf8"),s=e("./zipEntries"),a=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function d(e){return new i.Promise((function(t,r){var o=e.decompressed.getContentWorker().pipe(new a);o.on("error",(function(e){r(e)})).on("end",(function(){o.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var r=this;return t=o.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),c.isNode&&c.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var r=new s(t);return r.load(e),r})).then((function(e){var r=[i.Promise.resolve(e)],o=e.files;if(t.checkCRC32)for(var n=0;n<o.length;n++)r.push(d(o[n]));return i.Promise.all(r)})).then((function(e){for(var o=e.shift(),i=o.files,n=0;n<i.length;n++){var s=i[n];r.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders})}return o.zipComment.length&&(r.comment=o.zipComment),r}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,r){"use strict";var o=e("../utils"),i=e("../stream/GenericWorker");function n(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}o.inherits(n,i),n.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},n.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,r){"use strict";var o=e("readable-stream").Readable;function i(e,t,r){o.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),r&&r(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}e("../utils").inherits(i,o),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,r,o){"use strict";r.exports={isNode:void 0!==t,newBufferFrom:function(e,r){if(t.from&&t.from!==Uint8Array.from)return t.from(e,r);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new t(e,r)},allocBuffer:function(e){if(t.alloc)return t.alloc(e);var r=new t(e);return r.fill(0),r},isBuffer:function(e){return t.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,r){"use strict";function o(e,t,r){var o,i=n.getTypeOf(t),a=n.extend(r||{},c);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(e=g(e)),a.createFolders&&(o=f(e))&&m.call(this,o,!0);var u,_="string"===i&&!1===a.binary&&!1===a.base64;r&&void 0!==r.binary||(a.binary=!_),(t instanceof d&&0===t.uncompressedSize||a.dir||!t||0===t.length)&&(a.base64=!1,a.binary=!0,t="",a.compression="STORE",i="string"),u=t instanceof d||t instanceof s?t:h.isNode&&h.isStream(t)?new p(e,t):n.prepareContent(e,t,a.binary,a.optimizedBinaryString,a.base64);var v=new l(e,u,a);this.files[e]=v}var i=e("./utf8"),n=e("./utils"),s=e("./stream/GenericWorker"),a=e("./stream/StreamHelper"),c=e("./defaults"),d=e("./compressedObject"),l=e("./zipObject"),u=e("./generate"),h=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),f=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},g=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},m=function(e,t){return t=void 0!==t?t:c.createFolders,e=g(e),this.files[e]||o.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function _(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,o;for(t in this.files)o=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,o)},filter:function(e){var t=[];return this.forEach((function(r,o){e(r,o)&&t.push(o)})),t},file:function(e,t,r){if(1!==arguments.length)return e=this.root+e,o.call(this,e,t,r),this;if(_(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}var n=this.files[this.root+e];return n&&!n.dir?n:null},folder:function(e){if(!e)return this;if(_(e))return this.filter((function(t,r){return r.dir&&e.test(t)}));var t=this.root+e,r=m.call(this,t),o=this.clone();return o.root=r.name,o},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter((function(t,r){return r.name.slice(0,e.length)===e})),o=0;o<r.length;o++)delete this.files[r[o].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if((r=n.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");n.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var o=r.comment||this.comment||"";t=u.generateWorker(this,r,o)}catch(e){(t=new s("error")).error(e)}return new a(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,r){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,r){"use strict";var o=e("./DataReader");function i(e){o.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(i,o),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),o=e.charCodeAt(2),i=e.charCodeAt(3),n=this.length-4;0<=n;--n)if(this.data[n]===t&&this.data[n+1]===r&&this.data[n+2]===o&&this.data[n+3]===i)return n-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),o=e.charCodeAt(2),i=e.charCodeAt(3),n=this.readData(4);return t===n[0]&&r===n[1]&&o===n[2]&&i===n[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,r){"use strict";var o=e("../utils");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return o.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,r){"use strict";var o=e("./Uint8ArrayReader");function i(e){o.call(this,e)}e("../utils").inherits(i,o),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,r){"use strict";var o=e("./DataReader");function i(e){o.call(this,e)}e("../utils").inherits(i,o),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,r){"use strict";var o=e("./ArrayReader");function i(e){o.call(this,e)}e("../utils").inherits(i,o),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,r){"use strict";var o=e("../utils"),i=e("../support"),n=e("./ArrayReader"),s=e("./StringReader"),a=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");t.exports=function(e){var t=o.getTypeOf(e);return o.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new a(e):i.uint8array?new c(o.transformTo("uint8array",e)):new n(o.transformTo("array",e)):new s(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,r){"use strict";var o=e("./GenericWorker"),i=e("../utils");function n(e){o.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(n,o),n.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,r){"use strict";var o=e("./GenericWorker"),i=e("../crc32");function n(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(n,o),n.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,r){"use strict";var o=e("../utils"),i=e("./GenericWorker");function n(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}o.inherits(n,i),n.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,r){"use strict";var o=e("../utils"),i=e("./GenericWorker");function n(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=o.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}o.inherits(n,i),n.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,r){"use strict";function o(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=o},{}],29:[function(e,r,o){"use strict";var i=e("../utils"),n=e("./ConvertWorker"),s=e("./GenericWorker"),a=e("../base64"),c=e("../support"),d=e("../external"),l=null;if(c.nodestream)try{l=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function u(e,t,r){var o=t;switch(t){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=t,this._mimeType=r,i.checkSupport(o),this._worker=e.pipe(new n(o)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}u.prototype={accumulate:function(e){return function(e,r){return new d.Promise((function(o,n){var s=[],c=e._internalType,d=e._outputType,l=e._mimeType;e.on("data",(function(e,t){s.push(e),r&&r(t)})).on("error",(function(e){s=[],n(e)})).on("end",(function(){try{var e=function(e,t,r){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),r);case"base64":return a.encode(t);default:return i.transformTo(e,t)}}(d,function(e,r){var o,i=0,n=null,s=0;for(o=0;o<r.length;o++)s+=r[o].length;switch(e){case"string":return r.join("");case"array":return Array.prototype.concat.apply([],r);case"uint8array":for(n=new Uint8Array(s),o=0;o<r.length;o++)n.set(r[o],i),i+=r[o].length;return n;case"nodebuffer":return t.concat(r);default:throw new Error("concat : unsupported type '"+e+"'")}}(c,s),l);o(e)}catch(e){n(e)}s=[]})).resume()}))}(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,(function(e){t.call(r,e.data,e.meta)})):this._worker.on(e,(function(){i.delay(t,arguments,r)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},e)}},r.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,r,o){"use strict";if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,o.nodebuffer=void 0!==t,o.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)o.blob=!1;else{var i=new ArrayBuffer(0);try{o.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(i),o.blob=0===n.getBlob("application/zip").size}catch(e){o.blob=!1}}}try{o.nodestream=!!e("readable-stream").Readable}catch(e){o.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,r){"use strict";for(var o=e("./utils"),i=e("./support"),n=e("./nodejsUtils"),s=e("./stream/GenericWorker"),a=new Array(256),c=0;c<256;c++)a[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function d(){s.call(this,"utf-8 decode"),this.leftOver=null}function l(){s.call(this,"utf-8 encode")}a[254]=a[254]=1,r.utf8encode=function(e){return i.nodebuffer?n.newBufferFrom(e,"utf-8"):function(e){var t,r,o,n,s,a=e.length,c=0;for(n=0;n<a;n++)55296==(64512&(r=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(o=e.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(o-56320),n++),c+=r<128?1:r<2048?2:r<65536?3:4;for(t=i.uint8array?new Uint8Array(c):new Array(c),n=s=0;s<c;n++)55296==(64512&(r=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(o=e.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(o-56320),n++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t}(e)},r.utf8decode=function(e){return i.nodebuffer?o.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,i,n,s=e.length,c=new Array(2*s);for(t=r=0;t<s;)if((i=e[t++])<128)c[r++]=i;else if(4<(n=a[i]))c[r++]=65533,t+=n-1;else{for(i&=2===n?31:3===n?15:7;1<n&&t<s;)i=i<<6|63&e[t++],n--;1<n?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return c.length!==r&&(c.subarray?c=c.subarray(0,r):c.length=r),o.applyFromCharCode(c)}(e=o.transformTo(i.uint8array?"uint8array":"array",e))},o.inherits(d,s),d.prototype.processChunk=function(e){var t=o.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var n=t;(t=new Uint8Array(n.length+this.leftOver.length)).set(this.leftOver,0),t.set(n,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var s=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+a[e[r]]>t?r:t}(t),c=t;s!==t.length&&(i.uint8array?(c=t.subarray(0,s),this.leftOver=t.subarray(s,t.length)):(c=t.slice(0,s),this.leftOver=t.slice(s,t.length))),this.push({data:r.utf8decode(c),meta:e.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=d,o.inherits(l,s),l.prototype.processChunk=function(e){this.push({data:r.utf8encode(e.data),meta:e.meta})},r.Utf8EncodeWorker=l},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,r){"use strict";var o=e("./support"),i=e("./base64"),n=e("./nodejsUtils"),s=e("set-immediate-shim"),a=e("./external");function c(e){return e}function d(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}r.newBlob=function(e,t){r.checkSupport("blob");try{return new Blob([e],{type:t})}catch(r){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return o.append(e),o.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(e,t,r){var o=[],i=0,n=e.length;if(n<=r)return String.fromCharCode.apply(null,e);for(;i<n;)"array"===t||"nodebuffer"===t?o.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+r,n)))):o.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+r,n)))),i+=r;return o.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&1===String.fromCharCode.apply(null,n.allocBuffer(1)).length}catch(e){return!1}}()}};function u(e){var t=65536,o=r.getTypeOf(e),i=!0;if("uint8array"===o?i=l.applyCanBeUsed.uint8array:"nodebuffer"===o&&(i=l.applyCanBeUsed.nodebuffer),i)for(;1<t;)try{return l.stringifyByChunk(e,o,t)}catch(e){t=Math.floor(t/2)}return l.stringifyByChar(e)}function h(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}r.applyFromCharCode=u;var p={};p.string={string:c,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return p.string.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:function(e){return d(e,n.allocBuffer(e.length))}},p.array={string:u,array:c,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return n.newBufferFrom(e)}},p.arraybuffer={string:function(e){return u(new Uint8Array(e))},array:function(e){return h(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:c,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return n.newBufferFrom(new Uint8Array(e))}},p.uint8array={string:u,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:c,nodebuffer:function(e){return n.newBufferFrom(e)}},p.nodebuffer={string:u,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return p.nodebuffer.uint8array(e).buffer},uint8array:function(e){return h(e,new Uint8Array(e.length))},nodebuffer:c},r.transformTo=function(e,t){if(t=t||"",!e)return t;r.checkSupport(e);var o=r.getTypeOf(t);return p[o][e](t)},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":o.nodebuffer&&n.isBuffer(e)?"nodebuffer":o.uint8array&&e instanceof Uint8Array?"uint8array":o.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){if(!o[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,o="";for(r=0;r<(e||"").length;r++)o+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return o},r.delay=function(e,t,r){s((function(){e.apply(r||null,t||[])}))},r.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},r.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},r.prepareContent=function(e,t,n,s,c){return a.Promise.resolve(t).then((function(e){return o.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise((function(t,r){var o=new FileReader;o.onload=function(e){t(e.target.result)},o.onerror=function(e){r(e.target.error)},o.readAsArrayBuffer(e)})):e})).then((function(t){var l=r.getTypeOf(t);return l?("arraybuffer"===l?t=r.transformTo("uint8array",t):"string"===l&&(c?t=i.decode(t):n&&!0!==s&&(t=function(e){return d(e,o.uint8array?new Uint8Array(e.length):new Array(e.length))}(t))),t):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(e,t,r){"use strict";var o=e("./reader/readerFor"),i=e("./utils"),n=e("./signature"),s=e("./zipEntry"),a=(e("./utf8"),e("./support"));function c(e){this.files=[],this.loadOptions=e}c.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var o=this.reader.readString(4)===t;return this.reader.setIndex(r),o},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",r=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,o=this.zip64EndOfCentralSize-44;0<o;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(e=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var o=t-r;if(0<o)this.isSignature(t,n.CENTRAL_FILE_HEADER)||(this.reader.zero=o);else if(o<0)throw new Error("Corrupted zip: missing "+Math.abs(o)+" bytes.")},prepareReader:function(e){this.reader=o(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,r){"use strict";var o=e("./reader/readerFor"),i=e("./utils"),n=e("./compressedObject"),s=e("./crc32"),a=e("./utf8"),c=e("./compressions"),d=e("./support");function l(e,t){this.options=e,this.loadOptions=t}l.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in c)if(c.hasOwnProperty(t)&&c[t].magic===e)return c[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=o(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,r,o,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),r=e.readInt(2),o=e.readData(r),this.extraFields[t]={id:t,length:r,value:o};e.setIndex(i)},handleUTF8:function(){var e=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var o=this.findExtraFieldUnicodeComment();if(null!==o)this.fileCommentStr=o;else{var n=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=o(e.value);return 1!==t.readInt(1)||s(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=o(e.value);return 1!==t.readInt(1)||s(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null}},t.exports=l},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,r){"use strict";function o(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var i=e("./stream/StreamHelper"),n=e("./stream/DataWorker"),s=e("./utf8"),a=e("./compressedObject"),c=e("./stream/GenericWorker");o.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");var o="string"===(r=e.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),t=this._decompressWorker();var n=!this._dataBinary;n&&!o&&(t=t.pipe(new s.Utf8EncodeWorker)),!n&&o&&(t=t.pipe(new s.Utf8DecodeWorker))}catch(e){(t=new c("error")).error(e)}return new i(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof a&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new s.Utf8EncodeWorker)),a.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof c?this._data:new n(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<d.length;u++)o.prototype[d[u]]=l;t.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,o){(function(e){"use strict";var r,o,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var n=0,s=new i(l),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),r=function(){a.data=n=++n%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var c=new e.MessageChannel;c.port1.onmessage=l,r=function(){c.port2.postMessage(0)}}var d=[];function l(){var e,t;o=!0;for(var r=d.length;r;){for(t=d,d=[],e=-1;++e<r;)t[e]();r=d.length}o=!1}t.exports=function(e){1!==d.push(e)||o||r()}}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,r){"use strict";var o=e("immediate");function i(){}var n={},s=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&p(this,e)}function l(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function u(e,t,r){o((function(){var o;try{o=t(r)}catch(o){return n.reject(e,o)}o===e?n.reject(e,new TypeError("Cannot resolve promise with itself")):n.resolve(e,o)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var r=!1;function o(t){r||(r=!0,n.reject(e,t))}function i(t){r||(r=!0,n.resolve(e,t))}var s=f((function(){t(i,o)}));"error"===s.status&&o(s.value)}function f(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=d).prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){throw r}))}))},d.prototype.catch=function(e){return this.then(null,e)},d.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var r=new this.constructor(i);return this.state!==c?u(r,this.state===a?e:t,this.outcome):this.queue.push(new l(r,e,t)),r},l.prototype.callFulfilled=function(e){n.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){n.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},n.resolve=function(e,t){var r=f(h,t);if("error"===r.status)return n.reject(e,r.value);var o=r.value;if(o)p(e,o);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},n.reject=function(e,t){e.state=s,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callRejected(t);return e},d.resolve=function(e){return e instanceof this?e:n.resolve(new this(i),e)},d.reject=function(e){var t=new this(i);return n.reject(t,e)},d.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var s=new Array(r),a=0,c=-1,d=new this(i);++c<r;)l(e[c],c);return d;function l(e,i){t.resolve(e).then((function(e){s[i]=e,++a!==r||o||(o=!0,n.resolve(d,s))}),(function(e){o||(o=!0,n.reject(d,e))}))}},d.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,r=!1;if(!t)return this.resolve([]);for(var o,s=-1,a=new this(i);++s<t;)o=e[s],this.resolve(o).then((function(e){r||(r=!0,n.resolve(a,e))}),(function(e){r||(r=!0,n.reject(a,e))}));return a}},{immediate:36}],38:[function(e,t,r){"use strict";var o={};(0,e("./lib/utils/common").assign)(o,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){"use strict";var o=e("./zlib/deflate"),i=e("./utils/common"),n=e("./utils/strings"),s=e("./zlib/messages"),a=e("./zlib/zstream"),c=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var r=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(s[r]);if(t.header&&o.deflateSetHeader(this.strm,t.header),t.dictionary){var l;if(l="string"==typeof t.dictionary?n.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(r=o.deflateSetDictionary(this.strm,l)))throw new Error(s[r]);this._dict_set=!0}}function l(e,t){var r=new d(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}d.prototype.push=function(e,t){var r,s,a=this.strm,d=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=n.string2buf(e):"[object ArrayBuffer]"===c.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new i.Buf8(d),a.next_out=0,a.avail_out=d),1!==(r=o.deflate(a,s))&&0!==r)return this.onEnd(r),!(this.ended=!0);0!==a.avail_out&&(0!==a.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(n.buf2binstring(i.shrinkBuf(a.output,a.next_out))):this.onData(i.shrinkBuf(a.output,a.next_out)))}while((0<a.avail_in||0===a.avail_out)&&1!==r);return 4===s?(r=o.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==s||(this.onEnd(0),!(a.avail_out=0))},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=d,r.deflate=l,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,l(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,l(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){"use strict";var o=e("./zlib/inflate"),i=e("./utils/common"),n=e("./utils/strings"),s=e("./zlib/constants"),a=e("./zlib/messages"),c=e("./zlib/zstream"),d=e("./zlib/gzheader"),l=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var r=o.inflateInit2(this.strm,t.windowBits);if(r!==s.Z_OK)throw new Error(a[r]);this.header=new d,o.inflateGetHeader(this.strm,this.header)}function h(e,t){var r=new u(t);if(r.push(e,!0),r.err)throw r.msg||a[r.err];return r.result}u.prototype.push=function(e,t){var r,a,c,d,u,h,p=this.strm,f=this.options.chunkSize,g=this.options.dictionary,m=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof e?p.input=n.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new i.Buf8(f),p.next_out=0,p.avail_out=f),(r=o.inflate(p,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&g&&(h="string"==typeof g?n.string2buf(g):"[object ArrayBuffer]"===l.call(g)?new Uint8Array(g):g,r=o.inflateSetDictionary(this.strm,h)),r===s.Z_BUF_ERROR&&!0===m&&(r=s.Z_OK,m=!1),r!==s.Z_STREAM_END&&r!==s.Z_OK)return this.onEnd(r),!(this.ended=!0);p.next_out&&(0!==p.avail_out&&r!==s.Z_STREAM_END&&(0!==p.avail_in||a!==s.Z_FINISH&&a!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(c=n.utf8border(p.output,p.next_out),d=p.next_out-c,u=n.buf2string(p.output,c),p.next_out=d,p.avail_out=f-d,d&&i.arraySet(p.output,p.output,c,d,0),this.onData(u)):this.onData(i.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(m=!0)}while((0<p.avail_in||0===p.avail_out)&&r!==s.Z_STREAM_END);return r===s.Z_STREAM_END&&(a=s.Z_FINISH),a===s.Z_FINISH?(r=o.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===s.Z_OK):a!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),!(p.avail_out=0))},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=u,r.inflate=h,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},r.ungzip=h},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){"use strict";var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,o,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+o),i);else for(var n=0;n<o;n++)e[i+n]=t[r+n]},flattenChunks:function(e){var t,r,o,i,n,s;for(t=o=0,r=e.length;t<r;t++)o+=e[t].length;for(s=new Uint8Array(o),t=i=0,r=e.length;t<r;t++)n=e[t],s.set(n,i),i+=n.length;return s}},n={arraySet:function(e,t,r,o,i){for(var n=0;n<o;n++)e[i+n]=t[r+n]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,n))},r.setTyped(o)},{}],42:[function(e,t,r){"use strict";var o=e("./common"),i=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){n=!1}for(var s=new o.Buf8(256),a=0;a<256;a++)s[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function c(e,t){if(t<65537&&(e.subarray&&n||!e.subarray&&i))return String.fromCharCode.apply(null,o.shrinkBuf(e,t));for(var r="",s=0;s<t;s++)r+=String.fromCharCode(e[s]);return r}s[254]=s[254]=1,r.string2buf=function(e){var t,r,i,n,s,a=e.length,c=0;for(n=0;n<a;n++)55296==(64512&(r=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=e.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),c+=r<128?1:r<2048?2:r<65536?3:4;for(t=new o.Buf8(c),n=s=0;s<c;n++)55296==(64512&(r=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=e.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t},r.buf2binstring=function(e){return c(e,e.length)},r.binstring2buf=function(e){for(var t=new o.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,o,i,n,a=t||e.length,d=new Array(2*a);for(r=o=0;r<a;)if((i=e[r++])<128)d[o++]=i;else if(4<(n=s[i]))d[o++]=65533,r+=n-1;else{for(i&=2===n?31:3===n?15:7;1<n&&r<a;)i=i<<6|63&e[r++],n--;1<n?d[o++]=65533:i<65536?d[o++]=i:(i-=65536,d[o++]=55296|i>>10&1023,d[o++]=56320|1023&i)}return c(d,o)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+s[e[r]]>t?r:t}},{"./common":41}],43:[function(e,t,r){"use strict";t.exports=function(e,t,r,o){for(var i=65535&e|0,n=e>>>16&65535|0,s=0;0!==r;){for(r-=s=2e3<r?2e3:r;n=n+(i=i+t[o++]|0)|0,--s;);i%=65521,n%=65521}return i|n<<16|0}},{}],44:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){"use strict";var o=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,i){var n=o,s=i+r;e^=-1;for(var a=i;a<s;a++)e=e>>>8^n[255&(e^t[a])];return-1^e}},{}],46:[function(e,t,r){"use strict";var o,i=e("../utils/common"),n=e("./trees"),s=e("./adler32"),a=e("./crc32"),c=e("./messages"),d=-2,l=258,u=262,h=113;function p(e,t){return e.msg=c[t],t}function f(e){return(e<<1)-(4<e?9:0)}function g(e){for(var t=e.length;0<=--t;)e[t]=0}function m(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function _(e,t){n._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,m(e.strm)}function v(e,t){e.pending_buf[e.pending++]=t}function E(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function y(e,t){var r,o,i=e.max_chain_length,n=e.strstart,s=e.prev_length,a=e.nice_match,c=e.strstart>e.w_size-u?e.strstart-(e.w_size-u):0,d=e.window,h=e.w_mask,p=e.prev,f=e.strstart+l,g=d[n+s-1],m=d[n+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(d[(r=t)+s]===m&&d[r+s-1]===g&&d[r]===d[n]&&d[++r]===d[n+1]){n+=2,r++;do{}while(d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&n<f);if(o=l-(f-n),n=f-l,s<o){if(e.match_start=t,a<=(s=o))break;g=d[n+s-1],m=d[n+s]}}}while((t=p[t&h])>c&&0!=--i);return s<=e.lookahead?s:e.lookahead}function S(e){var t,r,o,n,c,d,l,h,p,f,g=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-u)){for(i.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=r=e.hash_size;o=e.head[--t],e.head[t]=g<=o?o-g:0,--r;);for(t=r=g;o=e.prev[--t],e.prev[t]=g<=o?o-g:0,--r;);n+=g}if(0===e.strm.avail_in)break;if(d=e.strm,l=e.window,h=e.strstart+e.lookahead,f=void 0,(p=n)<(f=d.avail_in)&&(f=p),r=0===f?0:(d.avail_in-=f,i.arraySet(l,d.input,d.next_in,f,h),1===d.state.wrap?d.adler=s(d.adler,l,f,h):2===d.state.wrap&&(d.adler=a(d.adler,l,f,h)),d.next_in+=f,d.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<u&&0!==e.strm.avail_in)}function T(e,t){for(var r,o;;){if(e.lookahead<u){if(S(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-u&&(e.match_length=y(e,r)),e.match_length>=3)if(o=n._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else o=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}function b(e,t){for(var r,o,i;;){if(e.lookahead<u){if(S(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-u&&(e.match_length=y(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&4096<e.strstart-e.match_start)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-3,o=n._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(_(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((o=n._tr_tally(e,0,e.window[e.strstart-1]))&&_(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=n._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}function R(e,t,r,o,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=o,this.func=i}function C(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),g(this.dyn_ltree),g(this.dyn_dtree),g(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),g(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),g(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function I(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:h,e.adler=2===t.wrap?0:1,t.last_flush=0,n._tr_init(t),0):p(e,d)}function O(e){var t=I(e);return 0===t&&function(e){e.window_size=2*e.w_size,g(e.head),e.max_lazy_match=o[e.level].max_lazy,e.good_match=o[e.level].good_length,e.nice_match=o[e.level].nice_length,e.max_chain_length=o[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0}(e.state),t}function L(e,t,r,o,n,s){if(!e)return d;var a=1;if(-1===t&&(t=6),o<0?(a=0,o=-o):15<o&&(a=2,o-=16),n<1||9<n||8!==r||o<8||15<o||t<0||9<t||s<0||4<s)return p(e,d);8===o&&(o=9);var c=new C;return(e.state=c).strm=e,c.wrap=a,c.gzhead=null,c.w_bits=o,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=n+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<n+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=s,c.method=r,O(e)}o=[new R(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(S(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var o=e.block_start+r;if((0===e.strstart||e.strstart>=o)&&(e.lookahead=e.strstart-o,e.strstart=o,_(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-u&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(_(e,!1),e.strm.avail_out),1)})),new R(4,4,8,4,T),new R(4,5,16,8,T),new R(4,6,32,32,T),new R(4,4,16,16,b),new R(8,16,32,32,b),new R(8,16,128,128,b),new R(8,32,128,256,b),new R(32,128,258,1024,b),new R(32,258,258,4096,b)],r.deflateInit=function(e,t){return L(e,t,8,15,8,0)},r.deflateInit2=L,r.deflateReset=O,r.deflateResetKeep=I,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?d:(e.state.gzhead=t,0):d},r.deflate=function(e,t){var r,i,s,c;if(!e||!e.state||5<t||t<0)return e?p(e,d):d;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return p(e,0===e.avail_out?-5:d);if(i.strm=e,r=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,v(i,31),v(i,139),v(i,8),i.gzhead?(v(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),v(i,255&i.gzhead.time),v(i,i.gzhead.time>>8&255),v(i,i.gzhead.time>>16&255),v(i,i.gzhead.time>>24&255),v(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),v(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(v(i,255&i.gzhead.extra.length),v(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=a(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(v(i,0),v(i,0),v(i,0),v(i,0),v(i,0),v(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),v(i,3),i.status=h);else{var u=8+(i.w_bits-8<<4)<<8;u|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(u|=32),u+=31-u%31,i.status=h,E(i,u),0!==i.strstart&&(E(i,e.adler>>>16),E(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),m(e),s=i.pending,i.pending!==i.pending_buf_size));)v(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),m(e),s=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,v(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),0===c&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),m(e),s=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,v(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),0===c&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&m(e),i.pending+2<=i.pending_buf_size&&(v(i,255&e.adler),v(i,e.adler>>8&255),e.adler=0,i.status=h)):i.status=h),0!==i.pending){if(m(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&f(t)<=f(r)&&4!==t)return p(e,-5);if(666===i.status&&0!==e.avail_in)return p(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var y=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(S(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var r,o,i,s,a=e.window;;){if(e.lookahead<=l){if(S(e),e.lookahead<=l&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&0<e.strstart&&(o=a[i=e.strstart-1])===a[++i]&&o===a[++i]&&o===a[++i]){s=e.strstart+l;do{}while(o===a[++i]&&o===a[++i]&&o===a[++i]&&o===a[++i]&&o===a[++i]&&o===a[++i]&&o===a[++i]&&o===a[++i]&&i<s);e.match_length=l-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=n._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}(i,t):o[i.level].func(i,t);if(3!==y&&4!==y||(i.status=666),1===y||3===y)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===y&&(1===t?n._tr_align(i):5!==t&&(n._tr_stored_block(i,0,0,!1),3===t&&(g(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),m(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(v(i,255&e.adler),v(i,e.adler>>8&255),v(i,e.adler>>16&255),v(i,e.adler>>24&255),v(i,255&e.total_in),v(i,e.total_in>>8&255),v(i,e.total_in>>16&255),v(i,e.total_in>>24&255)):(E(i,e.adler>>>16),E(i,65535&e.adler)),m(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?0:1)},r.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&t!==h&&666!==t?p(e,d):(e.state=null,t===h?p(e,-3):0):d},r.deflateSetDictionary=function(e,t){var r,o,n,a,c,l,u,h,p=t.length;if(!e||!e.state)return d;if(2===(a=(r=e.state).wrap)||1===a&&42!==r.status||r.lookahead)return d;for(1===a&&(e.adler=s(e.adler,t,p,0)),r.wrap=0,p>=r.w_size&&(0===a&&(g(r.head),r.strstart=0,r.block_start=0,r.insert=0),h=new i.Buf8(r.w_size),i.arraySet(h,t,p-r.w_size,r.w_size,0),t=h,p=r.w_size),c=e.avail_in,l=e.next_in,u=e.input,e.avail_in=p,e.next_in=0,e.input=t,S(r);r.lookahead>=3;){for(o=r.strstart,n=r.lookahead-2;r.ins_h=(r.ins_h<<r.hash_shift^r.window[o+3-1])&r.hash_mask,r.prev[o&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=o,o++,--n;);r.strstart=o,r.lookahead=2,S(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=l,e.input=u,e.avail_in=c,r.wrap=a,0},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){"use strict";t.exports=function(e,t){var r,o,i,n,s,a,c,d,l,u,h,p,f,g,m,_,v,E,y,S,T,b,R,C,I;r=e.state,o=e.next_in,C=e.input,i=o+(e.avail_in-5),n=e.next_out,I=e.output,s=n-(t-e.avail_out),a=n+(e.avail_out-257),c=r.dmax,d=r.wsize,l=r.whave,u=r.wnext,h=r.window,p=r.hold,f=r.bits,g=r.lencode,m=r.distcode,_=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{f<15&&(p+=C[o++]<<f,f+=8,p+=C[o++]<<f,f+=8),E=g[p&_];t:for(;;){if(p>>>=y=E>>>24,f-=y,0==(y=E>>>16&255))I[n++]=65535&E;else{if(!(16&y)){if(0==(64&y)){E=g[(65535&E)+(p&(1<<y)-1)];continue t}if(32&y){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}S=65535&E,(y&=15)&&(f<y&&(p+=C[o++]<<f,f+=8),S+=p&(1<<y)-1,p>>>=y,f-=y),f<15&&(p+=C[o++]<<f,f+=8,p+=C[o++]<<f,f+=8),E=m[p&v];r:for(;;){if(p>>>=y=E>>>24,f-=y,!(16&(y=E>>>16&255))){if(0==(64&y)){E=m[(65535&E)+(p&(1<<y)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(T=65535&E,f<(y&=15)&&(p+=C[o++]<<f,(f+=8)<y&&(p+=C[o++]<<f,f+=8)),c<(T+=p&(1<<y)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(p>>>=y,f-=y,(y=n-s)<T){if(l<(y=T-y)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(R=h,(b=0)===u){if(b+=d-y,y<S){for(S-=y;I[n++]=h[b++],--y;);b=n-T,R=I}}else if(u<y){if(b+=d+u-y,(y-=u)<S){for(S-=y;I[n++]=h[b++],--y;);if(b=0,u<S){for(S-=y=u;I[n++]=h[b++],--y;);b=n-T,R=I}}}else if(b+=u-y,y<S){for(S-=y;I[n++]=h[b++],--y;);b=n-T,R=I}for(;2<S;)I[n++]=R[b++],I[n++]=R[b++],I[n++]=R[b++],S-=3;S&&(I[n++]=R[b++],1<S&&(I[n++]=R[b++]))}else{for(b=n-T;I[n++]=I[b++],I[n++]=I[b++],I[n++]=I[b++],2<(S-=3););S&&(I[n++]=I[b++],1<S&&(I[n++]=I[b++]))}break}}break}}while(o<i&&n<a);o-=S=f>>3,p&=(1<<(f-=S<<3))-1,e.next_in=o,e.next_out=n,e.avail_in=o<i?i-o+5:5-(o-i),e.avail_out=n<a?a-n+257:257-(n-a),r.hold=p,r.bits=f}},{}],49:[function(e,t,r){"use strict";var o=e("../utils/common"),i=e("./adler32"),n=e("./crc32"),s=e("./inffast"),a=e("./inftrees"),c=-2;function d(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function u(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new o.Buf32(852),t.distcode=t.distdyn=new o.Buf32(592),t.sane=1,t.back=-1,0):c}function h(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,u(e)):c}function p(e,t){var r,o;return e&&e.state?(o=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?c:(null!==o.window&&o.wbits!==t&&(o.window=null),o.wrap=r,o.wbits=t,h(e))):c}function f(e,t){var r,o;return e?(o=new l,(e.state=o).window=null,0!==(r=p(e,t))&&(e.state=null),r):c}var g,m,_=!0;function v(e){if(_){var t;for(g=new o.Buf32(512),m=new o.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(1,e.lens,0,288,g,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(2,e.lens,0,32,m,0,e.work,{bits:5}),_=!1}e.lencode=g,e.lenbits=9,e.distcode=m,e.distbits=5}function E(e,t,r,i){var n,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new o.Buf8(s.wsize)),i>=s.wsize?(o.arraySet(s.window,t,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(i<(n=s.wsize-s.wnext)&&(n=i),o.arraySet(s.window,t,r-i,n,s.wnext),(i-=n)?(o.arraySet(s.window,t,r-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0}r.inflateReset=h,r.inflateReset2=p,r.inflateResetKeep=u,r.inflateInit=function(e){return f(e,15)},r.inflateInit2=f,r.inflate=function(e,t){var r,l,u,h,p,f,g,m,_,y,S,T,b,R,C,I,O,L,w,M,A,N,k,P,x=0,D=new o.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;12===(r=e.state).mode&&(r.mode=13),p=e.next_out,u=e.output,g=e.avail_out,h=e.next_in,l=e.input,f=e.avail_in,m=r.hold,_=r.bits,y=f,S=g,N=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;_<16;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}if(2&r.wrap&&35615===m){D[r.check=0]=255&m,D[1]=m>>>8&255,r.check=n(r.check,D,2,0),_=m=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&m)){e.msg="unknown compression method",r.mode=30;break}if(_-=4,A=8+(15&(m>>>=4)),0===r.wbits)r.wbits=A;else if(A>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<A,e.adler=r.check=1,r.mode=512&m?10:12,_=m=0;break;case 2:for(;_<16;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}if(r.flags=m,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=m>>8&1),512&r.flags&&(D[0]=255&m,D[1]=m>>>8&255,r.check=n(r.check,D,2,0)),_=m=0,r.mode=3;case 3:for(;_<32;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}r.head&&(r.head.time=m),512&r.flags&&(D[0]=255&m,D[1]=m>>>8&255,D[2]=m>>>16&255,D[3]=m>>>24&255,r.check=n(r.check,D,4,0)),_=m=0,r.mode=4;case 4:for(;_<16;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}r.head&&(r.head.xflags=255&m,r.head.os=m>>8),512&r.flags&&(D[0]=255&m,D[1]=m>>>8&255,r.check=n(r.check,D,2,0)),_=m=0,r.mode=5;case 5:if(1024&r.flags){for(;_<16;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}r.length=m,r.head&&(r.head.extra_len=m),512&r.flags&&(D[0]=255&m,D[1]=m>>>8&255,r.check=n(r.check,D,2,0)),_=m=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(f<(T=r.length)&&(T=f),T&&(r.head&&(A=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),o.arraySet(r.head.extra,l,h,T,A)),512&r.flags&&(r.check=n(r.check,l,T,h)),f-=T,h+=T,r.length-=T),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===f)break e;for(T=0;A=l[h+T++],r.head&&A&&r.length<65536&&(r.head.name+=String.fromCharCode(A)),A&&T<f;);if(512&r.flags&&(r.check=n(r.check,l,T,h)),f-=T,h+=T,A)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===f)break e;for(T=0;A=l[h+T++],r.head&&A&&r.length<65536&&(r.head.comment+=String.fromCharCode(A)),A&&T<f;);if(512&r.flags&&(r.check=n(r.check,l,T,h)),f-=T,h+=T,A)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;_<16;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}if(m!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}_=m=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;_<32;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}e.adler=r.check=d(m),_=m=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=p,e.avail_out=g,e.next_in=h,e.avail_in=f,r.hold=m,r.bits=_,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){m>>>=7&_,_-=7&_,r.mode=27;break}for(;_<3;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}switch(r.last=1&m,_-=1,3&(m>>>=1)){case 0:r.mode=14;break;case 1:if(v(r),r.mode=20,6!==t)break;m>>>=2,_-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}m>>>=2,_-=2;break;case 14:for(m>>>=7&_,_-=7&_;_<32;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}if((65535&m)!=(m>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&m,_=m=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(T=r.length){if(f<T&&(T=f),g<T&&(T=g),0===T)break e;o.arraySet(u,l,h,T,p),f-=T,h+=T,g-=T,p+=T,r.length-=T;break}r.mode=12;break;case 17:for(;_<14;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}if(r.nlen=257+(31&m),m>>>=5,_-=5,r.ndist=1+(31&m),m>>>=5,_-=5,r.ncode=4+(15&m),m>>>=4,_-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;_<3;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}r.lens[U[r.have++]]=7&m,m>>>=3,_-=3}for(;r.have<19;)r.lens[U[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,k={bits:r.lenbits},N=a(0,r.lens,0,19,r.lencode,0,r.work,k),r.lenbits=k.bits,N){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;I=(x=r.lencode[m&(1<<r.lenbits)-1])>>>16&255,O=65535&x,!((C=x>>>24)<=_);){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}if(O<16)m>>>=C,_-=C,r.lens[r.have++]=O;else{if(16===O){for(P=C+2;_<P;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}if(m>>>=C,_-=C,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}A=r.lens[r.have-1],T=3+(3&m),m>>>=2,_-=2}else if(17===O){for(P=C+3;_<P;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}_-=C,A=0,T=3+(7&(m>>>=C)),m>>>=3,_-=3}else{for(P=C+7;_<P;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}_-=C,A=0,T=11+(127&(m>>>=C)),m>>>=7,_-=7}if(r.have+T>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;T--;)r.lens[r.have++]=A}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,k={bits:r.lenbits},N=a(1,r.lens,0,r.nlen,r.lencode,0,r.work,k),r.lenbits=k.bits,N){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,k={bits:r.distbits},N=a(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,k),r.distbits=k.bits,N){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=f&&258<=g){e.next_out=p,e.avail_out=g,e.next_in=h,e.avail_in=f,r.hold=m,r.bits=_,s(e,S),p=e.next_out,u=e.output,g=e.avail_out,h=e.next_in,l=e.input,f=e.avail_in,m=r.hold,_=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;I=(x=r.lencode[m&(1<<r.lenbits)-1])>>>16&255,O=65535&x,!((C=x>>>24)<=_);){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}if(I&&0==(240&I)){for(L=C,w=I,M=O;I=(x=r.lencode[M+((m&(1<<L+w)-1)>>L)])>>>16&255,O=65535&x,!(L+(C=x>>>24)<=_);){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}m>>>=L,_-=L,r.back+=L}if(m>>>=C,_-=C,r.back+=C,r.length=O,0===I){r.mode=26;break}if(32&I){r.back=-1,r.mode=12;break}if(64&I){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&I,r.mode=22;case 22:if(r.extra){for(P=r.extra;_<P;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}r.length+=m&(1<<r.extra)-1,m>>>=r.extra,_-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;I=(x=r.distcode[m&(1<<r.distbits)-1])>>>16&255,O=65535&x,!((C=x>>>24)<=_);){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}if(0==(240&I)){for(L=C,w=I,M=O;I=(x=r.distcode[M+((m&(1<<L+w)-1)>>L)])>>>16&255,O=65535&x,!(L+(C=x>>>24)<=_);){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}m>>>=L,_-=L,r.back+=L}if(m>>>=C,_-=C,r.back+=C,64&I){e.msg="invalid distance code",r.mode=30;break}r.offset=O,r.extra=15&I,r.mode=24;case 24:if(r.extra){for(P=r.extra;_<P;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}r.offset+=m&(1<<r.extra)-1,m>>>=r.extra,_-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===g)break e;if(T=S-g,r.offset>T){if((T=r.offset-T)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}b=T>r.wnext?(T-=r.wnext,r.wsize-T):r.wnext-T,T>r.length&&(T=r.length),R=r.window}else R=u,b=p-r.offset,T=r.length;for(g<T&&(T=g),g-=T,r.length-=T;u[p++]=R[b++],--T;);0===r.length&&(r.mode=21);break;case 26:if(0===g)break e;u[p++]=r.length,g--,r.mode=21;break;case 27:if(r.wrap){for(;_<32;){if(0===f)break e;f--,m|=l[h++]<<_,_+=8}if(S-=g,e.total_out+=S,r.total+=S,S&&(e.adler=r.check=r.flags?n(r.check,u,S,p-S):i(r.check,u,S,p-S)),S=g,(r.flags?m:d(m))!==r.check){e.msg="incorrect data check",r.mode=30;break}_=m=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;_<32;){if(0===f)break e;f--,m+=l[h++]<<_,_+=8}if(m!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}_=m=0}r.mode=29;case 29:N=1;break e;case 30:N=-3;break e;case 31:return-4;case 32:default:return c}return e.next_out=p,e.avail_out=g,e.next_in=h,e.avail_in=f,r.hold=m,r.bits=_,(r.wsize||S!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&E(e,e.output,e.next_out,S-e.avail_out)?(r.mode=31,-4):(y-=e.avail_in,S-=e.avail_out,e.total_in+=y,e.total_out+=S,r.total+=S,r.wrap&&S&&(e.adler=r.check=r.flags?n(r.check,u,S,e.next_out-S):i(r.check,u,S,e.next_out-S)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==y&&0===S||4===t)&&0===N&&(N=-5),N)},r.inflateEnd=function(e){if(!e||!e.state)return c;var t=e.state;return t.window&&(t.window=null),e.state=null,0},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?c:((r.head=t).done=!1,0):c},r.inflateSetDictionary=function(e,t){var r,o=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?c:11===r.mode&&i(1,t,o,0)!==r.check?-3:E(e,t,o,o)?(r.mode=31,-4):(r.havedict=1,0):c},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){"use strict";var o=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,c,d,l,u,h){var p,f,g,m,_,v,E,y,S,T=h.bits,b=0,R=0,C=0,I=0,O=0,L=0,w=0,M=0,A=0,N=0,k=null,P=0,x=new o.Buf16(16),D=new o.Buf16(16),U=null,B=0;for(b=0;b<=15;b++)x[b]=0;for(R=0;R<c;R++)x[t[r+R]]++;for(O=T,I=15;1<=I&&0===x[I];I--);if(I<O&&(O=I),0===I)return d[l++]=20971520,d[l++]=20971520,h.bits=1,0;for(C=1;C<I&&0===x[C];C++);for(O<C&&(O=C),b=M=1;b<=15;b++)if(M<<=1,(M-=x[b])<0)return-1;if(0<M&&(0===e||1!==I))return-1;for(D[1]=0,b=1;b<15;b++)D[b+1]=D[b]+x[b];for(R=0;R<c;R++)0!==t[r+R]&&(u[D[t[r+R]]++]=R);if(v=0===e?(k=U=u,19):1===e?(k=i,P-=257,U=n,B-=257,256):(k=s,U=a,-1),b=C,_=l,w=R=N=0,g=-1,m=(A=1<<(L=O))-1,1===e&&852<A||2===e&&592<A)return 1;for(;;){for(E=b-w,S=u[R]<v?(y=0,u[R]):u[R]>v?(y=U[B+u[R]],k[P+u[R]]):(y=96,0),p=1<<b-w,C=f=1<<L;d[_+(N>>w)+(f-=p)]=E<<24|y<<16|S|0,0!==f;);for(p=1<<b-1;N&p;)p>>=1;if(0!==p?(N&=p-1,N+=p):N=0,R++,0==--x[b]){if(b===I)break;b=t[r+u[R]]}if(O<b&&(N&m)!==g){for(0===w&&(w=O),_+=C,M=1<<(L=b-w);L+w<I&&!((M-=x[L+w])<=0);)L++,M<<=1;if(A+=1<<L,1===e&&852<A||2===e&&592<A)return 1;d[g=N&m]=O<<24|L<<16|_-l|0}}return 0!==N&&(d[_+N]=b-w<<24|64<<16|0),h.bits=O,0}},{"../utils/common":41}],51:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,r){"use strict";var o=e("../utils/common");function i(e){for(var t=e.length;0<=--t;)e[t]=0}var n=256,s=286,a=30,c=15,d=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],l=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],p=new Array(576);i(p);var f=new Array(60);i(f);var g=new Array(512);i(g);var m=new Array(256);i(m);var _=new Array(29);i(_);var v,E,y,S=new Array(a);function T(e,t,r,o,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=o,this.max_length=i,this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function R(e){return e<256?g[e]:g[256+(e>>>7)]}function C(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function I(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,C(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function O(e,t,r){I(e,r[2*t],r[2*t+1])}function L(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function w(e,t,r){var o,i,n=new Array(16),s=0;for(o=1;o<=c;o++)n[o]=s=s+r[o-1]<<1;for(i=0;i<=t;i++){var a=e[2*i+1];0!==a&&(e[2*i]=L(n[a]++,a))}}function M(e){var t;for(t=0;t<s;t++)e.dyn_ltree[2*t]=0;for(t=0;t<a;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function A(e){8<e.bi_valid?C(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function N(e,t,r,o){var i=2*t,n=2*r;return e[i]<e[n]||e[i]===e[n]&&o[t]<=o[r]}function k(e,t,r){for(var o=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&N(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!N(t,o,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=o}function P(e,t,r){var o,i,s,a,c=0;if(0!==e.last_lit)for(;o=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],i=e.pending_buf[e.l_buf+c],c++,0===o?O(e,i,t):(O(e,(s=m[i])+n+1,t),0!==(a=d[s])&&I(e,i-=_[s],a),O(e,s=R(--o),r),0!==(a=l[s])&&I(e,o-=S[s],a)),c<e.last_lit;);O(e,256,t)}function x(e,t){var r,o,i,n=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,d=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<d;r++)0!==n[2*r]?(e.heap[++e.heap_len]=l=r,e.depth[r]=0):n[2*r+1]=0;for(;e.heap_len<2;)n[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=s[2*i+1]);for(t.max_code=l,r=e.heap_len>>1;1<=r;r--)k(e,n,r);for(i=d;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],k(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=o,n[2*i]=n[2*r]+n[2*o],e.depth[i]=(e.depth[r]>=e.depth[o]?e.depth[r]:e.depth[o])+1,n[2*r+1]=n[2*o+1]=i,e.heap[1]=i++,k(e,n,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,o,i,n,s,a,d=t.dyn_tree,l=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(n=0;n<=c;n++)e.bl_count[n]=0;for(d[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)g<(n=d[2*d[2*(o=e.heap[r])+1]+1]+1)&&(n=g,m++),d[2*o+1]=n,l<o||(e.bl_count[n]++,s=0,f<=o&&(s=p[o-f]),a=d[2*o],e.opt_len+=a*(n+s),h&&(e.static_len+=a*(u[2*o+1]+s)));if(0!==m){do{for(n=g-1;0===e.bl_count[n];)n--;e.bl_count[n]--,e.bl_count[n+1]+=2,e.bl_count[g]--,m-=2}while(0<m);for(n=g;0!==n;n--)for(o=e.bl_count[n];0!==o;)l<(i=e.heap[--r])||(d[2*i+1]!==n&&(e.opt_len+=(n-d[2*i+1])*d[2*i],d[2*i+1]=n),o--)}}(e,t),w(n,l,e.bl_count)}function D(e,t,r){var o,i,n=-1,s=t[1],a=0,c=7,d=4;for(0===s&&(c=138,d=3),t[2*(r+1)+1]=65535,o=0;o<=r;o++)i=s,s=t[2*(o+1)+1],++a<c&&i===s||(a<d?e.bl_tree[2*i]+=a:0!==i?(i!==n&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,n=i,d=(a=0)===s?(c=138,3):i===s?(c=6,3):(c=7,4))}function U(e,t,r){var o,i,n=-1,s=t[1],a=0,c=7,d=4;for(0===s&&(c=138,d=3),o=0;o<=r;o++)if(i=s,s=t[2*(o+1)+1],!(++a<c&&i===s)){if(a<d)for(;O(e,i,e.bl_tree),0!=--a;);else 0!==i?(i!==n&&(O(e,i,e.bl_tree),a--),O(e,16,e.bl_tree),I(e,a-3,2)):a<=10?(O(e,17,e.bl_tree),I(e,a-3,3)):(O(e,18,e.bl_tree),I(e,a-11,7));n=i,d=(a=0)===s?(c=138,3):i===s?(c=6,3):(c=7,4)}}i(S);var B=!1;function Z(e,t,r,i){I(e,0+(i?1:0),3),function(e,t,r,i){A(e),C(e,r),C(e,~r),o.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r)}r._tr_init=function(e){B||(function(){var e,t,r,o,i,n=new Array(16);for(o=r=0;o<28;o++)for(_[o]=r,e=0;e<1<<d[o];e++)m[r++]=o;for(m[r-1]=o,o=i=0;o<16;o++)for(S[o]=i,e=0;e<1<<l[o];e++)g[i++]=o;for(i>>=7;o<a;o++)for(S[o]=i<<7,e=0;e<1<<l[o]-7;e++)g[256+i++]=o;for(t=0;t<=c;t++)n[t]=0;for(e=0;e<=143;)p[2*e+1]=8,e++,n[8]++;for(;e<=255;)p[2*e+1]=9,e++,n[9]++;for(;e<=279;)p[2*e+1]=7,e++,n[7]++;for(;e<=287;)p[2*e+1]=8,e++,n[8]++;for(w(p,287,n),e=0;e<a;e++)f[2*e+1]=5,f[2*e]=L(e,5);v=new T(p,d,257,s,c),E=new T(f,l,0,a,c),y=new T(new Array(0),u,0,19,7)}(),B=!0),e.l_desc=new b(e.dyn_ltree,v),e.d_desc=new b(e.dyn_dtree,E),e.bl_desc=new b(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,M(e)},r._tr_stored_block=Z,r._tr_flush_block=function(e,t,r,o){var i,s,a=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<n;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),x(e,e.l_desc),x(e,e.d_desc),a=function(e){var t;for(D(e,e.dyn_ltree,e.l_desc.max_code),D(e,e.dyn_dtree,e.d_desc.max_code),x(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==t?Z(e,t,r,o):4===e.strategy||s===i?(I(e,2+(o?1:0),3),P(e,p,f)):(I(e,4+(o?1:0),3),function(e,t,r,o){var i;for(I(e,t-257,5),I(e,r-1,5),I(e,o-4,4),i=0;i<o;i++)I(e,e.bl_tree[2*h[i]+1],3);U(e,e.dyn_ltree,t-1),U(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),P(e,e.dyn_ltree,e.dyn_dtree)),M(e),o&&A(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(m[r]+n+1)]++,e.dyn_dtree[2*R(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){I(e,2,3),O(e,256,p),function(e){16===e.bi_valid?(C(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,r){"use strict";t.exports="function"==typeof o?o:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},{}]},{},[10])(10)}).call(this,r(300).Buffer,r(61),r(304).setImmediate)},function(e,t,r){"use strict";(function(e){var o=r(301),i=r(302),n=r(303);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,r){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return d(this,e,t,r)}function d(e,t,r,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,o){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(o||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===o?new Uint8Array(t):void 0===o?new Uint8Array(t,r):new Uint8Array(t,r,o);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t);return e}(e,t,r,o):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var o=0|f(t,r),i=(e=a(e,o)).write(t,r);i!==o&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(c.isBuffer(t)){var r=0|p(t.length);return 0===(e=a(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(o=t.length)!=o?a(e,0):h(e,t);if("Buffer"===t.type&&n(t.data))return h(e,t.data)}var o;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(l(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function h(e,t){var r=t.length<0?0:0|p(t.length);e=a(e,r);for(var o=0;o<r;o+=1)e[o]=255&t[o];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(o)return H(e).length;t=(""+t).toLowerCase(),o=!0}}function g(e,t,r){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return w(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return O(this,t,r);case"latin1":case"binary":return L(this,t,r);case"base64":return C(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,r);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,r){var o=e[t];e[t]=e[r],e[r]=o}function _(e,t,r,o,i){if(0===e.length)return-1;if("string"==typeof r?(o=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=c.from(t,o)),c.isBuffer(t))return 0===t.length?-1:v(e,t,r,o,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,o,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,o,i){var n,s=1,a=e.length,c=t.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function d(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(n=r;n<a;n++)if(d(e,n)===d(t,-1===l?0:n-l)){if(-1===l&&(l=n),n-l+1===c)return l*s}else-1!==l&&(n-=n-l),l=-1}else for(r+c>a&&(r=a-c),n=r;n>=0;n--){for(var u=!0,h=0;h<c;h++)if(d(e,n+h)!==d(t,h)){u=!1;break}if(u)return n}return-1}function E(e,t,r,o){r=Number(r)||0;var i=e.length-r;o?(o=Number(o))>i&&(o=i):o=i;var n=t.length;if(n%2!=0)throw new TypeError("Invalid hex string");o>n/2&&(o=n/2);for(var s=0;s<o;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function y(e,t,r,o){return W(H(t,e.length-r),e,r,o)}function S(e,t,r,o){return W(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,o)}function T(e,t,r,o){return S(e,t,r,o)}function b(e,t,r,o){return W(G(t),e,r,o)}function R(e,t,r,o){return W(function(e,t){for(var r,o,i,n=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),o=r>>8,i=r%256,n.push(i),n.push(o);return n}(t,e.length-r),e,r,o)}function C(e,t,r){return 0===t&&r===e.length?o.fromByteArray(e):o.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);for(var o=[],i=t;i<r;){var n,s,a,c,d=e[i],l=null,u=d>239?4:d>223?3:d>191?2:1;if(i+u<=r)switch(u){case 1:d<128&&(l=d);break;case 2:128==(192&(n=e[i+1]))&&(c=(31&d)<<6|63&n)>127&&(l=c);break;case 3:n=e[i+1],s=e[i+2],128==(192&n)&&128==(192&s)&&(c=(15&d)<<12|(63&n)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:n=e[i+1],s=e[i+2],a=e[i+3],128==(192&n)&&128==(192&s)&&128==(192&a)&&(c=(15&d)<<18|(63&n)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,u=1):l>65535&&(l-=65536,o.push(l>>>10&1023|55296),l=56320|1023&l),o.push(l),i+=u}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",o=0;for(;o<t;)r+=String.fromCharCode.apply(String,e.slice(o,o+=4096));return r}(o)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,r){return d(null,e,t,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,r){return function(e,t,r,o){return l(t),t<=0?a(e,t):void 0!==r?"string"==typeof o?a(e,t).fill(r,o):a(e,t).fill(r):a(e,t)}(null,e,t,r)},c.allocUnsafe=function(e){return u(null,e)},c.allocUnsafeSlow=function(e){return u(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,o=t.length,i=0,n=Math.min(r,o);i<n;++i)if(e[i]!==t[i]){r=e[i],o=t[i];break}return r<o?-1:o<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!n(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var o=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(o,i),i+=s.length}return o},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,o,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===o&&(o=0),void 0===i&&(i=this.length),t<0||r>e.length||o<0||i>this.length)throw new RangeError("out of range index");if(o>=i&&t>=r)return 0;if(o>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var n=(i>>>=0)-(o>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(n,s),d=this.slice(o,i),l=e.slice(t,r),u=0;u<a;++u)if(d[u]!==l[u]){n=d[u],s=l[u];break}return n<s?-1:s<n?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return _(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return _(this,e,t,r,!1)},c.prototype.write=function(e,t,r,o){if(void 0===t)o="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)o=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===o&&(o="utf8")):(o=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var n=!1;;)switch(o){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return y(this,e,t,r);case"ascii":return S(this,e,t,r);case"latin1":case"binary":return T(this,e,t,r);case"base64":return b(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,t,r);default:if(n)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),n=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function O(e,t,r){var o="";r=Math.min(e.length,r);for(var i=t;i<r;++i)o+=String.fromCharCode(127&e[i]);return o}function L(e,t,r){var o="";r=Math.min(e.length,r);for(var i=t;i<r;++i)o+=String.fromCharCode(e[i]);return o}function w(e,t,r){var o=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>o)&&(r=o);for(var i="",n=t;n<r;++n)i+=Z(e[n]);return i}function M(e,t,r){for(var o=e.slice(t,r),i="",n=0;n<o.length;n+=2)i+=String.fromCharCode(o[n]+256*o[n+1]);return i}function A(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,r,o,i,n){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<n)throw new RangeError('"value" argument is out of bounds');if(r+o>e.length)throw new RangeError("Index out of range")}function k(e,t,r,o){t<0&&(t=65535+t+1);for(var i=0,n=Math.min(e.length-r,2);i<n;++i)e[r+i]=(t&255<<8*(o?i:1-i))>>>8*(o?i:1-i)}function P(e,t,r,o){t<0&&(t=4294967295+t+1);for(var i=0,n=Math.min(e.length-r,4);i<n;++i)e[r+i]=t>>>8*(o?i:3-i)&255}function x(e,t,r,o,i,n){if(r+o>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(e,t,r,o,n){return n||x(e,0,r,4),i.write(e,t,r,o,23,4),r+4}function U(e,t,r,o,n){return n||x(e,0,r,8),i.write(e,t,r,o,52,8),r+8}c.prototype.slice=function(e,t){var r,o=this.length;if((e=~~e)<0?(e+=o)<0&&(e=0):e>o&&(e=o),(t=void 0===t?o:~~t)<0?(t+=o)<0&&(t=0):t>o&&(t=o),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;r=new c(i,void 0);for(var n=0;n<i;++n)r[n]=this[n+e]}return r},c.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||A(e,t,this.length);for(var o=this[e],i=1,n=0;++n<t&&(i*=256);)o+=this[e+n]*i;return o},c.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||A(e,t,this.length);for(var o=this[e+--t],i=1;t>0&&(i*=256);)o+=this[e+--t]*i;return o},c.prototype.readUInt8=function(e,t){return t||A(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||A(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||A(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||A(e,t,this.length);for(var o=this[e],i=1,n=0;++n<t&&(i*=256);)o+=this[e+n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||A(e,t,this.length);for(var o=t,i=1,n=this[e+--o];o>0&&(i*=256);)n+=this[e+--o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readInt8=function(e,t){return t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||A(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){t||A(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||A(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||A(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||A(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||A(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,o){(e=+e,t|=0,r|=0,o)||N(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,n=0;for(this[t]=255&e;++n<r&&(i*=256);)this[t+n]=e/i&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,o){(e=+e,t|=0,r|=0,o)||N(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,n=1;for(this[t+i]=255&e;--i>=0&&(n*=256);)this[t+i]=e/n&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,r,o){if(e=+e,t|=0,!o){var i=Math.pow(2,8*r-1);N(this,e,t,r,i-1,-i)}var n=0,s=1,a=0;for(this[t]=255&e;++n<r&&(s*=256);)e<0&&0===a&&0!==this[t+n-1]&&(a=1),this[t+n]=(e/s>>0)-a&255;return t+r},c.prototype.writeIntBE=function(e,t,r,o){if(e=+e,t|=0,!o){var i=Math.pow(2,8*r-1);N(this,e,t,r,i-1,-i)}var n=r-1,s=1,a=0;for(this[t+n]=255&e;--n>=0&&(s*=256);)e<0&&0===a&&0!==this[t+n+1]&&(a=1),this[t+n]=(e/s>>0)-a&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,r){return D(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return D(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return U(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return U(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,o){if(r||(r=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<r&&(o=r),o===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-r&&(o=e.length-t+r);var i,n=o-r;if(this===e&&r<t&&t<o)for(i=n-1;i>=0;--i)e[i+t]=this[i+r];else if(n<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<n;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+n),t);return n},c.prototype.fill=function(e,t,r,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,r=this.length):"string"==typeof r&&(o=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!c.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var n;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(n=t;n<r;++n)this[n]=e;else{var s=c.isBuffer(e)?e:H(new c(e,o).toString()),a=s.length;for(n=0;n<r-t;++n)this[n+t]=s[n%a]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function Z(e){return e<16?"0"+e.toString(16):e.toString(16)}function H(e,t){var r;t=t||1/0;for(var o=e.length,i=null,n=[],s=0;s<o;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&n.push(239,191,189);continue}if(s+1===o){(t-=3)>-1&&n.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&n.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&n.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;n.push(r)}else if(r<2048){if((t-=2)<0)break;n.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;n.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;n.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return n}function G(e){return o.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,r,o){for(var i=0;i<o&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(61))},function(e,t,r){"use strict";t.byteLength=function(e){var t=d(e),r=t[0],o=t[1];return 3*(r+o)/4-o},t.toByteArray=function(e){var t,r,o=d(e),s=o[0],a=o[1],c=new n(function(e,t,r){return 3*(t+r)/4-r}(0,s,a)),l=0,u=a>0?s-4:s;for(r=0;r<u;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===a&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,c[l++]=255&t);1===a&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,n=[],s=0,a=r-i;s<a;s+=16383)n.push(l(e,s,s+16383>a?a:s+16383));1===i?(t=e[r-1],n.push(o[t>>2]+o[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],n.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"="));return n.join("")};for(var o=[],i=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)o[a]=s[a],i[s.charCodeAt(a)]=a;function d(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,r){for(var i,n,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(o[(n=i)>>18&63]+o[n>>12&63]+o[n>>6&63]+o[63&n]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,o,i){var n,s,a=8*i-o-1,c=(1<<a)-1,d=c>>1,l=-7,u=r?i-1:0,h=r?-1:1,p=e[t+u];for(u+=h,n=p&(1<<-l)-1,p>>=-l,l+=a;l>0;n=256*n+e[t+u],u+=h,l-=8);for(s=n&(1<<-l)-1,n>>=-l,l+=o;l>0;s=256*s+e[t+u],u+=h,l-=8);if(0===n)n=1-d;else{if(n===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,o),n-=d}return(p?-1:1)*s*Math.pow(2,n-o)},t.write=function(e,t,r,o,i,n){var s,a,c,d=8*n-i-1,l=(1<<d)-1,u=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=o?0:n-1,f=o?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+u>=1?h/c:h*Math.pow(2,1-u))*c>=2&&(s++,c/=2),s+u>=l?(a=0,s=l):s+u>=1?(a=(t*c-1)*Math.pow(2,i),s+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=f,a/=256,i-=8);for(s=s<<i|a,d+=i;d>0;e[r+p]=255&s,p+=f,s/=256,d-=8);e[r+p-f]|=128*g}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){(function(e){var o=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new n(i.call(setTimeout,o,arguments),clearTimeout)},t.setInterval=function(){return new n(i.call(setInterval,o,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(o,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(305),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(61))},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var o,i,n,s,a,c=1,d={},l=!1,u=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?o=function(e){t.nextTick((function(){f(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((n=new MessageChannel).port1.onmessage=function(e){f(e.data)},o=function(e){n.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(i=u.documentElement,o=function(e){var t=u.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):o=function(e){setTimeout(f,0,e)}:(s="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&f(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),o=function(t){e.postMessage(s+t,"*")}),h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return d[c]=i,o(c),c++},h.clearImmediate=p}function p(e){delete d[e]}function f(e){if(l)setTimeout(f,0,e);else{var t=d[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(void 0,r)}}(t)}finally{p(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(61),r(203))},function(e,t,r){var o=r(5),i=r(307);o({target:"Date",proto:!0,forced:Date.prototype.toISOString!==i},{toISOString:i})},function(e,t,r){"use strict";var o=r(8),i=r(239).start,n=Math.abs,s=Date.prototype,a=s.getTime,c=s.toISOString;e.exports=o((function(){return"0385-07-25T07:06:39.999Z"!=c.call(new Date(-50000000000001))}))||!o((function(){c.call(new Date(NaN))}))?function(){if(!isFinite(a.call(this)))throw RangeError("Invalid time value");var e=this.getUTCFullYear(),t=this.getUTCMilliseconds(),r=e<0?"-":e>9999?"+":"";return r+i(n(e),r?6:4,0)+"-"+i(this.getUTCMonth()+1,2,0)+"-"+i(this.getUTCDate(),2,0)+"T"+i(this.getUTCHours(),2,0)+":"+i(this.getUTCMinutes(),2,0)+":"+i(this.getUTCSeconds(),2,0)+"."+i(t,3,0)+"Z"}:c},function(e,t,r){r(5)({target:"Object",stat:!0},{setPrototypeOf:r(60)})},function(e,t,r){r(5)({target:"Object",stat:!0,sham:!r(19)},{create:r(47)})},function(e,t,r){"use strict";var o=r(5),i=r(324);o({target:"String",proto:!0,forced:r(325)("bold")},{bold:function(){return i(this,"b","","")}})},function(e,t,r){"use strict";var o=r(5),i=r(324);o({target:"String",proto:!0,forced:r(325)("italics")},{italics:function(){return i(this,"i","","")}})},function(e,t,r){e.exports=function(e,t){var r,o,i,n,s,a,c,d;for(r=3&e.length,o=e.length-r,i=t,s=3432918353,a=461845907,d=0;d<o;)c=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24,++d,i=27492+(65535&(n=5*(65535&(i=(i^=c=(65535&(c=(c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295)<<15|c>>>17))*a+(((c>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(n>>>16)&65535)<<16);switch(c=0,r){case 3:c^=(255&e.charCodeAt(d+2))<<16;case 2:c^=(255&e.charCodeAt(d+1))<<8;case 1:i^=c=(65535&(c=(c=(65535&(c^=255&e.charCodeAt(d)))*s+(((c>>>16)*s&65535)<<16)&4294967295)<<15|c>>>17))*a+(((c>>>16)*a&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}},function(e,t){e.exports=o;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function o(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function i(e){return!0===(e&&e.__isLong__)}o.prototype.__isLong__,Object.defineProperty(o.prototype,"__isLong__",{value:!0}),o.isLong=i;var n={},s={};function a(e,t){var r,o,i;return t?(i=0<=(e>>>=0)&&e<256)&&(o=s[e])?o:(r=d(e,(0|e)<0?-1:0,!0),i&&(s[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(o=n[e])?o:(r=d(e,e<0?-1:0,!1),i&&(n[e]=r),r)}function c(e,t){if(isNaN(e))return t?v:_;if(t){if(e<0)return v;if(e>=f)return b}else{if(e<=-g)return R;if(e+1>=g)return T}return e<0?c(-e,t).neg():d(e%p|0,e/p|0,t)}function d(e,t,r){return new o(e,t,r)}o.fromInt=a,o.fromNumber=c,o.fromBits=d;var l=Math.pow;function u(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return _;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var o;if((o=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===o)return u(e.substring(1),t,r).neg();for(var i=c(l(r,8)),n=_,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),d=parseInt(e.substring(s,s+a),r);if(a<8){var h=c(l(r,a));n=n.mul(h).add(c(d))}else n=(n=n.mul(i)).add(c(d))}return n.unsigned=t,n}function h(e,t){return"number"==typeof e?c(e,t):"string"==typeof e?u(e,t):d(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}o.fromString=u,o.fromValue=h;var p=4294967296,f=p*p,g=f/2,m=a(1<<24),_=a(0);o.ZERO=_;var v=a(0,!0);o.UZERO=v;var E=a(1);o.ONE=E;var y=a(1,!0);o.UONE=y;var S=a(-1);o.NEG_ONE=S;var T=d(-1,2147483647,!1);o.MAX_VALUE=T;var b=d(-1,-1,!0);o.MAX_UNSIGNED_VALUE=b;var R=d(0,-2147483648,!1);o.MIN_VALUE=R;var C=o.prototype;C.toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},C.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(R)){var t=c(e),r=this.div(t),o=r.mul(t).sub(this);return r.toString(e)+o.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=c(l(e,6),this.unsigned),n=this,s="";;){var a=n.div(i),d=(n.sub(a.mul(i)).toInt()>>>0).toString(e);if((n=a).isZero())return d+s;for(;d.length<6;)d="0"+d;s=""+d+s}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){if(this.isNegative())return this.eq(R)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},C.isZero=function(){return 0===this.high&&0===this.low},C.eqz=C.isZero,C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return 1==(1&this.low)},C.isEven=function(){return 0==(1&this.low)},C.equals=function(e){return i(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},C.eq=C.equals,C.notEquals=function(e){return!this.eq(e)},C.neq=C.notEquals,C.ne=C.notEquals,C.lessThan=function(e){return this.comp(e)<0},C.lt=C.lessThan,C.lessThanOrEqual=function(e){return this.comp(e)<=0},C.lte=C.lessThanOrEqual,C.le=C.lessThanOrEqual,C.greaterThan=function(e){return this.comp(e)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(e){return this.comp(e)>=0},C.gte=C.greaterThanOrEqual,C.ge=C.greaterThanOrEqual,C.compare=function(e){if(i(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(R)?R:this.not().add(E)},C.neg=C.negate,C.add=function(e){i(e)||(e=h(e));var t=this.high>>>16,r=65535&this.high,o=this.low>>>16,n=65535&this.low,s=e.high>>>16,a=65535&e.high,c=e.low>>>16,l=0,u=0,p=0,f=0;return p+=(f+=n+(65535&e.low))>>>16,u+=(p+=o+c)>>>16,l+=(u+=r+a)>>>16,l+=t+s,d((p&=65535)<<16|(f&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},C.subtract=function(e){return i(e)||(e=h(e)),this.add(e.neg())},C.sub=C.subtract,C.multiply=function(e){if(this.isZero())return _;if(i(e)||(e=h(e)),r)return d(r.mul(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned);if(e.isZero())return _;if(this.eq(R))return e.isOdd()?R:_;if(e.eq(R))return this.isOdd()?R:_;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return c(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,o=65535&this.high,n=this.low>>>16,s=65535&this.low,a=e.high>>>16,l=65535&e.high,u=e.low>>>16,p=65535&e.low,f=0,g=0,v=0,E=0;return v+=(E+=s*p)>>>16,g+=(v+=n*p)>>>16,v&=65535,g+=(v+=s*u)>>>16,f+=(g+=o*p)>>>16,g&=65535,f+=(g+=n*u)>>>16,g&=65535,f+=(g+=s*l)>>>16,f+=t*p+o*u+n*l+s*a,d((v&=65535)<<16|(E&=65535),(f&=65535)<<16|(g&=65535),this.unsigned)},C.mul=C.multiply,C.divide=function(e){if(i(e)||(e=h(e)),e.isZero())throw Error("division by zero");var t,o,n;if(r)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?d((this.unsigned?r.div_u:r.div_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:_;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return y;n=v}else{if(this.eq(R))return e.eq(E)||e.eq(S)?R:e.eq(R)?E:(t=this.shr(1).div(e).shl(1)).eq(_)?e.isNegative()?E:S:(o=this.sub(e.mul(t)),n=t.add(o.div(e)));if(e.eq(R))return this.unsigned?v:_;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=_}for(o=this;o.gte(e);){t=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),a=s<=48?1:l(2,s-48),u=c(t),p=u.mul(e);p.isNegative()||p.gt(o);)p=(u=c(t-=a,this.unsigned)).mul(e);u.isZero()&&(u=E),n=n.add(u),o=o.sub(p)}return n},C.div=C.divide,C.modulo=function(e){return i(e)||(e=h(e)),r?d((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},C.mod=C.modulo,C.rem=C.modulo,C.not=function(){return d(~this.low,~this.high,this.unsigned)},C.and=function(e){return i(e)||(e=h(e)),d(this.low&e.low,this.high&e.high,this.unsigned)},C.or=function(e){return i(e)||(e=h(e)),d(this.low|e.low,this.high|e.high,this.unsigned)},C.xor=function(e){return i(e)||(e=h(e)),d(this.low^e.low,this.high^e.high,this.unsigned)},C.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?d(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):d(0,this.low<<e-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?d(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):d(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(e){if(i(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?d(this.low>>>e|t<<32-e,t>>>e,this.unsigned):d(32===e?t:t>>>e-32,0,this.unsigned)},C.shru=C.shiftRightUnsigned,C.shr_u=C.shiftRightUnsigned,C.toSigned=function(){return this.unsigned?d(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:d(this.low,this.high,!0)},C.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},C.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},o.fromBytes=function(e,t,r){return r?o.fromBytesLE(e,t):o.fromBytesBE(e,t)},o.fromBytesLE=function(e,t){return new o(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},o.fromBytesBE=function(e,t){return new o(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t){!function(){if(-1!==window.navigator.userAgent.indexOf("Trident")){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}e.prototype=window.Event.prototype,window.CustomEvent=e,document.body.scrollTo||(Element.prototype.scrollTo=function(e,t){this.scrollLeft=e,this.scrollTop=t}),document.body.scrollBy||(Element.prototype.scrollBy=function(e,t){this.scrollLeft+=e,this.scrollTop+=t}),FileReader.prototype.readAsBinaryString||(FileReader.prototype.readAsBinaryString=function(e){var t=this,r=new FileReader;r.onload=function(e){for(var o="",i=new Uint8Array(r.result),n=i.byteLength,s=0;s<n;s++)o+=String.fromCharCode(i[s]);t.content=o,t.result=o,t.onload()},r.readAsArrayBuffer(e)})}}()},function(e,t,r){"use strict";var o,i=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},n=function(){var e={};return function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}e[t]=r}return e[t]}}(),s=[];function a(e){for(var t=-1,r=0;r<s.length;r++)if(s[r].identifier===e){t=r;break}return t}function c(e,t){for(var r={},o=[],i=0;i<e.length;i++){var n=e[i],c=t.base?n[0]+t.base:n[0],d=r[c]||0,l="".concat(c," ").concat(d);r[c]=d+1;var u=a(l),h={css:n[1],media:n[2],sourceMap:n[3]};-1!==u?(s[u].references++,s[u].updater(h)):s.push({identifier:l,updater:m(h,t),references:1}),o.push(l)}return o}function d(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var i=r.nc;i&&(o.nonce=i)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var s=n(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var l,u=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function h(e,t,r,o){var i=r?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=u(t,i);else{var n=document.createTextNode(i),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(n,s[t]):e.appendChild(n)}}function p(e,t,r){var o=r.css,i=r.media,n=r.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),n&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var f=null,g=0;function m(e,t){var r,o,i;if(t.singleton){var n=g++;r=f||(f=d(t)),o=h.bind(null,r,n,!1),i=h.bind(null,r,n,!0)}else r=d(t),o=p.bind(null,r,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=i());var r=c(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<r.length;o++){var i=a(r[o]);s[i].references--}for(var n=c(e,t),d=0;d<r.length;d++){var l=a(r[d]);0===s[l].references&&(s[l].updater(),s.splice(l,1))}r=n}}}},function(e,t,r){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r=e[1]||"",o=e[3];if(!o)return r;if(t&&"function"==typeof btoa){var i=(s=o,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),n=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[r].concat(n).concat([i]).join("\n")}var s,a,c;return[r].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r})).join("")},t.i=function(e,r,o){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(o)for(var n=0;n<this.length;n++){var s=this[n][0];null!=s&&(i[s]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);o&&i[c[0]]||(r&&(c[2]?c[2]="".concat(r," and ").concat(c[2]):c[2]=r),t.push(c))}},t}},function(e,t,r){r(5)({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991})},,,,,function(e,t){var r=1..valueOf;e.exports=function(e){return r.call(e)}},function(e,t,r){var o=r(5),i=r(340).values;o({target:"Object",stat:!0},{values:function(e){return i(e)}})},function(e,t,r){var o=r(37),i=r(21),n=/"/g;e.exports=function(e,t,r,s){var a=i(o(e)),c="<"+t;return""!==r&&(c+=" "+r+'="'+i(s).replace(n,"&quot;")+'"'),c+">"+a+"</"+t+">"}},function(e,t,r){var o=r(8);e.exports=function(e){return o((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},function(e,t,r){var o=r(5),i=r(194);o({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})},function(e,t,r){"use strict";var o=r(192);(0,r(11).exportTypedArrayStaticMethod)("from",r(193),o)},function(e,t,r){r(191)("Int32",(function(e){return function(t,r,o){return e(this,t,r,o)}}))},function(e,t,r){"use strict";e.exports=u;var o,i=r(157),n=i.LongBits,s=i.base64,a=i.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function d(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function u(){this.len=0,this.head=new c(d,0,0),this.tail=this.head,this.states=null}var h=function(){return i.Buffer?function(){return(u.create=function(){return new o})()}:function(){return new u}};function p(e,t,r){t[r]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function m(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}u.create=h(),u.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(u.alloc=i.pool(u.alloc,i.Array.prototype.subarray)),u.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},f.prototype=Object.create(c.prototype),f.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},u.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},u.prototype.int32=function(e){return e<0?this._push(g,10,n.fromNumber(e)):this.uint32(e)},u.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},u.prototype.uint64=function(e){var t=n.from(e);return this._push(g,t.length(),t)},u.prototype.int64=u.prototype.uint64,u.prototype.sint64=function(e){var t=n.from(e).zzEncode();return this._push(g,t.length(),t)},u.prototype.bool=function(e){return this._push(p,1,e?1:0)},u.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},u.prototype.sfixed32=u.prototype.fixed32,u.prototype.fixed64=function(e){var t=n.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},u.prototype.sfixed64=u.prototype.fixed64,u.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},u.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var _=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var o=0;o<e.length;++o)t[r+o]=e[o]};u.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var r=u.alloc(t=s.length(e));s.decode(e,r,0),e=r}return this.uint32(t)._push(_,t,e)},u.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},u.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(d,0,0),this.len=0,this},u.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(d,0,0),this.len=0),this},u.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},u.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},u._configure=function(e){o=e,u.create=h(),o._configure()}},function(e,t,r){"use strict";e.exports=c;var o,i=r(157),n=i.LongBits,s=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var d,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},u=function(){return i.Buffer?function(e){return(c.create=function(e){return i.Buffer.isBuffer(e)?new o(e):l(e)})(e)}:l};function h(){var e=new n(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new n(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=u(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=(d=4294967295,function(){if(d=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return d;if(d=(d|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return d;if(d=(d|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return d;if(d=(d|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return d;if(d=(d|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return d;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return d}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){o=e,c.create=u(),o._configure();var t=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},function(e,t,r){var o;!function(){"use strict";function i(e,t,r){var o=t.x,i=t.y,n=r.x-o,s=r.y-i;if(0!==n||0!==s){var a=((e.x-o)*n+(e.y-i)*s)/(n*n+s*s);a>1?(o=r.x,i=r.y):a>0&&(o+=n*a,i+=s*a)}return(n=e.x-o)*n+(s=e.y-i)*s}function n(e,t){var r=e.length-1,o=[e[0]];return function e(t,r,o,n,s){for(var a,c=n,d=r+1;d<o;d++){var l=i(t[d],t[r],t[o]);l>c&&(a=d,c=l)}c>n&&(a-r>1&&e(t,r,a,n,s),s.push(t[a]),o-a>1&&e(t,a,o,n,s))}(e,0,r,t,o),o.push(e[r]),o}function s(e,t,r){if(e.length<=2)return e;var o=void 0!==t?t*t:1;return e=n(e=r?e:function(e,t){for(var r,o,i,n,s,a=e[0],c=[a],d=1,l=e.length;d<l;d++)r=e[d],i=a,n=void 0,s=void 0,n=(o=r).x-i.x,s=o.y-i.y,n*n+s*s>t&&(c.push(r),a=r);return a!==r&&c.push(r),c}(e,o),o)}void 0===(o=function(){return s}.call(t,r,t,e))||(e.exports=o)}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return se}));r(308),r(309),r(40),r(38),r(50),r(72),r(73),r(74),r(32),r(44),r(57),r(48),r(49),r(95),r(51),r(174),r(63),r(96),r(326),r(75);var o,i,n,s,a,c,d=r(179),l=r.n(d),u=r(118),h=function(){return(h=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},p=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},f=function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},g=function(){function e(){this.axiosInstance=l.a.create(),this.config=null,this.domains={},this.fileDomain=""}return e.prototype.setConfig=function(e){if(!this.config){var t=e.isTestEnv?"https://docservice-test.zego.im":"https://docservice.zego.im";this.fileDomain=e.isTestEnv?"https://docservice-storage-test.zego.im/":"https://docservice-storage.zego.im/",this.domains={cvt:t+"/doc/cvt_doc",query:t+"/doc/query_status",access:t+"/doc/access"},this.config={platform:32,app_id:e.appID,web_token:e.token,id_name:e.userID}}},e.prototype.isConfiged=function(){return!!this.config},e.prototype.uploadImage=function(e,t){return p(this,void 0,void 0,(function(){var r=this;return f(this,(function(o){return[2,new Promise((function(o,i){return p(r,void 0,void 0,(function(){var r,n,s,a,c,d,l,h,p,g;return f(this,(function(f){switch(f.label){case 0:return f.trys.push([0,9,,10]),r=e.name,n=e.size,s=r.substr(r.lastIndexOf(".")+1).toLowerCase(),[4,Object(u.a)(e)];case 1:return a=f.sent(),[4,this.queryStatus(a)];case 2:return c=f.sent(),d=c.status,l=c.oss,h=c.file_id,1!==d?[3,4]:[4,this.upload(l,e,r,a,s,t,o)];case 3:return f.sent(),[3,8];case 4:return 16!==d?[3,6]:(p=o,[4,this.load(h)]);case 5:return p.apply(void 0,[f.sent()]),[3,8];case 6:return[4,this.repeatQuery(r,a,n,"",o)];case 7:f.sent(),f.label=8;case 8:return[3,10];case 9:return!(g=f.sent())||2010001!=g.code&&2020006!=g.code||(g.code=3030010,g.msg=g.message),i(g),[3,10];case 10:return[2]}}))}))}))]}))}))},e.prototype.repeatQuery=function(e,t,r,o,i){return p(this,void 0,void 0,(function(){var n,s,a,c,d=this;return f(this,(function(l){switch(l.label){case 0:return[4,this.queryStatus(t,o)];case 1:return n=l.sent(),s=n.status,a=n.file_id,16===s&&i?(c=i,[4,this.load(a)]):[3,3];case 2:return c.apply(void 0,[l.sent()]),[3,6];case 3:return 2!==s?[3,5]:[4,this.cvt(e,t,r,i)];case 4:return l.sent(),[3,6];case 5:4!==s&&8!==s||setTimeout((function(){return p(d,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this.repeatQuery(e,t,r,o,i)];case 1:return n.sent(),[2]}}))}))}),2e3),l.label=6;case 6:return[2]}}))}))},e.prototype.queryStatus=function(e,t){return p(this,void 0,void 0,(function(){var r,o,i,n,s,a;return f(this,(function(c){switch(c.label){case 0:return r=h(h({},this.config),t?{task_id:t}:{file_hash:e,file_type:16,expect_file_type:16}),[4,this.axiosInstance({method:"post",url:this.domains.query,timeout:3e4,data:r})];case 1:return o=c.sent().data,i=o.ret,n=o.status,s=o.file_id,a=o.oss,0===i.code?[2,{status:n,file_id:s,oss:a}]:[2]}}))}))},e.prototype.upload=function(e,t,r,o,i,n,s){return p(this,void 0,void 0,(function(){var a,c,d;return f(this,(function(l){switch(l.label){case 0:return a=e.host?e.host+"/"+e.object_name+"?."+i:this.fileDomain+"/"+e.object_name+"?."+i,c=Object(u.b)(e),(d=new FormData).append("OSSAccessKeyId",c.OSSAccessKeyId),d.append("x-oss-security-token",c.securityToken),d.append("signature",c.signature),d.append("policy",c.policy),d.append("successActionStatus",c.successActionStatus),d.append("key",c.objectName),d.append("file",t),d.append("name",r),[4,this.axiosInstance({method:"post",url:c.url,data:d,timeout:6e5,onUploadProgress:function(e){if(n){var t=e.total,i=e.loaded;n({fileName:r,fileHash:o,uploadPercent:Math.floor(i/t*100)})}}})];case 1:return l.sent(),this.cvt(r,o,t.size,void 0),s(a),[2]}}))}))},e.prototype.cvt=function(e,t,r,o){return p(this,void 0,void 0,(function(){var i;return f(this,(function(n){switch(n.label){case 0:return[4,this.axiosInstance({method:"post",url:this.domains.cvt,timeout:3e4,data:h(h({},this.config),{file_name:e,file_hash:t,file_size:r,file_type:16,expect_file_type:16,export_high_quality_images:!1})})];case 1:return 0===(i=n.sent().data).ret.code&&o?[4,this.repeatQuery(e,t,r,i.task_id,o)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},e.prototype.load=function(e){return p(this,void 0,void 0,(function(){var t,r;return f(this,(function(o){switch(o.label){case 0:return[4,this.axiosInstance({method:"post",url:this.domains.access,timeout:3e4,data:h(h({},this.config),{file_id:e})})];case 1:if(0===(t=o.sent().data).ret.code)return r=t.file_name.substr(t.file_name.lastIndexOf(".")+1).toLowerCase(),[2,t.original_file_urls[0]+"?."+r];throw{code:t.ret.code,msg:t.ret.message,message:t.ret.message}}}))}))},e}(),m={ModifyMod:"/eduv1/modify_mod",DestroyMod:"/eduv1/destroy_mod",CreateMod:"/eduv1/create_mod",GetMod:"/eduv1/get_mod",GetModList:"/eduv1/get_mod_list",GetPageGraphics:"/eduv1/get_page_graphics",ClearPageGraphics:"/eduv1/clear_page_graphics",DrawPageGraphics:"/eduv1/draw_page_graphics",Sync:"/eduv1/sync",GetRoomAuth:"/eduv1/get_room_auth",GetUserAuth:"/eduv1/get_user_auth"},_=(r(65),r(41),r(84),r(131),r(132),r(133),r(134),r(135),r(136),r(137),r(138),r(139),r(140),r(141),r(142),r(143),r(144),r(145),r(146),r(147),r(148),r(149),r(150),r(151),r(152),r(153),r(154),r(155),r(221),r(327),r(328),r(99),r(105),r(3)),v=r(6),E=r(0),y=_.a.calStandard.placeWidth,S=function(e,t,r){var o=e[t];e[t]=e[r],e[r]=o},T=function(e,t,r,o){var i=o.charCodeAt(t);e[t]=o.charCodeAt(r),e[r]=i},b=function(e){return btoa(String.fromCharCode.apply(null,e))},R=function(e){var t=unescape(encodeURIComponent(e)).split("").map((function(e){return e.charCodeAt(0)}));return new Uint8Array(t)},C=function(e){return decodeURIComponent(escape(String.fromCharCode.apply(String,Array.from(e))))},I=function(e){for(var t=e.split(","),r=new Uint8Array(Int32Array.from([+t[0],+t[1]]).buffer),o=0;o<r.length;o+=4)S(r,o,o+3),S(r,o+1,o+2);var i=R(t.slice(2).join(",")),n=new Uint8Array(r.length+i.length);return n.set(r),n.set(i,r.length),n},O=function(e){for(var t=atob(e),r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return C(r)},L=function(e,t){var r=e.type,o=e.action,i=e.is_end_draw,n=e.data;if("[object Uint8Array]"==Object.prototype.toString.call(n)&&(n=btoa(Array.prototype.map.call(n,(function(e){return String.fromCharCode(e)})).join(""))),r===E.f.Text)e.data=t?function(e){for(var t=atob(e),r=new Uint8Array(t.length),o=0;o<8;o+=4)T(r,o,o+3,t),T(r,o+1,o+2,t);for(;o<t.length;o++)r[o]=t.charCodeAt(o);var i=new Int32Array(r.slice(0,8).buffer);return i[0]+","+i[1]+","+C(r.slice(8))}(n):b(I(n));else if(r===E.f.Image||r===E.f.BgImage)e.data=t?JSON.parse(O(n)):b(R(JSON.stringify(n)));else if(t)if("[object Array]"==Object.prototype.toString.call(n))e.data=n;else{for(var s=atob(n||""),a=new Uint8Array(s.length),c=0;c<s.length;c+=4)T(a,c,c+3,s),T(a,c+1,c+2,s);e.data=Array.from(new Int32Array(a.buffer)),e.data=e.data.slice(r!==E.f.RealTime&&e.data.length%2?1:0)}else{var d=n.slice();(r!==E.f.Pencil||i||o!==E.a.Create&&o!==E.a.Append)&&d.unshift(d.length/2);for(a=new Uint8Array(Int32Array.from(d).buffer),c=0;c<a.length;c+=4)S(a,c,c+3),S(a,c+1,c+2);e.data=b(a)}},w=function(e,t){var r=e.type,o=e.data,i=e.action,n=e.is_end_draw;if(r===E.f.Text)e.data=t?function(e){for(var t=0;t<8;t+=4)S(e,t,t+3),S(e,t+1,t+2);var r=new Int32Array(e.slice(0,8).buffer);return r[0]+","+r[1]+","+C(e.slice(8))}(o):I(o);else if(r===E.f.Image||r===E.f.BgImage)e.data=t?JSON.parse(C(o)):R(JSON.stringify(o));else if(t){for(var s=o,a=0;a<s.length;a+=4)S(s,a,a+3),S(s,a+1,a+2);e.data=Array.from(new Int32Array(s.slice().buffer)),e.data=e.data.slice(r!==E.f.RealTime&&e.data.length%2?1:0)}else{var c=o.slice();(r!==E.f.Pencil||n||i!==E.a.Create&&i!==E.a.Append)&&c.unshift(c.length/2);for(s=new Uint8Array(Int32Array.from(c).buffer),a=0;a<s.length;a+=4)S(s,a,a+3),S(s,a+1,a+2);e.data=s}},M=function(e,t,r,o,i,n,s){void 0===n&&(n=0),void 0===s&&(s=1);var a=0;return a=o?e*t/r+e*t/r*n/s:(e+(n=e*n/s))*r/t,o&&i?a:Math.round(a)},A=function(e,t,r,o,i){void 0===o&&(o=0),void 0===i&&(i=1);var n=e.type,s=e.px,a=e.py,c=e.x,d=e.y,l=Object(v.j)(e);if(s&&(e.px=M(s,t,y,r,!1)),a&&(e.py=M(a,t,y,r,!1,o,i)),e.x=M(c||0,t,y,r,!1),e.y=M(d||0,t,y,r,!1,o,i),n!==E.f.BgImage)if(n===E.f.Text){var u=e.data.split(",");u[0]=M(+u[0],t,y,r,l)+"",u[1]=M(+u[1],t,y,r,l,o,i)+"",e.data=u.join(",")}else if(n===E.f.Image){var h=e.data;h.x=M(h.x,t,y,r,l),h.y=M(h.y,t,y,r,l,o,i),h.ex=M(h.ex,t,y,r,l),h.ey=M(h.ey,t,y,r,l,o,i),r?(e.initX=h.x,e.initY=h.y,h.x+=e.x,h.y+=e.y,h.ex+=e.x,h.ey+=e.y):e.data=h}else e.data=e.data.map((function(e,n){return n%2==0?M(e,t,y,r,l,0):M(e,t,y,r,l,o,i)}))},N=function(e,t,r,o){var i=o.filePageSize,n=o.pageCount,s=(null==i?void 0:i.fillPPT)?t:r*n;return i&&s-i.height*e*n/i.width||0},k=r(9),P=r(1),x=function(){return(x=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},D=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},U=function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},B=function(){function e(e,t){this.socket=e,this.module=t,this.docsService=new g}return e.prototype.updateRemoteImageGraphicData=function(e,t){return(e=JSON.parse(JSON.stringify(e))).forEach((function(e){var r=e.type,o=e.action,i=e.x,n=e.y;if(r==E.f.Image&&(!t&&(o==E.a.Update||o==E.a.Create)||t&&o==E.a.Move)){var s=e.data;s.x-=i,s.y-=n,s.ex-=i,s.ey-=n}})),e},e.prototype.posToPageNum=function(e,t,r,o,i,n,s){var a=r.cx,c=r.cy,d=0;return a&&c&&(o+=n,i+=s,d=(d=(d=e===E.o.Horizontal?o<=0?0:Math.floor(o/a):i<=0?0:Math.floor(i/c))>t-1?t-1:d)>99?99:d),d},e.prototype.mapPageNumList=function(e){for(var t=[],r=Math.min.apply(Math,e),o=Math.max.apply(Math,e),i=r;i<=o;i++)t.push(i);return t},e.prototype.judgeGraphicPage=function(e,t){var r=this,o=this.module.getMap(e),i=o.innerDirection,n=o.innerPageSize,s=o.innerPageCount,a=t.type,c=t.x,d=t.y,l=[];switch(a){case E.f.Text:var u=Object(v.q)(t.data),h=u.beginX,p=u.beginY,f=this.posToPageNum(i,s,n,Number(h),Number(p),c,d);l=this.mapPageNumList([f]);break;case E.f.Pencil:case E.f.Line:case E.f.Rect:case E.f.Ellipse:case E.f.Laser:var g=[];t.data.forEach((function(e,t,o){t%2||g.push(r.posToPageNum(i,s,n,o[t],o[t+1],c,d))})),l=this.mapPageNumList(g);break;case E.f.Image:var m=t.data,_=m.x,y=m.y,S=m.ex,T=m.ey,b=this.posToPageNum(i,s,n,_,y,0,0),R=this.posToPageNum(i,s,n,S,T,0,0);l=this.mapPageNumList([b,R]);break;case E.f.BgImage:l.push(0)}return l},e.prototype.checkProtoGraphic=function(e){var t=e.action,r=e.action_type,o=e.graphic_id,i=e.type,n=e.data,s=e.color,a=e.size,c=e.x,d=e.y,l=e.zorder,u=e.attributes,h=e.operate_id,p=e.is_end_draw,f={graphic_id:o,action:t,action_type:r,type:i,is_end_draw:!!p,layer:e.layer||0,zorder:l,creator_id:e.creator_id,operate_id:h};return t===E.a.Create||t===E.a.Append?(f.x=c,f.y=d,f.data=n,f.color=s,f.size=a,i!==E.f.Text&&i!==E.f.Pencil||(f.attributes=u)):t===E.a.Update?(f.x=c,f.y=d,f.data=n,i!==E.f.Image&&(f.color=s,f.size=a),i!==E.f.Text&&i!==E.f.Pencil||(f.attributes=u)):t===E.a.Move&&(f.x=c,f.y=d),i!==E.f.Pencil||p||t!==E.a.Create&&t!==E.a.Append||(f.type=E.f.RealTime),f},e.prototype.mapDrawPages=function(e,t){var r=this,o=this.module.getMap(e);if(!o)return[];var i=this.socket.isSendPB,n=o.width,s=o.height,a=o.viewHeight,c=[],d=[];t.forEach((function(t){var l=r.judgeGraphicPage(e,t);t.color=Object(v.s)(t.color,!1);var u=N(n,s,a,r.module.fileInfo);A(t,n,!1,-u,s),i?w(t,!1):L(t,!1);var h=!1,p=r.checkProtoGraphic(t);l.forEach((function(e){d.includes(e)||d.push(e);var r=o.graphicListSeqs[e],i=x({},p);h&&t.type===E.f.RealTime&&t.action===E.a.Append&&(i.data=""),c.push({page:e,graphic_list_seq:r,draw_list:[i]}),h=!0}))}));var l=[];return d.forEach((function(e){var t={page:e,draw_list:[]};c.forEach((function(r){r.page===e&&(t.draw_list=t.draw_list.concat(r.draw_list),t.graphic_list_seq=r.graphic_list_seq)})),l.push(t)})),l},e.prototype.handleClearRsp=function(e,t,r,o,i){var n=r.header,s=r.body,a=n.code,c=n.message;if(0===a){var d=s.pages,l=s.graphic_list_seqs,u={};d&&d.forEach((function(e,t){return u[e]=l[t]})),P.a.getInstance().info(["WhiteBoard_Service"],"graph_update_seq",JSON.stringify({whiteboardID:e,graphicListSeqs:u,body:s,actionMsg:"clear cb success"})),this.module.updateMapByGraphicListSeqs(s.mod_id,u),this.module.updateMap({whiteboardID:e,operateTimes:0}),this.module.clearGraphicMap(),o(e)}else{var h=this.module.getMap(e);if(h&&++h.operateTimes<5)this.clearViewHandle(e,t,o,i);else{var p=Object(k.b)(a,c);P.a.getInstance().error(["WhiteBoard_Service"],"mod_clear_cb",JSON.stringify({errorData:p})),i(p)}}},e.prototype.handleUpdateToRemoteRsp=function(e,t,r,o,i){var n=r.header,s=r.body,a=n.code,c=n.message;if(0===a){var d=s.pages,l=s.graphic_list_seqs,u={};d&&d.forEach((function(e,t){return u[e]=l[t]})),P.a.getInstance().info(["WhiteBoard_Service"],"graph_update_seq",JSON.stringify({whiteboardID:e,graphicListSeqs:u,actionMsg:"draw cb success"})),this.module.updateMapByGraphicListSeqs(s.mod_id,u),this.module.updateGraphicMap(e,t),o()}else{var h=Object(k.b)(a,c);P.a.getInstance().error(["WhiteBoard_Service"],"graph_draw_cb",JSON.stringify({errorData:h})),i(h)}},e.prototype.clearViewHandle=function(e,t,r,o){return D(this,void 0,void 0,(function(){var i;return U(this,(function(n){switch(n.label){case 0:return[4,this.socket.queueWSCmdHandler(m.ClearPageGraphics,{mod_id:e,layers:t})];case 1:return i=n.sent(),this.handleClearRsp(e,t,i,r,o),[2]}}))}))},e.prototype.updateToRemoteHandle=function(e,t,r,o){return D(this,void 0,void 0,(function(){var i,n,s,a,c,d,l;return U(this,(function(u){switch(u.label){case 0:return t=this.updateRemoteImageGraphicData(t),i=this.updateRemoteImageGraphicData(t,!0),(n={mod_id:e,draw_pages:this.mapDrawPages(e,JSON.parse(JSON.stringify(t)))}).draw_pages.length?[4,this.socket.checkSendLength(n,t[0].action)]:(o(Object(k.b)(E.i.ZegoWhiteboardViewErrorGraphicModifyFail)),[2]);case 1:return s=u.sent(),t.length>1&&s?(a=E.i.ZegoWhiteboardViewErrorGraphicNumLimit,c=Object(k.b)(a),o(c),P.a.getInstance().error(["WhiteBoard_Service"],"graph_draw_cb",JSON.stringify({errorData:c,size:s})),[2]):(d={mod_id:e,draw_pages:this.mapDrawPages(e,t)},[4,this.socket.queueWSCmdHandler(m.DrawPageGraphics,d)]);case 2:return l=u.sent(),this.handleUpdateToRemoteRsp(e,i,l,r,o),[2]}}))}))},e.prototype.clearView=function(e,t){var r=this;return new Promise((function(o,i){r.clearViewHandle(e,t,o,i)}))},e.prototype.uploadImage=function(e,t){if(!this.docsService.isConfiged()){var r=P.a.getInstance().getConfig(),o=r.appID,i=r.userID,n=r.token,s=r.isTestEnv;this.docsService.setConfig({appID:o,userID:i,token:n,isTestEnv:s})}return this.docsService.uploadImage(e,t)},e.prototype.getGraphicIsEndDraw=function(e){try{var t=this.module.getGraphicItem(e),r=t.is_end_draw,o=1e3*t.server_timestamp-this.socket.getServerTimeOffset();return!!(r||(new Date).getTime()<o)}catch(e){return!0}},e.prototype.isAppendPathLimit=function(e,t){(t=JSON.parse(JSON.stringify(t))).action=E.a.Update,t.action_type=E.b.Single,t.is_end_draw=!0,t.data=t.oldData;var r=t.data.length;return this.socket.checkSendLength({mod_id:e,draw_pages:this.mapDrawPages(e,[t])},t.action).then((function(e){return e&&P.a.getInstance().warn(["WhiteBoard_Service"],"graph_draw_limit",JSON.stringify({size:e,length:r})),!!e}))},e}(),Z=(r(240),r(117),r(130),r(129),r(248),r(52),r(97),r(156),r(323),r(188),r(94),r(190),r(4)),H=r(27);function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){e[e.Initiative=1]="Initiative",e[e.Inner=2]="Inner"}(o||(o={})),function(e){e[e.InProgress=1]="InProgress",e[e.Pending=2]="Pending",e[e.Resolve=3]="Resolve",e[e.Reject=4]="Reject"}(i||(i={})),function(e){e[e.success=0]="success",e[e.error=1]="error"}(n||(n={})),function(e){e[e.SetMod=1]="SetMod",e[e.ClearPageGraphics=2]="ClearPageGraphics",e[e.DrawPageGraphics=3]="DrawPageGraphics",e[e.SetRoomAuth=4]="SetRoomAuth",e[e.SetUserAuth=5]="SetUserAuth"}(s||(s={})),function(e){e[e.Add=1]="Add",e[e.Removed=2]="Removed",e[e.Modify=3]="Modify"}(a||(a={})),function(e){e[e.Scroll=1]="Scroll",e[e.AppendH5Extra=2]="AppendH5Extra",e[e.Scale=3]="Scale",e[e.Other=4]="Other"}(c||(c={}));var W=function(){return(W=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},z=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},q=function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},j=function(){function e(e){this.modListSeq=0,this.modIdMapData={},this.zorderSeq=1,this.zorderStep=Object(v.f)(),this.modLimit=50,this.defaultModListSeq=0,this.marker="",this.defaultModType=1,this.defaultModSubtype=1,this.defaultModDeleteFlag=0,this.defaultHPercent=0,this.defaultVPercent=0,this.defaultModReserve=1,this.graphicLimit=30,this.graphicMap={},this.fileInfo={},this.userAuthMap={roomSeq:0,userSeq:0,syncTaskId:0,model:Object.freeze({scale:1,scroll:1,update:1,delete:1,move:1,clear:1,create:1})},this.socket=e}return e.prototype.updateModifyModTaskList=function(e){var t=e.status,r=e.push,o=e.setModAction,n=e.data,s=this.getMap(n.mod_id);if(t===i.InProgress)s.modifyModTaskList.splice(0,s.modifyModTaskList.length,e);else if(t===i.Pending)if(r)s.modifyModTaskList.push(e);else{s.modifyModTaskList.reverse();var a=s.modifyModTaskList.findIndex((function(e){return!e.push&&e.status===i.Pending}));if(-1!==a&&(a=s.modifyModTaskList.length-a-1,s.modifyModTaskList.reverse()),-1===a)s.modifyModTaskList.push(e);else{var d=s.modifyModTaskList[a];d.setModAction===c.AppendH5Extra?(c.Other,Object.assign(d.data,e.data)):d.setModAction===c.Scroll?o===c.Other||o===c.Scroll?Object.assign(d.data,e.data):s.modifyModTaskList.splice(a+1,0,e):d.setModAction===c.Scale?o===c.Scale?Object.assign(d.data,e.data):s.modifyModTaskList.splice(a+1,0,e):(Object.assign(d.data,e.data),d.setModAction=e.setModAction)}}P.a.getInstance().info(["DocsView_Service"],"module_update_task_list",JSON.stringify(s.modifyModTaskList))},e.prototype.getOldModInfoByModifyModOption=function(e){var t=this.getMap(e.mod_id),r={};return Object.keys(e).forEach((function(e){"mod_title"===e?r[e]=t.name:"mod_extra"===e?r[e]=t.modExtra:"mod_reserve"===e?r[e]=t.pptStep:"mod_horizontal_percent"===e?r[e]=t.horizontalPercent:"mod_vertical_percent"===e?r[e]=t.verticalPercent:"mod_scale"===e&&(r[e]=t.modScale)})),r},e.prototype.setModBefore=function(e,t){var r=t.mod_id,o=this.getModSendSwitch(r),n={setModAction:e,data:t,push:!1,status:o?i.InProgress:i.Pending};return this.updateModifyModTaskList(n),o},e.prototype.cachePushModifyModTaskHandle=function(e){var t,r=this;return e.forEach((function(e){var o=e.pushModSeq,i=e.data,n=i.mod_id;o>r.getMap(n).modSeq&&r.updateMap({modSeq:o,whiteboardID:n});var s=r.updateMapByModifyModOption(i,o,!0);s&&(t=t||{},Object.assign(t,s))})),t},e.prototype.setModRspAfter=function(e){var t=e.setModOption,r=e.sendResultType,o=e.setModAction,s=t.mod_id,a=this.getMap(s),d=e.errorData;if(r===n.success)P.a.getInstance().info(["WhiteBoard_Service"],"module_set_mod_cb","success");else{var l=this.getOldModInfoByModifyModOption(t);if(o===c.Scroll){var u=W(W({},d),{whiteboardID:s,horizontalPercent:l.mod_horizontal_percent,verticalPercent:l.mod_vertical_percent,step:l.mod_reserve});Z.e.emit(Z.c.Scroll,u),P.a.getInstance().info(["WhiteBoard_Service"],"module_set_mod_cb",JSON.stringify(u))}else if(o===c.AppendH5Extra){3===(null==d?void 0:d.code)&&(d=Object(k.b)(H.a.ZegoWhiteboardViewErrorAnimationInfoLimit));var h=l.mod_extra.includes("H5_record");h&&(l.mod_extra=JSON.parse(l.mod_extra),l.mod_extra.H5_record.t=102,l.mod_extra=JSON.stringify(l.mod_extra));u=W(W({},d),{modExtra:l.mod_extra,whiteboardID:s,isH5:h});Z.e.emit(Z.c.AppendH5Extra,u),P.a.getInstance().info(["WhiteBoard_Service"],"module_set_mod_cb",JSON.stringify(u))}else if(o===c.Scale){u=W(W({},d),{whiteboardID:s,mod_scale:l.mod_scale});Z.e.emit(Z.c.Scale,u),P.a.getInstance().warn(["WhiteBoard_Service"],"module_set_mod_cb",JSON.stringify(u))}}P.a.getInstance().info(["WhiteBoard_Service"],"module_set_mod_cb_tasks",JSON.stringify(a.modifyModTaskList)),a.modifyModTaskList.splice(0,1);var p=a.modifyModTaskList.filter((function(e){return e.push})),f=this.cachePushModifyModTaskHandle(p);P.a.getInstance().info(["WhiteBoard_Service"],"module_set_mod_cb_push_map",f?JSON.stringify(f):""),a.modifyModTaskList=a.modifyModTaskList.filter((function(e){return!e.push}));var g=a.modifyModTaskList[0];g&&(f?this.cacheCallback(f):(g.status=i.InProgress,this.setModHandle(g.setModAction,g.data)))},e.prototype.cacheCallback=function(e){var t=e.is_modify_mod_scale,r=e.is_modify_mod_extra,o=e.is_modify_mod_horizontal_percent,n=e.is_modify_mod_vertical_percent,s=e.is_modify_mod_reserve,a=e.mod_extra,d=e.mod_id,l=this.getMap(d),u=l.modifyModTaskList[0];if(u){var h=u.setModAction,p=!1;if(h===c.Scroll)if(o||n||s)p=!0;else{var f={code:1112,msg:"",whiteboardID:d,horizontalPercent:l.horizontalPercent,verticalPercent:l.verticalPercent,step:l.pptStep};Z.e.emit(Z.c.Scroll,f),P.a.getInstance().info(["WhiteBoard_Service"],"module_set_mod_cb_cache",JSON.stringify(f)),l.modifyModTaskList.splice(0,1),this.cacheCallback(e)}else if(h===c.AppendH5Extra)if(r&&a){var g=l.modExtra.includes("H5_record");f={code:1112,msg:"",modExtra:l.modExtra,whiteboardID:d,isH5:g};Z.e.emit(Z.c.AppendH5Extra,f),P.a.getInstance().info(["WhiteBoard_Service"],"module_set_mod_cb_cache",JSON.stringify(f)),l.modifyModTaskList.splice(0,1),this.cacheCallback(e)}else p=!0;else if(h===c.Scale)if(t){f={code:1112,msg:"",whiteboardID:d,mod_scale:l.modScale};Z.e.emit(Z.c.Scale,f),P.a.getInstance().info(["WhiteBoard_Service"],"module_set_mod_cb_cache",JSON.stringify(f)),l.modifyModTaskList.splice(0,1),this.cacheCallback(e)}else p=!0;else p=!0;p&&(P.a.getInstance().info(["WhiteBoard_Service"],"module_set_mod_cb_cache","next set mod"),u.status=i.InProgress,this.setModHandle(u.setModAction,u.data))}},e.prototype.getModSendSwitch=function(e){var t=this.modIdMapData[e];return!t||!t.modifyModTaskList.some((function(e){return!e.push}))},e.prototype.transModInfo=function(e,t,r,o){var i={room_id:"",zorder:0},n={x:0,y:0,z:0,w:0,h:0,ar_w:1,ar_h:1},s={scale:1,ofs_x:0,ofs_y:0};if(e)try{var a=JSON.parse(e),c=a.file_info;c&&(a.file_info={fileID:c.file_id,fileName:c.file_name,fileType:+c.file_type}),a.unique_id||(a.unique_id=4===(null==c?void 0:c.file_type)?c.file_id:o),i=a}catch(t){P.a.getInstance().error(["WhiteBoard_Service"],"module_trans",JSON.stringify({error:t.message,modContentStr:e}))}if(t)try{n=JSON.parse(t)}catch(e){P.a.getInstance().error(["WhiteBoard_Service"],"module_trans",JSON.stringify({error:e.message,modPosStr:t}))}if(r)try{(s=JSON.parse(r)).scale=Math.max(s.scale,1)}catch(e){P.a.getInstance().error(["WhiteBoard_Service"],"module_trans",JSON.stringify({error:e.message,modScaleStr:r}))}return{modContent:i,modPos:n,modScale:s}},e.prototype.checkModInfo=function(e){var t=this.getMap(e);return!!(t&&t.width&&t.height)&&t},e.prototype.deleteMap=function(e){delete this.modIdMapData[e]},e.prototype.getModPropSeq=function(e){return this.modIdMapData[e].modPropSeq},e.prototype.decodeH5Extra=function(e){return(e=e||"").includes("H5_")?e:O(e)},e.prototype.checkH5Extra=function(e,t,r){try{var o="",i=this.getH5Extra(e,!0);if(i){var n=JSON.parse(i);if(n.H5_target)if(t){var s=JSON.parse(t),a=n.H5_target,c=a.s,d=a.p,l=a.e,u=s.H5_target,h=u.s,p=u.p,f=u.e;if(h===c&&p===d)if(r)if(f.length<l.length)o=t;else if(f.length>l.length)s.H5_target.e=f.slice(l.length),o=JSON.stringify(s);else{var g=[];f.forEach((function(e,t){l.findIndex((function(t){return e.id===t.id}))!==t&&g.push(e)}));var m=f[f.length-1];o=g.length?(s.H5_target.e=g,JSON.stringify(s)):m.s?(s.H5_target.e=[m],JSON.stringify(s)):""}else{var _=l.findIndex((function(e){return e.s&&f[0].id===e.id}));-1!==_&&l.splice(_,1),n.H5_target.e=l.concat(f),o=JSON.stringify(n)}else o=t}else o="";else o=t}else o=t;return o}catch(e){return""}},e.prototype.updateMapByModifyModOption=function(e,t,r){var o,i=e.mod_id,n=e.mod_title,s=e.mod_horizontal_percent,a=e.mod_vertical_percent,c=e.mod_reserve,d=e.mod_scale,l=e.mod_content,u=e.is_modify_mod_horizontal_percent,h=e.is_modify_mod_vertical_percent,p=e.is_modify_mod_reserve,f=e.is_modify_mod_title,g=e.is_modify_mod_extra,m=e.is_modify_mod_scale,_=e.is_modify_mod_content,v=this.decodeH5Extra(e.mod_extra),E=this.getModPropSeq(i),y=E.mod_horizontal_percent,S=E.mod_vertical_percent,T=E.mod_reserve,b=E.mod_title,R=E.mod_extra,C=E.mod_scale,I=E.mod_content,O=this.getMap(i),L={isPushScroll:!1,horizontalPercent:O.horizontalPercent,verticalPercent:O.verticalPercent,pptStep:O.pptStep};if(u&&t>y){L.isPushScroll=!0,L.horizontalPercent=+s||0;var w={whiteboardID:i,horizontalPercent:L.horizontalPercent,modPropSeq:{mod_horizontal_percent:t}};P.a.getInstance().info(["WhiteBoard_Service"],"module_update_h_percent",JSON.stringify({temp1:w})),this.updateMap(w)}if(h&&t>S){L.isPushScroll=!0,L.verticalPercent=+a||0,L.pptStep=+c||1;var M={whiteboardID:i,verticalPercent:L.verticalPercent,pptStep:L.pptStep,modPropSeq:{mod_vertical_percent:t}};P.a.getInstance().info(["WhiteBoard_Service"],"module_update_v_percent",JSON.stringify({temp2:M})),this.updateMap(M)}if(p&&t>T){L.isPushScroll=!0,L.pptStep=+c||1;var A={whiteboardID:i,pptStep:L.pptStep,modPropSeq:{mod_reserve:t}};P.a.getInstance().info(["WhiteBoard_Service"],"module_update_step",JSON.stringify({temp3:A})),this.updateMap(A)}if(L.isPushScroll&&r&&(this.pushScrollHandle(i,L.horizontalPercent,L.verticalPercent,L.pptStep),this.updateMap({whiteboardID:i,modExtra:""}),o=e),f&&t>b){var N={whiteboardID:i,name:n,modPropSeq:{mod_title:t}};P.a.getInstance().info(["WhiteBoard_Service"],"module_update_name",JSON.stringify({temp4:N})),this.updateMap(N)}if(g&&t>R){var k={whiteboardID:i,modExtra:v,modPropSeq:{mod_extra:t}};if(r){var x=this.checkH5Extra(i,v,!0);x&&(this.pushExtraHandle(i,x),o=e)}P.a.getInstance().info(["WhiteBoard_Service"],"module_update_h5extra",JSON.stringify({temp5:k})),this.updateMap(k)}if(m&&t>C){var D=JSON.parse(d);k={whiteboardID:i,modScale:D,modPropSeq:{mod_scale:t}};r&&this.pushScaleHandle(i,D.scale,D.ofs_x,D.ofs_y),P.a.getInstance().info(["WhiteBoard_Service"],"module_update_scale",JSON.stringify({temp5:k})),this.updateMap(k)}if(_&&t>I){k={whiteboardID:i,zorder:JSON.parse(l).zorder,modPropSeq:{mod_content:t}};P.a.getInstance().info(["WhiteBoard_Service"],"module_update_content",JSON.stringify({temp5:k})),this.updateMap(k),r&&this.pushSwitchViewHandle()}return o},e.prototype.updateMapByMod=function(e){var t=this.transModInfo(e.mod_content,e.mod_pos,e.mod_scale,e.mod_id),r=t.modContent,o=t.modPos,i=t.modScale;this.updateMap({whiteboardID:e.mod_id,name:e.mod_title,aspectWidth:o.ar_w,aspectHeight:o.ar_h,roomID:r.room_id,uniqueID:r.unique_id,zorder:r.zorder,fileInfo:Object.freeze(r.file_info),createTime:e.mod_create_time?+e.mod_create_time:0,horizontalPercent:e.mod_horizontal_percent||0,verticalPercent:e.mod_vertical_percent||0,pptStep:e.mod_reserve||1,modScale:i,modType:e.mod_type,modSubtype:e.mod_subtype,modSeq:e.mod_seq,modExtra:this.decodeH5Extra(e.mod_extra),outPageCount:r.whiteboard_page_count,outZorder:r.zorder,modPropSeq:{mod_title:e.mod_seq,mod_type:e.mod_seq,mod_subtype:e.mod_seq,mod_pos:e.mod_seq,mod_status:e.mod_seq,mod_content:e.mod_seq,mod_extra:e.mod_seq,mod_reserve:e.mod_seq,mod_delete_flag:e.mod_seq,mod_horizontal_percent:e.mod_seq,mod_vertical_percent:e.mod_seq,mod_scale:e.mod_seq}})},e.prototype.updateModListSeq=function(e){e&&(this.modListSeq=e)},e.prototype.splitPage=function(e,t,r){var o=this.getMap(e);if(o&&t&&r){var i=1,n=0,s=0;t>=r?(n=s=r,(i=Math.ceil(t/r))>100&&(n=Math.ceil(t/99),i=100),o.innerDirection=H.e.Horizontal):(s=n=t,(i=Math.ceil(r/t))>100&&(s=Math.ceil(r/99),i=100),o.innerDirection=H.e.Vertical),o.innerPageCount=i;for(var a=0;a<i;a++)o.graphicListSeqs[a]||(o.graphicListSeqs[a]=0),o.pullMarks[a]=!1;o.innerPageSize.cx=n,o.innerPageSize.cy=s,P.a.getInstance().info(["WhiteBoard_Service"],"module_split_page",JSON.stringify({whiteboardID:e,width:t,height:r,innerPageCx:n,innerPageCy:s,innerPageCount:i}))}},e.prototype.setFileInfo=function(e){this.fileInfo=e},e.prototype.transGraphicList=function(e,t,r,o,i){var n=this;if(t&&t.length){var s=this.socket.isSendPB,a=N(r,o,i,this.fileInfo);t.forEach((function(t){e.some((function(e){return e.graphic_id===t.graphic_id}))||(t.zorder>n.zorderSeq&&(n.zorderSeq=t.zorder),s?w(t,!0):L(t,!0),n.setGraphicItem(t),A(t,r,!0,a,o),t.color=Object(v.s)(t.color,!0),e.push(t))}))}},e.prototype.pushScrollHandle=function(e,t,r,o){Z.e.emit(Z.c.PushScroll,e,t,r,o)},e.prototype.pushScaleHandle=function(e,t,r,o){Z.e.emit(Z.c.PushScale,e,t,r,o)},e.prototype.pushExtraHandle=function(e,t){Z.e.emit(Z.c.PushH5ExtraAppended,e,t)},e.prototype.pushSwitchViewHandle=function(){var e=this.getCurrentActivitedView(),t=e[0],r=e[1];Z.e.emit(Z.d.RemoteSwitchMod,t,r)},e.prototype.pushSetModHandle=function(e){var t=e.mod_list_seq,r=e.action_list[0],o=r.action;o===a.Removed?this.pushRemovedMod(r.mod_id):o===a.Add&&this.pushAddMod(r),t>=this.modListSeq?(this.updateModListSeq(t),o===a.Modify&&this.pushModifyMod(r)):P.a.getInstance().warn(["WhiteBoard_Service"],"module_remote",JSON.stringify({localModListSeq:this.modListSeq,remoteModListSeq:t,msg:"throw away"}))},e.prototype.pushClearPageGraphicsHandle=function(e){var t=e.action_seqs,r=e.pages,o=e.layers,i=e.mod_id;if(this.checkModInfo(i)){var n={};r&&r.forEach((function(e,r){return n[e]=t[r]})),P.a.getInstance().info(["WhiteBoard_Service"],"module_update_seq",JSON.stringify({whiteboardID:i,graphicListSeqs:n,layers:o,actionMsg:"remote clear"})),this.updateMapByGraphicListSeqs(i,n),this.updateMap({whiteboardID:i,operateTimes:0}),Z.e.emit(Z.c.PushClearPageGraphics,i,o)}},e.prototype.pushDrawPageGraphicsHandle=function(e){var t=this,r=e.page_graphics,o=e.mod_id,i=this.checkModInfo(o);if(i){P.a.getInstance().info(["WhiteBoard_Service"],"module_remote_draw",JSON.stringify({drawPages:r}));var n=i.width,s=i.height,a=i.viewHeight,c={},d=[],l=[];r.forEach((function(e){var r=e.del_graphic_id_list,o=e.graphic_list,u=e.action_seq,h=e.page;(!i.graphicListSeqs[h]||u>i.graphicListSeqs[h])&&(t.transGraphicList(d,o,n,s,a),r&&l.push.apply(l,r),c[h]=u)})),P.a.getInstance().info(["WhiteBoard_Service"],"module_update_seq",JSON.stringify({whiteboardID:o,graphicListSeqs:c,actionMsg:"remote_draw"})),this.updateMapByGraphicListSeqs(o,c),Z.e.emit(Z.c.PushDrawPageGraphics,o,d,l)}},e.prototype.pushAddMod=function(e){var t=e.mod_id;P.a.getInstance().info(["WhiteBoard_Service"],"module_remote_add",JSON.stringify({whiteboardID:t})),this.updateMapByMod(e),Z.e.emit(Z.c.PushAddMod,t,this.getMap(t).uniqueID)},e.prototype.pushRemovedMod=function(e){var t=this.getMap(e).uniqueID;this.deleteMap(e),Z.e.emit(Z.c.PushRemovedMod,e,t)},e.prototype.pushModifyMod=function(e){e.mod_horizontal_percent||(e.mod_horizontal_percent=0),e.mod_vertical_percent||(e.mod_vertical_percent=0);var t=e.mod_id,r=e.mod_seq,o=e.mod_title,n=e.mod_horizontal_percent,s=e.mod_vertical_percent,a=e.mod_reserve,c=e.mod_extra,d=e.mod_scale,l=e.mod_content,u=e.is_modify_mod_vertical_percent,h=e.is_modify_mod_horizontal_percent,p=e.is_modify_mod_reserve,f=e.is_modify_mod_title,g=e.is_modify_mod_extra,m=e.is_modify_mod_scale,_=e.is_modify_mod_content,v=this.getMap(t);if(v)if(this.getModSendSwitch(t)){if(P.a.getInstance().info(["WhiteBoard_Service"],"module_remote_modify","immediate update"),r>v.modSeq){var E={whiteboardID:t,modSeq:r};this.updateMap(E)}this.updateMapByModifyModOption(e,r,!0)}else{P.a.getInstance().info(["WhiteBoard_Service"],"module_remote_modify","cache");var y={mod_id:t};f&&Object.assign(y,{mod_title:o,is_modify_mod_title:f}),g&&Object.assign(y,{mod_extra:c,is_modify_mod_extra:g}),h&&Object.assign(y,{mod_horizontal_percent:n,is_modify_mod_horizontal_percent:h}),u&&Object.assign(y,{mod_vertical_percent:s,is_modify_mod_vertical_percent:u,mod_reserve:a,is_modify_mod_reserve:p}),p&&Object.assign(y,{mod_reserve:a,is_modify_mod_reserve:p}),m&&Object.assign(y,{mod_scale:d,is_modify_mod_scale:m}),_&&Object.assign(y,{mod_content:l,is_modify_mod_content:_}),this.updateModifyModTaskList({status:i.Pending,data:y,push:!0,pushModSeq:r})}},e.prototype.clearPullMarks=function(e){var t=this;P.a.getInstance().info(["WhiteBoard_Service"],"module_clear_pull_mark","init pull mark");var r=e?[e]:Object.keys(this.modIdMapData);Object.values(r).forEach((function(e){var r=t.modIdMapData[e];r&&Object.keys(r.pullMarks).forEach((function(e){r.pullMarks[+e]=!1}))}))},e.prototype.createModInfo=function(e){var t={};if(e.fileInfo){var r=e.fileInfo,o=r.fileID,i=r.fileName,n=r.fileType;t.file_info={file_id:o,file_name:i,file_type:n}}e.pageCount&&(t.whiteboard_page_count=e.pageCount);var s=e.uniqueID;s&&(t.unique_id=s,t.zorder=Date.now()+this.socket.getServerTimeOffset());return{modContent:t,modPos:{x:0,y:0,z:0,w:0,h:0,ar_w:e.aspectWidth,ar_h:e.aspectHeight},modScale:{scale:1,ofs_x:0,ofs_y:0}}},e.prototype.compareHandle=function(e,t){var r=this;P.a.getInstance().info(["WhiteBoard_Service"],"module_compare","compare local with server");var i=Object.keys(this.modIdMapData);t.forEach((function(t){var n=t.mod_id,s=t.mod_horizontal_percent,a=t.mod_vertical_percent,c=t.mod_reserve;if(n+="",s=s||0,a=a||0,c=c||1,Object.assign(t,{mod_horizontal_percent:s,mod_vertical_percent:a,mod_reserve:c}),-1===i.indexOf(n))e===o.Inner?r.pushAddMod(t):r.updateMapByMod(t);else{var d=r.getMap(n),l=d.horizontalPercent,u=d.verticalPercent,h=d.pptStep;r.updateMapByMod(t),l===s&&u===a&&c===h||r.pushScrollHandle(n,s,a,c)}})),i.forEach((function(i){-1===t.findIndex((function(e){return e.mod_id===i}))&&(e===o.Inner?r.pushRemovedMod(i):r.deleteMap(i))}))},e.prototype.handleGetModListDetailsRsp=function(e,t){var r=e.header,o=e.body,i=r.code,n=r.message;if(0===i){var s=o.mod_list_seq,a=o.mod_list;return s&&this.updateModListSeq(s),P.a.getInstance().info(["WhiteBoard_Service"],"module_update_seq",JSON.stringify({modListSeq:s,actionMsg:"get list cb success"})),(a=a||[]).sort((function(e,t){return+t.mod_create_time-+e.mod_create_time})),this.compareHandle(t,a),Promise.resolve(a)}var c=Object(k.b)(i,n);return P.a.getInstance().error(["WhiteBoard_Service"],"module_get_list_cb",JSON.stringify({errorData:c})),Promise.reject(c)},e.prototype.handleDestroyModRsp=function(e){var t=e.header,r=e.body,o=t.code,i=t.message;if(0===o){var n=r.mod_list_seq,s=r.mod_id;return this.updateModListSeq(n),P.a.getInstance().info(["WhiteBoard_Service"],"module_update_seq",JSON.stringify({modListSeq:n,actionMsg:"destroy cb success"})),this.deleteMap(s),Promise.resolve()}var a=Object(k.b)(o,i);return P.a.getInstance().error(["WhiteBoard_Service"],"module_destroy_cb",JSON.stringify({errorData:a})),Promise.reject(a)},e.prototype.handleCreateModRsp=function(e){return z(this,void 0,void 0,(function(){var t,r,o,i,n,s,a,c,d,l,u;return q(this,(function(h){switch(h.label){case 0:if(t=e.header,r=e.body,o=t.code,i=t.message,0!==o)return[3,5];n=r.mod_list_seq,s=r.mod_id,this.updateModListSeq(n),P.a.getInstance().info(["WhiteBoard_Service"],"module_update_seq",JSON.stringify({modListSeq:n,actionMsg:"create cb success"})),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.getModInfo([s])];case 2:return a=h.sent(),c=a[0],this.updateMapByMod(c),[2,c.mod_id];case 3:return d=h.sent(),[2,Promise.reject(d)];case 4:return[3,6];case 5:return l=3===o?H.a.ZegoWhiteboardViewErrorViewNameLimit:o,u=Object(k.b)(l,i),P.a.getInstance().error(["WhiteBoard_Service"],"module_create_cb",JSON.stringify({errorData:u})),[2,Promise.reject(u)];case 6:return[2]}}))}))},e.prototype.handleGetModInfoRsp=function(e){var t=e.header,r=e.body,o=t.code,i=t.message;if(0===o){var n=r.mod_list;return P.a.getInstance().info(["WhiteBoard_Service"],"module_get_info_cb",JSON.stringify(n||[])),Promise.resolve(n||[])}var s=Object(k.b)(o,i);return P.a.getInstance().error(["WhiteBoard_Service"],"module_get_info_cb",JSON.stringify(s)),Promise.reject(s)},e.prototype.handleSetModRsp=function(e,t,r){var o=r.header,i=r.body,s=o.code,a=o.message;if(0===s){var c=i.mod_list_seq,d=i.mod_seq,l=i.mod_id;this.modListSeq=c,this.updateMap({whiteboardID:l,modSeq:d}),this.updateMapByModifyModOption(t,d,!1),this.setModRspAfter({setModAction:e,setModOption:t,sendResultType:n.success})}else this.setModRspAfter({setModAction:e,setModOption:t,sendResultType:n.error,errorData:3===s?{code:s,msg:a}:Object(k.b)(s,a)})},e.prototype.handleGetPageGraphicsListRsp=function(e,t){var r=this,o=t.header,i=t.body,n=o.code,s=o.message;if(0===n){var a=this.checkModInfo(e);if(!a)return;var c=a.width,d=a.height,l=a.viewHeight,u=i.pages,h=[],p=[],f={},g=[],m=[];u.forEach((function(t){var o=t.page,i=t.ret_graphic_list_seq,n=t.svr_graphic_list_seq,s=t.graphic_list,a=t.del_graphic_id_list;r.transGraphicList(g,s,c,d,l),a&&m.push.apply(m,a),f[o]=n,n!==i&&0!==i?(h.push(o),p.push(i)):r.getMap(e).pullMarks[o]=!0})),P.a.getInstance().info(["WhiteBoard_Service"],"module_update_seq",JSON.stringify({whiteboardID:e,graphicListSeqs:f,actionMsg:"get list cb success"})),this.updateMapByGraphicListSeqs(e,f),Z.e.emit(Z.c.GetPageGraphicsList,e,g,m),h.length&&(P.a.getInstance().info(["WhiteBoard_Service"],"module_get_list_cb","increment get"),this.getPageGraphicsList(e,h,p))}else{var _=Object(k.b)(n,s);P.a.getInstance().error(["WhiteBoard_Service"],"module_get_list_cb",JSON.stringify(_))}},e.prototype.getModInfo=function(e){return z(this,void 0,void 0,(function(){var t;return q(this,(function(r){switch(r.label){case 0:return[4,this.socket.queueWSCmdHandler(m.GetMod,{mod_id_list:e})];case 1:return t=r.sent(),[2,this.handleGetModInfoRsp(t)]}}))}))},e.prototype.getModListDetails=function(e,t){return void 0===e&&(e=o.Initiative),void 0===t&&(t=this.defaultModListSeq),z(this,void 0,void 0,(function(){var r;return q(this,(function(o){switch(o.label){case 0:return[4,this.socket.queueWSCmdHandler(m.GetModList,{mod_list_seq:t,limit:this.modLimit,marker:this.marker,mod_type:this.defaultModType})];case 1:return r=o.sent(),[2,this.handleGetModListDetailsRsp(r,e)]}}))}))},e.prototype.setModHandle=function(e,t){return z(this,void 0,void 0,(function(){var r,o;return q(this,(function(i){switch(i.label){case 0:return r=t.mod_id,[4,this.socket.queueWSCmdHandler(m.ModifyMod,W({mod_seq:this.getMap(r).modSeq},t))];case 1:return o=i.sent(),this.handleSetModRsp(e,t,o),[2]}}))}))},e.prototype.setMod=function(e,t){this.setModBefore(e,t)&&this.setModHandle(e,t)},e.prototype.checkScroll=function(e,t,r,o){var i=this.getMap(e);if(i){var n=i.horizontalPercent,s=i.verticalPercent,a=i.pptStep,c=!1,d={mod_id:e};return t!==n&&(d.mod_horizontal_percent=t,d.is_modify_mod_horizontal_percent=!0,c=d),r===s&&o===a||(d.mod_vertical_percent=r,d.is_modify_mod_vertical_percent=r!==s,d.mod_reserve=o,d.is_modify_mod_reserve=!0,c=d),c}return!1},e.prototype.checkScale=function(e,t,r,o){return!!this.getMap(e)&&{mod_id:e,mod_scale:JSON.stringify({scale:t,ofs_x:r,ofs_y:o}),is_modify_mod_scale:!0}},e.prototype.checkSwitchView=function(e){var t=this.getMap(e);if(t){var r={unique_id:t.uniqueID,whiteboard_page_count:t.outPageCount,zorder:Date.now()+this.socket.getServerTimeOffset()};if(t.fileInfo){var o=t.fileInfo,i=o.fileID,n=o.fileName,s=o.fileType;r.file_info={file_id:i,file_name:n,file_type:s}}return{mod_id:e,mod_content:JSON.stringify(r),is_modify_mod_content:!0}}return!1},e.prototype.getCurrentPages=function(e,t,r){var o,i,n=this.getMap(e),s=n.width,a=n.height,c=n.innerPageSize,d=n.viewWidth,l=n.viewHeight;n.innerDirection===H.e.Horizontal?(o=Math.floor(s*t/c.cx),i=Math.floor((d+s*t)/c.cx)):(o=Math.floor(a*r/c.cy),i=Math.floor((l+a*r)/c.cy));var u=i-o+1;return{minPage:o=Math.max(0,o-u),maxPage:i=(i+=u)>99?99:Math.min(i,n.innerPageCount-1)}},e.prototype.initUserAuthMap=function(){this.userAuthMap.syncTaskId&&window.clearInterval(this.userAuthMap.syncTaskId),this.userAuthMap.roomSeq=0,this.userAuthMap.userSeq=0,this.userAuthMap.syncTaskId=0,this.userAuthMap.model=Object.freeze({scale:1,scroll:1,update:1,delete:1,move:1,clear:1,create:1}),Z.e.emit(Z.c.PushAuthChange,{scale:1,scroll:1},{update:1,delete:1,move:1,clear:1,create:1})},e.prototype.getRemoteRoomUserAuth=function(e){return z(this,void 0,void 0,(function(){var t,r,o,i,n,s;return q(this,(function(a){switch(a.label){case 0:return t="room"==e?m.GetRoomAuth:m.GetUserAuth,[4,this.socket.queueWSCmdHandler(t,{})];case 1:return r=a.sent(),o=r.header,i=o.code,n=o.message,0===i?(P.a.getInstance().info(["WhiteBoard_Service"],"mod.get_"+e+"_auth_cb","success"),[2,r.body]):(s=Object(k.b)(i,n),P.a.getInstance().error(["WhiteBoard_Service"],"mod.get_"+e+"_auth_cb",JSON.stringify(s)),[2,Promise.reject(s)])}}))}))},e.prototype.setUserAuthMap=function(e){if(e.auth_seq=e.auth_seq||0,!(e.auth_seq<=0)&&(e.id_name?this.userAuthMap.userSeq=e.auth_seq:this.userAuthMap.roomSeq=e.auth_seq,e.id_name||0==this.userAuthMap.userSeq)){var t=JSON.parse(JSON.stringify(this.userAuthMap.model)),r={scale:1,scroll:1,update:1,delete:1,move:1,clear:1,create:1},o=e.module_auth||[];r.scale=+o.includes(E.k.Scale),r.scroll=+o.includes(E.k.Scroll),o=e.graphic_auth||[],r.update=+o.includes(E.l.Update),r.delete=+o.includes(E.l.Delete),r.move=+o.includes(E.l.Move),r.clear=+o.includes(E.l.Clear),r.create=+o.includes(E.l.Create),this.userAuthMap.model=Object.freeze(r),this.onPushAuthChange(this.userAuthMap.model,t)}},e.prototype.onPushAuthChange=function(e,t){var r,o;e.scale==t.scale&&e.scroll==t.scroll||(r={scale:e.scale,scroll:e.scroll}),e.update==t.update&&e.delete==t.delete&&e.move==t.move&&e.clear==t.clear&&e.create==t.create||(o={update:e.update,delete:e.delete,move:e.move,clear:e.clear,create:e.create}),Z.e.emit(Z.c.PushAuthChange,r,o)},e.prototype.pushUserAuthHandle=function(e){var t=this,r=this.socket.getUserID(),o=this.userAuthMap.userSeq;e.user_auth.some((function(e){return e.id_name===r&&e.auth_seq>o&&(t.setUserAuthMap(e),!0)}))},e.prototype.syncRemoteSeq=function(){return z(this,void 0,void 0,(function(){var e,t,r,o,i,n,s=this;return q(this,(function(a){switch(a.label){case 0:return[4,this.socket.queueWSCmdHandler(m.Sync,{})];case 1:return 0===(e=a.sent()).header.code&&(t=e.body,r=t.sync_interval,o=t.room_auth_seq,i=t.user_auth_seq,n=t.mod_list_seq,this.userAuthMap.syncTaskId||(this.userAuthMap.syncTaskId=window.setInterval((function(){s.syncRemoteSeq()}),1e3*(r||30))),this.syncRoomUserAuth(o,i),this.syncModuleHandle(n)),[2]}}))}))},e.prototype.getPageGraphicsList=function(e,t,r){return z(this,void 0,void 0,(function(){var o,i,n;return q(this,(function(s){switch(s.label){case 0:return o=this.getMap(e),i=o.graphicListSeqs,!t.includes(0)&&t.unshift(0),r||(r=t.map((function(e){return o.pullMarks[e]&&i[e]||0}))),r.length<t.length&&r.unshift(i[0]||0),[4,this.socket.queueWSCmdHandler(m.GetPageGraphics,{mod_id:e,pages:t,graphic_list_seqs:r,limit:this.graphicLimit})];case 1:return n=s.sent(),this.handleGetPageGraphicsListRsp(e,n),[2]}}))}))},e.prototype.syncModuleHandle=function(e){P.a.getInstance().info(["WhiteBoard_Service"],"module_get_list_sync",JSON.stringify({localModListSeq:this.modListSeq,svrModListSeq:e})),e>this.modListSeq&&this.getModListDetails(o.Inner,this.modListSeq?this.modListSeq:this.defaultModListSeq)},e.prototype.syncRoomUserAuth=function(e,t){var r=this;P.a.getInstance().info(["WhiteBoard_Service"],"module_sync_room_user_auth_cb",JSON.stringify({localRoom:this.userAuthMap.roomSeq,serverRoom:e,localUser:this.userAuthMap.userSeq,serverUser:t})),t=t||0,(e=e||0)>this.userAuthMap.roomSeq&&(this.userAuthMap.roomSeq=e,this.getRemoteRoomUserAuth("room").then((function(e){return r.setUserAuthMap(e)}))),t>this.userAuthMap.userSeq&&(this.userAuthMap.userSeq=t,this.getRemoteRoomUserAuth("user").then((function(e){return r.setUserAuthMap(e)})))},e.prototype.checkLogin=function(){return"CONNECTED"===this.socket.getRoomState()||Promise.reject(Object(k.b)(H.a.ZegoWhiteboardViewErrorNoLoginRoom))},e.prototype.getModList=function(){return z(this,void 0,void 0,(function(){var e,t,r;return q(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),!0!==(e=this.checkLogin())?[2,e]:(P.a.getInstance().info(["WhiteBoard_Service"],"module_get_list",JSON.stringify({localModListSeq:this.modListSeq})),[4,this.getModListDetails(o.Initiative)]);case 1:return t=i.sent(),[2,Promise.resolve(t.map((function(e){return e.mod_id})))];case 2:return r=i.sent(),[2,Promise.reject(r)];case 3:return[2]}}))}))},e.prototype.destroyMod=function(e){return z(this,void 0,void 0,(function(){var t,r;return q(this,(function(o){switch(o.label){case 0:return!0!==(t=this.checkLogin())?[2,t]:[4,this.socket.queueWSCmdHandler(m.DestroyMod,{mod_id:e})];case 1:return r=o.sent(),[2,this.handleDestroyModRsp(r)]}}))}))},e.prototype.createMod=function(e,t){return z(this,void 0,void 0,(function(){var r,o,i,n,s,a,c;return q(this,(function(d){switch(d.label){case 0:return!0!==(r=this.checkLogin())?[2,r]:(o=this.createModInfo(e),i=o.modContent,n=o.modPos,s=o.modScale,a={mod_id:t||Object(v.d)(),mod_title:e.name,mod_type:this.defaultModType,mod_subtype:this.defaultModSubtype,mod_delete_flag:this.defaultModDeleteFlag,mod_content:JSON.stringify(i),mod_horizontal_percent:this.defaultHPercent,mod_vertical_percent:this.defaultVPercent,mod_reserve:this.defaultModReserve,mod_pos:JSON.stringify(n),mod_scale:JSON.stringify(s)},[4,this.socket.queueWSCmdHandler(m.CreateMod,a)]);case 1:return c=d.sent(),[2,this.handleCreateModRsp(c)]}}))}))},e.prototype.getUserAuth=function(){return this.userAuthMap.model},e.prototype.updateMapByGraphicListSeqs=function(e,t){var r=this.getMap(e).graphicListSeqs;Object.keys(t).forEach((function(e){r[+e]=t[+e]}))},e.prototype.setGraphicItem=function(e){var t=e.operate_id,r=e.data;this.graphicMap[e.graphic_id]={is_end_draw:!t||e.is_end_draw,server_timestamp:+e.server_timestamp||0,operate_id:t,type:e.type,pointData:{x:e.x||0,y:e.y||0,px:e.px||0,py:e.py||0,data:"object"==G(r)?JSON.parse(JSON.stringify(r)):r}}},e.prototype.getGraphicItem=function(e){return this.graphicMap[e]},e.prototype.clearGraphicMap=function(){this.graphicMap={}},e.prototype.updateGraphicMap=function(e,t){var r=this,o=this.getMap(e).width,i=this.getMap(e).height,n=this.getMap(e).viewHeight,s=N(o,i,n,this.fileInfo);t.forEach((function(e){A(e,o,!1,-s,i),r.setGraphicItem(e)}))},e.prototype.reloadViewGraphics=function(e,t){var r=this,o=this.getMap(e).width,i=this.getMap(e).height,n=this.getMap(e).viewHeight,s=N(o,i,n,this.fileInfo);t.forEach((function(e){var t=r.getGraphicItem(e.graphic_id).pointData,n=t.x,a=t.y,c=t.px,d=t.py,l=t.data;e.x=n,e.y=a,e.px=c,e.py=d,e.data="object"==G(l)?JSON.parse(JSON.stringify(l)):l,A(e,o,!0,s,i)}))},e.prototype.updateMap=function(e){var t=this.getMap(e.whiteboardID);if(t){var r=e.modPropSeq;r&&Object.assign(t.modPropSeq||{},r),delete e.modPropSeq,Object.assign(t,e)}else this.modIdMapData[e.whiteboardID]=W({graphicListSeqs:{0:0},pullMarks:{0:!1},modSeq:0,width:0,height:0,viewWidth:0,viewHeight:0,innerPageCount:1,innerDirection:H.e.Horizontal,innerPageSize:{cx:0,cy:0},modType:this.defaultModType,modSubtype:this.defaultModSubtype,operateTimes:0,inProgress:!1,graphicSendSwitch:!0,modifyModTaskList:[],moveTaskList:[]},e)},e.prototype.getMap=function(e){return this.modIdMapData[e]},e.prototype.appendH5Extra=function(e,t){P.a.getInstance().info(["WhiteBoard_Service"],"module_append_extra_origin",t);var r=this.checkH5Extra(e,t,!1);if(r){P.a.getInstance().info(["WhiteBoard_Service"],"module_append_extra_new",r);var o,i={mod_id:e,mod_extra:r.includes("H5_record")?(o=r,b(R(o))):r,is_modify_mod_extra:!0};this.setMod(c.AppendH5Extra,i)}},e.prototype.scroll=function(e,t,r,o,i){P.a.getInstance().info(["WhiteBoard_Service"],"module_scroll_origin",JSON.stringify({hPercent:t,vPercent:r,pptStep:o}));var n=this.checkScroll(e,t,r,o);if(n){if(n.mod_extra="",n.is_modify_mod_extra=!0,i){var s=this.getMap(e).modScale,a=s.scale,d=s.ofs_x,l=i.scaleFactor,u=i.scaleOffsetX,h=i.scaleOffsetY?{scale:l,ofs_x:u,ofs_y:0}:{scale:a,ofs_x:d,ofs_y:0};n.mod_scale=JSON.stringify(h),n.is_modify_mod_scale=!0}P.a.getInstance().info(["WhiteBoard_Service"],"module_scroll_new",JSON.stringify({setModOption:n})),this.setMod(c.Scroll,n)}},e.prototype.scale=function(e,t,r,o){P.a.getInstance().info(["WhiteBoard_Service"],"module_scale_origin",JSON.stringify({scale:t,ofs_x:r,ofs_y:o}));var i=this.checkScale(e,t,r,o);i&&(P.a.getInstance().info(["WhiteBoard_Service"],"module_scale_new",JSON.stringify({setModOption:i})),this.setMod(c.Scale,i))},e.prototype.getAspectRatio=function(e){var t=this.getMap(e);return t.aspectWidth+":"+t.aspectHeight},e.prototype.getFileInfo=function(e){var t=this.getMap(e);return t&&t.fileInfo||null},e.prototype.getScrollPercent=function(e){var t=this.getMap(e);return{horizontalPercent:t.horizontalPercent,verticalPercent:t.verticalPercent,pptStep:t.pptStep,direction:t.innerDirection}},e.prototype.getScale=function(e){var t=this.getMap(e);return{scaleFactor:t.modScale.scale,scaleOffsetX:t.modScale.ofs_x,scaleOffsetY:t.modScale.ofs_y}},e.prototype.loadCurrentGraphics=function(e,t,r){for(var o=this.getMap(e),i=this.getCurrentPages(e,t,r),n=i.minPage,s=i.maxPage,a=[],c=n;c<=s;c++){!o.pullMarks[c]&&a.push(c)}P.a.getInstance().info(["WhiteBoard_Service"],"module.load_by_percent",JSON.stringify({horizontalPercent:t,verticalPercent:r,minPage:n,maxPage:s,pageNumList:a})),a.length&&this.getPageGraphicsList(e,a)},e.prototype.reload=function(){var e=this;this.syncRemoteSeq(),this.clearPullMarks(),this.getModListDetails(o.Inner),this.onRemotePush(),this.getRemoteAuth();try{Object.values(this.modIdMapData).forEach((function(t){e.loadCurrentGraphics(t.whiteboardID,t.horizontalPercent,t.verticalPercent)}))}catch(e){P.a.getInstance().error(["WhiteBoard_Service"],"reload_graphics",JSON.stringify({error:e}))}P.a.getInstance().info(["WhiteBoard_Service"],"reload_graphics","reload whiteboard")},e.prototype.unload=function(){this.userAuthMap.syncTaskId&&window.clearInterval(this.userAuthMap.syncTaskId),P.a.getInstance().info(["WhiteBoard_Service"],"unload","unload whiteboard")},e.prototype.onRemotePush=function(){var e=this;this.socket.registerWbMessage((function(t){var r=t.sub_cmd,o=t.msg_body;switch(r){case 291101:e.pushSetModHandle(o);break;case 291203:e.pushDrawPageGraphicsHandle(o);break;case 291204:e.pushClearPageGraphicsHandle(o);break;case 291501:e.pushUserAuthHandle(o);break;case 291502:e.setUserAuthMap(o)}}))},e.prototype.getRemoteAuth=function(){var e=this;this.initUserAuthMap(),this.getRemoteRoomUserAuth("room").then((function(t){e.setUserAuthMap(t),e.syncRemoteSeq()})),this.getRemoteRoomUserAuth("user").then((function(t){e.setUserAuthMap(t)}))},e.prototype.getModName=function(e){var t=this.getMap(e);return(null==t?void 0:t.name)||""},e.prototype.getCreateTime=function(e){var t=this.getMap(e);return(null==t?void 0:t.createTime)||0},e.prototype.getRoomID=function(e){var t=this.getMap(e);return(null==t?void 0:t.roomID)||""},e.prototype.getUniqueID=function(e){var t=this.getMap(e);return(null==t?void 0:t.uniqueID)||""},e.prototype.getPageCount=function(e){var t=this.getMap(e);return(null==t?void 0:t.outPageCount)||1},e.prototype.setSize=function(e,t,r){var o=this.getMap(e);return!!(o&&t&&r)&&(o.width=t,o.height=r,P.a.getInstance().info(["WhiteBoard_Service"],"module_set_view_size",JSON.stringify({whiteboardID:e,width:t,height:r})),this.splitPage(e,t,r),!0)},e.prototype.setViewSize=function(e,t,r){var o=this.getMap(e);return!!(o&&t&&r)&&(P.a.getInstance().info(["WhiteBoard_Service"],"module_set_viewpoart_size",JSON.stringify({whiteboardID:e,viewWidth:t,viewHeight:r})),o.viewHeight=r,o.viewWidth=t,!0)},e.prototype.setRenderStatus=function(e,t){return void 0!==t&&(Object.values(this.modIdMapData).forEach((function(r){t?r.whiteboardID===e?r.renderStatus=1:r.renderStatus=0:r.whiteboardID===e&&(r.renderStatus=0)})),!0)},e.prototype.getH5Extra=function(e,t){var r=this.getMap(e),o=r?r.modExtra:"";if(P.a.getInstance().info(["WhiteBoard_Service"],"module_get_h5extra",JSON.stringify({whiteboardID:e,modExtra:o})),o&&!t){var i=JSON.parse(o);i.H5_record&&(i.H5_record.t=101,o=JSON.stringify(i))}return o},e.prototype.createZorder=function(){return this.zorderSeq+=this.zorderStep},e.prototype.switchView=function(e){P.a.getInstance().info(["WhiteBoard_Service"],"module_switch_view_origin",e);var t=this.checkSwitchView(e);return t?(P.a.getInstance().info(["WhiteBoard_Service"],"module_switch_view_new",JSON.stringify(t)),this.setModHandle(c.Other,t)):Promise.reject()},e.prototype.getCurrentActivitedView=function(){var e=0,t="";Object.values(this.modIdMapData).forEach((function(r){r.zorder&&r.zorder>e&&(e=r.zorder,t=r.whiteboardID)}));var r=t?[this.modIdMapData[t].uniqueID,t]:[];return P.a.getInstance().info(["WhiteBoard_Service"],"module_switch_view_remote",JSON.stringify(r)),r},e}(),V=(r(70),r(313)),F=r.n(V),Y=r(23);const X=Y.Reader,J=Y.Writer,K=Y.util,Q=Y.roots.default||(Y.roots.default={});Q.proto_access_pb=(()=>{const e={};return e.proto_req_header=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.protocol="",e.prototype.cmd="",e.prototype.appid=0,e.prototype.seq=0,e.prototype.user_id="",e.prototype.session_id="",e.prototype.room_id="",e.prototype.room_session_id="",e.prototype.biz_version="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),null!=e.protocol&&Object.hasOwnProperty.call(e,"protocol")&&t.uint32(10).string(e.protocol),null!=e.cmd&&Object.hasOwnProperty.call(e,"cmd")&&t.uint32(18).string(e.cmd),null!=e.appid&&Object.hasOwnProperty.call(e,"appid")&&t.uint32(24).uint32(e.appid),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(32).uint32(e.seq),null!=e.user_id&&Object.hasOwnProperty.call(e,"user_id")&&t.uint32(42).string(e.user_id),null!=e.session_id&&Object.hasOwnProperty.call(e,"session_id")&&t.uint32(50).string(e.session_id),null!=e.room_id&&Object.hasOwnProperty.call(e,"room_id")&&t.uint32(58).string(e.room_id),null!=e.room_session_id&&Object.hasOwnProperty.call(e,"room_session_id")&&t.uint32(66).string(e.room_session_id),null!=e.biz_version&&Object.hasOwnProperty.call(e,"biz_version")&&t.uint32(74).string(e.biz_version),t},e}(),e.proto_biz_channel=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.channel="",e.prototype.cmd="",e.prototype.req_body=K.newBuffer([]),e.prototype.is_retry_req=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&t.uint32(10).string(e.channel),null!=e.cmd&&Object.hasOwnProperty.call(e,"cmd")&&t.uint32(18).string(e.cmd),null!=e.req_body&&Object.hasOwnProperty.call(e,"req_body")&&t.uint32(26).bytes(e.req_body),null!=e.is_retry_req&&Object.hasOwnProperty.call(e,"is_retry_req")&&t.uint32(32).uint32(e.is_retry_req),t},e}(),e.proto_rsp_header=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.protocol="",e.prototype.cmd="",e.prototype.appid=0,e.prototype.seq=0,e.prototype.user_id="",e.prototype.session_id="",e.prototype.room_id="",e.prototype.room_session_id="",e.prototype.biz_version="",e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_access_pb.proto_rsp_header;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.protocol=e.string();break;case 2:o.cmd=e.string();break;case 3:o.appid=e.uint32();break;case 4:o.seq=e.uint32();break;case 5:o.user_id=e.string();break;case 6:o.session_id=e.string();break;case 7:o.room_id=e.string();break;case 8:o.room_session_id=e.string();break;case 9:o.biz_version=e.string();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_access_pb.proto_rsp_header)return e;let t=new Q.proto_access_pb.proto_rsp_header;return null!=e.protocol&&(t.protocol=String(e.protocol)),null!=e.cmd&&(t.cmd=String(e.cmd)),null!=e.appid&&(t.appid=e.appid>>>0),null!=e.seq&&(t.seq=e.seq>>>0),null!=e.user_id&&(t.user_id=String(e.user_id)),null!=e.session_id&&(t.session_id=String(e.session_id)),null!=e.room_id&&(t.room_id=String(e.room_id)),null!=e.room_session_id&&(t.room_session_id=String(e.room_session_id)),null!=e.biz_version&&(t.biz_version=String(e.biz_version)),t},e.toObject=function(e,t){t||(t={});let r={};return t.defaults&&(r.protocol="",r.cmd="",r.appid=0,r.seq=0,r.user_id="",r.session_id="",r.room_id="",r.room_session_id="",r.biz_version=""),null!=e.protocol&&e.hasOwnProperty("protocol")&&(r.protocol=e.protocol),null!=e.cmd&&e.hasOwnProperty("cmd")&&(r.cmd=e.cmd),null!=e.appid&&e.hasOwnProperty("appid")&&(r.appid=e.appid),null!=e.seq&&e.hasOwnProperty("seq")&&(r.seq=e.seq),null!=e.user_id&&e.hasOwnProperty("user_id")&&(r.user_id=e.user_id),null!=e.session_id&&e.hasOwnProperty("session_id")&&(r.session_id=e.session_id),null!=e.room_id&&e.hasOwnProperty("room_id")&&(r.room_id=e.room_id),null!=e.room_session_id&&e.hasOwnProperty("room_session_id")&&(r.room_session_id=e.room_session_id),null!=e.biz_version&&e.hasOwnProperty("biz_version")&&(r.biz_version=e.biz_version),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_biz_channel_rsp=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.err_code=0,e.prototype.err_message="",e.prototype.channel="",e.prototype.cmd="",e.prototype.rsp_body=K.newBuffer([]),e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_access_pb.proto_biz_channel_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.err_code=e.int32();break;case 2:o.err_message=e.string();break;case 3:o.channel=e.string();break;case 4:o.cmd=e.string();break;case 5:o.rsp_body=e.bytes();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_access_pb.proto_biz_channel_rsp)return e;let t=new Q.proto_access_pb.proto_biz_channel_rsp;return null!=e.err_code&&(t.err_code=0|e.err_code),null!=e.err_message&&(t.err_message=String(e.err_message)),null!=e.channel&&(t.channel=String(e.channel)),null!=e.cmd&&(t.cmd=String(e.cmd)),null!=e.rsp_body&&("string"==typeof e.rsp_body?K.base64.decode(e.rsp_body,t.rsp_body=K.newBuffer(K.base64.length(e.rsp_body)),0):e.rsp_body.length&&(t.rsp_body=e.rsp_body)),t},e.toObject=function(e,t){t||(t={});let r={};return t.defaults&&(r.err_code=0,r.err_message="",r.channel="",r.cmd="",t.bytes===String?r.rsp_body="":(r.rsp_body=[],t.bytes!==Array&&(r.rsp_body=K.newBuffer(r.rsp_body)))),null!=e.err_code&&e.hasOwnProperty("err_code")&&(r.err_code=e.err_code),null!=e.err_message&&e.hasOwnProperty("err_message")&&(r.err_message=e.err_message),null!=e.channel&&e.hasOwnProperty("channel")&&(r.channel=e.channel),null!=e.cmd&&e.hasOwnProperty("cmd")&&(r.cmd=e.cmd),null!=e.rsp_body&&e.hasOwnProperty("rsp_body")&&(r.rsp_body=t.bytes===String?K.base64.encode(e.rsp_body,0,e.rsp_body.length):t.bytes===Array?Array.prototype.slice.call(e.rsp_body):e.rsp_body),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_push_header=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.protocol="",e.prototype.cmd="",e.prototype.appid=0,e.prototype.user_id="",e.prototype.session_id="",e.prototype.room_id="",e.prototype.push_seq=0,e.prototype.from_user_id="",e.prototype.qos_flag=0,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_access_pb.proto_push_header;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.protocol=e.string();break;case 2:o.cmd=e.string();break;case 3:o.appid=e.uint32();break;case 4:o.user_id=e.string();break;case 5:o.session_id=e.string();break;case 6:o.room_id=e.string();break;case 7:o.push_seq=e.uint32();break;case 8:o.from_user_id=e.string();break;case 9:o.qos_flag=e.uint32();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_access_pb.proto_push_header)return e;let t=new Q.proto_access_pb.proto_push_header;return null!=e.protocol&&(t.protocol=String(e.protocol)),null!=e.cmd&&(t.cmd=String(e.cmd)),null!=e.appid&&(t.appid=e.appid>>>0),null!=e.user_id&&(t.user_id=String(e.user_id)),null!=e.session_id&&(t.session_id=String(e.session_id)),null!=e.room_id&&(t.room_id=String(e.room_id)),null!=e.push_seq&&(t.push_seq=e.push_seq>>>0),null!=e.from_user_id&&(t.from_user_id=String(e.from_user_id)),null!=e.qos_flag&&(t.qos_flag=e.qos_flag>>>0),t},e.toObject=function(e,t){t||(t={});let r={};return t.defaults&&(r.protocol="",r.cmd="",r.appid=0,r.user_id="",r.session_id="",r.room_id="",r.push_seq=0,r.from_user_id="",r.qos_flag=0),null!=e.protocol&&e.hasOwnProperty("protocol")&&(r.protocol=e.protocol),null!=e.cmd&&e.hasOwnProperty("cmd")&&(r.cmd=e.cmd),null!=e.appid&&e.hasOwnProperty("appid")&&(r.appid=e.appid),null!=e.user_id&&e.hasOwnProperty("user_id")&&(r.user_id=e.user_id),null!=e.session_id&&e.hasOwnProperty("session_id")&&(r.session_id=e.session_id),null!=e.room_id&&e.hasOwnProperty("room_id")&&(r.room_id=e.room_id),null!=e.push_seq&&e.hasOwnProperty("push_seq")&&(r.push_seq=e.push_seq),null!=e.from_user_id&&e.hasOwnProperty("from_user_id")&&(r.from_user_id=e.from_user_id),null!=e.qos_flag&&e.hasOwnProperty("qos_flag")&&(r.qos_flag=e.qos_flag),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_push_biz_channel=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.channel="",e.prototype.cmd="",e.prototype.req_body=K.newBuffer([]),e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_access_pb.proto_push_biz_channel;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.channel=e.string();break;case 2:o.cmd=e.string();break;case 3:o.req_body=e.bytes();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_access_pb.proto_push_biz_channel)return e;let t=new Q.proto_access_pb.proto_push_biz_channel;return null!=e.channel&&(t.channel=String(e.channel)),null!=e.cmd&&(t.cmd=String(e.cmd)),null!=e.req_body&&("string"==typeof e.req_body?K.base64.decode(e.req_body,t.req_body=K.newBuffer(K.base64.length(e.req_body)),0):e.req_body.length&&(t.req_body=e.req_body)),t},e.toObject=function(e,t){t||(t={});let r={};return t.defaults&&(r.channel="",r.cmd="",t.bytes===String?r.req_body="":(r.req_body=[],t.bytes!==Array&&(r.req_body=K.newBuffer(r.req_body)))),null!=e.channel&&e.hasOwnProperty("channel")&&(r.channel=e.channel),null!=e.cmd&&e.hasOwnProperty("cmd")&&(r.cmd=e.cmd),null!=e.req_body&&e.hasOwnProperty("req_body")&&(r.req_body=t.bytes===String?K.base64.encode(e.req_body,0,e.req_body.length):t.bytes===Array?Array.prototype.slice.call(e.req_body):e.req_body),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_push_biz_hannel_req=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sub_cmd=0,e.prototype.sub_seq=0,e.prototype.qos_flag=0,e.prototype.msg_id="",e.prototype.sender_id="",e.prototype.msg_body=K.newBuffer([]),e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_access_pb.proto_push_biz_hannel_req;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.sub_cmd=e.uint32();break;case 2:o.sub_seq=e.uint32();break;case 3:o.qos_flag=e.uint32();break;case 4:o.msg_id=e.string();break;case 5:o.sender_id=e.string();break;case 6:o.msg_body=e.bytes();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_access_pb.proto_push_biz_hannel_req)return e;let t=new Q.proto_access_pb.proto_push_biz_hannel_req;return null!=e.sub_cmd&&(t.sub_cmd=e.sub_cmd>>>0),null!=e.sub_seq&&(t.sub_seq=e.sub_seq>>>0),null!=e.qos_flag&&(t.qos_flag=e.qos_flag>>>0),null!=e.msg_id&&(t.msg_id=String(e.msg_id)),null!=e.sender_id&&(t.sender_id=String(e.sender_id)),null!=e.msg_body&&("string"==typeof e.msg_body?K.base64.decode(e.msg_body,t.msg_body=K.newBuffer(K.base64.length(e.msg_body)),0):e.msg_body.length&&(t.msg_body=e.msg_body)),t},e.toObject=function(e,t){t||(t={});let r={};return t.defaults&&(r.sub_cmd=0,r.sub_seq=0,r.qos_flag=0,r.msg_id="",r.sender_id="",t.bytes===String?r.msg_body="":(r.msg_body=[],t.bytes!==Array&&(r.msg_body=K.newBuffer(r.msg_body)))),null!=e.sub_cmd&&e.hasOwnProperty("sub_cmd")&&(r.sub_cmd=e.sub_cmd),null!=e.sub_seq&&e.hasOwnProperty("sub_seq")&&(r.sub_seq=e.sub_seq),null!=e.qos_flag&&e.hasOwnProperty("qos_flag")&&(r.qos_flag=e.qos_flag),null!=e.msg_id&&e.hasOwnProperty("msg_id")&&(r.msg_id=e.msg_id),null!=e.sender_id&&e.hasOwnProperty("sender_id")&&(r.sender_id=e.sender_id),null!=e.msg_body&&e.hasOwnProperty("msg_body")&&(r.msg_body=t.bytes===String?K.base64.encode(e.msg_body,0,e.msg_body.length):t.bytes===Array?Array.prototype.slice.call(e.msg_body):e.msg_body),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e})(),Q.proto_biz_channel=(()=>{const e={};return e.req_header=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sdk_version=0,e.prototype.id_name="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),null!=e.sdk_version&&Object.hasOwnProperty.call(e,"sdk_version")&&t.uint32(8).uint32(e.sdk_version),null!=e.id_name&&Object.hasOwnProperty.call(e,"id_name")&&t.uint32(18).string(e.id_name),t},e}(),e.req=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.req_header=null,e.prototype.body=K.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),null!=e.req_header&&Object.hasOwnProperty.call(e,"req_header")&&Q.proto_biz_channel.req_header.encode(e.req_header,t.uint32(10).fork()).ldelim(),null!=e.body&&Object.hasOwnProperty.call(e,"body")&&t.uint32(18).bytes(e.body),t},e}(),e.rsp_header=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.code=0,e.prototype.seq=0,e.prototype.timestamp=K.Long?K.Long.fromBits(0,0,!1):0,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_biz_channel.rsp_header;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.code=e.int32();break;case 2:o.seq=e.uint32();break;case 3:o.timestamp=e.int64();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_biz_channel.rsp_header)return e;let t=new Q.proto_biz_channel.rsp_header;return null!=e.code&&(t.code=0|e.code),null!=e.seq&&(t.seq=e.seq>>>0),null!=e.timestamp&&(K.Long?(t.timestamp=K.Long.fromValue(e.timestamp)).unsigned=!1:"string"==typeof e.timestamp?t.timestamp=parseInt(e.timestamp,10):"number"==typeof e.timestamp?t.timestamp=e.timestamp:"object"==typeof e.timestamp&&(t.timestamp=new K.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});let r={};if(t.defaults)if(r.code=0,r.seq=0,K.Long){let e=new K.Long(0,0,!1);r.timestamp=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.timestamp=t.longs===String?"0":0;return null!=e.code&&e.hasOwnProperty("code")&&(r.code=e.code),null!=e.seq&&e.hasOwnProperty("seq")&&(r.seq=e.seq),null!=e.timestamp&&e.hasOwnProperty("timestamp")&&("number"==typeof e.timestamp?r.timestamp=t.longs===String?String(e.timestamp):e.timestamp:r.timestamp=t.longs===String?K.Long.prototype.toString.call(e.timestamp):t.longs===Number?new K.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber():e.timestamp),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.rsp=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.header=null,e.prototype.body=K.newBuffer([]),e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_biz_channel.rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.header=Q.proto_biz_channel.rsp_header.decode(e,e.uint32());break;case 2:o.body=e.bytes();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_biz_channel.rsp)return e;let t=new Q.proto_biz_channel.rsp;if(null!=e.header){if("object"!=typeof e.header)throw TypeError(".proto_biz_channel.rsp.header: object expected");t.header=Q.proto_biz_channel.rsp_header.fromObject(e.header)}return null!=e.body&&("string"==typeof e.body?K.base64.decode(e.body,t.body=K.newBuffer(K.base64.length(e.body)),0):e.body.length&&(t.body=e.body)),t},e.toObject=function(e,t){t||(t={});let r={};return t.defaults&&(r.header=null,t.bytes===String?r.body="":(r.body=[],t.bytes!==Array&&(r.body=K.newBuffer(r.body)))),null!=e.header&&e.hasOwnProperty("header")&&(r.header=Q.proto_biz_channel.rsp_header.toObject(e.header,t)),null!=e.body&&e.hasOwnProperty("body")&&(r.body=t.bytes===String?K.base64.encode(e.body,0,e.body.length):t.bytes===Array?Array.prototype.slice.call(e.body):e.body),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e})(),Q.proto_edu_v1_web=(()=>{const e={};return e.proto_sync=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),t},e}(),e.proto_create_mod=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_title="",e.prototype.mod_type=0,e.prototype.mod_subtype=0,e.prototype.mod_pos="",e.prototype.mod_status=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_content="",e.prototype.mod_extra="",e.prototype.mod_reserve=0,e.prototype.mod_delete_flag=0,e.prototype.mod_horizontal_percent=0,e.prototype.mod_vertical_percent=0,e.prototype.mod_scale="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),null!=e.mod_id&&Object.hasOwnProperty.call(e,"mod_id")&&t.uint32(8).uint64(e.mod_id),null!=e.mod_title&&Object.hasOwnProperty.call(e,"mod_title")&&t.uint32(18).string(e.mod_title),null!=e.mod_type&&Object.hasOwnProperty.call(e,"mod_type")&&t.uint32(24).uint32(e.mod_type),null!=e.mod_subtype&&Object.hasOwnProperty.call(e,"mod_subtype")&&t.uint32(32).uint32(e.mod_subtype),null!=e.mod_pos&&Object.hasOwnProperty.call(e,"mod_pos")&&t.uint32(42).string(e.mod_pos),null!=e.mod_status&&Object.hasOwnProperty.call(e,"mod_status")&&t.uint32(48).uint64(e.mod_status),null!=e.mod_content&&Object.hasOwnProperty.call(e,"mod_content")&&t.uint32(58).string(e.mod_content),null!=e.mod_extra&&Object.hasOwnProperty.call(e,"mod_extra")&&t.uint32(66).string(e.mod_extra),null!=e.mod_reserve&&Object.hasOwnProperty.call(e,"mod_reserve")&&t.uint32(72).uint32(e.mod_reserve),null!=e.mod_delete_flag&&Object.hasOwnProperty.call(e,"mod_delete_flag")&&t.uint32(80).int32(e.mod_delete_flag),null!=e.mod_horizontal_percent&&Object.hasOwnProperty.call(e,"mod_horizontal_percent")&&t.uint32(93).float(e.mod_horizontal_percent),null!=e.mod_vertical_percent&&Object.hasOwnProperty.call(e,"mod_vertical_percent")&&t.uint32(101).float(e.mod_vertical_percent),null!=e.mod_scale&&Object.hasOwnProperty.call(e,"mod_scale")&&t.uint32(106).string(e.mod_scale),t},e}(),e.proto_destroy_mod=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),null!=e.mod_id&&Object.hasOwnProperty.call(e,"mod_id")&&t.uint32(8).uint64(e.mod_id),t},e}(),e.proto_modify_mod=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_seq=0,e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_title="",e.prototype.mod_pos="",e.prototype.mod_status=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_content="",e.prototype.mod_extra="",e.prototype.mod_reserve=0,e.prototype.is_modify_mod_title=!1,e.prototype.is_modify_mod_pos=!1,e.prototype.is_modify_mod_status=!1,e.prototype.is_modify_mod_content=!1,e.prototype.is_modify_mod_extra=!1,e.prototype.is_modify_mod_reserve=!1,e.prototype.mod_horizontal_percent=0,e.prototype.mod_vertical_percent=0,e.prototype.is_modify_mod_horizontal_percent=!1,e.prototype.is_modify_mod_vertical_percent=!1,e.prototype.is_modify_mod_scale=!1,e.prototype.mod_scale="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),null!=e.mod_seq&&Object.hasOwnProperty.call(e,"mod_seq")&&t.uint32(8).uint32(e.mod_seq),null!=e.mod_id&&Object.hasOwnProperty.call(e,"mod_id")&&t.uint32(16).uint64(e.mod_id),null!=e.mod_title&&Object.hasOwnProperty.call(e,"mod_title")&&t.uint32(26).string(e.mod_title),null!=e.mod_pos&&Object.hasOwnProperty.call(e,"mod_pos")&&t.uint32(34).string(e.mod_pos),null!=e.mod_status&&Object.hasOwnProperty.call(e,"mod_status")&&t.uint32(40).uint64(e.mod_status),null!=e.mod_content&&Object.hasOwnProperty.call(e,"mod_content")&&t.uint32(50).string(e.mod_content),null!=e.mod_extra&&Object.hasOwnProperty.call(e,"mod_extra")&&t.uint32(58).string(e.mod_extra),null!=e.mod_reserve&&Object.hasOwnProperty.call(e,"mod_reserve")&&t.uint32(64).uint32(e.mod_reserve),null!=e.is_modify_mod_title&&Object.hasOwnProperty.call(e,"is_modify_mod_title")&&t.uint32(72).bool(e.is_modify_mod_title),null!=e.is_modify_mod_pos&&Object.hasOwnProperty.call(e,"is_modify_mod_pos")&&t.uint32(80).bool(e.is_modify_mod_pos),null!=e.is_modify_mod_status&&Object.hasOwnProperty.call(e,"is_modify_mod_status")&&t.uint32(88).bool(e.is_modify_mod_status),null!=e.is_modify_mod_content&&Object.hasOwnProperty.call(e,"is_modify_mod_content")&&t.uint32(96).bool(e.is_modify_mod_content),null!=e.is_modify_mod_extra&&Object.hasOwnProperty.call(e,"is_modify_mod_extra")&&t.uint32(104).bool(e.is_modify_mod_extra),null!=e.is_modify_mod_reserve&&Object.hasOwnProperty.call(e,"is_modify_mod_reserve")&&t.uint32(112).bool(e.is_modify_mod_reserve),null!=e.mod_horizontal_percent&&Object.hasOwnProperty.call(e,"mod_horizontal_percent")&&t.uint32(125).float(e.mod_horizontal_percent),null!=e.mod_vertical_percent&&Object.hasOwnProperty.call(e,"mod_vertical_percent")&&t.uint32(133).float(e.mod_vertical_percent),null!=e.is_modify_mod_horizontal_percent&&Object.hasOwnProperty.call(e,"is_modify_mod_horizontal_percent")&&t.uint32(136).bool(e.is_modify_mod_horizontal_percent),null!=e.is_modify_mod_vertical_percent&&Object.hasOwnProperty.call(e,"is_modify_mod_vertical_percent")&&t.uint32(144).bool(e.is_modify_mod_vertical_percent),null!=e.is_modify_mod_scale&&Object.hasOwnProperty.call(e,"is_modify_mod_scale")&&t.uint32(152).bool(e.is_modify_mod_scale),null!=e.mod_scale&&Object.hasOwnProperty.call(e,"mod_scale")&&t.uint32(162).string(e.mod_scale),t},e}(),e.proto_get_mod=function(){function e(e){if(this.mod_id_list=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id_list=K.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=J.create()),null!=e.mod_id_list&&e.mod_id_list.length)for(let r=0;r<e.mod_id_list.length;++r)t.uint32(10).string(e.mod_id_list[r]);return t},e}(),e.proto_get_mod_list=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_list_seq=0,e.prototype.limit=0,e.prototype.marker="",e.prototype.mod_type=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),null!=e.mod_list_seq&&Object.hasOwnProperty.call(e,"mod_list_seq")&&t.uint32(8).uint32(e.mod_list_seq),null!=e.limit&&Object.hasOwnProperty.call(e,"limit")&&t.uint32(16).uint32(e.limit),null!=e.marker&&Object.hasOwnProperty.call(e,"marker")&&t.uint32(26).string(e.marker),null!=e.mod_type&&Object.hasOwnProperty.call(e,"mod_type")&&t.uint32(32).uint32(e.mod_type),t},e}(),e.proto_draw_page_graphics=function(){function e(e){if(this.draw_pages=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.draw_pages=K.emptyArray,e.prototype.timestamp=K.Long?K.Long.fromBits(0,0,!0):0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=J.create()),null!=e.mod_id&&Object.hasOwnProperty.call(e,"mod_id")&&t.uint32(8).uint64(e.mod_id),null!=e.draw_pages&&e.draw_pages.length)for(let r=0;r<e.draw_pages.length;++r)Q.proto_edu_v1_web.proto_draw_page.encode(e.draw_pages[r],t.uint32(18).fork()).ldelim();return null!=e.timestamp&&Object.hasOwnProperty.call(e,"timestamp")&&t.uint32(24).uint64(e.timestamp),t},e}(),e.proto_draw_page=function(){function e(e){if(this.draw_list=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.page=0,e.prototype.graphic_list_seq=0,e.prototype.draw_list=K.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=J.create()),null!=e.page&&Object.hasOwnProperty.call(e,"page")&&t.uint32(8).uint32(e.page),null!=e.graphic_list_seq&&Object.hasOwnProperty.call(e,"graphic_list_seq")&&t.uint32(16).uint32(e.graphic_list_seq),null!=e.draw_list&&e.draw_list.length)for(let r=0;r<e.draw_list.length;++r)Q.proto_edu_v1_web.proto_draw.encode(e.draw_list[r],t.uint32(26).fork()).ldelim();return t},e}(),e.proto_draw=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.graphic_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.action=0,e.prototype.action_type=0,e.prototype.type=0,e.prototype.zorder=0,e.prototype.x=0,e.prototype.y=0,e.prototype.px=0,e.prototype.py=0,e.prototype.data=K.newBuffer([]),e.prototype.size=0,e.prototype.color=0,e.prototype.width=0,e.prototype.height=0,e.prototype.attributes="",e.prototype.operate_id="",e.prototype.is_end_draw=!1,e.prototype.layer=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),null!=e.graphic_id&&Object.hasOwnProperty.call(e,"graphic_id")&&t.uint32(8).uint64(e.graphic_id),null!=e.action&&Object.hasOwnProperty.call(e,"action")&&t.uint32(16).int32(e.action),null!=e.action_type&&Object.hasOwnProperty.call(e,"action_type")&&t.uint32(24).int32(e.action_type),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(32).int32(e.type),null!=e.zorder&&Object.hasOwnProperty.call(e,"zorder")&&t.uint32(40).int32(e.zorder),null!=e.x&&Object.hasOwnProperty.call(e,"x")&&t.uint32(48).int32(e.x),null!=e.y&&Object.hasOwnProperty.call(e,"y")&&t.uint32(56).int32(e.y),null!=e.px&&Object.hasOwnProperty.call(e,"px")&&t.uint32(64).int32(e.px),null!=e.py&&Object.hasOwnProperty.call(e,"py")&&t.uint32(72).int32(e.py),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(82).bytes(e.data),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(88).int32(e.size),null!=e.color&&Object.hasOwnProperty.call(e,"color")&&t.uint32(96).uint32(e.color),null!=e.width&&Object.hasOwnProperty.call(e,"width")&&t.uint32(104).int32(e.width),null!=e.height&&Object.hasOwnProperty.call(e,"height")&&t.uint32(112).int32(e.height),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&t.uint32(122).string(e.attributes),null!=e.operate_id&&Object.hasOwnProperty.call(e,"operate_id")&&t.uint32(130).string(e.operate_id),null!=e.is_end_draw&&Object.hasOwnProperty.call(e,"is_end_draw")&&t.uint32(136).bool(e.is_end_draw),null!=e.layer&&Object.hasOwnProperty.call(e,"layer")&&t.uint32(144).uint32(e.layer),t},e}(),e.proto_clear_page_graphics=function(){function e(e){if(this.layers=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.timestamp=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.layers=K.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=J.create()),null!=e.mod_id&&Object.hasOwnProperty.call(e,"mod_id")&&t.uint32(8).uint64(e.mod_id),null!=e.timestamp&&Object.hasOwnProperty.call(e,"timestamp")&&t.uint32(16).uint64(e.timestamp),null!=e.layers&&e.layers.length){t.uint32(26).fork();for(let r=0;r<e.layers.length;++r)t.uint32(e.layers[r]);t.ldelim()}return t},e}(),e.proto_get_page_graphics=function(){function e(e){if(this.pages=[],this.graphic_list_seqs=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.pages=K.emptyArray,e.prototype.graphic_list_seqs=K.emptyArray,e.prototype.limit=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=J.create()),null!=e.mod_id&&Object.hasOwnProperty.call(e,"mod_id")&&t.uint32(8).uint64(e.mod_id),null!=e.pages&&e.pages.length){t.uint32(18).fork();for(let r=0;r<e.pages.length;++r)t.uint32(e.pages[r]);t.ldelim()}if(null!=e.graphic_list_seqs&&e.graphic_list_seqs.length){t.uint32(26).fork();for(let r=0;r<e.graphic_list_seqs.length;++r)t.uint32(e.graphic_list_seqs[r]);t.ldelim()}return null!=e.limit&&Object.hasOwnProperty.call(e,"limit")&&t.uint32(32).uint32(e.limit),t},e}(),e.proto_get_user_auth_req=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),t},e}(),e.proto_get_room_auth_req=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=J.create()),t},e}(),e.proto_mod=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_seq=0,e.prototype.mod_title="",e.prototype.mod_type=0,e.prototype.mod_subtype=0,e.prototype.mod_pos="",e.prototype.mod_status=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_content="",e.prototype.mod_extra="",e.prototype.mod_reserve=0,e.prototype.mod_create_time=K.Long?K.Long.fromBits(0,0,!1):0,e.prototype.graphic_list_seq=0,e.prototype.sync_interval=0,e.prototype.mod_horizontal_percent=0,e.prototype.mod_vertical_percent=0,e.prototype.mod_scale="",e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_mod;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.mod_id=e.uint64();break;case 2:o.mod_seq=e.uint32();break;case 3:o.mod_title=e.string();break;case 4:o.mod_type=e.uint32();break;case 5:o.mod_subtype=e.uint32();break;case 6:o.mod_pos=e.string();break;case 7:o.mod_status=e.uint64();break;case 8:o.mod_content=e.string();break;case 9:o.mod_extra=e.string();break;case 10:o.mod_reserve=e.uint32();break;case 11:o.mod_create_time=e.int64();break;case 12:o.graphic_list_seq=e.uint32();break;case 13:o.sync_interval=e.uint32();break;case 14:o.mod_horizontal_percent=e.float();break;case 15:o.mod_vertical_percent=e.float();break;case 16:o.mod_scale=e.string();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_mod)return e;let t=new Q.proto_edu_v1_web.proto_mod;return null!=e.mod_id&&(K.Long?(t.mod_id=K.Long.fromValue(e.mod_id)).unsigned=!0:"string"==typeof e.mod_id?t.mod_id=parseInt(e.mod_id,10):"number"==typeof e.mod_id?t.mod_id=e.mod_id:"object"==typeof e.mod_id&&(t.mod_id=new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0))),null!=e.mod_seq&&(t.mod_seq=e.mod_seq>>>0),null!=e.mod_title&&(t.mod_title=String(e.mod_title)),null!=e.mod_type&&(t.mod_type=e.mod_type>>>0),null!=e.mod_subtype&&(t.mod_subtype=e.mod_subtype>>>0),null!=e.mod_pos&&(t.mod_pos=String(e.mod_pos)),null!=e.mod_status&&(K.Long?(t.mod_status=K.Long.fromValue(e.mod_status)).unsigned=!0:"string"==typeof e.mod_status?t.mod_status=parseInt(e.mod_status,10):"number"==typeof e.mod_status?t.mod_status=e.mod_status:"object"==typeof e.mod_status&&(t.mod_status=new K.LongBits(e.mod_status.low>>>0,e.mod_status.high>>>0).toNumber(!0))),null!=e.mod_content&&(t.mod_content=String(e.mod_content)),null!=e.mod_extra&&(t.mod_extra=String(e.mod_extra)),null!=e.mod_reserve&&(t.mod_reserve=e.mod_reserve>>>0),null!=e.mod_create_time&&(K.Long?(t.mod_create_time=K.Long.fromValue(e.mod_create_time)).unsigned=!1:"string"==typeof e.mod_create_time?t.mod_create_time=parseInt(e.mod_create_time,10):"number"==typeof e.mod_create_time?t.mod_create_time=e.mod_create_time:"object"==typeof e.mod_create_time&&(t.mod_create_time=new K.LongBits(e.mod_create_time.low>>>0,e.mod_create_time.high>>>0).toNumber())),null!=e.graphic_list_seq&&(t.graphic_list_seq=e.graphic_list_seq>>>0),null!=e.sync_interval&&(t.sync_interval=e.sync_interval>>>0),null!=e.mod_horizontal_percent&&(t.mod_horizontal_percent=Number(e.mod_horizontal_percent)),null!=e.mod_vertical_percent&&(t.mod_vertical_percent=Number(e.mod_vertical_percent)),null!=e.mod_scale&&(t.mod_scale=String(e.mod_scale)),t},e.toObject=function(e,t){t||(t={});let r={};if(t.defaults){if(K.Long){let e=new K.Long(0,0,!0);r.mod_id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_id=t.longs===String?"0":0;if(r.mod_seq=0,r.mod_title="",r.mod_type=0,r.mod_subtype=0,r.mod_pos="",K.Long){let e=new K.Long(0,0,!0);r.mod_status=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_status=t.longs===String?"0":0;if(r.mod_content="",r.mod_extra="",r.mod_reserve=0,K.Long){let e=new K.Long(0,0,!1);r.mod_create_time=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_create_time=t.longs===String?"0":0;r.graphic_list_seq=0,r.sync_interval=0,r.mod_horizontal_percent=0,r.mod_vertical_percent=0,r.mod_scale=""}return null!=e.mod_id&&e.hasOwnProperty("mod_id")&&("number"==typeof e.mod_id?r.mod_id=t.longs===String?String(e.mod_id):e.mod_id:r.mod_id=t.longs===String?K.Long.prototype.toString.call(e.mod_id):t.longs===Number?new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0):e.mod_id),null!=e.mod_seq&&e.hasOwnProperty("mod_seq")&&(r.mod_seq=e.mod_seq),null!=e.mod_title&&e.hasOwnProperty("mod_title")&&(r.mod_title=e.mod_title),null!=e.mod_type&&e.hasOwnProperty("mod_type")&&(r.mod_type=e.mod_type),null!=e.mod_subtype&&e.hasOwnProperty("mod_subtype")&&(r.mod_subtype=e.mod_subtype),null!=e.mod_pos&&e.hasOwnProperty("mod_pos")&&(r.mod_pos=e.mod_pos),null!=e.mod_status&&e.hasOwnProperty("mod_status")&&("number"==typeof e.mod_status?r.mod_status=t.longs===String?String(e.mod_status):e.mod_status:r.mod_status=t.longs===String?K.Long.prototype.toString.call(e.mod_status):t.longs===Number?new K.LongBits(e.mod_status.low>>>0,e.mod_status.high>>>0).toNumber(!0):e.mod_status),null!=e.mod_content&&e.hasOwnProperty("mod_content")&&(r.mod_content=e.mod_content),null!=e.mod_extra&&e.hasOwnProperty("mod_extra")&&(r.mod_extra=e.mod_extra),null!=e.mod_reserve&&e.hasOwnProperty("mod_reserve")&&(r.mod_reserve=e.mod_reserve),null!=e.mod_create_time&&e.hasOwnProperty("mod_create_time")&&("number"==typeof e.mod_create_time?r.mod_create_time=t.longs===String?String(e.mod_create_time):e.mod_create_time:r.mod_create_time=t.longs===String?K.Long.prototype.toString.call(e.mod_create_time):t.longs===Number?new K.LongBits(e.mod_create_time.low>>>0,e.mod_create_time.high>>>0).toNumber():e.mod_create_time),null!=e.graphic_list_seq&&e.hasOwnProperty("graphic_list_seq")&&(r.graphic_list_seq=e.graphic_list_seq),null!=e.sync_interval&&e.hasOwnProperty("sync_interval")&&(r.sync_interval=e.sync_interval),null!=e.mod_horizontal_percent&&e.hasOwnProperty("mod_horizontal_percent")&&(r.mod_horizontal_percent=t.json&&!isFinite(e.mod_horizontal_percent)?String(e.mod_horizontal_percent):e.mod_horizontal_percent),null!=e.mod_vertical_percent&&e.hasOwnProperty("mod_vertical_percent")&&(r.mod_vertical_percent=t.json&&!isFinite(e.mod_vertical_percent)?String(e.mod_vertical_percent):e.mod_vertical_percent),null!=e.mod_scale&&e.hasOwnProperty("mod_scale")&&(r.mod_scale=e.mod_scale),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_graphic=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id_name="",e.prototype.nick_name="",e.prototype.graphic_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.action_seq=0,e.prototype.type=0,e.prototype.zorder=0,e.prototype.x=0,e.prototype.y=0,e.prototype.data=K.newBuffer([]),e.prototype.size=0,e.prototype.color=0,e.prototype.timestamp=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.width=0,e.prototype.height=0,e.prototype.attributes="",e.prototype.operate_id="",e.prototype.is_end_draw=!1,e.prototype.server_timestamp=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.creator_id="",e.prototype.layer=0,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_graphic;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.id_name=e.string();break;case 2:o.nick_name=e.string();break;case 3:o.graphic_id=e.uint64();break;case 4:o.action_seq=e.uint32();break;case 5:o.type=e.int32();break;case 7:o.zorder=e.int32();break;case 8:o.x=e.int32();break;case 9:o.y=e.int32();break;case 10:o.data=e.bytes();break;case 11:o.size=e.int32();break;case 12:o.color=e.uint32();break;case 13:o.timestamp=e.uint64();break;case 14:o.width=e.int32();break;case 15:o.height=e.int32();break;case 16:o.attributes=e.string();break;case 17:o.operate_id=e.string();break;case 18:o.is_end_draw=e.bool();break;case 19:o.server_timestamp=e.uint64();break;case 20:o.creator_id=e.string();break;case 21:o.layer=e.uint32();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_graphic)return e;let t=new Q.proto_edu_v1_web.proto_graphic;return null!=e.id_name&&(t.id_name=String(e.id_name)),null!=e.nick_name&&(t.nick_name=String(e.nick_name)),null!=e.graphic_id&&(K.Long?(t.graphic_id=K.Long.fromValue(e.graphic_id)).unsigned=!0:"string"==typeof e.graphic_id?t.graphic_id=parseInt(e.graphic_id,10):"number"==typeof e.graphic_id?t.graphic_id=e.graphic_id:"object"==typeof e.graphic_id&&(t.graphic_id=new K.LongBits(e.graphic_id.low>>>0,e.graphic_id.high>>>0).toNumber(!0))),null!=e.action_seq&&(t.action_seq=e.action_seq>>>0),null!=e.type&&(t.type=0|e.type),null!=e.zorder&&(t.zorder=0|e.zorder),null!=e.x&&(t.x=0|e.x),null!=e.y&&(t.y=0|e.y),null!=e.data&&("string"==typeof e.data?K.base64.decode(e.data,t.data=K.newBuffer(K.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.size&&(t.size=0|e.size),null!=e.color&&(t.color=e.color>>>0),null!=e.timestamp&&(K.Long?(t.timestamp=K.Long.fromValue(e.timestamp)).unsigned=!0:"string"==typeof e.timestamp?t.timestamp=parseInt(e.timestamp,10):"number"==typeof e.timestamp?t.timestamp=e.timestamp:"object"==typeof e.timestamp&&(t.timestamp=new K.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0))),null!=e.width&&(t.width=0|e.width),null!=e.height&&(t.height=0|e.height),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.operate_id&&(t.operate_id=String(e.operate_id)),null!=e.is_end_draw&&(t.is_end_draw=Boolean(e.is_end_draw)),null!=e.server_timestamp&&(K.Long?(t.server_timestamp=K.Long.fromValue(e.server_timestamp)).unsigned=!0:"string"==typeof e.server_timestamp?t.server_timestamp=parseInt(e.server_timestamp,10):"number"==typeof e.server_timestamp?t.server_timestamp=e.server_timestamp:"object"==typeof e.server_timestamp&&(t.server_timestamp=new K.LongBits(e.server_timestamp.low>>>0,e.server_timestamp.high>>>0).toNumber(!0))),null!=e.creator_id&&(t.creator_id=String(e.creator_id)),null!=e.layer&&(t.layer=e.layer>>>0),t},e.toObject=function(e,t){t||(t={});let r={};if(t.defaults){if(r.id_name="",r.nick_name="",K.Long){let e=new K.Long(0,0,!0);r.graphic_id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.graphic_id=t.longs===String?"0":0;if(r.action_seq=0,r.type=0,r.zorder=0,r.x=0,r.y=0,t.bytes===String?r.data="":(r.data=[],t.bytes!==Array&&(r.data=K.newBuffer(r.data))),r.size=0,r.color=0,K.Long){let e=new K.Long(0,0,!0);r.timestamp=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.timestamp=t.longs===String?"0":0;if(r.width=0,r.height=0,r.attributes="",r.operate_id="",r.is_end_draw=!1,K.Long){let e=new K.Long(0,0,!0);r.server_timestamp=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.server_timestamp=t.longs===String?"0":0;r.creator_id="",r.layer=0}return null!=e.id_name&&e.hasOwnProperty("id_name")&&(r.id_name=e.id_name),null!=e.nick_name&&e.hasOwnProperty("nick_name")&&(r.nick_name=e.nick_name),null!=e.graphic_id&&e.hasOwnProperty("graphic_id")&&("number"==typeof e.graphic_id?r.graphic_id=t.longs===String?String(e.graphic_id):e.graphic_id:r.graphic_id=t.longs===String?K.Long.prototype.toString.call(e.graphic_id):t.longs===Number?new K.LongBits(e.graphic_id.low>>>0,e.graphic_id.high>>>0).toNumber(!0):e.graphic_id),null!=e.action_seq&&e.hasOwnProperty("action_seq")&&(r.action_seq=e.action_seq),null!=e.type&&e.hasOwnProperty("type")&&(r.type=e.type),null!=e.zorder&&e.hasOwnProperty("zorder")&&(r.zorder=e.zorder),null!=e.x&&e.hasOwnProperty("x")&&(r.x=e.x),null!=e.y&&e.hasOwnProperty("y")&&(r.y=e.y),null!=e.data&&e.hasOwnProperty("data")&&(r.data=t.bytes===String?K.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),null!=e.size&&e.hasOwnProperty("size")&&(r.size=e.size),null!=e.color&&e.hasOwnProperty("color")&&(r.color=e.color),null!=e.timestamp&&e.hasOwnProperty("timestamp")&&("number"==typeof e.timestamp?r.timestamp=t.longs===String?String(e.timestamp):e.timestamp:r.timestamp=t.longs===String?K.Long.prototype.toString.call(e.timestamp):t.longs===Number?new K.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0):e.timestamp),null!=e.width&&e.hasOwnProperty("width")&&(r.width=e.width),null!=e.height&&e.hasOwnProperty("height")&&(r.height=e.height),null!=e.attributes&&e.hasOwnProperty("attributes")&&(r.attributes=e.attributes),null!=e.operate_id&&e.hasOwnProperty("operate_id")&&(r.operate_id=e.operate_id),null!=e.is_end_draw&&e.hasOwnProperty("is_end_draw")&&(r.is_end_draw=e.is_end_draw),null!=e.server_timestamp&&e.hasOwnProperty("server_timestamp")&&("number"==typeof e.server_timestamp?r.server_timestamp=t.longs===String?String(e.server_timestamp):e.server_timestamp:r.server_timestamp=t.longs===String?K.Long.prototype.toString.call(e.server_timestamp):t.longs===Number?new K.LongBits(e.server_timestamp.low>>>0,e.server_timestamp.high>>>0).toNumber(!0):e.server_timestamp),null!=e.creator_id&&e.hasOwnProperty("creator_id")&&(r.creator_id=e.creator_id),null!=e.layer&&e.hasOwnProperty("layer")&&(r.layer=e.layer),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_sync_rsp=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sync_interval=0,e.prototype.room_extra_info_seq=0,e.prototype.user_list_seq=0,e.prototype.user_extra_info_seq=0,e.prototype.joinlive_seq=0,e.prototype.mod_list_seq=0,e.prototype.user_auth_seq=0,e.prototype.room_auth_seq=0,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_sync_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.sync_interval=e.uint32();break;case 2:o.room_extra_info_seq=e.uint32();break;case 3:o.user_list_seq=e.uint32();break;case 4:o.user_extra_info_seq=e.uint32();break;case 5:o.joinlive_seq=e.uint32();break;case 6:o.mod_list_seq=e.uint32();break;case 7:o.user_auth_seq=e.uint32();break;case 8:o.room_auth_seq=e.uint32();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_sync_rsp)return e;let t=new Q.proto_edu_v1_web.proto_sync_rsp;return null!=e.sync_interval&&(t.sync_interval=e.sync_interval>>>0),null!=e.room_extra_info_seq&&(t.room_extra_info_seq=e.room_extra_info_seq>>>0),null!=e.user_list_seq&&(t.user_list_seq=e.user_list_seq>>>0),null!=e.user_extra_info_seq&&(t.user_extra_info_seq=e.user_extra_info_seq>>>0),null!=e.joinlive_seq&&(t.joinlive_seq=e.joinlive_seq>>>0),null!=e.mod_list_seq&&(t.mod_list_seq=e.mod_list_seq>>>0),null!=e.user_auth_seq&&(t.user_auth_seq=e.user_auth_seq>>>0),null!=e.room_auth_seq&&(t.room_auth_seq=e.room_auth_seq>>>0),t},e.toObject=function(e,t){t||(t={});let r={};return t.defaults&&(r.sync_interval=0,r.room_extra_info_seq=0,r.user_list_seq=0,r.user_extra_info_seq=0,r.joinlive_seq=0,r.mod_list_seq=0,r.user_auth_seq=0,r.room_auth_seq=0),null!=e.sync_interval&&e.hasOwnProperty("sync_interval")&&(r.sync_interval=e.sync_interval),null!=e.room_extra_info_seq&&e.hasOwnProperty("room_extra_info_seq")&&(r.room_extra_info_seq=e.room_extra_info_seq),null!=e.user_list_seq&&e.hasOwnProperty("user_list_seq")&&(r.user_list_seq=e.user_list_seq),null!=e.user_extra_info_seq&&e.hasOwnProperty("user_extra_info_seq")&&(r.user_extra_info_seq=e.user_extra_info_seq),null!=e.joinlive_seq&&e.hasOwnProperty("joinlive_seq")&&(r.joinlive_seq=e.joinlive_seq),null!=e.mod_list_seq&&e.hasOwnProperty("mod_list_seq")&&(r.mod_list_seq=e.mod_list_seq),null!=e.user_auth_seq&&e.hasOwnProperty("user_auth_seq")&&(r.user_auth_seq=e.user_auth_seq),null!=e.room_auth_seq&&e.hasOwnProperty("room_auth_seq")&&(r.room_auth_seq=e.room_auth_seq),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_create_mod_rsp=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_seq=0,e.prototype.mod_list_seq=0,e.prototype.mod_create_time=K.Long?K.Long.fromBits(0,0,!1):0,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_create_mod_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.mod_id=e.uint64();break;case 2:o.mod_seq=e.uint32();break;case 3:o.mod_list_seq=e.uint32();break;case 4:o.mod_create_time=e.int64();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_create_mod_rsp)return e;let t=new Q.proto_edu_v1_web.proto_create_mod_rsp;return null!=e.mod_id&&(K.Long?(t.mod_id=K.Long.fromValue(e.mod_id)).unsigned=!0:"string"==typeof e.mod_id?t.mod_id=parseInt(e.mod_id,10):"number"==typeof e.mod_id?t.mod_id=e.mod_id:"object"==typeof e.mod_id&&(t.mod_id=new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0))),null!=e.mod_seq&&(t.mod_seq=e.mod_seq>>>0),null!=e.mod_list_seq&&(t.mod_list_seq=e.mod_list_seq>>>0),null!=e.mod_create_time&&(K.Long?(t.mod_create_time=K.Long.fromValue(e.mod_create_time)).unsigned=!1:"string"==typeof e.mod_create_time?t.mod_create_time=parseInt(e.mod_create_time,10):"number"==typeof e.mod_create_time?t.mod_create_time=e.mod_create_time:"object"==typeof e.mod_create_time&&(t.mod_create_time=new K.LongBits(e.mod_create_time.low>>>0,e.mod_create_time.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});let r={};if(t.defaults){if(K.Long){let e=new K.Long(0,0,!0);r.mod_id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_id=t.longs===String?"0":0;if(r.mod_seq=0,r.mod_list_seq=0,K.Long){let e=new K.Long(0,0,!1);r.mod_create_time=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_create_time=t.longs===String?"0":0}return null!=e.mod_id&&e.hasOwnProperty("mod_id")&&("number"==typeof e.mod_id?r.mod_id=t.longs===String?String(e.mod_id):e.mod_id:r.mod_id=t.longs===String?K.Long.prototype.toString.call(e.mod_id):t.longs===Number?new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0):e.mod_id),null!=e.mod_seq&&e.hasOwnProperty("mod_seq")&&(r.mod_seq=e.mod_seq),null!=e.mod_list_seq&&e.hasOwnProperty("mod_list_seq")&&(r.mod_list_seq=e.mod_list_seq),null!=e.mod_create_time&&e.hasOwnProperty("mod_create_time")&&("number"==typeof e.mod_create_time?r.mod_create_time=t.longs===String?String(e.mod_create_time):e.mod_create_time:r.mod_create_time=t.longs===String?K.Long.prototype.toString.call(e.mod_create_time):t.longs===Number?new K.LongBits(e.mod_create_time.low>>>0,e.mod_create_time.high>>>0).toNumber():e.mod_create_time),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_destroy_mod_rsp=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_list_seq=0,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_destroy_mod_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.mod_id=e.uint64();break;case 2:o.mod_list_seq=e.uint32();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_destroy_mod_rsp)return e;let t=new Q.proto_edu_v1_web.proto_destroy_mod_rsp;return null!=e.mod_id&&(K.Long?(t.mod_id=K.Long.fromValue(e.mod_id)).unsigned=!0:"string"==typeof e.mod_id?t.mod_id=parseInt(e.mod_id,10):"number"==typeof e.mod_id?t.mod_id=e.mod_id:"object"==typeof e.mod_id&&(t.mod_id=new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0))),null!=e.mod_list_seq&&(t.mod_list_seq=e.mod_list_seq>>>0),t},e.toObject=function(e,t){t||(t={});let r={};if(t.defaults){if(K.Long){let e=new K.Long(0,0,!0);r.mod_id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_id=t.longs===String?"0":0;r.mod_list_seq=0}return null!=e.mod_id&&e.hasOwnProperty("mod_id")&&("number"==typeof e.mod_id?r.mod_id=t.longs===String?String(e.mod_id):e.mod_id:r.mod_id=t.longs===String?K.Long.prototype.toString.call(e.mod_id):t.longs===Number?new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0):e.mod_id),null!=e.mod_list_seq&&e.hasOwnProperty("mod_list_seq")&&(r.mod_list_seq=e.mod_list_seq),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_modify_mod_rsp=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_seq=0,e.prototype.mod_list_seq=0,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_modify_mod_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.mod_id=e.uint64();break;case 2:o.mod_seq=e.uint32();break;case 3:o.mod_list_seq=e.uint32();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_modify_mod_rsp)return e;let t=new Q.proto_edu_v1_web.proto_modify_mod_rsp;return null!=e.mod_id&&(K.Long?(t.mod_id=K.Long.fromValue(e.mod_id)).unsigned=!0:"string"==typeof e.mod_id?t.mod_id=parseInt(e.mod_id,10):"number"==typeof e.mod_id?t.mod_id=e.mod_id:"object"==typeof e.mod_id&&(t.mod_id=new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0))),null!=e.mod_seq&&(t.mod_seq=e.mod_seq>>>0),null!=e.mod_list_seq&&(t.mod_list_seq=e.mod_list_seq>>>0),t},e.toObject=function(e,t){t||(t={});let r={};if(t.defaults){if(K.Long){let e=new K.Long(0,0,!0);r.mod_id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_id=t.longs===String?"0":0;r.mod_seq=0,r.mod_list_seq=0}return null!=e.mod_id&&e.hasOwnProperty("mod_id")&&("number"==typeof e.mod_id?r.mod_id=t.longs===String?String(e.mod_id):e.mod_id:r.mod_id=t.longs===String?K.Long.prototype.toString.call(e.mod_id):t.longs===Number?new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0):e.mod_id),null!=e.mod_seq&&e.hasOwnProperty("mod_seq")&&(r.mod_seq=e.mod_seq),null!=e.mod_list_seq&&e.hasOwnProperty("mod_list_seq")&&(r.mod_list_seq=e.mod_list_seq),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_get_mod_rsp=function(){function e(e){if(this.mod_list=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_list=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_get_mod_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.mod_list&&o.mod_list.length||(o.mod_list=[]),o.mod_list.push(Q.proto_edu_v1_web.proto_mod.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_get_mod_rsp)return e;let t=new Q.proto_edu_v1_web.proto_get_mod_rsp;if(e.mod_list){if(!Array.isArray(e.mod_list))throw TypeError(".proto_edu_v1_web.proto_get_mod_rsp.mod_list: array expected");t.mod_list=[];for(let r=0;r<e.mod_list.length;++r){if("object"!=typeof e.mod_list[r])throw TypeError(".proto_edu_v1_web.proto_get_mod_rsp.mod_list: object expected");t.mod_list[r]=Q.proto_edu_v1_web.proto_mod.fromObject(e.mod_list[r])}}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.mod_list=[]),e.mod_list&&e.mod_list.length){r.mod_list=[];for(let o=0;o<e.mod_list.length;++o)r.mod_list[o]=Q.proto_edu_v1_web.proto_mod.toObject(e.mod_list[o],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_get_mod_list_rsp=function(){function e(e){if(this.mod_list=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_list_seq=0,e.prototype.marker="",e.prototype.mod_type=0,e.prototype.mod_list=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_get_mod_list_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.mod_list_seq=e.uint32();break;case 2:o.marker=e.string();break;case 3:o.mod_type=e.uint32();break;case 4:o.mod_list&&o.mod_list.length||(o.mod_list=[]),o.mod_list.push(Q.proto_edu_v1_web.proto_mod.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_get_mod_list_rsp)return e;let t=new Q.proto_edu_v1_web.proto_get_mod_list_rsp;if(null!=e.mod_list_seq&&(t.mod_list_seq=e.mod_list_seq>>>0),null!=e.marker&&(t.marker=String(e.marker)),null!=e.mod_type&&(t.mod_type=e.mod_type>>>0),e.mod_list){if(!Array.isArray(e.mod_list))throw TypeError(".proto_edu_v1_web.proto_get_mod_list_rsp.mod_list: array expected");t.mod_list=[];for(let r=0;r<e.mod_list.length;++r){if("object"!=typeof e.mod_list[r])throw TypeError(".proto_edu_v1_web.proto_get_mod_list_rsp.mod_list: object expected");t.mod_list[r]=Q.proto_edu_v1_web.proto_mod.fromObject(e.mod_list[r])}}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.mod_list=[]),t.defaults&&(r.mod_list_seq=0,r.marker="",r.mod_type=0),null!=e.mod_list_seq&&e.hasOwnProperty("mod_list_seq")&&(r.mod_list_seq=e.mod_list_seq),null!=e.marker&&e.hasOwnProperty("marker")&&(r.marker=e.marker),null!=e.mod_type&&e.hasOwnProperty("mod_type")&&(r.mod_type=e.mod_type),e.mod_list&&e.mod_list.length){r.mod_list=[];for(let o=0;o<e.mod_list.length;++o)r.mod_list[o]=Q.proto_edu_v1_web.proto_mod.toObject(e.mod_list[o],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_draw_page_graphics_rsp=function(){function e(e){if(this.pages=[],this.graphic_list_seqs=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.pages=K.emptyArray,e.prototype.graphic_list_seqs=K.emptyArray,e.prototype.commit_time=K.Long?K.Long.fromBits(0,0,!1):0,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_draw_page_graphics_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.mod_id=e.uint64();break;case 2:if(o.pages&&o.pages.length||(o.pages=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.pages.push(e.uint32())}else o.pages.push(e.uint32());break;case 3:if(o.graphic_list_seqs&&o.graphic_list_seqs.length||(o.graphic_list_seqs=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.graphic_list_seqs.push(e.uint32())}else o.graphic_list_seqs.push(e.uint32());break;case 4:o.commit_time=e.int64();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_draw_page_graphics_rsp)return e;let t=new Q.proto_edu_v1_web.proto_draw_page_graphics_rsp;if(null!=e.mod_id&&(K.Long?(t.mod_id=K.Long.fromValue(e.mod_id)).unsigned=!0:"string"==typeof e.mod_id?t.mod_id=parseInt(e.mod_id,10):"number"==typeof e.mod_id?t.mod_id=e.mod_id:"object"==typeof e.mod_id&&(t.mod_id=new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0))),e.pages){if(!Array.isArray(e.pages))throw TypeError(".proto_edu_v1_web.proto_draw_page_graphics_rsp.pages: array expected");t.pages=[];for(let r=0;r<e.pages.length;++r)t.pages[r]=e.pages[r]>>>0}if(e.graphic_list_seqs){if(!Array.isArray(e.graphic_list_seqs))throw TypeError(".proto_edu_v1_web.proto_draw_page_graphics_rsp.graphic_list_seqs: array expected");t.graphic_list_seqs=[];for(let r=0;r<e.graphic_list_seqs.length;++r)t.graphic_list_seqs[r]=e.graphic_list_seqs[r]>>>0}return null!=e.commit_time&&(K.Long?(t.commit_time=K.Long.fromValue(e.commit_time)).unsigned=!1:"string"==typeof e.commit_time?t.commit_time=parseInt(e.commit_time,10):"number"==typeof e.commit_time?t.commit_time=e.commit_time:"object"==typeof e.commit_time&&(t.commit_time=new K.LongBits(e.commit_time.low>>>0,e.commit_time.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.pages=[],r.graphic_list_seqs=[]),t.defaults){if(K.Long){let e=new K.Long(0,0,!0);r.mod_id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_id=t.longs===String?"0":0;if(K.Long){let e=new K.Long(0,0,!1);r.commit_time=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.commit_time=t.longs===String?"0":0}if(null!=e.mod_id&&e.hasOwnProperty("mod_id")&&("number"==typeof e.mod_id?r.mod_id=t.longs===String?String(e.mod_id):e.mod_id:r.mod_id=t.longs===String?K.Long.prototype.toString.call(e.mod_id):t.longs===Number?new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0):e.mod_id),e.pages&&e.pages.length){r.pages=[];for(let t=0;t<e.pages.length;++t)r.pages[t]=e.pages[t]}if(e.graphic_list_seqs&&e.graphic_list_seqs.length){r.graphic_list_seqs=[];for(let t=0;t<e.graphic_list_seqs.length;++t)r.graphic_list_seqs[t]=e.graphic_list_seqs[t]}return null!=e.commit_time&&e.hasOwnProperty("commit_time")&&("number"==typeof e.commit_time?r.commit_time=t.longs===String?String(e.commit_time):e.commit_time:r.commit_time=t.longs===String?K.Long.prototype.toString.call(e.commit_time):t.longs===Number?new K.LongBits(e.commit_time.low>>>0,e.commit_time.high>>>0).toNumber():e.commit_time),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_clear_page_graphics_rsp=function(){function e(e){if(this.pages=[],this.graphic_list_seqs=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.pages=K.emptyArray,e.prototype.graphic_list_seqs=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_clear_page_graphics_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.mod_id=e.uint64();break;case 2:if(o.pages&&o.pages.length||(o.pages=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.pages.push(e.uint32())}else o.pages.push(e.uint32());break;case 3:if(o.graphic_list_seqs&&o.graphic_list_seqs.length||(o.graphic_list_seqs=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.graphic_list_seqs.push(e.uint32())}else o.graphic_list_seqs.push(e.uint32());break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_clear_page_graphics_rsp)return e;let t=new Q.proto_edu_v1_web.proto_clear_page_graphics_rsp;if(null!=e.mod_id&&(K.Long?(t.mod_id=K.Long.fromValue(e.mod_id)).unsigned=!0:"string"==typeof e.mod_id?t.mod_id=parseInt(e.mod_id,10):"number"==typeof e.mod_id?t.mod_id=e.mod_id:"object"==typeof e.mod_id&&(t.mod_id=new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0))),e.pages){if(!Array.isArray(e.pages))throw TypeError(".proto_edu_v1_web.proto_clear_page_graphics_rsp.pages: array expected");t.pages=[];for(let r=0;r<e.pages.length;++r)t.pages[r]=e.pages[r]>>>0}if(e.graphic_list_seqs){if(!Array.isArray(e.graphic_list_seqs))throw TypeError(".proto_edu_v1_web.proto_clear_page_graphics_rsp.graphic_list_seqs: array expected");t.graphic_list_seqs=[];for(let r=0;r<e.graphic_list_seqs.length;++r)t.graphic_list_seqs[r]=e.graphic_list_seqs[r]>>>0}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.pages=[],r.graphic_list_seqs=[]),t.defaults)if(K.Long){let e=new K.Long(0,0,!0);r.mod_id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_id=t.longs===String?"0":0;if(null!=e.mod_id&&e.hasOwnProperty("mod_id")&&("number"==typeof e.mod_id?r.mod_id=t.longs===String?String(e.mod_id):e.mod_id:r.mod_id=t.longs===String?K.Long.prototype.toString.call(e.mod_id):t.longs===Number?new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0):e.mod_id),e.pages&&e.pages.length){r.pages=[];for(let t=0;t<e.pages.length;++t)r.pages[t]=e.pages[t]}if(e.graphic_list_seqs&&e.graphic_list_seqs.length){r.graphic_list_seqs=[];for(let t=0;t<e.graphic_list_seqs.length;++t)r.graphic_list_seqs[t]=e.graphic_list_seqs[t]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_get_page_graphics_rsp=function(){function e(e){if(this.pages=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.pages=K.emptyArray,e.prototype.operate_expire_time=K.Long?K.Long.fromBits(0,0,!0):0,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_get_page_graphics_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.pages&&o.pages.length||(o.pages=[]),o.pages.push(Q.proto_edu_v1_web.proto_get_page_graphics_info.decode(e,e.uint32()));break;case 2:o.operate_expire_time=e.uint64();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_get_page_graphics_rsp)return e;let t=new Q.proto_edu_v1_web.proto_get_page_graphics_rsp;if(e.pages){if(!Array.isArray(e.pages))throw TypeError(".proto_edu_v1_web.proto_get_page_graphics_rsp.pages: array expected");t.pages=[];for(let r=0;r<e.pages.length;++r){if("object"!=typeof e.pages[r])throw TypeError(".proto_edu_v1_web.proto_get_page_graphics_rsp.pages: object expected");t.pages[r]=Q.proto_edu_v1_web.proto_get_page_graphics_info.fromObject(e.pages[r])}}return null!=e.operate_expire_time&&(K.Long?(t.operate_expire_time=K.Long.fromValue(e.operate_expire_time)).unsigned=!0:"string"==typeof e.operate_expire_time?t.operate_expire_time=parseInt(e.operate_expire_time,10):"number"==typeof e.operate_expire_time?t.operate_expire_time=e.operate_expire_time:"object"==typeof e.operate_expire_time&&(t.operate_expire_time=new K.LongBits(e.operate_expire_time.low>>>0,e.operate_expire_time.high>>>0).toNumber(!0))),t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.pages=[]),t.defaults)if(K.Long){let e=new K.Long(0,0,!0);r.operate_expire_time=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.operate_expire_time=t.longs===String?"0":0;if(e.pages&&e.pages.length){r.pages=[];for(let o=0;o<e.pages.length;++o)r.pages[o]=Q.proto_edu_v1_web.proto_get_page_graphics_info.toObject(e.pages[o],t)}return null!=e.operate_expire_time&&e.hasOwnProperty("operate_expire_time")&&("number"==typeof e.operate_expire_time?r.operate_expire_time=t.longs===String?String(e.operate_expire_time):e.operate_expire_time:r.operate_expire_time=t.longs===String?K.Long.prototype.toString.call(e.operate_expire_time):t.longs===Number?new K.LongBits(e.operate_expire_time.low>>>0,e.operate_expire_time.high>>>0).toNumber(!0):e.operate_expire_time),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_get_page_graphics_info=function(){function e(e){if(this.graphic_list=[],this.del_graphic_id_list=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.page=0,e.prototype.ret_graphic_list_seq=0,e.prototype.svr_graphic_list_seq=0,e.prototype.graphic_list=K.emptyArray,e.prototype.del_graphic_id_list=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_get_page_graphics_info;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.page=e.uint32();break;case 2:o.ret_graphic_list_seq=e.uint32();break;case 3:o.svr_graphic_list_seq=e.uint32();break;case 4:o.graphic_list&&o.graphic_list.length||(o.graphic_list=[]),o.graphic_list.push(Q.proto_edu_v1_web.proto_graphic.decode(e,e.uint32()));break;case 5:if(o.del_graphic_id_list&&o.del_graphic_id_list.length||(o.del_graphic_id_list=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.del_graphic_id_list.push(e.uint64())}else o.del_graphic_id_list.push(e.uint64());break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_get_page_graphics_info)return e;let t=new Q.proto_edu_v1_web.proto_get_page_graphics_info;if(null!=e.page&&(t.page=e.page>>>0),null!=e.ret_graphic_list_seq&&(t.ret_graphic_list_seq=e.ret_graphic_list_seq>>>0),null!=e.svr_graphic_list_seq&&(t.svr_graphic_list_seq=e.svr_graphic_list_seq>>>0),e.graphic_list){if(!Array.isArray(e.graphic_list))throw TypeError(".proto_edu_v1_web.proto_get_page_graphics_info.graphic_list: array expected");t.graphic_list=[];for(let r=0;r<e.graphic_list.length;++r){if("object"!=typeof e.graphic_list[r])throw TypeError(".proto_edu_v1_web.proto_get_page_graphics_info.graphic_list: object expected");t.graphic_list[r]=Q.proto_edu_v1_web.proto_graphic.fromObject(e.graphic_list[r])}}if(e.del_graphic_id_list){if(!Array.isArray(e.del_graphic_id_list))throw TypeError(".proto_edu_v1_web.proto_get_page_graphics_info.del_graphic_id_list: array expected");t.del_graphic_id_list=[];for(let r=0;r<e.del_graphic_id_list.length;++r)K.Long?(t.del_graphic_id_list[r]=K.Long.fromValue(e.del_graphic_id_list[r])).unsigned=!0:"string"==typeof e.del_graphic_id_list[r]?t.del_graphic_id_list[r]=parseInt(e.del_graphic_id_list[r],10):"number"==typeof e.del_graphic_id_list[r]?t.del_graphic_id_list[r]=e.del_graphic_id_list[r]:"object"==typeof e.del_graphic_id_list[r]&&(t.del_graphic_id_list[r]=new K.LongBits(e.del_graphic_id_list[r].low>>>0,e.del_graphic_id_list[r].high>>>0).toNumber(!0))}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.graphic_list=[],r.del_graphic_id_list=[]),t.defaults&&(r.page=0,r.ret_graphic_list_seq=0,r.svr_graphic_list_seq=0),null!=e.page&&e.hasOwnProperty("page")&&(r.page=e.page),null!=e.ret_graphic_list_seq&&e.hasOwnProperty("ret_graphic_list_seq")&&(r.ret_graphic_list_seq=e.ret_graphic_list_seq),null!=e.svr_graphic_list_seq&&e.hasOwnProperty("svr_graphic_list_seq")&&(r.svr_graphic_list_seq=e.svr_graphic_list_seq),e.graphic_list&&e.graphic_list.length){r.graphic_list=[];for(let o=0;o<e.graphic_list.length;++o)r.graphic_list[o]=Q.proto_edu_v1_web.proto_graphic.toObject(e.graphic_list[o],t)}if(e.del_graphic_id_list&&e.del_graphic_id_list.length){r.del_graphic_id_list=[];for(let o=0;o<e.del_graphic_id_list.length;++o)"number"==typeof e.del_graphic_id_list[o]?r.del_graphic_id_list[o]=t.longs===String?String(e.del_graphic_id_list[o]):e.del_graphic_id_list[o]:r.del_graphic_id_list[o]=t.longs===String?K.Long.prototype.toString.call(e.del_graphic_id_list[o]):t.longs===Number?new K.LongBits(e.del_graphic_id_list[o].low>>>0,e.del_graphic_id_list[o].high>>>0).toNumber(!0):e.del_graphic_id_list[o]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_get_user_auth_rsp=function(){function e(e){if(this.module_auth=[],this.graphic_auth=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id_name="",e.prototype.auth_seq=0,e.prototype.module_auth=K.emptyArray,e.prototype.graphic_auth=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_get_user_auth_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.id_name=e.string();break;case 2:o.auth_seq=e.uint32();break;case 3:if(o.module_auth&&o.module_auth.length||(o.module_auth=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.module_auth.push(e.uint32())}else o.module_auth.push(e.uint32());break;case 4:if(o.graphic_auth&&o.graphic_auth.length||(o.graphic_auth=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.graphic_auth.push(e.uint32())}else o.graphic_auth.push(e.uint32());break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_get_user_auth_rsp)return e;let t=new Q.proto_edu_v1_web.proto_get_user_auth_rsp;if(null!=e.id_name&&(t.id_name=String(e.id_name)),null!=e.auth_seq&&(t.auth_seq=e.auth_seq>>>0),e.module_auth){if(!Array.isArray(e.module_auth))throw TypeError(".proto_edu_v1_web.proto_get_user_auth_rsp.module_auth: array expected");t.module_auth=[];for(let r=0;r<e.module_auth.length;++r)t.module_auth[r]=e.module_auth[r]>>>0}if(e.graphic_auth){if(!Array.isArray(e.graphic_auth))throw TypeError(".proto_edu_v1_web.proto_get_user_auth_rsp.graphic_auth: array expected");t.graphic_auth=[];for(let r=0;r<e.graphic_auth.length;++r)t.graphic_auth[r]=e.graphic_auth[r]>>>0}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.module_auth=[],r.graphic_auth=[]),t.defaults&&(r.id_name="",r.auth_seq=0),null!=e.id_name&&e.hasOwnProperty("id_name")&&(r.id_name=e.id_name),null!=e.auth_seq&&e.hasOwnProperty("auth_seq")&&(r.auth_seq=e.auth_seq),e.module_auth&&e.module_auth.length){r.module_auth=[];for(let t=0;t<e.module_auth.length;++t)r.module_auth[t]=e.module_auth[t]}if(e.graphic_auth&&e.graphic_auth.length){r.graphic_auth=[];for(let t=0;t<e.graphic_auth.length;++t)r.graphic_auth[t]=e.graphic_auth[t]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.proto_get_room_auth_rsp=function(){function e(e){if(this.module_auth=[],this.graphic_auth=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.auth_seq=0,e.prototype.module_auth=K.emptyArray,e.prototype.graphic_auth=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.proto_get_room_auth_rsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.auth_seq=e.uint32();break;case 2:if(o.module_auth&&o.module_auth.length||(o.module_auth=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.module_auth.push(e.uint32())}else o.module_auth.push(e.uint32());break;case 3:if(o.graphic_auth&&o.graphic_auth.length||(o.graphic_auth=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.graphic_auth.push(e.uint32())}else o.graphic_auth.push(e.uint32());break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.proto_get_room_auth_rsp)return e;let t=new Q.proto_edu_v1_web.proto_get_room_auth_rsp;if(null!=e.auth_seq&&(t.auth_seq=e.auth_seq>>>0),e.module_auth){if(!Array.isArray(e.module_auth))throw TypeError(".proto_edu_v1_web.proto_get_room_auth_rsp.module_auth: array expected");t.module_auth=[];for(let r=0;r<e.module_auth.length;++r)t.module_auth[r]=e.module_auth[r]>>>0}if(e.graphic_auth){if(!Array.isArray(e.graphic_auth))throw TypeError(".proto_edu_v1_web.proto_get_room_auth_rsp.graphic_auth: array expected");t.graphic_auth=[];for(let r=0;r<e.graphic_auth.length;++r)t.graphic_auth[r]=e.graphic_auth[r]>>>0}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.module_auth=[],r.graphic_auth=[]),t.defaults&&(r.auth_seq=0),null!=e.auth_seq&&e.hasOwnProperty("auth_seq")&&(r.auth_seq=e.auth_seq),e.module_auth&&e.module_auth.length){r.module_auth=[];for(let t=0;t<e.module_auth.length;++t)r.module_auth[t]=e.module_auth[t]}if(e.graphic_auth&&e.graphic_auth.length){r.graphic_auth=[];for(let t=0;t<e.graphic_auth.length;++t)r.graphic_auth[t]=e.graphic_auth[t]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.push_set_mod=function(){function e(e){if(this.action_list=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.room_id="",e.prototype.mod_list_seq=0,e.prototype.action_list=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.push_set_mod;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.room_id=e.string();break;case 2:o.mod_list_seq=e.uint32();break;case 3:o.action_list&&o.action_list.length||(o.action_list=[]),o.action_list.push(Q.proto_edu_v1_web.push_set_mod_action.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.push_set_mod)return e;let t=new Q.proto_edu_v1_web.push_set_mod;if(null!=e.room_id&&(t.room_id=String(e.room_id)),null!=e.mod_list_seq&&(t.mod_list_seq=e.mod_list_seq>>>0),e.action_list){if(!Array.isArray(e.action_list))throw TypeError(".proto_edu_v1_web.push_set_mod.action_list: array expected");t.action_list=[];for(let r=0;r<e.action_list.length;++r){if("object"!=typeof e.action_list[r])throw TypeError(".proto_edu_v1_web.push_set_mod.action_list: object expected");t.action_list[r]=Q.proto_edu_v1_web.push_set_mod_action.fromObject(e.action_list[r])}}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.action_list=[]),t.defaults&&(r.room_id="",r.mod_list_seq=0),null!=e.room_id&&e.hasOwnProperty("room_id")&&(r.room_id=e.room_id),null!=e.mod_list_seq&&e.hasOwnProperty("mod_list_seq")&&(r.mod_list_seq=e.mod_list_seq),e.action_list&&e.action_list.length){r.action_list=[];for(let o=0;o<e.action_list.length;++o)r.action_list[o]=Q.proto_edu_v1_web.push_set_mod_action.toObject(e.action_list[o],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.push_set_mod_action=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.action=0,e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_type=0,e.prototype.mod_subtype=0,e.prototype.mod_seq=0,e.prototype.mod_title="",e.prototype.mod_pos="",e.prototype.mod_status=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.mod_content="",e.prototype.mod_extra="",e.prototype.mod_reserve=0,e.prototype.mod_create_time=K.Long?K.Long.fromBits(0,0,!1):0,e.prototype.is_modify_mod_title=!1,e.prototype.is_modify_mod_pos=!1,e.prototype.is_modify_mod_status=!1,e.prototype.is_modify_mod_content=!1,e.prototype.is_modify_mod_extra=!1,e.prototype.is_modify_mod_reserve=!1,e.prototype.mod_horizontal_percent=0,e.prototype.mod_vertical_percent=0,e.prototype.is_modify_mod_horizontal_percent=!1,e.prototype.is_modify_mod_vertical_percent=!1,e.prototype.is_modify_mod_scale=!1,e.prototype.mod_scale="",e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.push_set_mod_action;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.action=e.uint32();break;case 2:o.mod_id=e.uint64();break;case 3:o.mod_type=e.uint32();break;case 4:o.mod_subtype=e.uint32();break;case 5:o.mod_seq=e.uint32();break;case 6:o.mod_title=e.string();break;case 7:o.mod_pos=e.string();break;case 8:o.mod_status=e.uint64();break;case 9:o.mod_content=e.string();break;case 10:o.mod_extra=e.string();break;case 11:o.mod_reserve=e.uint32();break;case 12:o.mod_create_time=e.int64();break;case 13:o.is_modify_mod_title=e.bool();break;case 14:o.is_modify_mod_pos=e.bool();break;case 15:o.is_modify_mod_status=e.bool();break;case 16:o.is_modify_mod_content=e.bool();break;case 17:o.is_modify_mod_extra=e.bool();break;case 18:o.is_modify_mod_reserve=e.bool();break;case 19:o.mod_horizontal_percent=e.float();break;case 20:o.mod_vertical_percent=e.float();break;case 21:o.is_modify_mod_horizontal_percent=e.bool();break;case 22:o.is_modify_mod_vertical_percent=e.bool();break;case 23:o.is_modify_mod_scale=e.bool();break;case 24:o.mod_scale=e.string();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.push_set_mod_action)return e;let t=new Q.proto_edu_v1_web.push_set_mod_action;return null!=e.action&&(t.action=e.action>>>0),null!=e.mod_id&&(K.Long?(t.mod_id=K.Long.fromValue(e.mod_id)).unsigned=!0:"string"==typeof e.mod_id?t.mod_id=parseInt(e.mod_id,10):"number"==typeof e.mod_id?t.mod_id=e.mod_id:"object"==typeof e.mod_id&&(t.mod_id=new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0))),null!=e.mod_type&&(t.mod_type=e.mod_type>>>0),null!=e.mod_subtype&&(t.mod_subtype=e.mod_subtype>>>0),null!=e.mod_seq&&(t.mod_seq=e.mod_seq>>>0),null!=e.mod_title&&(t.mod_title=String(e.mod_title)),null!=e.mod_pos&&(t.mod_pos=String(e.mod_pos)),null!=e.mod_status&&(K.Long?(t.mod_status=K.Long.fromValue(e.mod_status)).unsigned=!0:"string"==typeof e.mod_status?t.mod_status=parseInt(e.mod_status,10):"number"==typeof e.mod_status?t.mod_status=e.mod_status:"object"==typeof e.mod_status&&(t.mod_status=new K.LongBits(e.mod_status.low>>>0,e.mod_status.high>>>0).toNumber(!0))),null!=e.mod_content&&(t.mod_content=String(e.mod_content)),null!=e.mod_extra&&(t.mod_extra=String(e.mod_extra)),null!=e.mod_reserve&&(t.mod_reserve=e.mod_reserve>>>0),null!=e.mod_create_time&&(K.Long?(t.mod_create_time=K.Long.fromValue(e.mod_create_time)).unsigned=!1:"string"==typeof e.mod_create_time?t.mod_create_time=parseInt(e.mod_create_time,10):"number"==typeof e.mod_create_time?t.mod_create_time=e.mod_create_time:"object"==typeof e.mod_create_time&&(t.mod_create_time=new K.LongBits(e.mod_create_time.low>>>0,e.mod_create_time.high>>>0).toNumber())),null!=e.is_modify_mod_title&&(t.is_modify_mod_title=Boolean(e.is_modify_mod_title)),null!=e.is_modify_mod_pos&&(t.is_modify_mod_pos=Boolean(e.is_modify_mod_pos)),null!=e.is_modify_mod_status&&(t.is_modify_mod_status=Boolean(e.is_modify_mod_status)),null!=e.is_modify_mod_content&&(t.is_modify_mod_content=Boolean(e.is_modify_mod_content)),null!=e.is_modify_mod_extra&&(t.is_modify_mod_extra=Boolean(e.is_modify_mod_extra)),null!=e.is_modify_mod_reserve&&(t.is_modify_mod_reserve=Boolean(e.is_modify_mod_reserve)),null!=e.mod_horizontal_percent&&(t.mod_horizontal_percent=Number(e.mod_horizontal_percent)),null!=e.mod_vertical_percent&&(t.mod_vertical_percent=Number(e.mod_vertical_percent)),null!=e.is_modify_mod_horizontal_percent&&(t.is_modify_mod_horizontal_percent=Boolean(e.is_modify_mod_horizontal_percent)),null!=e.is_modify_mod_vertical_percent&&(t.is_modify_mod_vertical_percent=Boolean(e.is_modify_mod_vertical_percent)),null!=e.is_modify_mod_scale&&(t.is_modify_mod_scale=Boolean(e.is_modify_mod_scale)),null!=e.mod_scale&&(t.mod_scale=String(e.mod_scale)),t},e.toObject=function(e,t){t||(t={});let r={};if(t.defaults){if(r.action=0,K.Long){let e=new K.Long(0,0,!0);r.mod_id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_id=t.longs===String?"0":0;if(r.mod_type=0,r.mod_subtype=0,r.mod_seq=0,r.mod_title="",r.mod_pos="",K.Long){let e=new K.Long(0,0,!0);r.mod_status=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_status=t.longs===String?"0":0;if(r.mod_content="",r.mod_extra="",r.mod_reserve=0,K.Long){let e=new K.Long(0,0,!1);r.mod_create_time=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_create_time=t.longs===String?"0":0;r.is_modify_mod_title=!1,r.is_modify_mod_pos=!1,r.is_modify_mod_status=!1,r.is_modify_mod_content=!1,r.is_modify_mod_extra=!1,r.is_modify_mod_reserve=!1,r.mod_horizontal_percent=0,r.mod_vertical_percent=0,r.is_modify_mod_horizontal_percent=!1,r.is_modify_mod_vertical_percent=!1,r.is_modify_mod_scale=!1,r.mod_scale=""}return null!=e.action&&e.hasOwnProperty("action")&&(r.action=e.action),null!=e.mod_id&&e.hasOwnProperty("mod_id")&&("number"==typeof e.mod_id?r.mod_id=t.longs===String?String(e.mod_id):e.mod_id:r.mod_id=t.longs===String?K.Long.prototype.toString.call(e.mod_id):t.longs===Number?new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0):e.mod_id),null!=e.mod_type&&e.hasOwnProperty("mod_type")&&(r.mod_type=e.mod_type),null!=e.mod_subtype&&e.hasOwnProperty("mod_subtype")&&(r.mod_subtype=e.mod_subtype),null!=e.mod_seq&&e.hasOwnProperty("mod_seq")&&(r.mod_seq=e.mod_seq),null!=e.mod_title&&e.hasOwnProperty("mod_title")&&(r.mod_title=e.mod_title),null!=e.mod_pos&&e.hasOwnProperty("mod_pos")&&(r.mod_pos=e.mod_pos),null!=e.mod_status&&e.hasOwnProperty("mod_status")&&("number"==typeof e.mod_status?r.mod_status=t.longs===String?String(e.mod_status):e.mod_status:r.mod_status=t.longs===String?K.Long.prototype.toString.call(e.mod_status):t.longs===Number?new K.LongBits(e.mod_status.low>>>0,e.mod_status.high>>>0).toNumber(!0):e.mod_status),null!=e.mod_content&&e.hasOwnProperty("mod_content")&&(r.mod_content=e.mod_content),null!=e.mod_extra&&e.hasOwnProperty("mod_extra")&&(r.mod_extra=e.mod_extra),null!=e.mod_reserve&&e.hasOwnProperty("mod_reserve")&&(r.mod_reserve=e.mod_reserve),null!=e.mod_create_time&&e.hasOwnProperty("mod_create_time")&&("number"==typeof e.mod_create_time?r.mod_create_time=t.longs===String?String(e.mod_create_time):e.mod_create_time:r.mod_create_time=t.longs===String?K.Long.prototype.toString.call(e.mod_create_time):t.longs===Number?new K.LongBits(e.mod_create_time.low>>>0,e.mod_create_time.high>>>0).toNumber():e.mod_create_time),null!=e.is_modify_mod_title&&e.hasOwnProperty("is_modify_mod_title")&&(r.is_modify_mod_title=e.is_modify_mod_title),null!=e.is_modify_mod_pos&&e.hasOwnProperty("is_modify_mod_pos")&&(r.is_modify_mod_pos=e.is_modify_mod_pos),null!=e.is_modify_mod_status&&e.hasOwnProperty("is_modify_mod_status")&&(r.is_modify_mod_status=e.is_modify_mod_status),null!=e.is_modify_mod_content&&e.hasOwnProperty("is_modify_mod_content")&&(r.is_modify_mod_content=e.is_modify_mod_content),null!=e.is_modify_mod_extra&&e.hasOwnProperty("is_modify_mod_extra")&&(r.is_modify_mod_extra=e.is_modify_mod_extra),null!=e.is_modify_mod_reserve&&e.hasOwnProperty("is_modify_mod_reserve")&&(r.is_modify_mod_reserve=e.is_modify_mod_reserve),null!=e.mod_horizontal_percent&&e.hasOwnProperty("mod_horizontal_percent")&&(r.mod_horizontal_percent=t.json&&!isFinite(e.mod_horizontal_percent)?String(e.mod_horizontal_percent):e.mod_horizontal_percent),null!=e.mod_vertical_percent&&e.hasOwnProperty("mod_vertical_percent")&&(r.mod_vertical_percent=t.json&&!isFinite(e.mod_vertical_percent)?String(e.mod_vertical_percent):e.mod_vertical_percent),null!=e.is_modify_mod_horizontal_percent&&e.hasOwnProperty("is_modify_mod_horizontal_percent")&&(r.is_modify_mod_horizontal_percent=e.is_modify_mod_horizontal_percent),null!=e.is_modify_mod_vertical_percent&&e.hasOwnProperty("is_modify_mod_vertical_percent")&&(r.is_modify_mod_vertical_percent=e.is_modify_mod_vertical_percent),null!=e.is_modify_mod_scale&&e.hasOwnProperty("is_modify_mod_scale")&&(r.is_modify_mod_scale=e.is_modify_mod_scale),null!=e.mod_scale&&e.hasOwnProperty("mod_scale")&&(r.mod_scale=e.mod_scale),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.push_draw_page_graphics=function(){function e(e){if(this.page_graphics=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.page_graphics=K.emptyArray,e.prototype.timestamp=K.Long?K.Long.fromBits(0,0,!0):0,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.push_draw_page_graphics;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.mod_id=e.uint64();break;case 2:o.page_graphics&&o.page_graphics.length||(o.page_graphics=[]),o.page_graphics.push(Q.proto_edu_v1_web.push_draw_graphics_info.decode(e,e.uint32()));break;case 3:o.timestamp=e.uint64();break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.push_draw_page_graphics)return e;let t=new Q.proto_edu_v1_web.push_draw_page_graphics;if(null!=e.mod_id&&(K.Long?(t.mod_id=K.Long.fromValue(e.mod_id)).unsigned=!0:"string"==typeof e.mod_id?t.mod_id=parseInt(e.mod_id,10):"number"==typeof e.mod_id?t.mod_id=e.mod_id:"object"==typeof e.mod_id&&(t.mod_id=new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0))),e.page_graphics){if(!Array.isArray(e.page_graphics))throw TypeError(".proto_edu_v1_web.push_draw_page_graphics.page_graphics: array expected");t.page_graphics=[];for(let r=0;r<e.page_graphics.length;++r){if("object"!=typeof e.page_graphics[r])throw TypeError(".proto_edu_v1_web.push_draw_page_graphics.page_graphics: object expected");t.page_graphics[r]=Q.proto_edu_v1_web.push_draw_graphics_info.fromObject(e.page_graphics[r])}}return null!=e.timestamp&&(K.Long?(t.timestamp=K.Long.fromValue(e.timestamp)).unsigned=!0:"string"==typeof e.timestamp?t.timestamp=parseInt(e.timestamp,10):"number"==typeof e.timestamp?t.timestamp=e.timestamp:"object"==typeof e.timestamp&&(t.timestamp=new K.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0))),t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.page_graphics=[]),t.defaults){if(K.Long){let e=new K.Long(0,0,!0);r.mod_id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_id=t.longs===String?"0":0;if(K.Long){let e=new K.Long(0,0,!0);r.timestamp=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.timestamp=t.longs===String?"0":0}if(null!=e.mod_id&&e.hasOwnProperty("mod_id")&&("number"==typeof e.mod_id?r.mod_id=t.longs===String?String(e.mod_id):e.mod_id:r.mod_id=t.longs===String?K.Long.prototype.toString.call(e.mod_id):t.longs===Number?new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0):e.mod_id),e.page_graphics&&e.page_graphics.length){r.page_graphics=[];for(let o=0;o<e.page_graphics.length;++o)r.page_graphics[o]=Q.proto_edu_v1_web.push_draw_graphics_info.toObject(e.page_graphics[o],t)}return null!=e.timestamp&&e.hasOwnProperty("timestamp")&&("number"==typeof e.timestamp?r.timestamp=t.longs===String?String(e.timestamp):e.timestamp:r.timestamp=t.longs===String?K.Long.prototype.toString.call(e.timestamp):t.longs===Number?new K.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0):e.timestamp),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.push_draw_graphics_info=function(){function e(e){if(this.graphic_list=[],this.del_graphic_id_list=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.page=0,e.prototype.action_seq=0,e.prototype.graphic_list=K.emptyArray,e.prototype.del_graphic_id_list=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.push_draw_graphics_info;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.page=e.uint32();break;case 2:o.action_seq=e.uint32();break;case 3:o.graphic_list&&o.graphic_list.length||(o.graphic_list=[]),o.graphic_list.push(Q.proto_edu_v1_web.proto_graphic.decode(e,e.uint32()));break;case 4:if(o.del_graphic_id_list&&o.del_graphic_id_list.length||(o.del_graphic_id_list=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.del_graphic_id_list.push(e.uint64())}else o.del_graphic_id_list.push(e.uint64());break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.push_draw_graphics_info)return e;let t=new Q.proto_edu_v1_web.push_draw_graphics_info;if(null!=e.page&&(t.page=e.page>>>0),null!=e.action_seq&&(t.action_seq=e.action_seq>>>0),e.graphic_list){if(!Array.isArray(e.graphic_list))throw TypeError(".proto_edu_v1_web.push_draw_graphics_info.graphic_list: array expected");t.graphic_list=[];for(let r=0;r<e.graphic_list.length;++r){if("object"!=typeof e.graphic_list[r])throw TypeError(".proto_edu_v1_web.push_draw_graphics_info.graphic_list: object expected");t.graphic_list[r]=Q.proto_edu_v1_web.proto_graphic.fromObject(e.graphic_list[r])}}if(e.del_graphic_id_list){if(!Array.isArray(e.del_graphic_id_list))throw TypeError(".proto_edu_v1_web.push_draw_graphics_info.del_graphic_id_list: array expected");t.del_graphic_id_list=[];for(let r=0;r<e.del_graphic_id_list.length;++r)K.Long?(t.del_graphic_id_list[r]=K.Long.fromValue(e.del_graphic_id_list[r])).unsigned=!0:"string"==typeof e.del_graphic_id_list[r]?t.del_graphic_id_list[r]=parseInt(e.del_graphic_id_list[r],10):"number"==typeof e.del_graphic_id_list[r]?t.del_graphic_id_list[r]=e.del_graphic_id_list[r]:"object"==typeof e.del_graphic_id_list[r]&&(t.del_graphic_id_list[r]=new K.LongBits(e.del_graphic_id_list[r].low>>>0,e.del_graphic_id_list[r].high>>>0).toNumber(!0))}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.graphic_list=[],r.del_graphic_id_list=[]),t.defaults&&(r.page=0,r.action_seq=0),null!=e.page&&e.hasOwnProperty("page")&&(r.page=e.page),null!=e.action_seq&&e.hasOwnProperty("action_seq")&&(r.action_seq=e.action_seq),e.graphic_list&&e.graphic_list.length){r.graphic_list=[];for(let o=0;o<e.graphic_list.length;++o)r.graphic_list[o]=Q.proto_edu_v1_web.proto_graphic.toObject(e.graphic_list[o],t)}if(e.del_graphic_id_list&&e.del_graphic_id_list.length){r.del_graphic_id_list=[];for(let o=0;o<e.del_graphic_id_list.length;++o)"number"==typeof e.del_graphic_id_list[o]?r.del_graphic_id_list[o]=t.longs===String?String(e.del_graphic_id_list[o]):e.del_graphic_id_list[o]:r.del_graphic_id_list[o]=t.longs===String?K.Long.prototype.toString.call(e.del_graphic_id_list[o]):t.longs===Number?new K.LongBits(e.del_graphic_id_list[o].low>>>0,e.del_graphic_id_list[o].high>>>0).toNumber(!0):e.del_graphic_id_list[o]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.push_clear_page_graphics=function(){function e(e){if(this.pages=[],this.action_seqs=[],this.layers=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.mod_id=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.pages=K.emptyArray,e.prototype.action_seqs=K.emptyArray,e.prototype.id_name="",e.prototype.nick_name="",e.prototype.timestamp=K.Long?K.Long.fromBits(0,0,!0):0,e.prototype.layers=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.push_clear_page_graphics;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.mod_id=e.uint64();break;case 2:if(o.pages&&o.pages.length||(o.pages=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.pages.push(e.uint32())}else o.pages.push(e.uint32());break;case 3:if(o.action_seqs&&o.action_seqs.length||(o.action_seqs=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.action_seqs.push(e.uint32())}else o.action_seqs.push(e.uint32());break;case 4:o.id_name=e.string();break;case 5:o.nick_name=e.string();break;case 6:o.timestamp=e.uint64();break;case 7:if(o.layers&&o.layers.length||(o.layers=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.layers.push(e.uint32())}else o.layers.push(e.uint32());break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.push_clear_page_graphics)return e;let t=new Q.proto_edu_v1_web.push_clear_page_graphics;if(null!=e.mod_id&&(K.Long?(t.mod_id=K.Long.fromValue(e.mod_id)).unsigned=!0:"string"==typeof e.mod_id?t.mod_id=parseInt(e.mod_id,10):"number"==typeof e.mod_id?t.mod_id=e.mod_id:"object"==typeof e.mod_id&&(t.mod_id=new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0))),e.pages){if(!Array.isArray(e.pages))throw TypeError(".proto_edu_v1_web.push_clear_page_graphics.pages: array expected");t.pages=[];for(let r=0;r<e.pages.length;++r)t.pages[r]=e.pages[r]>>>0}if(e.action_seqs){if(!Array.isArray(e.action_seqs))throw TypeError(".proto_edu_v1_web.push_clear_page_graphics.action_seqs: array expected");t.action_seqs=[];for(let r=0;r<e.action_seqs.length;++r)t.action_seqs[r]=e.action_seqs[r]>>>0}if(null!=e.id_name&&(t.id_name=String(e.id_name)),null!=e.nick_name&&(t.nick_name=String(e.nick_name)),null!=e.timestamp&&(K.Long?(t.timestamp=K.Long.fromValue(e.timestamp)).unsigned=!0:"string"==typeof e.timestamp?t.timestamp=parseInt(e.timestamp,10):"number"==typeof e.timestamp?t.timestamp=e.timestamp:"object"==typeof e.timestamp&&(t.timestamp=new K.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0))),e.layers){if(!Array.isArray(e.layers))throw TypeError(".proto_edu_v1_web.push_clear_page_graphics.layers: array expected");t.layers=[];for(let r=0;r<e.layers.length;++r)t.layers[r]=e.layers[r]>>>0}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.pages=[],r.action_seqs=[],r.layers=[]),t.defaults){if(K.Long){let e=new K.Long(0,0,!0);r.mod_id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.mod_id=t.longs===String?"0":0;if(r.id_name="",r.nick_name="",K.Long){let e=new K.Long(0,0,!0);r.timestamp=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else r.timestamp=t.longs===String?"0":0}if(null!=e.mod_id&&e.hasOwnProperty("mod_id")&&("number"==typeof e.mod_id?r.mod_id=t.longs===String?String(e.mod_id):e.mod_id:r.mod_id=t.longs===String?K.Long.prototype.toString.call(e.mod_id):t.longs===Number?new K.LongBits(e.mod_id.low>>>0,e.mod_id.high>>>0).toNumber(!0):e.mod_id),e.pages&&e.pages.length){r.pages=[];for(let t=0;t<e.pages.length;++t)r.pages[t]=e.pages[t]}if(e.action_seqs&&e.action_seqs.length){r.action_seqs=[];for(let t=0;t<e.action_seqs.length;++t)r.action_seqs[t]=e.action_seqs[t]}if(null!=e.id_name&&e.hasOwnProperty("id_name")&&(r.id_name=e.id_name),null!=e.nick_name&&e.hasOwnProperty("nick_name")&&(r.nick_name=e.nick_name),null!=e.timestamp&&e.hasOwnProperty("timestamp")&&("number"==typeof e.timestamp?r.timestamp=t.longs===String?String(e.timestamp):e.timestamp:r.timestamp=t.longs===String?K.Long.prototype.toString.call(e.timestamp):t.longs===Number?new K.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0):e.timestamp),e.layers&&e.layers.length){r.layers=[];for(let t=0;t<e.layers.length;++t)r.layers[t]=e.layers[t]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.push_user_auth=function(){function e(e){if(this.user_auth=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.user_auth=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.push_user_auth;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.user_auth&&o.user_auth.length||(o.user_auth=[]),o.user_auth.push(Q.proto_edu_v1_web.push_user_auth_data.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.push_user_auth)return e;let t=new Q.proto_edu_v1_web.push_user_auth;if(e.user_auth){if(!Array.isArray(e.user_auth))throw TypeError(".proto_edu_v1_web.push_user_auth.user_auth: array expected");t.user_auth=[];for(let r=0;r<e.user_auth.length;++r){if("object"!=typeof e.user_auth[r])throw TypeError(".proto_edu_v1_web.push_user_auth.user_auth: object expected");t.user_auth[r]=Q.proto_edu_v1_web.push_user_auth_data.fromObject(e.user_auth[r])}}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.user_auth=[]),e.user_auth&&e.user_auth.length){r.user_auth=[];for(let o=0;o<e.user_auth.length;++o)r.user_auth[o]=Q.proto_edu_v1_web.push_user_auth_data.toObject(e.user_auth[o],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.push_user_auth_data=function(){function e(e){if(this.module_auth=[],this.graphic_auth=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id_name="",e.prototype.auth_seq=0,e.prototype.module_auth=K.emptyArray,e.prototype.graphic_auth=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.push_user_auth_data;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.id_name=e.string();break;case 2:o.auth_seq=e.uint32();break;case 3:if(o.module_auth&&o.module_auth.length||(o.module_auth=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.module_auth.push(e.uint32())}else o.module_auth.push(e.uint32());break;case 4:if(o.graphic_auth&&o.graphic_auth.length||(o.graphic_auth=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.graphic_auth.push(e.uint32())}else o.graphic_auth.push(e.uint32());break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.push_user_auth_data)return e;let t=new Q.proto_edu_v1_web.push_user_auth_data;if(null!=e.id_name&&(t.id_name=String(e.id_name)),null!=e.auth_seq&&(t.auth_seq=e.auth_seq>>>0),e.module_auth){if(!Array.isArray(e.module_auth))throw TypeError(".proto_edu_v1_web.push_user_auth_data.module_auth: array expected");t.module_auth=[];for(let r=0;r<e.module_auth.length;++r)t.module_auth[r]=e.module_auth[r]>>>0}if(e.graphic_auth){if(!Array.isArray(e.graphic_auth))throw TypeError(".proto_edu_v1_web.push_user_auth_data.graphic_auth: array expected");t.graphic_auth=[];for(let r=0;r<e.graphic_auth.length;++r)t.graphic_auth[r]=e.graphic_auth[r]>>>0}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.module_auth=[],r.graphic_auth=[]),t.defaults&&(r.id_name="",r.auth_seq=0),null!=e.id_name&&e.hasOwnProperty("id_name")&&(r.id_name=e.id_name),null!=e.auth_seq&&e.hasOwnProperty("auth_seq")&&(r.auth_seq=e.auth_seq),e.module_auth&&e.module_auth.length){r.module_auth=[];for(let t=0;t<e.module_auth.length;++t)r.module_auth[t]=e.module_auth[t]}if(e.graphic_auth&&e.graphic_auth.length){r.graphic_auth=[];for(let t=0;t<e.graphic_auth.length;++t)r.graphic_auth[t]=e.graphic_auth[t]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e.push_room_auth=function(){function e(e){if(this.module_auth=[],this.graphic_auth=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.auth_seq=0,e.prototype.module_auth=K.emptyArray,e.prototype.graphic_auth=K.emptyArray,e.decode=function(e,t){e instanceof X||(e=X.create(e));let r=void 0===t?e.len:e.pos+t,o=new Q.proto_edu_v1_web.push_room_auth;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:o.auth_seq=e.uint32();break;case 2:if(o.module_auth&&o.module_auth.length||(o.module_auth=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.module_auth.push(e.uint32())}else o.module_auth.push(e.uint32());break;case 3:if(o.graphic_auth&&o.graphic_auth.length||(o.graphic_auth=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)o.graphic_auth.push(e.uint32())}else o.graphic_auth.push(e.uint32());break;default:e.skipType(7&t)}}return o},e.fromObject=function(e){if(e instanceof Q.proto_edu_v1_web.push_room_auth)return e;let t=new Q.proto_edu_v1_web.push_room_auth;if(null!=e.auth_seq&&(t.auth_seq=e.auth_seq>>>0),e.module_auth){if(!Array.isArray(e.module_auth))throw TypeError(".proto_edu_v1_web.push_room_auth.module_auth: array expected");t.module_auth=[];for(let r=0;r<e.module_auth.length;++r)t.module_auth[r]=e.module_auth[r]>>>0}if(e.graphic_auth){if(!Array.isArray(e.graphic_auth))throw TypeError(".proto_edu_v1_web.push_room_auth.graphic_auth: array expected");t.graphic_auth=[];for(let r=0;r<e.graphic_auth.length;++r)t.graphic_auth[r]=e.graphic_auth[r]>>>0}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.module_auth=[],r.graphic_auth=[]),t.defaults&&(r.auth_seq=0),null!=e.auth_seq&&e.hasOwnProperty("auth_seq")&&(r.auth_seq=e.auth_seq),e.module_auth&&e.module_auth.length){r.module_auth=[];for(let t=0;t<e.module_auth.length;++t)r.module_auth[t]=e.module_auth[t]}if(e.graphic_auth&&e.graphic_auth.length){r.graphic_auth=[];for(let t=0;t<e.graphic_auth.length;++t)r.graphic_auth[t]=e.graphic_auth[t]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Y.util.toJSONOptions)},e}(),e})();var $,ee=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},te=function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},re=function(){function e(){this.proto=Q,this.protocol=new Uint8Array(["0".charCodeAt(0),"1".charCodeAt(0)]),this.cmdReqMap={"/eduv1/sync":"proto_sync","/eduv1/get_room_auth":"proto_get_room_auth_req","/eduv1/get_user_auth":"proto_get_user_auth_req","/eduv1/create_mod":"proto_create_mod","/eduv1/destroy_mod":"proto_destroy_mod","/eduv1/get_mod":"proto_get_mod","/eduv1/get_mod_list":"proto_get_mod_list","/eduv1/modify_mod":"proto_modify_mod","/eduv1/get_page_graphics":"proto_get_page_graphics","/eduv1/clear_page_graphics":"proto_clear_page_graphics","/eduv1/draw_page_graphics":"proto_draw_page_graphics"},this.cmdRspMap={"/eduv1/sync":"proto_sync_rsp","/eduv1/get_room_auth":"proto_get_room_auth_rsp","/eduv1/get_user_auth":"proto_get_user_auth_rsp","/eduv1/create_mod":"proto_create_mod_rsp","/eduv1/destroy_mod":"proto_destroy_mod_rsp","/eduv1/get_mod":"proto_get_mod_rsp","/eduv1/get_mod_list":"proto_get_mod_list_rsp","/eduv1/modify_mod":"proto_modify_mod_rsp","/eduv1/get_page_graphics":"proto_get_page_graphics_rsp","/eduv1/clear_page_graphics":"proto_clear_page_graphics_rsp","/eduv1/draw_page_graphics":"proto_draw_page_graphics_rsp"},this.cmdPushMap={291101:"push_set_mod",291203:"push_draw_page_graphics",291204:"push_clear_page_graphics",291501:"push_user_auth",291502:"push_room_auth"},this.cmdMsg={reqHeader:"proto_req_header",reqBody:"proto_biz_channel",reqBodyBody:"req",rspHeader:"proto_rsp_header",rspBody:"proto_biz_channel_rsp",rspBodyBody:"rsp",pushHeader:"proto_push_header",pushBody:"proto_push_biz_channel",pushBodyBody:"proto_push_biz_hannel_req"}}return e.prototype.encodeMsg=function(e,t,r){return ee(this,void 0,void 0,(function(){var o,i,n,s,a,c,d;return te(this,(function(l){switch(l.label){case 0:return this.formatEduBody(r.body),JSON.stringify(r),[4,this.encode(this.proto.proto_access_pb,this.cmdMsg.reqHeader,t)];case 1:return o=l.sent(),i=o.length,[4,this.encode(this.proto.proto_edu_v1_web,this.cmdReqMap[e],r.body)];case 2:return n=l.sent(),[4,this.encode(this.proto.proto_biz_channel,this.cmdMsg.reqBodyBody,{req_header:r.header,body:n})];case 3:return s=l.sent(),[4,this.encode(this.proto.proto_access_pb,this.cmdMsg.reqBody,{channel:"edu",cmd:e,req_body:s})];case 4:return a=l.sent(),c=a.length,(d=new Uint8Array(8+i+c)).set(this.protocol),d[2]=i>>8,d[3]=i-(d[2]<<8),d.set(new Uint8Array(Int32Array.from([c]).buffer).reverse(),4),d.set(o,8),d.set(a,8+i),[2,d]}}))}))},e.prototype.decodeMsg=function(e){return ee(this,void 0,void 0,(function(){var t,r,o;return te(this,(function(i){switch(i.label){case 0:t=new Uint8Array(e),r=(t[2]<<8)+t[3],i.label=1;case 1:return i.trys.push([1,4,,7]),[4,this.decode(this.proto.proto_access_pb,this.cmdMsg.rspHeader,t.slice(8,8+r))];case 2:return o=i.sent(),[4,this.decodeRspMsg(t.slice(8+r),o.seq)];case 3:return[2,i.sent()];case 4:return i.sent(),[4,this.decode(this.proto.proto_access_pb,this.cmdMsg.pushHeader,t.slice(8,8+r))];case 5:return i.sent(),[4,this.decodePushMsg(t.slice(8+r))];case 6:return[2,i.sent()];case 7:return[2]}}))}))},e.prototype.checkSendLength=function(e,t){return ee(this,void 0,void 0,(function(){var r,o,i,n;return te(this,(function(s){switch(s.label){case 0:return this.formatEduBody(t.body),[4,this.encode(this.proto.proto_edu_v1_web,this.cmdReqMap[e],t.body)];case 1:return r=s.sent(),[4,this.encode(this.proto.proto_biz_channel,this.cmdMsg.reqBodyBody,{req_header:t.header,body:r})];case 2:return o=s.sent(),[4,this.encode(this.proto.proto_access_pb,this.cmdMsg.reqBody,{channel:"edu",cmd:e,req_body:o})];case 3:return i=s.sent(),[2,(n=i.length)>5e3?n:0]}}))}))},e.prototype.createUnknownError=function(e,t){return{cmd:t,header:{seq:e,code:1,message:"unknown error"},body:{}}},e.prototype.formatEduBody=function(e){e.mod_id&&(e.mod_id=F.a.fromString(e.mod_id,!0)),e.draw_pages&&e.draw_pages.forEach((function(e){e.draw_list.forEach((function(e){var t=e.graphic_id;t&&"string"==typeof t&&(e.graphic_id=F.a.fromString(t,!0))}))}))},e.prototype.mergeModList=function(e){e&&e.forEach((function(t,r){e[r]=Object.assign({mod_seq:0,graphic_list_seq:0,sync_interval:0,mod_reserve:1,mod_horizontal_percent:0,mod_vertical_percent:0,mod_extra:"",mod_scale:JSON.stringify({scale:1,ofs_x:0,ofs_y:0})},t)}))},e.prototype.mergePageGraphics=function(e,t){e&&e.forEach((function(r,o){e[o]=r||0,t&&(t[o]=t[o]||0)}))},e.prototype.mergeGraphicList=function(e){e&&e.forEach((function(t,r){e[r]=Object.assign({action_seq:0,zorder:1,x:0,y:0,size:0,color:0,layer:0},t)}))},e.prototype.mergeRspBody=function(e,t){var r=this;switch(t){case"/eduv1/sync":return e=Object.assign({sync_interval:0,room_auth_seq:0,user_auth_seq:0,mod_list_seq:0},e);case"/eduv1/get_room_auth":case"/eduv1/get_user_auth":return e.auth_seq=e.auth_seq||0,e;case"/eduv1/create_mod":return e.mod_seq=e.mod_seq||0,e.mod_list_seq=e.mod_list_seq||0,e;case"/eduv1/destroy_mod":return e.mod_list_seq=e.mod_list_seq||0,e;case"/eduv1/get_mod":return this.mergeModList(e.mod_list),e;case"/eduv1/get_mod_list":return e.mod_list_seq=e.mod_list_seq||0,this.mergeModList(e.mod_list),e;case"/eduv1/modify_mod":return e.mod_seq=e.mod_seq||0,e.mod_list_seq=e.mod_list_seq||0,e;case"/eduv1/get_page_graphics":return e.pages&&e.pages.forEach((function(e){e.page=e.page||0,e.ret_graphic_list_seq=e.ret_graphic_list_seq||0,e.svr_graphic_list_seq=e.svr_graphic_list_seq||0,r.mergeGraphicList(e.graphic_list)})),e;case"/eduv1/clear_page_graphics":case"/eduv1/draw_page_graphics":return this.mergePageGraphics(e.pages,e.graphic_list_seqs),e}},e.prototype.mergePushBody=function(e,t){var r=this;switch(t){case 291101:return e.mod_list_seq=e.mod_list_seq||0,e.action_list&&e.action_list.forEach((function(e){e.is_modify_mod_extra&&(e.mod_extra=e.mod_extra||""),e.is_modify_mod_reserve&&(e.mod_reserve=e.mod_reserve||1),e.is_modify_mod_horizontal_percent&&(e.mod_horizontal_percent=e.mod_horizontal_percent||0),e.is_modify_mod_vertical_percent&&(e.mod_vertical_percent=e.mod_vertical_percent||0),e.is_modify_mod_scale&&(e.mod_scale=e.mod_scale||JSON.stringify({scale:1,ofs_x:0,ofs_y:0}))})),e;case 291203:return e.page_graphics&&e.page_graphics.forEach((function(e){e.page=e.page||0,e.action_seq=e.action_seq||0,r.mergeGraphicList(e.graphic_list)})),e;case 291204:return e.pages&&e.pages.forEach((function(t,r){e.pages[r]=t||0,e.action_seqs&&(e.action_seqs[r]=e.action_seqs[r]||0)})),e;case 291501:case 291502:return e.auth_seq=e.auth_seq||0,e}},e.prototype.encode=function(e,t,r){return ee(this,void 0,void 0,(function(){var o;return te(this,(function(i){return[2,(o=e[t]).encode(o.create(r)).finish()]}))}))},e.prototype.decode=function(e,t,r){return ee(this,void 0,void 0,(function(){var o;return te(this,(function(i){return[2,(o=e[t]).toObject(o.decode(r),{longs:String})]}))}))},e.prototype.decodeRspMsg=function(e,t){return ee(this,void 0,void 0,(function(){var r,o,i,n;return te(this,(function(s){switch(s.label){case 0:return[4,this.decode(this.proto.proto_access_pb,this.cmdMsg.rspBody,e)];case 1:return r=s.sent(),o=r.cmd,r.rsp_body?[4,this.decode(this.proto.proto_biz_channel,this.cmdMsg.rspBodyBody,r.rsp_body)]:[3,9];case 2:if(i=s.sent(),r.rsp_body=i,r.rsp_body.cmd=o,r.rsp_body.header.code||(r.rsp_body.header.code=r.err_code?+String(r.err_code).replace(/^10+/g,""):0),!r.rsp_body.body)return[3,7];s.label=3;case 3:return s.trys.push([3,5,,6]),[4,this.decode(this.proto.proto_edu_v1_web,this.cmdRspMap[o],r.rsp_body.body)];case 4:return n=s.sent(),r.rsp_body.body=this.mergeRspBody(n,o),[3,6];case 5:return s.sent(),[3,6];case 6:return[3,8];case 7:r.rsp_body.body={},s.label=8;case 8:return[3,10];case 9:r.rsp_body=this.createUnknownError(t,o),s.label=10;case 10:return[2,r.rsp_body]}}))}))},e.prototype.decodePushMsg=function(e){return ee(this,void 0,void 0,(function(){var t,r,o,i;return te(this,(function(n){switch(n.label){case 0:return[4,this.decode(this.proto.proto_access_pb,this.cmdMsg.pushBody,e)];case 1:return(t=n.sent()).req_body?[4,this.decode(this.proto.proto_access_pb,this.cmdMsg.pushBodyBody,t.req_body)]:[3,9];case 2:if(r=n.sent(),t.req_body=r,o=this.cmdPushMap[t.req_body.sub_cmd],!t.req_body.msg_body)return[3,7];n.label=3;case 3:return n.trys.push([3,5,,6]),[4,this.decode(this.proto.proto_edu_v1_web,o,t.req_body.msg_body)];case 4:return i=n.sent(),t.req_body.msg_body=this.mergePushBody(i,t.req_body.sub_cmd),[3,6];case 5:return n.sent(),[3,6];case 6:return[3,8];case 7:t.req_body.msg_body={},n.label=8;case 8:return[3,10];case 9:t.req_body={msg_body:{},sub_cmd:0},n.label=10;case 10:return this.cmdPushMap[t.req_body.sub_cmd]||"",[2,t.req_body]}}))}))},e}(),oe=function(){function e(e){this.roomState="DISCONNECTED",this.pbReqCallbackMap={},this.isRegistedEvent=!1,this.timeoutNum=6e3,this.isSendPB=!1,this.timerMap={},this.zegoWebRTC=e,this.webrtcVersion=e.getVersion(),this.init()}return e.prototype.init=function(){this.zegoWebRTC.setDebugVerbose&&this.zegoWebRTC.setDebugVerbose(!1),this.isSendPB=!!this.zegoWebRTC.sendPB&&!!this.zegoWebRTC.setProtoFormat,this.isSendPB&&(this.eduProtobuf=new re,this.zegoWebRTC.setProtoFormat("pb")),this.zegoWebRTC.setSdkLoginRelateService&&this.zegoWebRTC.setSdkLoginRelateService(["edusvr"]),this.bindRoomStateUpdate()},e.prototype.bindRoomStateUpdate=function(){var e=this,t=function(t,r){var o;e.roomState=r,"CONNECTED"===r?(P.a.getInstance().initRoomInfo({roomID:t,logLevel:null===(o=e.zegoWebRTC.logger)||void 0===o?void 0:o.logLevel}),Z.e.emit(Z.c.RoomConnected)):"DISCONNECTED"===r&&Z.e.emit(Z.c.RoomDisConnected)};this.webrtcVersion<"2.0"?this.zegoWebRTC.bindListener("roomStateUpdate",t):this.zegoWebRTC._on("_roomStateUpdate",t)},e.prototype.getSocket=function(){var e;return this.zegoWebRTC.socketCenter||(null===(e=this.zegoWebRTC.modules)||void 0===e?void 0:e.service)},e.prototype.getState=function(){return this.zegoWebRTC.stateCenter},e.prototype.createJsonReqBody=function(e){return{header:{sdk_version:1,id_name:this.getUserID()},body:JSON.stringify(e)}},e.prototype.createPbReqBody=function(e){return{header:{sdk_version:1,id_name:this.getUserID()},body:e}},e.prototype.sendJsonMessage=function(e,t,r){var o=this,i=this.zegoWebRTC.getHeader("biz_channel");(null==i?void 0:i.seq)&&!this.timerMap[i.seq]?this.timerMap[i.seq]=setTimeout((function(){r({header:{code:E.i.ZegoWhiteboardViewErrorNetworkTimeout}})}),this.timeoutNum):r({header:{code:E.i.ZegoWhiteboardViewErrorInternal}}),this.getSocket().sendMessage("biz_channel",{channel:"edu",cmd:e,req_body:JSON.stringify(this.createJsonReqBody(t))},(function(t,i,n){try{var s=void 0;s=o.webrtcVersion<"2.0"?o.rspSuccessHandle(n):o.rspSuccessHandle(t.body.rsp_body),P.a.getInstance().info(["WhiteBoard_Service"],"socket_response","cmd="+e+",body="+JSON.stringify(s)),r(s)}catch(e){}}),(function(t,i,n,s){try{var a=void 0;a=o.webrtcVersion<"2.0"?"[object Object]"===Object.prototype.toString.call(t)?{header:{code:t.code,message:t.msg}}:o.rspErrorHandle(n):o.rspErrorHandle(t.body.rsp_body),P.a.getInstance().info(["WhiteBoard_Service"],"socket_response","cmd="+e+",body="+JSON.stringify(a)),r(a)}catch(e){}}))},e.prototype.sendPbMessage=function(e,t,r){var o=this,i=this.zegoWebRTC.getHeader("biz_channel");(null==i?void 0:i.seq)&&!this.timerMap[i.seq]?this.timerMap[i.seq]=setTimeout((function(){r({header:{code:E.i.ZegoWhiteboardViewErrorNetworkTimeout}})}),this.timeoutNum):r({header:{code:E.i.ZegoWhiteboardViewErrorInternal}}),this.eduProtobuf.encodeMsg(e,i,this.createPbReqBody(t)).then((function(e){!1===o.zegoWebRTC.sendPB(e)?r({header:{code:E.i.ZegoWhiteboardViewErrorNetworkDisconnect}}):o.pbReqCallbackMap[i.seq]=r})).catch((function(e){P.a.getInstance().error(["WhiteBoard_Service"],"socket_req",e)}))},e.prototype.handleJsonResponse=function(e,t){try{var r=JSON.parse(e.body.req_body);r.msg_body=JSON.parse(r.msg_body),P.a.getInstance().info(["WhiteBoard_Service"],"socket_push",JSON.stringify(r)),t(r)}catch(e){}},e.prototype.handlePbResponse=function(e,t){var r=this;this.eduProtobuf.decodeMsg(e).then((function(e){var o,i;if(e.cmd&&e.header){P.a.getInstance().info(["WhiteBoard_Service"],"socket_response","cmd="+e.cmd+",body="+JSON.stringify(e));var n=null===(o=e.header)||void 0===o?void 0:o.seq;r.pbReqCallbackMap[n]&&r.pbReqCallbackMap[n](e),delete r.pbReqCallbackMap[n],(null===(i=r.timerMap)||void 0===i?void 0:i[n])&&(clearTimeout(r.timerMap[n]),r.timerMap[n]=null,delete r.timerMap[n])}else P.a.getInstance().info(["WhiteBoard_Service"],"socket_push",JSON.stringify(e)),t(e)})).catch((function(e){P.a.getInstance().error(["WhiteBoard_Service"],"socket_response",e)}))},e.prototype.rspSuccessHandle=function(e){var t=JSON.parse(e);return t.body=t.body?JSON.parse(t.body):{},t},e.prototype.rspErrorHandle=function(e){var t=JSON.parse(e).header;return{header:{code:t.code,message:t.message}}},e.prototype.loginRoom=function(e,t,r,o){return this.zegoWebRTC.loginRoom(e,t,r,o)},e.prototype.logoutRoom=function(e){Z.e.emit(Z.c.RoomDisConnected),this.zegoWebRTC.logoutRoom(e)},e.prototype.checkSendLength=function(e,t){var r=m.DrawPageGraphics,o=JSON.stringify({body:{channel:"edu",cmd:r,req_body:JSON.stringify(this.createJsonReqBody(e))}}).length;return o>(this.isSendPB?5e4:4800)&&t==E.a.Update||!this.isSendPB&&o>4800?Promise.resolve(o):this.isSendPB?this.eduProtobuf.checkSendLength(r,this.createPbReqBody(e)):Promise.resolve(0)},e.prototype.registerWbMessage=function(e){var t=this;this.isSendPB&&(this.isRegistedEvent&&this.zegoWebRTC.off("_protobufResponse"),this.zegoWebRTC.on("_protobufResponse",(function(r){return t.handlePbResponse(r,e)})),this.isRegistedEvent=!0);var r=this.webrtcVersion<"2.0"?"registerRouter":"on";this.getSocket()[r]("push_biz_channel",(function(r){return t.handleJsonResponse(r,e)}))},e.prototype.queueWSCmdHandler=function(e,t){var r=this,o=new Promise((function(o){P.a.getInstance().info(["WhiteBoard_Service"],"socket_req","cmd="+e+",body="+JSON.stringify(t)),r.isSendPB?r.sendPbMessage(e,t,o):r.sendJsonMessage(e,t,o)})),i=new Promise((function(e){setTimeout((function(){var t=r.zegoWebRTC.getHeader("biz_channel");(null==t?void 0:t.seq)&&r.pbReqCallbackMap[t.seq]&&(delete r.pbReqCallbackMap[t.seq],e({header:{code:E.i.ZegoWhiteboardViewErrorNetworkTimeout}}))}),r.timeoutNum)}));return Promise.race([o,i])},e.prototype.getUserID=function(){return this.getState().idName},e.prototype.getRoomID=function(){return this.getState().roomid},e.prototype.getServerTimeOffset=function(){return this.getState().serverTimeOffset||0},e.prototype.getRoomState=function(){return this.roomState},e}(),ie=function(){function e(e){this.module=e}return e.prototype.actionListener=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];Z.e.emit(e,t)},e.prototype.bindListener=function(e,t){Z.e.on(e,t)},e.prototype.pushRemovedMod=function(e){this.module.pushRemovedMod(e)},e.prototype.pushAddMod=function(e){this.module.pushAddMod(e)},e.prototype.pushModifyMod=function(e){if(e){var t=e.mod_id,r=e.mod_seq,o=e.mod_title,n=e.mod_horizontal_percent,s=e.mod_vertical_percent,a=e.mod_reserve,c=e.mod_extra,d=e.mod_scale,l=e.is_modify_mod_vertical_percent,u=e.is_modify_mod_horizontal_percent,h=e.is_modify_mod_reserve,p=e.is_modify_mod_title,f=e.is_modify_mod_extra,g=e.is_modify_mod_scale;if(this.module.getMap(t))if(this.module.getModSendSwitch(t)){var m={whiteboardID:t,modSeq:r};this.module.updateMap(m),this.updateMapByModifyModOption(e,r,!0)}else{var _={mod_id:t};p&&Object.assign(_,{mod_title:o,is_modify_mod_title:p}),f&&Object.assign(_,{mod_extra:c,is_modify_mod_extra:f}),u&&Object.assign(_,{mod_horizontal_percent:n,is_modify_mod_horizontal_percent:u}),l&&Object.assign(_,{mod_vertical_percent:s,is_modify_mod_vertical_percent:l,mod_reserve:a,is_modify_mod_reserve:h}),h&&Object.assign(_,{mod_reserve:a,is_modify_mod_reserve:h}),g&&Object.assign(_,{mod_scale:d,is_modify_mod_scale:g}),this.module.updateModifyModTaskList({status:i.Pending,data:_,push:!0,pushModSeq:r})}}},e.prototype.updateMapByModifyModOption=function(e,t,r){var o,i=e.mod_id,n=e.mod_title,s=e.mod_horizontal_percent,a=e.mod_vertical_percent,c=e.mod_reserve,d=e.mod_scale,l=e.is_modify_mod_horizontal_percent,u=e.is_modify_mod_vertical_percent,h=e.is_modify_mod_reserve,p=e.is_modify_mod_title,f=e.is_modify_mod_extra,g=e.is_modify_mod_scale,m=this.module.decodeH5Extra(e.mod_extra),_=this.module.getMap(i),v={isPushScroll:!1,horizontalPercent:_.horizontalPercent,verticalPercent:_.verticalPercent,pptStep:_.pptStep};if(l){v.isPushScroll=!0,v.horizontalPercent=+s||0;var E={whiteboardID:i,horizontalPercent:v.horizontalPercent,modPropSeq:{mod_horizontal_percent:t}};this.module.updateMap(E)}if(u){v.isPushScroll=!0,v.verticalPercent=+a||0,v.pptStep=+c;var y={whiteboardID:i,verticalPercent:v.verticalPercent,pptStep:v.pptStep,modPropSeq:{mod_vertical_percent:t}};this.module.updateMap(y)}if(h){v.isPushScroll=!0,v.pptStep=+c;var S={whiteboardID:i,pptStep:v.pptStep,modPropSeq:{mod_reserve:t}};this.module.updateMap(S)}if(v.isPushScroll&&r&&(this.module.pushScrollHandle(i,v.horizontalPercent,v.verticalPercent,v.pptStep),this.module.updateMap({whiteboardID:i,modExtra:""}),o=e),p){var T={whiteboardID:i,name:n,modPropSeq:{mod_title:t}};this.module.updateMap(T)}if(f){var b={whiteboardID:i,modExtra:m,modPropSeq:{mod_extra:t}};if(r){var R=this.module.checkH5Extra(i,m,!0);R&&(this.module.pushExtraHandle(i,R),o=e)}this.module.updateMap(b)}if(g){var C=JSON.parse(d);b={whiteboardID:i,modScale:C,modPropSeq:{mod_scale:t}};r&&this.module.pushScaleHandle(i,C.scale,C.ofs_x,C.ofs_y),this.module.updateMap(b)}return o},e.prototype.parseGraphicsHandle=function(e){var t=this,r=e.page_graphics,o=e.mod_id,i=this.module.checkModInfo(o);if(i){var n=i.width,s={},a=[],c=[];return r.forEach((function(e){var r=e.del_graphic_id_list,o=e.graphic_list,i=e.action_seq,d=e.page;t.transGraphicList(c,o,n),r&&a.push.apply(a,r),s[d]=i})),{whiteboardID:o,graphicList:c=JSON.parse(JSON.stringify(c)),delGraphicIdList:a,graphicListSeqs:s}}},e.prototype.pushDrawPageGraphicsHandle=function(e){var t=e.whiteboardID,r=e.graphicListSeqs,o=e.graphicList,i=e.delGraphicIdList;this.module.updateMapByGraphicListSeqs(t,r),Z.e.emit(Z.c.PushDrawPageGraphics,t,o,i)},e.prototype.transGraphicList=function(e,t,r){var o=this;t&&t.length&&t.forEach((function(t){e.some((function(e){return e.graphic_id===t.graphic_id}))||(t.zorder>o.module.zorderSeq&&(o.module.zorderSeq=t.zorder),L(t,!0),o.module.setGraphicItem(t),A(t,r,!0),t.color=Object(v.s)(t.color,!0),e.push(t))}))},e.prototype.pushClearPageGraphicsHandle=function(e){this.module.pushClearPageGraphicsHandle(e)},e}(),ne=($=function(e,t){return($=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}$(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),se=function(e){function t(t){var r=e.call(this,"web")||this;return r.socket=new oe(t),r.module=new j(r.socket),r.graphic=new B(r.socket,r.module),window.zegoAddonLogger&&P.a.getInstance().updateLoggerHeader({WhiteBoard_VER:"2.1.6"}),r.init(),r.appid=t.stateCenter.appid,r}return ne(t,e),t.prototype.init=function(){var e=this;Z.e.on(Z.c.RoomConnected,(function(){e.isPlayback||e.module.reload()})),Z.e.on(Z.c.RoomDisConnected,(function(){e.isPlayback||e.module.unload()}))},t.prototype.setFileInfo=function(e){this.module.setFileInfo(e)},t.prototype.enablePlayback=function(){this.isPlayback=!0,this.socket.isSendPB=!1,this.execute=new ie(this.module)},t.prototype.loginRoom=function(e,t,r,o){var i={appID:this.appid,userID:r.userID};return Object(P.b)(i,"WhiteBoard",{WhiteBoard_VER:"2.1.6"}),P.a.startTimingUpload(),P.a.getInstance().info(["WhiteBoard"],"API.loginRoom",JSON.stringify({roomID:e,user:r,config:o})),this.socket.loginRoom(e,t,r,o)},t.prototype.logoutRoom=function(e){return P.a.getInstance().info(["WhiteBoard"],"API.logoutRoom",JSON.stringify({roomID:e})),this.socket.logoutRoom(e)},t.prototype.getGraphicIsEndDraw=function(e){return this.graphic.getGraphicIsEndDraw(e)},t.prototype.updateToRemoteHandle=function(e,t,r,o){this.isPlayback?null==r||r():this.graphic.updateToRemoteHandle(e,t,r,o)},t.prototype.getModName=function(e){return this.module.getModName(e)},t.prototype.getCreateTime=function(e){return this.module.getCreateTime(e)},t.prototype.getRoomID=function(e){return this.module.getRoomID(e)},t.prototype.getUniqueID=function(e){return this.module.getUniqueID(e)},t.prototype.getUserID=function(){return this.socket.getUserID()},t.prototype.getPageCount=function(e){return this.module.getPageCount(e)},t.prototype.setSize=function(e,t,r){return this.module.setSize(e,t,r)},t.prototype.setViewSize=function(e,t,r){return this.module.setViewSize(e,t,r)},t.prototype.undo=function(e){},t.prototype.redo=function(e){},t.prototype.createMod=function(e,t){return this.module.createMod(e,t)},t.prototype.clearView=function(e,t){return this.graphic.clearView(e,t)},t.prototype.scroll=function(e,t,r,o,i){this.isPlayback||this.module.scroll(e,t,r,o,i)},t.prototype.scale=function(e,t,r,o){this.isPlayback||this.module.scale(e,t,r,o)},t.prototype.loadCurrentGraphics=function(e,t,r){this.isPlayback||this.module.loadCurrentGraphics(e,t,r)},t.prototype.getScrollPercent=function(e){return this.module.getScrollPercent(e)},t.prototype.getScale=function(e){return this.module.getScale(e)},t.prototype.getAspectRatio=function(e){return this.module.getAspectRatio(e)},t.prototype.getFileInfo=function(e){return this.module.getFileInfo(e)},t.prototype.uploadImage=function(e,t){return this.graphic.uploadImage(e,t)},t.prototype.createZorder=function(){return this.module.createZorder()},t.prototype.destroyMod=function(e){return this.module.destroyMod(e)},t.prototype.getModList=function(){return this.module.getModList()},t.prototype.getH5Extra=function(e){return this.module.getH5Extra(e)},t.prototype.appendH5Extra=function(e,t){this.isPlayback||this.module.appendH5Extra(e,t)},t.prototype.getUserAuth=function(){return this.module.getUserAuth()},t.prototype.enableHandwriting=function(){},t.prototype.isAppendPathLimit=function(e,t){return this.graphic.isAppendPathLimit(e,t)},t.prototype.reloadViewGraphics=function(e,t){this.module.reloadViewGraphics(e,t)},t.prototype.switchView=function(e){return this.module.switchView(e)},t.prototype.getCurrentActivitedView=function(){return this.module.getCurrentActivitedView()},t}((function(e){this.isElectron=!1,this.isPlayback=!1,this.isElectron="electron"===e}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return H}));r(38),r(50),r(72),r(73),r(74),r(32),r(44),r(57),r(75),r(48),r(49),r(323),r(97),r(96),r(248),r(94),r(190),r(341),r(314),r(40),r(240),r(95),r(41),r(70),r(65),r(84),r(221),r(189),r(51),r(52),r(156),r(243);var o=r(3),i=r(4),n=r(9),s=(r(216),r(222),r(188),r(63),r(105),r(129),r(130),r(117),r(174),r(99),r(244),r(6)),a=r(0),c=r(1),d=function(){return(d=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},l=function(){function e(e){var t=this;this.bindFlag=!1,this.authFlag=!0,this.laserInfo={hiddenX:-100,hiddenY:-100,initX:0,initY:0,touchLeaveRect:{left:0,top:0,right:0,bottom:0}},this.mousemoveHandle=function(e){if(t.toolInstance.enableDraw){if(!t.toolInstance.getUserAuth().create)return t.authFlag&&Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthCreateGraphic),void(t.authFlag=!1);if(window.TouchEvent&&e instanceof TouchEvent&&e.preventDefault(),t.laserInfo.touchLeaveRect.right||(t.laserInfo.touchLeaveRect=t.toolInstance.getWhiteboardNodeRect()),t.toolInstance.isTouchLeaveWhenMove(e,t.laserInfo.touchLeaveRect))t.mouseleaveHandle();else{t.toolInstance.updateOffsetAndScrollHandle();var r=t.getMouseChangedPoint(e),o=t.addLaserHandle(void 0,r);o.x=r.clientX,o.y=r.clientY,o.is_end_draw=!0,o.operate_id=Object(s.d)(),t.drawGraphicsHandle(o,!0),t.toolInstance.updateToRemoteNewHandle([t.calLaserActualPlaceHandle(o)],a.a.Move)}}},this.mouseleaveHandle=function(){t.authFlag=!0,t.laserHiddenHandle(),c.a.getInstance().info(["Whiteboard_View"],"Laser.mouseleaveHandle")},this.wheelHandle=function(e){var r;e.preventDefault();var i=t.toolInstance.whiteboardID,n=o.a.reservedPrefix.whiteboard,s=null===(r=document.querySelector("#"+n+i))||void 0===r?void 0:r.parentNode,a=s.getBoundingClientRect(),c=a.width;a.height!==s.scrollHeight&&(s.scrollTop+=Number(e.deltaY.toFixed(7))),c!==s.scrollWidth&&(s.scrollLeft+=Number(e.deltaX.toFixed(7)))},this.toolInstance=e,this.laserContainerNode=this.addLaserConDomHandle(),this.updateZIndexHandle(-1)}return e.prototype.transLocationHandle=function(e){var t=e.clientX,r=e.clientY,o=this.toolInstance,i=o.offsetData,n=o.scrollData,s=i.offsetLeft,a=i.offsetTop,c=n.scrollTop,d=n.scrollLeft,l=this.toolInstance.conNode,u=l.scrollLeft,h=l.scrollTop;return{clientX:Math.round(t-s+d-u),clientY:Math.round(r-a+c-h)}},e.prototype.getMouseChangedPoint=function(e){var t;if(e instanceof MouseEvent){var r=e,o=r.clientX,i=r.clientY;t=this.transLocationHandle({clientX:o,clientY:i})}else{var n=e.changedTouches[0];o=n.clientX,i=n.clientY;t=this.transLocationHandle({clientX:o,clientY:i})}return t},e.prototype.laserHiddenHandle=function(e){var t=this.findLaserHandle(e);if(t){var r=this.laserInfo,o=r.hiddenX,i=r.hiddenY;Object.assign(t,{x:o,y:i,px:0,py:0}),this.toolInstance.moveGraphicsHandle(t.graphic_id,o,i),e||(t.is_end_draw=!0,t.operate_id=Object(s.d)(),this.toolInstance.updateToRemoteNewHandle([t],a.a.Move)),c.a.getInstance().info(["Whiteboard_View"],"Laser.laserHiddenHandle",e)}},e.prototype.addLaserHandle=function(e,t){var r=this.toolInstance.graphicList;if(!e){var i=this.findLaserHandle();if(i)return i;var n=this.laserInfo,c=n.initX,l=n.initY,u=n.hiddenX,h=n.hiddenY;e=d(d({graphic_id:Object(s.d)(),creator_id:this.toolInstance.getUserID()},o.a.basicState),{type:a.f.Laser,x:u,y:h,px:0,py:0,data:[c,l],zorder:this.toolInstance.serviceHandle.createZorder()})}return(e=e).operate_id=Object(s.d)(),e.is_end_draw=!0,r.push(e),this.drawGraphicsHandle(e,!0),this.toolInstance.updateToRemoteNewHandle([this.calLaserActualPlaceHandle(e)],a.a.Create),e},e.prototype.findLaserHandle=function(e){var t=this.toolInstance.getUserID();return this.toolInstance.graphicList.find((function(r){return e?r.graphic_id===e:r.type===a.f.Laser&&r.creator_id===t}))},e.prototype.addLaserConDomHandle=function(){var e=this.toolInstance.whiteboardID,t=""+o.a.reservedPrefix.laserContainer+e,r=this.toolInstance.userNode.querySelector("#"+t);return r||((r=document.createElement("div")).id=t,this.toolInstance.zoomNode.appendChild(r),this.updateLaserConSize(r),r)},e.prototype.updateZIndexHandle=function(e){this.laserContainerNode.style.zIndex=""+e,this.laserContainerNode.style.visibility=-1===e?"hidden":"visible"},e.prototype.drawGraphicsHandle=function(e,t){var r=this.toolInstance.getUserID(),i=e.graphic_id,n=e.data,s=e.creator_id,d=e.x,l=e.y;if(s===r&&!t){t=!0;var u=this.calLaserPlaceHandle(d,l),h=u.x,p=u.y;e.x=h,e.y=p,d=h,l=p}var f=o.a.reservedPrefix,g=""+f.graphics+i,m=""+f.laserCon+i,_=this.toolInstance.userNode.querySelector("#"+g);if(!_){_=document.createElement("div");var v=document.createElement("div");_.id=g,v.id=m,v.appendChild(_),t?this.laserContainerNode.appendChild(v):this.toolInstance.appendGraphicsDomHandle(v,a.f.Laser)}var E="transform:translate("+(d||0)+"px, "+(l||0)+"px)"+(t?";":"scale("+1/this.toolInstance.viewInfo.zoom+");")+"left:"+n[0]+"px;top:"+n[1]+"px;";_.parentNode.style.cssText=E,c.a.getInstance().info(["Whiteboard_View"],"Laser.drawGraphicsHandle",JSON.stringify({protoGraphic:e,local:t,x:d,y:l}))},e.prototype.bindEventsHandle=function(){if(this.updateZIndexHandle("initial"),!this.bindFlag){this.bindFlag=!0;var e=o.a.mouseEvents;this.toolInstance.toolAddEL(this.laserContainerNode,e.move,this.mousemoveHandle),this.toolInstance.toolAddEL(this.laserContainerNode,e.leave,this.mouseleaveHandle),this.toolInstance.viewInfo.isScroll&&this.laserContainerNode.addEventListener("wheel",this.wheelHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1,this.updateZIndexHandle(-1);var e=o.a.mouseEvents;this.toolInstance.toolRmEl(this.laserContainerNode,e.move,this.mousemoveHandle),this.toolInstance.toolRmEl(this.laserContainerNode,e.leave,this.mouseleaveHandle),this.laserContainerNode.removeEventListener("wheel",this.wheelHandle)}},e.prototype.calLaserActualPlaceHandle=function(e){var t=(e=JSON.parse(JSON.stringify(e))).x,r=e.y,o=this.toolInstance.viewInfo,i=o.zoom,n=o.zoomTX,s=o.zoomTY,a=o.offsetPageX,c=o.offsetPageY,d=this.toolInstance.conNode,l=d.scrollLeft,u=d.scrollTop;return e.x=Math.round((t+8+l-n)/i+a),e.y=Math.round((r+8+u-s)/i+c),e},e.prototype.calLaserPlaceHandle=function(e,t){var r=this.toolInstance.viewInfo,o=r.zoom,i=r.zoomTX,n=r.zoomTY,s=r.offsetPageX,a=r.offsetPageY,c=this.toolInstance.conNode,d=c.scrollLeft,l=c.scrollTop;return{x:e=Math.round((e-s)*o+i-d),y:t=Math.round((t-a)*o+n-l)}},e.prototype.pushActualPlaceHandle=function(){var e=this.findLaserHandle();e&&(this.toolInstance.updateOffsetAndScrollHandle(),e.is_end_draw=!0,e.operate_id=Object(s.d)(),c.a.getInstance().info(["Whiteboard_View"],"Laser.pushActualPlaceHandle",JSON.stringify({laserData:[this.calLaserActualPlaceHandle(e)],Action:"Move"})),this.toolInstance.updateToRemoteNewHandle([this.calLaserActualPlaceHandle(e)],a.a.Move))},e.prototype.clearLaserHandle=function(e){var t;(t=e?this.toolInstance.graphicList.filter((function(t){return t.creator_id===e}))[0]:this.findLaserHandle())&&(t.is_end_draw=!0,t.operate_id=Object(s.d)(),this.toolInstance.deleteHandle(t.graphic_id),this.toolInstance.updateToRemoteNewHandle([t],a.a.Delete))},e.prototype.updateLaserConSize=function(e){var t,r="z-index:"+((e=e||this.laserContainerNode).style.zIndex||"initial")+";",i=this.toolInstance.whiteboardID,n=o.a.reservedPrefix.whiteboard,s=null===(t=document.querySelector("#"+n+i))||void 0===t?void 0:t.parentNode;if(this.toolInstance.viewInfo.isScroll){var a=s.getBoundingClientRect(),c=a.width;(d=a.height)!==s.scrollHeight&&(r+="width:"+(c-18)+"px;"),c!==s.scrollWidth&&(r+="height:"+(d-18)+"px;")}else{var d,l=s.getBoundingClientRect();r+="width:"+(c=l.width)+"px;",r+="height:"+(d=l.height)+"px;",r+="top:"+s.style.top+";left:"+s.style.left}e.style.cssText=r},e}(),u=function(){return(u=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},h=function(){function e(e){var t=this;this.bindFlag=!1,this.tolerance=1,this.isIos11=navigator.userAgent.includes("iPhone")&&navigator.userAgent.includes("11_4_1"),this.upSwitch=!1,this.mouseInfo={moveCount:0,moveTaskId:0,touchLeaveRect:{left:0,top:0,right:0,bottom:0},isHandWriting:!1,handWritingTimer:0,handWritingLastPoint:null,handWritingLastSize:null},this.mousedownHandle=function(e){if(t.toolInstance.enableDraw)if(t.toolInstance.getUserAuth().create){if(t.toolInstance.downCommonHandle(e)){t.upSwitch=!0,o.a.svgPath.tops.length=0,o.a.svgPath.bottoms.length=0,t.mouseInfo.isHandWriting=JSON.parse(o.a.basicState.attributes).stroke;var r=t.mouseInfo.isHandWriting&&o.a.basicState.type==a.j.ZegoWhiteboardViewToolPen,i=t.toolInstance.getMouseStartPoint(e,r),c=i.clientX,d=i.clientY,l=t.toolInstance.whiteboardNode;t.mouseInfo.touchLeaveRect=t.toolInstance.getWhiteboardNodeRect();var h=o.a.basicExtraState.customImage.url,p=o.a.basicState.type===a.j.ZegoWhitebaordViewToolCustomImage&&h?a.f.Image:o.a.basicState.type,f=p===a.f.Image?{x:c,y:d,ex:0,ey:0,url:h,hash:""}:[c,d],g=Object(s.d)();t.toolInstance.updateMousePointsHandle(c,d),t.toolInstance.updateProtoGraphic(u(u({creator_id:t.toolInstance.getUserID(),graphic_id:g,operate_id:g,is_end_draw:!1},o.a.basicState),{type:p,x:0,y:0,px:0,py:0,data:f,zorder:t.toolInstance.serviceHandle.createZorder()})),p===a.j.ZegoWhiteboardViewToolPen&&(t.toolInstance.protoGraphic.oldData=[c,d]),t.realTimeStartHandle(),t.mouseInfo.moveCount=0,t.mouseInfo.moveTaskId=0,t.toolInstance.toolAddEL(l,o.a.mouseEvents.move,t.mousemoveHandle)}}else Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthCreateGraphic)},this.mousemoveHandle=function(e){if(!(window.TouchEvent&&e instanceof TouchEvent)||t.toolInstance.downCommonHandle(e))if(t.toolInstance.isTouchLeaveWhenMove(e,t.mouseInfo.touchLeaveRect))t.mouseupHandle();else{var r=t.toolInstance.protoGraphic;t.mouseInfo.isHandWriting?t.drawGraphicsHandWritingHandle(r,e):t.drawGraphicsPathHandle(r,e)}},this.mouseupHandle=function(){t.mouseInfo.handWritingTimer&&(clearTimeout(t.mouseInfo.handWritingTimer),t.mouseInfo.handWritingTimer=0);var e=t.toolInstance,r=e.protoGraphic,i=e.graphicList,c=e.whiteboardNode;if(r&&r.graphic_id&&t.upSwitch){t.toolInstance.toolRmEl(c,o.a.mouseEvents.move,t.mousemoveHandle),t.upSwitch=!1,t.mouseInfo.moveCount=0,t.mouseInfo.moveTaskId=0,t.drawGraphicsExceptionHandle(r);var d=r.graphic_id,l=r.type;if(t.toolInstance.updateBoxHandle(r)){if(l===a.f.Pencil){var h=t.toolInstance.getGraphicsHandle(d);if(!h)return;var p=r.oldData;if(r.data=p.slice(),t.mouseInfo.isHandWriting)t.drawGraphicsPencilSegment(r,a.e.Local);else Object(s.g)(h)[0].setAttribute("d",Object(s.l)(a.f.Pencil,r.data))}else if(l===a.f.Image){var f=(p=r.data).x,g=p.y,m=p.ex,_=p.ey,v=t.toolInstance.getUserAuth().create;if(f===m||g===_||!v){t.toolInstance.deleteHandle(r.graphic_id),t.toolInstance.initDrawHandle();var E=a.i.ZegoWhiteboardViewErrorNoAuthCreateGraphic;return void(!v&&Object(n.a)(E))}t.checkImageRect(p),r.initX=p.x,r.initY=p.y,r.oldData=u({},p)}r.is_end_draw=!0;var y=JSON.parse(JSON.stringify(r)),S=r.data;if(t.mouseInfo.isHandWriting&&4===S.length&&l===a.f.Pencil&&r.is_end_draw)return t.toolInstance.deleteHandle(r.graphic_id),void t.toolInstance.updateToRemoteNewHandle([r],a.a.Delete);if(l===a.f.Pencil&&2===S.length||4===S.length&&S[0]==S[2]&&S[1]==S[3])return t.toolInstance.deleteHandle(r.graphic_id),void t.toolInstance.updateToRemoteNewHandle([r],a.a.Delete);t.toolInstance.setGraphicsDomZorder(y),i.push(y),t.realTimeEndHandle()}else l!==a.f.Image&&(r.is_end_draw=!0,t.realTimeEndHandle());t.toolInstance.initDrawHandle()}},this.toolInstance=e,this.tolerance=this.toolInstance.serviceHandle.isElectron?.3:1}return e.prototype.drawGraphicsExceptionHandle=function(e){var t=e.type,r=e.data;t!==a.f.Image&&r.length<4&&(r[2]=r[0]+1,r[3]=r[1]+1,this.drawGraphicsHandle(e,a.e.Local))},e.prototype.isMouseMoveWithNoKeydown=function(e,t){return t instanceof MouseEvent&&!t.buttons&&(this.toolInstance.toolRmEl(this.toolInstance.whiteboardNode,o.a.mouseEvents.move,this.mousemoveHandle),this.toolInstance.deleteHandle(e),this.toolInstance.initDrawHandle(),!0)},e.prototype.catchMouseMoveException=function(){var e=this;this.mouseInfo.moveTaskId||(this.mouseInfo.moveTaskId=window.setTimeout((function(){if(e.mouseInfo.moveCount<5){var t=e.toolInstance.userNode.querySelector("#zego-whiteboard-input");t||((t=document.createElement("input")).id="zego-whiteboard-input",t.tabIndex=-1,e.toolInstance.userNode.insertBefore(t,e.toolInstance.userNode.firstChild)),t.focus()}}),200)),this.mouseInfo.moveCount++},e.prototype.realTimeStartHandle=function(){var e=this.toolInstance.protoGraphic;e.type!==a.f.Image&&this.toolInstance.updateToRemoteNewHandle([e],a.a.Create)},e.prototype.realTimeDrawHandle=function(){var e=this.toolInstance.protoGraphic;e.type!==a.f.Image&&(e.type===a.f.Pencil?this.mouseInfo.isHandWriting?this.realTimeHandWrittingSend(e):this.readlTimeNormalSend(e):this.toolInstance.updateToRemoteNewHandle([e],a.a.Update))},e.prototype.realTimeEndHandle=function(){var e=this.toolInstance.protoGraphic,t=e.type===a.f.Image?a.a.Create:a.a.Update;this.toolInstance.updateToRemoteNewHandle([e],t)},e.prototype.appendPath=function(e,t){var r,o=this;if(t.length){var i=JSON.parse(JSON.stringify(e));i.data=t,(r=e.oldData).push.apply(r,t),this.toolInstance.serviceHandle.isAppendPathLimit(this.toolInstance.whiteboardID,e).then((function(r){r?(e.oldData.splice(i.oldData.length,t.length),o.mouseupHandle()):o.upSwitch&&o.toolInstance.updateToRemoteNewHandle([i],a.a.Append)}))}},e.prototype.readlTimeNormalSend=function(e){var t=o.a.realTimeState.localDrawCount,r=e.data;if(r.length%t==2){var i=Object(s.p)(r.slice(r.length-t),this.tolerance);this.appendPath(e,i)}},e.prototype.realTimeHandWrittingSend=function(e){var t=e.data,r=t.slice(e.oldData.length,t.length);this.appendPath(e,r)},e.prototype.drawGraphicsHandWritingHandle=function(e,t){var r=this;this.mouseInfo.handWritingTimer||(this.mouseInfo.handWritingTimer=window.setTimeout((function(){r.drawGraphicsPathHandle(e,t),clearTimeout(r.mouseInfo.handWritingTimer),r.mouseInfo.handWritingTimer=0}),o.a.handWritingFactor.step))},e.prototype.drawGraphicsPathHandle=function(e,t){var r=this.mouseInfo.isHandWriting&&e.type==a.f.Pencil,o=this.toolInstance.getMouseChangedPoint(t,r);this.toolInstance.updateGraphicsDataHandle(o);var i=e.type===a.f.Image?a.n.ZegoWhiteboardViewImageCustom:void 0;this.realTimeDrawHandle(),this.drawGraphicsHandle(e,a.e.Local,i)},e.prototype.isHandWriting=function(e,t){return t==a.e.Local?this.mouseInfo.isHandWriting:!!e.attributes&&JSON.parse(e.attributes).stroke},e.prototype.bindEventsHandle=function(){var e=this;if(!this.bindFlag){this.bindFlag=!0;var t=this.toolInstance.whiteboardNode;this.toolInstance.toolAddEL(t,o.a.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolAddEL(t,o.a.mouseEvents.up,(function(){o.a.basicState.type!=a.j.ZegoWhiteboardViewToolSelector&&(o.a.basicState.type==a.j.ZegoWhiteboardViewToolPen?window.setTimeout((function(){e.mouseupHandle()}),20):e.mouseupHandle())})),this.toolInstance.toolAddEL(t,o.a.mouseEvents.leave,this.mouseupHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolRmEl(e,o.a.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolRmEl(e,o.a.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolRmEl(e,o.a.mouseEvents.leave,this.mouseupHandle)}},e.prototype.drawGraphicsHandle=function(e,t,r){switch(e.type){case a.f.Pencil:case a.f.RealTime:this.isHandWriting(e,t)?this.drawGraphicsPencilSegment(e,t):this.drawGraphicsPath(e,t);break;case a.f.Line:this.drawGraphicsLine(e,t);break;case a.f.Ellipse:this.drawGraphicsEllipse(e,t);break;case a.f.Rect:this.drawGraphicsRect(e,t);break;case a.f.Image:r===a.n.ZegoWhiteboardViewImageCustom?this.drawLocalCustomImage(e):this.drawReomteGraphicImage(e)}},e.prototype.updateGraphicsHandle=function(e){switch(e.type){case a.f.Pencil:this.isHandWriting(e,a.e.Remote)?this.drawGraphicsPencilSegment(e,a.e.Remote):this.drawGraphicsPath(e,a.e.Remote);break;case a.f.Line:this.drawGraphicsLine(e,a.e.Remote);break;case a.f.Ellipse:this.drawGraphicsEllipse(e,a.e.Remote);break;case a.f.Rect:this.drawGraphicsRect(e,a.e.Remote);break;case a.f.Image:this.updateGraphicsImage(e)}},e.prototype.drawGraphicsLine=function(e,t,r,i,n,c){void 0===r&&(r="none"),void 0===i&&(i=1),void 0===n&&(n="round"),void 0===c&&(c="round");var d=e.data,l=e.graphic_id,u=e.color,h=e.x,p=e.y,f=Object(s.l)(a.f.Line,d),g=f.x1,m=f.y1,_=f.x2,v=f.y2,E=""+o.a.reservedPrefix.graphicsSvg+l,y=""+o.a.reservedPrefix.graphics+l,S=Object(s.e)(E,y,"line",e.zorder);S[1]&&this.toolInstance.appendGraphicsDomHandle(S[1],a.f.Line),this.toolInstance.triggerAnimateHandle(S[0],t),Object(s.o)(S[0],[{attr:"fill",value:r},{attr:"opacity",value:i},{attr:"stroke",value:u},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:n},{attr:"stroke-linecap",value:c},{attr:"x1",value:g},{attr:"y1",value:m},{attr:"x2",value:_},{attr:"y2",value:v},{attr:"transform",value:"translate("+(h||0)+", "+(p||0)+")"}])},e.prototype.drawGraphicsRect=function(e,t,r,i,n,c){void 0===r&&(r="none"),void 0===i&&(i=1),void 0===n&&(n="round"),void 0===c&&(c="round");var d=e.data,l=e.graphic_id,u=e.color,h=e.x,p=e.y,f=Object(s.l)(a.f.Rect,d),g=f.width,m=f.height,_=f.x,v=f.y,E=""+o.a.reservedPrefix.graphicsSvg+l,y=""+o.a.reservedPrefix.graphics+l,S=Object(s.e)(E,y,"rect",e.zorder);S[1]&&this.toolInstance.appendGraphicsDomHandle(S[1],a.f.Rect),this.toolInstance.triggerAnimateHandle(S[0],t),Object(s.o)(S[0],[{attr:"fill",value:r},{attr:"opacity",value:i},{attr:"stroke",value:u},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:n},{attr:"stroke-linecap",value:c},{attr:"width",value:g},{attr:"height",value:m},{attr:"x",value:_},{attr:"y",value:v},{attr:"transform",value:"translate("+(h||0)+", "+(p||0)+")"}])},e.prototype.drawGraphicsPath=function(e,t,r,i,n){void 0===r&&(r="none"),void 0===i&&(i="round"),void 0===n&&(n="round");var c=t===a.e.Local?e.oldData:e.data;if(c&&c.length){var d=e.color,l=e.graphic_id,u=e.x,h=e.y,p=(e.is_end_draw,Object(s.l)(a.f.Pencil,c)),f=""+o.a.reservedPrefix.graphicsSvg+l,g=""+o.a.reservedPrefix.graphics+l,m=Object(s.e)(f,g,"path",e.zorder);m[1]&&this.toolInstance.appendGraphicsDomHandle(m[1],a.f.Pencil),this.toolInstance.triggerAnimateHandle(m[0],t),Object(s.o)(m[0],[{attr:"fill",value:r},{attr:"d",value:p},{attr:"stroke",value:d},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:i},{attr:"stroke-linecap",value:n},{attr:"transform",value:"translate("+(u||0)+", "+(h||0)+")"}])}},e.prototype.drawGraphicsPencilSegment=function(e,t){var r=e.color,i=e.graphic_id,n=e.x,c=e.y,d=e.is_end_draw,l=this.toolInstance.viewInfo.viewWidth,u=Object(s.m)(e,this.getSize(e,t),l),h=""+o.a.reservedPrefix.graphicsSvg+i,p=""+o.a.reservedPrefix.graphics+i,f=Object(s.e)(h,p,"path",e.zorder);f[1]&&this.toolInstance.appendGraphicsDomHandle(f[1],a.f.Pencil),this.toolInstance.triggerAnimateHandle(f[0],t),(null==u?void 0:u.includes("M"))&&Object(s.o)(f[0],[{attr:"fill",value:r},{attr:"d",value:u},{attr:"stroke-width",value:0},{attr:"transform",value:"translate("+(n||0)+", "+(c||0)+")"}]),d&&(o.a.svgPath.tops.length=0,o.a.svgPath.bottoms.length=0)},e.prototype.drawGraphicsEllipse=function(e,t,r,i,n,c){void 0===r&&(r="none"),void 0===i&&(i=1),void 0===n&&(n="round"),void 0===c&&(c="round");var d=e.color,l=e.data,u=e.graphic_id,h=e.x,p=e.y,f=Object(s.l)(a.f.Ellipse,l),g=f.cx,m=f.cy,_=f.rx,v=f.ry,E=""+o.a.reservedPrefix.graphicsSvg+u,y=""+o.a.reservedPrefix.graphics+u,S=Object(s.e)(E,y,"ellipse",e.zorder);S[1]&&this.toolInstance.appendGraphicsDomHandle(S[1],a.f.Ellipse),this.toolInstance.triggerAnimateHandle(S[0],t),Object(s.o)(S[0],[{attr:"fill",value:r},{attr:"opacity",value:i},{attr:"stroke",value:d},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:n},{attr:"stroke-linecap",value:c},{attr:"cx",value:g},{attr:"cy",value:m},{attr:"rx",value:_},{attr:"ry",value:v},{attr:"transform",value:"translate("+(h||0)+", "+(p||0)+")"}])},e.prototype.drawLocalGraphicImage=function(e,t,r){var i=this;return new Promise((function(c,d){if(!i.toolInstance.getUserAuth().create)return d(Object(n.b)(a.i.ZegoWhiteboardViewErrorNoAuthCreateGraphic));var l=new Image;l.setAttribute("crossOrigin","anonymous"),l.onload=function(){var n=i.toolInstance.graphicList,d=i.getScaleRect(l.width,l.height),h=d.width,p=d.height,f={x:t,y:r,ex:t+h,ey:r+p,url:e,hash:""},g=Object(s.d)(),m=i.toolInstance.serviceHandle.createZorder(),_=""+o.a.reservedPrefix.graphicsSvg+g,v=""+o.a.reservedPrefix.graphics+g,E=Object(s.e)(_,v,"image",m);if(E[1]&&i.toolInstance.appendGraphicsDomHandle(E[1],a.f.Image),Object(s.o)(E[0],[{attr:"width",value:h},{attr:"height",value:p},{attr:"crossorigin",value:"anonymous"},{attr:"href",value:e},{attr:"transform",value:"translate("+t+", "+r+")"}]),i.isIos11&&E[0].setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e),i.toolInstance.updateProtoGraphic(u(u({creator_id:i.toolInstance.getUserID(),graphic_id:g,operate_id:g,is_end_draw:!0},o.a.basicState),{type:a.f.Image,x:0,y:0,px:0,py:0,initX:t,initY:r,data:f,oldData:u({},f),zorder:m})),i.toolInstance.updateOffsetAndScrollHandle(),i.toolInstance.updateBoxHandle(i.toolInstance.protoGraphic)){var y=JSON.parse(JSON.stringify(i.toolInstance.protoGraphic));y.is_end_draw=!0,n.push(y),i.toolInstance.updateToRemoteNewHandle([y],a.a.Create)}i.toolInstance.initDrawHandle(),c(e)},l.onerror=d,l.src=e}))},e.prototype.drawLocalCustomImage=function(e){var t=e.graphic_id,r=o.a.basicExtraState.customImage,i=r.w,n=r.h,c=e.data,d=c.x,l=c.y,u=c.ex,h=c.ey,p=c.url,f=""+o.a.reservedPrefix.graphicsSvg+t,g=""+o.a.reservedPrefix.graphics+t,m=Object(s.e)(f,g,"image",e.zorder);m[1]&&this.toolInstance.appendGraphicsDomHandle(m[1],a.f.Image);var _=Number((Math.abs(u-d)/i).toFixed(7)),v=Number((Math.abs(h-l)/n).toFixed(7));Object(s.o)(m[0],[{attr:"width",value:i},{attr:"height",value:n},{attr:"crossorigin",value:"anonymous"},{attr:"href",value:p},{attr:"transform",value:"translate("+Math.min(d,u)+", "+Math.min(l,h)+") scale("+_+", "+v+")"}]),this.isIos11&&m[0].setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p)},e.prototype.drawReomteGraphicImage=function(e){var t=this,r=e.graphic_id,o=e.zorder,i=e.data;this.checkImageRect(i);var n=i.x,a=i.y,c=i.ex,d=i.ey,l=i.url;this.toolInstance.appendImageDomHandle(r,o);var u=new Image;u.setAttribute("crossOrigin","anonymous"),u.onload=function(){var o=t.toolInstance.getImageDomHandle(r),i=o[0],h=o[1];if(i&&h){var p=t.getScaleRect(u.width,u.height),f=p.width,g=p.height,m=Number(((c-n)/f).toFixed(7)),_=Number(((d-a)/g).toFixed(7));Object(s.o)(i,[{attr:"width",value:f},{attr:"height",value:g},{attr:"crossorigin",value:"anonymous"},{attr:"href",value:l},{attr:"transform",value:"translate("+n+", "+a+") scale("+m+", "+_+")"}]),t.isIos11&&i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);var v=t.toolInstance.getBoxInfoByGraphic(e);if(v){var E=v.x,y=v.y,S=v.width,T=v.height;h.style.cssText+="width:"+S+"px;height:"+T+"px;left:"+E+"px;top:"+y+"px;"}}},u.src=l},e.prototype.updateGraphicsImage=function(e){var t=e.graphic_id,r=e.data;this.checkImageRect(r);var i=r.x,n=r.y,a=r.ex,c=r.ey,d=""+o.a.reservedPrefix.graphicsSvg+t,l=""+o.a.reservedPrefix.graphics+t,u=Object(s.e)(d,l,"image",e.zorder)[0];if(u){var h=+u.getAttribute("width"),p=+u.getAttribute("height"),f=Number(((a-i)/h).toFixed(7)),g=Number(((c-n)/p).toFixed(7));u.setAttribute("transform","translate("+i+", "+n+") scale("+f+", "+g+")")}},e.prototype.checkImageRect=function(e){var t=e.x,r=e.y,o=e.ex,i=e.ey;t>o&&(e.x=o,e.ex=t),r>i&&(e.y=i,e.ey=r)},e.prototype.getScaleRect=function(e,t){var r=this.toolInstance.viewInfo,o=r.viewWidth,i=r.viewHeight;if(e>o||t>i){var n=Math.min(o/e,i/t);e=e*n|0,t=t*n|0}return{width:e,height:t}},e.prototype.getSize=function(e,t){return t===a.e.Local?o.a.basicExtraState.drawSize:Object(s.c)(e.size,e.type,this.toolInstance.viewInfo.viewWidth,!1)},e}(),p=(r(310),r(311),function(){return(p=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}),f=function(){function e(e){var t=this;this.bindFlag=!1,this.canCreate=!0,this.chInput=!1,this.allowTouchEnd=!0,this.mouseupHandle=function(e){e instanceof MouseEvent?t.upEventHandle(e):t.allowTouchEnd&&(t.upEventHandle(e),t.allowTouchEnd=!1)},this.upEventHandle=function(e){if(t.toolInstance.enableDraw)if(t.toolInstance.getUserAuth().create){if(t.toolInstance.downCommonHandle(e))if(t.canCreate){var r=t.toolInstance.getMouseChangedPoint(e),o=r.clientX,i=r.clientY;if(!t.checkAddHandle(o,i))return;t.addTextGraphics("",o,i)}else t.canCreate=!0}else Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthCreateGraphic)},this.toolInstance=e}return e.prototype.updateContentHandle=function(e){var t=o.a.textareaHPadding,r=e.value,i=e.previousSibling,n=Number(i.style.maxWidth.split("px")[0])-2*t,s=i.parentNode,a=document.createElement("span");a.style.cssText="position: absolute; z-index: -100; font-size: inherit; font-family: inherit; visibility: hidden; display: inline-block;line-height: 1;",s.appendChild(a);for(var c="",d=0,l=0,u=r;l<u.length;l++){var h=u[l];if("\n"===h)c+="\n",d=0;else{var p=this.textSizeHandle(a,h).width;(d+=p)>n?(c+="\n"+h,d=p):c+=h}}s.removeChild(a),i.innerHTML=c,e.value=c},e.prototype.addTextareaDomHandle=function(e){var t=e.graphic_id,r=e.data,i=document.createElement("textarea"),n=""+o.a.reservedPrefix.graphics+t;i.setAttribute("id",n),i.setAttribute("tabindex","-1"),i.setAttribute("spellcheck","false"),i.setAttribute("maxlength",""+o.a.maxlength),navigator.userAgent.includes("iPhone")&&navigator.userAgent.includes("11_4_1")&&(i.style.padding="0 "+Math.max(o.a.textareaHPadding-3,0)+"px");var a=Object(s.q)(r).text;return i.value=a,i},e.prototype.addPreDomHandle=function(e){var t=e.size,r=e.data,i=e.type,n=Object(s.q)(r).text,a=document.createElement("pre");a.innerHTML=n;var c=Object(s.c)(t,i,this.toolInstance.viewInfo.viewWidth,!1),d=o.a.textareaHPadding,l=o.a.textareaVPadding;return d*=2,l*=2,a.style.cssText="min-height:"+(c*o.a.lineHeight+l)+"px;min-width:"+(c+d)+"px;",a},e.prototype.addTextareaConDomHandle=function(e){var t=e.size,r=e.color,i=e.data,n=e.graphic_id,a=e.type,c=e.attributes,d=e.zorder,l=JSON.parse(c||o.a.basicState.attributes),u=l.bold,h=l.italic,p=Object(s.c)(t,a,this.toolInstance.viewInfo.viewWidth,!1),f=Object(s.q)(i),g=f.beginX,m=f.beginY,_=document.createElement("div"),v=""+o.a.reservedPrefix.textareaCon+n;return _.setAttribute("id",v),d&&_.setAttribute("data-z",d+""),_.style.cssText="font-size:"+p+"px;font-style:"+(h?"italic":"normal")+";font-weight:"+(u?"bold":"normal")+";left:"+g+"px;top:"+m+"px;color:"+r+";caret-color:"+r+";",_},e.prototype.textSizeHandle=function(e,t){return" "===t&&(t=t.replace(/ /g,"&nbsp")),e.innerHTML=t,{width:e.getBoundingClientRect().width,height:e.getBoundingClientRect().height}},e.prototype.checkValueHandle=function(e){var t=o.a.maxlength;return e.length>t&&(e=e.slice(0,t)),e},e.prototype.initHeightHandle=function(e){var t=e.previousSibling;e.scrollTop=0,e.style.height="initial",t.style.height="initial",t.style.maxHeight="initial"},e.prototype.updateHeightHandle=function(e){var t=o.a.textareaHPadding,r=o.a.lineHeight,i=this.toolInstance.viewInfo.zoom,n=e.previousSibling,s=n.style.height,a=Number(n.style.maxHeight.split("px")[0]),c=(Number(n.style.maxWidth.split("px")[0])+2*t)/i,d=e.parentNode.style.fontSize,l=Number(d.split("px")[0]);e.style.maxWidth=c+"px",e.style.height=l*r+"px";var u=e.scrollHeight+"px";e.scrollHeight*i>a&&(u=s),n.style.height=u,e.style.height=u},e.prototype.inputCallbackHandle=function(e){var t=e.target,r=t.previousSibling,o=this.checkValueHandle(t.value);t.value=o,r.innerHTML=o,this.updateHeightHandle(t),!this.chInput&&this.updateToRemoteHandle(e)},e.prototype.chInputCallbackHandle=function(e){this.chInput=!1,this.updateToRemoteHandle(e)},e.prototype.updateToRemoteHandle=function(e){var t=e.target,r=t.parentNode,i=this.toolInstance.graphicList,n=t.id.split(o.a.reservedPrefix.graphics)[1],d=t.value,l=this.toolInstance.getDataFromGraphicList(n,"data").data,u=Object(s.q)(l),h=u.beginX,p=u.beginY,f=i.findIndex((function(e){return e.graphic_id===n})),g=i[f];g&&("blur"===e.type?(g.is_end_draw=!0,d?(this.updateContentHandle(t),this.toolInstance.updateBoxHandle(g,"blur"),g.data=Object(s.a)(t.value,h,p),c.a.getInstance().info(["Whiteboard_View"],"TextArea.updateToRemoteHandle",JSON.stringify({protoGraphic:[g],type:e.type,Action:"Update"})),this.toolInstance.updateToRemoteNewHandle([g],a.a.Update)):(Object(s.n)(r),Object(s.n)(this.toolInstance.getBoxHandle(n)),i.splice(f,1),c.a.getInstance().info(["Whiteboard_View"],"TextArea.updateToRemoteHandle",JSON.stringify({protoGraphic:[g],type:e.type,Action:"Delete"})),this.toolInstance.updateToRemoteNewHandle([g],a.a.Delete)),this.toolInstance.initDrawHandle()):this.toolInstance.getUserAuth().update||g.creator_id===this.toolInstance.getUserID()?(this.updateContentHandle(t),g.data=Object(s.a)(t.value,h,p),g.is_end_draw=!1,g.data=Object(s.a)(t.value,h,p),c.a.getInstance().info(["Whiteboard_View"],"TextArea.updateToRemoteHandle",JSON.stringify({protoGraphic:[g],type:e.type,Action:"Update"})),this.toolInstance.updateToRemoteNewHandle([g],a.a.Update)):t.blur())},e.prototype.bindTextareaInputEventHandle=function(e){var t=this;e.addEventListener("input",(function(e){t.inputCallbackHandle(e)})),e.addEventListener("compositionstart",(function(e){t.chInput=!0})),e.addEventListener("compositionend",(function(e){t.chInputCallbackHandle(e)})),e.addEventListener("keydown",(function(e){9===e.keyCode&&e.preventDefault()}))},e.prototype.bindTextareaFocusEvent=function(e,t){var r=this,i=t.data,n=Object(s.q)(i),a=n.beginX,c=n.beginY;e.addEventListener("focus",(function(e){var t=e.target;t.parentNode.style.borderColor="red";var i=t.id.split(o.a.reservedPrefix.graphics)[1];r.toolInstance.setDataToGraphicList(i,{oldData:Object(s.a)(t.value,a,c)})}))},e.prototype.bindTextareaBlurEvents=function(e){var t=this;e.addEventListener("blur",(function(e){var r=t.toolInstance.graphicsBoxConNode,i=e.target,n=i.parentNode,s=i.id.split(o.a.reservedPrefix.graphics)[1];t.initHeightHandle(i),t.updatePointerEvents(2,r.querySelector(t.toolInstance.getBoxSelHandle(s))),n.style.borderColor="transparent",t.canCreate=!1,t.updateToRemoteHandle(e),t.allowTouchEnd||(t.allowTouchEnd=!0)}))},e.prototype.updatePointerEvents=function(e,t){var r=this,i=this.toolInstance.graphicsBoxConNode;1===e?(Array.prototype.slice.call(Object(s.g)(i),0).forEach((function(e){var t=r.toolInstance.getGraphicsHandle(e.id.split(o.a.reservedPrefix.graphicsBox)[1]);t&&"DIV"===t.nodeName&&(e.style.pointerEvents="initial")})),i.style.pointerEvents="none",t&&(t.style.pointerEvents="none")):(i.style.pointerEvents="initial",t&&(t.style.pointerEvents="initial"))},e.prototype.checkAddHandle=function(e,t){var r=this.calMaxSizeHandle(e,t),i=r.maxWidth,n=r.maxHeight,c=this.toolInstance.viewInfo.viewWidth,d=o.a.textareaHPadding,l=o.a.basicState,u=o.a.lineHeight,h=o.a.textareaVPadding,p=Object(s.c)(l.fontSize,a.f.Text,c,!1);return 2*d+p+12<i&&2*h+p*u+12<n},e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolAddEL(e,o.a.mouseEvents.up,this.mouseupHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolRmEl(e,o.a.mouseEvents.up,this.mouseupHandle)}},e.prototype.addTextGraphics=function(e,t,r){var i=this.toolInstance,n=i.protoGraphic,d=i.graphicList,l=Object(s.d)();this.toolInstance.updateProtoGraphic(p(p({creator_id:this.toolInstance.getUserID(),graphic_id:l,operate_id:l,is_end_draw:!!e,x:0,y:0,px:0,py:0,zorder:this.toolInstance.serviceHandle.createZorder(),data:Object(s.a)(e,t+"",r+"")},o.a.basicState),{size:o.a.basicState.fontSize}));var u=p({},n);d.push(u),this.drawGraphicsHandle(u,!e),this.toolInstance.setGraphicsDomZorder(u);var h=this.toolInstance.updateBoxHandle(u);!e&&this.updatePointerEvents(1,h),c.a.getInstance().info(["Whiteboard_View"],"TextArea.addTextGraphics",JSON.stringify({text:[u],action:"Create"})),this.toolInstance.updateToRemoteNewHandle([u],a.a.Create)},e.prototype.drawGraphicsHandle=function(e,t){var r=e.x,i=e.y,n=this.addTextareaDomHandle(e),c=this.addPreDomHandle(e),d=this.addTextareaConDomHandle(e);d.appendChild(c),d.appendChild(n),d.style.transform="translate("+(r||0)+"px, "+(i||0)+"px)",this.toolInstance.appendGraphicsDomHandle(d,a.f.Text),this.bindTextareaInputEventHandle(n),this.bindTextareaFocusEvent(n,e);var l=o.a.mouseEvents;Object(s.b)(n,[l.down,l.move,l.up]),t&&(this.initMaxSizeHandle(n),n.focus(),this.updatePointerEvents(1,null)),this.bindTextareaBlurEvents(n)},e.prototype.updateGraphicsHandle=function(e){var t=e.graphic_id,r=e.data,i=e.size,n=e.color,a=e.x,c=e.y,d=e.type,l=e.attributes,u=JSON.parse(l||o.a.basicState.attributes),h=u.bold,p=u.italic,f=Object(s.c)(i,d,this.toolInstance.viewInfo.viewWidth,!1),g=Object(s.q)(r),m=g.beginX,_=g.beginY,v=g.text,E=this.toolInstance.getGraphicsHandle(t);if(E){var y=Object(s.g)(E),S=y[0],T=y[1];T.value=v,E.style.cssText="font-size: "+f+"px;font-style:"+(p?"italic":"normal")+";font-weight:"+(h?"bold":"normal")+";left: "+m+"px;top: "+_+"px;color: "+n+";transform: translate("+a+"px, "+c+"px);caret-color:"+n+";";var b=v.split("\n").length*f*o.a.lineHeight+2*o.a.textareaVPadding;S.innerHTML=v,S.style.height=b+"px",S.style.maxWidth="initial",S.style.maxHeight="initial",T.value=v,T.style.height=b+"px"}},e.prototype.focusHandle=function(e){this.toolInstance.setDataToGraphicList(e,{selected:!1});var t=this.toolInstance.getBoxHandle(e);t&&(t.style.borderColor="transparent"),this.updatePointerEvents(1,t);var r=this.toolInstance.getGraphicsHandle(e);if(r){var o=Object(s.g)(r)[1];this.initMaxSizeHandle(o),r.style.borderColor="red",o.style.height="100%",o.focus();var i=this.toolInstance.graphicList.filter((function(t){return t.graphic_id===e}))[0];i.operate_id=Object(s.d)(),i.is_end_draw=!1,c.a.getInstance().info(["Whiteboard_View"],"TextArea.focusHandle",JSON.stringify({graphic:[i],action:"Update"})),this.toolInstance.updateToRemoteNewHandle([i],a.a.Update)}},e.prototype.backUpdateGraphicsHandle=function(e){var t=e.graphic_id,r=e.data,o=Object(s.q)(r).text,i=this.toolInstance.getGraphicsHandle(t);if(i){var n=Object(s.g)(i),a=n[0];n[1].value=o,a.innerHTML=o;var d=i.getBoundingClientRect(),l=d.width,u=d.height,h=this.toolInstance.getBoxHandle(t);h&&(h.style.cssText+="width:"+l+"px;height:"+u+"px;"),c.a.getInstance().info(["Whiteboard_View"],"TextArea.backUpdateGraphicsHandle",JSON.stringify({graphic_id:t,data:r})),this.toolInstance.setDataToGraphicList(t,{data:r})}},e.prototype.initMaxSizeHandle=function(e){var t=e.getBoundingClientRect(),r=t.left,o=t.top,i=this.toolInstance.transLocationHandle({clientX:r,clientY:o}),n=i.clientX,s=i.clientY,a=this.calMaxSizeHandle(n,s),c=a.maxWidth,d=a.maxHeight,l=e.previousSibling;l.style.maxHeight=d+"px",l.style.maxWidth=c+"px"},e.prototype.calMaxSizeHandle=function(e,t){var r,i=this.toolInstance.viewInfo,n=i.isScroll,s=i.isOriginScroll,a=i.width,c=i.height,d=i.viewWidth,l=i.viewHeight,u=i.zoom,h=i.zoomTX,p=i.zoomTY,f=i.offsetPageX,g=i.offsetPageY,m=0;return n?(r=Math.floor(a-e),m=Math.floor(c-t),s&&(r-=o.a.scrollbarSize,m-=o.a.scrollbarSize)):(r=Math.floor(d-e*u+f*u-h),m=Math.floor(l-t*u+g*u-p)),{maxWidth:r-=2*o.a.boxBorderWidth*u,maxHeight:m-=2*o.a.boxBorderWidth*u}},e}(),g=function(){function e(e){var t=this;this.bindFlag=!1,this.mouseInfo={touchLeaveRect:{left:0,top:0,right:0,bottom:0}},this.boxRectMap={},this.mousedownHandle=function(e){if(t.toolInstance.enableDraw){var r=t.toolInstance,i=r.whiteboardNode,n=r.graphicList;t.mouseInfo.touchLeaveRect=t.toolInstance.getWhiteboardNodeRect(),n.forEach((function(e){if(e.type!==a.f.Laser){var r=t.toolInstance.getBoxHandle(e.graphic_id);r&&(t.boxRectMap[e.graphic_id]=r.getBoundingClientRect())}})),t.mousemoveHandle(e),t.toolInstance.toolAddEL(i,o.a.mouseEvents.move,t.mousemoveHandle)}},this.mousemoveHandle=function(e){if(t.toolInstance.enableDraw){var r=e instanceof MouseEvent?e:e.changedTouches[0],o=r.clientX,i=r.clientY;if(t.toolInstance.isTouchLeaveWhenMove(e,t.mouseInfo.touchLeaveRect))t.mouseupHandle();else{var n=0,s="";t.toolInstance.graphicList.forEach((function(e){var r=t.boxRectMap[e.graphic_id];if(r){var a=r.left,c=r.right,d=r.top,l=r.bottom;if(o>=a&&o<=c&&i>=d&&i<=l){var u=e.zorder||1;(!n||u>n)&&(n=u,s=e.graphic_id)}}})),t.toolInstance.graphicList.forEach((function(e){e.selected=!!s&&(e.graphic_id===s&&t.toolInstance.getGraphicIsEndDraw(e.graphic_id)),t.toolInstance.updateBoxBorder(e)}))}}},this.mouseupHandle=function(){t.boxRectMap={};var e=t.toolInstance.whiteboardNode;t.toolInstance.toolRmEl(e,o.a.mouseEvents.move,t.mousemoveHandle),t.toolInstance.deleteSelectedGraphics(a.c.EraserTool)},this.toolInstance=e}return e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolAddEL(e,o.a.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolAddEL(e,o.a.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolAddEL(e,o.a.mouseEvents.leave,this.mouseupHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolRmEl(e,o.a.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolRmEl(e,o.a.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolRmEl(e,o.a.mouseEvents.leave,this.mouseupHandle)}},e}(),m=(r(317),r(326),function(){function e(e){this.editBoxMap={w:0,h:0,tx:0,ty:0,x:0,y:0,mx:0,my:0,tx1:0,ty1:0,w0:0,h0:0,board:8,wdiff:9,tdiff:4,interrupt:!1,target:null,graphic:null,parent:document.createElement("div"),box:document.createElement("div"),img:document.createElementNS("http://www.w3.org/2000/svg","image")},this.toolInstance=e,this.setEditorBox()}return e.prototype.startEditTarget=function(e,t){this.endEditTarget();var r=e.target,i=r.className;if(i.includes("operation-point-desktop")){var n=this.editBoxMap.graphic;n&&((this.toolInstance.getUserAuth().update||n.creator_id===this.toolInstance.getUserID())&&(n.operate_id=Object(s.d)(),n.is_end_draw=!1,this.toolInstance.updateToRemoteNewHandle([n],a.a.Update)),Object.assign(n.oldData,n.data)),this.editBoxMap.target=r;var c=window.getComputedStyle(this.editBoxMap.parent),d=c.transform.match(/(-?\d+),\s?(-?\d+)\)$/)||[],l=this.toolInstance.getMouseChangedPoint(e),u=l.clientX,h=l.clientY;this.editBoxMap.w=+c.width.replace("px",""),this.editBoxMap.h=+c.height.replace("px",""),this.editBoxMap.tx=+d[1]||0,this.editBoxMap.ty=+d[2]||0,this.editBoxMap.x=u,this.editBoxMap.y=h;var p=i.substr(i.lastIndexOf(" ")+1);"L"==p?this.editBoxMap.mx=u+this.editBoxMap.w:"R"==p?this.editBoxMap.mx=u-this.editBoxMap.w:"T"==p?this.editBoxMap.my=h+this.editBoxMap.h:"B"==p?this.editBoxMap.my=h-this.editBoxMap.h:"LT"==p?(this.editBoxMap.mx=u+this.editBoxMap.w,this.editBoxMap.my=h+this.editBoxMap.h):"RB"==p?(this.editBoxMap.mx=u-this.editBoxMap.w,this.editBoxMap.my=h-this.editBoxMap.h):"LB"==p?(this.editBoxMap.mx=u+this.editBoxMap.w,this.editBoxMap.my=h-this.editBoxMap.h):"RT"==p&&(this.editBoxMap.mx=u-this.editBoxMap.w,this.editBoxMap.my=h+this.editBoxMap.h);var f=this.toolInstance,g=f.whiteboardNode,m=f.conNode;return this.toolInstance.toolAddEL(g,o.a.mouseEvents.move,t),m.style.cursor=i.replace(/.+cursor-(\w+).+/,"$1")+"-resize",!1}return!0},e.prototype.moveEditTarget=function(e){var t=this.editBoxMap,r=t.target,o=t.interrupt;if(!r)return!o;var i=r.className.substr(r.className.lastIndexOf(" ")+1),n=this.toolInstance.getMouseChangedPoint(e),s=n.clientX,a=n.clientY;return this["moveEditTarget"+i](s,a),!1},e.prototype.endEditTarget=function(){var e=this.editBoxMap,t=e.target,r=e.graphic;if(t&&r)if(this.toolInstance.getUserAuth().update||r.creator_id===this.toolInstance.getUserID()){var o=r.data,i=o.x,s=o.y;r.initX=i-r.x,r.initY=s-r.y,r.is_end_draw=!0,this.toolInstance.updateToRemoteNewHandle([r],a.a.Update)}else{Object.assign(r.data,r.oldData),this.initEditBox(r);var c=this.editBoxMap,d=c.w,l=c.h,u=c.tx1,h=c.ty1;this.updateSVGImageAttr(d,l,u,h,!0),Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthUpdateGraphic)}this.editBoxMap.target=null,this.toolInstance.conNode.style.cursor="auto"},e.prototype.setEditorBox=function(){this.editBoxMap.parent=this.toolInstance.whiteboardNode.querySelector(".img-editor-box")},e.prototype.initEditBox=function(e){var t,r=e.graphic_id,o=null===(t=this.toolInstance.getGraphicsHandle(r))||void 0===t?void 0:t.children[0];if(o){var i=this.editBoxMap,n=i.parent,s=i.board,a=i.wdiff,c=i.tdiff,d=e.data,l=d.x,u=d.y,h=d.ex-l+a,p=d.ey-u+a;l-=c,u-=c,l|=0,u|=0,this.editBoxMap.tx1=l,this.editBoxMap.ty1=u,this.editBoxMap.graphic=e,this.editBoxMap.w0=+o.getAttribute("width"),this.editBoxMap.h0=+o.getAttribute("height"),this.editBoxMap.img=o,this.editBoxMap.box=this.toolInstance.getBoxHandle(r),n.style.cssText+="display:block;width:"+h+"px;height:"+p+"px;transform:translate("+l+"px,"+u+"px);",n.children[4].style.cssText+="left:"+(h/2-s)+"px;",n.children[6].style.cssText+="left:"+(h/2-s)+"px;",n.children[5].style.cssText+="top:"+(p/2-s)+"px;",n.children[7].style.cssText+="top:"+(p/2-s)+"px;"}},e.prototype.hideEditBox=function(e){this.editBoxMap.target=null,this.editBoxMap.graphic=null,this.editBoxMap.interrupt=!!e;var t=this.editBoxMap.parent;t&&(t.style.display="none")},e.prototype.hideEditBoxByList=function(e){var t,r=null===(t=this.editBoxMap.graphic)||void 0===t?void 0:t.graphic_id;e.some((function(e){return e.graphic_id===r}))&&this.hideEditBox()},e.prototype.hideEditBoxByIds=function(e){var t,r=null===(t=this.editBoxMap.graphic)||void 0===t?void 0:t.graphic_id;e.some((function(e){return e===r}))&&this.hideEditBox()},e.prototype.moveEditTargetL=function(e,t,r){var o=this.editBoxMap,i=o.x,n=o.mx,s=o.w,a=o.h,c=o.tx,d=o.ty,l=o.parent,u=o.board;if(e<=n){e=i-e;var h=0|(r?e-s:e+s),p=0|(r?c-e+s:c-e);l.style.cssText+="width:"+h+"px;transform:translate("+p+"px,"+d+"px);",l.children[4].style.cssText+="left:"+(h/2-u)+"px;",l.children[6].style.cssText+="left:"+(h/2-u)+"px;",this.editBoxMap.tx1=p,this.editBoxMap.ty1=d,this.updateSVGImageAttr(h,a,p,d)}else this.moveEditTargetR(e,0,!0)},e.prototype.moveEditTargetR=function(e,t,r){var o=this.editBoxMap,i=o.x,n=o.mx,s=o.w,a=o.h,c=o.tx1,d=o.ty1,l=o.parent,u=o.board;e>n?(e=0|(r?e-i-s:e-i+s),l.style.cssText+="width:"+e+"px;",l.children[4].style.cssText+="left:"+(e/2-u)+"px;",l.children[6].style.cssText+="left:"+(e/2-u)+"px;",this.updateSVGImageAttr(e,a,c,d)):this.moveEditTargetL(e,0,!0)},e.prototype.moveEditTargetT=function(e,t,r){var o=this.editBoxMap,i=o.y,n=o.my,s=o.w,a=o.h,c=o.tx,d=o.ty,l=o.parent,u=o.board;if(t<=n){t=i-t;var h=0|(r?t-a:t+a),p=0|(r?d-t+a:d-t);l.style.cssText+="height:"+h+"px;transform:translate("+c+"px,"+p+"px);",l.children[5].style.cssText+="top:"+(h/2-u)+"px;",l.children[7].style.cssText+="top:"+(h/2-u)+"px;",this.editBoxMap.tx1=c,this.editBoxMap.ty1=p,this.updateSVGImageAttr(s,h,c,p)}else this.moveEditTargetB(0,t,!0)},e.prototype.moveEditTargetB=function(e,t,r){var o=this.editBoxMap,i=o.y,n=o.my,s=o.w,a=o.h,c=o.tx1,d=o.ty1,l=o.parent,u=o.board;t>n?(t=0|(r?t-i-a:t-i+a),l.style.cssText+="height:"+t+"px;",l.children[5].style.cssText+="top:"+(t/2-u)+"px;",l.children[7].style.cssText+="top:"+(t/2-u)+"px;",this.updateSVGImageAttr(s,t,c,d)):this.moveEditTargetT(0,t,!0)},e.prototype.moveEditTargetLT=function(e,t,r){var o=this.editBoxMap,i=o.x,n=o.y,s=o.mx,a=o.my,c=o.w,d=o.h,l=o.tx,u=o.ty,h=o.parent,p=o.board;if(e>i-4&&t>n-4||e<i-4&&t<n-4)if(c<=d&&e<=s||d<c&&t<=a){var f=0,g=0,m=0,_=0;if(r?(e=Math.min(i-e-c,n-t-d),d<c?(g=e,f=Math.round(c*g/d),_=u-e,m=Math.round(l-c*e/d)):(f=e,g=Math.round(f*d/c),m=l-e,_=Math.round(u-d*e/c))):(t-=n,e=(e-=i)<0||t<0?Math.max(e,t):Math.min(e,t),d<c?(g=d-e,f=Math.round(c*g/d),_=u+e,m=Math.round(l+c*e/d)):(f=c-e,g=Math.round(f*d/c),m=l+e,_=Math.round(u+d*e/c))),f<0||g<0)return;f|=0,g|=0,m|=0,_|=0,h.style.cssText+="width:"+f+"px;height:"+g+"px;transform:translate("+m+"px,"+_+"px);",h.children[4].style.cssText+="left:"+(f/2-p)+"px;",h.children[6].style.cssText+="left:"+(f/2-p)+"px;",h.children[5].style.cssText+="top:"+(g/2-p)+"px;",h.children[7].style.cssText+="top:"+(g/2-p)+"px;",this.editBoxMap.tx1=m,this.editBoxMap.ty1=_,this.updateSVGImageAttr(f,g,m,_)}else this.moveEditTargetRB(e,t,!0)},e.prototype.moveEditTargetRB=function(e,t,r){var o=this.editBoxMap,i=o.x,n=o.y,s=o.mx,a=o.my,c=o.w,d=o.h,l=o.tx1,u=o.ty1,h=o.parent,p=o.board;if(e>i-4&&t>n-4||e<i-4&&t<n-4)if(c<=d&&e>=s||d<c&&t>=a){e-=i,t-=n;var f=0,g=0;if(r?d<c?(g=Math.min(e,t)-d,f=Math.round(c*g/d)):(f=Math.min(e,t)-c,g=Math.round(f*d/c)):(e=e<0||t<0?Math.max(e,t):Math.min(e,t),d<c?(g=e+d,f=Math.round(c*g/d)):(f=e+c,g=Math.round(f*d/c))),f<0||g<0)return;f|=0,g|=0,h.style.cssText+="width:"+f+"px;height:"+g+"px;",h.children[4].style.cssText+="left:"+(f/2-p)+"px;",h.children[6].style.cssText+="left:"+(f/2-p)+"px;",h.children[5].style.cssText+="top:"+(g/2-p)+"px;",h.children[7].style.cssText+="top:"+(g/2-p)+"px;",this.updateSVGImageAttr(f,g,l,u)}else this.moveEditTargetLT(e,t,!0)},e.prototype.moveEditTargetLB=function(e,t,r){var o=this.editBoxMap,i=o.x,n=o.y,s=o.mx,a=o.my,c=o.w,d=o.h,l=o.tx,u=o.ty,h=o.parent,p=o.board;if(e<i-4&&t>n-4||e>i-4&&t<n-4)if(c<=d&&e<s||d<c&&t>a){var f=0,g=0,m=0,_=u;r?(e=Math.min(i-e-c,t-n-d),e=Math.abs(e),d<c?(g=e,f=Math.round(c*g/d)):(f=e,g=Math.round(f*d/c)),m=l-f,_=u+d):(t-=n,e=(e-=i)<0||t>0?Math.min(-e,t):-Math.min(e,-t),d<c?(g=d+e,m=l+c-(f=Math.round(c*g/d))):(f=c+e,g=Math.round(f*d/c),m=l-e)),f|=0,g|=0,m|=0,_|=0,h.style.cssText+="width:"+f+"px;height:"+g+"px;transform:translate("+m+"px,"+_+"px);",h.children[4].style.cssText+="left:"+(f/2-p)+"px;",h.children[6].style.cssText+="left:"+(f/2-p)+"px;",h.children[5].style.cssText+="top:"+(g/2-p)+"px;",h.children[7].style.cssText+="top:"+(g/2-p)+"px;",this.editBoxMap.tx1=m,this.editBoxMap.ty1=_,this.updateSVGImageAttr(f,g,m,_)}else this.moveEditTargetRT(e,t,!0)},e.prototype.moveEditTargetRT=function(e,t,r){var o=this.editBoxMap,i=o.x,n=o.y,s=o.mx,a=o.my,c=o.w,d=o.h,l=o.tx,u=o.ty,h=o.parent,p=o.board;if(e>i-4&&t<n-4||e<i-4&&t>n-4)if(c<=d&&e>s||d<c&&t<a){var f=0,g=0,m=l,_=0;r?(e=Math.min(e-i-c,n-t-d),e=Math.abs(e),d<c?(g=e,f=Math.round(c*g/d)):(f=e,g=Math.round(f*d/c)),m=l+c,_=u-g):(t-=n,e=(e-=i)<0||t>0?-Math.min(-e,t):Math.min(e,-t),d<c?(g=d+e,f=Math.round(c*g/d),_=u-e):(f=c+e,_=u+d-(g=Math.round(f*d/c)))),f|=0,g|=0,m|=0,_|=0,h.style.cssText+="width:"+f+"px;height:"+g+"px;transform:translate("+m+"px,"+_+"px);",h.children[4].style.cssText+="left:"+(f/2-p)+"px;",h.children[6].style.cssText+="left:"+(f/2-p)+"px;",h.children[5].style.cssText+="top:"+(g/2-p)+"px;",h.children[7].style.cssText+="top:"+(g/2-p)+"px;",this.editBoxMap.tx1=m,this.editBoxMap.ty1=_,this.updateSVGImageAttr(f,g,m,_)}else this.moveEditTargetLB(e,t,!0)},e.prototype.updateSVGImageAttr=function(e,t,r,o,i){var n=this.editBoxMap,s=n.w0,a=n.h0,c=n.wdiff,d=n.tdiff,l=n.img,u=n.box,h=n.graphic;if(l&&u){e|=0,t|=0,r|=0,o|=0,u.style.cssText+="width:"+e+"px;height:"+t+"px;left:"+r+"px;top:"+o+"px;",e-=c,t-=c,r+=d,o+=d;var p=Number((e/s).toFixed(7)),f=Number((t/a).toFixed(7));if(l.setAttribute("transform","translate("+r+", "+o+") scale("+p+", "+f+")"),!i){var g=null==h?void 0:h.data;g.x=r,g.y=o,g.ex=r+e,g.ey=o+t}}},e}()),_=function(){return(_=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},v=function(){function e(e){var t=this;this.bindFlag=!1,this.authFlag=!0,this.noMoveUp=!0,this.isWillMove=!1,this.mouseInfo={moveCount:0,touchLeaveRect:{left:0,top:0,right:0,bottom:0}},this.moveSelectedGraphicIds="",this.userId="",this.selectBoxMap={l:0,t:0,r:0,b:0,box:document.createElement("div")},this.mousedownHandle=function(e){if(t.toolInstance.enableDraw&&t.toolInstance.downCommonHandle(e)&&t.imageTool.startEditTarget(e,t.mousemoveHandle)){t.setGraphicsBox(),t.authFlag=!0,t.imageTool.editBoxMap.interrupt=!1;var r=t.selectBoxMap,i=r.l,d=r.t,l=r.r,u=r.b,h=t.toolInstance.getMouseStartPoint(e),p=h.clientX,f=h.clientY,g=t.toolInstance.getUserAuth(),m=t.toolInstance,v=m.graphicList,E=m.whiteboardNode;t.mouseInfo.touchLeaveRect=t.toolInstance.getWhiteboardNodeRect();var y=t.getCoveredMaxZorderGraphic(e);if(y){var S=y.rect,T=S.left,b=S.top,R=S.right,C=S.bottom,I=t.toolInstance.transLocationHandle({clientX:T,clientY:b}),O=t.toolInstance.transLocationHandle({clientX:R,clientY:C});T=I.clientX,b=I.clientY,R=O.clientX,C=O.clientY;var L=y.graphic,w=L.graphic_id,M=L.selected,A=L.type,N=L.creator_id,k=g.update||N===t.userId;M||(c.a.getInstance().info(["Whiteboard_View"],"Selector.mousedownHandle",JSON.stringify({GraphicType:A,update:!0})),v.forEach((function(e){e.selected=e.graphic_id===w})),A===a.f.Image?k?(t.imageTool.initEditBox(y.graphic),t.hideSelectBox(w)):(t.initSelectBox(T,b,R,C),Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthUpdateGraphic)):(t.hideImageEditBox(),c.a.getInstance().info(["Whiteboard_View"],"Selector.mousedownHandle","鼠标落在图元上"),t.initSelectBox(T,b,R,C))),M&&A===a.f.Text&&1==v.filter((function(e){return e.selected})).length&&(k?(t.noMoveUp=w,setTimeout((function(){return t.hideSelectBox(w)}),50)):Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthUpdateGraphic)),t.isWillMove=!0}else{l>i&&i<=p&&p<=l&&d<=f&&f<=u?(t.isWillMove=!0,c.a.getInstance().info(["Whiteboard_View"],"Selector.mousedownHandle","落在选择框中的空白处，表示将要执行移动操作")):(t.hideSelectBox(),c.a.getInstance().info(["Whiteboard_View"],"Selector.mousedownHandle","落在非选择框中的空白处，清除所有选中"))}t.mouseInfo.moveCount=0,t.moveSelectedGraphicIds="",t.toolInstance.updateMousePointsHandle(p,f),t.isWillMove?v.forEach((function(e){e.selected&&(g.move||e.creator_id===t.userId)&&(e.px=e.x,e.py=e.y,e.is_end_draw=!1,e.operate_id=Object(s.d)())})):(t.toolInstance.updateProtoGraphic(_(_({graphic_id:Object(s.d)()},o.a.basicState),{x:0,y:0,px:0,py:0,data:[p,f]})),t.hideImageEditBox(),t.hideSelectBox()),t.toolInstance.toolAddEL(E,o.a.mouseEvents.move,t.mousemoveHandle)}},this.mousemoveHandle=function(e){if(t.toolInstance.enableDraw){if(e instanceof MouseEvent&&!e.buttons)return t.resetMouse();if(t.imageTool.moveEditTarget(e))if(t.toolInstance.isTouchLeaveWhenMove(e,t.mouseInfo.touchLeaveRect))t.mouseupHandle();else{t.mouseInfo.moveCount++,t.noMoveUp=!1;var r=t.toolInstance.getMouseChangedPoint(e);if(t.isWillMove)t.updateGraphicsOnMoving(r);else{t.toolInstance.updateGraphicsDataHandle(r);var o=t.toolInstance.protoGraphic;t.svgTool.drawGraphicsRect(o,a.e.Local,o.color,.3),t.mouseInfo.moveCount%10==0&&t.updateBoxBorderOnSelector()}}}},this.mouseupHandle=function(){if(!t.toolInstance.enableDraw||!0===t.noMoveUp)return t.imageTool.endEditTarget(),void t.resetMouse();if(t.isWillMove){var e=t.selectBoxMap,r=e.l,o=e.t,i=e.r,n=e.b;if(t.selectBoxMap.l=+t.selectBoxMap.box.style.left.replace("px",""),t.selectBoxMap.t=+t.selectBoxMap.box.style.top.replace("px",""),t.selectBoxMap.r=t.selectBoxMap.l+i-r,t.selectBoxMap.b=t.selectBoxMap.t+n-o,!t.noMoveUp){var s=t.toolInstance.graphicList.filter((function(e){return!!t.moveSelectedGraphicIds.includes(e.graphic_id)&&(e.is_end_draw=!0,!0)}));c.a.getInstance().info(["Whiteboard_View"],"Selector.mouseupHandle",JSON.stringify({list:s,Action:"Move"})),t.toolInstance.updateToRemoteNewHandle(s,a.a.Move)}}else t.setSelectBox(!0);!t.imageTool.editBoxMap.interrupt&&t.noMoveUp&&t.toolInstance.getGraphicIsEndDraw(t.noMoveUp)&&t.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolText).focusHandle(t.noMoveUp);t.resetMouse()},this.toolInstance=e,this.userId=e.getUserID(),this.svgTool=e.getInstanceHandle(a.j.ZegoWhiteboardViewToolLine),this.imageTool=new m(e),this.setGraphicsBox()}return e.prototype.setGraphicsBox=function(){this.selectBoxMap.box=this.toolInstance.whiteboardNode.querySelector(".graphics-box"),this.imageTool.setEditorBox()},e.prototype.initSelectBox=function(e,t,r,o){var i=this;this.selectBoxMap.l=e,this.selectBoxMap.t=t,this.selectBoxMap.r=r,this.selectBoxMap.b=o,r-=e,o-=t,this.toolInstance.graphicList.forEach((function(e){return i.toolInstance.updateBoxBorder(e)}));var n="left:"+e+"px;top:"+t+"px;width:"+r+"px;height:"+o+"px;display:block;";this.setSelectBoxStyle(n),c.a.getInstance().info(["Whiteboard_View"],"Selector.initSelectBox",JSON.stringify({l:e,t:t,r:r,b:o}))},e.prototype.hideSelectBox=function(e){var t=this;this.selectBoxMap.l=0,this.selectBoxMap.t=0,this.selectBoxMap.r=0,this.selectBoxMap.b=0,this.selectBoxMap.box.style.display="none",e?this.toolInstance.graphicList.forEach((function(e){!e.selected||e.type!==a.f.Image&&e.type!==a.f.Text?t.toolInstance.updateBoxBorder(e):t.toolInstance.updateBoxBorder(e,!0)})):this.toolInstance.graphicList.forEach((function(e){e.selected=!1,t.toolInstance.updateBoxBorder(e)}))},e.prototype.setSelectBox=function(e){var t,r=this;if("none"===(null===(t=this.imageTool.editBoxMap.parent)||void 0===t?void 0:t.style.display)){var o=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,n=0,s=0,c=0,d=0;if(this.toolInstance.graphicList.forEach((function(e){if(e.selected){var t=r.toolInstance.getBoxInfoByGraphic(e);if(t){d++,e.type===a.f.Image&&c++;var l=t.x,u=t.y,h=t.width,p=t.height;o=Math.min(o,l),i=Math.min(i,u),n=Math.max(n,l+h),s=Math.max(s,u+p)}}r.toolInstance.updateBoxBorder(e)})),n>0&&s>0){this.selectBoxMap.l=o,this.selectBoxMap.t=i,this.selectBoxMap.r=n,this.selectBoxMap.b=s;var l="left:"+o+"px;top:"+i+"px;width:"+(n-=o)+"px;height:"+(s-=i)+"px;display:block;";if(e&&1==c&&1==d){var u=this.toolInstance.graphicList.find((function(e){return e.selected&&e.type==a.f.Image}));u&&(u.creator_id==this.userId||this.toolInstance.getUserAuth().update)&&(l=l.replace("block","none"),this.toolInstance.updateBoxBorder(u,!0),this.imageTool.initEditBox(u))}this.setSelectBoxStyle(l)}else this.selectBoxMap.l=0,this.selectBoxMap.t=0,this.selectBoxMap.r=0,this.selectBoxMap.b=0,this.selectBoxMap.box.style.display="none"}},e.prototype.setSelectBoxStyle=function(e){this.selectBoxMap.box.style.cssText+=e},e.prototype.resetMouse=function(){var e=this.toolInstance,t=e.protoGraphic,r=e.whiteboardNode;this.toolInstance.toolRmEl(r,o.a.mouseEvents.move,this.mousemoveHandle);var i=this.toolInstance.getGraphicsHandle(t.graphic_id);Object(s.n)(null==i?void 0:i.parentElement),this.toolInstance.initDrawHandle(),this.isWillMove=!1,this.noMoveUp=!0},e.prototype.getCanMovedGraphicList=function(){var e=this,t=0,r=0,o=[],i=!this.moveSelectedGraphicIds,s=this.toolInstance.getUserAuth().move,c=this.toolInstance.graphicList.filter((function(n){if(n.selected){if(t++,!i&&e.moveSelectedGraphicIds.includes(n.graphic_id))return r++,!0;if(i&&(s||n.creator_id===e.userId))return r++,o.push(n.graphic_id),!0}return e.authFlag&&e.toolInstance.updateBoxBorder(n,!0),!1}));return i&&(this.moveSelectedGraphicIds=o.join(",")),t!==r&&(Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthMoveGraphic),this.authFlag=!1),c},e.prototype.updateGraphicsOnMoving=function(e){var t=this,r=e.clientX,o=e.clientY,i=this.getCanMovedGraphicList();if(i.length){this.toolInstance.updateMousePointsHandle(r,o);var n=this.toolInstance.calMoveHandle(),s=n[0],c=n[1],d=this.imageTool.editBoxMap,l=d.tdiff,u=d.parent,h=d.graphic,p=null==h?void 0:h.graphic_id,f=1==i.length&&(i[0].creator_id==this.userId||!!this.toolInstance.getUserAuth().update);i.forEach((function(e){t.toolInstance.updateGraphicsOffsetHandle(e,s,c);var r=e.graphic_id,o=e.type;if(o===a.f.Image){var i=(e.initX||0)+e.x|0,n=(e.initY||0)+e.y|0,d=e.data,h=e.oldData;h.x=d.x,h.y=d.y,h.ex=d.ex,h.ey=d.ey,d.ex=i+d.ex-d.x,d.ey=n+d.ey-d.y,d.x=i,d.y=n,t.toolInstance.moveGraphicsHandle(r,i,n),p===r&&(i-=l,n-=l,t.imageTool.editBoxMap.tx1=i,t.imageTool.editBoxMap.ty1=n,u.style.cssText+="transform:translate("+i+"px,"+n+"px)"),t.toolInstance.updateBoxHandle(e,f)}else o!==a.f.Laser&&(t.toolInstance.moveGraphicsHandle(r,e.x,e.y),t.toolInstance.updateBoxHandle(e))}));var g=this.selectBoxMap,m=g.l,_=g.t,v=this.toolInstance.mousePoints,E="left:"+(m+v.boxX)+"px;top:"+(_+v.boxY)+"px;";this.setSelectBoxStyle(E),this.mouseInfo.moveCount%10==0&&this.toolInstance.updateToRemoteNewHandle(i,a.a.Move)}},e.prototype.updateBoxBorderOnSelector=function(){var e=this,t=this.toolInstance.graphicList,r=this.toolInstance.getGraphicsHandle(this.toolInstance.protoGraphic.graphic_id);if(r){var o=r.getBoundingClientRect(),i=o.left,n=o.right,s=o.top,c=o.bottom;t.forEach((function(t){if(t.type!==a.f.Laser){var r=e.toolInstance.getGraphicsHandle(t.graphic_id);if(r){var o=r.getBoundingClientRect(),d=o.left,l=o.top,u=o.right,h=o.bottom;d===u&&u++,l===h&&h++,t.selected=Math.max(i,d)<Math.min(n,u)&&Math.max(s,l)<Math.min(c,h)&&e.toolInstance.getGraphicIsEndDraw(t.graphic_id)}}})),this.setSelectBox()}},e.prototype.getCoveredMaxZorderGraphic=function(e){var t=this,r=e instanceof MouseEvent?e:e.changedTouches[0],o=r.clientX,i=r.clientY,n=0,s=null,c=null;return this.toolInstance.graphicList.forEach((function(e){if(e.type!==a.f.Laser&&t.toolInstance.getGraphicIsEndDraw(e.graphic_id)){var r=t.toolInstance.getBoxHandle(e.graphic_id);if(r){var d=r.getBoundingClientRect(),l=d.left,u=d.top,h=d.right,p=d.bottom;if(o>=l&&o<=h&&i>=u&&i<=p){var f=e.zorder||1;(!n||f>n)&&(n=f,s=e,c=d)}}}})),s&&c?{graphic:s,rect:c}:null},e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolAddEL(e,o.a.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolAddEL(e,o.a.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolAddEL(e,o.a.mouseEvents.leave,this.mouseupHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolRmEl(e,o.a.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolRmEl(e,o.a.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolRmEl(e,o.a.mouseEvents.leave,this.mouseupHandle)}},e.prototype.hideImageEditBox=function(){this.imageTool.hideEditBox()},e.prototype.hideImageEditBoxByList=function(e){this.imageTool.hideEditBoxByList(e)},e.prototype.hideImageEditBoxByIds=function(e){this.imageTool.hideEditBoxByIds(e)},e.prototype.updateSelectorBoxHandle=function(e,t){if(this.hideImageEditBoxByIds(t),this.hideImageEditBoxByList(e),"none"!=this.selectBoxMap.box.style.display){var r=e.map((function(e){return e.graphic_id}));r.push.apply(r,t),this.toolInstance.graphicList.forEach((function(e){r.includes(e.graphic_id)&&(e.selected=!1)})),this.toolInstance.graphicList.some((function(e){return e.selected}))||this.setSelectBox(!0)}},e}();function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var y=function(){return(y=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},S=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},T=function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},b=function(){function e(e,t){this.isRemote=!1,this.backgroundInfo={image:"",pos:"",mode:0},this.toolInstance=e,this.createContainer(t)}return e.prototype.createContainer=function(e){var t;this.graphicsBgConNode&&(this.graphicsBgConNode.innerHTML="");var r=this.toolInstance,i=r.whiteboardID,n=r.viewInfo,s=o.a.reservedPrefix,c=s.graphicsBgContainer,d=s.graphicsBgImageContainer,l=document.createElement("div");l.id=""+c+i;for(var u=0,h=n.pageCount||1;u<h;u++){var p=document.createElement("div");p.id=d+u+i,l.appendChild(p)}this.graphicsBgConNode=l,this.toolInstance.viewInfo.direction===a.o.Vertical&&(this.graphicsBgConNode.style.flexDirection="column"),null===(t=e.firstChild)||void 0===t||t.before(l)},e.prototype.drawBackgroundImage=function(e,t){var r=this,o="";switch(t){case a.m.ZegoWhiteboardViewImageFitModeLeft:o="left";break;case a.m.ZegoWhiteboardViewImageFitModeRight:o="right";break;case a.m.ZegoWhiteboardViewImageFitModeBottom:o="bottom";break;case a.m.ZegoWhiteboardViewImageFitModeTop:o="top";break;case a.m.ZegoWhiteboardViewImageFitModeCenter:o="center"}var i=new Image;i.setAttribute("crossOrigin","anonymous"),i.onload=function(){for(var i=r.graphicsBgConNode.childNodes,n=0,s=i.length;n<s;n++){var a=i[n];a.style.backgroundImage="url("+e+")",a.style.backgroundPosition=o,a.style.backgroundRepeat="no-repeat",a.style.backgroundSize="contain"}r.backgroundInfo.image=e,r.backgroundInfo.pos=o,r.backgroundInfo.mode=t},i.src=e},e.prototype.clearBackgroundImageLocal=function(){var e=this,t=this.toolInstance.graphicList.filter((function(e){return e.type===a.f.BgImage}));this.backgroundInfo.image="",this.backgroundInfo.pos="",this.backgroundInfo.mode=0,t.map((function(t){e.toolInstance.deleteHandle(t.graphic_id)}));for(var r=this.graphicsBgConNode.childNodes,o=0,i=r.length;o<i;o++){r[o].style.backgroundImage="none"}},e.prototype.backgroundImageUpdateToRemote=function(e,t){if(this.isRemote)this.isRemote=!1;else{var r=t?a.a.Update:a.a.Create;this.toolInstance.updateToRemoteNewHandle([e],r)}},e.prototype.updateToLocal=function(e){return this.isRemote=e,this},e.prototype.setBackgroundColor=function(e){this.graphicsBgConNode.style.backgroundColor=e},e.prototype.setBackgroundImage=function(e,t,r){var o=this;if(!e||t>4){var i=Object(n.b)(a.i.ZegoWhiteboardViewErrorParamInvalid);return Promise.reject(i)}if(!this.toolInstance.enableDraw)return Promise.reject({});if(!this.toolInstance.getUserAuth().create){i=Object(n.b)(a.i.ZegoWhiteboardViewErrorNoAuthCreateGraphic);return Promise.reject(i)}var s=!!this.backgroundInfo.image,d=this.toolInstance.graphicList.find((function(e){return e.type==a.f.BgImage}));if(s&&d&&!this.toolInstance.getUserAuth().update&&d.creator_id!==this.toolInstance.getUserID()){i=Object(n.b)(a.i.ZegoWhiteboardViewErrorNoAuthUpdateGraphic);return Promise.reject(i)}if("string"==typeof e){var l=e;if(!l.startsWith("https://")){i=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicIllegalUrl);return Promise.reject(i)}return new Promise((function(r,i){var s=!0,d=new XMLHttpRequest;d.open("HEAD",l,!0),d.onreadystatechange=function(){if(4==d.readyState){if(200!=d.status){s=!1;var r=404===d.status?a.i.ZegoWhiteboardViewErrorGraphicIllegalUrl:a.i.ZegoWhiteboardViewErrorInvalidRsp;return i(Object(n.b)(r))}var u=(d.getResponseHeader("Content-Type")||"").replace("image/",""),h=+d.getResponseHeader("Content-Length");if(!"jpg,jpeg,png".includes(u)){var p=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return i(p)}if(h>10485760){p=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return i(p)}c.a.getInstance().info(["WhiteBoard_View"],"mod.setBackgroundImage",JSON.stringify({params:{address:e}})),o.addBackgroundImageGraphic(l,t)}},d.onerror=function(){if(s){var e=404===d.status?a.i.ZegoWhiteboardViewErrorGraphicIllegalUrl:a.i.ZegoWhiteboardViewErrorInvalidRsp;i(Object(n.b)(e))}},d.send(null)}))}if(this.toolInstance.serviceHandle.isElectron&&"object"==E(e)){if(!/(\.jpg|\.jpeg|\.png)$/.test((e=e).path)){i=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return Promise.reject(i)}return c.a.getInstance().info(["WhiteBoard_View"],"mod.setBackgroundImage",JSON.stringify({params:{address:e.path}})),this.toolInstance.serviceHandle.uploadImage(e.path,r).then((function(e){return o.addBackgroundImageGraphic(e,t)}))}var u=(e=e).type.replace("image/","");if(!"jpg,jpeg,png".includes(u)){i=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return Promise.reject(i)}if(e.size>10485760){i=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return Promise.reject(i)}return c.a.getInstance().info(["WhiteBoard_View"],"mod.setBackgroundImage",JSON.stringify({params:{address:e.name}})),this.toolInstance.serviceHandle.uploadImage(e,r).then((function(e){return o.addBackgroundImageGraphic(e,t)}))},e.prototype.remoteAddBackgroundImageGraphic=function(e){var t=this.toolInstance.graphicList,r=t.find((function(e){return e.type===a.f.BgImage}));r?(r=Object.assign(r,e),this.toolInstance.setDataToGraphicList(r.graphic_id,{data:r.data})):t.push(e);var o=e.data,i=o.url,n=o.fit_mode;this.drawBackgroundImage(i,n)},e.prototype.addBackgroundImageGraphic=function(e,t){var r=this.toolInstance.graphicList,i={x:0,y:0,ex:0,ey:0,url:e,fit_mode:t,hash:""},n=Object(s.d)(),c=r.find((function(e){return e.type===a.f.BgImage})),d=!!c;if(c){var l=c.data;c=y(y({},c),{data:i,oldData:l,operate_id:Object(s.d)()}),this.toolInstance.setDataToGraphicList(c.graphic_id,{data:i})}else{c=y(y({graphic_id:n,operate_id:n,creator_id:this.toolInstance.getUserID()},o.a.basicState),{type:a.f.BgImage,x:0,y:0,initX:0,initY:0,data:i,oldData:{},zorder:0,layer:1,is_end_draw:!0});var u=JSON.parse(JSON.stringify(c));r.push(u)}return this.drawBackgroundImage(e,t),this.backgroundImageUpdateToRemote(c,d),Promise.resolve(e)},e.prototype.clearBackgroundImage=function(){return S(this,void 0,void 0,(function(){var e;return T(this,(function(t){return this.isRemote?(this.clearBackgroundImageLocal(),this.isRemote=!1,[2]):this.toolInstance.enableDraw?(e=this.toolInstance.graphicList.find((function(e){return e.type==a.f.BgImage})),this.backgroundInfo.image&&e&&!this.toolInstance.getUserAuth().delete&&e.creator_id!==this.toolInstance.getUserID()?(Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthDeleteGraphic),[2]):(e&&(e.operate_id=Object(s.d)(),this.clearBackgroundImageLocal(),this.toolInstance.updateToRemoteNewHandle([e],a.a.Delete)),[2])):[2]}))}))},e}(),R=function(){return(R=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},C=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<r;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,i++)o[i]=n[s];return o},I=function(){function e(e){this.mousePoints={sx:-1,sy:-1,ex:-1,ey:-1,boxX:0,boxY:0},this.graphicList=[],this.enableDraw=!0,this.graphicTaskList=[],this.undoList=[],this.clearUndoData=null,this.redoList=[],this.doTaskSeq=0,this.canDo=!0,this.isReloading=!1,this.graphicExtraMap={},this.instancesMap={};var t=e.whiteboardID,r=e.zoomNode,o=e.conNode,i=e.serviceHandle,n=e.graphicsConNode,s=e.graphicsBoxConNode,a=e.viewInfo,c=e.whiteboardNode;this.whiteboardID=t,this.conNode=o,this.zoomNode=r,this.userNode=r.parentNode,this.graphicsConNode=n,this.whiteboardNode=c,this.graphicsBoxConNode=s,this.serviceHandle=i,this.viewInfo=a,this.updateOffsetAndScrollHandle(),this.initDrawHandle()}return e.prototype.getTranslateXY=function(e){if(!e)return{x:0,y:0};var t=e.match(/translate\((-?\d*.?\d*)px(\,\s*(-?\d*.?\d*)px)?\)/);return{x:+t[1]||0,y:+t[3]||0}},e.prototype.clearRealTimeInterval=function(e){clearInterval(this.graphicExtraMap[e].realTimeId),delete this.graphicExtraMap[e]},e.prototype.realTimeHandle=function(e,t){var r,i,n=this,s=t.graphic_id,d=t.is_end_draw,l=t.operate_id,u=this.graphicList.find((function(e){return e.graphic_id==s&&e.operate_id==l}));if(u){var h=o.a.realTimeState,p=h.remoteDrawDelay,f=h.remoteDrawCount,g=h.remoteDrawEndDelay;d?d&&(null===(i=this.graphicExtraMap[s])||void 0===i?void 0:i.realTimeId)&&(this.clearRealTimeInterval(s),c.a.getInstance().info(["Whiteboard_View"],"gra.remote_draw_realtime_end",s)):this.graphicExtraMap[s]&&this.graphicExtraMap[s].realTimeId?(r=u.data).push.apply(r,t.data):(this.graphicExtraMap[s]=this.graphicExtraMap[s]||{},this.graphicExtraMap[s].realTimeIndex=0,this.graphicExtraMap[s].realTimeId=setInterval((function(t){var r,o=n.graphicList.find((function(e){return e.graphic_id===t}));if(o&&n.graphicExtraMap[t]){var i=o.data,s=n.graphicExtraMap[t].realTimeIndex>=i.length;s?s&&Date.now()-n.graphicExtraMap[t].realTimeLast>g&&(o.is_end_draw=!0,n.clearRealTimeInterval(t),c.a.getInstance().info(["Whiteboard_View"],"gra.remote_draw_realtime_timeout",t)):(n.graphicExtraMap[t].realTimeLast=Date.now(),(o=JSON.parse(JSON.stringify(o))).data=i.slice(0,n.graphicExtraMap[t].realTimeIndex+=f),e.drawGraphicsHandle(o,a.e.Remote))}else!o&&(null===(r=n.graphicExtraMap[t])||void 0===r?void 0:r.realTimeId)&&(n.clearRealTimeInterval(t),c.a.getInstance().info(["Whiteboard_View"],"gra.remote_draw_realtime_deleted",t))}),p,s))}},e.prototype.createHandle=function(e,t,r){var o=e.graphic_id;if(!this.graphicList.some((function(e){return e.graphic_id===o})))switch(this.graphicList.push(e),e.type){case a.f.Text:t.drawGraphicsHandle(e,!1);break;default:r.drawGraphicsHandle(e,a.e.UnReDo)}},e.prototype.moveHandle=function(e,t){var r=e.graphic_id,o=e.x,i=e.y,n=e.type;if(n===a.f.Image)this.assingImageGraphicData(e,a.a.Move),t.updateGraphicsImage(e);else{this.setDataToGraphicList(r,{x:o,y:i});var s=n===a.f.Laser?""+1/this.viewInfo.zoom:void 0;this.moveGraphicsHandle(r,o,i,s)}},e.prototype.updateHandle=function(e,t,r){switch(e.type){case a.f.Text:t.backUpdateGraphicsHandle(e);break;case a.f.Image:this.assingImageGraphicData(e,a.a.Update),r.updateGraphicsImage(e);break;case a.f.BgImage:this.background.remoteAddBackgroundImageGraphic(e)}},e.prototype.assingImageGraphicData=function(e,t){var r=e.graphic_id;this.graphicList.some((function(o){if(o.graphic_id===r){if(Object.assign(o.data,e.data),Object.assign(o.oldData,e.oldData),t===a.a.Move)o.x=e.x,o.y=e.y,o.px=e.px,o.py=e.py;else if(t===a.a.Update){var i=o.data,n=i.x,s=i.y;o.initX=n-o.x,o.initY=s-o.y}return!0}return!1}))},e.prototype.reverseGraphicByMove=function(e){if(e.x=[e.px||0,e.px=e.x][0],e.y=[e.py||0,e.py=e.y][0],e.type===a.f.Image){var t=e.data,r=t.ex-t.x,o=t.ey-t.y;t.x=e.x+(e.initX||0),t.y=e.y+(e.initY||0),t.ex=t.x+r,t.ey=t.y+o}},e.prototype.resetImageGraphicOrigin=function(e){var t=e.data,r=t.x,o=t.y;e.initX=r-e.x,e.initY=o-e.y},e.prototype.createUndoData=function(e){var t=this;if(!e.length)return[];var r=JSON.parse(JSON.stringify(e)),o=r[0],i=o.action,n=o.type,c=o.oldData,d=o.data;if(i===a.a.Create||i===a.a.Append||i===a.a.Update)switch(n){case a.f.Text:var l=Object(s.q)(c).text,u=Object(s.q)(d).text;if(!l&&!u)return[];l?(o.action=u?a.a.Update:a.a.Create,o.data=c,o.oldData=d):o.action=a.a.Delete;break;case a.f.Pencil:case a.f.Line:case a.f.Rect:case a.f.Ellipse:o.action=a.a.Delete;break;case a.f.Image:i===a.a.Create?o.action=a.a.Delete:(o.data=c,o.oldData=d,this.resetImageGraphicOrigin(o));case a.f.BgImage:i===a.a.Create?o.action=a.a.Delete:(o.data=c,o.oldData=d)}else i===a.a.Delete?r.forEach((function(e){e.action=a.a.Create,e.type===a.f.Image&&t.resetImageGraphicOrigin(e)})):i===a.a.Move&&r.forEach((function(e){return t.reverseGraphicByMove(e)}));return r.forEach((function(e){e.operate_id=Object(s.d)(),e.is_end_draw=!0})),r},e.prototype.reverseData=function(e){var t=this;e.length&&e.forEach((function(e){var r=e.action,o=e.data,i=e.oldData;switch(r){case a.a.Create:e.action=a.a.Delete;break;case a.a.Delete:e.action=a.a.Create;break;case a.a.Move:t.reverseGraphicByMove(e);break;case a.a.Update:e.data=i,e.oldData=o}e.operate_id=Object(s.d)(),e.is_end_draw=!0}))},e.prototype.createBackground=function(e,t){this.background||(this.background=new b(this,e)),t&&this.background.createContainer(e)},e.prototype.triggerAnimateHandle=function(e,t){t===a.e.Remote?e.classList.add("transition"):e.classList.remove("transition")},e.prototype.transLocationHandle=function(e,t){var r=e.clientX,o=e.clientY,i=this.offsetData,n=i.offsetLeft,s=i.offsetTop,a=this.scrollData,c=a.scrollLeft,d=a.scrollTop,l=this.viewInfo,u=l.zoom,h=l.zoomTX,p=l.zoomTY,f={clientX:(r-n+c-h)/u+l.offsetPageX,clientY:(o-s+d-p)/u+l.offsetPageY};return t||(f.clientX=Math.round(f.clientX),f.clientY=Math.round(f.clientY)),f},e.prototype.transLocationOrigin=function(e){var t=e.clientX,r=e.clientY,o=this.viewInfo,i=o.offsetPageX,n=o.offsetPageY,s=o.zoom,a=this.whiteboardNode.parentNode,c=a.scrollLeft,d=a.scrollTop;return{clientX:Math.round(t+c/s+i),clientY:Math.round(r+d/s+n)}},e.prototype.bindEventsHandle=function(e){this.initDrawHandle();var t=this.instancesMap[e];t&&t.bindEventsHandle(),c.a.getInstance().info(["WhiteBoard_View"],"Tool.bindEventsHandle",JSON.stringify({type:e}))},e.prototype.removeEventsHandle=function(e){var t=this.instancesMap[e];t&&t.removeEventsHandle()},e.prototype.moveGraphicsHandle=function(e,t,r,o){var i=this.getGraphicsHandle(e);if(i)if("g"===i.tagName){var n=Object(s.g)(i)[0];o=(o=n.getAttribute("transform")||"")&&o.includes("scale(")?o.replace(/.*(scale\(\d+(.\d+)?,(\s*)?\d+(.\d+)?\)).*/," $1"):"",n.setAttribute("transform","translate("+(t||0)+", "+(r||0)+")"+o)}else{var a="translate("+(t||0)+"px, "+(r||0)+"px)",c=i.style.transform.match(/scale\((\d*.?\d*)\)/),d=c?c[1]:"";!o&&d?a=a+" scale("+d+")":o&&(a=a+" scale("+o+")"),i.style.transform=a}},e.prototype.getGraphicsHandle=function(e,t){void 0===t&&(t=this.userNode);var r=t.querySelector("#"+o.a.reservedPrefix.graphics+e);return r&&(r=r.parentNode),r},e.prototype.batchGetGraphicsHandle=function(e,t){return void 0===e&&(e=this.userNode),e.querySelectorAll("[id^="+t+"]")},e.prototype.getBoxSelHandle=function(e){return"#"+o.a.reservedPrefix.graphicsBox+e},e.prototype.updateOffsetAndScrollHandle=function(){this.offsetData=Object(s.h)(this.conNode),this.scrollData=Object(s.i)(this.conNode)},e.prototype.updateGraphicsOffsetHandle=function(e,t,r){var o=e.x,i=e.y;e.x=o+t,e.y=i+r},e.prototype.calMoveHandle=function(){var e=this.mousePoints,t=e.sx,r=e.sy,o=e.ex,i=e.ey;return-1!==t&&-1!==r?(this.mousePoints.boxX+=o-t,this.mousePoints.boxY+=i-r,[o-t,i-r]):[0,0]},e.prototype.updateMousePointsHandle=function(e,t){null==e||null==t?this.mousePoints={sx:-1,sy:-1,ex:-1,ey:-1,boxX:0,boxY:0}:(-1!==this.mousePoints.ex&&-1!==this.mousePoints.ey&&(this.mousePoints.sx=this.mousePoints.ex,this.mousePoints.sy=this.mousePoints.ey),this.mousePoints.ex=e,this.mousePoints.ey=t)},e.prototype.updateToRemoteNewHandle=function(e,t,r,o,i,n){if(void 0===r&&(r=!0),e.length){var c=Object(s.t)(e,t);if((!o||!o.isUndoAndRedo)&&(this.redoList.length=0),r){var d=this.graphicTaskList.length,l={taskStatus:d?a.h.Pending:a.h.InProgress,graphicList:c};!d&&this.graphicTaskList.push(l),this.syncUpdateToRemoteQueue(l)}else this.unSyncUpdateToRemoteQueue(c,o,i,n)}},e.prototype.unSyncUpdateToRemoteQueue=function(e,t,r,o){var n=this;this.serviceHandle.updateToRemoteHandle(this.whiteboardID,e,(function(){if(!t||!t.isUndoAndRedo){var o=n.createUndoData(e);n.undoList.push(o)}r&&r()}),(function(e){i.e.emit(i.b.Error,e),o&&o(e)}))},e.prototype.syncUpdateToRemoteQueue=function(e){var t=this;e.taskStatus===a.h.Pending?-1===this.graphicTaskList.findIndex((function(e){return e.taskStatus===a.h.Pending}))?this.graphicTaskList.push(e):this.mergegGraphicTaskList(e):this.serviceHandle.updateToRemoteHandle(this.whiteboardID,e.graphicList,(function(){t.graphicTaskCallbackHandle(a.g.success)}),(function(e){t.graphicTaskCallbackHandle(a.g.error,e)}))},e.prototype.filterUndoAndRedo=function(e){var t=this;return e.filter((function(e){var r=e.action,o=e.graphic_id,i=t.graphicList.some((function(e){return e.graphic_id===o}));return!i&&r===a.a.Create||i&&(r===a.a.Delete||r===a.a.Move||r===a.a.Update||r===a.a.Append)}))},e.prototype.undoClearPage=function(){this.clearUndoData&&this.updatePushLocalHandle(this.clearUndoData,[])},e.prototype.undoNewHandle=function(){var e=this;if((!this.graphicTaskList[0]||this.graphicTaskList[0].taskStatus!==a.h.InProgress)&&this.canDo){var t=this.undoList.length;if(t){var r=this.filterUndoAndRedo(this.undoList[t-1]);r.length?(this.canDo=!1,this.updateToRemoteNewHandle(r,void 0,!1,{isUndoAndRedo:!0},(function(){e.undoList.pop();var t=JSON.parse(JSON.stringify(r));e.updateLocalHandle(t),e.reverseData(t),e.redoList.push(t),e.canDo=!0}),(function(t){e.canDo=!0}))):this.undoList.pop()}}},e.prototype.redoNewHandle=function(){var e=this;if((!this.graphicTaskList[0]||this.graphicTaskList[0].taskStatus!==a.h.InProgress)&&this.canDo){var t=this.redoList.length;if(t){var r=this.filterUndoAndRedo(this.redoList[t-1]);r.length?(this.canDo=!1,this.updateToRemoteNewHandle(r,void 0,!1,{isUndoAndRedo:!0},(function(){e.redoList.pop();var t=JSON.parse(JSON.stringify(r));e.updateLocalHandle(t),e.reverseData(t),e.undoList.push(t),e.canDo=!0}),(function(t){e.canDo=!0}))):this.redoList.pop()}}},e.prototype.findLastTaskIndex=function(e,t){var r=this.graphicTaskList.slice(1);r.reverse();var o=r.findIndex((function(r){return r.graphicList[0][e]===t}));return-1!==o?r.length-o:-1},e.prototype.mergeMoveActionTaskList=function(e){var t=e.graphicList[0].operate_id,r=this.findLastTaskIndex("operate_id",t);-1===r?this.graphicTaskList.push(e):this.graphicTaskList.splice(r+1,1,e)},e.prototype.mergeOtherActionTaskList=function(e){switch(e.graphicList[0].type){case a.f.Text:this.mergeTextTaskList(e);break;case a.f.Pencil:this.mergePathTaskList(e);break;case a.f.Ellipse:case a.f.Rect:case a.f.Line:case a.f.Image:case a.f.BgImage:this.mergeOtherTaskList(e)}},e.prototype.mergeLaserTaskList=function(e){var t=e.graphicList[0],r=t.action,o=t.graphic_id;if(r===a.a.Move){var i=this.findLastTaskIndex("graphic_id",o);-1===i?this.graphicTaskList.push(e):this.graphicTaskList.splice(i,1,e)}else this.graphicTaskList.push(e)},e.prototype.mergeTextTaskList=function(e){var t=e.graphicList[0].operate_id;this.findLastTaskIndex("operate_id",t);this.graphicTaskList.push(e)},e.prototype.mergePathTaskList=function(e){var t=e.graphicList[0],r=t.operate_id,o=t.action,i=this.findLastTaskIndex("operate_id",r);if(-1===i)this.graphicTaskList.push(e);else{var n=this.graphicTaskList[i];n.graphicList[0].action===a.a.Create||o===a.a.Update?this.graphicTaskList.push(e):n.graphicList.forEach((function(t,r){t.data=t.data.concat(e.graphicList[r].data)}))}},e.prototype.mergeOtherTaskList=function(e){var t=e.graphicList[0].operate_id,r=this.findLastTaskIndex("operate_id",t);-1===r?this.graphicTaskList.push(e):this.graphicTaskList[r].graphicList[0].action===a.a.Create?this.graphicTaskList.push(e):this.graphicTaskList.splice(r,1,e)},e.prototype.mergegGraphicTaskList=function(e){var t=e.graphicList[0],r=t.action;t.type===a.f.Laser?this.mergeLaserTaskList(e):r===a.a.Move?this.mergeMoveActionTaskList(e):this.mergeOtherActionTaskList(e)},e.prototype.graphicTaskCallbackHandle=function(e,t){var r=this.graphicTaskList[0];if(r)if(r.taskStatus===a.h.InProgress){var o=r.graphicList[0],n=o.is_end_draw,s=o.type;o.action;if(n)if(e===a.g.success){if(s!==a.f.Laser&&s!==a.f.BgImage){var c=this.createUndoData(r.graphicList);this.undoList.push(c)}}else{if(s!==a.f.Laser){c=this.createUndoData(r.graphicList);this.updateLocalHandle(c)}i.e.emit(i.b.Error,t)}else e===a.g.error&&i.e.emit(i.b.Error,t);this.graphicTaskList.shift();var d=this.graphicTaskList[0];d&&(d.taskStatus=a.h.InProgress)&&this.syncUpdateToRemoteQueue(d)}else r.taskStatus=a.h.InProgress,this.syncUpdateToRemoteQueue(r)},e.prototype.updateLocalHandle=function(e){var t=this;c.a.getInstance().info(["Whiteboard_View"],"gra.draw_local",JSON.stringify(e)),this.updateOffsetAndScrollHandle();var r=this.getInstanceHandle(a.j.ZegoWhiteboardViewToolText),o=this.getInstanceHandle(a.j.ZegoWhiteboardViewToolLine),i=this.getInstanceHandle(a.j.ZegoWhiteboardViewToolSelector);i.hideImageEditBox(),i.hideSelectBox(),e.forEach((function(e){switch(e.action){case a.a.Delete:t.deleteHandle(e.graphic_id,e.type);break;case a.a.Create:e.type==a.f.BgImage||(t.createHandle(e,r,o),t.updateBoxHandle(e));break;case a.a.Move:t.moveHandle(e,o),t.updateBoxHandle(e);break;case a.a.Update:e.type==a.f.BgImage?t.updateHandle(e,r,o):(t.updateHandle(e,r,o),t.updateBoxHandle(e))}}))},e.prototype.updatePushLocalHandle=function(e,t){var r=this;c.a.getInstance().info(["Whiteboard_View"],"gra.remote_draw",JSON.stringify({graphicList:e,delGraphicList:t,actionMsg:"transValue"})),this.updateOffsetAndScrollHandle(),e.sort((function(e,t){return(e.zorder||0)-(t.zorder||0)})),t.forEach((function(e){return r.deleteHandle(e)}));var i=this.instancesMap[a.j.ZegoWhiteboardViewToolLaser],n=this.instancesMap[a.j.ZegoWhiteboardViewToolText],s=this.instancesMap[a.j.ZegoWhiteboardViewToolLine],d=this.instancesMap[a.j.ZegoWhiteboardViewToolSelector];d&&d.updateSelectorBoxHandle(e,t),e.forEach((function(e){var t=e.graphic_id,d=e.type,l=r.graphicList.some((function(r){return t===r.graphic_id&&(e.type!==a.f.RealTime&&(Object.assign(r,e),d===a.f.Image&&Object.assign(r.data,e.data)),!0)}));l||(d===a.f.Image&&(e.oldData=R({},e.data)),r.graphicList.push(e));var u="#"+o.a.reservedPrefix.graphicsBox+t;switch(l=l&&!!r.whiteboardNode.querySelector(u),d){case a.f.Laser:i.drawGraphicsHandle(e,!1);break;case a.f.Text:l?n.updateGraphicsHandle(e):n.drawGraphicsHandle(e,!1),r.updateBoxHandle(e);break;default:d===a.f.RealTime?r.realTimeHandle(s,e):(l?(d===a.f.Pencil&&e.is_end_draw&&r.graphicExtraMap[t]&&(r.clearRealTimeInterval(t),c.a.getInstance().info(["Whiteboard_View"],"gra.remote_draw_realtime_end",t)),s.updateGraphicsHandle(e)):s.drawGraphicsHandle(e,a.e.Remote),r.updateBoxHandle(e))}}))},e.prototype.deleteHandle=function(e,t){var r;if(t==a.f.BgImage)this.background.updateToLocal(!0).clearBackgroundImage();else{Object(s.n)(this.getBoxHandle(e));var o=this.getGraphicsHandle(e);Object(s.n)("g"===(null==o?void 0:o.tagName)?o.parentNode:o);var i=this.graphicList.findIndex((function(t){return t.graphic_id===e}));if(-1!==i){var n=null===(r=this.graphicExtraMap[e])||void 0===r?void 0:r.realTimeId;n&&clearInterval(n),this.graphicList.splice(i,1)}}},e.prototype.updateBoxHandle=function(e,t){if(e.type===a.f.Laser)return null;var r=this.getBoxInfoByGraphic(e);if(!r)return null;var i=r.x,n=r.y,s=r.width,c=r.height,d=e.type,l=e.graphic_id,u=e.selected,h=e.zorder,p=this.getBoxHandle(l);if(!p){(p=document.createElement("div")).setAttribute("id",""+o.a.reservedPrefix.graphicsBox+l),d===a.f.Text&&(p.style.pointerEvents="initial");var f=null;if(h)for(var g=this.graphicsBoxConNode.querySelectorAll("[data-z]"),m=0;m<g.length;m++)if(+(g[m].getAttribute("data-z")||"")>h){f=g[m];break}this.graphicsBoxConNode.insertBefore(p,f),h&&this.updateGraphicsDomIndex(h)}var _="width:"+s+"px;height:"+c+"px;border:"+(u&&!0!==t?o.a.selectedBorderCss:o.a.unSelectedBorderCss)+";";return"blur"!==t&&(_+="left:"+i+"px;top:"+n+"px;"),p.style.cssText+=_,h&&p.setAttribute("data-z",h+""),p},e.prototype.updateBoxBorder=function(e,t){if(e.type!==a.f.Laser){var r=this.getBoxHandle(e.graphic_id);r&&(r.style.border=e.selected&&!t?o.a.selectedBorderCss:o.a.unSelectedBorderCss)}},e.prototype.updateGraphicsDomIndex=function(e){var t=this,r=Array.from(this.graphicsBoxConNode.querySelectorAll('[data-z="'+e+'"]')).map((function(e){return e.id.replace(/\D/g,"")}));if(r.length>1){var o=Array.from(this.graphicsConNode.querySelectorAll('[data-z="'+e+'"]')),i=o.map((function(e){return e.id.replace(/\D/g,"")}));if(r.join()!==i.join()){var n=o[o.length-1].nextSibling;r.forEach((function(e){t.graphicsConNode.insertBefore(o[i.findIndex((function(t){return t===e}))],n)}))}}},e.prototype.getInstanceHandle=function(e){var t=this.instancesMap[e];if(!t){switch(e){case a.j.ZegoWhiteboardViewToolLaser:t=new l(this);break;case a.j.ZegoWhiteboardViewToolLine:t=new h(this);break;case a.j.ZegoWhiteboardViewToolText:t=new f(this);break;case a.j.ZegoWhiteboardViewToolEraser:t=new g(this);break;case a.j.ZegoWhiteboardViewToolSelector:t=new v(this)}this.instancesMap[e]=t}return t},e.prototype.getUserID=function(){return this.serviceHandle.getUserID()},e.prototype.getUserAuth=function(){return this.serviceHandle.getUserAuth()},e.prototype.getBoxHandle=function(e){var t=this.getBoxSelHandle(e);return this.userNode.querySelector(t)},e.prototype.setGraphicsDomZorder=function(e){var t=e.graphic_id,r=e.type,i=e.zorder,n=o.a.reservedPrefix,s=n.textareaCon,c=n.graphicsSvg,d=n.graphicsBox,l=r===a.f.Text?"#"+s+t:"#"+c+t,u=this.whiteboardNode.querySelector(l);u&&i&&u.setAttribute("data-z",i+""),l="#"+d+t,(u=this.whiteboardNode.querySelector(l))&&i&&u.setAttribute("data-z",i+"")},e.prototype.appendGraphicsDomHandle=function(e,t){if(a.f.Laser===t)this.graphicsConNode.appendChild(e);else{var r=+(e.getAttribute("data-z")||"");if(r)for(var i=this.graphicsConNode.querySelectorAll("[data-z]"),n=0;n<i.length;n++)if(+(i[n].getAttribute("data-z")||"")>r)return void this.graphicsConNode.insertBefore(e,i[n]);var s=this.graphicsConNode.querySelector("[id^="+o.a.reservedPrefix.laserCon+"]");this.graphicsConNode.insertBefore(e,s)}},e.prototype.getImageDomHandle=function(e){var t=o.a.reservedPrefix,r=t.graphics,i=t.graphicsBox;return[this.userNode.querySelector("#"+r+e),this.userNode.querySelector("#"+i+e)]},e.prototype.appendImageDomHandle=function(e,t){var r=o.a.reservedPrefix,i=r.graphicsSvg,n=r.graphics,s=r.laserCon,a=r.graphicsBox,c=document.createElementNS("http://www.w3.org/2000/svg","g"),d=document.createElementNS("http://www.w3.org/2000/svg","image");d.id=""+n+e,c.appendChild(d);var l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.id=""+i+e,l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttribute("version","1.1"),l.appendChild(c);var u=document.createElement("div");if(u.id=""+a+e,t){l.setAttribute("data-z",t+""),u.setAttribute("data-z",t+"");for(var h=this.graphicsConNode.querySelectorAll("[data-z]"),p=0;p<h.length;p++)if(+(h[p].getAttribute("data-z")||"")>t){this.graphicsConNode.insertBefore(l,h[p]);var f=this.graphicsBoxConNode.querySelectorAll("[data-z]")[p];return void this.graphicsBoxConNode.insertBefore(u,f)}}var g=this.graphicsConNode.querySelector("[id ^= "+s+"]");this.graphicsConNode.insertBefore(l,g),this.graphicsBoxConNode.appendChild(u)},e.prototype.resetImageBox=function(){var e=this;this.graphicList.forEach((function(t){if(t.type===a.f.Image){var r=e.getBoxHandle(t.graphic_id),o=t.y+(t.initY||0);r&&Math.abs(Number(r.style.top.replace("px",""))-o)>3&&e.updateBoxHandle(t)}}))},e.prototype.checkMultipointHandle=function(e){return e.touches.length>1},e.prototype.downCommonHandle=function(e){if(window.TouchEvent&&e instanceof TouchEvent){if(this.checkMultipointHandle(e))return!1;"touchstart"!==e.type&&e.preventDefault()}else if(e instanceof MouseEvent&&(e.button||"mouseup"!==e.type&&!e.buttons))return!1;return this.updateOffsetAndScrollHandle(),!0},e.prototype.updateProtoGraphic=function(e){if(e)Object.assign(this.protoGraphic,e);else{var t=o.a.basicState.type;this.protoGraphic=R(R({zorder:0,graphic_id:"",data:[],oldData:"",selected:!1,x:0,y:0,px:0,py:0},o.a.basicState),{type:t,operate_id:"",is_end_draw:!0})}},e.prototype.updateGraphicsDataHandle=function(e){var t=null;switch(this.protoGraphic.type){case a.f.Pencil:(t=this.protoGraphic.data)[t.length-2]===e.clientX&&t[t.length-1]===e.clientY||(t.push(e.clientX),t.push(e.clientY));break;case a.f.Image:(t=this.protoGraphic.data).ex=e.clientX,t.ey=e.clientY;break;default:(t=this.protoGraphic.data).splice(2,2,e.clientX,e.clientY)}},e.prototype.initDrawHandle=function(){this.updateProtoGraphic(),this.updateMousePointsHandle()},e.prototype.getBoxInfoByGraphic=function(e){var t=e.type,r=e.graphic_id,i=this.getGraphicsHandle(r);if(!i)return null;var n=Object(s.j)(e),c=t===a.f.Text||t===a.f.Image?0:e.size||o.a.basicState.size,d=this.viewInfo,l=d.zoom,u=d.offsetPageY,h=d.isScroll,p=o.a.boxBorderWidth,f=i.getBoundingClientRect(),g=f.left,m=f.top,_=f.width,v=f.height;!h&&m>u&&this.isReloading&&(m-=u);var E=this.transLocationHandle({clientX:g,clientY:m},n),y=E.clientX,S=E.clientY;return{x:g=Math.floor(y-p-c/2),y:m=Math.floor(S-p-c/2),width:_=Math.ceil(_/l+c+p),height:v=Math.ceil(v/l+c+p)}},e.prototype.getMouseStartPoint=function(e,t){var r;if(e instanceof MouseEvent){var o=e,i=o.clientX,n=o.clientY;r=this.transLocationHandle({clientX:i,clientY:n},t)}else{var s=e.touches[0];i=s.clientX,n=s.clientY;r=this.transLocationHandle({clientX:i,clientY:n},t)}return r},e.prototype.getMouseChangedPoint=function(e,t){var r;if(e instanceof MouseEvent){var o=e,i=o.clientX,n=o.clientY;r=this.transLocationHandle({clientX:i,clientY:n},t)}else{var s=e.changedTouches[0];i=s.clientX,n=s.clientY;r=this.transLocationHandle({clientX:i,clientY:n},t)}return r},e.prototype.getWhiteboardNodeRect=function(){var e=this.offsetData,t=e.offsetLeft,r=e.offsetTop,o=this.viewInfo,i=o.zoom,n=o.viewWidth,s=o.viewHeight;return i>1?{left:t,top:r,right:t+n,bottom:r+s}:this.whiteboardNode.getBoundingClientRect()},e.prototype.isTouchLeaveWhenMove=function(e,t){if(o.a.isTouch&&window.TouchEvent&&e instanceof TouchEvent){var r=e.changedTouches[0],i=r.clientX,n=r.clientY,s=t.left,a=t.right,c=t.top,d=t.bottom;return i<=s||i>=a||n<=c||n>=d}return!1},e.prototype.setDataToGraphicList=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o=0,i=this.graphicList.length;o<i;o++){var n=this.graphicList[o];if(e===n.graphic_id){Object.assign.apply(Object,C([n],t));break}}},e.prototype.getDataFromGraphicList=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o={},i=function(r,i){var s=n.graphicList[r];if(e===s.graphic_id)return t.forEach((function(e){o[e]=s[e]})),"break"},n=this,s=0,a=this.graphicList.length;s<a;s++){var c=i(s,a);if("break"===c)break}return o},e.prototype.filterExistingHandle=function(e){var t=this;return e.filter((function(e){var r=e.graphic_id;return e.action===a.a.Create||t.graphicList.some((function(e){return e.graphic_id===r}))}))},e.prototype.clearLocalHandle=function(){this.graphicTaskList.length=0;var e=o.a.basicState.type;if(e!==a.j.ZegoWhiteboardViewToolClick&&!e){var t=this.getInstanceHandle(e===a.j.ZegoWhiteboardViewToolPen||e===a.j.ZegoWhiteboardViewToolRect||e===a.j.ZegoWhiteboardViewToolEllipse||e===a.j.ZegoWhitebaordViewToolCustomImage?a.j.ZegoWhiteboardViewToolLine:e);t.removeEventsHandle(),t.bindEventsHandle()}this.clearUndoData=JSON.parse(JSON.stringify(this.graphicList)),this.undoList.length=0,this.redoList.length=0;var r=this.getInstanceHandle(a.j.ZegoWhiteboardViewToolLaser),i=r.findLaserHandle(),n=this.graphicList.find((function(e){return e.type===a.f.BgImage}));this.graphicList.length=0,n&&this.graphicList.push(n),this.graphicsConNode.innerHTML="",i&&r.addLaserHandle(i)},e.prototype.reverseZoomHandle=function(e){var t=this;if(e===a.j.ZegoWhiteboardViewToolLaser){var r=this.viewInfo.zoom;this.batchGetGraphicsHandle(this.graphicsConNode,o.a.reservedPrefix.laserCon).forEach((function(e){var o=e.style.transform,i=t.getTranslateXY(o),n=i.x,s=i.y;e.style.transform="translate("+n+"px, "+s+"px) scale("+1/r+")"}))}},e.prototype.getGraphicIsEndDraw=function(e){return this.serviceHandle.getGraphicIsEndDraw(e)},e.prototype.clearPage=function(e){this.enableDraw&&(this.updateGraphicPage(),this.graphicList.forEach((function(t){var r;t.selected=null===(r=t.page)||void 0===r?void 0:r.includes(e)})),this.deleteSelectedGraphics(a.c.ClearPage))},e.prototype.deleteSelectedGraphics=function(e){var t=this;if(this.enableDraw){var r=this.getUserID(),o=this.getUserAuth().delete,i=0,d=0,l=this.graphicList.filter((function(e){var n=!!e.selected&&e.type!==a.f.BgImage&&t.getGraphicIsEndDraw(e.graphic_id),s=o||r===e.creator_id;return n&&i++,n&&s&&d++,n&&s}));if(i!==d&&Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthDeleteGraphic),l.length){var u=this.getInstanceHandle(a.j.ZegoWhiteboardViewToolSelector);u.hideImageEditBox(),u.hideSelectBox(),l.forEach((function(e){e.is_end_draw=!0,e.operate_id=Object(s.d)(),t.deleteHandle(e.graphic_id)})),c.a.getInstance().info(["Whiteboard_View"],"gra.deleteSelectedGraphics",JSON.stringify({action:e,page:this.viewInfo.page,params:l.map((function(e){return e.graphic_id+","+e.page}))})),this.updateToRemoteNewHandle(l,a.a.Delete)}}},e.prototype.updateGraphicPage=function(){var e=this,t=this.graphicList.filter((function(t){return e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id))}));this.viewInfo.vpageAspecCache?t.forEach((function(t){var r=e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id)),o=r||{offsetTop:0,offsetHeight:0},i=o.offsetTop,n=o.offsetHeight,s=e.getPageByAspec(i,i+n);t.page=s||[e.viewInfo.page||1]})):!this.serviceHandle.getFileInfo(this.whiteboardID)&&this.conNode?t.forEach((function(t){var r=e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id)),o=[];if(1===e.viewInfo.direction){var i=r||{offsetLeft:0,offsetWidth:0},n=i.offsetLeft,s=i.offsetWidth;o=e.getPageByViewInfo(n,n+s,e.viewInfo.viewWidth)}else{var a=r||{offsetTop:0,offsetHeight:0},c=a.offsetTop,d=a.offsetHeight;o=e.getPageByViewInfo(c,c+d,e.viewInfo.viewHeight)}t.page=o||[e.viewInfo.page||1]})):this.graphicList.forEach((function(t){t.page=[e.viewInfo.page||1]}))},e.prototype.getPageByAspec=function(e,t){var r=this.viewInfo.vpageAspecCache;if(!r.hasOwnProperty("2"))return[1];for(var o=r.vs,i=r[o].h;i<=e&&r[o+1];)i+=r[o+1].h,o++;for(var n=o;i<=t&&r[n+1];)i+=r[n+1].h,n++;if(n===o)return[r[o].p];if(n-o>1){var s=new Array(n-o-1).fill(null);return s=s.map((function(e,t){return r[o+t+1].p})),C([r[o].p],s,[r[n].p])}return[r[o].p,r[n].p]},e.prototype.getPageByViewInfo=function(e,t,r){var o=Math.floor(e/r)+1,i=Math.floor(t/r)+1;if(i===o)return[o];if(i-o>1){var n=new Array(i-o-1).fill(null).map((function(e,t){return o+t+1}));return C([o],n,[i])}return[o,i]},e.prototype.toolAddEL=function(e,t,r){e.addEventListener(t,r);var i=o.a.mouseEvents[t];i&&e.addEventListener(i,r)},e.prototype.toolRmEl=function(e,t,r){e.removeEventListener(t,r);var i=o.a.mouseEvents[t];i&&e.removeEventListener(i,r)},e.prototype.updateOffsetPage=function(){var e=this.viewInfo,t=e.page,r=e.viewWidth,o=e.viewHeight,i=e.direction;e.isScroll||(i===a.o.Horizontal?this.viewInfo.offsetPageX=(t-1)*r:this.viewInfo.offsetPageY=(t-1)*o)},e}(),O=r(24),L=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},w=function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},M=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<r;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,i++)o[i]=n[s];return o},A=function(){function e(e,t){this.snapshotResult={image:""},this.canvasRatio=window.devicePixelRatio||1,this.toolInstance=e,this.backgroundInstance=t,this.file=this.toolInstance.serviceHandle.getFileInfo(this.toolInstance.whiteboardID),this.snapshotId=String(Date.now())}return e.prototype.snapshot=function(e){var t=this;return new Promise((function(r,o){return L(t,void 0,void 0,(function(){var t=this;return w(this,(function(o){return e&&(this.snapshotResult.userData=e),this.createCtx(),this.setWbBgColor(),this.setWbBgImage().then((function(){var e;if(t.file){var o={action:O.b.Snapshot,ctx:t.docsCtx,snapshotId:t.snapshotId};t.toolInstance.conNode.dispatchEvent(new CustomEvent(O.a.Whiteboard,{detail:o}))}t.wbSnapshot();var i=null===(e=t.file)||void 0===e?void 0:e.fileType;i===a.d.PPTH5||i===a.d.CUSTOM_H5?t.snapshotResolve=r:(t.snapshotResult.image=t.mergeCanvas(),r(t.snapshotResult))})),[2]}))}))}))},e.prototype.getH5Snapshot=function(e){var t=this,r=this.toolInstance.viewInfo,o=r.viewWidth,i=r.viewHeight,n=new Image;n.src=e,n.onload=function(){t.docsCtx.drawImage(n,0,0,o,i),t.snapshotResult.image=t.mergeCanvas(),t.snapshotResolve(t.snapshotResult)}},e.prototype.mergeCanvas=function(){var e=this.toolInstance.viewInfo,t=e.viewWidth,r=e.viewHeight,o=document.createElement("canvas");o.width=t*this.canvasRatio,o.height=r*this.canvasRatio;var i=o.getContext("2d");return i.scale(this.canvasRatio,this.canvasRatio),i.drawImage(this.docsCanvas,0,0,t,r),i.drawImage(this.wbCanvas,0,0,t,r),o.toDataURL("image/png",1)},e.prototype.createCtx=function(){var e=this.toolInstance.viewInfo,t=e.viewWidth,r=e.viewHeight;this.wbCanvas=document.createElement("canvas"),this.wbCanvas.width=t*this.canvasRatio,this.wbCanvas.height=r*this.canvasRatio,this.wbCtx=this.wbCanvas.getContext("2d"),this.wbCtx.scale(this.canvasRatio,this.canvasRatio),this.docsCanvas=document.createElement("canvas"),this.docsCanvas.width=t*this.canvasRatio,this.docsCanvas.height=r*this.canvasRatio,this.docsCtx=this.docsCanvas.getContext("2d"),this.docsCtx.scale(this.canvasRatio,this.canvasRatio)},e.containImg=function(e,t,r,o,i,n,s){var a=e,c=t,d=r,l=o;return i>n?(l=n/i*d,i/n<=r/o&&(d=i/n*o)):i<=n&&(d=i/n*l),"top"==s?(c=0,a=e+(r-d)/2):"bottom"==s?(c=t+(o-l),a=e+(r-d)/2):"left"==s?(a=0,c=t+(o-l)/2):"right"==s?(a=e+(r-d),c=t+(o-l)/2):"center"==s&&(a=e+(r-d)/2,c=t+(o-l)/2),{dx:a,dy:c,dWidth:d,dHeight:l}},e.prototype.setWbBgColor=function(){var e=this.file?o.a.basicExtraState.defaultFileBgColor:o.a.basicState.bgColor;this.setBgColor(this.wbCtx,e)},e.prototype.setWbBgImage=function(){var t=this;return new Promise((function(r){var o=t.backgroundInstance.backgroundInfo,i=o.image,n=o.pos,s=t.toolInstance.viewInfo,a=s.viewWidth,c=s.height;if(i){var d=new Image;d.setAttribute("crossOrigin","Anonymous"),d.onload=function(){var o=e.containImg(0,0,a,c,d.width,d.height,n);t.wbCtx.drawImage(d,o.dx,o.dy,o.dWidth,o.dHeight),r()},d.src=i}else r()}))},e.prototype.setBgColor=function(e,t){var r=this.toolInstance.viewInfo,o=r.viewWidth,i=r.viewHeight;e.fillStyle=t,e.fillRect(0,0,o,i)},e.prototype.wbSnapshot=function(){var e=this.sortGraphics();if(e)for(var t=0,r=e;t<r.length;t++){var o=r[t],i=this.getCorrectData(o);switch(o.type){case a.f.Pencil:case a.f.Line:this.renderPencil(o,this.wbCtx,i);break;case a.f.Rect:this.renderRect(o,this.wbCtx,i);break;case a.f.Ellipse:this.renderEllipse(o,this.wbCtx,i);break;case a.f.Text:this.renderText(o,this.wbCtx,i);break;case a.f.Image:this.renderImage(o,this.wbCtx,i)}}},e.prototype.renderPencil=function(e,t,r){var o=Object(s.r)(r);this.setCtxStyle(e,t),t.beginPath(),t.moveTo(o.moveTo[0],o.moveTo[1]),o.path.forEach((function(e){t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])})),t.stroke()},e.prototype.renderRect=function(e,t,r){var o=r[0],i=r[1],n=r[2]-o,s=r[3]-i;this.setCtxStyle(e,t),t.beginPath(),t.strokeRect(o,i,n,s)},e.prototype.renderEllipse=function(e,t,r){var o=r[0],i=r[1],n=(r[2]-o)/2,s=(r[3]-i)/2,a=o+n,c=i+s,d=n>s?Math.abs(n):Math.abs(s);this.setCtxStyle(e,t),t.beginPath(),t.save(),t.translate(a,c),t.scale(n/d,s/d),t.arc(0,0,d,0,2*Math.PI),t.restore(),t.stroke()},e.prototype.renderText=function(e,t,r){this.setCtxStyle(e,t);var i=r.split(","),n=i[0],s=i[1],a=i[2],c=this.toolInstance.getGraphicsHandle(e.graphic_id),d=this.getComputedFs(c.querySelector("pre")||c,"fontSize"),l=this.getComputedLh(c.querySelector("pre")||c,"lineHeight",d),u=(l-1)/2,h=a.split("\n"),p=o.a.textareaHPadding,f=o.a.textareaConBorderWidth;h.forEach((function(e,r){var o=+n+p+f,i=+s+d*l*r+d*u*1+f;t.fillText(""+e,o,i)}))},e.prototype.getComputedStyle=function(e,t,r){var o=window.getComputedStyle(e)[t];return r?r(o):o},e.prototype.getComputedLh=function(e,t,r){return this.getComputedStyle(e,t,(function(e){var t=1.2;return e.includes("px")&&(t=+e.replace(/px/,"")/r),t}))},e.prototype.getComputedFs=function(e,t){return this.getComputedStyle(e,t,(function(e){var t=12;return e.includes("px")&&(t=+e.replace(/px/,"")),t}))},e.prototype.renderImage=function(e,t,r){var i=r[0],n=r[1],s=r[2]-i,a=r[3]-n,c=this.toolInstance.graphicsConNode.querySelector("#"+o.a.reservedPrefix.graphics+e.graphic_id);"image"===(null==c?void 0:c.nodeName)&&t.drawImage(c,i,n,s,a)},e.prototype.setCtxStyle=function(e,t){var r=this.toolInstance.viewInfo.viewWidth,o=Object(s.c)(e.size,a.f.Pencil,r,!1);if(t.strokeStyle=e.color,t.fillStyle=e.color,e.type!==a.f.Text)t.lineWidth=o,t.lineJoin="round",t.lineCap="round";else{var i=this.toolInstance.getGraphicsHandle(e.graphic_id),n=this.getComputedFs(i.querySelector("pre")||i,"fontSize")+"px",c="string"==typeof e.attributes?JSON.parse(e.attributes):{},d=c.bold?"bold":"",l=c.italic?"italic":"",u=window.getComputedStyle(i.querySelector("pre")||i).fontFamily.replace(/"/g,"");t.textBaseline="hanging",t.font=l+" "+d+" "+n+" "+u+" "}},e.prototype.sortGraphics=function(){var e=this;return JSON.parse(JSON.stringify(this.toolInstance.graphicList)).filter((function(t){return e.toolInstance.getGraphicsHandle(t.graphic_id)})).sort((function(e,t){return(e.zorder||0)-(t.zorder||0)}))},e.prototype.getCorrectData=function(e){var t=e.type,r=e.data;switch(t){case a.f.Image:var o=e.data;r=this.correctData([o.x,o.y,o.ex,o.ey]);break;case a.f.Pencil:case a.f.Line:case a.f.Rect:case a.f.Ellipse:var i=this.correctData(e.data);r=this.getTransData(e,i);break;case a.f.Text:var n=e.data.split(","),s=n[2],c=this.correctData([+n[0],+n[1]]),d=this.getTransData(e,M(c));r=M(d,[s]).join(",")}return r},e.prototype.correctData=function(e){var t,r=this.toolInstance.viewInfo,o=r.direction,i=r.page,n=r.viewWidth,s=r.viewHeight,c=r.isScroll,d=r.zoom;if(o===a.o.Center)return e;if(o===a.o.Horizontal&&i)t=e.map((function(e,t){return t%2==0&&(e-=(i-1)*n),e}));else if(o===a.o.Vertical&&i){var l=this.toolInstance.whiteboardNode.parentNode.scrollTop;t=e.map((function(e,t){return t%2==1&&(e-=c?l/d:(i-1)*s),e}))}return t},e.prototype.getTransData=function(e,t){var r=e.x,o=e.y;return t.map((function(e,t){return e+=t%2==0?r:o}))},e}(),N=r(42);function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var P=function(){return(P=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},x=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},D=function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},U=function(){function e(e,t){var r=this;this.operationModes=Object.freeze({none:!1,scroll:!0,draw:!0,scale:!0}),this.canDraw=!0,this.activited=!1,this.viewInfo={},this.scaleInfo={x:-1,y:-1,syncTimer:0},this.snapshotInstances={},this.handleDragStart=function(e){if(r.operationModes.scale&&r.toolInstance.getUserAuth().scale&&(r.viewInfo.zoomX=r.viewInfo.zoomY=0,r.viewInfo.zoom>1&&!r.canDraw&&r.parentDom)){var t=e instanceof MouseEvent?e:e.changedTouches[0],o=t.clientX,i=t.clientY;r.viewInfo.zoomX=o,r.viewInfo.zoomY=i,c.a.getInstance().info(["WhiteBoard_View"],"handleDragStart",JSON.stringify({clientX:o,clientY:i}))}},this.handleDragEnd=function(e){r.handleDragMove(e,!0)},this.handleDragMove=function(e,t){if(r.operationModes.scale&&r.toolInstance.getUserAuth().scale&&r.viewInfo.zoom>1&&r.viewInfo.zoomX&&!r.canDraw){if(e instanceof MouseEvent&&!t&&e.buttons<1)return;"touchmove"===e.type&&e.preventDefault(),r.dragPage(e,!!t)}},this.preventDefaultDragEvent=function(e){e.preventDefault()},this.docsviewEventCallback=function(e){var t=e.detail,i=t.action;if(i!==O.b.H5Snapshot&&i!==O.b.DocsAspect&&c.a.getInstance().info(["WhiteBoard_View"],O.a.Docs,JSON.stringify({data:t})),i===O.b.Page)r.handleDocsPageEvent(t);else if(i===O.b.Animation)r.serviceHandle.appendH5Extra(r.whiteboardID,t.data);else if(i===O.b.DocsAspect)r.viewInfo.vpageAspecCache=t.data;else if(i===O.b.H5Snapshot)r.getH5SnapshotResult(t);else if(i===O.b.ReloadView)r.reinitView();else if(i===O.b.WbError){if(!r.serviceHandle.isPlayback&&(1e3==t.data||1001==t.data))return;Object(n.a)(t.data)}else if(i===O.b.Step)o.a.basicState.type===a.j.ZegoWhiteboardViewToolSelector&&r.hideSelectBox();else if(i===O.b.SyncDrag){var s=t,d=s.x,l=s.y,u=s.notify;r.viewInfo.isScroll||(r.viewInfo.zoomTX=d,r.viewInfo.zoomTY=l),u&&r.emitScaleFactor(d,l)}},this.whiteboardID=e,this.serviceHandle=t}return e.prototype.setWhiteboardTransform=function(e,t,r){r||(this.viewInfo.zoomTX=e,this.viewInfo.zoomTY=t);var o=this.viewInfo,i=o.viewWidth,n=o.viewHeight,s=o.zoom,c=o.direction,d=this.viewInfo.page||1;c===a.o.Horizontal?e-=(d-1)*i*s:t-=(d-1)*n*s,this.whiteboardNode.style.cssText+="transform:translate("+e+"px,"+t+"px) scale("+s+");"},e.prototype.dragPage=function(e,t){var r=this.viewInfo,o=r.zoom,i=r.zoomTX,n=r.zoomTY,s=r.zoomX,a=r.zoomY,d=r.viewWidth,l=r.viewHeight,u=e instanceof MouseEvent?e:e.changedTouches[0],h=i+u.clientX-s,p=n+u.clientY-a,f=d*(1-o);h>0?h=0:h<f&&(h=f),f=l*(1-o),p>0?p=0:p<f&&(p=f),t&&(this.viewInfo.zoomX=0,this.viewInfo.zoomY=0,this.emitScaleFactor(h,p)),this.setWhiteboardTransform(h,p,!t),c.a.getInstance().info(["WhiteBoard_View"],"dragPage",JSON.stringify({x:h,y:p,end:!t}))},e.prototype.initDragEvents=function(){this.viewInfo.hasOwnProperty("offsetPageX")||(this.viewInfo.offsetPageX=0,this.viewInfo.offsetPageY=0,this.viewInfo.zoom=1,this.viewInfo.zoomX=0,this.viewInfo.zoomY=0,this.viewInfo.zoomTX=0,this.viewInfo.zoomTY=0),this.parentDom&&!this.getFileInfo()&&(this.parentDom.addEventListener("mousedown",this.handleDragStart),this.parentDom.addEventListener("mousemove",this.handleDragMove),this.parentDom.addEventListener("mouseup",this.handleDragEnd),this.parentDom.addEventListener("mouseleave",this.handleDragEnd),this.parentDom.addEventListener("touchstart",this.handleDragStart),this.parentDom.addEventListener("touchmove",this.handleDragMove),this.parentDom.addEventListener("touchend",this.handleDragEnd),this.parentDom.addEventListener("touchcancel",this.handleDragEnd))},e.prototype.updateBindEvents=function(){this.toolInstance.removeEventsHandle(a.j.ZegoWhiteboardViewToolLaser),this.toolInstance.removeEventsHandle(a.j.ZegoWhiteboardViewToolLine),this.toolInstance.removeEventsHandle(a.j.ZegoWhiteboardViewToolText),this.toolInstance.removeEventsHandle(a.j.ZegoWhiteboardViewToolSelector),this.toolInstance.removeEventsHandle(a.j.ZegoWhiteboardViewToolEraser);var e=o.a.basicState.type;switch(e){case a.j.ZegoWhiteboardViewToolPen:case a.j.ZegoWhiteboardViewToolLine:case a.j.ZegoWhiteboardViewToolEllipse:case a.j.ZegoWhiteboardViewToolRect:case a.j.ZegoWhitebaordViewToolCustomImage:this.toolInstance.bindEventsHandle(a.j.ZegoWhiteboardViewToolLine);break;case a.j.ZegoWhiteboardViewToolLaser:case a.j.ZegoWhiteboardViewToolText:this.toolInstance.bindEventsHandle(e);break;case a.j.ZegoWhiteboardViewToolSelector:case a.j.ZegoWhiteboardViewToolEraser:this.toolInstance.getInstanceHandle(e),this.toolInstance.bindEventsHandle(e)}},e.prototype.initToolHandle=function(){this.toolInstance?(this.toolInstance.zoomNode=this.zoomNode,this.toolInstance.conNode=this.parentDom,this.toolInstance.graphicsConNode=this.graphicsConNode,this.toolInstance.whiteboardNode=this.whiteboardNode,this.toolInstance.graphicsBoxConNode=this.graphicsBoxConNode,this.penetrateEventHandle(o.a.basicState.type),this.getUniqueID()?this.setToolType(o.a.basicState.type):this.updateBindEvents()):(this.toolInstance=new I({whiteboardID:this.whiteboardID,zoomNode:this.zoomNode,conNode:this.parentDom,graphicsConNode:this.graphicsConNode,whiteboardNode:this.whiteboardNode,graphicsBoxConNode:this.graphicsBoxConNode,serviceHandle:this.serviceHandle,viewInfo:this.viewInfo}),this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolLaser),this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolLine),this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolText),this.setToolType(o.a.basicState.type))},e.prototype.updateStateSizeHandle=function(){var e=this.viewInfo.viewWidth,t=o.a.basicState,r=t.size,i=t.fontSize;o.a.basicExtraState.drawSize=Object(s.c)(r,a.f.Line,e,!1),o.a.basicExtraState.drawFontSize=Object(s.c)(i,a.f.Text,e,!1)},e.prototype.getDocsViewAspect=function(e,t,r,o){var i=e.firstChild;if(i){var n=t.fileType,s="0"==e.getAttribute("data-mode"),c=Number(e.getAttribute("data-page")),d=i.clientWidth,l=i.clientHeight;if(d&&l||(d=+i.style.width.replace("px",""),l=+i.style.height.replace("px","")),n===a.d.PPTH5||n===a.d.CUSTOM_H5){var u=e.previousElementSibling;u&&(u.style.zIndex="0")}var h=document.getElementById(this.viewInfo.root),p=h.clientWidth,f=h.clientHeight,g=s&&l>o;this.updateViewInfo({isScroll:s,isOriginScroll:g,direction:a.o.Vertical,pageCount:c,width:d,height:l,viewWidth:r,viewHeight:o,page:this.viewInfo.page||1,zoom:this.viewInfo.zoom||1,parentWidth:p,parentHeight:f})}return{x:0,y:0,width:this.viewInfo.viewWidth,height:this.viewInfo.viewHeight}},e.prototype.getWhiteboardAspect=function(e,t,r){var o=this.getAspectRatio().split(":").map((function(e){return+e})),i=o[0],n=o[1];if(r){var s=this.viewInfo.pageCount,c=this.getWhiteboardLayout(e,t,i/s,n),d={parentWidth:e,parentHeight:t,width:c.width*s,height:c.height,viewWidth:c.width,viewHeight:c.height};return this.updateViewInfo(d),c}var l=this.serviceHandle.getPageCount(this.whiteboardID),u={zoom:1,page:1,pageCount:l,direction:l>1?a.o.Horizontal:a.o.Center,parentWidth:e,parentHeight:t},h=this.getWhiteboardLayout(e,t,i/l,n);return u.width=h.width*l,u.height=h.height,u.viewWidth=h.width,u.viewHeight=h.height,this.updateViewInfo(u),h},e.prototype.getWhiteboardLayout=function(e,t,r,o){var i=e,n=o*i/r;return(n>t||Math.abs(n-t)<=1)&&(i=t*e/n|0,n=t),{x:(e-i)/2,y:(t-(n|=0))/2,width:i,height:n}},e.prototype.checkParentSize=function(e,t){if(e<=0||t<=0){var r=Object(n.b)(a.i.ZegoWhiteboardViewErrorViewParentNotExist);throw i.e.emit(i.b.Error,r),new Error("无法获取容器宽高")}},e.prototype.createModule=function(e){var t=this;e&&this.toolInstance&&this.stopLocalDrawHandle(this.serviceHandle.getScrollPercent(this.whiteboardID).verticalPercent);var r=this.getFileInfo(),i=document.getElementById(this.viewInfo.parent);r?this.viewInfo.root=i.parentNode.parentNode.id:(this.viewInfo.root=this.viewInfo.parent,i.style.cssText+="position:relative;display:inherit!important;");var n=i.clientWidth,c=i.clientHeight;n&&c||(n=+i.style.width.replace("px",""),c=+i.style.height.replace("px","")),this.checkParentSize(n,c);var d=e&&!r?{x:this.viewInfo.zoomTX/this.viewInfo.viewWidth,y:this.viewInfo.zoomTY/this.viewInfo.viewHeight}:{x:0,y:0},l=r?this.getDocsViewAspect(i,r,n,c):this.getWhiteboardAspect(n,c,e),u=l.x,h=l.y,p=o.a.reservedPrefix,f=p.whiteboardZoom,g=p.whiteboardCon,m=p.whiteboard,_=p.boxContainer,v=p.graphicsContainer,E=document.createDocumentFragment();[v,_].forEach((function(e){var r=document.createElement("div");r.id=""+e+t.whiteboardID,E.appendChild(r)}));var y=Object(s.g)(E);this.graphicsConNode=y[0],this.graphicsBoxConNode=y[1],this.createGraphicsBox();var S=this.viewInfo,T=S.width,b=S.height,R=S.viewWidth,C=S.viewHeight;if(this.whiteboardNode=document.createElement("div"),this.whiteboardNode.id=""+m+this.whiteboardID,this.whiteboardNode.style.cssText+="width:"+T+"px;height:"+b+"px;",this.whiteboardNode.appendChild(E),r)this.parentDom=i,this.zoomNode=i.parentNode,i.innerHTML="",i.appendChild(this.whiteboardNode),this.handleDocsviewEvent(i);else{var I="left:"+u+"px;top:"+h+"px;width:"+R+"px;height:"+C+"px;overflow:hidden;";if(this.parentDom=i.querySelector("#"+g+this.whiteboardID),e&&this.parentDom)this.parentDom.innerHTML="",this.parentDom.style.cssText+=I,this.parentDom.appendChild(this.whiteboardNode),this.setWhiteboardTransform(d.x*R|0,d.y*C|0);else{var O=document.createElement("div");O.id=""+f+this.whiteboardID,this.zoomNode=O;var L=document.createElement("div");L.id=""+g+this.whiteboardID,L.style.cssText=I,L.appendChild(this.whiteboardNode),O.appendChild(L),i.appendChild(O),this.parentDom=L}}o.a.basicState.type!==a.j.ZegoWhiteboardViewToolText&&(this.parentDom.style.userSelect="none"),this.parentDom.addEventListener("dragenter",this.preventDefaultDragEvent),this.serviceHandle.setViewSize(this.whiteboardID,R,C),this.serviceHandle.setSize(this.whiteboardID,T,b)},e.prototype.activitView=function(){var e;if(this.zoomNode){var t=(null===(e=this.getFileInfo())||void 0===e?void 0:e.fileID)||"",r=document.getElementById(this.viewInfo.root);if(r){var i=this.zoomNode.id;Array.from(Object(s.g)(r)).forEach((function(e){e.style.display=e.id===i?"block":"none"}))}var n=t?o.a.basicExtraState.defaultFileBgColor:o.a.basicState.bgColor;this.toolInstance.background.setBackgroundColor(n),this.setDragStyle(this.getToolType()||0)}},e.prototype.updateViewInfo=function(e){Object.assign(this.viewInfo,e)},e.prototype.isChangeStepInnerPage=function(e){var t,r=null===(t=this.getFileInfo())||void 0===t?void 0:t.fileType;if(r===a.d.PPTH5||r===a.d.CUSTOM_H5){var o=this.viewInfo,i=o.page,n=o.pageCount;return i===Math.min(Math.round(e*n)+1,n)}return!1},e.prototype.stopLocalDrawHandle=function(e){try{var t=o.a.basicState.type,r=a.j.ZegoWhiteboardViewToolLaser,i=a.j.ZegoWhiteboardViewToolSelector,n=a.j.ZegoWhiteboardViewToolText,s=this.isChangeStepInnerPage(e);switch(t){case r:var c=this.toolInstance.getInstanceHandle(r);!s&&c&&c.pushActualPlaceHandle();break;case i:var d=this.toolInstance.getInstanceHandle(i);if(!s&&d){var l=document.activeElement;l&&l.id&&this.whiteboardNode.querySelector("#"+l.id)&&"TEXTAREA"===l.tagName?l.blur():(this.toolInstance.updateOffsetAndScrollHandle(),d.mouseupHandle(),d.hideImageEditBox(),d.hideSelectBox())}break;case n:var u=document.activeElement;!s&&u&&u.id&&this.whiteboardNode.querySelector("#"+u.id)&&"TEXTAREA"===u.tagName&&u.blur();break;case a.j.ZegoWhiteboardViewToolPen:case a.j.ZegoWhiteboardViewToolRect:case a.j.ZegoWhiteboardViewToolLine:case a.j.ZegoWhiteboardViewToolEllipse:case a.j.ZegoWhitebaordViewToolCustomImage:var h=this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolLine);!s&&h&&(this.toolInstance.updateOffsetAndScrollHandle(),h.mouseupHandle())}this.toolInstance.resetImageBox()}catch(e){}},e.prototype.setClassNameHandle=function(e){var t,r=o.a.reservedPrefix,i=r.whiteboard,n=r.whiteboardCon,s=r.whiteboardZoom;null===(t=this.zoomNode.parentNode)||void 0===t||t.querySelectorAll("[id^="+i+"]").forEach((function(t){-1===t.id.indexOf(""+n)&&-1===t.id.indexOf(""+s)&&(t.className=a.j[e]||"")}))},e.prototype.penetrateEventHandle=function(e){var t,r=null===(t=this.getFileInfo())||void 0===t?void 0:t.fileType;if((r===a.d.PPTH5||r===a.d.CUSTOM_H5)&&this.parentDom){var o=this.operationModes.none||e!==a.j.ZegoWhiteboardViewToolClick?"initial":"none";this.parentDom.style.pointerEvents=o,this.graphicsBoxConNode.style.pointerEvents=o}},e.prototype.jumpPage=function(e,t){var r,o=this.viewInfo,i=o.viewWidth,n=o.viewHeight,s=o.pageCount,c=o.direction;s>=1&&(c===a.o.Horizontal?(r=Math.min(Math.round(e*s)+1,s))<=s&&(this.updateViewInfo({offsetPageX:(r-1)*i,page:r}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY)):(r=Math.min(Math.round(t*s)+1,s))<=s&&(this.updateViewInfo({offsetPageY:(r-1)*n,page:r}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY)));this.notifyScrollEvent(this.viewInfo.page,1,e,t)},e.prototype.handleDocsviewEvent=function(e){var t={action:O.b.WbInit,data:this.whiteboardID};e.dispatchEvent(new CustomEvent(O.a.Whiteboard,{detail:t})),e.addEventListener(O.a.Docs,this.docsviewEventCallback)},e.prototype.handleDocsPageEvent=function(e){var t,r=e.page,i=e.pageCount,n=e.step,s=e.percent,a=e.notify,c=e.ofsX,d=this.viewInfo,l=d.isScroll,u=d.viewHeight,h=d.zoom;this.viewInfo.page=r,this.viewInfo.pageCount=i,l||(this.viewInfo.offsetPageY=(r-1)*u),a&&l&&"number"==typeof c&&(t={scaleFactor:h,scaleOffsetX:c,scaleOffsetY:+o.a.scaleModes.sync},this.scaleInfo.y=0),this.emitScroll(0,s,n,a,t),this.notifyScrollEvent(r,n,0,s)},e.prototype.getH5SnapshotResult=function(e){var t=e.dataUrl,r=e.snapshotId;this.snapshotInstances[r].getH5Snapshot(t)},e.prototype.hideSelectBox=function(){var e=this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolSelector);e.hideImageEditBox(),e.hideSelectBox()},e.prototype.setDragStyle=function(e){if(this.parentDom){var t=this.toolInstance.getUserAuth(),r=t.scale,o=t.scroll,i=this.operationModes.scale&&!!r&&!e;this.parentDom.style.cursor=i?"move":"auto",this.parentDom.style.touchAction=i?"auto":"none";var n={action:O.b.WbDragTool,enable:this.operationModes.scroll&&!!o,remoteScroll:!!o,isDrag:i};this.parentDom.dispatchEvent(new CustomEvent(O.a.Whiteboard,{detail:n}))}},e.prototype.addImageGraphic=function(e,t,r){var o=this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolLine),i=this.toolInstance.transLocationOrigin({clientX:t,clientY:r});return o.drawLocalGraphicImage(e,i.clientX,i.clientY)},e.prototype.initBackground=function(e){this.toolInstance.createBackground(this.whiteboardNode,e)},e.prototype.canReloadView=function(){var e=document.getElementById(this.viewInfo.parent);e.style.cssText+="position:relative;display:block!important;";var t=e.clientWidth,r=e.clientHeight;this.checkParentSize(t,r);var o=this.viewInfo,i=o.viewWidth,n=o.viewHeight,s=this.getWhiteboardAspect(t,r,!0),a=s.x,d=s.y,l=s.width,u=s.height;return!(Math.abs(i-l)<5&&Math.abs(n-u)<5)||(this.parentDom.style.cssText+="left:"+a+"px;top:"+d+"px;",c.a.getInstance().info(["WhiteBoard_View"],"reloadViewLayou",JSON.stringify({w0:i,h0:n,w:l,h:u})),!1)},e.prototype.reinitView=function(){this.toolInstance.isReloading=!0,this.parentDom=null,this.init(this.viewInfo.parent,!0),this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolLaser).updateLaserConSize(),this.toolInstance.isReloading=!1},e.prototype.updateLaser=function(){this.toolInstance.reverseZoomHandle(a.j.ZegoWhiteboardViewToolLaser);var e=this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolLaser);e.updateLaserConSize(),e.pushActualPlaceHandle()},e.prototype.remoteUpdateBackgroundImage=function(e){this.toolInstance.background.remoteAddBackgroundImageGraphic(e)},e.prototype.remoteClearBackgroundImage=function(){this.toolInstance.background.updateToLocal(!0).clearBackgroundImage()},e.prototype.createGraphicsBox=function(){this.graphicsBoxConNode.innerHTML='\n        <div class="img-editor-box">\n            <div class="operation-point-desktop left-top cursor-nwse LT"></div>\n            <div class="operation-point-desktop right-top cursor-nesw RT"></div>\n            <div class="operation-point-desktop left-bottom cursor-nesw LB"></div>\n            <div class="operation-point-desktop right-bottom cursor-nwse RB"></div>\n            <div class="operation-point-desktop top cursor-ns T"></div>\n            <div class="operation-point-desktop right cursor-ew R"></div>\n            <div class="operation-point-desktop bottom cursor-ns B"></div>\n            <div class="operation-point-desktop left cursor-ew L"></div>\n        </div>\n        <div class="graphics-box"></div>'},e.prototype.emitScroll=function(e,t,r,o,i){this.serviceHandle.loadCurrentGraphics(this.whiteboardID,e,t),o&&this.serviceHandle.scroll(this.whiteboardID,e,t,r,i)},e.prototype.notifyScrollEvent=function(e,t,r,o){i.e.emit(i.b.ViewScroll,{id:this.whiteboardID,horizontalPercent:r,verticalPercent:o,page:e,step:t});var n=this.getUniqueID();i.e.emit(i.d.SubViewScrollChanged,n,e,t)},e.prototype.emitScaleFactor=function(e,t,r){if(!r){e=0|Math.abs(e),t=0|Math.abs(t);var i=this.viewInfo,n=i.zoom,s=i.width,a=i.height;e=e&&Number((e/s/n).toFixed(7)),t=t&&Number((t/a/n).toFixed(7)),this.scaleInfo.x=e,this.scaleInfo.y=t}o.a.scaleModes.sync&&this.serviceHandle.scale(this.whiteboardID,this.viewInfo.zoom,e,t)},e.prototype.scaleToHandle=function(e,t,r,o){var n=this;if(this.activited){if(this.scaleInfo.x=t,this.scaleInfo.y=r,this.viewInfo.zoom=e||1,this.getFileInfo()){this.scaleInfo.syncTimer&&clearTimeout(this.scaleInfo.syncTimer);var s=o?50:100;this.scaleInfo.syncTimer=window.setTimeout((function(){var i={action:O.b.WbScale,scale:e,x:t,y:r,notify:o};n.parentDom&&n.parentDom.dispatchEvent(new CustomEvent(O.a.Whiteboard,{detail:i})),n.updateLaser()}),s)}else{var a=this.viewInfo,c=a.viewWidth,d=a.viewHeight,l=a.width,u=a.height,h=a.zoom,p=-t*l*h,f=-r*u*h;o&&(p=c*(1-e)*.5|0,f=d*(1-e)*.5|0,this.emitScaleFactor(p,f)),this.setWhiteboardTransform(p,f),this.updateLaser()}i.e.emit(i.b.ViewScale,this.whiteboardID,this.viewInfo.zoom);var g=this.getUniqueID();i.e.emit(i.d.SubViewScaleChanged,g,this.viewInfo.zoom)}},e.prototype.init=function(e,t){this.viewInfo.parent=e;var r=document.getElementById(""+o.a.reservedPrefix.whiteboard+this.whiteboardID);this.parentDom&&r||this.createModule(!!t),this.initToolHandle(),this.initBackground(!!t||!r),this.updateStateSizeHandle(),this.initDragEvents(),this.activitView();var i=this.serviceHandle.getScrollPercent(this.whiteboardID),n=i.horizontalPercent,s=i.verticalPercent,a=i.pptStep;if(t){this.toolInstance.updateOffsetAndScrollHandle(),this.toolInstance.updateOffsetPage(),this.serviceHandle.isElectron?this.emitScroll(n,s,a,!1):(this.serviceHandle.reloadViewGraphics(this.whiteboardID,this.toolInstance.graphicList),this.updateRemoteToLocal(this.toolInstance.graphicList,[]));var d=this.scaleInfo,l=d.x,u=d.y;-1!==l&&-1!==u&&this.scaleToHandle(this.viewInfo.zoom,l,u,!1)}else{if(this.scrollToHandle(n,s,a,!1),o.a.scaleModes.response){var h=this.serviceHandle.getScale(this.whiteboardID),p=h.scaleFactor,f=h.scaleOffsetX,g=h.scaleOffsetY;this.scaleToHandle(p,f,g,!1)}this.playAnimation(this.serviceHandle.getH5Extra(this.whiteboardID),!1)}c.a.getInstance().info(["WhiteBoard_View","Inner"],"init",JSON.stringify({horizontalPercent:n,verticalPercent:s,step:a}));var m=this.zoomNode.parentNode,_=m.clientWidth,v=m.clientHeight;!t&&(Math.abs(_-this.viewInfo.parentWidth)>5||Math.abs(v-this.viewInfo.parentHeight)>5)&&this.reloadView()},e.prototype.getContentSize=function(){return{width:this.viewInfo.width,height:this.viewInfo.height}},e.prototype.getRootDomID=function(){return this.viewInfo.root},e.prototype.setActivited=function(e,t){e?this.activited=!0:this.viewInfo.root&&this.viewInfo.root!=t||(this.activited=!1)},e.prototype.getActivited=function(){return this.activited},e.prototype.scrollToHandle=function(e,t,r,o){if(this.activited)if(this.stopLocalDrawHandle(t),this.getFileInfo()){var i=this.serviceHandle.getScale(this.whiteboardID),n=i.scaleOffsetX,s=i.scaleOffsetY,a={action:O.b.Page,percent:t,step:r||1,ofsX:n,ofsY:s,notify:o};this.parentDom&&this.parentDom.dispatchEvent(new CustomEvent(O.a.Whiteboard,{detail:a}))}else this.emitScroll(e,t,1,o),this.jumpPage(e,t)},e.prototype.syncScaleToHandle=function(){var e=this.scaleInfo,t=e.x,r=e.y;-1!==t&&-1!==r&&this.emitScaleFactor(t,r,!0)},e.prototype.clearLaserHandle=function(e){this.toolInstance&&this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolLaser).clearLaserHandle(e)},e.prototype.clearLocalHandle=function(e){e&&e.includes(1)?this.remoteClearBackgroundImage():(this.toolInstance.clearLocalHandle(),this.createGraphicsBox())},e.prototype.updateRemoteToLocal=function(e,t){var r=this.toolInstance.graphicList.some((function(e){return t.length&&t.includes(e.graphic_id)&&e.type==a.f.BgImage})),o=e.filter((function(e){return e.type==a.f.BgImage}));if(o.length){var i=o.pop();this.remoteUpdateBackgroundImage(i)}r&&this.remoteClearBackgroundImage(),e=e.filter((function(e){return e.type!==a.f.BgImage})),this.toolInstance.updatePushLocalHandle(e,t)},e.prototype.destroyDomHandle=function(){if(this.parentDom){c.a.getInstance().info(["WhiteBoard_View"],"destroy_dom",JSON.stringify({domID:this.parentDom.id}));var e={action:O.b.WbDestroy,data:this.whiteboardID};this.parentDom.dispatchEvent(new CustomEvent(O.a.Whiteboard,{detail:e})),Object(s.n)(this.parentDom.parentElement),this.parentDom=null}},e.prototype.clearCanvasCache=function(){if(this.parentDom){c.a.getInstance().info(["WhiteBoard_View"],"mod_clear_canvas",JSON.stringify({domID:this.parentDom.id}));var e={action:O.b.WbSwitch,data:this.whiteboardID};this.parentDom.dispatchEvent(new CustomEvent(O.a.Whiteboard,{detail:e}))}},e.prototype.playAnimation=function(e,t){var r;if(this.activited){var o={action:O.b.Animation,data:e,notify:!t};null===(r=this.parentDom)||void 0===r||r.dispatchEvent(new CustomEvent(O.a.Whiteboard,{detail:o}))}},e.prototype.onAuthChange=function(){this.activited&&this.setDragStyle(this.getToolType()||0)},e.prototype.clear=function(){var e=this;if(!this.operationModes.draw)return Promise.resolve(!1);if(!this.toolInstance.getUserAuth().clear)return Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthClearGraphic),Promise.resolve(!1);c.a.getInstance().info(["WhiteBoard_View"],"API.clear",JSON.stringify({whiteboardID:this.whiteboardID}));var t=this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolSelector);return t.hideImageEditBox(),t.hideSelectBox(),this.serviceHandle.clearView(this.whiteboardID,[0]).then((function(){return e.clearLocalHandle(),c.a.getInstance().info(["WhiteBoard_View"],"mod.clear_cb","success"),Promise.resolve(!0)})).catch((function(e){var t=Object(n.a)(a.i.ZegoWhiteboardViewErrorClearFail);return c.a.getInstance().error(["WhiteBoard_View"],"mod.clear_cb",JSON.stringify(t)),Promise.resolve(!1)}))},e.prototype.scroll=function(e,t){return isNaN(+e)||isNaN(+t)?(Object(n.a)(a.i.ZegoWhiteboardViewErrorParamInvalid,"参数错误: horizontalPercent、verticalPercent取值为0~1",!0),!1):!!this.operationModes.scroll&&(this.toolInstance.getUserAuth().scroll?(c.a.getInstance().info(["WhiteBoard_View"],"mod.scroll",JSON.stringify({params:{horizontalPercent:e,verticalPercent:t}})),e<0&&(e=0),e>1&&(e=1),t<0&&(t=0),t>1&&(t=1),e=Number(e.toFixed(7)),t=Number(t.toFixed(7)),c.a.getInstance().info(["WhiteBoard_View"],"mod.scroll",JSON.stringify({params:{horizontalPercent:e,verticalPercent:t}})),this.viewInfo.pageCount>1&&this.viewInfo.page>0&&(this.scrollToHandle(e,t,1,!0),c.a.getInstance().info(["WhiteBoard_View"],"mod.scroll",JSON.stringify({transParams:{horizontalPercent:e,verticalPercent:t},status:!0})),!0)):(Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthScroll),!1))},e.prototype.getCurrentScrollPercent=function(){var e=P(P({},this.serviceHandle.getScrollPercent(this.whiteboardID)),{direction:this.viewInfo.direction});return c.a.getInstance().info(["WhiteBoard_View"],"API.getCurrentScrollPercent",JSON.stringify({percent:e})),e},e.prototype.getHorizontalPercent=function(){return c.a.getInstance().info(["WhiteBoard_View"],"API.getHorizontalPercent",JSON.stringify({horizontalPercent:this.getCurrentScrollPercent().horizontalPercent})),this.getCurrentScrollPercent().horizontalPercent},e.prototype.getVerticalPercent=function(){return c.a.getInstance().info(["WhiteBoard_View"],"API.getVerticalPercent",JSON.stringify({verticalPercent:this.getCurrentScrollPercent().verticalPercent})),this.getCurrentScrollPercent().verticalPercent},e.prototype.undo=function(){this.operationModes.draw&&(this.serviceHandle.isElectron?this.serviceHandle.undo(this.whiteboardID):this.toolInstance.undoNewHandle(),c.a.getInstance().info(["WhiteBoard_View"],"API.undo"))},e.prototype.redo=function(){this.operationModes.draw&&(this.serviceHandle.isElectron?this.serviceHandle.redo(this.whiteboardID):this.toolInstance.redoNewHandle(),c.a.getInstance().info(["WhiteBoard_View"],"API.redo"))},e.prototype._undoClear=function(){this.toolInstance.undoClearPage()},e.prototype.getAspectRatio=function(){var e=this.serviceHandle.getAspectRatio(this.whiteboardID);return c.a.getInstance().info(["WhiteBoard_View"],"API.getAspectRatio",JSON.stringify({aspectRatio:e})),e},e.prototype.getFileInfo=function(){var e=this.serviceHandle.getFileInfo(this.whiteboardID);return c.a.getInstance().info(["WhiteBoard_View"],"API.getFileInfo",JSON.stringify({fileInfo:e})),e},e.prototype.getID=function(){return this.whiteboardID},e.prototype.getName=function(){return this.serviceHandle.getModName(this.whiteboardID)},e.prototype.getCreateTime=function(){return this.serviceHandle.getCreateTime(this.whiteboardID)},e.prototype.getRoomID=function(){return this.serviceHandle.getRoomID(this.whiteboardID)},e.prototype.getUniqueID=function(){return this.serviceHandle.getUniqueID(this.whiteboardID)},e.prototype.getCurrentPage=function(){var e=this.viewInfo.page||1;return c.a.getInstance().info(["WhiteBoard_View"],"API.getCurrentPage",JSON.stringify({cp:e})),e},e.prototype.getPageCount=function(){var e=this.viewInfo.pageCount||1;return c.a.getInstance().info(["WhiteBoard_View"],"API.getPageCount",JSON.stringify({pageCount:e})),e},e.prototype.setBackgroundImage=function(e,t,r){var o=e instanceof File?{name:e.name,size:e.size,type:e.type}:e;return c.a.getInstance().info(["WhiteBoard_View"],"API.setBackgroundImage",JSON.stringify({address:o,mode:t})),this.toolInstance.background.setBackgroundImage(e,t,r)},e.prototype.clearBackgroundImage=function(){this.toolInstance.background.clearBackgroundImage(),c.a.getInstance().info(["WhiteBoard_View"],"API.clearBackgroundImage")},e.prototype.setToolType=function(e){var t;if(c.a.getInstance().info(["WhiteBoard_View"],"API.setToolType",JSON.stringify({type:e})),e=e||0,!Object(N.o)(e)||this.operationModes.none)return!1;if(e===a.j.ZegoWhiteboardViewToolClick){var r=null===(t=this.getFileInfo())||void 0===t?void 0:t.fileType;if(r!==a.d.PPTH5&&r!==a.d.CUSTOM_H5)return!1}return o.a.basicState.type=e,!this.toolInstance||(this.parentDom.style.userSelect=e!==a.j.ZegoWhiteboardViewToolText?"none":"auto",this.canDraw=this.operationModes.draw&&!!e&&e!==a.j.ZegoWhiteboardViewToolClick,this.setClassNameHandle(e),this.setDragStyle(e),this.penetrateEventHandle(e),this.updateBindEvents(),this.hideSelectBox(),c.a.getInstance().info(["WhiteBoard_View"],"API.setToolType","true"),!0)},e.prototype.getToolType=function(){var e=Object(N.e)();return c.a.getInstance().info(["WhiteBoard_View"],"API.getToolType",JSON.stringify({toolType:e})),e},e.prototype.setBrushColor=function(e){var t=Object(N.j)(e);return c.a.getInstance().info(["WhiteBoard_View"],"API.setBrushColor",JSON.stringify({color:e,res:t})),t},e.prototype.getBrushColor=function(){var e=Object(N.b)();return c.a.getInstance().info(["WhiteBoard_View"],"API.getBrushColor",JSON.stringify({color:e})),e},e.prototype.setBrushSize=function(e){var t=Object(N.k)(e);return t&&this.updateStateSizeHandle(),c.a.getInstance().info(["WhiteBoard_View"],"API.setBrushSize",JSON.stringify({thin:e,res:t})),t},e.prototype.getBrushSize=function(){var e=Object(N.c)();return c.a.getInstance().info(["WhiteBoard_View"],"API.getBrushSize",JSON.stringify({size:e})),e},e.prototype.setFontSize=function(e){var t=Object(N.n)(e);return t&&this.updateStateSizeHandle(),c.a.getInstance().info(["WhiteBoard_View"],"API.setFontSize",JSON.stringify({thin:e,res:t})),t},e.prototype.getFontSize=function(){var e=Object(N.d)();return c.a.getInstance().info(["WhiteBoard_View"],"API.getFontSize",JSON.stringify({size:e})),e},e.prototype.setTextSize=function(e){var t=this.setFontSize(e);return c.a.getInstance().info(["WhiteBoard_View"],"API.setTextSize",JSON.stringify({thin:e,res:t})),t},e.prototype.getTextSize=function(){var e=this.getFontSize();return c.a.getInstance().info(["WhiteBoard_View"],"API.getFontSize",JSON.stringify({size:e})),this.getFontSize()},e.prototype.setFontBold=function(e){var t=Object(N.l)(e);return c.a.getInstance().info(["WhiteBoard_View"],"API.setFontBold",JSON.stringify({bold:e,res:t})),t},e.prototype.isFontBold=function(){var e=Object(N.f)();return c.a.getInstance().info(["WhiteBoard_View"],"API.isFontBold",JSON.stringify({res:e})),e},e.prototype.setFontItalic=function(e){var t=Object(N.m)(e);return c.a.getInstance().info(["WhiteBoard_View"],"API.setFontItalic",JSON.stringify({italic:e,res:t})),t},e.prototype.isFontItalic=function(){var e=Object(N.g)();return c.a.getInstance().info(["WhiteBoard_View"],"API.setFontItalic",JSON.stringify({res:e})),e},e.prototype.setBackgroundColor=function(e){return!(!Object(N.i)(e)||!this.toolInstance.enableDraw)&&(this.toolInstance.background.setBackgroundColor(e),c.a.getInstance().info(["WhiteBoard_View"],"API.setBackgroundColor",JSON.stringify({color:e})),!0)},e.prototype.getBackgroundColor=function(){var e=Object(N.a)();return c.a.getInstance().info(["WhiteBoard_View"],"API.getBackgroundColor",JSON.stringify({res:e})),e},e.prototype.setScaleFactor=function(e,t,r){var o=+e;(!o||o<1)&&(o=1),this.viewInfo.zoom!==o&&this.operationModes.scale&&this.getToolType()!==a.j.ZegoWhiteboardViewToolClick&&(this.toolInstance.getUserAuth().scale?(this.scaleToHandle(o,t||0,r||0,!0),c.a.getInstance().info(["WhiteBoard_View"],"API.setScaleFactor",JSON.stringify({params:{zoom:o,x:t,y:r}}))):Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthScale))},e.prototype.getScaleFactor=function(){var e={scaleFactor:this.viewInfo.zoom,scaleOffsetX:0,scaleOffsetY:0};return c.a.getInstance().info(["WhiteBoard_View"],"API.getScaleFactor",JSON.stringify({scaleFactor:e})),e},e.prototype.getScaleOffsetX=function(){var e=this.getScaleFactor().scaleOffsetX;return c.a.getInstance().info(["WhiteBoard_View"],"API.getScaleFactor",JSON.stringify({scaleOffsetX:e})),e},e.prototype.getScaleOffsetY=function(){var e=this.getScaleFactor().scaleOffsetY;return c.a.getInstance().info(["WhiteBoard_View"],"API.getScaleFactor",JSON.stringify({scaleOffsetY:e})),e},e.prototype.clearCurrentPage=function(){this.toolInstance.clearPage(this.viewInfo.page||1),c.a.getInstance().info(["WhiteBoard_View"],"API.clearCurrentPage",JSON.stringify({page:this.viewInfo.page||1}))},e.prototype.deleteSelectedGraphics=function(){this.toolInstance.deleteSelectedGraphics(a.c.BatchSelete),c.a.getInstance().info(["WhiteBoard_View"],"API.deleteSelectedGraphics")},e.prototype.addText=function(e,t,r){if(this.operationModes.draw&&this.getToolType()===a.j.ZegoWhiteboardViewToolText)if(!e||!Object(s.k)(t)||!Object(s.k)(r)||t<0||r<0||t>this.viewInfo.viewWidth||r>this.viewInfo.viewHeight)Object(n.a)(a.i.ZegoWhiteboardViewErrorParamInvalid);else if(this.toolInstance.getUserAuth().create){var o=this.toolInstance.getInstanceHandle(a.j.ZegoWhiteboardViewToolText);this.toolInstance.updateOffsetAndScrollHandle();var i=this.toolInstance.transLocationOrigin({clientX:t,clientY:r});t=i.clientX,r=i.clientY,o.addTextGraphics(e,t,r),c.a.getInstance().info(["WhiteBoard_View"],"API.addText",JSON.stringify({params:{text:e,positionX:t,positionY:r}}))}else Object(n.a)(a.i.ZegoWhiteboardViewErrorNoAuthCreateGraphic)},e.prototype.addImage=function(e,t,r,i,d){var l=this,u=this.viewInfo.viewWidth,h=this.viewInfo.viewHeight,p=a.n.ZegoWhiteboardViewImageGraphic,f=a.n.ZegoWhiteboardViewImageCustom;if(!i||e!==p&&e!==f||!Object(s.k)(t)||!Object(s.k)(r)||e===p&&(t<0||r<0||t>u||r>h)||e===f&&"string"!=typeof i){var g=Object(n.b)(a.i.ZegoWhiteboardViewErrorParamInvalid);return Promise.reject(g)}if(!this.operationModes.draw)return Promise.reject({});if(!this.toolInstance.getUserAuth().create){g=Object(n.b)(a.i.ZegoWhiteboardViewErrorNoAuthCreateGraphic);return Promise.reject(g)}var m=e===p?10485760:512e3;if("string"==typeof i){var _=i;if(!_.startsWith("https://")){g=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicIllegalUrl);return Promise.reject(g)}return new Promise((function(s,d){var u=!0,h=new XMLHttpRequest;h.open("HEAD",_,!0),h.onreadystatechange=function(){if(4==h.readyState){if(200!=h.status){u=!1;var p=404===h.status?a.i.ZegoWhiteboardViewErrorGraphicIllegalUrl:a.i.ZegoWhiteboardViewErrorInvalidRsp;return d(Object(n.b)(p))}var g=(h.getResponseHeader("Content-Type")||"").replace("image/",""),v=+h.getResponseHeader("Content-Length");if(!"jpg,jpeg,png,svg+xml".includes(g)){var E=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return d(E)}if(v>m){E=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return d(E)}if(c.a.getInstance().info(["WhiteBoard_View"],"API.addImage",JSON.stringify({params:{type:e,positionX:t,positionY:r,address:i}})),e===f){o.a.basicExtraState.customImage.url=_;var y=new Image;y.setAttribute("crossOrigin","anonymous"),y.onload=function(){o.a.basicExtraState.customImage.w=y.width,o.a.basicExtraState.customImage.h=y.height},y.src=_,s(_)}else l.addImageGraphic(_,t,r).then(s)}},h.onerror=function(){if(u){var e=404===h.status?a.i.ZegoWhiteboardViewErrorGraphicIllegalUrl:a.i.ZegoWhiteboardViewErrorInvalidRsp;d(Object(n.b)(e))}},h.send(null)}))}if(this.serviceHandle.isElectron&&e===p&&"object"===k(i)){if(!/(\.jpg|\.jpeg|\.png|\.svg)$/.test((i=i).path)){g=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return Promise.reject(g)}return c.a.getInstance().info(["WhiteBoard_View"],"API.addImage",JSON.stringify({params:{type:e,positionX:t,positionY:r,address:i.path}})),this.serviceHandle.uploadImage(i.path,d).then((function(e){return l.addImageGraphic(e,t,r)}))}var v=(i=i).type.replace("image/","");if(!"jpg,jpeg,png,svg+xml".includes(v)){g=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return Promise.reject(g)}if(i.size>m){g=Object(n.b)(a.i.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return Promise.reject(g)}return c.a.getInstance().info(["WhiteBoard_View"],"API.addImage",JSON.stringify({params:{type:e,positionX:t,positionY:r,address:i.name}})),this.serviceHandle.uploadImage(i,d).then((function(e){return l.addImageGraphic(e,t,r)}))},e.prototype.setWhiteboardOperationMode=function(e){if(e&&Object(s.k)(e)){var t=!!(e%2),r=!t&&[2,6,10,14].includes(e),i=!t&&[4,6,12,14].includes(e),d=!t&&[8,10,12,14].includes(e);this.operationModes=Object.freeze({none:t,scroll:r,draw:i,scale:d});var l=o.a.basicState.type;this.toolInstance&&(this.toolInstance.enableDraw=i),this.canDraw=i&&!!l&&l!==a.j.ZegoWhiteboardViewToolClick,this.setDragStyle(l),this.penetrateEventHandle(l),c.a.getInstance().info(["WhiteBoard_View"],"API.setWhiteboardOperationMode",JSON.stringify({params:e,result:this.operationModes}))}else Object(n.a)(a.i.ZegoWhiteboardViewErrorParamInvalid)},e.prototype.snapshot=function(e){return x(this,void 0,void 0,(function(){var t,r,o;return D(this,(function(i){switch(i.label){case 0:return t=null==e?void 0:e.userData,r=new A(this.toolInstance,this.toolInstance.background),this.snapshotInstances[r.snapshotId]=r,[4,r.snapshot(t)];case 1:return o=i.sent(),delete this.snapshotInstances[r.snapshotId],c.a.getInstance().info(["WhiteBoard_View"],"API.snapshot",JSON.stringify({snapshotResult:o})),[2,o]}}))}))},e.prototype.reloadView=function(){if(this.getFileInfo()){var e={action:O.b.ReloadView,data:""};this.parentDom&&this.parentDom.dispatchEvent(new CustomEvent(O.a.Whiteboard,{detail:e}))}else this.canReloadView()&&this.reinitView();c.a.getInstance().info(["WhiteBoard_View"],"API.reloadView")},e.prototype.getVisibleSize=function(){var e={width:this.viewInfo.viewWidth,height:this.viewInfo.viewHeight};return c.a.getInstance().info(["WhiteBoard_View"],"API.reloadView",JSON.stringify({size:e})),e},e}(),B=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},Z=function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},H=function(){function e(e){this.modIdMapInstance={},this.fileInfoMap={},this.signallingDelay=0,this.serviceHandle=e,this.registerLoadfileListener(),this.registerPushCallbackHandle(),this.registerPullCallbackHandle()}return e.prototype.registerLoadfileListener=function(){var e=this;document.body.addEventListener("loadfile",(function(t){var r=t.detail.fileID;e.fileInfoMap[r]=t.detail,c.a.getInstance().info(["Whiteboard_Manager","Inner"],"update_file_info",JSON.stringify({fileID:r,detail:t.detail}))}))},e.prototype.registerPushCallbackHandle=function(){var e=this;i.e.on(i.c.PushClearPageGraphics,(function(t,r){e.signallingDelay?setTimeout((function(){e.clearGraphicsPushCallback(t,r)}),e.signallingDelay):e.clearGraphicsPushCallback(t,r)})),i.e.on(i.c.PushDrawPageGraphics,(function(t,r,o){e.signallingDelay?setTimeout((function(){e.drawGraphicsPushCallback(t,r,o)}),e.signallingDelay):e.drawGraphicsPushCallback(t,r,o)})),i.e.on(i.c.PushAddMod,(function(t,r){e.signallingDelay?setTimeout((function(){e.addModPushCallback(t,r)}),e.signallingDelay):e.addModPushCallback(t,r)})),i.e.on(i.c.PushRemovedMod,(function(t,r){e.signallingDelay?setTimeout((function(){e.removedModPushCallback(t,r)}),e.signallingDelay):e.removedModPushCallback(t,r)})),i.e.on(i.c.PushScroll,(function(t,r,o,i){e.signallingDelay?setTimeout((function(){e.scrollPushCallback(t,r,o,i)}),e.signallingDelay):e.scrollPushCallback(t,r,o,i)})),i.e.on(i.c.PushScale,(function(t,r,o,i){e.signallingDelay?setTimeout((function(){e.scalePushCallback(t,r,o,i)}),e.signallingDelay):e.scalePushCallback(t,r,o,i)})),i.e.on(i.c.PushH5ExtraAppended,(function(t,r){e.signallingDelay?setTimeout((function(){e.h5ExtraAppendedPushCallback(t,r)}),e.signallingDelay):e.h5ExtraAppendedPushCallback(t,r)})),i.e.on(i.c.PushAuthChange,(function(t,r){e.onPushAuthChange(t,r)}))},e.prototype.registerPullCallbackHandle=function(){var e=this;i.e.on(i.c.GetPageGraphicsList,(function(t,r,o){var i=e.getMapInstance(t);i&&i.updateRemoteToLocal(r,o)})),i.e.on(i.c.AppendH5Extra,(function(t){var r=t.whiteboardID,o=t.code,n=t.msg,s=t.modExtra,c=t.isH5;0!==o&&(o===a.i.ZegoWhiteboardViewErrorAnimationInfoLimit?i.e.emit(i.b.Error,{code:o,msg:n}):c?e.h5ExtraAppendedPushCallback(r,s):i.e.emit(i.b.Error,{code:o,msg:n}))})),i.e.on(i.c.Scroll,(function(t){var r=t.whiteboardID,o=t.code,i=t.horizontalPercent,n=t.verticalPercent,s=t.step;0!==o&&e.scrollPushCallback(r,i,n,s)})),i.e.on(i.c.Scale,(function(t){var r=t.whiteboardID,o=t.code,i=t.mod_scale;0!==o&&e.scalePushCallback(r,i.scale,i.ofs_x,i.ofs_y)}))},e.prototype.addModPushCallback=function(e,t){var r=this.getMapInstance(e);r||(c.a.getInstance().info(["Whiteboard_Manager","Inner"],"remote_add",JSON.stringify({whiteboardID:e})),r=new U(e,this.serviceHandle),this.setMapInstance(r)),i.e.emit(i.d.RemoteModAdd,r),i.e.emit(i.b.ViewAdd,r)},e.prototype.removedModPushCallback=function(e,t){var r=this.getMapInstance(e);r&&(c.a.getInstance().info(["Whiteboard_Manager","Inner"],"remote_removed",JSON.stringify({whiteboardID:e})),r.destroyDomHandle(),r=null,this.deleteMapInstance(e),i.e.emit(i.d.RemoteModRemoved,t,e),i.e.emit(i.b.ViewRemoved,e))},e.prototype.scrollPushCallback=function(e,t,r,o){var i=this.getMapInstance(e);i&&(c.a.getInstance().warn(["Whiteboard_Manager","Inner"],"remote_scroll","whiteboardID="+e+",hPercent="+t+",vPercent="+r+",step="+o),i.scrollToHandle(t,r,o,!1))},e.prototype.scalePushCallback=function(e,t,r,i){var n=this.getMapInstance(e);n&&(c.a.getInstance().warn(["Whiteboard_Manager","Inner"],"remote_scale","whiteboardID="+e+",scale="+t+",ofsX="+r+",ofsY="+i),o.a.scaleModes.response&&n.scaleToHandle(t,r,i,!1))},e.prototype.h5ExtraAppendedPushCallback=function(e,t){var r=this.getMapInstance(e);r&&(c.a.getInstance().warn(["Whiteboard_Manager","Inner"],"remote_extra","whiteboardID="+e+",modExtra="+t),r.playAnimation(t,!0))},e.prototype.clearGraphicsPushCallback=function(e,t){var r=this.getMapInstance(e);r&&r.clearLocalHandle(t)},e.prototype.drawGraphicsPushCallback=function(e,t,r){var o=this.getMapInstance(e);o&&o.updateRemoteToLocal(t,r)},e.prototype.onPushAuthChange=function(e,t){t&&(i.e.emit(i.b.WhiteboardGraphicAuthChange,t),i.e.emit(i.d.RemoteGraphicAuthChange,t)),e&&(i.e.emit(i.b.WhiteboardAuthChange,e),i.e.emit(i.d.RemoteAuthChange,e),e&&Object.values(this.modIdMapInstance).forEach((function(e){return e&&e.onAuthChange()})))},e.prototype.setFileInfo=function(e){var t;if(e.fileInfo){var r=e.fileInfo,o=r.fileID,i=r.fileName,n=this.fileInfoMap[o];(n=n&&n[i])&&(e.aspectWidth=n.width,e.aspectHeight=n.height,e.pageCount=n.pageCount,c.a.getInstance().info(["Whiteboard_Manager","Inner"],"update_file_info",JSON.stringify({fileID:o,detail:(t={fileID:o},t[i]=n,t)})))}},e.prototype.deleteMapInstance=function(e){delete this.modIdMapInstance[e]},e.prototype.getMapInstance=function(e){return this.modIdMapInstance[e]},e.prototype.setMapInstance=function(e){this.modIdMapInstance[e.getID()]=e},e.prototype.setActivitedView=function(e,t){this.serviceHandle.isPlayback?i.e.emit(i.c.AttachedView,[]):Object.values(this.modIdMapInstance).forEach((function(r){r.setActivited(r.getID()==e,t)}))},e.prototype.getActivitedViews=function(){return Object.values(this.modIdMapInstance).filter((function(e){return e.getActivited()}))},e.prototype.checkAttachingParent=function(e){return!!document.getElementById(e)},e.prototype.checkCreatingView=function(e){return!(!e||!e.name||isNaN(+e.aspectWidth)||!+e.aspectWidth||isNaN(+e.aspectHeight)||!+e.aspectHeight||isNaN(+e.pageCount)||!+e.pageCount)},e.prototype.setViewSize=function(e){var t=this.getMapInstance(e);if(t){var r=t.getContentSize(),o=r.width,i=r.height;this.serviceHandle.setSize(e,o,i)}},e.prototype.createErrorStr=function(e){return void 0!==e.code?JSON.stringify(e):""+e},e.prototype.loginRoom=function(e,t,r,o){return this.serviceHandle.loginRoom(e,t,r,o)},e.prototype.logoutRoom=function(e){return this.serviceHandle.logoutRoom(e)},e.prototype.getCurrentActivitedView=function(){return this.serviceHandle.getCurrentActivitedView()},e.prototype.setDeferredRenderingTime=function(e){this.signallingDelay=e||0},e.prototype.clear=function(e){Object.values(this.modIdMapInstance).forEach((function(t){t&&t.clearLaserHandle(e)})),c.a.getInstance().info(["Whiteboard_Manager","API"],"clear",JSON.stringify({userID:e}))},e.prototype.getViewList=function(){return B(this,void 0,void 0,(function(){var e,t,r=this;return Z(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.serviceHandle.getModList()];case 1:return e=o.sent(),Object.keys(this.modIdMapInstance).forEach((function(t){-1===e.indexOf(t)&&r.deleteMapInstance(t)})),e.forEach((function(e){r.modIdMapInstance[e]||r.setMapInstance(new U(e,r.serviceHandle)),r.setViewSize(e)})),c.a.getInstance().info(["Whiteboard_Manager","API"],"getViewList",JSON.stringify(Object.keys(this.modIdMapInstance))),[2,Object.values(this.modIdMapInstance).sort((function(e,t){return r.serviceHandle.getCreateTime(t.getID())-r.serviceHandle.getCreateTime(e.getID())}))];case 2:return t=o.sent(),c.a.getInstance().error(["Whiteboard_Manager","API"],"getViewList",this.createErrorStr(t)),[2,Promise.reject(void 0!==t.code?t:Object(n.b)(a.i.ZegoWhiteboardViewErrorGetListFail))];case 3:return[2]}}))}))},e.prototype.createView=function(e,t){var r=this;return new Promise((function(o,i){return B(r,void 0,void 0,(function(){var r,s,d,l;return Z(this,(function(u){switch(u.label){case 0:if(!this.checkCreatingView(e))return r=Object(n.b)(a.i.ZegoWhiteboardViewErrorParamInvalid,"参数错误：roomID、name为字符串，aspectWidth、aspectHeight、pageCount为正整数",!0),c.a.getInstance().error(["Whiteboard_Manager","API"],"createView",this.createErrorStr(r)),i(r),[2];this.setFileInfo(e),c.a.getInstance().info(["Whiteboard_Manager","API"],"createView",JSON.stringify({whiteboardModel:e})),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.serviceHandle.createMod(e,t)];case 2:return s=u.sent(),(d=this.getMapInstance(s))||(d=new U(s,this.serviceHandle),this.setMapInstance(d),c.a.getInstance().info(["Whiteboard_Manager","API"],"createView","success")),o(d),[3,4];case 3:return l=u.sent(),c.a.getInstance().error(["Whiteboard_Manager","API"],"createView",this.createErrorStr(l)),i(void 0!==l.code?l:Object(n.b)(a.i.ZegoWhiteboardViewErrorViewCreateFail)),[3,4];case 4:return[2]}}))}))}))},e.prototype.destroyView=function(e){var t=this;return new Promise((function(r,o){return B(t,void 0,void 0,(function(){var t,i,s;return Z(this,(function(d){switch(d.label){case 0:if(!e||!e.getID)return t=Object(n.b)(a.i.ZegoWhiteboardViewErrorViewNotExist),c.a.getInstance().error(["Whiteboard_Manager","API"],"destroyView",JSON.stringify({whiteboardView:e,errorData:t})),o(t),[2];d.label=1;case 1:return d.trys.push([1,3,,4]),i=e.getID(),[4,this.serviceHandle.destroyMod(i)];case 2:return d.sent(),this.deleteMapInstance(i),e.destroyDomHandle(),e=null,c.a.getInstance().info(["Whiteboard_Manager","API"],"destroyView","success"),r(),[3,4];case 3:return s=d.sent(),c.a.getInstance().error(["Whiteboard_Manager","API"],"destroyView",this.createErrorStr(s)),o(void 0!==s.code?s:Object(n.b)(a.i.ZegoWhiteboardViewErrorDestroyFail)),[3,4];case 4:return[2]}}))}))}))},e.prototype.attachView=function(e,t){var r=this;return new Promise((function(o,i){if(!r.checkAttachingParent(t)){var s=Object(n.b)(a.i.ZegoWhiteboardViewErrorViewParentNotExist);return c.a.getInstance().error(["Whiteboard_Manager","API"],"attachView",JSON.stringify({parent:t,errorData:s})),void i(s)}if(!e||!e.getID){s=Object(n.b)(a.i.ZegoWhiteboardViewErrorViewNotExist);return c.a.getInstance().error(["Whiteboard_Manager","API"],"attachView",JSON.stringify({whiteboardView:e,errorData:s})),void i(s)}c.a.getInstance().info(["Whiteboard_Manager","API"],"attachView",JSON.stringify({whiteboardID:e.getID(),parent:t}));try{var d=e,l=d.getFileInfo();(null==l?void 0:l.fileID)?r.serviceHandle.setFileInfo(r.fileInfoMap[l.fileID].data):r.serviceHandle.setFileInfo({});var u=d.getID();d.init(t),r.setMapInstance(d),r.setActivitedView(u,d.getRootDomID()),d.clearCanvasCache();var h=r.serviceHandle.getScrollPercent(u),p=h.horizontalPercent,f=h.verticalPercent,g=h.pptStep;d.scrollToHandle(p,f,g,!1),d.clearCanvasCache(),c.a.getInstance().info(["Whiteboard_Manager","API"],"attachView","success"),o()}catch(e){c.a.getInstance().error(["Whiteboard_Manager","API"],"attachView",r.createErrorStr(e)),i(Object(n.b)(a.i.ZegoWhiteboardViewErrorAttachFail))}}))},e.prototype.enableSyncScale=function(e){o.a.scaleModes.sync=!!e,e&&this.getActivitedViews().forEach((function(e){return e.syncScaleToHandle()}))},e.prototype.enableResponseScale=function(e){var t=this;o.a.scaleModes.response=!!e,e&&this.getActivitedViews().forEach((function(e){var r=t.serviceHandle.getScale(e.getID()),o=r.scaleFactor,i=r.scaleOffsetX,n=r.scaleOffsetY;e.scaleToHandle(o,i,n,!1)}))},e.prototype.enableHandwriting=function(e){if("boolean"==typeof e){var t=o.a.basicState.attributes,r=JSON.parse(t);r.stroke=!!e,o.a.basicState.attributes=JSON.stringify(r),this.serviceHandle.enableHandwriting(r.stroke),c.a.getInstance().info(["Whiteboard_Manager","API"],"enableHandwriting","success")}else{var i=Object(n.b)(a.i.ZegoWhiteboardViewErrorParamInvalid,"参数错误",!0);c.a.getInstance().error(["Whiteboard_Manager","API"],"enableHandwriting",this.createErrorStr(i))}},e.prototype.undoClearAction=function(){this.getActivitedViews().forEach((function(e){return e._undoClear()}))},e.prototype.switchView=function(e){return c.a.getInstance().info(["Whiteboard_Manager","API"],"switchView",JSON.stringify({whiteboardID:e})),this.serviceHandle.switchView(e)},e.prototype.on=function(e,t){return i.e.on(e,t)},e.prototype.off=function(e,t){return i.e.off(e,t)},e}()},,,function(e,t,r){r(5)({target:"Array",stat:!0},{isArray:r(81)})},,,,function(e,t,r){var o=r(19),i=r(92),n=r(39),s=r(98).f,a=function(e){return function(t){for(var r,a=n(t),c=i(a),d=c.length,l=0,u=[];d>l;)r=c[l++],o&&!s.call(a,r)||u.push(e?[r,a[r]]:a[r]);return u}};e.exports={entries:a(!0),values:a(!1)}},function(e,t,r){var o=r(315),i=r(342);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var n={insert:"head",singleton:!1};o(i,n);e.exports=i.locals||{}},function(e,t,r){(t=r(316)(!1)).push([e.i,"#zego-whiteboard-input {\n  position: absolute;\n  width: 0px;\n  height: 0px;\n  padding: 0px;\n  border: none;\n}\n\n[id^='zego-whiteboard-zoom'] {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n\n[id^='zego-whiteboard-con'],\n[id^='zego-whiteboard-con'] > div {\n  transform-origin: 0 0;\n}\n\n[id^='zego-whiteboard'] {\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n  position: absolute;\n}\n[id^='zego-whiteboard'] *,\n[id^='zego-whiteboard'] ::after,\n[id^='zego-whiteboard'] ::before {\n  box-sizing: border-box !important;\n}\n[id^='zego-whiteboard'] [id^='zego-graphics-bg-container'] {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  display: flex;\n}\n[id^='zego-whiteboard'] [id^='zego-graphics-bgImage-container'] {\n  flex: 1;\n}\n[id^='zego-whiteboard'] [id^='zego-graphics-container'] {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  overflow: hidden;\n}\n\n[id^='zego-graphics-container'] [id^='zego-laser'] {\n  transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear;\n  -moz-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear; /* Firefox 4 */\n  -webkit-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear; /* Safari 和 Chrome */\n  -o-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear; /* Opera */\n  -ms-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear;\n  margin-left: -8px;\n  margin-top: -8px;\n}\n\n/* [id^='zego-graphics-container'] path.transition {\n    transition: transform 0.2s linear;\n    -moz-transition: transform 0.2s linear;\n    -webkit-transition: transform 0.2s linear;\n    -o-transition: transform 0.2s linear;\n    -ms-transition: transform 0.2s linear;\n}\n\n[id^='zego-graphics-container'] line.transition {\n    transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -moz-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -webkit-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -o-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -ms-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n}\n\n[id^='zego-graphics-container'] rect.transition {\n    transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -moz-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -webkit-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -o-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -ms-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n}\n\n[id^='zego-graphics-container'] ellipse.transition {\n    transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -moz-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -webkit-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -o-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -ms-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n} */\n\n[id^='zego-whiteboard'] [id^='zego-box-container'] {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  overflow: hidden;\n}\n[id^='zego-whiteboard'] svg {\n  transform-origin: 0px 0px 0px;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  margin: 0px;\n  padding: 0px;\n  left: 0;\n  right: 0;\n  pointer-events: none;\n}\n[id^='zego-whiteboard'] textarea {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  border: none;\n  outline: none;\n  background: transparent;\n  resize: none;\n  position: absolute;\n  top: 0;\n  right: 0;\n  left: 0;\n  bottom: 0;\n  padding: 0;\n  line-height: 1;\n  font-family: inherit;\n  font-size: inherit;\n  box-sizing: border-box;\n  color: inherit;\n  font-style: inherit;\n  font-weight: inherit;\n  white-space: pre-wrap;\n  word-break: break-all;\n  overflow: hidden;\n}\n[id^='zego-whiteboard'] pre {\n  display: block;\n  visibility: hidden;\n  margin: 0px 0px;\n  font-family: inherit;\n  font-size: inherit;\n  color: inherit;\n  font-style: inherit;\n  font-weight: inherit;\n  line-height: 1;\n  padding: 0;\n  overflow: hidden;\n}\n[id^='zego-graphics-box'] {\n  position: absolute;\n}\n[id^='zego-textarea'] {\n  position: absolute;\n  border: 1px dashed transparent;\n  overflow: hidden;\n}\n[id^='zego-other-container'] {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  cursor: none;\n  overflow: hidden;\n}\n[id^='zego-other-container'] div {\n  box-sizing: border-box;\n}\n[id^='zego-laser'] {\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background: rgba(255, 78, 51, 1);\n  border: 2px solid rgba(255, 144, 128, 1);\n  box-shadow: 0px 0px 8px 0px rgba(254, 94, 70, 0.7);\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n[id^='zego-box-container'] .img-editor-box,\n[id^='zego-box-container'] .graphics-box {\n  display: none;\n  position: absolute;\n  overflow: visible;\n  margin: 0;\n  padding: 0;\n  z-index: 2;\n  border: 2px solid #b0b3b8;\n  box-shadow: 0 0 1px 0 #ffffff, inset 0 0 1px 0 #ffffff;\n  transform-origin: 0px 0px 0px;\n  transition: border 0.3s;\n  -moz-transition: border 0.3s; /* Firefox 4 */\n  -webkit-transition: border 0.3s; /* Safari 和 Chrome */\n  -o-transition: border 0.3s; /* Opera */\n}\n\n[id^='zego-box-container'] .operation-point-desktop {\n  width: 12px;\n  height: 12px;\n  position: absolute;\n  background-color: #ffffff;\n  border: 2px solid #b0b3b8;\n}\n[id^='zego-box-container'] .operation-point-desktop:active,\n[id^='zego-box-container'] .operation-point-desktop:hover {\n  transform: scale(1.5);\n  border: 2px solid #eb98c7;\n}\n\n[id^='zego-box-container'] .operation-point-desktop.left-top {\n  left: -6px;\n  top: -6px;\n  cursor: nwse-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right-top {\n  right: -6px;\n  top: -6px;\n  cursor: nesw-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.left-bottom {\n  left: -6px;\n  bottom: -6px;\n  cursor: nesw-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right-bottom {\n  right: -6px;\n  bottom: -6px;\n  cursor: nwse-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.top {\n  top: -6px;\n  cursor: ns-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right {\n  right: -6px;\n  cursor: ew-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.bottom {\n  bottom: -6px;\n  cursor: ns-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.left {\n  left: -6px;\n  cursor: ew-resize;\n}\n",""]),e.exports=t},function(e,t,r){var o=r(5),i=r(344);o({global:!0,forced:parseInt!=i},{parseInt:i})},function(e,t,r){var o=r(7),i=r(21),n=r(241).trim,s=r(242),a=o.parseInt,c=/^[+-]?0[Xx]/,d=8!==a(s+"08")||22!==a(s+"0x16");e.exports=d?function(e,t){var r=n(i(e));return a(r,t>>>0||(c.test(r)?16:10))}:a},function(e,t,r){var o=r(5),i=r(346);o({global:!0,forced:parseFloat!=i},{parseFloat:i})},function(e,t,r){var o=r(7),i=r(21),n=r(241).trim,s=r(242),a=o.parseFloat,c=1/a(s+"-0")!=-1/0;e.exports=c?function(e){var t=n(i(e)),r=a(t);return 0===r&&"-"==t.charAt(0)?-0:r}:a},function(e,t,r){"use strict";var o=r(5),i=r(239).start;o({target:"String",proto:!0,forced:r(348)},{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var o=r(46);e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(o)},function(e,t,r){"use strict";var o=t;function i(){o.util._configure(),o.Writer._configure(o.BufferWriter),o.Reader._configure(o.BufferReader)}o.build="minimal",o.Writer=r(329),o.BufferWriter=r(358),o.Reader=r(330),o.BufferReader=r(359),o.util=r(157),o.rpc=r(360),o.roots=r(362),o.configure=i,i()},function(e,t,r){"use strict";e.exports=function(e,t){var r=new Array(arguments.length-1),o=0,i=2,n=!0;for(;i<arguments.length;)r[o++]=arguments[i++];return new Promise((function(i,s){r[o]=function(e){if(n)if(n=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){n&&(n=!1,s(e))}}))}},function(e,t,r){"use strict";var o=t;o.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=new Array(64),n=new Array(123),s=0;s<64;)n[i[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;o.encode=function(e,t,r){for(var o,n=null,s=[],a=0,c=0;t<r;){var d=e[t++];switch(c){case 0:s[a++]=i[d>>2],o=(3&d)<<4,c=1;break;case 1:s[a++]=i[o|d>>4],o=(15&d)<<2,c=2;break;case 2:s[a++]=i[o|d>>6],s[a++]=i[63&d],c=0}a>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=i[o],s[a++]=61,1===c&&(s[a++]=61)),n?(a&&n.push(String.fromCharCode.apply(String,s.slice(0,a))),n.join("")):String.fromCharCode.apply(String,s.slice(0,a))};o.decode=function(e,t,r){for(var o,i=r,s=0,a=0;a<e.length;){var c=e.charCodeAt(a++);if(61===c&&s>1)break;if(void 0===(c=n[c]))throw Error("invalid encoding");switch(s){case 0:o=c,s=1;break;case 1:t[r++]=o<<2|(48&c)>>4,o=c,s=2;break;case 2:t[r++]=(15&o)<<4|(60&c)>>2,o=c,s=3;break;case 3:t[r++]=(3&o)<<6|c,s=0}}if(1===s)throw Error("invalid encoding");return r-i},o.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,r){"use strict";function o(){this._listeners={}}e.exports=o,o.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},o.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],o=0;o<r.length;)r[o].fn===t?r.splice(o,1):++o;return this},o.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],o=1;o<arguments.length;)r.push(arguments[o++]);for(o=0;o<t.length;)t[o].fn.apply(t[o++].ctx,r)}return this}},function(e,t,r){"use strict";function o(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),o=128===r[3];function i(e,o,i){t[0]=e,o[i]=r[0],o[i+1]=r[1],o[i+2]=r[2],o[i+3]=r[3]}function n(e,o,i){t[0]=e,o[i]=r[3],o[i+1]=r[2],o[i+2]=r[1],o[i+3]=r[0]}function s(e,o){return r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],t[0]}function a(e,o){return r[3]=e[o],r[2]=e[o+1],r[1]=e[o+2],r[0]=e[o+3],t[0]}e.writeFloatLE=o?i:n,e.writeFloatBE=o?n:i,e.readFloatLE=o?s:a,e.readFloatBE=o?a:s}():function(){function t(e,t,r,o){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,o);else if(isNaN(t))e(2143289344,r,o);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,o);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,o);else{var n=Math.floor(Math.log(t)/Math.LN2);e((i<<31|n+127<<23|8388607&Math.round(t*Math.pow(2,-n)*8388608))>>>0,r,o)}}function r(e,t,r){var o=e(t,r),i=2*(o>>31)+1,n=o>>>23&255,s=8388607&o;return 255===n?s?NaN:i*(1/0):0===n?1401298464324817e-60*i*s:i*Math.pow(2,n-150)*(s+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,n),e.readFloatLE=r.bind(null,s),e.readFloatBE=r.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),o=128===r[7];function i(e,o,i){t[0]=e,o[i]=r[0],o[i+1]=r[1],o[i+2]=r[2],o[i+3]=r[3],o[i+4]=r[4],o[i+5]=r[5],o[i+6]=r[6],o[i+7]=r[7]}function n(e,o,i){t[0]=e,o[i]=r[7],o[i+1]=r[6],o[i+2]=r[5],o[i+3]=r[4],o[i+4]=r[3],o[i+5]=r[2],o[i+6]=r[1],o[i+7]=r[0]}function s(e,o){return r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],r[4]=e[o+4],r[5]=e[o+5],r[6]=e[o+6],r[7]=e[o+7],t[0]}function a(e,o){return r[7]=e[o],r[6]=e[o+1],r[5]=e[o+2],r[4]=e[o+3],r[3]=e[o+4],r[2]=e[o+5],r[1]=e[o+6],r[0]=e[o+7],t[0]}e.writeDoubleLE=o?i:n,e.writeDoubleBE=o?n:i,e.readDoubleLE=o?s:a,e.readDoubleBE=o?a:s}():function(){function t(e,t,r,o,i,n){var s=o<0?1:0;if(s&&(o=-o),0===o)e(0,i,n+t),e(1/o>0?0:2147483648,i,n+r);else if(isNaN(o))e(0,i,n+t),e(2146959360,i,n+r);else if(o>17976931348623157e292)e(0,i,n+t),e((s<<31|2146435072)>>>0,i,n+r);else{var a;if(o<22250738585072014e-324)e((a=o/5e-324)>>>0,i,n+t),e((s<<31|a/4294967296)>>>0,i,n+r);else{var c=Math.floor(Math.log(o)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=o*Math.pow(2,-c))>>>0,i,n+t),e((s<<31|c+1023<<20|1048576*a&1048575)>>>0,i,n+r)}}}function r(e,t,r,o,i){var n=e(o,i+t),s=e(o,i+r),a=2*(s>>31)+1,c=s>>>20&2047,d=4294967296*(1048575&s)+n;return 2047===c?d?NaN:a*(1/0):0===c?5e-324*a*d:a*Math.pow(2,c-1075)*(d+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=r.bind(null,s,0,4),e.readDoubleBE=r.bind(null,a,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function n(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=o(o)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,r){"use strict";var o=t;o.length=function(e){for(var t=0,r=0,o=0;o<e.length;++o)(r=e.charCodeAt(o))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(o+1))?(++o,t+=4):t+=3;return t},o.read=function(e,t,r){if(r-t<1)return"";for(var o,i=null,n=[],s=0;t<r;)(o=e[t++])<128?n[s++]=o:o>191&&o<224?n[s++]=(31&o)<<6|63&e[t++]:o>239&&o<365?(o=((7&o)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,n[s++]=55296+(o>>10),n[s++]=56320+(1023&o)):n[s++]=(15&o)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,n)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,n.slice(0,s))),i.join("")):String.fromCharCode.apply(String,n.slice(0,s))},o.write=function(e,t,r){for(var o,i,n=r,s=0;s<e.length;++s)(o=e.charCodeAt(s))<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=63&o|128):55296==(64512&o)&&56320==(64512&(i=e.charCodeAt(s+1)))?(o=65536+((1023&o)<<10)+(1023&i),++s,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=63&o|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=63&o|128);return r-n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var o=r||8192,i=o>>>1,n=null,s=o;return function(r){if(r<1||r>i)return e(r);s+r>o&&(n=e(o),s=0);var a=t.call(n,s,s+=r);return 7&s&&(s=1+(7|s)),a}}},function(e,t,r){"use strict";e.exports=i;var o=r(157);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var n=i.zero=new i(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var s=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return n;var t=e<0;t&&(e=-e);var r=e>>>0,o=(e-r)/4294967296>>>0;return t&&(o=~o>>>0,r=~r>>>0,++r>4294967295&&(r=0,++o>4294967295&&(o=0))),new i(r,o)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(o.isString(e)){if(!o.Long)return i.fromNumber(parseInt(e,10));e=o.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):n},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return o.Long?new o.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===s?n:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},function(e,t,r){"use strict";e.exports=n;var o=r(329);(n.prototype=Object.create(o.prototype)).constructor=n;var i=r(157);function n(){o.call(this)}function s(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}n._configure=function(){n.alloc=i._Buffer_allocUnsafe,n.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var o=0;o<e.length;)t[r++]=e[o++]}},n.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(n.writeBytesBuffer,t,e),this},n.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(s,t,e),this},n._configure()},function(e,t,r){"use strict";e.exports=n;var o=r(330);(n.prototype=Object.create(o.prototype)).constructor=n;var i=r(157);function n(e){o.call(this,e)}n._configure=function(){i.Buffer&&(n.prototype._slice=i.Buffer.prototype.slice)},n.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},n._configure()},function(e,t,r){"use strict";t.Service=r(361)},function(e,t,r){"use strict";e.exports=i;var o=r(157);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");o.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(i.prototype=Object.create(o.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,n,s){if(!n)throw TypeError("request must be specified");var a=this;if(!s)return o.asPromise(e,a,t,r,i,n);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](n).finish(),(function(e,r){if(e)return a.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof i))try{r=i[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",r,t),s(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,r){"use strict";e.exports={}},,function(e,t,r){var o;"undefined"!=typeof self&&self,e.exports=(o=r(371),function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=38)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=t.ZegoDataReport=t.ZegoLogger=t.ZegoExpressWebRTMEngine=t.getReportSeq=t.getSeq=t.QUALITY_CONSTANT=t.QualityGrade=t.REPORT_ACTION=t.ENUM_RETRY_STATE=t.ENUM_PLAY_STATE_UPDATE=t.ENUM_PUBLISH_STATE_UPDATE=t.LinkedList=t.ListNode=t.E_CLIENT_TYPE=t.ENUM_SOURCE_TYPE=t.ENUM_DISPATCH_TYPE=t.ENUM_BROADCASTER_STATUS=t.ENUM_PLAY_SOURCE_TYPE=t.ENUM_PUBLISH_STATE_NEGO=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.QUALITYLEVEL=t.MIXSTREAM_ERROR_CODE=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD_PRI=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.STREAM_DELETE_REASON=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.ENUM_STREAM_UPDATE_TYPE=t.ENUM_STREAM_CMD_PRI=t.ENUM_STREAM_SUB_CMD=t.ENUM_PUBLISH_STREAM_STATE=t.MAX_RETRY_CONNECT_INTERVAL=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_PROBE_STATE=t.ENUM_PLAY_STATE_NEGO=t.ENUM_PLAYER_STATE=t.ENUM_PLAY_STATE=t.ENUM_PUBLISH_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.sdkErrorList=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.PROTO_VERSION="2.10.1",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.sdkErrorList={CLIENT:"Client.",SERVER:"Server.",SUCCESS:{code:"Success",msg:"success."},PARAM:{code:"Error.Param",msg:"input error."},HEARTBEAT_TIMEOUT:{code:"Error.Timeout",msg:"heartbeat timeout."},LOGIN_TIMEOUT:{code:"Error.Timeout",msg:"login timeout."},SEND_MSG_TIMEOUT:{code:"Error.Timeout",msg:"send customsg timeout."},RESET_QUEUE:{code:"Error.Timeout",msg:"msg waiting ack is clear when reset."},LOGIN_DISCONNECT:{code:"Error.Network",msg:"network is broken and login fail."},KICK_OUT:{code:"Error.Kickout",msg:"kickout reason="},UNKNOWN:{code:"Error.Unknown",msg:"unknown error."},FREQ_LIMITED:{code:"Error.requencyLimited",msg:"Frequency Limited."}},t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1500},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},t.ENUM_PLAYER_STATE={start:0,playing:1,stop:2},t.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},t.ENUM_PROBE_STATE={tryProbe:0,probed:2},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=3,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,t.MAX_RETRY_CONNECT_INTERVAL=12,t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},t.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.STREAM_DELETE_REASON={0:{code:1,description:"user_stop_publishing_stream_normal"},1:{code:2,description:"user_heart_beat_timeout"},2:{code:3,description:"user_repeat_login"},3:{code:4,description:"user_kicked_out"},4:{code:5,description:"user_offline"},100:{code:6,description:"remove_by_server"}},t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.ENUM_STREAM_UPDATE_CMD_PRI={added:1,updated:2,deleted:3},t.SERVER_ERROR_CODE=1e4,t.MIXSTREAM_ERROR_CODE=1e4,function(e){e[e.low=1]="low",e[e.stantard=2]="stantard",e[e.hight=3]="hight",e[e.custome=4]="custome"}(t.QUALITYLEVEL||(t.QUALITYLEVEL={})),t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra"}(t.ENUM_PLAY_SOURCE_TYPE||(t.ENUM_PLAY_SOURCE_TYPE={})),function(e){e[e.stop=0]="stop",e[e.start=1]="start"}(t.ENUM_BROADCASTER_STATUS||(t.ENUM_BROADCASTER_STATUS={})),function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra",e[e.customUrl=2]="customUrl"}(t.ENUM_DISPATCH_TYPE||(t.ENUM_DISPATCH_TYPE={})),function(e){e[e.CDN=0]="CDN",e[e.BGP=1]="BGP"}(t.ENUM_SOURCE_TYPE||(t.ENUM_SOURCE_TYPE={})),function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}));var o=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=o;var i=function(){function e(){this.start=new o,this.end=new o,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new o(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=i,t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},function(e){e[e.Unknown=-1]="Unknown",e[e.Excellent=0]="Excellent",e[e.Good=1]="Good",e[e.Middle=2]="Middle",e[e.Poor=3]="Poor",e[e.Die=4]="Die"}(t.QualityGrade||(t.QualityGrade={})),function(e){e[e.MinQuality=0]="MinQuality",e[e.DieQuality=0]="DieQuality",e[e.PoorMinQuality=1]="PoorMinQuality",e[e.MiddleMinQuality=30]="MiddleMinQuality",e[e.GoodMinQuality=60]="GoodMinQuality",e[e.ExcellentMinQuality=85]="ExcellentMinQuality",e[e.MaxQuality=100]="MaxQuality"}(t.QUALITY_CONSTANT||(t.QUALITY_CONSTANT={}));var n=r(7);Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return n.getSeq}}),Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return n.getReportSeq}}),Object.defineProperty(t,"ZegoExpressWebRTMEngine",{enumerable:!0,get:function(){return n.ZegoExpressWebRTMEngine}}),Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return n.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return n.ZegoDataReport}}),Object.defineProperty(t,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return n.ZegoExpressWebRTM}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWechatLogEvent=t.ZegoRTCLogEvent=void 0;var o=r(4),i=function(e){return e};t.ZegoRTCLogEvent={kZegoTaskCreateStream:{event:"/sdk/create_stream",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kParamError:o.errorCodeList.PUBLISHER_PARAM,kScreenCancelError:o.errorCodeList.PUBLISH_SCREEN_CANCELED,kScreenFailedError:o.errorCodeList.PUBLISHER_SCREEN_FAILED,kScreenNotSupportError:o.errorCodeList.PUBLISH_SCREEN_NOT_SUPPORT,kHttpsRequiredError:o.errorCodeList.PUBLISHER_HTTPS_REQUIRED,kGetUserMediaError:o.errorCodeList.PUBLISHER_GET_USER_MEDIA_FAIL},stream_type:i,screen:i,camera:i,custom:i},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoPreviewError:o.errorCodeList.PUBLISH_NO_PREVIEW,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kMediaServerForbidError:o.errorCodeList.PUBLISHER_MEDIA_SERVER_FORBID,kPublishSessionClosedError:o.errorCodeList.PUBLISHER_SESSION_CLOSED,kPublishNegoTimeoutError:o.errorCodeList.PUBLISHER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PUBLISHER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PUBLISHER_SET_LOCAL_DESC_ERROR,kSessionTimeoutError:o.errorCodeList.PUBLISHER_SESSION_TIMEOUT,kSessionRequestError:o.errorCodeList.PUBLISHER_SESSION_REQUEST_FAIL,kSetRemoteDescError:o.errorCodeList.PUBLISHER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PUBLISHER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PUBLISHER_WEBSOCKET_DISCONNECTED,kMediaDescError:o.errorCodeList.PUBLISHER_MEDIA_DESC_ERROR,kCandidateError:o.errorCodeList.PUBLISHER_CANDIDATE_ERROR,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING,kClientIPChangedError:o.errorCodeList.PUBLISHER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PUBLISHER_TTL_OVERTIME},publishOption:i,message:i,session_id:i,stream:i,video_en_codec_id:i,cap_w:i,cap_h:i,w:i,h:i,video_en_fps:i,video_en_bps:i,audio_c_channel_count:i,audio_en_bps:i,aec_level:i,ans_level:i,agc:i,traffic_control_min_video_bitrate:i},kZegoTaskVideoCaptureSize:{event:"/sdk/api/publish_video_c_size",session_id:i,w:i,h:i},kZegoTaskVideoPlaySize:{event:"/sdk/play_video_size_changed",session_id:i,w:i,h:i},kZegoTaskRePublish:{event:"/sdk/republish",stream:i},kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:i},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDToLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayUnsupportedResourceMode:o.errorCodeList.PLAYER_UNSUPPORTED_PROTOCOL,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kPlaySessionClosedError:o.errorCodeList.PLAYER_SESSION_CLOSED,kPlaySessionResetError:o.errorCodeList.PLAYER_SESSION_RESET,kPlayNegoTimeoutError:o.errorCodeList.PLAYER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PLAYER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PLAYER_SET_LOCAL_DESC_ERROR,kSessionRequestError:o.errorCodeList.PLAYER_SESSION_REQUEST_FAIL,kSessionTimeoutError:o.errorCodeList.PLAYER_SESSION_TIMEOUT,kSetRemoteDescError:o.errorCodeList.PLAYER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PLAYER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PLAYER_WEBSOCKET_DISCONNECTED,kCandidateError:o.errorCodeList.PLAYER_CANDIDATE_ERROR,kMediaDescError:o.errorCodeList.PLAYER_MEDIA_DESC_ERROR,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING,kClientIPChangedError:o.errorCodeList.PLAYER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PLAYER_TTL_OVERTIME,kProbeTimeOutError:o.errorCodeList.PLAYER_PROBE_TIMEOUT},playOption:i,message:i,session_id:i,stream:i,audio_activate:i,video_activate:i},kZegoTaskRePlay:{event:"/sdk/replay",stream:i},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:i},kZegoPlayContentChanged:{event:"/sdk/play_content_changed",session_id:i,video_activate:i,audio_activate:i},kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:o.errorCodeList.NOT_LOGIN},mix_stream_id:i,stream_cnt:i,input_stream_list:i,output_target_list:i},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:o.errorCodeList.NOT_LOGIN}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID,kNoLoginError:o.errorCodeList.NOT_LOGIN},config:i},kZegoTaskEnumDevices:{event:"/device/list",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},dev_list:i},kZegoTaskAudioOutput:{event:"/device/audio_capture",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:i,device:i},kZegoTaskVideoCapture:{event:"/device/video_capture",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:i,device:i},kZegoTaskDeviceInterrupt:{event:"/device/interrupt",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:i,interrupt:i},kZegoTaskSetDebug:"/sdk/set_debug",kZegoTaskSetLog:"/sdk/set_log_config",kZegoTaskUseVideoDevice:{event:"/device/api/video_c",error:{kParamError:o.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:o.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG},device:i},kZegoTaskUseAudioDevice:{event:"/device/api/audio_c",error:{kParamError:o.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:o.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG},device:i},kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",capability:i},kZegoTaskMutePublishVideo:"/sdk/mute_publish_video",kZegoTaskMutePublishAudio:"/sdk/mute_publish_audio",kZegoTaskMuteMicrophone:"/sdk/mute_microphone",kZegoTaskMutePlayVideo:"/sdk/mute_play_video",kZegoTaskMutePlayAudio:"/sdk/mute_play_audio",kZegoTaskRemoteCameraUpdate:{event:"/sdk/remote_camera_update",stream:i,status:i},kZegoTaskRemoteMicUpdate:{event:"/sdk/remote_mic_update",stream:i,status:i},kZegoTaskGetSoundLevel:{event:"/sdk/get_sound_level",error:{kGetSoundLevelError:o.errorCodeList.GET_SOUND_LEVEL_FAIL}},kZegoTaskStopSoundLevel:"/sdk/stop_sound_level",kZegoTaskAddPublishCdnUrl:{event:"/sdk/add_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskRemovePublishCdnUrl:{event:"/sdk/remove_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM},stream:i,target_url:i},kZegoTaskClearPublishCdnUrl:{event:"/sdk/clear_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskPublishTarget:{event:"/sdk/publish_target",error:{kParamError:o.errorCodeList.INPUT_PARAM,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kNoLoginError:o.errorCodeList.NOT_LOGIN,kNoResponseError:o.errorCodeList.PUBLISH_TARGET_NO_RESPONSE,kBizChannelError:o.errorCodeList.BIZ_CHANNEL_ERROR,kInvalidChannelError:o.errorCodeList.INVALID_CHANNEL,kUnknownServerError:o.errorCodeList.UNKNOWN_SERVER_ERROR}},kZegoTaskDestroyStream:{event:"/sdk/destroy_stream",error:{kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoTaskScreenSharingEnded:"/sdk/screen_share_end",kZegoTaskAudioOutputChanged:{event:"/device/api/audio_output",session_id:i,stream:i,device:i,reason:i},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoSetAudioConfig:{event:"/sdk/set_audio_config",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoSetVideoConfig:{event:"/sdk/set_video_config",error:{kParamError:o.errorCodeList.INPUT_PARAM,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoReplaceTrack:{event:"/sdk/replace_track",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:i,update_stream:i},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:i},kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:o.errorCodeList.INPUT_PARAM,kExtraInfoNullError:o.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kUpdateStreamInfoFailError:o.errorCodeList.PUBLISHER_UPDATE_STREAM_INFO_FAIL},stream:i,stream_extra_info:i,room_sid:i},kZegoTaskPlayDecodeFirstVideoFrame:{event:"/sdk/play_decode_first_video_frame",session_id:i,fft_consumed:i},kZegoVisibilityChange:{event:"/app/background"},kZegoSetCaptureVolume:{event:"/sdk/set_capture_volume",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoListener:{event:"/sdk/listener"},kZegoNetProbe:{event:"/sdk/net_probe"},kZegoNetProbeResult:{event:"/sdk/net_probe_result"}},t.ZegoWechatLogEvent={kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",error:{kCheckSystemGetSettingFailError:o.errorCodeList.WX_GET_SETTING_FAIL},capability:i},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPublishStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING},publishOption:i,stream:i,message:i},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kPlayStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING},playOption:i,message:i,session_id:i,stream:i,audio_activate:i,video_activate:i},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskRePublish:"/sdk/republish",kZegoTaskRePlay:"/sdk/replay",kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:i},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:i},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:i,update_stream:i},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:i},kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR},mix_stream_id:i,stream_cnt:i,input_stream_list:i,output_target_list:i},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID},config:i},kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:o.errorCodeList.INPUT_PARAM,kExtraInfoNullError:o.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kUpdateStreamInfoFailError:o.errorCodeList.PUBLISHER_UPDATE_STREAM_INFO_FAIL},stream:i,stream_extra_info:i,room_sid:i}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_WECHATMINI_ACTION=t.ZEGO_WEBRTC_ACTION=void 0,function(e){e.CONSTRUCTOR="zc.0",e.CHECK_SUPPORT="zc.csr",e.CREATE_STREAM="zc.cs",e.DESTROY_STREAM="zc.ds",e.START_PUBLISHING_STREAM="zc.sps.0",e.START_PLAYING_STREAM="zc.sps.1",e.STOP_PUBLISHING_STREAM="zc.sps.0.0",e.STOP_PLAYING_STREAM="zc.sps.1.0",e.ON_STREAM="zc.os",e.ON_PUSH_STREAM_UPDATE="zc.opsu",e.ACTIVATE_SEI_INSERT="zc.asi",e.BIND_WINDOW_LISTENER="zc.wl",e.MUTE_PUBLISH_STREAM_VIDEO="zc.mpsv.0",e.MUTE_PUBLISH_STREAM_AUDIO="zc.mpsa.0",e.MUTE_MIC="zc.mm",e.MUTE_PLAY_STREAM_VIDEO="zc.mpsv.1",e.MUTE_PLAY_STREAM_AUDIO="zc.mpsa.1",e.SET_AUDIO_OUTPUT="zc.sao",e.SET_CUSTOM_SIGNAL_URL="zc.scsu",e.SET_TURN_OVER_TCP_ONLY="zc.stoto",e.SET_VIDEO_CONFIG="zc.svc",e.SET_AUDIO_CONFIG="zc.sac",e.REPLACE_TRACK="zc.rp",e.PRELOAD_EFFECT="zc.pe.0",e.PLAY_EFFECT="zc.pe.1",e.PAUSE_EFFECT="zc.pe.2",e.RESUME_EFFECT="zc.re",e.STOP_EFFECT="zc.se",e.UNLOAD_EFFECT="zc.ue",e.SET_EFFECT_VOLUME="zc.sev",e.START_MIXING_AUDIO="zc.sma.0",e.STOP_MIXING_AUDIO="zc.sma.1",e.MIXING_BUFFER="zc.mb",e.STOP_MIXING_BUFFER="zc.smb",e.SET_MIXING_AUDIO_VOLUME="zc.smav",e.ENABLE_STREAM="zc.es",e.ENABLE_MIC_ONLY="zc.emo",e.RDH_ACTIVE="zc.rdh.a",e.RDH_MAX_TIME="zc.rdh.m",e.RDH_WEBRTC_URL_RSP="zc.rdh.hfwur",e.PUBLISH_STATE_HANDLE="zc.psh.0",e.PLAY_STATE_HANDLE="zc.psh.1",e.STATECENTER_ACTION_LISTENER="zc.sc.al",e.SIGNAL_SET_SESSION_INFO="zc.s.ssi",e.SIGNAL_RESET_CONNECT_TIMER="zc.s.rct",e.SIGNAL_BIND_WEBSOCKET_HANDLE="zc.s.bwh",e.SIGNAL_RESET_CHECK_MESSAGE="zc.s.rcm",e.SIGNAL_UPDATE_TOKEN="zc.s.ut",e.SIGNAL_SEND_MESSAGE_WITH_CALLBACK="zc.s.smwc",e.SIGNAL_CONNECT_SERVER="zc.s.cs.0",e.SIGNAL_START_CONNECT_TIMER="zc.s.sct",e.SIGNAL_DISCONNECT_SERVER="zc.s.dc",e.SIGNAL_CREATE_SESSION="zc.s.cs.1",e.SIGNAL_REMOVE_SESSION="zc.s.rs",e.SIGNAL_SEND_REMOVE_SESSION="zc.s.srs",e.SIGNAL_SEND_MESSAGE="zc.s.sm",e.SIGNAL_HANDLE_RESPOND_DATA="zc.s.hrd",e.SIGNAL_ADD_SESSION="zc.s.as",e.SIGNAL_HANDLE_PUSH_DATA="zc.s.hpd",e.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA="zc.s.hprsd",e.SIGNAL_SEND_MEDIA_DESC="zc.s.smd",e.SIGNAL_SEND_CANDIDATE_INFO="zc.s.sci",e.SIGNAL_SEND_MEDIA_DESC_ACK="zc.s.smda",e.SIGNAL_SEND_CANDIDATE_INFO_ACK="zc.s.scia",e.SIGNAL_SEND_CLOSE_SESSION_ACK="zc.s.scsa",e.SIGNAL_SEND_RESET_SESSION_ACK="zc.s.srsa",e.SIGNAL_REGISTER_PUSH_CALLBACK="zc.s.rpc",e.SIGNAL_CHECK_MESSAGE_TIMEOUT="zc.s.cmt",e.SIGNAL_SEND_HEARTBEAT="zc.s.sh",e.SIGNAL_QUALITY_REPORT="zc.s.qr",e.SIGNAL_SEND_STREAM_STATUS="zc.s.sss",e.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM="zc.s.apvs",e.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM="zc.s.apas",e.SIGNAL_SEND_BROADCAST_STATUS="zc.s.sbs",e.SIGNAL_SEND_NET_PROBE="zc.s.snp",e.SIGNAL_SEND_NET_QUALITY_INFO_PUSH_ACK="zc.s.npa",e.PUBLISHER_START_PUBLISH="zc.p.0.sp.0",e.PUBLISHER_PUBLISH_SUCCESS="zc.p.ps",e.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS="zc.p.0.ocpss",e.PUBLISHER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.0.hcsws",e.PUBLISHER_ON_CREATE_OFFER_SUCCESS="zc.p.0.ocos",e.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.0.oslds",e.PUBLISHER_ON_GET_REMOTE_DESCRIPTION="zc.p.0.ogrd",e.PUBLISHER_ON_RECV_MEDIA_DESC="zc.p.0.ormd",e.PUBLISHER_ON_RECV_CANDIDATE_INFO="zc.p.0.orci.0",e.PUBLISHER_ON_RECV_PUBLISH_EVENT="zc.p.0.orpe",e.PUBLISHER_ON_RECV_CLIENT_INFO="zc.p.0.orci.1",e.PUBLISHER_ON_ICE_CANDIDATE="zc.p.0.oic",e.PUBLISHER_ON_CONNECTION_STATE_CHANGE="zc.p.0.ocsc",e.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.0.oicsc",e.PUBLISHER_RESET_PUBLISH="zc.p.0.rp",e.PUBLISHER_SET_PLAYER_QUALITY_TIMER="zc.p.0.spqt",e.PUBLISHER_UPLOAD_PUBLISH_QUALITY="zc.p.0.upq",e.PUBLISHER_ON_RECV_RESET_SESSION="zc.p.0.orrs",e.PUBLISHER_ON_RECV_CLOSE_SESSION="zc.p.0.orcs",e.PUBLISHER_SEND_CANDIDATE_INFO="zc.p.0.sci",e.PUBLISHER_STATE_ERROR="zc.p.0.psr",e.PUBLISHER_STOP_PUBLISH="zc.p.0.sp.1",e.PUBLISHER_ON_DISCONNECT="zc.p.0.od",e.PUBLISHER_START_SOUND_LEVEL="zc.p.0.ssl.0",e.PUBLISHER_STOP_SOUND_LEVEL="zc.p.0.ssl.1",e.PUBLISHER_PLAY_EFFECT="zc.p.0.pe.0",e.PUBLISHER_PAUSE_EFFECT="zc.p.0.pe.1",e.PUBLISHER_RESUME_EFFECT="zc.p.0.re",e.PUBLISHER_STOP_EFFECT="zc.p.0.se",e.PUBLISHER_START_MIXING_AUDIO="zc.p.0.sma.0",e.PUBLISHER_STOP_MIXING_AUDIO="zc.p.0.sma.1",e.PUBLISHER_MIXING_BUFFER="zc.p.0.mb",e.PUBLISHER_SET_MIXING_AUDIO_VOLUME="zc.p.0.smav",e.PUBLISHER_HANDLE_ENC_BITRATE="zc.p.0.heb",e.PUBLISHER_ON_RECV_NET_QUALITY_INFO="zc.p.0.nqi",e.PLAYER_START_PLAY="zc.p.1.sp.0",e.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS="zc.p.ocpss.1",e.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.hcsws.1",e.PLAYER_ON_CREATE_OFFER_SUCCESS="zc.p.ocos.1",e.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.oslds.1",e.PLAYER_ON_RECV_MEDIA_DESC="zc.p.ormd.1",e.PLAYER_ON_RECV_CANDIDATE_INFO="zc.p.orci.1",e.PLAYER_ON_RECV_PLAY_EVENT="zc.p.orpe.1",e.PLAYER_ON_RECV_CLIENT_INFO="zc.p.orci.1.1",e.PLAYER_ON_ICE_CANDIDATE="zc.p.oic.1",e.PLAYER_ON_CONNECTION_STATE_CHANGE="zc.p.ocsc.1",e.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.oicsc.1",e.PLAYER_RESET_PLAY="zc.p.rp.1",e.PLAYER_SET_PLAYER_QUALITY_TIMER="zc.p.spqt.1",e.PLAYER_UPLOAD_PLAYER_QUALITY="zc.p.upq.1",e.PLAYER_ON_RECV_RESET_SESSION="zc.p.orrs.1",e.PLAYER_ON_RECV_CLOSE_SESSION="zc.p.orcs.1",e.PLAYER_ON_RECV_STREAM_STATUS="zc.p.orss.1",e.PLAYER_ON_GOT_REMOTE_STREAM="zc.p.ogrs.1",e.PLAYER_SEND_CANDIDATE_INFO="zc.p.sci.1",e.PLAYER_STATE_ERROR="zc.p.psr.1",e.PLAYER_STOP_PLAY="zc.p.1.sp.1",e.PLAYER_ON_DISCONNECT="zc.p.od.1",e.PLAYER_START_SOUND_LEVEL="zc.p.ssl.1",e.PLAYER_STOP_SOUND_LEVEL="zc.p.ssl.1.1",e.PLAYER_ON_RECV_NET_QUALITY_INFO="zc.p.1.nqi",e.PUBLISH_SET_CAPTURE_VOLUME="zc.p.scv",e.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ="zc.sh.msbss",e.STREAMHANDLER_MERGE_STREAM="zc.sh.ms",e.STREAMHANDLER_PATCH_STREAM_LIST="zc.sh.psl"}(t.ZEGO_WEBRTC_ACTION||(t.ZEGO_WEBRTC_ACTION={})),function(e){e.ADD_PUBLISH_CDN_URL="zw.apcu",e.REMOVE_PUBLISH_CDN_URL="zw.rpcu",e.STOP_MIXER_TASK="zw.smt",e.ON_STREAM="zw.os",e.ON_PUSH_STREAM_UPDATE="zw.opsu",e.ON_PUBLISH_STATE_UPDATE="zw.w.opsu",e.ON_PUBLISH_STATE_UPDATE_HANDLE="zw.w.opsuh",e.WECHATMINI_SETPREFERPLAYSOURCETYPE="zw.w.sppst.1",e.WECHATMINI_BIND_LISTENER="zw.w.bl",e.WECHATMINI_DELETE_LISTENER="zw.w.dl",e.WECHATMINI_UPDATE_PLAYER_STATE="zw.w.ups",e.WECHATMINI_UPDATE_PLAYER_NET_STATUS="zw.w.upns",e.WECHATMINI_SET_CUSTOM_SIGNAL_URL="zw.w.scsu",e.WECHATMINI_GET_NEXT_URL="zw.w.gnu",e.WECHATMINI_BIND_STREAM_CENTER_HANDLER="zw.w.bsch",e.WECHATMINI_BIND_RTM_LISTENER="zw.w.brl",e.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE="zw.pu.sppst.0",e.PUBLISHMODULE_START_PUBLISHING_STREAM="zw.pu.sps.0",e.PUBLISHMODULE_STOP_PUBLISHING_STREAM="zw.pu.sps.0.0",e.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL="zw.pu.fpsu.0",e.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP="zw.pu.hfspur.0",e.PUBLISHMODULE_DO_PUBLISH_STREAM="zw.pu.dps.0",e.PUBLISHMODULE_UPDATE_STREAM_INFO="zw.pu.upi",e.PUBLISHMODULE_HANDLE_STREAM_UPDATE_RSP="zw.pu.hsur",e.PLAYMODULE_START_PLAYING_STREAM="zw.pl.sps.1",e.PLAYMODULE_STOP_PLAYING_STREAM="zw.pl.sps.1.0",e.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN="zw.pl.spsfc",e.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP="zw.pl.spsfb",e.PLAYMODULE_DO_PLAY_STREAM="zw.pl.dps",e.PLAYMODULE_FETCH_PLAY_STREAM_URL="zw.pl.fpsu",e.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP="zw.pl.hfsur",e.STREAMCENTERWECHAT_RESET="zw.scw.r.0",e.STREAMCENTERWECHAT_START_PUBLISHING_STREAM="zw.scw.sps.0",e.STREAMCENTERWECHAT_START_PLAYING_STREAM="zw.scw.sps.1",e.STREAMCENTERWECHAT_START_PLAYER="zw.scw.sp.0",e.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE="zw.scw.opuu.0",e.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE="zw.scw.ups.0",e.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS="zw.scw.upns",e.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE="zw.scw.ups.0.0",e.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE="zw.scw.ups.1.0",e.STREAMCENTERWECHAT_GET_NEXT_URL="zw.scw.gnu",e.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM="zw.scw.sps.0.0",e.STREAMCENTERWECHAT_STOP_PLAYING_STREAM="zw.scw.sps.1.0",e.STREAMCENTERWECHAT_STOP_PLAYER="zw.scw.sp.1",e.STREAMCENTERWECHAT_ON_PLAY_START="zw.scw.ops.0",e.STREAMCENTERWECHAT_ON_PLAY_STOP="zw.scw.ops.1",e.STREAMCENTERWECHAT_ON_PLAY_RETRY="zw.scw.opr",e.PLAYWECHAT_TRY_START_PLAYER="zw.pw.tsp.0",e.PLAYWECHAT_UPDATE_EVENT="zw.pw.ue",e.PLAYWECHAT_GET_PLAY_URL="zw.pw.gpu"}(t.ZEGO_WECHATMINI_ACTION||(t.ZEGO_WECHATMINI_ACTION={}))},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var n=r(0),s=r(1),a=r(14),c=function(){function e(){}return e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){var o,i;t.success&&(o=t.success,r[e+"SuccessCallback"]=o),t.error&&(i=t.error,r[e+"ErrorCallback"]=i)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,o,i){e.registerCallback(t,{success:function(t,i){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];e.dataReportEvent(r,o,t,i,n)}},i)},e.actionLogReportCallback=function(t,r,o,i,n){e.actionSuccessCallback(t,r)&&e.actionSuccessCallback(t,r)(o,i)},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:"};if(0===e)return{code:0,message:""};var r={code:0,message:"liveroom cmd error"};return r.code=e,r.message=e>1e9?t[1e9]+e:t[e]?t[e]+" code:"+e:"unknown error code:"+e,r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return e>1e9&&(r.code=e-1e9+52e6),t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"ROOM_ERROR_AUTHENTICATION_FAILED",2003:"ROOM_ERROR_LOGIN_TIMEOUT"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.mixServerError=function(e){var t={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",190:"MIXER_START_REQUEST_ERROR"},r="MIXER_INNER_ERROR";return e>1e9&&t[e-1e9]&&(r=t[e-1e9]),r},e.getKickoutError=function(e){var t={};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,o,i){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,i[0]);break;case"addEventMsg":e.addEventMsg(t,o,i[0],i[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,i[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeStreamList=function(e,t,r,o){var i,n=[],s=[],a=[];r||(r=[]);for(var c=0;c<r.length;c++)if(r[c].anchor_id_name!=e&&r[c].user_id!=e){i=!1;for(var d=0;d<t.length;d++)if(r[c].stream_id===t[d].stream_id){r[c].extra_info!==t[d].extra_info&&a.push(r[c]),i=!0;break}i||n.push(r[c])}for(var l=0;l<t.length;l++){i=!1;for(var u=0;u<r.length;u++)if(t[l].stream_id===r[u].stream_id){i=!0;break}i||s.push(t[l])}for(t.splice(0),c=0;c<r.length;c++)t.push(r[c]);o(n,s,a)},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.uuid=function(e,t){var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||o.length,e)for(r=0;r<e;r++)i[r]=o[0|Math.random()*t];else{var n=void 0;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=o[19==r?3&n|8:n])}return i.join("")},e.supportDetection=function(e,t,r,n){return o(this,void 0,void 0,(function(){var o,s,a,c,d,l,u,h;return i(this,(function(i){switch(i.label){case 0:return o={webRTC:!1,customCapture:!1,camera:!1,microphone:!1,videoCodec:{H264:!1,H265:!1,VP8:!1,VP9:!1},screenSharing:e,errInfo:{}},n&&"screenSharing"===n?(t({result:e,errInfo:o.errInfo}),[2]):n&&"customCapture"!==n||(((s=document.createElement("video")).captureStream||s.mozCaptureStream)&&(o.customCapture=!0),"customCapture"!==n)?(a=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c="https:"!==window.location.protocol&&"file:"!==window.location.protocol&&-1==window.location.hostname.indexOf("127.0.0.1")&&-1==window.location.hostname.indexOf("localhost"),n&&"camera"!==n&&"microphone"!==n?[3,9]:a?c?(o.camera=!1,[3,9]):[3,1]:[3,9]):(t({result:o.customCapture,errInfo:o.errInfo}),[2]);case 1:if(n&&"camera"!==n)return[3,5];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,navigator.mediaDevices.getUserMedia({video:!0})];case 3:return(d=i.sent())&&(o.camera=!0)&&d.getTracks().forEach((function(e){return e.stop()})),[3,5];case 4:return l=i.sent(),o.errInfo.camera={name:l.name,message:l.message},[3,5];case 5:if(n&&"microphone"!==n)return[3,9];i.label=6;case 6:return i.trys.push([6,8,,9]),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 7:return(u=i.sent())&&(o.microphone=!0)&&u.getTracks().forEach((function(e){return e.stop()})),[3,9];case 8:return h=i.sent(),o.errInfo.microphone={name:h.name,message:h.message},[3,9];case 9:return"camera"===n||"microphone"===n?(t({result:o[n],errInfo:o.errInfo}),[2]):(this.supportVideoCodeType((function(e,r){n||(o.videoCodec.H264=e.H264,o.videoCodec.H265=e.H265,o.videoCodec.VP8=e.VP8,o.videoCodec.VP9=e.VP9,o.webRTC=e.webRTC),r&&("string"==typeof r?o.errInfo.extendedDate=r:o.errInfo.webRTC={name:r.name,message:r.message}),t&&t(n?{result:e[n],errInfo:o.errInfo}:o)}),r,n),[2])}}))}))},e.getDevices=function(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){for(var r=[],o=[],i=[],n=0;n<t.length;n++){var s=t[n];"audioinput"===s.kind&&r.push({deviceName:s.label,deviceID:s.deviceId}),"audiooutput"===s.kind&&o.push({deviceName:s.label,deviceID:s.deviceId}),"videoinput"===s.kind&&i.push({deviceName:s.label,deviceID:s.deviceId})}e&&e({microphones:r,speakers:o,cameras:i})})).catch((function(e){t&&t(s.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kEnumDevicesError)})):t&&t(s.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kBrowserNotSupportError)},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var i=parseInt(e[o]),n=parseInt(t[o]);if(i>n)return 1;if(i<n)return-1}return 0},e.isSupportLive=function(e,t){var r=wx.getSystemInfoSync().SDKVersion,o={code:0,msg:""};this.compareVersion(r,"1.7.0")<0&&(o={code:10001,msg:"当前微信版本过低，无法使用相关组件"},e&&e(o)),wx.getSetting({success:function(t){var r=t.authSetting;r["scope.camera"]&&r["scope.record"]||(o={code:10002,msg:"需要摄像头和录音功能的授权"}),e&&e(o)},fail:function(e){t&&t(e)}})},e.supportVideoCodeType=function(e,t,r){return o(this,void 0,void 0,(function(){var o,n,s,c,d,l,u,h,p,f;return i(this,(function(i){switch(i.label){case 0:return o={webRTC:!1,H264:!1,VP8:!1,VP9:!1,H265:!1},r?1!==t||"VP8"!==r&&"H264"!==r?[3,2]:[4,(f=new a.CheckModule).checkSupportByType(r)]:[3,2];case 1:return"boolean"==typeof(n=i.sent())?(o[r]=n,[2,e(o)]):(o[r]=!1,[2,e(o,n)]);case 2:if("webRTC"!==r&&1!==t)return[3,7];i.label=3;case 3:return i.trys.push([3,5,,6]),[4,(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 4:return i.sent(),o.webRTC=!0,[3,6];case 5:return s=i.sent(),e&&e(o,s),[3,6];case 6:if("webRTC"===r)return[2,e(o)];i.label=7;case 7:if(1===t){for(c="",l=[],u=0,h=d=["VP8","H264"];u<h.length;u++)p=h[u],f=new a.CheckModule,l.push(f.checkSupportByType(p));return Promise.all(l).then((function(t){t.forEach((function(e,t){"boolean"==typeof e?o[d[t]]=!0:(o[d[t]]=!1,c=e)})),c?e(o,c):e(o)})),[2]}try{(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){if(o.webRTC=!0,t&&t.sdp){var i=t.sdp.split("\r\n");if(o.H264=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H264/")>-1})),"H264"===r)return e(o);if(o.VP8=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP8/")>-1})),"VP8"===r)return e(o);o.VP9=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP9/")>-1})),o.H265=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H265/")>-1})),e&&e(o)}}))}catch(t){e&&e(o,t)}return[2]}}))}))},e.inlineWorker=function(e){if(Worker&&e){var t=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],r=URL.createObjectURL(new window.Blob([t],{type:"text/javascript"}));return new Worker(r)}return null},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),o=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,n=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":r?"Firefox":o?"Opera":i?"Chrome":n?"Safari":"Unkown"},e.getPublisherStateType=function(e){return 0==e||1==e?0==e?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"},e.getPlayerStateType=function(e){return 0==e||1==e?0==e?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"},e.getSteamUpdateType=function(e){return 0==e?"DELETE":"ADD"},e.checkScreenParams=function(t,r){if("object"==typeof t&&void 0!==t.videoQuality&&!e.checkInteger(t.videoQuality))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number"),!1;if("object"==typeof t&&4===t.videoQuality){if(void 0===t.bitRate)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate is required when videoQuality is 4"),!1;if(!e.checkInteger(t.bitRate))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1;if(t.bitRate>10240)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps"),!1;if(void 0===t.frameRate)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate is required when videoQuality is 4"),!1;if(!e.checkInteger(t.frameRate))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1;if(void 0===t.width)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width is required when videoQuality is 4"),!1;if(!e.checkInteger(t.width))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1;if(void 0===t.height)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height is required when videoQuality is 4"),!1;if(!e.checkInteger(t.height))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1}return!0},e.checkCameraParams=function(t,r){return t.width&&e.checkValidNumber(t.width)?t.height&&e.checkValidNumber(t.height)?t.frameRate&&e.checkValidNumber(t.frameRate)?!(!t.bitRate||!e.checkValidNumber(t.bitRate))||(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1):(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1):(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1):(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1)},e.isParamEmpty=function(e){return null!=e&&""!==e},e.isTypeString=function(e){return"string"==typeof e},e.isTooLong=function(e,t){return!(e.length>=t)},e.isReDispatch=function(e){var t=e.message.match(/action:(\d+)/),r=t?Number(t[1]):NaN;return[s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kTTLOverTimeError,s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kClientIPChangedError,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kTTLOverTimeError,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kClientIPChangedError].includes(e)||[6].includes(r)},e.arrAvg=function(e,t,r){return e.push(t),e.length>r&&e.shift(),e.reduce((function(e,t){return e+t}))/e.length},e.getNetQuality=function(e,t,r){return void 0!==r?.15*this.calcQualityOfJitter(r)+.85*Math.min(this.calcQualityOfRtt(e),this.calcQualityOfLostRate(t,!1)):Math.min(this.calcQualityOfRtt(e),this.calcQualityOfLostRate(t,!0))},e.calcQualityOfRtt=function(e){return e<600?97-Math.pow(.09*e,1.1):18*Math.exp(.002*(600-e))},e.calcQualityOfJitter=function(e){return e<=50?98-Math.pow(e,1.15):n.QUALITY_CONSTANT.PoorMinQuality},e.calcQualityOfLostRate=function(e,t){if(t){var r=e;return r<=55?99-Math.pow(.8*r,1.18):n.QUALITY_CONSTANT.PoorMinQuality}var o=100*e;return o<=40?96-Math.pow(o,1.22):n.QUALITY_CONSTANT.PoorMinQuality},e.quality2QualityGrade=function(e){return n.QualityGrade.Unknown,e>=n.QUALITY_CONSTANT.ExcellentMinQuality?n.QualityGrade.Excellent:e>=n.QUALITY_CONSTANT.GoodMinQuality?n.QualityGrade.Good:e>=n.QUALITY_CONSTANT.MiddleMinQuality?n.QualityGrade.Middle:e>=n.QUALITY_CONSTANT.PoorMinQuality?n.QualityGrade.Poor:n.QualityGrade.Die},e}();t.ClientUtil=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=t.innerErrList=void 0,t.innerErrList={SUCCESS:{code:0,message:""},SEND_MSG_TIMEOUT:{code:"Error.Timeout",message:"send custom message timeout."}},t.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},STREAMID_TOO_LONG:{code:1000014,message:"stream ID is too long"},STREAM_ID_NULL:{code:1000015,message:"streamID is empty"},STREAM_ID_INVALID_CHARACTER:{code:1000016,message:"stream ID contains illegal characters"},NETWORK_BROKEN:{code:1000017,message:"network is broken"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},GET_SOUND_LEVEL_FAIL:{code:1000019,message:"get sound level error"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},UNKNOWN_SERVER_ERROR:{code:1100999,message:"unknown server error"},INIT_SDK_WRONG:{code:1101e3,message:"init sdk wrong"},WX_GET_SETTING_FAIL:{code:1101001,message:"wx get setting fail"},USER_ID_NULL:{code:1002005,message:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,message:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,message:"user ID is too long"},USER_NAME_NULL:{code:1002008,message:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,message:"username is too long"},ROOM_ID_NULL:{code:1002011,message:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,message:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,message:"room ID is too long"},LOGIN_TIMEOUT:{code:1002031,message:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,message:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,message:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,message:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,message:"server has sent a signal to kick out"},ROOM_INNER_ERROR:{code:1002099,message:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,message:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,message:"parse json error."},LOGIN_PROCESSING:{code:1102012,message:"login is processing."},LIVEROOM_REQUEST_ERROR:{code:1102013,message:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,message:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,message:"user login state is wrong."},TOKEN_ERROR:{code:1102016,message:"token error"},DISPATCH_ERROR:{code:1102017,message:"dispatch error"},TOKEN_EXPIRED:{code:1102018,message:"token expired"},SUBCMD_ERROR:{code:1102019,message:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,message:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},DISPATCH_TIMEOUT:{code:1102022,message:"dispatch request timeout"},CONNECT_FAILED:{code:1102023,message:"connect signal fail"},INVALID_CHANNEL:{code:1102024,message:"invalid channel"},PUBLISHER_MEDIA_SERVER_FORBID:{code:1003025,message:"stream is forbided by media server"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,message:"extra info of publishing stream is null"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,message:"stream extra info is too long"},PUBLISHER_PARAM:{code:1103001,message:"input param error"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,message:"browser do not support"},PUBLISHER_DISPATCH_FAIL:{code:1103003,message:"dispatch request error"},PUBLISHER_SCREEN_FAILED:{code:1103010,message:"screen fail"},ENUMERATE_DEVICES_FAIL:{code:1103011,message:"enumerate devices fail"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,message:"dispatch request fail"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,message:"session request fail"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,message:"create offer error"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,message:"setLocalDescription error"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,message:"mediaDesc error"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,message:"other side offer error"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,message:"candidate error"},PUBLISHER_SESSION_CLOSED:{code:1103027,message:"server session closed"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,message:"ice connection error"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,message:"constraint error"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,message:"negotiation timeout"},PUBLISH_NOT_PUBLISH:{code:1103040,message:"publisher not found"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,message:"device change "},PUBLISH_SCREEN_CANCELED:{code:1103042,message:"screen canceled"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,message:"screen not support"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},VIDEO_DEVICE_FALSE:{code:1103045,message:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,message:"audio is false"},TRACK_NOT_FOUND:{code:1103047,message:"track is not found"},DEVICE_NOT_FOUND:{code:1103048,message:"device is not found"},REPEATED_PULL:{code:1103049,message:"repeated pull same stream"},PUBLISHER_WEBSOCKET_DISCONNECTED:{code:1103050,message:"websocket disconnected"},PUBLISHER_RETRY_TIMEOUT:{code:1103051,message:"publisher retry timeout"},PUBLISHER_CDN_PUSH_ERROR:{code:1103052,message:"publisher cdn push error"},PUBLISHER_HTTPS_REQUIRED:{code:1103053,message:"https is required"},PUBLISHER_NO_PREVIEW:{code:1103054,message:"no preview"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISHER_IS_PUBLISHING:{code:1103056,message:"publish is publishing"},PUBLISHER_DECODE_AUDIO_FAIL:{code:1103057,message:"decode audio data fail"},PUBLISHER_CLIENT_IP_CHANGED:{code:1103058,message:"client ip changed"},PUBLISHER_TTL_OVERTIME:{code:1103059,message:"ttl over time"},PUBLISHER_SESSION_TIMEOUT:{code:1103060,message:"session request timeout"},PUBLISHER_GET_USER_MEDIA_FAIL:{code:1103061,message:"get media fail"},PUBLISHER_UPDATE_STREAM_INFO_FAIL:{code:1103062,message:"update stream info fail"},PUBLISH_TARGET_NO_RESPONSE:{code:1103063,message:"publish target no response"},PLAYER_PARAM:{code:1104001,message:"input parm error"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,message:"dispatch request fail"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,message:"session request fail"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,message:"create offer error"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,message:"setLocalDescription error"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,message:"mediaDesc error"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,message:"other side offer error"},PLAYER_CANDIDATE_ERROR:{code:1104026,message:"candidate error"},PLAYER_SESSION_CLOSED:{code:1104027,message:"server session closed"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,message:"ice connection error"},PLAYER_WEBSOCKET_DISCONNECTED:{code:1104029,message:"websocket disconnected"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,message:"negotiation timeout"},PLAYER_RETRY_TIMEOUT:{code:1104031,message:"player retry timeout"},PLAYER_IS_PLAYING:{code:1104032,message:"player is playing"},PLAYER_CLIENT_IP_CHANGED:{code:1104033,message:"client ip changed"},PLAYER_TTL_OVERTIME:{code:1104034,message:"ttl is over time"},PLAYER_SESSION_RESET:{code:1104035,message:"reset session push"},PLAYER_SESSION_TIMEOUT:{code:1104036,message:"session request timeout"},PLAYER_PROBE_TIMEOUT:{code:1104037,message:"probe time out"},PLAYER_UNSUPPORTED_PROTOCOL:{code:1104038,message:"resource mode is not supported"},MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,message:"mix stream input parameters are wrong"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,message:"the device is unplugged"},IM_CONTENT_NULL:{code:1009001,message:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,message:"message content is too long"},IM_SEND_FAILED:{code:1009010,message:"failed to send message"},FREQ_LIMITED:{code:1109001,message:"frequency limited."}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRangeAudioMode=t.ZegoRangeAudioMicrophoneState=void 0,function(e){e[e.Off=0]="Off",e[e.TurningOn=1]="TurningOn",e[e.On=2]="On"}(t.ZegoRangeAudioMicrophoneState||(t.ZegoRangeAudioMicrophoneState={})),function(e){e[e.World=0]="World",e[e.Team=1]="Team"}(t.ZegoRangeAudioMode||(t.ZegoRangeAudioMode={}))},function(e,t,r){"use strict";var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<r;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,i++)o[i]=n[s];return o};Object.defineProperty(t,"__esModule",{value:!0}),t.SdpUtil=void 0;var i=function(){function e(){}return e.zegoSdp=function(e){var t=e.split("\r\n"),r=[],i=[];t.forEach((function(e){var t=e.match(/a=rtpmap:(\d+)\s+((H264\/90000)|(opus\/48000\/2))/);t&&t[1]&&t[2]&&("H264/90000"===t[2]&&r.push(t[1]),"opus/48000/2"===t[2]&&i.push(t[1]))}));var n=[];return t.map((function(e){var t=!0,s=e.match(/((a=rtcp-fb:)|(a=rtpmap:)|(a=fmtp:))(\d+)/);if(s&&s[5]&&(o(r,i).some((function(e){return e==s[5]}))||(t=!1)),e.indexOf("m=video")>-1){var a=e.split(" ");e=o([a[0],a[1],a[2]],r).join(" ")}else e.indexOf("m=audio")>-1&&(a=e.split(" "),e=o([a[0],a[1],a[2]],i).join(" "));t&&n.push(e)})),n.join("\r\n")},e.getSDPByVideDecodeType=function(e,t){var r={str:"",arr:[],obj:{H264:[],H265:[],VP8:[],VP9:[],OHTER:[]}};if(!e.includes("m=video"))return e;var i=/m=video.+/.exec(e)[0];i=i.match(/[\s|\d]+/g)[1].replace(" ",""),r.str=i,r.arr=r.str.split(" "),r.arr.forEach((function(t){var o=new RegExp("a=rtpmap:"+t+".+").exec(e)[0];o.includes("H264")?r.obj.H264.push(t):o.includes("H265")?r.obj.H265.push(t):o.includes("VP8")?r.obj.VP8.push(t):o.includes("VP9")?r.obj.VP9.push(t):r.obj.OHTER.push(t)})),r.obj.OHTER.forEach((function(t){var o=new RegExp("a=fmtp:"+t+".+apt=(\\d+)").exec(e),i=o&&o[1];i&&(r.obj.H264.includes(i)?r.obj.H264.push(t):r.obj.H265.includes(i)?r.obj.H265.push(t):r.obj.VP8.includes(i)?r.obj.VP8.push(t):r.obj.VP9.includes(i)&&r.obj.VP9.push(t))}));var n=[];return"VP9"===t?n=o(r.obj.H265,r.obj.H264,r.obj.VP8):"VP8"===t?n=o(r.obj.H265,r.obj.H264,r.obj.VP9):"H264"===t?n=o(r.obj.H265,r.obj.VP8,r.obj.VP9):"H265"===t&&(n=o(r.obj.VP8,r.obj.H264,r.obj.VP9)),n.forEach((function(t){var o=r.arr.indexOf(t);r.arr.splice(o,1);var i=new RegExp("a=rtpmap:"+t+".+\\s\\n","g"),n=new RegExp("a=rtcp-fb:"+t+".+\\s\\n","g"),s=new RegExp("a=fmtp:"+t+".+\\s\\n","g");e=(e=(e=e.replace(i,"")).replace(n,"")).replace(s,"")})),e=e.replace(i,r.arr.join(" "))},e}();t.SdpUtil=i},function(e,t){e.exports=o},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWebRTC=void 0;var i=r(0),n=r(3),s=r(15),a=r(16),c=r(2),d=r(1),l=r(17),u=r(23),h=r(4),p=function(){function e(e,t,r,o){void 0===o&&(o=0),this.mediaEleSources=[],this.logger=e,this.dataReport=t,this.ac=new("undefined"!=typeof webkitAudioContext?webkitAudioContext:AudioContext),this.stateCenter=new s.StateCenter(this.logger,this.dataReport),this.stateCenter.clientType="webrtc",this.stateCenter.type=2===o?"PRIVATE":"PUBLIC",this.RTM=r,this.streamCenter=new u.ZegoStreamCenterWeb(this.logger,this.stateCenter,this.dataReport,this.RTM,this.ac,this.mediaEleSources),this.rtcModules=new l.RTCModules(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.RTM,this.ac),this.stateCenter.networkState=navigator?navigator.onLine?i.ENUM_NETWORK_STATE.online:i.ENUM_NETWORK_STATE.offline:i.ENUM_NETWORK_STATE.online}return e.prototype.mutePublishStreamVideo=function(e,t,r){this.logger.info(c.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" call");var o=i.getReportSeq();if(this.dataReport.newReport(o,d.ZegoRTCLogEvent.kZegoTaskMutePublishVideo),"boolean"!=typeof t||void 0!==r&&"boolean"!=typeof r)return this.logger.error(c.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" option error"),!1;var n=this.rtcModules.advancedModule.enableStream(e,{video:!t,retain:r});return this.dataReport.uploadReport(o),this.logger.info(c.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" end"),n},e.prototype.mutePublishStreamAudio=function(e,t){this.logger.info(c.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" call");var r=i.getReportSeq();if(this.dataReport.newReport(r,d.ZegoRTCLogEvent.kZegoTaskMutePublishAudio),"boolean"!=typeof t)return this.logger.error(c.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" option error"),!1;var o=this.rtcModules.advancedModule.enableStream(e,{audio:!t});return this.dataReport.uploadReport(r),this.logger.info(c.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" end"),o},e.prototype.mutePlayStreamVideo=function(e,t){this.logger.info(c.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_VIDEO+" call "+e+" "+t);var r=i.getReportSeq();this.dataReport.newReport(r,d.ZegoRTCLogEvent.kZegoTaskMutePlayVideo);var o=this.rtcModules.playModule.mutePlayStream(e,"video",t);return this.dataReport.uploadReport(r),this.logger.info(c.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_VIDEO+" end"),o},e.prototype.mutePlayStreamAudio=function(e,t){this.logger.info(c.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_AUDIO+" call "+e+" "+t);var r=i.getReportSeq();this.dataReport.newReport(r,d.ZegoRTCLogEvent.kZegoTaskMutePlayAudio);var o=this.rtcModules.playModule.mutePlayStream(e,"audio",t);return this.dataReport.uploadReport(r),this.logger.info(c.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_AUDIO+"end"),o},e.prototype.muteMicrophone=function(e){this.logger.info(c.ZEGO_WEBRTC_ACTION.MUTE_MIC+" call");var t=i.getReportSeq();if(this.dataReport.newReport(t,d.ZegoRTCLogEvent.kZegoTaskMuteMicrophone),"boolean"!=typeof e)return this.logger.error(c.ZEGO_WEBRTC_ACTION.MUTE_MIC+" option error"),!1;var r=this.rtcModules.advancedModule.enableMicrophoneOnly(!e);return this.dataReport.uploadReport(t),this.logger.info(c.ZEGO_WEBRTC_ACTION.MUTE_MIC+" end"),r},e.prototype.isMicrophoneMuted=function(){return!this.streamCenter.isMicEnabled},e.prototype.setAudioOutput=function(e,t){return this.logger.info(c.ZEGO_WEBRTC_ACTION.SET_AUDIO_OUTPUT+" call"),"string"!=typeof t?(this.logger.error("audiooutput is not string"),!1):this.rtcModules.playModule.setStreamAudioOutput(e,t)},e.prototype.setCustomSignalUrl=function(e){if(this.logger.info(c.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" call: "+e),e&&0!=e.length){var t=!0;e.forEach((function(e){return 0!=e.indexOf("wss://")&&(t=!1)})),t?this.stateCenter.customUrl=e:this.logger.error(c.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" url is not correct")}else this.logger.error(c.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" param error")},e.prototype.setQualityMonitorCycle=function(e){return"number"==typeof e&&e>=1e3?(this.streamCenter.setQualityMonitorCycle(e),!0):(this.logger.error("zc.sqmc.0 time must be number and bigger than 1000"),!1)},e.prototype.startPlayingStream=function(e,t){return this.logger.info(c.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" call by user"),this.rtcModules.playModule.startPlayingStream(e,t)},e.prototype.stopPlayingStream=function(e){this.logger.info(c.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call by user"),this.rtcModules.playModule.stopPlayingStream(e)},e.prototype.setTurnOverTcpOnly=function(e){this.logger.info(c.ZEGO_WEBRTC_ACTION.SET_TURN_OVER_TCP_ONLY+" call "+e),"boolean"==typeof e?this.stateCenter.turnOverTcpOnly=e:this.logger.error("zc.p.stoto.0 param must be param")},e.prototype.createStream=function(e){return this.rtcModules.publishModule.createStream(e)},e.prototype.destroyStream=function(e){this.rtcModules.publishModule.destroyStream(e)},e.prototype.startPublishingStream=function(e,t,r){return this.logger.info(c.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" call by user"),this.rtcModules.publishModule.startPublishingStream(e,t,r)},e.prototype.activateSEIInsert=function(e){var t=e.stream,r=e.action,o=e.infoType;return this.rtcModules.publishModule.activateSEIInsert(t,r,o)},e.prototype.stopPublishingStream=function(e){return this.logger.info(c.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" call by user"),this.rtcModules.publishModule.stopPublishingStream(e)},e.prototype.setVideoConfig=function(e,t){return this.rtcModules.advancedModule.setVideoConfig(e,t)},e.prototype.setAudioConfig=function(e,t){return this.rtcModules.advancedModule.setAudioConfig(e,t)},e.prototype.replaceTrack=function(e,t){return this.rtcModules.advancedModule.replaceTrack(e,t)},e.prototype.preloadEffect=function(e,t,r){this.rtcModules.audioMixModule.preloadEffect(e,t,r)},e.prototype.playEffect=function(e,t,r){this.rtcModules.audioMixModule.playEffect(e,t,r)},e.prototype.pauseEffect=function(e,t){return this.rtcModules.audioMixModule.pauseEffect(e,t)},e.prototype.resumeEffect=function(e,t){return this.rtcModules.audioMixModule.resumeEffect(e,t)},e.prototype.stopEffect=function(e,t){return this.rtcModules.audioMixModule.stopEffect(e,t)},e.prototype.unloadEffect=function(e){return this.rtcModules.audioMixModule.unloadEffect(e)},e.prototype.setEffectVolume=function(e,t,r){return this.rtcModules.audioMixModule.setEffectVolume(e,t,r)},e.prototype.startMixingAudio=function(e,t){return this.rtcModules.audioMixModule.startMixingAudio(e,t)},e.prototype.stopMixingAudio=function(e,t){return this.rtcModules.audioMixModule.stopMixingAudio(e,t)},e.prototype.mixingBuffer=function(e,t,r,o){this.rtcModules.audioMixModule.mixingBuffer(e,t,r,o)},e.prototype.stopMixingBuffer=function(e,t){return this.rtcModules.audioMixModule.stopMixingBuffer(e,t)},e.prototype.setMixingAudioVolume=function(e,t,r){return this.rtcModules.audioMixModule.setMixingAudioVolume(e,t,r)},e.prototype.checkSystemRequirements=function(t,r){var o=this,s=navigator&&navigator.mediaDevices&&(e.screenShotReady||"getDisplayMedia"in navigator.mediaDevices);return this.logger.info(c.ZEGO_WEBRTC_ACTION.CHECK_SUPPORT+" call"+navigator.userAgent),new Promise((function(e){var a=i.getReportSeq();o.dataReport.newReport(a,d.ZegoRTCLogEvent.kZegoTaskCheckSystemRequirements.event);var c=r||"all",l=function(t){o.dataReport.addMsgInfo(a,{capability:d.ZegoRTCLogEvent.kZegoTaskCheckSystemRequirements.capability(t)}),o.dataReport.uploadReport(a);var r=o.stateCenter.checkList.indexOf(c);o.stateCenter.checkList.splice(r,1),e(t)};return["webRTC","customCapture","camera","microphone","screenSharing","H264","VP8","all"].includes(c)&&[0,1].includes(t)?o.stateCenter.checkList.includes(c)||o.stateCenter.checkList.includes("all")?l({result:!1,errInfo:{extendedDate:"The last test of the same type has not returned a result "}}):(o.stateCenter.checkList.push(c),void n.ClientUtil.supportDetection(s,l,t,r)):l({result:!1,errInfo:{extendedDate:"param error"}})}))},e.prototype.enumDevices=function(){var e=this;return this.logger.info("zc.ed.0 call"),new Promise((function(t,r){var o=i.getReportSeq();e.dataReport.newReport(o,d.ZegoRTCLogEvent.kZegoTaskEnumDevices.event),n.ClientUtil.getDevices((function(r){var i=[];r.cameras.forEach((function(e){return i.push({device:e.deviceName,type:0})})),r.microphones.forEach((function(e){return i.push({device:e.deviceName,type:1})})),r.speakers.forEach((function(e){return i.push({device:e.deviceName,type:2})})),e.dataReport.addMsgInfo(o,{dev_list:d.ZegoRTCLogEvent.kZegoTaskEnumDevices.dev_list(i)}),e.dataReport.uploadReport(o),t(r)}),(function(t){e.dataReport.addMsgInfo(o,t),e.dataReport.uploadReport(o),r(t)}))}))},e.prototype.getAudioInfo=function(e,t,r){if(!e)return this.logger.error("loclStream is empty!"),!1;var i=o({},r);return new a.MediaUtil(this.ac,i).connectToSource(e,(function(e){t(e)}))},e.prototype.getSoundLevel=function(e,t,r){this.rtcModules.audioMixModule.getSoundLevel(e,t,r)},e.prototype.stopSoundLevel=function(e){this.logger.info("zc.ssl call");var t=i.getReportSeq();this.dataReport.newReport(t,d.ZegoRTCLogEvent.kZegoTaskStopSoundLevel);var r=this.stateCenter.audioStreamList[e.id];r.mic.disconnect(),r.script.disconnect(),delete this.stateCenter.audioStreamList[e.id],this.dataReport.uploadReport(t)},e.handleDataAvailable=function(t){t.data&&t.data.size>0&&e.recordedBlobs.push(t.data)},e.prototype.startRecord=function(t){var r=this,o=t.captureStream();e.recordedBlobs=[];var n={mimeType:"video/webm;codecs=vp9"};i.MediaRecorder.isTypeSupported(n.mimeType)||(n={mimeType:"video/webm;codecs=vp8"},i.MediaRecorder.isTypeSupported(n.mimeType)||(n={mimeType:"video/webm"},i.MediaRecorder.isTypeSupported(n.mimeType)||(n={mimeType:""})));try{e.mediaRecorder=new i.MediaRecorder(o,n)}catch(e){return void this.logger.error("Exception while creating ZegoMediaRecorder:",e)}e.mediaRecorder.onstop=function(e){r.logger.warn("Recorder stopped: "+e)},e.mediaRecorder.ondataavailable=e.handleDataAvailable,e.mediaRecorder.start(10)},e.prototype.stopRecord=function(){e.mediaRecorder?e.mediaRecorder.stop():this.logger.warn("please invoke startRecord first")},e.prototype.resumeRecord=function(){e.mediaRecorder?e.mediaRecorder.resume():this.logger.warn("please invoke startRecord first")},e.prototype.pauseRecord=function(){e.mediaRecorder?e.mediaRecorder.pause():this.logger.warn("please invoke startRecord first")},e.prototype.saveRecord=function(t){if(e.mediaRecorder&&e.recordedBlobs){var r=new Blob(e.recordedBlobs,{type:"video/webm"}),o=window.URL.createObjectURL(r),i=document.createElement("a");i.style.display="none",i.href=o,i.download=t+".webm",document.body.appendChild(i),i.click(),setTimeout((function(){document.body.removeChild(i),window.URL.revokeObjectURL(o)}),100)}else this.logger.warn("please invoke startRecord first")},e.prototype.takeSnapShot=function(e,t){if(e&&0!==e.videoHeight){var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;var o=r.getContext("2d");o&&o.drawImage(e,0,0,r.width,r.height),t.src=r.toDataURL("image/jpeg")}else this.logger.error("video can not empty")},e.prototype.saveSnapShot=function(e,t){if(e&&0!==e.videoHeight){var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;var o=r.getContext("2d");o&&o.drawImage(e,0,0,r.width,r.height),r.toBlob((function(e){var r=window.URL.createObjectURL(e),o=document.createElement("a");o.style.display="none",o.href=r,o.download=t+".jpeg",document.body.appendChild(o),o.click(),setTimeout((function(){document.body.removeChild(o),window.URL.revokeObjectURL(r)}),100)}))}else this.logger.error("video can not empty")},e.prototype.useVideoDevice=function(e,t){return this.rtcModules.advancedModule.useVideoDevice(e,t)},e.prototype.useAudioDevice=function(e,t){return this.rtcModules.advancedModule.useAudioDevice(e,t)},e.prototype.setSoundLevelDelegate=function(e,t){this.logger.info("zc.ssd.0 call"),"boolean"==typeof e?t&&(!n.ClientUtil.checkInteger(t)||t<100||t>3e3)?this.logger.error("zc.ssd.0 soundLevel interval must be integer number which is between 100 and 3000"):this.streamCenter.setSoundLevelDelegate(e,t):this.logger.error("zc.ssd.0 param 1 must be boolean")},e.prototype.on=function(e,t){return this.rtcModules.bindListener(e,t)},e.prototype.off=function(e,t){return this.rtcModules.deleteListener(e,t)},e.prototype.getVersion=function(){return i.PROTO_VERSION},e.prototype.setStreamExtraInfo=function(e,t){var r=this;return new Promise((function(o,n){var s=i.getReportSeq();r.dataReport.newReport(s,d.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.event),r.dataReport.addMsgInfo(s,{stream:d.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream(e),stream_extra_info:d.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream_extra_info(t)});var a=function(e,t){r.logger.error("zb.ssei "+t),r.dataReport.addMsgInfo(s,{error:e.code,message:e.message+" "+t}),r.dataReport.uploadReport(s),n({errorCode:e.code,extendedData:e.message+" "+t})};if("string"==typeof e&&""!=e)if("string"==typeof t&&""!=t)if(r.RTM.service.isDisConnect())a(d.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login");else if(r.stateCenter.publishStreamList[e]){var c=r.streamCenter.getRoomByStreamID(e);c?(r.dataReport.addMsgInfo(s,{room_sid:d.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.room_sid(c.sessionID)}),c.streamHandler.setStreamExtraInfo(e,t,o,a),r.dataReport.uploadReport(s)):a(d.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login")}else a(d.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError,"publish stream no found");else a(d.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"extraInfo must be string and no empty");else a(d.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"streamID must be string and not empty")}))},e.prototype.addPublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.rtcModules.advancedModule.publishTarget({type:"addpush",streamID:e,pushUrl:t})},e.prototype.removePublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.rtcModules.advancedModule.publishTarget({type:"delpush",streamID:e,pushUrl:t})},e.prototype.startMixerTask=function(e){var t=this;return new Promise((function(r,o){var s=i.getReportSeq();if(t.dataReport.newReport(s,d.ZegoRTCLogEvent.kZegoTaskMixStart.event),n.ClientUtil.logReportCallback("kZegoTaskMixStart"+e.taskID,t.dataReport,s,t.stateCenter.reportList),!(null==e?void 0:e.inputList.find((function(r){var i=h.errorCodeList.MIXER_INPUT_PARAMETERS_ERROR;if(void 0===r.streamID||null===r.streamID){var a={errorCode:i.code,extendedData:i.message+". streamID should be of string type"};return t.dataReport.addMsgInfo(s,a),t.dataReport.uploadReport(s),n.ClientUtil.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),o(a),!0}return!1})))){e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var a=function(r){var i,a,c,d="",l=h.errorCodeList;r.errorCode<2e9&&r.errorCode>1e9?c=l[d=n.ClientUtil.mixServerError(r.errorCode)]:r.errorCode<1e6&&(c=n.ClientUtil.decodeServerError(r.errorCode,r.extendedData),d=n.ClientUtil.getLiveRoomError(r.errorCode)),c?t.dataReport.addMsgInfo(s,c):t.dataReport.addMsgInfo(s,r),t.dataReport.uploadReport(s),n.ClientUtil.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),d&&(r.errorCode=null===(i=l[d])||void 0===i?void 0:i.code,r.extendedData=(null===(a=l[d])||void 0===a?void 0:a.message)||""),o(r)},c=t.stateCenter.roomList[0];c?c.streamHandler.updateMixStream(e,(function(o){t.dataReport.uploadReport(s),n.ClientUtil.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),r(o)}),a):a({errorCode:d.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.code,extendedData:d.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.message})}}))},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,o){var s=i.getReportSeq();t.dataReport.newReport(s,d.ZegoRTCLogEvent.kZegoTaskMixConfig.event),n.ClientUtil.logReportCallback("kZegoTaskMixConfig",t.dataReport,s,t.stateCenter.reportList);var a=t.stateCenter.roomList[0];a?a.streamHandler.setMixerTaskConfig(e).then((function(e){t.dataReport.uploadReport(s),n.ClientUtil.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),r(e)})).catch((function(e){t.dataReport.addMsgInfo(s,e),t.dataReport.uploadReport(s),n.ClientUtil.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),o(e)})):o({errorCode:d.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.code,extendedData:d.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.message})}))},e.prototype.stopMixerTask=function(e){var t=this;return new Promise((function(r,o){var s=i.getReportSeq();if(t.dataReport.newReport(s,d.ZegoRTCLogEvent.kZegoTaskMixStop.event),!e||"string"!=typeof e||e.length>i.MAX_MIX_TASK_ID_LENGTH||!n.ClientUtil.checkIllegalCharacters(e))return t.logger.error("zb.rh.lg taskID must be string less 256"),t.dataReport.addMsgInfo(s,{error:d.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,message:d.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"}),t.dataReport.uploadReport(s),void o({errorCode:d.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,extendedData:d.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"});var a=function(e){var r,a,c,d="",l=h.errorCodeList;e.errorCode<2e9&&e.errorCode>1e9?c=l[d=n.ClientUtil.mixServerError(e.errorCode-i.MIXSTREAM_ERROR_CODE)]:e.errorCode<1e6&&(c=n.ClientUtil.decodeServerError(e.errorCode,e.extendedData),d=n.ClientUtil.getLiveRoomError(e.errorCode)),c?t.dataReport.addMsgInfo(s,c):t.dataReport.addMsgInfo(s,e),t.dataReport.uploadReport(s),d&&(e.errorCode=null===(r=l[d])||void 0===r?void 0:r.code,e.extendedData=(null===(a=l[d])||void 0===a?void 0:a.message)||""),o(e)},c=t.stateCenter.roomList[0];c?c.streamHandler.stopMixStream(e,(function(e){t.dataReport.uploadReport(s),r(e)}),a):a({errorCode:d.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.code,extendedData:d.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.message})}))},e.prototype.setCaptureVolume=function(e,t){return this.rtcModules.publishModule.setCaptureVolume(e,t)},e.prototype.getRoomInfo=function(){var e=this.stateCenter.roomList[0];return null==e?void 0:e.streamHandler.getRoomInfo()},e.prototype.createRangeAudioInstance=function(){throw new Error("should use rangeaudio module")},e.use=function(t){switch(t.type){case"RangeAudio":t.install(e)}},e.screenShotReady=!1,e}();t.ZegoWebRTC=p,window.addEventListener("message",(function(e){var t=e.data.type;e.origin,window.location.origin,"SS_PING"===t&&(p.screenShotReady=!0)}))},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPreview=void 0;var s=r(0),a=r(1),c=r(2),d=function(){function e(e,t,r,o){var i=this;this.localStream=null,this.videoInfo={},this.previewSuc=!1,this.soundLevel=0,this.script=null,this.mic=null,this.audioTrack=null,this.activeteSEIConfig=null,this.isAudioEnabled=!0,this.gainNode=null,this.cameraMaxResolution={},this.enableMicrophone=function(e,t){var r;if(!i.localStream)return i.logger.error("zp.em.2 no localStream"),!1;i.localStream.getAudioTracks().forEach((function(t){t.enabled=e})),i.audioTrack&&(i.audioTrack.enabled=e&&t.isMicEnabled);var o=null===(r=t.checkPublish(i.localStream))||void 0===r?void 0:r.publisher;if(o){var n=o.camera_status,s=e&&t.isMicEnabled?0:20;o.camera_status===n&&o.mic_status===s||o.sendStreamStatus(n,s)}return i.isAudioEnabled=e,i.logger.debug("zp.em.2 call success"),!0},this.enableMicrophoneOnly=function(e,t){var r;if(!i.localStream)return i.logger.error("zp.em.2 no localStream"),!1;var o=null===(r=t.checkPublish(i.localStream))||void 0===r?void 0:r.publisher;if(o){var n=o.mic_status,s=i.isAudioEnabled&&e?0:20;o.camera_status===n&&o.mic_status===s||o.sendStreamStatus(n,s)}return i.micTrack?(i.micTrack.enabled=i.isAudioEnabled&&e,i.logger.debug("zp.emo.2 call success"),!0):(i.logger.info("zp.emo.2 no micTrack"),!0)},this.enableCamera=function(e,t,r){var o,n;if(!i.localStream)return i.logger.error("zp.ec.2 no localStream"),!1;(!r||e)&&i.localStream.getVideoTracks().forEach((function(t){if(t.enabled=e,e&&void 0!==typeof t.getSettings().width&&t.getSettings().width>0){var r=t.getSettings().width-1,o=t.getSettings().height-1;t.applyConstraints({width:r,height:o}),setTimeout((function(){t.applyConstraints({width:i.videoInfo.width,height:i.videoInfo.height})}),200)}}));var s=function(s){var a=t.publisherList[s].publisher;if(a.localStream==i.localStream){if(r&&!e){var c=i.localStream.clone(),d=c.getVideoTracks()[0];null==(l=null===(o=a.peerConnection)||void 0===o?void 0:o.getSenders().find((function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.kind)===d.kind})))||l.replaceTrack(d),c.getTracks().forEach((function(e){return e.stop()}))}else if(e){var l;null==(l=null===(n=a.peerConnection)||void 0===n?void 0:n.getSenders().find((function(e){var t;return"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)})))||l.replaceTrack(i.localStream.getVideoTracks()[0])}var u=e?0:20,h=i.isAudioEnabled&&t.isMicEnabled?0:20;a.camera_status===u&&a.mic_status===h||a.sendStreamStatus(u,h)}};for(var a in t.publisherList)s(a);return i.logger.info("zp.ec.2 call success"),!0},this.logger=e,this.previewType=o,this.ac=t,this.streamCenter=r}return Object.defineProperty(e.prototype,"micTrack",{get:function(){return"camera"===this.previewType&&this.audioTrack||null},enumerable:!1,configurable:!0}),e.prototype.getMediaStreamConstraints=function(e,t){var r={audio:null,video:null};if(r.audio=!0,r.video={width:640,height:480,frameRate:15,bitRate:800},e.audio?void 0===e.audioInput&&void 0===e.ANS&&void 0===e.AGC&&void 0===e.AEC&&void 0===e.channelCount?(r.audio={},r.audio.noiseSuppression=!0,r.audio.autoGainControl=!0,r.audio.echoCancellation=!0,r.audio.channelCount=1):(r.audio={},void 0!==e.audioInput&&null!==e.audioInput&&(r.audio.deviceId=e.audioInput),void 0!==e.ANS&&(r.audio.noiseSuppression=e.ANS),void 0!==e.AGC&&(r.audio.autoGainControl=e.AGC),void 0!==e.AEC&&(r.audio.echoCancellation=e.AEC),void 0!==e.channelCount&&(r.audio.channelCount=e.channelCount)):!1===e.audio&&(r.audio=!1),e.video){var o=640,i=480,n=15,a=800;if(1===e.videoQuality?(o=s.ENUM_RESOLUTION_TYPE.LOW.width,i=s.ENUM_RESOLUTION_TYPE.LOW.height,n=s.ENUM_RESOLUTION_TYPE.LOW.frameRate,a=s.ENUM_RESOLUTION_TYPE.LOW.bitRate):2===e.videoQuality?(o=s.ENUM_RESOLUTION_TYPE.MEDIUM.width,i=s.ENUM_RESOLUTION_TYPE.MEDIUM.height,n=s.ENUM_RESOLUTION_TYPE.MEDIUM.frameRate,a=s.ENUM_RESOLUTION_TYPE.MEDIUM.bitRate):3===e.videoQuality?(o=s.ENUM_RESOLUTION_TYPE.HIGH.width,i=s.ENUM_RESOLUTION_TYPE.HIGH.height,n=s.ENUM_RESOLUTION_TYPE.HIGH.frameRate,a=s.ENUM_RESOLUTION_TYPE.HIGH.bitRate):4===e.videoQuality?(o=e.width,i=e.height,n=e.frameRate,a=e.bitRate||800):this.logger.info("zp.gmsc.2 use default"),t&&(e.width&&(o=e.width),e.height&&(i=e.height),e.frameRate&&(n=e.frameRate),e.bitRate&&(a=e.bitRate)),!1===e.horizontal){var c=i;i=o,o=c}!0===e.isSwitch&&(c=i,i=o,o=c),r.video={width:o,height:i,frameRate:n,bitRate:a},null!=e.facingMode?r.video.facingMode=e.facingMode:null!=e.videoInput&&null!=e.videoInput&&""!=e.videoInput&&(r.video.deviceId={exact:e.videoInput}),this.logger.info("zp.gmsc.2 width: "+o+" height: "+i+" rate: "+n)}else!1===e.video&&(e.audioBitrate&&(r.video={}),r.video=!1);return r},e.prototype.startPreview=function(e,t,r){return i(this,void 0,void 0,(function(){var i,s,c,d,l=this;return n(this,(function(n){return this.logger.debug("zp.sv.2 called"),this.mediaStreamConfig=e,void 0===navigator.mediaDevices||null==navigator.mediaDevices.getUserMedia?(r&&r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError),[2]):e.source instanceof MediaStream?(i=e.source.getVideoTracks(),s=i.length>0?i[0].getSettings():{width:0,height:0,frameRate:0},this.logger.debug("zp.sv.2 use external media stream"),this.previewSuc=!0,this.localStream=e.source,e.source.getAudioTracks().length>0&&(this.audioTrack=e.source.getAudioTracks()[0]),this.videoInfo={width:s.width,height:s.height,frameRate:s.frameRate,bitRate:e.bitRate||0,startBitrate:e.startBitrate,channelCount:e.channelCount||(this.audioTrack&&this.audioTrack.getSettings?this.audioTrack.getSettings().channelCount:1),audioBitrate:1e3*e.audioBitrate||48e3},t&&t(this.localStream),[2]):e.source instanceof HTMLMediaElement?((c=this.captureStream(e.source,e))?(this.videoInfo.bitRate=e.bitRate||0,this.previewSuc=!0,c.getAudioTracks().length>0&&(this.audioTrack=c.getAudioTracks()[0]),t&&t(c)):r&&r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError),[2]):(d=this.getMediaStreamConstraints(e),this.videoInfo=o({},d.video),this.videoInfo?(this.videoInfo.audioBitrate=1e3*e.audioBitrate||48e3,this.videoInfo.startBitrate=e.startBitrate):e.audioBitrate&&(this.videoInfo={audioBitrate:1e3*e.audioBitrate||48e3}),this.mediaStreamConfig.video=!!d.video,this.mediaStreamConfig.audio=!!d.audio,this.logger.info("zp.sv.2 ",JSON.stringify(d)),e.unlimitedCaptureResolution&&d.video.width&&(d.video.width={ideal:4096},d.video.height={ideal:2160},this.logger.info("zp.sv.2 ","capture max resolution of camera")),navigator.mediaDevices.getUserMedia(d).then((function(r){l.logger.info("zp.sv.2 success"),l.localStream=r,l.previewSuc=!0,r.getAudioTracks().length>0&&(l.audioTrack=l.localStream.getAudioTracks()[0]),l.videoInfo&&(l.videoInfo.channelCount=e.channelCount||(l.audioTrack&&l.audioTrack.getSettings?l.audioTrack.getSettings().channelCount:1)),t&&t(r)}),(function(e){if(l.logger.info("zp.sv.2 failed ",e.name," ",e.message),r){var t=a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kGetUserMediaError;t.message=t.message+" "+e.name+e.message,r(t)}})),[2])}))}))},e.prototype.captureStream=function(e,t){if(!e)return this.logger.info("zp.cs.2 no local video"),null;var r;if(e.captureStream)r=e.captureStream(),this.logger.debug("zp.cs.2 captureStream");else{if(!e.mozCaptureStream)return this.logger.info("zp.cs.2 don't support"),null;r=e.mozCaptureStream(),this.logger.debug("zp.cs.2 mozCaptureStream")}return 0==r.getTracks().length?(this.logger.error("zp.cs.2 external capture tracks no found"),null):(this.localStream=r,this.videoInfo={width:e.videoWidth,height:e.videoHeight,frameRate:0,bitRate:0,channelCount:t.channelCount||(this.audioTrack&&this.audioTrack.getSettings?this.audioTrack.getSettings().channelCount:1),audioBitrate:1e3*t.audioBitrate||48e3,startBitrate:t.startBitrate},this.logger.debug("zp.cs.2 called success"),this.localStream)},e.prototype.stopPreview=function(){this.logger.info("zp.sv.2.1 called"),this.localStream&&(this.localStream.getTracks().reverse().forEach((function(e){return e.stop()})),this.audioTrack&&this.audioTrack.stop(),this.localStream=null,this.videoInfo={})},e.prototype.startSoundLevel=function(){var e=this;if(this.localStream&&0!=this.localStream.getAudioTracks().length){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.localStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var r=t.inputBuffer.getChannelData(0),o=0,i=0;i<r.length;i++)o<r[i]&&(o=r[i]);e.soundLevel=100*o},this.ac.resume()}catch(e){this.logger.error(c.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" get sound level failed "+e)}}},e.prototype.stopSoundLevel=function(){this.soundLevel=0,this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},e.prototype.restartSoundLevel=function(){this.streamCenter.soundLevelDelegate?(this.stopSoundLevel(),this.startSoundLevel()):this.stopSoundLevel()},e}();t.ZegoPreview=d},function(e,t,r){e.exports=function e(t,r,o){function i(s,a){if(!r[s]){if(!t[s]){if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=r[s]={exports:{}};t[s][0].call(d.exports,(function(e){return i(t[s][1][e]||e)}),d,d.exports,e,t,r,o)}return r[s].exports}for(var n=!1,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,r){"use strict";var o=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=o},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},d=o.log,l=o.detectBrowser(t),u={browserDetails:l,commonShim:c,extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings};switch(l.browser){case"chrome":if(!i||!i.shimPeerConnection||!r.shimChrome)return d("Chrome shim is not included in this adapter release."),u;d("adapter.js shimming chrome."),u.browserShim=i,i.shimGetUserMedia(t),i.shimMediaStream(t),i.shimPeerConnection(t),i.shimOnTrack(t),i.shimAddTrackRemoveTrack(t),i.shimGetSendersWithDtmf(t),i.shimGetStats(t),i.shimSenderReceiverGetStats(t),i.fixNegotiationNeeded(t),c.shimRTCIceCandidate(t),c.shimConnectionState(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t),c.removeAllowExtmapMixed(t);break;case"firefox":if(!s||!s.shimPeerConnection||!r.shimFirefox)return d("Firefox shim is not included in this adapter release."),u;d("adapter.js shimming firefox."),u.browserShim=s,s.shimGetUserMedia(t),s.shimPeerConnection(t),s.shimOnTrack(t),s.shimRemoveStream(t),s.shimSenderGetStats(t),s.shimReceiverGetStats(t),s.shimRTCDataChannel(t),c.shimRTCIceCandidate(t),c.shimConnectionState(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t);break;case"edge":if(!n||!n.shimPeerConnection||!r.shimEdge)return d("MS edge shim is not included in this adapter release."),u;d("adapter.js shimming edge."),u.browserShim=n,n.shimGetUserMedia(t),n.shimGetDisplayMedia(t),n.shimPeerConnection(t),n.shimReplaceTrack(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t);break;case"safari":if(!a||!r.shimSafari)return d("Safari shim is not included in this adapter release."),u;d("adapter.js shimming safari."),u.browserShim=a,a.shimRTCIceServerUrls(t),a.shimCreateOfferLegacy(t),a.shimCallbacksAPI(t),a.shimLocalStreamsAPI(t),a.shimRemoteStreamsAPI(t),a.shimTrackEventTransceiver(t),a.shimGetUserMedia(t),c.shimRTCIceCandidate(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t),c.removeAllowExtmapMixed(t);break;default:d("Unsupported browser!")}return u};var o=d(e("./utils")),i=d(e("./chrome/chrome_shim")),n=d(e("./edge/edge_shim")),s=d(e("./firefox/firefox_shim")),a=d(e("./safari/safari_shim")),c=d(e("./common_shim"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var n=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return n.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(o){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===o.track.id})):{track:o.track};var n=new Event("track");n.track=o.track,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],r.dispatchEvent(n)})),t.stream.getTracks().forEach((function(o){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===o.id})):{track:o};var n=new Event("track");n.track=o,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],r.dispatchEvent(n)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else s.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))},r.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,o){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach((function(e){var r=t._senders.find((function(t){return t.track===e}));r&&t._senders.splice(t._senders.indexOf(r),1)}))}}else if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},r.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,o){var i=this,n=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var s=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},a=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){n[1](a(s(e)))};return t.apply(this,[c,arguments[0]])}return new Promise((function(e,r){t.apply(i,[function(t){e(a(s(t)))},r])})).then(r,o)}}},r.shimSenderReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return s.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),s.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return s.filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,o=void 0,i=void 0;return this.getSenders().forEach((function(e){e.track===t&&(r?i=!0:r=e)})),this.getReceivers().forEach((function(e){return e.track===t&&(o?i=!0:o=e),e.track===t})),i||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}}},r.shimAddTrackRemoveTrackWithNative=a,r.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=s.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return a(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(r.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}o.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var o=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var n=this.getSenders().find((function(e){return e.track===t}));if(n)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var s=this._streams[r.id];if(s)s.addTrack(t),Promise.resolve().then((function(){o.dispatchEvent(new Event("negotiationneeded"))}));else{var a=new e.MediaStream([t]);this._streams[r.id]=a,this._reverseStreams[a.id]=r,this.addStream(a)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments,o=arguments.length&&"function"==typeof arguments[0];return o?r.apply(this,[function(r){var o=d(e,r);t[0].apply(null,[o])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return d(e,t)}))}}));var n=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=l(this,arguments[0]),n.apply(this,arguments)):n.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:d(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var r=void 0;Object.keys(this._streams).forEach((function(o){t._streams[o].getTracks().find((function(t){return e.track===t}))&&(r=t._streams[o])})),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function d(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var o=e._reverseStreams[t],i=e._streams[o.id];r=r.replace(new RegExp(i.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function l(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var o=e._reverseStreams[t],i=e._streams[o.id];r=r.replace(new RegExp(o.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}},r.shimPeerConnection=function(e){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}}));var t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},r.fixNegotiationNeeded=function(e){s.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));function a(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var o=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(o)&&this._shimmedLocalStreams[r.id].push(o):this._shimmedLocalStreams[r.id]=[r,o],o};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var o=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===o.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],o.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var o=t._shimmedLocalStreams[r].indexOf(e);-1!==o&&t._shimmedLocalStreams[r].splice(o,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),i.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&"function"==typeof t&&(e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var o=r.video&&r.video.width,i=r.video&&r.video.height,n=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:n||3}},o&&(r.video.mandatory.maxWidth=o),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))})}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var r=i.detectBrowser(e),s=function(e){if("object"!==(void 0===e?"undefined":o(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"===o(e[r])?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var s={};"number"==typeof i.ideal?(s[n("min",r)]=i.ideal,t.optional.push(s),(s={})[n("max",r)]=i.ideal,t.optional.push(s)):(s[n("",r)]=i.ideal,t.optional.push(s))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",r)]=i.exact):["min","max"].forEach((function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,r)]=i[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,i){if(r.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===o(e.audio)){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"===o(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":o(c))?c:{ideal:c});var d=r.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||d)){delete e.video.facingMode;var l=void 0;if("environment"===c.exact||"environment"===c.ideal?l=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(l=["front"]),l)return t.mediaDevices.enumerateDevices().then((function(t){var r=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return l.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!r&&t.length&&l.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=c.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=s(e.video),n("chrome: "+JSON.stringify(e)),i(e)}))}e.video=s(e.video)}return n("chrome: "+JSON.stringify(e)),i(e)},c=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,r,o){a(e,(function(e){t.webkitGetUserMedia(e,r,(function(e){o&&o(c(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){var d=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,(function(e){return d(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(c(e))}))}))}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js")),n=i.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),i=n.default.parseCandidate(e.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,s.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}},r.shimMaxMessageSize=function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=s.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=n.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=n.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},i=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},a=function(e,r){var o=65536;"firefox"===t.browser&&57===t.version&&(o=65535);var i=n.default.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?o=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(o=2147483637),o},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r(arguments[0])){var e=o(arguments[0]),t=i(e),n=a(arguments[0],e),s=void 0;s=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);var d={};Object.defineProperty(d,"maxMessageSize",{get:function(){return s}}),this._sctp=d}return c.apply(this,arguments)}}},r.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},s.wrapPeerConnectionEvent(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var o=arguments[0],i=o.length||o.size||o.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}},r.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}},r.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=s.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n")),r.apply(this,arguments)}}}};var i,n=(i=e("sdp"))&&i.__esModule?i:{default:i},s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var o=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var o=(0,c.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,a.filterIceServers)(e.iceServers,t.version),s.log("ICE servers after filtering:",e.iceServers)),new o(e)},e.RTCPeerConnection.prototype=o.prototype},r.shimReplaceTrack=function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var n,s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")),a=e("./filtericeservers"),c=(n=e("rtcpeerconnection-shim"))&&n.__esModule?n:{default:n}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&o.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var n=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return n.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":o(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if("object"===(void 0===e?"undefined":o(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}}));var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,o){return n.apply(this,[e||null]).then((function(e){if(t.version<53&&!r)try{e.forEach((function(e){e.type=i[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(r,o)}}},r.shimSenderGetStats=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},r.shimReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),s.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},r.shimRemoveStream=function(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;s.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)}))})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,o){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,o)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var s=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":o(e))&&"object"===o(e.audio)&&(e=JSON.parse(JSON.stringify(e)),s(e.audio,"autoGainControl","mozAutoGainControl"),s(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},n&&n.prototype.getSettings){var c=n.prototype.getSettings;n.prototype.getSettings=function(){var e=c.apply(this,arguments);return s(e,"mozAutoGainControl","autoGainControl"),s(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var d=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":o(e))&&(e=JSON.parse(JSON.stringify(e)),s(e,"autoGainControl","mozAutoGainControl"),s(e,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[e])}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getTracks().forEach((function(o){return t.call(r,o,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var o=e.getTracks();this.getSenders().forEach((function(e){o.includes(e.track)&&t.removeTrack(e)}))}})}},r.shimRemoteStreamsAPI=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))}),t.apply(e,arguments)}}},r.shimCallbacksAPI=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var o=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[o]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],o=i.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};var c=function(e,t,r){var o=n.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o};t.setLocalDescription=c,c=function(e,t,r){var o=s.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o},t.setRemoteDescription=c,c=function(e,t,r){var o=a.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o},t.addIceCandidate=c}},r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,o=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return o(n(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,o){t.mediaDevices.getUserMedia(e).then(r,o)}.bind(t))},r.shimConstraints=n,r.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var o=[],n=0;n<e.iceServers.length;n++){var s=e.iceServers[n];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,o.push(s)):o.push(e.iceServers[n])}e.iceServers=o}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var o=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0!==e.offerToReceiveVideo||o||this.addTransceiver("video")}return t.apply(this,arguments)}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"));function n(e){return e&&void 0!==e.video?Object.assign({},e,{video:i.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=n,r.wrapPeerConnectionEvent=function(e,t,r){if(e.RTCPeerConnection){var o=e.RTCPeerConnection.prototype,i=o.addEventListener;o.addEventListener=function(e,o){if(e!==t)return i.apply(this,arguments);var n=function(e){var t=r(e);t&&o(t)};return this._eventMap=this._eventMap||{},this._eventMap[o]=n,i.apply(this,[e,n])};var n=o.removeEventListener;o.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return n.apply(this,arguments);var o=this._eventMap[r];return delete this._eventMap[r],n.apply(this,[e,o])},Object.defineProperty(o,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},r.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":o(e))+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},r.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":o(e))+". Please use a boolean."):"adapter.js deprecation warnings "+(e?"disabled":"enabled")},r.log=function(){if("object"===("undefined"==typeof window?"undefined":o(window))){if(i)return;"undefined"!=typeof console&&console.log}},r.deprecated=function(e,t){},r.detectBrowser=function(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=n(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=n(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=n(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=n(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r},r.compactObject=function e(t){return"object"!==(void 0===t?"undefined":o(t))?t:Object.keys(t).reduce((function(r,i){var n="object"===o(t[i]),s=n?e(t[i]):t[i],a=n&&!Object.keys(s).length;return void 0===s||a?r:Object.assign(r,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},i,s))}),{})},r.walkStats=s,r.filterStats=function(e,t,r){var o=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var n=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&n.push(e)})),n.forEach((function(t){e.forEach((function(r){r.type===o&&r.trackId===t.id&&s(e,r,i)}))})),i};var i=!0;function n(e,t,r){var o=e.match(t);return o&&o.length>=r&&parseInt(o[r],10)}function s(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((function(o){o.endsWith("Id")?s(e,e.get(t[o]),r):o.endsWith("Ids")&&t[o].forEach((function(t){s(e,e.get(t),r)}))})))}},{}],16:[function(e,t,r){"use strict";var o=e("sdp");function i(e,t,r,i,n){var s=o.writeRtpDescription(e.kind,t);if(s+=o.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=o.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":n||"active"),s+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(i?i.id:"-")+" "+a+"\r\n";s+="a="+c,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+o.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+o.localCName+"\r\n"),s}function n(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},o=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var n=o(e.parameters.apt,r),s=o(t.parameters.apt,i);return n&&s&&n.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach((function(o){for(var n=0;n<t.codecs.length;n++){var s=t.codecs[n];if(o.name.toLowerCase()===s.name.toLowerCase()&&o.clockRate===s.clockRate){if("rtx"===o.name.toLowerCase()&&o.parameters&&s.parameters.apt&&!i(o,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(o.numChannels,s.numChannels),r.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter((function(e){for(var t=0;t<o.rtcpFeedback.length;t++)if(o.rtcpFeedback[t].type===e.type&&o.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var o=0;o<t.headerExtensions.length;o++){var i=t.headerExtensions[o];if(e.uri===i.uri){r.headerExtensions.push(i);break}}})),r}function s(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function a(e,t){var r=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,r,o,i){var n=new Event("track");n.track=r,n.receiver=o,n.transceiver={receiver:o},n.streams=i,e.setTimeout((function(){t._dispatchEvent("track",n)}))}var l=function(r){var i=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=n[e].bind(n)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var o=e.urls||e.url;e.url&&e.urls;var i="string"==typeof o;return i&&(o=[o]),o=o.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)})),delete e.url,e.urls=i?o[0]:o,!!o.length}}))}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var s=r.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=o.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,o={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)o.iceTransport=this.transceivers[0].iceTransport,o.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();o.iceTransport=i.iceTransport,o.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(o),o},l.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var o;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(o=this.transceivers[i]);return o||(o=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),o.track=t,o.stream=r,o.rtpSender=new e.RTCRtpSender(t,o.dtlsTransport),o.rtpSender},l.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach((function(t){r.addTrack(t,e)}));else{var o=e.clone();e.getTracks().forEach((function(e,t){var r=o.getTracks()[t];e.addEventListener("enabled",(function(e){r.enabled=e.enabled}))})),o.getTracks().forEach((function(e){r.addTrack(e,o)}))}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find((function(e){return e.rtpSender===t}));if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var o=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(o)&&this.localStreams.indexOf(o)>-1&&this.localStreams.splice(this.localStreams.indexOf(o),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var r=t.getSenders().find((function(t){return t.track===e}));r&&t.removeTrack(r)}))},l.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},l.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},l.prototype._createIceGatherer=function(t,r){var o=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==o.transceivers[t].bufferedCandidateEvents&&o.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},l.prototype._gather=function(t,r){var i=this,n=this.transceivers[r].iceGatherer;if(!n.onlocalcandidate){var s=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,n.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),n.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==n.state&&"gathering"!==n.state||(n.state="completed");else{"new"===n.state&&(n.state="gathering"),a.component=1,a.ufrag=n.getLocalParameters().usernameFragment;var d=o.writeCandidate(a);s.candidate=Object.assign(s.candidate,o.parseCandidate(d)),s.candidate.candidate=d,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var l=o.getMediaSections(i._localDescription.sdp);l[s.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",i._localDescription.sdp=o.getDescription(i._localDescription.sdp)+l.join("");var u=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",s),u&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){s.forEach((function(e){n.onlocalcandidate(e)}))}),0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var o=new e.RTCDtlsTransport(r);return o.ondtlsstatechange=function(){t._updateConnectionState()},o.onerror=function(){Object.defineProperty(o,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:o}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var o=this.transceivers[e].dtlsTransport;o&&(delete o.ondtlsstatechange,delete o.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,r,i){var s=n(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:o.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),i&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?s.encodings=e.recvEncodingParameters:s.encodings=[{}],s.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(s.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},l.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=o.splitSections(e.sdp),r=t.shift(),t.forEach((function(e,t){var r=o.parseRtpParameters(e);i.transceivers[t].localCapabilities=r})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=o.splitSections(i._remoteDescription.sdp),r=t.shift();var a=o.matchPrefix(r,"a=ice-lite").length>0;t.forEach((function(e,t){var s=i.transceivers[t],c=s.iceGatherer,d=s.iceTransport,l=s.dtlsTransport,u=s.localCapabilities,h=s.remoteCapabilities;if(!(o.isRejected(e)&&0===o.matchPrefix(e,"a=bundle-only").length||s.rejected)){var p=o.getIceParameters(e,r),f=o.getDtlsParameters(e,r);a&&(f.role="server"),i.usingBundle&&0!==t||(i._gather(s.mid,t),"new"===d.state&&d.start(c,p,a?"controlling":"controlled"),"new"===l.state&&l.start(f));var g=n(u,h);i._transceive(s,g.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(i){var l=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!s("setRemoteDescription",i.type,l.signalingState)||l._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+l.signalingState));var u={};l.remoteStreams.forEach((function(e){u[e.id]=e}));var h=[],p=o.splitSections(i.sdp),f=p.shift(),g=o.matchPrefix(f,"a=ice-lite").length>0,m=o.matchPrefix(f,"a=group:BUNDLE ").length>0;l.usingBundle=m;var _=o.matchPrefix(f,"a=ice-options:")[0];return l.canTrickleIceCandidates=!!_&&_.substr(14).split(" ").indexOf("trickle")>=0,p.forEach((function(s,c){var d=o.splitLines(s),p=o.getKind(s),_=o.isRejected(s)&&0===o.matchPrefix(s,"a=bundle-only").length,v=d[0].substr(2).split(" ")[2],E=o.getDirection(s,f),y=o.parseMsid(s),S=o.getMid(s)||o.generateIdentifier();if(_||"application"===p&&("DTLS/SCTP"===v||"UDP/DTLS/SCTP"===v))l.transceivers[c]={mid:S,kind:p,protocol:v,rejected:!0};else{var T,b,R,C,I,O,L,w,M;!_&&l.transceivers[c]&&l.transceivers[c].rejected&&(l.transceivers[c]=l._createTransceiver(p,!0));var A,N,k=o.parseRtpParameters(s);_||(A=o.getIceParameters(s,f),(N=o.getDtlsParameters(s,f)).role="client"),L=o.parseRtpEncodingParameters(s);var P=o.parseRtcpParameters(s),x=o.matchPrefix(s,"a=end-of-candidates",f).length>0,D=o.matchPrefix(s,"a=candidate:").map((function(e){return o.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!_&&m&&c>0&&l.transceivers[c]&&(l._disposeIceAndDtlsTransports(c),l.transceivers[c].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[c].iceTransport=l.transceivers[0].iceTransport,l.transceivers[c].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[c].rtpSender&&l.transceivers[c].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[c].rtpReceiver&&l.transceivers[c].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),"offer"!==i.type||_)"answer"!==i.type||_||(b=(T=l.transceivers[c]).iceGatherer,R=T.iceTransport,C=T.dtlsTransport,I=T.rtpReceiver,O=T.sendEncodingParameters,w=T.localCapabilities,l.transceivers[c].recvEncodingParameters=L,l.transceivers[c].remoteCapabilities=k,l.transceivers[c].rtcpParameters=P,D.length&&"new"===R.state&&(!g&&!x||m&&0!==c?D.forEach((function(e){a(T.iceTransport,e)})):R.setRemoteCandidates(D)),m&&0!==c||("new"===R.state&&R.start(b,A,"controlling"),"new"===C.state&&C.start(N)),!n(T.localCapabilities,T.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&T.sendEncodingParameters[0].rtx&&delete T.sendEncodingParameters[0].rtx,l._transceive(T,"sendrecv"===E||"recvonly"===E,"sendrecv"===E||"sendonly"===E),!I||"sendrecv"!==E&&"sendonly"!==E?delete T.rtpReceiver:(M=I.track,y?(u[y.stream]||(u[y.stream]=new e.MediaStream),r(M,u[y.stream]),h.push([M,I,u[y.stream]])):(u.default||(u.default=new e.MediaStream),r(M,u.default),h.push([M,I,u.default]))));else{(T=l.transceivers[c]||l._createTransceiver(p)).mid=S,T.iceGatherer||(T.iceGatherer=l._createIceGatherer(c,m)),D.length&&"new"===T.iceTransport.state&&(!x||m&&0!==c?D.forEach((function(e){a(T.iceTransport,e)})):T.iceTransport.setRemoteCandidates(D)),w=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(w.codecs=w.codecs.filter((function(e){return"rtx"!==e.name}))),O=T.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var U,B=!1;"sendrecv"===E||"sendonly"===E?(B=!T.rtpReceiver,I=T.rtpReceiver||new e.RTCRtpReceiver(T.dtlsTransport,p),B&&(M=I.track,y&&"-"===y.stream||(y?(u[y.stream]||(u[y.stream]=new e.MediaStream,Object.defineProperty(u[y.stream],"id",{get:function(){return y.stream}})),Object.defineProperty(M,"id",{get:function(){return y.track}}),U=u[y.stream]):(u.default||(u.default=new e.MediaStream),U=u.default)),U&&(r(M,U),T.associatedRemoteMediaStreams.push(U)),h.push([M,I,U]))):T.rtpReceiver&&T.rtpReceiver.track&&(T.associatedRemoteMediaStreams.forEach((function(t){var r=t.getTracks().find((function(e){return e.id===T.rtpReceiver.track.id}));r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)})),T.associatedRemoteMediaStreams=[]),T.localCapabilities=w,T.remoteCapabilities=k,T.rtpReceiver=I,T.rtcpParameters=P,T.sendEncodingParameters=O,T.recvEncodingParameters=L,l._transceive(l.transceivers[c],!1,B)}}})),void 0===l._dtlsRole&&(l._dtlsRole="offer"===i.type?"active":"passive"),l._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(u).forEach((function(t){var r=u[t];if(r.getTracks().length){if(-1===l.remoteStreams.indexOf(r)){l.remoteStreams.push(r);var o=new Event("addstream");o.stream=r,e.setTimeout((function(){l._dispatchEvent("addstream",o)}))}h.forEach((function(e){var t=e[0],o=e[1];r.id===e[2].id&&d(l,t,o,[r])}))}})),h.forEach((function(e){e[2]||d(l,e[0],e[1],[])})),e.setTimeout((function(){l&&l.transceivers&&l.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&e.iceTransport.addRemoteCandidate({})}))}),4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},l.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter((function(e){return"audio"===e.kind})).length,s=r.transceivers.filter((function(e){return"video"===e.kind})).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(n=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(s=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)}));n>0||s>0;)n>0&&(r._createTransceiver("audio"),n--),s>0&&(r._createTransceiver("video"),s--);var d=o.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach((function(i,n){var s=i.track,a=i.kind,c=i.mid||o.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(n,r.usingBundle));var d=e.RTCRtpSender.getCapabilities(a);t<15019&&(d.codecs=d.codecs.filter((function(e){return"rtx"!==e.name}))),d.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),d.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var l=i.sendEncodingParameters||[{ssrc:1001*(2*n+1)}];s&&t>=15019&&"video"===a&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=d,i.sendEncodingParameters=l})),"max-compat"!==r._config.bundlePolicy&&(d+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",r.transceivers.forEach((function(e,t){d+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,d+="a="+o.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))}));var l=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(l)},l.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var s=o.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(s+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n";var a=o.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(e,o){if(!(o+1>a)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?s+="m=application 0 DTLS/SCTP 5000\r\n":s+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var d=n(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,s+=i(e,d,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}}));var d=new e.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(d)},l.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,n){if(!r._remoteDescription)return n(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<r.transceivers.length;d++)if(r.transceivers[d].mid===e.sdpMid){s=d;break}var l=r.transceivers[s];if(!l)return n(c("OperationError","Can not add ICE candidate"));if(l.rejected)return i();var u=Object.keys(e.candidate).length>0?o.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return i();if(u.component&&1!==u.component)return i();if((0===s||s>0&&l.iceTransport!==r.transceivers[0].iceTransport)&&!a(l.iceTransport,u))return n(c("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),(t=o.getMediaSections(r._remoteDescription.sdp))[s]+="a="+(u.type?h:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=o.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var p=0;p<r.transceivers.length&&(r.transceivers[p].rejected||(r.transceivers[p].iceTransport.addRemoteCandidate({}),(t=o.getMediaSections(r._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=o.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));p++);i()}))},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)})),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var o=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&o.push(e[t].getStats())}))})),Promise.all(o).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var o=r.prototype.getStats;r.prototype.getStats=function(){return o.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(r){var o;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(o=e[r]).type]||o.type,t.set(r,e[r])})),t}))}}}));var u=["createOffer","createAnswer"];return u.forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),l}},{sdp:17}],17:[function(e,t,r){"use strict";var o={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};o.localCName=o.generateIdentifier(),o.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},o.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},o.getDescription=function(e){var t=o.splitSections(e);return t&&t[0]},o.getMediaSections=function(e){var t=o.splitSections(e);return t.shift(),t},o.matchPrefix=function(e,t){return o.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},o.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},o=8;o<t.length;o+=2)switch(t[o]){case"raddr":r.relatedAddress=t[o+1];break;case"rport":r.relatedPort=parseInt(t[o+1],10);break;case"tcptype":r.tcpType=t[o+1];break;case"ufrag":r.ufrag=t[o+1],r.usernameFragment=t[o+1];break;default:r[t[o]]=t[o+1]}return r},o.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},o.parseIceOptions=function(e){return e.substr(14).split(" ")},o.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},o.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},o.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},o.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},o.parseFmtp=function(e){for(var t,r={},o=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<o.length;i++)r[(t=o[i].trim().split("="))[0].trim()]=t[1];return r},o.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var o=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?o.push(t+"="+e.parameters[t]):o.push(t)})),t+="a=fmtp:"+r+" "+o.join(";")+"\r\n"}return t},o.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},o.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},o.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},o=e.indexOf(":",t);return o>-1?(r.attribute=e.substr(t+1,o-t-1),r.value=e.substr(o+1)):r.attribute=e.substr(t+1),r},o.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},o.getMid=function(e){var t=o.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},o.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},o.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:o.matchPrefix(e+t,"a=fingerprint:").map(o.parseFingerprint)}},o.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},o.getIceParameters=function(e,t){var r=o.splitLines(e);return{usernameFragment:(r=r.concat(o.splitLines(t))).filter((function(e){return 0===e.indexOf("a=ice-ufrag:")}))[0].substr(12),password:r.filter((function(e){return 0===e.indexOf("a=ice-pwd:")}))[0].substr(10)}},o.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},o.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=o.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var n=r[i],s=o.matchPrefix(e,"a=rtpmap:"+n+" ")[0];if(s){var a=o.parseRtpMap(s),c=o.matchPrefix(e,"a=fmtp:"+n+" ");switch(a.parameters=c.length?o.parseFmtp(c[0]):{},a.rtcpFeedback=o.matchPrefix(e,"a=rtcp-fb:"+n+" ").map(o.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return o.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(o.parseExtmap(e))})),t},o.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){r+=o.writeRtpMap(e),r+=o.writeFmtp(e),r+=o.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){r+=o.writeExtmap(e)})),r},o.parseRtpEncodingParameters=function(e){var t,r=[],i=o.parseRtpParameters(e),n=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=a.length>0&&a[0].ssrc,d=o.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var o={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(o.rtx={ssrc:t}),r.push(o),n&&((o=JSON.parse(JSON.stringify(o))).fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},r.push(o))}})),0===r.length&&c&&r.push({ssrc:c});var l=o.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=l}))),r},o.parseRtcpParameters=function(e){var t={},r=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=o.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var n=o.matchPrefix(e,"a=rtcp-mux");return t.mux=n.length>0,t},o.parseMsid=function(e){var t,r=o.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var i=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},o.generateSessionId=function(){return Math.random().toString().substr(2,21)},o.writeSessionBoilerplate=function(e,t,r){var i=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||o.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},o.writeMediaSection=function(e,t,r,i){var n=o.writeRtpDescription(e.kind,t);if(n+=o.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=o.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",e.direction?n+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?n+="a=sendrecv\r\n":e.rtpSender?n+="a=sendonly\r\n":e.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";n+="a="+s,n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+o.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+o.localCName+"\r\n"),n},o.getDirection=function(e,t){for(var r=o.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?o.getDirection(t):"sendrecv"},o.getKind=function(e){return o.splitLines(e)[0].split(" ")[0].substr(2)},o.isRejected=function(e){return"0"===e.split(" ",2)[1]},o.parseMLine=function(e){var t=o.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},o.parseOLine=function(e){var t=o.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},o.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=o.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=o)},{}]},{},[1])(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryHandler=void 0;var o=function(){function e(){this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,r,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof o&&(this.RETRY_MAX_TIME_INTERVAL=o)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.RetryHandler=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.handlerListMap={microphoneStateUpdate:[]}}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.addEventHandler=function(e,t){if(!this.handlerListMap[e])return!1;if("function"!=typeof t)throw new Error("Params callBack is not a Function");return-1==this.handlerListMap[e].indexOf(t)&&this.handlerListMap[e].push(t),!0},e.prototype.removeEventHandler=function(e,t){return!!this.handlerListMap[e]&&(this.handlerListMap[e]=t?this.handlerListMap[e].filter((function(e){return e!==t})):[],!0)},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.handlerListMap[e]&&this.handlerListMap[e].forEach((function(e){try{setTimeout((function(){e.apply(void 0,t)}),0)}catch(e){}}))},e}();t.default=o},function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=t.ZegoExpressEngine=void 0;var n=r(7),s=r(8),a=function(e){function t(t,r){var o=this;return n.ZegoExpressWebRTMEngine.version="2.10.1",(o=e.call(this,t,r)||this).zegoWebRTC=new s.ZegoWebRTC(o.logger,o.dataReport,o.zegoWebRTM),o}return i(t,e),t.use=function(e){s.ZegoWebRTC.use(e)},t.prototype.checkSystemRequirements=function(e,t){return void 0===t&&(t=0),this.zegoWebRTC.checkSystemRequirements(t,e)},t.prototype.off=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.off(e,t):!!this.zegoWebRTC.stateCenter.listenerList[e]&&this.zegoWebRTC.off(e,t)},t.prototype.on=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.on(e,t):!!this.zegoWebRTC.stateCenter.listenerList[e]&&this.zegoWebRTC.on(e,t)},t.prototype.createStream=function(e){return this.zegoWebRTC.createStream(e)},t.prototype.destroyStream=function(e){return this.zegoWebRTC.destroyStream(e)},t.prototype.startPublishingStream=function(e,t,r){return this.zegoWebRTC.startPublishingStream(e,t,r)},t.prototype.stopPublishingStream=function(e){return this.zegoWebRTC.stopPublishingStream(e)},t.prototype.setVideoConfig=function(e,t){return this.zegoWebRTC.setVideoConfig(e,t)},t.prototype.setAudioConfig=function(e,t){return this.zegoWebRTC.setAudioConfig(e,t)},t.prototype.replaceTrack=function(e,t){return this.zegoWebRTC.replaceTrack(e,t)},t.prototype.setCaptureVolume=function(e,t){return this.zegoWebRTC.setCaptureVolume(e,t)},t.prototype.setStreamExtraInfo=function(e,t){return this.zegoWebRTC.setStreamExtraInfo(e,t)},t.prototype.addPublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWebRTC.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.addPublishCdnUrl(e,t)},t.prototype.removePublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWebRTC.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.removePublishCdnUrl(e,t)},t.prototype.mutePublishStreamVideo=function(e,t,r){return this.zegoWebRTC.mutePublishStreamVideo(e,t,r)},t.prototype.mutePublishStreamAudio=function(e,t){return this.zegoWebRTC.mutePublishStreamAudio(e,t)},t.prototype.startPlayingStream=function(e,t){return this.zegoWebRTC.startPlayingStream(e,t)},t.prototype.stopPlayingStream=function(e){return this.zegoWebRTC.stopPlayingStream(e)},t.prototype.mutePlayStreamVideo=function(e,t){return this.zegoWebRTC.mutePlayStreamVideo(e,t)},t.prototype.mutePlayStreamAudio=function(e,t){return this.zegoWebRTC.mutePlayStreamAudio(e,t)},t.prototype.startMixerTask=function(e){return this.zegoWebRTC.startMixerTask(e)},t.prototype.stopMixerTask=function(e){return this.zegoWebRTC.stopMixerTask(e)},t.prototype.setMixerTaskConfig=function(e){return this.zegoWebRTC.setMixerTaskConfig(e)},t.prototype.startMixingAudio=function(e,t){return this.zegoWebRTC.startMixingAudio(e,t)},t.prototype.stopMixingAudio=function(e,t){return this.zegoWebRTC.stopMixingAudio(e,t)},t.prototype.setMixingAudioVolume=function(e,t,r){return this.zegoWebRTC.setMixingAudioVolume(e,t,r)},t.prototype.enumDevices=function(){return this.zegoWebRTC.enumDevices()},t.prototype.useVideoDevice=function(e,t){return this.zegoWebRTC.useVideoDevice(e,t)},t.prototype.useAudioDevice=function(e,t){return this.zegoWebRTC.useAudioDevice(e,t)},t.prototype.setSoundLevelDelegate=function(e,t){return this.zegoWebRTC.setSoundLevelDelegate(e,t)},t.prototype.isMicrophoneMuted=function(){return this.zegoWebRTC.isMicrophoneMuted()},t.prototype.muteMicrophone=function(e){return this.zegoWebRTC.muteMicrophone(e)},t.prototype.createRangeAudioInstance=function(){return this.zegoWebRTC.createRangeAudioInstance()},t}(n.ZegoExpressWebRTMEngine);t.ZegoExpressEngine=a;var c=r(3);Object.defineProperty(t,"ClientUtil",{enumerable:!0,get:function(){return c.ClientUtil}})},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckModule=void 0;var n=r(6),s=function(){function e(){var e=this;this.iceconnectionstatechangeTimes=0,this.isCheckAll=!1;var t=document.createElement("canvas");t.getContext("2d").fillStyle="rgba(255, 255, 255, 0)";try{this.localStream=t.captureStream()}catch(e){}this.timer=setTimeout((function(){e.resolve("Detection timeout"),e.hangup()}),5e3)}return e.prototype.checkSupportByType=function(e){return o(this,void 0,void 0,(function(){var t,r,o=this;return i(this,(function(i){switch(i.label){case 0:return this.checkType=e,t={},this.localPc=new RTCPeerConnection(t),this.remotePc=new RTCPeerConnection(t),r=new Promise((function(e){return o.resolve=e})),this.localPc.addEventListener("icecandidate",(function(e){return o.onIceCandidate(o.localPc,e)})),this.remotePc.addEventListener("icecandidate",(function(e){return o.onIceCandidate(o.remotePc,e)})),this.remotePc.addEventListener("iceconnectionstatechange",(function(t){"connected"===o.remotePc.iceConnectionState&&(o.iceconnectionstatechangeResult=!0),2==++o.iceconnectionstatechangeTimes&&o.iceCandidate&&(clearTimeout(o.timer),"connected"===o.remotePc.iceConnectionState?o.resolve(!0):o.resolve("The browser does not support "+e+" format"),o.hangup())})),this.localStream.getTracks().forEach((function(e){return o.localPc.addTrack(e,o.localStream)})),[4,this.check(e)];case 1:return i.sent(),[4,r];case 2:return[2,i.sent()]}}))}))},e.prototype.check=function(e){return o(this,void 0,void 0,(function(){var t,r;return i(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.localPc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 1:return(t=o.sent()).sdp=n.SdpUtil.getSDPByVideDecodeType(t.sdp,e),this.onCreateOfferSuccess(t),[3,3];case 2:return r=o.sent(),this.onCreateSessionDescriptionError(r),[3,3];case 3:return[2]}}))}))},e.prototype.onCreateOfferSuccess=function(e){return o(this,void 0,void 0,(function(){var t,r,o,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.localPc.setLocalDescription(e)];case 1:return i.sent(),[3,3];case 2:return t=i.sent(),this.onSetSessionDescriptionError(t),[2];case 3:return i.trys.push([3,5,,6]),[4,this.remotePc.setRemoteDescription(e)];case 4:return i.sent(),[3,6];case 5:return r=i.sent(),this.onSetSessionDescriptionError(r),[2];case 6:return i.trys.push([6,9,,10]),[4,this.remotePc.createAnswer()];case 7:return o=i.sent(),[4,this.onCreateAnswerSuccess(o)];case 8:return i.sent(),[3,10];case 9:return n=i.sent(),this.onCreateSessionDescriptionError(n),[2];case 10:return[2]}}))}))},e.prototype.onCreateAnswerSuccess=function(e){return o(this,void 0,void 0,(function(){var t,r;return i(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.remotePc.setLocalDescription(e)];case 1:return o.sent(),[3,3];case 2:return t=o.sent(),this.onSetSessionDescriptionError(t),[2];case 3:return o.trys.push([3,5,,6]),[4,this.localPc.setRemoteDescription(e)];case 4:return o.sent(),[3,6];case 5:return r=o.sent(),this.onSetSessionDescriptionError(r),[2];case 6:return[2]}}))}))},e.prototype.onIceCandidate=function(e,t){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.getOtherPc(e).addIceCandidate(t.candidate)];case 1:return o.sent(),[3,3];case 2:return r=o.sent(),clearTimeout(this.timer),this.hangup(),this.resolve(r),[3,3];case 3:return"remotePc"===this.getPcName(e)&&t.candidate&&(this.iceCandidate=!0),this.iceconnectionstatechangeResult&&"localPc"===this.getPcName(e)&&(clearTimeout(this.timer),this.hangup(),this.resolve(!0)),[2]}}))}))},e.prototype.getOtherPc=function(e){return e===this.localPc?this.remotePc:this.localPc},e.prototype.getPcName=function(e){return e===this.localPc?"localPc":"remotePc"},e.prototype.onCreateSessionDescriptionError=function(e){clearTimeout(this.timer),this.hangup(),this.resolve(e)},e.prototype.onSetSessionDescriptionError=function(e){clearTimeout(this.timer),this.hangup(),this.resolve(e)},e.prototype.hangup=function(){this.localPc.close(),this.remotePc.close(),this.iceconnectionstatechangeTimes=0,this.localStream.getTracks().forEach((function(e){return e.stop()}))},e}();t.CheckModule=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var o=r(0),i=r(2),n=r(0),s=r(1),a=function(){function e(e,t){this.logger=e,this.dataReport=t,this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.callbackList={},this.publishStreamList={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnOverTcpOnly=!1,this.customSetTcpOrUdp=!1,this.supportUdp=!1,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],capturedSoundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.mixStreamAdvance={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.networkState=n.ENUM_NETWORK_STATE.offline,this.streamRetryTime=300,this.checkList=[],this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamConnectTime=0,this.clientIP="",this.type="PUBLIC",this.roomList=[],this.isMultiRoom=!1}return e.prototype.getRequestId=function(){return this.idName+"-"+n.getSeq()},e.prototype.getSignalCmdContent=function(e,t,r,o){var i={request_id:t,room_id:e,from_userid:this.idName,from_username:this.nickName,to_userid:r};return null!=o&&(i.result=o),JSON.stringify(i)},e.prototype.actionListener=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(!["playQualityUpdate","publishQualityUpdate","soundLevelUpdate","capturedSoundLevelUpdate"].includes(e)&&this.listenerList[e]){var a=o.getReportSeq();this.dataReport.newReport(a,s.ZegoRTCLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(a,{listener:e,params:r}),this.dataReport.uploadReport(a)}this.listenerList[e]&&this.listenerList[e].forEach((function(o){try{setTimeout((function(){o.apply(void 0,r)}),0)}catch(r){t.logger.error(i.ZEGO_WEBRTC_ACTION.STATECENTER_ACTION_LISTENER+" "+e+" "+r)}}))},e.prototype.getRoomByRoomID=function(e){return this.roomList.find((function(t){return t.roomID==e}))},e.prototype.getPlayRoom=function(e){return this.roomList.find((function(t){return!!t.streamList.find((function(t){return t.stream_id==e}))}))},e}();t.StateCenter=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaUtil=void 0;var o=r(3),i=function(){function e(e,t){var r=this,o=t.type,i=t.channels,n=void 0===i?1:i,s=t.bufferSize,a=void 0===s?0:s,c=t.sampleBit,d=void 0===c?16:c,l=t.sampleRate,u=void 0===l?44100:l;this.instant=0,this.slow=0,this.clip=0,this.context=e,this.type=o,this.channels=n,this.bufferSize=a,this.sampleBit=d,this.sampleRate=u,this.script=e.createScriptProcessor(a,n,n),(new Date).getTime(),this.script.addEventListener("audioprocess",(function(e){var t,i=e.inputBuffer.getChannelData(0),n=0,s=0;for(t=0;t<i.length;++t)n+=i[t]*i[t],Math.abs(i[t])>.99&&(s+=1);if(r.instant=Math.sqrt(n/i.length),r.slow=.95*r.slow+.05*r.instant,r.clip=s/i.length,"pcm"===o||"wav"===o){for(var a=[],c=0;c<r.channels;c++)a.push(e.inputBuffer.getChannelData(c));r.recorderBuffer(a)}})),"pcm"!==o&&"wav"!==o||this.initRecorderBuffer(o)}return e.prototype.connectToSource=function(e,t){try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),void 0!==t&&t(null)}catch(e){void 0!==t&&t(e)}return this},e.prototype.recorderBuffer=function(e){this.worker.postMessage({command:"record",val:e})},e.prototype.initRecorderBuffer=function(e){var t=this;this.worker=o.ClientUtil.inlineWorker((function(){var e,t,r,o,i,n,s=[],a=this;function c(e,t,r){for(var o=0;o<r.length;o++,t+=2){var i=Math.max(-1,Math.min(1,r[o]));e.setInt16(t,i<0?32768*i:32767*i,!0)}}function d(e,t,r){for(var o=0;o<r.length;o++,t++){var i=Math.max(-1,Math.min(1,r[o])),n=i<0?128*i:127*i;n+=128,e.setInt8(t,n)}}function l(e,t,r){for(var o=0;o<r.length;o++)e.setUint8(t+o,r.charCodeAt(o))}function u(e,t){for(var r=new Float32Array(t.length/e),o=0,i=0;o<r.length;)r[o]=t[i],i+=e,o++;return r}function h(e,t,r){for(var o=new Float32Array(t*e.length),i=0,n=0;n<r[0].length;n++)o.set(r[0][n],i),i+=r[0][n].length;return o}function p(e,t){for(var r=new Float32Array(e.length+t.length),o=0;o<e.length+t.length;o+=2)r[o]=e[o/2>>0],r[o+1]=t[o/2>>0];return r}function f(t){var r,o;if(1==e)r=h(s[0],i,s),1!=t&&(o=u(t,r));else if(2==e){var n=h(s[0],i,s),a=h(s[1],i,s);1!=t?o=p(u(t,n),u(t,a)):r=p(n,a)}return 1!=t?o:r}function g(e){var r=function(e,r){var o;8==r?o=e.length:16==r&&(o=e.length,o*=2);var i=new ArrayBuffer(o),n=new DataView(i);return 8==r?d(n,0,e):16==t&&c(n,0,e),n}(f(e),t);a.postMessage({command:"exportPcmLive",val:r})}function m(o){var i=function(o,i){var n;8==i?n=o.length:16==t&&(n=o.length,n*=2);var s=new ArrayBuffer(n+44),a=new DataView(s),u=r,h=t,p=e;return l(a,0,"RIFF"),a.setUint32(4,36+n,!0),l(a,8,"WAVE"),l(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,p,!0),a.setUint32(24,u,!0),a.setUint32(28,u*p*(h/8),!0),a.setUint16(32,p*(h/8),!0),a.setUint16(34,h,!0),l(a,36,"data"),a.setUint32(40,n,!0),8==t?d(a,44,o):16==t&&c(a,44,o),a}(f(o),t);a.postMessage({command:"exportWav",val:i})}this.onmessage=function(a){switch(a.data.command){case"init":c=a.data.val,e=c.sampleChannel,t=c.sampleBit,r=c.sampleRate,o=c.oldSampleRate,i=c.bufferSize,n=c.type;break;case"record":!function(t){for(var i=0;i<e;i++)s[i]||(s[i]=[]),s[i].push(t[i]);var a=Math.round(o/r);"pcm"===n?g(a):"wav"===n&&m(a),s=[]}(a.data.val)}var c}})),this.worker.postMessage({command:"init",val:{sampleChannel:this.channels,sampleBit:this.sampleBit,sampleRate:this.sampleRate,oldSampleRate:this.context.sampleRate,bufferSize:this.bufferSize,type:e}}),this.worker.onmessage=function(e){switch(e.data.command){case"exportPcmLive":t.onReceiveBuffer(e.data.val);break;case"exportWav":t.onReceiveWav(e.data.val)}}},e.prototype.onReceiveBuffer=function(e){},e.prototype.onReceiveWav=function(e){},e.prototype.writeString=function(e,t,r){for(var o=0;o<r.length;o++)e.setUint8(t+o,r.charCodeAt(o))},e.prototype.writeBuffer=function(e,t,r){for(var o=0;o<r.byteLength;o++)e.setUint8(t+o,r[o])},e.prototype.concatenation=function(e){for(var t=0,r=0;r<e.length;++r)t+=e[r].buffer.byteLength;var o=new Uint8Array(t),i=0;for(r=0;r<e.length;++r)o.set(new Uint8Array(e[r].buffer),i),i+=e[r].buffer.byteLength;return o},e.prototype.encodeWave=function(e){var t=this.concatenation(e),r=t.byteLength,o=new ArrayBuffer(r+44),i=new DataView(o),n=this.sampleRate,s=this.sampleBit,a=this.channels;return this.writeString(i,0,"RIFF"),i.setUint32(4,36+r,!0),this.writeString(i,8,"WAVE"),this.writeString(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,a,!0),i.setUint32(24,n,!0),i.setUint32(28,n*a*(s/8),!0),i.setUint16(32,a*(s/8),!0),i.setUint16(34,s,!0),this.writeString(i,36,"data"),i.setUint32(40,r,!0),this.writeBuffer(i,44,t),i},e.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()},e}();t.MediaUtil=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCModules=void 0;var o=r(0),i=r(1),n=r(3),s=r(18),a=r(19),c=r(20),d=r(21),l=r(22),u=r(2),h=function(){function e(e,t,r,o,i,n){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=i,this.ac=n,this.mediaEleSources=[],this.publishModule=new a.PublishModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.playModule=new c.PlayModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.advancedModule=new l.AdvancedModule(this.logger,this.dataReport,this.streamCenter,this.stateCenter),this.audioMixModule=new d.AudioMixModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.ac),this.init()}return e.prototype.init=function(){this.bindWindowListener(),this.bindRTMListener(),this.bindStreamCenterHandler()},e.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),r=n.ClientUtil.getBrowser(),s=t?"pagehide":"Firefox"===r?"beforeunload":"unload";window.addEventListener(s,(function(){for(var t in window.event&&(window.event.cancelBubble=!0),e.streamCenter.publisherList)e.publishModule.stopPublishingStream(t);for(var t in e.streamCenter.playerList)e.playModule.stopPlayingStream(t)})),window.addEventListener("message",(function(t){var r=t.data,o=r.type,i=r.streamId,s=r.canRequestAudioTrack;"SS_DIALOG_SUCCESS"===o&&e.screenStreamFrom(i,s,n.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)),"SS_DIALOG_CANCEL"===o&&n.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)(!1,null,o)})),window.addEventListener("offline",(function(){for(var t in e.logger.info("zc.off.0 newtwork is broken"),e.stateCenter.networkState=o.ENUM_NETWORK_STATE.offline,e.streamCenter.publisherList)(r=e.streamCenter.publisherList[t].retryStreamHandler).startMaxTime(),r.invalid();for(var t in e.streamCenter.playerList){var r;(r=e.streamCenter.playerList[t].retryStreamHandler).startMaxTime(),r.invalid()}})),window.addEventListener("online",(function(t){for(var r in e.logger.info("zc.on.0 network is online"),e.stateCenter.networkState=o.ENUM_NETWORK_STATE.online,e.streamCenter.publisherList){var n=e.streamCenter.publisherList[r].publisher,s=e.streamCenter.publisherList[r].retryStreamHandler;n.state==o.ENUM_PUBLISH_STATE.stop||n.stateNego!==o.ENUM_PUBLISH_STATE_NEGO.iceConnected?!s.isOverTime&&s.publishStateHandle(o.ENUM_PUBLISH_STATE_UPDATE.error,r,i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNetworkBrokenError):n.state==o.ENUM_PUBLISH_STATE.publishing&&s.stopMaxTime()}for(var r in e.streamCenter.playerList){var a=e.streamCenter.playerList[r].player;s=e.streamCenter.playerList[r].retryStreamHandler,a.state==o.ENUM_PLAY_STATE.stop||a.stateNego!==o.ENUM_PLAY_STATE_NEGO.iceConnected?!s.isOverTime&&s.playStateHandle(o.ENUM_PLAY_STATE_UPDATE.error,r,i.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNetworkBrokenError):a.state==o.ENUM_PLAY_STATE.playing&&s.stopMaxTime()}})),window.addEventListener("visibilitychange",(function(t){if(Object.keys(e.streamCenter.publisherList).length>0||Object.keys(e.streamCenter.playerList).length>0){var r=o.getReportSeq();e.dataReport.newReport(r,i.ZegoRTCLogEvent.kZegoVisibilityChange.event),e.dataReport.uploadReport(r)}}))},e.prototype.bindRTMListener=function(){var e,t,r=this;this.rtm._on("roomLoginResponse",(function(e){r.logger.info("zc.rlr call "+JSON.stringify(e));var t=e.header.room_id;r.stateCenter.appid=r.rtm.getAppID(),r.stateCenter.idName=r.rtm.getUserID(),r.stateCenter.testEnvironment=r.rtm.isTestEnvironment(),r.stateCenter.isMultiRoom=r.rtm.getMultiRoom(),r.streamCenter.setSessionInfo(r.stateCenter.appid,r.stateCenter.idName,r.stateCenter.testEnvironment);var o=r.rtm.getToken(t),i=r.rtm.getSessionId(t),n=r.rtm.getRoomSessionID(t),a=r.stateCenter.getRoomByRoomID(t);if(!a){var c=new s.StreamHandler(r.logger,r.stateCenter,r.rtm,r.dataReport,r.streamCenter,t);r.bindStreamHandler(c),a={roomID:t,streamHandler:c,sessionID:i,roomSessionID:n,token:o,isResetRoom:!1,streamList:[],streamInfoList:[]},r.stateCenter.roomList.push(a),c.handleStreamStart(e,a)}a.sessionID=i,a.roomSessionID=n,r.logger.info("zc.rlr end "+t)})),this.rtm._on("HBResponse",(function(e){var t,o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,i=r.stateCenter.getRoomByRoomID(o);"PUBLIC"===r.stateCenter.type&&(null==i||i.streamHandler.patchStreamList(e))})),this.rtm._on("_roomStateUpdate",(function(e,t,o,i){if("DISCONNECTED"==t){r.logger.info("zc.rsu "+e+" disconnected "+(o?o+" ":"")+(i||""));var n=r.stateCenter.getRoomByRoomID(e);if(n){var s=r.stateCenter.roomList.findIndex((function(t){return t.roomID==e}));n.isResetRoom=!0,n.streamHandler.reset(),r.streamCenter.reset(e),r.stateCenter.roomList.splice(s,1)}}else r.logger.info("zc.rsu "+e+" state: "+t)})),this.rtm._on("_tokenRenewed",(function(e,t){r.logger.info("zc.tr roomID:"+t+" "+e);var o=r.stateCenter.getRoomByRoomID(t);o&&(o.token=e)})),this.rtm.service.on("stream",(function(e){var t,o=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",i=r.stateCenter.getRoomByRoomID(o);i?i.streamHandler.handleStreamUpdateRsp(e):r.logger.error(u.ZEGO_WEBRTC_ACTION.ON_STREAM+" room no found")})),null===(e=this.rtm.service)||void 0===e||e.on("push_stream_update",(function(e){var t,o=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",i=r.stateCenter.getRoomByRoomID(o);i?i.streamHandler.handlePushStreamUpdateMsg(e):r.logger.error(u.ZEGO_WEBRTC_ACTION.ON_PUSH_STREAM_UPDATE+" room no found")})),null===(t=this.rtm.service)||void 0===t||t.on("zegochat_js.push_room_stream_update_req",(function(e){var t,o=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",i=r.stateCenter.getRoomByRoomID(o);i?i.streamHandler.handlePriPushStreamUpdateMsg(e):r.logger.error(u.ZEGO_WEBRTC_ACTION.ON_STREAM+" room no found")}))},e.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,i){var s=e.stateCenter.reportSeqList.startPlay[r],a=e.streamCenter.playerList[r];if(1==t&&a&&n.ClientUtil.isReDispatch(i)){var c=a.player,d=a.retryDispatchHandler,l=a.playOption;return 0!=c.sessionId&&c.signal&&c.shouldSendCloseSession()&&(c.signal.sendCloseSession(o.getSeq(),c.sessionId,1),c.signal.removeSession(c.sessionId),c.closeSessionSignal=!0),c.resetPlay(),d.stopMaxTime(),d.invalid(),d.initStream(r,l,!1),void(e.rtm.isLogin()?(d.startMaxTime(),d.active(0)):e.streamCenter.playerList[r].isReDispatch=!0)}a&&a.player&&(0==t||1==t)&&s&&(e.dataReport.eventEndWithMsgInfo(s,"PlayState",{type:t}),1==t&&i&&e.dataReport.addMsgInfo(s,i),e.dataReport.uploadReport(s),delete e.stateCenter.reportSeqList.startPlay[r]),1===t&&e.streamCenter.playErrorCallBackList[r]&&(e.streamCenter.playErrorCallBackList[r]({errorCode:i&&i.code,extendedData:i&&i.message}),delete e.streamCenter.playErrorCallBackList[r],e.logger.info("zc.opsu.1 stop play called by sdk"),e.playModule.stopPlayingStream(r)),e.stateCenter.actionListener("playerStateUpdate",{state:n.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:i&&i.code,extendedData:i&&i.message})},this.streamCenter.onPublishStateUpdate=function(t,r,o){e.onPublishStateUpdateHandle(t,r,o)},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener("publishQualityUpdate",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener("playQualityUpdate",t,r)},this.streamCenter.onRemoteCameraStatusUpdate=function(t,r,n){var s=o.getReportSeq();e.dataReport.newReport(s,i.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.event),e.dataReport.addMsgInfo(s,{stream:i.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.stream(t),status:i.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.status(r)}),e.dataReport.uploadReport(s),e.stateCenter.actionListener("remoteCameraStatusUpdate",t,r),e.stateCenter.actionListener("_remoteCameraStatusUpdate",t,n)},this.streamCenter.onRemoteMicStatusUpdate=function(t,r,n){var s=o.getReportSeq();e.dataReport.newReport(s,i.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.event),e.dataReport.addMsgInfo(s,{stream:i.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.stream(t),status:i.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.status(r)}),e.dataReport.uploadReport(s),e.stateCenter.actionListener("remoteMicStatusUpdate",t,r),e.stateCenter.actionListener("_remoteMicStatusUpdate",t,n)},this.streamCenter.onSoundLevelUpdate=function(t){e.stateCenter.actionListener("soundLevelUpdate",t)},this.streamCenter.onMicSoundLevelUpdate=function(t){e.stateCenter.actionListener("capturedSoundLevelUpdate",t)}},e.prototype.bindStreamHandler=function(e){var t=this;e.onStreamUpdated=function(e,r,s){var a;a="PRIVATE"===t.stateCenter.type?s.map((function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info,title:e.title,streamVer:e.stream_ver}})):s.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo,urlsFLV:e.urlFlv,urlsRTMP:e.urlRtmp,urlsHLS:e.urlHls,urlsHttpsFLV:e.urlHttpsFlv,urlsHttpsHLS:e.urlHttpsHls}}));var c={};if(0===r){var d=s.map((function(e){return{stream_id:e.streamID,code:o.STREAM_DELETE_REASON[e.closeType]&&o.STREAM_DELETE_REASON[e.closeType].code||0,description:o.STREAM_DELETE_REASON[e.closeType]&&o.STREAM_DELETE_REASON[e.closeType].description||"unknown"}}));c.stream_delete_reason=d}var l=o.getReportSeq();if(t.dataReport.newReport(l,i.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.event),t.dataReport.addMsgInfo(l,{stream_update_type:i.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.stream_update_type(1===r?"added":"deleted"),update_stream:i.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.update_stream(a)}),t.dataReport.uploadReport(l),t.stateCenter.actionListener("roomStreamUpdate",e,n.ClientUtil.getSteamUpdateType(r),a,Object.keys(c).length>0?JSON.stringify(c):""),t.stateCenter.actionListener("_streamUpdated",r,s),1===r){var u=[];a.forEach((function(e){e.extraInfo&&u.push({streamID:e.streamID,user:e.user,extraInfo:e.extraInfo})})),u.length>0&&t.stateCenter.actionListener("streamExtraInfoUpdate",e,u)}},e.onPublishStateUpdate=function(e,r,o){t.logger.info("zb.opsu ",r);var i=t.stateCenter.reportSeqList.startPublish[r],s=t.streamCenter.publisherList[r];s&&s.publisher&&(0==e||1==e)&&i&&(t.dataReport.eventEndWithMsgInfo(i,"PublishState",{type:e}),1==e&&t.dataReport.addMsgInfo(i,o),t.dataReport.uploadReport(i),delete t.stateCenter.reportSeqList.startPublish[r]),t.stateCenter.actionListener("publisherStateUpdate",{state:n.ClientUtil.getPublisherStateType(e),streamID:r,errorCode:o.code,extendedData:o.message})},e.onStreamExtraInfoUpdated=function(e,r){var n;n="PUBLIC"===t.stateCenter.type?r.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})):r.map((function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info,title:e.title,streamVer:e.stream_ver}}));var s=o.getReportSeq();t.dataReport.newReport(s,i.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.event),t.dataReport.addMsgInfo(s,{update_stream:i.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.update_stream(n)}),t.dataReport.uploadReport(s),t.stateCenter.actionListener("streamExtraInfoUpdate",e,n)}},e.prototype.screenStreamFrom=function(e,t,r){var o={};o.audio={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}},o.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:window.screen.width,maxHeight:window.screen.height}},!t&&(o.audio=!1),navigator.mediaDevices.getUserMedia(o).then((function(e){r(!0,e)})).catch((function(e){r(!1,null,e)}))},e.prototype.onPublishStateUpdateHandle=function(e,t,r){var i=this;this.logger.info("zc.opsuh.0 call");var s=this.streamCenter.publisherList[t],a=s.room;if(a)if(0==e){if(this.stateCenter.publishStreamList[t])if([o.ENUM_PUBLISH_STREAM_STATE.tryPublish,o.ENUM_PUBLISH_STREAM_STATE.retryPublish].includes(this.stateCenter.publishStreamList[t].state)&&!a.streamList.find((function(e){return e.stream_id==t}))){var c;this.stateCenter.publishStreamList[t].state=o.ENUM_PUBLISH_STREAM_STATE.update_info,c="PUBLIC"===this.stateCenter.type?o.ENUM_STREAM_SUB_CMD.liveBegin:o.ENUM_STREAM_CMD_PRI.liveBegin,a.streamHandler.updateStreamInfo(t,c,this.stateCenter.publishStreamList[t].extra_info,(function(e){"PRIVATE"===i.stateCenter.type&&i.stateCenter.publishStreamList[t]&&i.stateCenter.publishStreamList[t].state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(i.stateCenter.publishStreamList[t].state=o.ENUM_PUBLISH_STREAM_STATE.stop,a.streamHandler.onPublishStateUpdate(1,t,e),i.publishModule.stopPublishingStream(t))}))}else this.stateCenter.publishStreamList[t].state=o.ENUM_PUBLISH_STREAM_STATE.publishing,this.WebrtcOnPublishStateUpdateHandle(e,t,r)}else{if(1==e&&s&&n.ClientUtil.isReDispatch(r)){var d=s.publisher,l=s.retryDispatchHandler,u=s.publishOption;return 0!=d.sessionId&&d.signal&&d.shouldSendCloseSession()&&(d.signal.sendCloseSession(o.getSeq(),d.sessionId,1),d.signal.removeSession(d.sessionId),d.closeSessionSignal=!0),d.resetPublish(),l.stopMaxTime(),l.invalid(),l.initStream(t,u,!0),void(this.rtm.isLogin()?(l.startMaxTime(),l.active(0)):this.streamCenter.publisherList[t].isReDispatch=!0)}a.streamHandler.onPublishStateUpdate(e,t,r),1==e&&(this.logger.info("zc.opsuh.0 stop publish called by sdk"),this.publishModule.stopPublishingStream(t))}else this.logger.error("zc.opsuh.0 room not exist")},e.prototype.WebrtcOnPublishStateUpdateHandle=function(e,t,r){if(this.stateCenter.publishStreamList[t].state==o.ENUM_PUBLISH_STREAM_STATE.publishing){var i=this.streamCenter.getRoomByStreamID(t);i&&i.streamHandler.onPublishStateUpdate(e,t,r)}},e.prototype.bindListener=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error("zc.o.0 listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error("zc.o.0 event "+e+" no found"),!1)},e.prototype.deleteListener=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error("zc.o.1 listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e}();t.RTCModules=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamHandler=void 0;var o=r(0),i=r(3),n=r(0),s=r(1),a=r(4),c=r(2),d=function(){function e(e,t,r,o,i,n){this.logger=e,this.stateCenter=t,this.rtm=r,this.dataReport=o,this.streamCenter=i,this.roomID=n,this.minStreamSeq=0,this.streamSeq=0,this.streamQuerying=!1,this.streamSeqMergeMap=null,this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3}return e.prototype.setCDNInfo=function(e,t){e.urlFlv=t.urls_flv instanceof Array?t.urls_flv[0]:"string"==typeof t.urls_flv?t.urls_flv:"",e.urlHls=t.urls_m3u8 instanceof Array?t.urls_m3u8[0]:"string"==typeof t.urls_m3u8?t.urls_m3u8:"",e.urlHttpsFlv=t.urls_https_flv instanceof Array?t.urls_https_flv[0]:"string"==typeof t.urls_https_flv?t.urls_https_flv:"",e.urlHttpsHls=t.urls_https_m3u8 instanceof Array?t.urls_https_m3u8[0]:"string"==typeof t.urls_https_m3u8?t.urls_https_m3u8:"",e.urlRtmp=t.urls_rtmp instanceof Array?t.urls_rtmp[0]:"string"==typeof t.urls_rtmp?t.urls_rtmp:""},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e,t){this.logger.info("zb.sh.hss call stream update"),this.room=t,e.body?(this.streamListHBMergeInterval=e.body.stream_list_hb_wait_merge_time||2e3,this.streamListMergeInterval=e.body.stream_list_push_merge_timeout||5e3,this.streamQuerying=!1,this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info||[]),this.handleReconnectStream(e.body.stream_info),this.logger.info("zb.sh.hss call end")):this.logger.error("zb.sh.hss server response wrong")},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.updateStreamInfo=function(e,t,r,n){var s,c,d,l=this;if(void 0===r&&(r=""),this.logger.info("zb.sh.usi call"),"PUBLIC"===this.stateCenter.type){var u={stream_id:e,extra_info:r},h=JSON.stringify(u);c={sub_cmd:t,stream_msg:h,third_token:null===(s=this.room)||void 0===s?void 0:s.token},d="stream"}else c={room_header:{room_id:this.roomID,room_sid:this.rtm.getRoomSid()||"0",room_user_session_id:this.rtm.getRoomSessionID()||"0"},stream_id:e,extra_info:r,title:"",stream_sid:this.stateCenter.publishStreamList[e].sid},d=t;var p=this.room;this.room.streamInfoList[e]={},this.room.streamInfoList[e].seq=this.rtm.service.sendMessage(d,c,(function(e,t){l.handleStreamUpdateRsp(e)}),(function(s,c){var d=l.room;if(d&&!d.isResetRoom&&!l.rtm.service.isDisConnect()&&s.code&&s.code==a.errorCodeList.TIMEOUT.code&&d.streamInfoList[e].seq==c)2001==t&&l.stateCenter.publishStreamList[e]&&l.stateCenter.publishStreamList[e].state==o.ENUM_PUBLISH_STREAM_STATE.update_info||2002==t?setTimeout((function(){l.updateStreamInfo(e,t,r,n)}),0):n&&n(a.errorCodeList.TIMEOUT);else if(s.body&&s.body.err_code){var u=i.ClientUtil.getServerError(s.body.err_code);n&&n(u,c),t===o.ENUM_STREAM_SUB_CMD.liveBegin&&l.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.error,e,u)}}),void 0,{sessionID:null==p?void 0:p.sessionID,roomID:null==p?void 0:p.roomID,roomSessionID:null==p?void 0:p.roomSessionID}),this.logger.info("zb.sh.usi call success cmd "+t)},e.prototype.handleStreamUpdateRsp=function(e){if(this.rtm.service.isDisConnect())this.logger.error("zb.sh.hsur not login");else if(0==e.body.err_code){this.logger.info("zb.sh.hsur stream seq "+this.streamSeq+" server seq "+e.body.stream_seq),"PUBLIC"===this.stateCenter.type?this.streamSeq=e.body.stream_seq:this.streamSeq++;var t=this.room;if(t)if("PUBLIC"===this.stateCenter.type)for(var r=function(r){var n=e.body.stream_info[r].stream_id,s=i.stateCenter.publishStreamList[n];if(!s)return i.logger.info("hsur.0 stream is not exist"),{value:void 0};s.state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(s.state=o.ENUM_PUBLISH_STREAM_STATE.publishing,t.streamList.find((function(e){return e.stream_id==n}))||t.streamList.push(e.body.stream_info[r]),i.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.start,n,{code:0,message:""})),delete t.streamInfoList[n]},i=this,n=0;n<e.body.stream_info.length;n++){var s=r(n);if("object"==typeof s)return s.value}else{var a=e.body.stream_id;this.stateCenter.publishStreamList[a]&&this.stateCenter.publishStreamList[a].state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.stateCenter.publishStreamList[a].state=o.ENUM_PUBLISH_STREAM_STATE.publishing,this.stateCenter.publishStreamList[a].sid=e.body.stream_sid,this.stateCenter.publishStreamList[a].ver=e.body.stream_ver,t.streamList.find((function(e){return e.stream_id==a}))||t.streamList.push({stream_id:e.body.stream_id,stream_seq:e.body.stream_seq,stream_sid:e.body.stream_sid,stream_ver:e.body.stream_ver,user_id:"",user_name:""}),this.onPublishStateUpdate(0,a,{code:0,message:""})),delete t.streamInfoList[a]}else this.logger.info("hsur.0 room no found")}else this.logger.error("zb.sh.hsur stream update error "+e.body.err_code)},e.prototype.handleFetchStreamListRsp=function(e){this.logger.info("zb.sh.hfslr call"),this.streamQuerying=!1,0===e.body.err_code?this.streamSeq!==e.body.stream_seq?(this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info),this.logger.info("zb.sh.hfslr call success")):this.logger.info("zb.sh.hfslr same seq"):this.logger.info("zb.sh.hfslr server error=",e.body.err_code)},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.info("zb.sh.hfus call"),this.streamSeq=e,this.logger.debug("zb.sh.hfus server seq "+this.streamSeq),i.ClientUtil.mergeStreamList(this.stateCenter.idName,this.room.streamList,t,(function(e,t,i){0!==e.length&&(r.logger.debug("zb.sh.hfus callback addstream"),r.onStreamUpdated(r.roomID,o.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug("zb.sh.hfus callback delstream"),r.onStreamUpdated(r.roomID,o.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(t))),0!==i.length&&(r.logger.debug("zb.sh.hfus callback updatestream"),r.onStreamExtraInfoUpdated(r.roomID,r.makeCallbackStreamList(i)))})),this.logger.info("zb.sh.hfus call success")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.stream_info&&0!==e.body.stream_info.length){if(e.body.stream_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.fetchStreamList();switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case o.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handlePriPushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.streams_info&&0!==e.body.streams_info.length){if(e.body.streams_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.mergeStreamByStreamSeq(e.body.stream_cmd,e.body.stream_seq,e.body.streams_info);switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case o.ENUM_STREAM_UPDATE_CMD_PRI.added:this.handleAddedStreamList(e.body.streams_info);break;case o.ENUM_STREAM_UPDATE_CMD_PRI.deleted:this.handleDeletedStreamList(e.body.streams_info);break;case o.ENUM_STREAM_UPDATE_CMD_PRI.updated:this.handleUpdatedStreamList(e.body.streams_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handleAddedStreamList=function(e){this.logger.debug("zb.sh.hasl call");for(var t,r=[],i=0;i<e.length;i++)if(e[i].anchor_id_name!=this.stateCenter.idName&&e[i].user_id!==this.stateCenter.idName){t=!1;for(var n=0;n<this.room.streamList.length;n++)if(e[i].stream_id===this.room.streamList[n].stream_id){t=!0;break}t||r.push(e[i])}else this.logger.debug("hdsl.0 have self stream added");if(0!==r.length){this.logger.debug("zb.sh.hasl callback addstream");for(var s=0;s<r.length;s++)this.room.streamList.push(r[s]);this.onStreamUpdated(this.roomID,o.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info("zb.sh.hasl call success")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug("zb.sh.hdsl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var i=this.room.streamList.length-1;i>=0;i--)if(e[r].stream_id===this.room.streamList[i].stream_id){this.room.streamList.splice(i--,1),t.push(e[r]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");0!==t.length&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(this.roomID,o.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.hdsl call")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug("zb.sh.husl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var o=0;o<this.room.streamList.length;o++)if(e[r].stream_id===this.room.streamList[o].stream_id){e[r].extra_info!==this.room.streamList[o].extra_info&&(this.room.streamList[o]=e[r],t.push(e[r]));break}}else this.logger.debug("hsul.0 have self stream updated");0!==t.length&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.roomID,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.husl call success")},e.prototype.fetchStreamList=function(){if(this.logger.info("zb.sh.fsl call"),this.rtm.service.isDisConnect())this.logger.info("zb.sh.fsl state error");else if(this.streamQuerying)this.logger.info("zb.sh.fsl already doing");else if(this.streamQuerying=!0,this.logger.debug("zb.sh.fsl send fetch request"),"PUBLIC"===this.stateCenter.type){var e={reserve:0},t=this.room;this.rtm.service.sendMessage("stream_info",e,this.handleFetchStreamListRsp.bind(this),(function(e,t){}),void 0,{roomID:null==t?void 0:t.roomID,sessionID:null==t?void 0:t.sessionID,roomSessionID:null==t?void 0:t.roomSessionID}),this.logger.info("zb.sh.fsl call success")}else{if(!this.rtm.isLogin(this.roomID))return void this.logger.info("zb.sh.fsl room state error");e={room_header:{room_id:this.roomID,room_sid:this.rtm.getRoomSid()||"0",room_user_session_id:this.rtm.getRoomSessionID()||"0"}},this.rtm.service.sendMessage("zegochat_js.room_info_req",e,this.handleFetchStreamListRsp.bind(this),(function(e,t){}))}},e.prototype.handleReconnectStream=function(e){this.logger.info("zb.sh.hrs call");var t=this.streamCenter.publisherList,r=this.streamCenter.playerList,i=function(r){if(t[r].roomID!==n.roomID)return"continue";if(t[r].publisher.state!=o.ENUM_PUBLISH_STATE.publishing||e.find((function(e){return e.stream_id==r}))){if(t[r].publisher.state==o.ENUM_PUBLISH_STATE.stop&&e.find((function(e){return e.stream_id==r}))){s=void 0,s="PUBLIC"===n.stateCenter.type?o.ENUM_STREAM_SUB_CMD.liveEnd:o.ENUM_STREAM_CMD_PRI.liveEnd,n.updateStreamInfo(r,s);for(var i=0;i<n.room.streamList.length;i++)if(n.room.streamList[i].stream_id==r){n.room.streamList.splice(i--,1);break}}}else{var s=void 0;s="PUBLIC"===n.stateCenter.type?o.ENUM_STREAM_SUB_CMD.liveBegin:o.ENUM_STREAM_CMD_PRI.liveBegin,n.updateStreamInfo(r,s,n.stateCenter.publishStreamList[r].extra_info)}},n=this;for(var s in t)i(s);for(var s in t)t[s].roomID===this.roomID&&t[s].isReDispatch&&(this.logger.info("zb.sh.hrs "+s+"retry dispatch"),(a=t[s].retryDispatchHandler).stopMaxTime(),a.invalid(),a.initStream(s,t[s].publishOption,!0),a.active(0),t[s].isReDispatch=!1);for(var s in r){var a;r[s].roomID===this.roomID&&r[s].isReDispatch&&(this.logger.info("zb.sh.hrs "+s+"retry dispatch"),(a=r[s].retryDispatchHandler).stopMaxTime(),a.invalid(),a.initStream(s,r[s].playOption,!1),a.active(0),r[s].isReDispatch=!1)}this.logger.info("zb.sh.hrs end")},e.prototype.makeCallbackStreamList=function(e){var t=[];if("PUBLIC"===this.stateCenter.type){if(e&&e.length>0)for(var r=0;r<e.length;r++){var o={user:{userID:e[r].anchor_id_name,userName:e[r].anchor_nick_name},extraInfo:e[r].extra_info,streamID:e[r].stream_id,roomID:"",urlFlv:"",urlRtmp:"",urlHls:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:e[r].stream_gid,closeType:e[r].close_type};this.setCDNInfo(o,e[r]),t.push(o)}}else if(e&&e.length>0)for(r=0;r<e.length;r++)o={user_id:e[r].user_id,user_name:e[r].user_name,stream_id:e[r].stream_id,stream_sid:e[r].stream_sid,extra_info:e[r].extra_info,title:e[r].title,stream_ver:e[r].stream_ver},t.push(o);return t},e.prototype.updateMixStream=function(e,t,r){var c,d=this;if(this.logger.info("zb.sh.ums call"),!e.noTaskID&&!e.taskID)return this.logger.error("zb.sh.ums no taskId found"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.message}),!1;if(!e.noTaskID&&"string"!=typeof e.taskID)return this.logger.error("zb.rh.lg taskId must be string"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.noTaskID&&e.taskID.length>o.MAX_MIX_TASK_ID_LENGTH)return this.logger.error("zb.sh.ums taskId is too long"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.message}),!1;if(!e.noTaskID&&!i.ClientUtil.checkIllegalCharacters(e.taskID))return this.logger.error("zb.sh.ums task ID contains illegal characters"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.message}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error("zb.sh.ums input list wrong"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.message}),!1;e.inputList.forEach((function(e){"AUDIO"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)}));for(var l=e.inputList.every((function(e){return"AUDIO"===e.contentType})),u=0;u<e.inputList.length;u++){var h=e.inputList[u];if("object"!=typeof h.layout)return this.logger.error("zb.sh.ums input layout must be object"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!(i.ClientUtil.checkInteger(h.layout.top,!1)&&i.ClientUtil.checkInteger(h.layout.bottom,!1)&&i.ClientUtil.checkInteger(h.layout.left,!1)&&i.ClientUtil.checkInteger(h.layout.right,!1)))return this.logger.error("zb.sh.ums top、left、bottom、right must be integer number"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1}if(!e.outputList||0==e.outputList.length)return this.logger.error("zb.sh.ums no output list found"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.message}),!1;if(e.outputList.some((function(e){return"string"==typeof e&&!i.ClientUtil.isUrl(e)&&!i.ClientUtil.checkIllegalCharacters(e)||"object"==typeof e&&e.target&&!i.ClientUtil.isUrl(e.target)&&!i.ClientUtil.checkIllegalCharacters(e.target)})))return this.logger.error("zb.sh.ums stream output target is incorrect"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;if(!(l||e.outputConfig&&"object"==typeof e.outputConfig))return this.logger.error("zb.sh.ums no output config found"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.message}),!1;if(l&&(void 0===e.outputConfig&&(e.outputConfig={outputBitrate:0,outputFPS:0,outputWidth:0,outputHeight:0}),e.outputConfig.outputBitrate=.001,e.outputConfig.outputFPS=1,e.outputConfig.outputWidth=1,e.outputConfig.outputHeight=1),!(l||e.outputConfig.outputBitrate&&i.ClientUtil.checkInteger(e.outputConfig.outputBitrate)))return this.logger.error("zb.sh.ums bitrate param is required and must be integer number"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputFPS||!i.ClientUtil.checkInteger(e.outputConfig.outputFPS))return this.logger.error("zb.sh.ums fps param is required and must be integer number"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputWidth||!i.ClientUtil.checkInteger(e.outputConfig.outputWidth))return this.logger.error("zb.sh.ums width param is required and must be integer number"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputHeight||!i.ClientUtil.checkInteger(e.outputConfig.outputHeight))return this.logger.error("zb.sh.ums height param is required and must be integer number"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioCodecID&&!i.ClientUtil.checkInteger(e.outputConfig.outputAudioCodecID,!1))return this.logger.error("zb.sh.ums AudioCodecID param must be integer number"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioBitrate&&!i.ClientUtil.checkInteger(e.outputConfig.outputAudioBitrate))return this.logger.error("zb.sh.ums AudioBitrate param must be integer number"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioChannels&&!i.ClientUtil.checkInteger(e.outputConfig.outputAudioChannels,!1))return this.logger.error("zb.sh.ums AudioChannels param must be integer number"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;var p=0;e.outputConfig.singleStreamPassThrough&&"boolean"==typeof e.outputConfig.singleStreamPassThrough&&(p=e.outputConfig.singleStreamPassThrough?1:0);var f={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:o.PROTO_VERSION,bypass:p},g=this.stateCenter.mixStreamAdvance;g&&(g.videoCodec&&(f.extra_params=[{key:"video_encode",value:g.videoCodec}]),g.backgroundColor&&(f.output_bg_color=g.backgroundColor),g.backgroundImage&&(f.output_bg_image=g.backgroundImage),g.waterMark&&(f.watermark=g.waterMark),g.extraParams&&(!f.extra_params&&(f.extra_params=[]),(c=f.extra_params).push.apply(c,g.extraParams)));var m=[];for(u=0;u<e.inputList.length;u++){var _=e.inputList[u],v=_.streamID;this.stateCenter.testEnvironment&&(v="zegotest-"+this.stateCenter.appid+"-"+_.streamID),m.push({stream_id:v,content_control:"AUDIO"===_.contentType?1:0,rect:{layer:u,top:_.layout.top,left:_.layout.left,bottom:_.layout.bottom,right:_.layout.right}})}f.MixInput=m,i.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(n.REPORT_ACTION.addMsgInfo,void 0,{mix_stream_id:s.ZegoRTCLogEvent.kZegoTaskMixStart.mix_stream_id(e.taskID),stream_cnt:s.ZegoRTCLogEvent.kZegoTaskMixStart.stream_cnt(m.length),input_stream_list:s.ZegoRTCLogEvent.kZegoTaskMixStart.input_stream_list(m)});var E=[];e.outputList.forEach((function(t){var o={},i="";if("string"==typeof t)i=t;else{if("object"!=typeof t||!t.target)return d.logger.error("zb.sh.ums output target required"),r({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;i=t.target}i.startsWith("rtmp://")||i.startsWith("https://")&&i.endsWith(".flv")||i.startsWith("https://")&&i.endsWith(".m3u8")?o.mixurl=i:d.stateCenter.testEnvironment?o.stream_id="zegotest-"+d.stateCenter.appid+"-"+i:o.stream_id=i,o.bitrate=1e3*e.outputConfig.outputBitrate,o.fps=e.outputConfig.outputFPS,o.width=e.outputConfig.outputWidth,o.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID&&(o.audio_enc_id=e.outputConfig.outputAudioCodecID),"vp8"===g.videoCodec?o.audio_enc_id=3:"h264"===g.videoCodec&&(o.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(o.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(o.audio_channel_cnt=e.outputConfig.outputAudioChannels),d.stateCenter.testEnvironment?o.testenv=1:o.testenv=0,E.push(o)})),f.MixOutput=E,i.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(n.REPORT_ACTION.addMsgInfo,void 0,{output_target_list:s.ZegoRTCLogEvent.kZegoTaskMixStart.output_target_list(E)});var y={channel:"zeus",cmd:"start_mix",req_body:JSON.stringify(f)};return this.logger.debug("zb.sh.ums send command"),this.sendBizChannelRequest(y,(function(e,n,s){d.logger.debug("zb.sh.ums receive message");var a="zegotest-"+d.stateCenter.appid+"-";if(0!=s.length){for(var c=JSON.parse(s),l=[],u=0;u<c.play.length;u++){var h={rtmpURL:"",hlsURL:"",flvURL:""},p=c.play[u].stream_alias||"";d.stateCenter.testEnvironment&&p&&p.startsWith(a)&&(p=p.slice(a.length)),h.streamID=p,c.play[u].rtmp_url&&c.play[u].rtmp_url.length>0&&(h.rtmpURL=c.play[u].rtmp_url),c.play[u].hls_url&&c.play[u].hls_url.length>0&&(h.hlsURL=c.play[u].hls_url),c.play[u].hdl_url&&c.play[u].hdl_url.length>0&&(h.flvURL=c.play[u].hdl_url),l.push(h)}if(t){var f={mixerOutputList:l};t({errorCode:0,extendedData:JSON.stringify(f)})}}else r&&r({errorCode:i.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+1).code,extendedData:""})}),(function(e,t,o){if("number"==typeof e){d.logger.debug("zb.sh.ums error: "+e);var n=[];if(1000000150==e&&0!=o.length)for(var c=JSON.parse(o),l="zegotest-"+d.stateCenter.appid+"-",u=0;u<c.non_exist_streams.length;u++){var h=c.non_exist_streams[u];d.stateCenter.testEnvironment&&h.startsWith(l)?n.push(h.slice(l.length)):n.push(h)}r&&r({errorCode:i.ClientUtil.getServerError(e).code,extendedData:""})}else{var p;d.logger.debug("zb.sh.ums error code "+e.code),p=e==a.errorCodeList.TIMEOUT?s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,r&&r({errorCode:p.code,extendedData:p.message})}})),!0},e.prototype.sendBizChannelRequest=function(e,t,r,o){var i=this;void 0===o&&(o=!1),e=Object.assign(e,{is_retry_req:o?1:0});var n=this.room;this.rtm.service.sendMessage("biz_channel",e,(function(e,r){t(e.header.seq,e.body.cmd,e.body.rsp_body)}),(function(o,n){var s=o.body.err_code,a=o.body.rsp_body;"number"!=typeof s||2002!==s?r(s,n,a):i.sendBizChannelRequest(e,t,r,!0)}),void 0,{roomID:null==n?void 0:n.roomID,sessionID:null==n?void 0:n.sessionID,roomSessionID:null==n?void 0:n.roomSessionID})},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,o){var a,c={},d={};if(e&&e.videoCodec){var l=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(l))return t.logger.error("zb.sh.ums param videoCode error"),o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.message}),!1;c.videoCodec=l,d.video_codec=l}if(e.backgroundColor){if(!i.ClientUtil.checkInteger(e.backgroundColor))return t.logger.error("zb.sh.ums param backgroundColor must be integer number"),o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;c.backgroundColor=e.backgroundColor,d.background_color=e.backgroundColor}if(e.backgroundImage){if("string"!=typeof e.backgroundImage)return t.logger.error("zb.sh.ums param outputBgImage error"),o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(!e.backgroundImage.startsWith("preset-id://")||!e.backgroundImage.endsWith(".jpg")&&!e.backgroundImage.endsWith(".png"))return t.logger.error("zb.sh.ums illegal input background image URL"),o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.message}),!1;c.backgroundImage=e.backgroundImage,d.background_image=e.backgroundImage}e.waterMark&&(c.waterMark=e.waterMark,d.water_mark=e.waterMark),e.extraParams&&(c.extraParams||(c.extraParams=[]),(a=c.extraParams).push.apply(a,e.extraParams)),t.stateCenter.mixStreamAdvance=c,i.ClientUtil.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)(n.REPORT_ACTION.addMsgInfo,void 0,{config:s.ZegoRTCLogEvent.kZegoTaskMixConfig.config(d)}),r({errorCode:0,extendedData:""})}))},e.prototype.stopMixStream=function(e,t,r,n,c){var d=this;this.logger.info("zb.sh.sms call");var l={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:o.PROTO_VERSION};"string"==typeof e&&(l.task_id=e),null!=n?this.stateCenter.testEnvironment?l.stream_id="zegotest-"+this.stateCenter.appid+"-"+n:l.stream_id=n:null!=c&&(l.mixurl=c);var u={channel:"zeus",cmd:"stop_mix",req_body:JSON.stringify(l)};return this.sendBizChannelRequest(u,(function(){t&&t({errorCode:0})}),(function(e){var t;"number"==typeof e?r&&r({errorCode:i.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+e).code,extendedData:""}):(d.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(e)),t=e==a.errorCodeList.TIMEOUT?s.ZegoRTCLogEvent.kZegoTaskMixStop.error.kRequestError:s.ZegoRTCLogEvent.kZegoTaskMixStop.error.kInternalError,r&&r({errorCode:t.code,extendedData:t.message}))})),!0},e.prototype.updateStreamExtraInfo=function(e,t,r,i){var n;this.logger.info("zb.sh.usei call"),n="PUBLIC"===this.stateCenter.type?o.ENUM_STREAM_SUB_CMD.liveUpdate:o.ENUM_STREAM_CMD_PRI.liveUpdate,this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state>=o.ENUM_PUBLISH_STREAM_STATE.update_info?(this.stateCenter.publishStreamList[e].extra_info=t,this.updateStreamInfo(e,n,t),r({errorCode:0})):i(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kUpdateStreamInfoFailError)},e.prototype.setStreamExtraInfo=function(e,t,r,o){this.updateStreamExtraInfo(e,t,r,o)},e.prototype._publishTarget=function(e,t,r){var i=this;this.logger.info("zb.sh.ptcall");var n=Math.ceil((new Date).getTime()/1e3),c=e.streamID;this.stateCenter.testEnvironment&&(c="zegotest-"+this.stateCenter.appid+"-"+e.streamID);var d={appid:this.stateCenter.appid,biz_type:0,timestamp:n,seq:this.stateCenter.cdnSeq++,version:1*o.PROTO_VERSION,stream_id:c,pushurl:e.pushUrl},l={channel:"media",cmd:e.type,req_body:JSON.stringify(d)};this.logger.debug("zb.sh.pt send command"),this.sendBizChannelRequest(l,(function(o,n,c){if(i.logger.info("zb.sh.pt receive message"),0!=c.length){var d=JSON.parse(c),l=d.code,u=d.message;l&&0!=l?(i.logger.error("zb.sh.pt "+e.type+" error code: "+l+" "+u),r(a.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: "+e.type+" "+l+" "+u)):(i.logger.info("zb.sh.pt "+e.type+" success"),t&&t({errorCode:0,extendedData:""}))}else r(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoResponseError)}),(function(t,o,n){i.logger.info("zb.sh.pt error: "+t);var a=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError;2001==t?s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kInvalidChannelError:2002==t&&(a=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),i.logger.error("zb.sh.pt "),r(a," cmd: "+e.type+" "+t+"   ")}))},e.prototype.patchStreamList=function(e){var t=this;e.body.stream_seq===this.streamSeq||this.streamSeqMergeMap||(this.logger.info(c.ZEGO_WEBRTC_ACTION.STREAMHANDLER_PATCH_STREAM_LIST+" call update stream "+this.streamSeq+" server "+e.body.stream_seq),this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout((function(){t.handleMergeTimeout()}),this.streamListHBMergeInterval)),this.minStreamSeq=e.body.stream_seq},e.prototype.mergeStreamByStreamSeq=function(e,t,r){var o=this;this.streamSeqMergeMap||(this.logger.warn(c.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" new merge stream list "+this.streamSeq+" server "+t),this.streamSeqMergeMap={},this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout((function(){o.handleMergeTimeout()}),this.streamListMergeInterval)),this.logger.info(c.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" "+this.streamSeqMergeMap+" "+e+" "+t+" "+r),this.streamSeqMergeMap[t]={cmd:e,streamList:r}},e.prototype.handleMergeTimeout=function(){if(this.streamSeqMergeMap){var e=Object.keys(this.streamSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));e[e.length-1]-e[0]+1===e.length||e[e.length-1]>=this.minStreamSeq?this.mergeStream(e):(this.streamSeqMergeMap=null,this.fetchStreamList())}},e.prototype.mergeStream=function(e){var t=this;this.logger.info(c.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" merge streamList "+this.streamSeq+" streamSeqList "+e.join(","));var r=e[e.length-1],i=[];e.forEach((function(e){if(t.streamSeqMergeMap&&t.streamSeqMergeMap[e])switch(t.streamSeqMergeMap[e].cmd){case o.ENUM_STREAM_UPDATE_CMD.added:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=i.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&i.splice(t),i.push(e)}));break;case o.ENUM_STREAM_UPDATE_CMD.deleted:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=i.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&i.splice(t)}));break;case o.ENUM_STREAM_UPDATE_CMD.updated:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=i.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&i.splice(t),i.push(e)}))}})),this.streamSeqMergeMap=null,this.logger.info(c.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" "+i),this.handleFullUpdateStream(r,i)},e.prototype.reset=function(){this.minStreamSeq=0,this.streamSeqMergeMap=null,this.streamSeqMergeTimer&&(clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=void 0),this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3},e.prototype.getRoomInfo=function(){var e=this;return new Promise((function(t,r){if(e.rtm.isLogin(e.roomID)){var o=function(e,o){if(0!==e.body.code)r({errorCode:e.body.code,extendData:e.body.message});else{var i=e.body.streams_info.map((function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info}}));t({streamList:i})}},i={room_header:{room_id:e.roomID,room_sid:e.rtm.getRoomSid()||"0",room_user_session_id:e.rtm.getRoomSessionID()||"0"}};e.rtm.service.sendMessage("zegochat_js.room_info_req",i,o,o)}else e.logger.error("zn.rh.gri no enter room")}))},e}();t.StreamHandler=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PublishModule=void 0;var o=r(2),i=r(0),n=r(1),s=r(3),a=r(4),c=r(9),d=r(8),l=function(){function e(e,t,r,o,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=i}return e.prototype.createStream=function(e){var t=this;return this.logger.info(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" call"),e&&e.camera&&e.camera.audioBitRate&&(e.camera.audioBitrate=e.camera.audioBitRate),e&&e.camera&&e.camera.bitrate&&(e.camera.bitRate=e.camera.bitrate),e&&e.screen&&"object"==typeof e.screen&&e.screen.bitrate&&(e.screen.bitRate=e.screen.bitrate),e&&e.custom&&e.custom.bitrate&&(e.custom.bitRate=e.custom.bitrate),new Promise((function(r,a){var c="camera",l=i.getReportSeq();t.dataReport.newReport(l,n.ZegoRTCLogEvent.kZegoTaskCreateStream.event);var u=function(e){if(0==e.getAudioTracks().length){var o=t.streamCenter.ac.createMediaStreamDestination(),i=o?o.stream:null,n=i?i.getAudioTracks()[0]:null;n&&e.addTrack(n)}t.dataReport.uploadReport(l),!t.stateCenter.deviceInfos&&t.recordDevices(),r(e),t.streamCenter.activeSoundLevel()},h=function(e,r){void 0===r&&(r=""),t.dataReport.addMsgInfo(l,{error:e.code,message:e.message+r}),t.dataReport.uploadReport(l),a({code:e.code,msg:e.message+r})};if("https:"!==window.location.protocol&&"file:"!==window.location.protocol&&-1==window.location.hostname.indexOf("127.0.0.1")&&-1==window.location.hostname.indexOf("localhost"))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" https or localhost required "),void h({code:n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError.code,message:n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError.message+" https or localhost required"});if(e&&e.screen){if(c="screen",!s.ClientUtil.checkScreenParams(e.screen,h))return;var p=s.ClientUtil.getBrowser(),f=t.streamCenter.getScreenConstrains(e.screen);t.dataReport.addMsgInfo(l,{stream_type:n.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("screen"),screen:n.ZegoRTCLogEvent.kZegoTaskCreateStream.screen(f)});var g=function(e){t.streamCenter.createScreenPreviewer(e,f)&&u(e),e.getVideoTracks()[0].onended=function(){var r=i.getReportSeq();t.dataReport.newReport(r),t.dataReport.uploadReport(r,n.ZegoRTCLogEvent.kZegoTaskScreenSharingEnded),e&&t.stopPreview(e),t.stateCenter.actionListener("screenSharingEnded",e)}};"Firefox"==p||"object"==typeof e.screen&&"firefox"==e.screen.type?t.startScreenShotFirFox("screen",f,(function(e,t,r){e?t&&g(t):r&&h(r)})):"Chrome"==p&&d.ZegoWebRTC.screenShotReady||"object"==typeof e.screen&&"shot"==e.screen.type?t.startScreenShotChrome((function(r,i,s){r?(t.logger.info(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" using extension"),i&&g(i)):(s&&t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" extension "+s),"SS_DIALOG_CANCEL"===s||"object"==typeof e.screen&&"shot"==e.screen.type?s&&h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenCancelError):t.startScreenSharing(f,(function(e,r,i){e?r&&g(r):(t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" "+i),i&&h(i))})))})):t.startScreenSharing(f,(function(e,t,r){e?t&&g(t):r&&h(r)}))}else{if(e&&"object"==typeof e.camera&&void 0!==e.camera.videoQuality&&!s.ClientUtil.checkInteger(e.camera.videoQuality))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" videoQuality must be integer number"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number");if(e&&e.camera&&e.camera.audioBitrate){if(!s.ClientUtil.checkInteger(e.camera.audioBitrate))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate must be integer number"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate must be integer number");if(e.camera.audioBitrate<6)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate cannot less 6 kbps"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot less 6 kbps");if(e.camera.audioBitrate>510)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate cannot greater than 510 kbps"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot greater than 510 kbps");t.stateCenter.audioBitRate=1e3*e.camera.audioBitrate}if(e&&e.camera&&e.camera.bitRate){if("number"!=typeof e.camera.bitRate)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate must be integer number"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number");if(e.camera.bitRate>10240)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate cannot greater than 10 Mbps"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps")}if(e&&e.camera&&void 0!==e.camera.channelCount&&!s.ClientUtil.checkInteger(e.camera.channelCount))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" channelCount must be integer number"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," channelCount must be integer number");if(e&&e.camera&&4===e.camera.videoQuality&&!s.ClientUtil.checkCameraParams(e.camera,h))return;if(e&&e.custom&&e.custom.bitRate){if(!s.ClientUtil.checkInteger(e.custom.bitRate))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate must be integer number"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number");if(e.custom.bitRate>10240)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate cannot greater than 10 Mbps"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps")}if(e&&e.custom&&e.custom.audioBitrate){if(!s.ClientUtil.checkInteger(e.custom.audioBitrate))return t.logger.error("ze.cs.0 audioBitrate must be integer number"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate must be integer number");if(e.custom.audioBitrate<6)return t.logger.error("ze.cs.0 audioBitrate cannot less 6 kbps"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot less 6 kbps");if(e.custom.audioBitrate>510)return t.logger.error("ze.cs.0 audioBitrate cannot greater than 510 kbps"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot greater than 510 kbps")}if(e&&e.custom&&void 0!==e.custom.channelCount&&1!==e.custom.channelCount&&2!==e.custom.channelCount)return t.logger.error("ze.cs.0 channelCount must number 1 or 2"),void h(n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," channelCount must number 1 or 2");var m={};e&&e.camera?(c="camera",m=e.camera,t.dataReport.addMsgInfo(l,{stream_type:n.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("camera"),camera:n.ZegoRTCLogEvent.kZegoTaskCreateStream.camera(e.camera)}),"boolean"!=typeof m.video&&(m.video=!0),"boolean"!=typeof m.audio&&(m.audio=!0)):e&&e.custom&&(c="custom",m=e.custom,t.dataReport.addMsgInfo(l,{stream_type:n.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("custom"),custom:n.ZegoRTCLogEvent.kZegoTaskCreateStream.custom(e.custom)})),t.startPreview(m,c,u,h)}}))},e.prototype.destroyStream=function(e){this.logger.info(o.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" call");var t=i.getReportSeq();if(this.dataReport.newReport(t),!(e instanceof MediaStream))return this.logger.error(o.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" localStream is not mediaStream or tracks is null"),this.dataReport.addMsgInfo(t,n.ZegoRTCLogEvent.kZegoTaskDestroyStream.error.kLocalStreamError),void this.dataReport.uploadReport(t,n.ZegoRTCLogEvent.kZegoTaskDestroyStream.event);e instanceof MediaStream&&0==e.getTracks().length&&this.logger.info(o.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" tracks is null"),this.stopPreview(e),this.dataReport.uploadReport(t,n.ZegoRTCLogEvent.kZegoTaskDestroyStream.event)},e.prototype.startPublishingStream=function(e,t,r){this.logger.info(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" call ",e);var a,c=!0,d="",l=i.getReportSeq();if(this.stateCenter.reportSeqList.startPublish[e]=l,this.dataReport.newReport(l,n.ZegoRTCLogEvent.kZegoTaskPublishStart.event),c&&void 0===e&&(d="stream id required",this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+d),c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),!c||e&&"string"==typeof e||(d="stream id type wrong",this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),c&&e.length>i.MAX_STREAM_ID_LENGTH&&(d="stream id length limit",this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),c&&!s.ClientUtil.checkIllegalCharacters(e)&&(d="stream ID contains illegal characters",this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),c&&(!t||t instanceof MediaStream&&0==t.getTracks().length)&&(d="localStream wrong",this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),c&&!this.streamCenter.checkPreview(t)&&(d="stream is not from zego",this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNoPreviewError),c&&void 0!==r&&"object"!=typeof r&&(c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,d="publishOption must be object"),c&&void 0!==r&&void 0!==r.streamParams&&"string"!=typeof r.streamParams&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption streamParams must be string"),c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,d=" publishOption streamParams must be string"),c&&void 0!==r&&void 0!==r.extraInfo&&"string"!=typeof r.extraInfo&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption extraInfo must be string"),c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,d=" publishOption extraInfo must be string"),c&&void 0!==r&&void 0!==r.videoCodec&&"string"!=typeof r.videoCodec&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption videoCodec must be string"),c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,d=" publishOption videoCodec must be string"),!c||!this.stateCenter.isMultiRoom||r&&"string"==typeof r.roomID&&""!=r.roomID||(c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,d=" roomID is need if set multi room"),r&&r.videoCodec&&(r.videoCodec=r.videoCodec.toUpperCase()),c&&this.rtm.service.isDisConnect()&&(this.logger.error("zc.p.sps.1 not login"),c=!1,a=n.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNoLoginError),!c)return this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),this.dataReport.uploadReport(l,void 0,a,d),delete this.stateCenter.reportSeqList.startPublish[e],!1;r||(r={}),this.dataReport.addMsgInfo(l,{stream:n.ZegoRTCLogEvent.kZegoTaskPublishStart.stream(e),publishOption:n.ZegoRTCLogEvent.kZegoTaskPublishStart.publishOption(r)}),r.audioBitRate=this.stateCenter.audioBitRate;var u=r.roomID?r.roomID:this.stateCenter.roomList[0]?this.stateCenter.roomList[0].roomID:"",h=this.stateCenter.getRoomByRoomID(u);if(!h)return this.logger.error("zc.p.sps.1 room no found"),!1;if(this.dataReport.addMsgInfo(l,{publish_room_id:u,isMulti:this.stateCenter.isMultiRoom}),this.stateCenter.customUrl&&0!=this.stateCenter.customUrl.length)return this.stateCenter.publishStreamList[e]={state:i.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},this.streamCenter.setPublishStateStart(h,e,t,r)?(h.streamHandler.onPublishStateUpdate(i.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.publisherList[e].serverUrls=this.stateCenter.customUrl,this.streamCenter.startPublishingStream(e)):(this.logger.info("zc.p.sps.1 cannot start publish"),!1);if(!this.streamCenter.setPublishStateStart(h,e,t,r))return this.logger.error("zc.p.sps.1 cannot start publish"),!1;this.stateCenter.publishStreamList[e]={state:i.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},this.logger.info("zc.p.sps.1 start publish"),h.streamHandler.onPublishStateUpdate(i.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""});var p=this.streamCenter.publisherList[e].retryDispatchHandler;return p.stopMaxTime(),p.invalid(),p.initStream(e,r,!0),p.startMaxTime(),p.active(0)},e.prototype.activateSEIInsert=function(e,t,r){void 0===r&&(r=0);var i=this.streamCenter.checkPreview(e);if(!i)return this.logger.error(o.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" stream is not created"),!1;if(0!==t&&1!==t)return this.logger.error(o.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" value of “action” should be 0 or 1"),!1;i.activeteSEIConfig={action:t,infoType:r};var n=this.streamCenter.checkPublish(e);return n&&(null==n||n.publisher.activateSEIInsert(t,r)),!0},e.prototype.stopPublishingStream=function(e){this.logger.info(o.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" call ",e);var t=i.getReportSeq();if(this.stateCenter.reportSeqList.stopPublish[e]=t,this.dataReport.newReport(t,n.ZegoRTCLogEvent.kZegoTaskPublishStop.event),this.dataReport.addMsgInfo(t,{streamID:n.ZegoRTCLogEvent.kZegoTaskPublishStop.stream(e)}),"string"!=typeof e||""==e)return this.logger.error(o.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" streamID must be string and not empty"),this.dataReport.uploadReport(t,void 0,n.ZegoRTCLogEvent.kZegoTaskPublishStop.error.kParamError,"stream id type error"),delete this.stateCenter.reportSeqList.stopPublish[e],!1;var r=this.streamCenter.publisherList[e],s=this.streamCenter.getRoomByStreamID(e),a=r&&r.publisher&&r.publisher.state!==i.ENUM_PUBLISH_STATE.stop;if(this.streamCenter.stopPublishingStream(e),this.stateCenter.publishStreamList[e]){if(this.stateCenter.publishStreamList[e].state>=i.ENUM_PUBLISH_STREAM_STATE.update_info&&s){var c;c="PUBLIC"===this.stateCenter.type?i.ENUM_STREAM_SUB_CMD.liveEnd:i.ENUM_STREAM_CMD_PRI.liveEnd,s.streamHandler.updateStreamInfo(e,c);for(var d=0;d<s.streamList.length;d++)if(s.streamList[d].stream_id==e){s.streamList.splice(d--,1);break}}delete this.stateCenter.publishStreamList[e]}return this.dataReport.uploadReport(t),s&&a&&s.streamHandler.onPublishStateUpdate(i.ENUM_PUBLISH_STATE_UPDATE.error,e,{code:0,message:""}),!0},e.prototype.setCaptureVolume=function(e,t){var r=this;return new Promise((function(i){var s;r.logger.info(o.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" call");var a=function(e){r.logger.error(o.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" "+e),i({errorCode:n.ZegoRTCLogEvent.kZegoSetCaptureVolume.error.kParamError.code,extendedData:JSON.stringify({fail_reason:n.ZegoRTCLogEvent.kZegoSetCaptureVolume.error.kParamError.message+" "+e})})},c=r.streamCenter.ac,d=r.streamCenter.checkPreview(e);if(e instanceof MediaStream&&d)if(0!=e.getAudioTracks().length)if("number"!=typeof t||t<0||t>100)a(" volume must be number between 0 to 100");else{if(d.gainNode)d.gainNode.gain.value=t/100;else{var l=c.createMediaStreamSource(e),u=c.createGain(),h=c.createMediaStreamDestination();l.connect(u),u.connect(h);var p=h.stream.getAudioTracks()[0];for(var f in r.streamCenter.publisherList){var g=r.streamCenter.publisherList[f];if(g.localStream==e){var m=null===(s=g.publisher.peerConnection)||void 0===s?void 0:s.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));m&&(m.replaceTrack(p),g.localStream.removeTrack(g.publisher.localStream.getAudioTracks()[0]),g.localStream.addTrack(p));break}}e.removeTrack(e.getAudioTracks()[0]),e.addTrack(p),d.gainNode=u,d.gainNode.gain.value=t/100}c.resume(),i({errorCode:0,extendedData:""}),r.logger.info(o.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" call success")}else a(" stream audioTrack no found");else a(" stream must be created by zego")}))},e.prototype.startScreenShotChrome=function(e){if(d.ZegoWebRTC.screenShotReady)window.postMessage({type:"SS_UI_REQUEST",text:"start"},"*"),s.ClientUtil.registerCallback("screenShare",{success:e},this.stateCenter.callbackList);else{var t='zc.b.ss Please install the extension:1. Go to chrome://extensions  2. Check: "Enable Developer mode   3. Click: "Load the unpacked extension... 4. Choose "extension" folder from the repository 5. Reload this page';this.logger.error(t),e(!1,null,{code:n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+t})}},e.prototype.startScreenSharing=function(e,t){var r=this;"getDisplayMedia"in navigator.mediaDevices?navigator.mediaDevices.getDisplayMedia({audio:e.audio,video:{frameRate:e.frameRate,width:e.width,height:e.height}}).then((function(e){t(!0,e)})).catch((function(e){r.logger.error("zc.b.sss "+e),e.message&&"permission denied"==e.message.toLowerCase()?t(!1,null,n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenCancelError):t(!1,null,{code:n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+e})})):(this.logger.error("zc.b.sss brower does not support getDisplayMedia"),t(!1,null,n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError))},e.prototype.startScreenShotFirFox=function(e,t,r){var o=this,i={video:{frameRate:t.frameRate,bitRate:t.bitRate,width:t.width,height:t.height,mediaSource:e},audio:t.audio};navigator.mediaDevices.getUserMedia(i).then((function(e){r(!0,e)})).catch((function(e){o.logger.error("ze.ssf.1 "+e),r(!1,null,{code:n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:n.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+e})}))},e.prototype.startPreview=function(e,t,r,o){var i=this,n=null;return n=new c.ZegoPreview(this.logger,this.streamCenter.ac,this.streamCenter,t),this.streamCenter.previewStreamList.push(n),n.startPreview(e,(function(e){i.streamCenter.soundLevelDelegate&&(null==n||n.startSoundLevel()),"camera"===t&&(null==n?void 0:n.micTrack)&&(n.micTrack.enabled=i.streamCenter.isMicEnabled),i.logger.debug("zsc.sp.0 call success"),!i.stateCenter.deviceInfos&&i.recordDevices(),r&&r(e)}),(function(e){i.streamCenter.previewStreamList=i.streamCenter.previewStreamList.filter((function(e){return e!==n})),o&&o(e)})),!0},e.prototype.stopPreview=function(e){if(!e)return this.logger.warn("zsc.sp.0 localStream null"),!1;for(var t in this.streamCenter.publisherList)this.streamCenter.publisherList[t].localStream===e&&(this.streamCenter.publisherList[t].localStream=null);var r=this.streamCenter.checkPreview(e);return r?(r.previewSuc&&(r.stopPreview(),this.streamCenter.removePreview(r)),!0):(this.logger.warn("zsc.sp.0 no preview"),!1)},e.prototype.recordDevices=function(){var e=this;this.logger.info("zsc.rd.0 call"),s.ClientUtil.getDevices((function(t){e.stateCenter.deviceInfos={microphones:t.microphones,speakers:t.speakers,cameras:t.cameras}}),(function(t){e.logger.warn("zsc.rd.0 getDevices err:",t)})),void 0!==navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(t){e.logger.info("zsc.rd.0 devicechange"),e.stateCenter.deviceChangeTimer&&(clearTimeout(e.stateCenter.deviceChangeTimer),e.stateCenter.deviceChangeTimer=null),e.stateCenter.deviceChangeTimer=setTimeout((function(){s.ClientUtil.getDevices((function(t){for(var r=[],o=function(o){var i=e.stateCenter.deviceInfos.cameras[o];t.cameras.find((function(e){return e.deviceID===i.deviceID}))||r.push(i)},s=0;s<e.stateCenter.deviceInfos.cameras.length;s++)o(s);e.stateCenter.deviceStateOut=!1;var c=!1;r.length>0&&(c=!0),r.forEach((function(t){for(var r in e.streamCenter.publisherList){var o=e.streamCenter.publisherList[r],s=o.publisher;o.localStream&&o.cameraLabel===t.deviceName&&(c=!1,s.sendStreamStatus(-6,s.mic_status),e.stateCenter.actionListener("deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,t.deviceName),e.stateCenter.actionListener("_deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,t.deviceName,"camera"));var d=i.getReportSeq();e.dataReport.newReport(d,n.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),e.dataReport.addMsgInfo(d,{interrupt:0}),e.dataReport.uploadReport(d),e.stateCenter.actionListener("videoDeviceStateChanged","DELETE",t),o.localStream&&0===o.localStream.getAudioTracks().length&&(c=!1)}})),c&&(e.stateCenter.deviceStateOut=!0),e.stateCenter.deviceInfos.microphones.filter((function(e){return!t.microphones.find((function(t){return t.deviceID===e.deviceID}))})).forEach((function(t){for(var r in e.streamCenter.publisherList){var o=e.streamCenter.publisherList[r],s=o.publisher;o.localStream&&(o.microLabel===t.deviceName||o.microLabel.includes(t.deviceName))&&(s.sendStreamStatus(s.camera_status,-6),e.stateCenter.actionListener("deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,e.streamCenter.publisherList[r].microLabel),e.stateCenter.actionListener("_deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,e.streamCenter.publisherList[r].microLabel,"micro"));var c=i.getReportSeq();e.dataReport.newReport(c,n.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),e.dataReport.addMsgInfo(c,{interrupt:0}),e.dataReport.uploadReport(c),e.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Input",t)}}));var d=e.stateCenter.deviceInfos.speakers.filter((function(e){return!t.speakers.find((function(t){return t.deviceID===e.deviceID}))})),l=t.cameras.filter((function(t){return!e.stateCenter.deviceInfos.cameras.find((function(e){return e.deviceID===t.deviceID}))})),u=t.microphones.filter((function(t){return!e.stateCenter.deviceInfos.microphones.find((function(e){return e.deviceID===t.deviceID}))})),h=t.speakers.filter((function(t){return!e.stateCenter.deviceInfos.speakers.find((function(e){return e.deviceID===t.deviceID}))}));d.forEach((function(t){var r=i.getReportSeq();e.dataReport.newReport(r,n.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.event),e.dataReport.addMsgInfo(r,{reason:n.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.reason("delete"),device:n.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.device(t)}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Output",t)})),l.forEach((function(t){var r=i.getReportSeq();e.dataReport.newReport(r,n.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),e.dataReport.addMsgInfo(r,{interrupt:1}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("videoDeviceStateChanged","ADD",t)})),u.forEach((function(t){var r=i.getReportSeq();e.dataReport.newReport(r,n.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),e.dataReport.addMsgInfo(r,{interrupt:1}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("audioDeviceStateChanged","ADD","Input",t)})),h.forEach((function(t){var r=i.getReportSeq();e.dataReport.newReport(r,n.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.event),e.dataReport.addMsgInfo(r,{reason:n.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.reason("add"),device:n.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.device(t)}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("audioDeviceStateChanged","ADD","Output",t)})),e.stateCenter.deviceInfos={microphones:t.microphones,speakers:t.speakers,cameras:t.cameras}}),(function(t){e.logger.warn("zsc.rd.0 getDevices err:",t)}))}),500)})},e}();t.PublishModule=l},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayModule=void 0;var i=r(2),n=r(0),s=r(1),a=r(3),c=function(){function e(e,t,r,o,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=i}return e.prototype.startPlayingStream=function(e,t){var r=this;return this.logger.info(i.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" call ",e),new Promise((function(o,i){return r._handlePlayStream(e,t,o,i)}))},e.prototype._handlePlayStream=function(e,t,r,c){var d=this,l=n.getReportSeq();this.stateCenter.reportSeqList.startPlay[e]=l,this.dataReport.newReport(l,s.ZegoRTCLogEvent.kZegoTaskPlayStart.event);var u=function(t,r){d.logger.error(i.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" "+(r||t.message)),d.dataReport.uploadReport(l,void 0,t,r),delete d.stateCenter.reportSeqList.startPlay[e],c&&c(o(o({},t),{errorCode:t.code,extendedData:t.message+(r?" "+r:"")}))};if(void 0===e||"string"!=typeof e||""===e)return u(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayParamError,"stream id type error"),!1;if(e.length>n.MAX_STREAM_ID_LENGTH)return u(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDToLongError,"stream id length limit "+n.MAX_STREAM_ID_LENGTH),!1;if(!a.ClientUtil.checkIllegalCharacters(e))return u(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError),!1;if(void 0!==t&&"object"!=typeof t)return u(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayParamError,"playOption must be object"),!1;if(this.stateCenter.customUrl&&this.stateCenter.customUrl.length>0)return this.streamCenter.setPlayStateStart(e,t)?(this.streamCenter.onPlayStateUpdate(n.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.playerList[e].serverUrls=this.stateCenter.customUrl,this.streamCenter.startPlayingStream(e,(function(e){r&&r(e)}))):(u(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError,"cannot start play"),!1);if(this.dataReport.addMsgInfo(l,{stream:s.ZegoRTCLogEvent.kZegoTaskPlayStart.stream(e),playOption:s.ZegoRTCLogEvent.kZegoTaskPlayStart.playOption(t)}),this.rtm.service.isDisConnect())return u(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError),!1;if(this.stateCenter.pullLimited||(e=NaN+e),t&&t.videoCodec&&(t.videoCodec=t.videoCodec.toUpperCase()),!this.streamCenter.setPlayStateStart(e,t))return u(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError,"cannot start play"),!1;this.streamCenter.onPlayStateUpdate(n.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.playSuccessCallBackList[e]=function(e){r&&r(e)},c&&(this.streamCenter.playErrorCallBackList[e]=c);var h=this.streamCenter.playerList[e].retryDispatchHandler;return h.stopMaxTime(),h.invalid(),h.initStream(e,t,!1),h.startMaxTime(),h.active(0)},e.prototype.stopPlayingStream=function(e){this.logger.info(i.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call",e);var t=n.getReportSeq();if(this.stateCenter.reportSeqList.stopPlay[e]=t,this.dataReport.newReport(t,s.ZegoRTCLogEvent.kZegoTaskPlayStop.event),this.dataReport.addMsgInfo(t,{stream:s.ZegoRTCLogEvent.kZegoTaskPlayStop.stream(e)}),"string"!=typeof e||""===e)return this.logger.error(i.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" streamid must be string and not empty"),this.dataReport.uploadReport(t,void 0,s.ZegoRTCLogEvent.kZegoTaskPlayStop.error.kParamError,"stream id type error"),void delete this.stateCenter.reportSeqList.stopPlay[e];var r=this.streamCenter.playerList[e],o=r&&r.player&&r.player.state!==n.ENUM_PLAY_STATE.stop;for(var a in this.streamCenter.stopPlayingStream(e),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[a]===e){delete this.stateCenter.streamUrlMap[a];break}this.dataReport.uploadReport(t),o&&this.streamCenter.onPlayStateUpdate(n.ENUM_PLAY_STATE_UPDATE.error,e,{code:0,message:""}),this.logger.debug(i.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call success")},e.prototype.mutePlayStream=function(e,t,r){var o=this;return this.logger.info("zsc.mps.0 call "+t+" "+r),new Promise((function(i,a){if("string"!=typeof e||""==e)return o.logger.error("zsc.mps.0 streamID must be string and not empty"),void a(!1);if("boolean"!=typeof r)return o.logger.error("zsc.mps.0 mute must be boolean"),void a(!1);var c=o.streamCenter.playerList[e];if(!c)return o.logger.error("zsc.mps.0 player not found"),void a(!1);if("video"===t){if(c.playOption&&!1===c.playOption.video||c.player&&0!==c.player.cameraStatus)return o.logger.error("zsc.mps.0 stream no contain video"),void a(!1);c.player.signal.ActivatePlayVideoStream(n.getSeq(),c.player.sessionId,r,(function(){o.logger.info("zsc.mps.0 suc");var e=n.getReportSeq();o.dataReport.newReport(e,s.ZegoRTCLogEvent.kZegoPlayContentChanged.event),o.dataReport.addMsgInfo(e,{session_id:s.ZegoRTCLogEvent.kZegoPlayContentChanged.session_id(c.player.sessionId),video_activate:s.ZegoRTCLogEvent.kZegoPlayContentChanged.video_activate(r?0:1),audio_activate:s.ZegoRTCLogEvent.kZegoPlayContentChanged.audio_activate(1==c.player.playOption.audio?1:0==c.player.playOption.audio?0:1)}),o.dataReport.uploadReport(e),i(!0)}),(function(){o.logger.error("zsc.mps.0 fail"),a(!1)}))}else{if(c.playOption&&!1===c.playOption.audio||c.player&&0!==c.player.micStatus)return o.logger.error("zsc.mps.0 stream no contain audio"),void a(!1);c.player.signal.ActivatePlayAudioStream(n.getSeq(),c.player.sessionId,r,(function(){o.logger.info("zsc.mps.0 suc");var e=n.getReportSeq();o.dataReport.newReport(e,s.ZegoRTCLogEvent.kZegoPlayContentChanged.event),o.dataReport.addMsgInfo(e,{session_id:s.ZegoRTCLogEvent.kZegoPlayContentChanged.session_id(c.player.sessionId),video_activate:s.ZegoRTCLogEvent.kZegoPlayContentChanged.video_activate(1==c.player.playOption.video?1:0==c.player.playOption.video?0:1),audio_activate:s.ZegoRTCLogEvent.kZegoPlayContentChanged.audio_activate(r?0:1)}),o.dataReport.uploadReport(e),i(!0)}),(function(){o.logger.error("zsc.mps.0 fail"),a(!1)}))}}))},e.prototype.setStreamAudioOutput=function(e,t){var r=this;return!(null==t||0==t.length||!e||(this.logger.debug("zsc.ssao.0 device "+t),e?"undefined"!==e.sinkId?(e.setSinkId(t).then((function(){r.logger.info("zsc.ssao.0 success device: "+t)})).catch((function(e){r.logger.info("zsc.ssao.0 "+e.name)})),0):(this.logger.error("zsc.ssao.0 browser does not suppport"),1):(this.logger.error("zsc.ssao.0 no localVideo"),1)))},e}();t.PlayModule=c},function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioMixModule=void 0;var s=r(2),a=r(0),c=r(1),d=n(r(10)),l=function(){function e(e,t,r,o,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.ac=i,this.buffer=null,this.blank=null,"safari"==d.browserDetails.browser&&null==this.blank&&null==this.buffer&&(this.ac.resume(),this.buffer=this.ac.createBuffer(1,1,this.ac.sampleRate),this.blank=this.ac.createBufferSource(),this.blank.buffer=this.buffer,this.blank.connect(this.ac.destination),this.blank.start())}return e.prototype.preloadEffect=function(e,t,r){e&&"string"==typeof e&&t&&"string"==typeof t?this.stateCenter.audioEffectBuffer[e]?this.logger.error(s.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" audio buffer already exists"):(this.logger.info(s.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" start preload effect"),this._preloadEffect(this.ac,e,t,r)):this.logger.error(s.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" params error")},e.prototype.playEffect=function(e,t,r){e.streamID&&"string"==typeof e.streamID&&e.effectID&&"string"==typeof e.effectID?this.stateCenter.audioEffectBuffer[e.effectID]?this._playEffect(e,t,r):this.logger.error(s.ZEGO_WEBRTC_ACTION.PLAY_EFFECT+" audio buffer doesn't exists"):this.logger.error(s.ZEGO_WEBRTC_ACTION.PLAY_EFFECT+" params error")},e.prototype.pauseEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error(s.ZEGO_WEBRTC_ACTION.PAUSE_EFFECT+" effect "),this._pauseEffect(e,t)):(this.logger.error(s.ZEGO_WEBRTC_ACTION.PAUSE_EFFECT+" streamID format error"),!1)},e.prototype.resumeEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error(s.ZEGO_WEBRTC_ACTION.RESUME_EFFECT+" effect "),this._resumeEffect(e,t)):(this.logger.error(s.ZEGO_WEBRTC_ACTION.RESUME_EFFECT+" streamID format error"),!1)},e.prototype.stopEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error(s.ZEGO_WEBRTC_ACTION.STOP_EFFECT+" effect "),this._stopEffect(e,t)):(this.logger.error(s.ZEGO_WEBRTC_ACTION.STOP_EFFECT+" streamID format error"),!1)},e.prototype.unloadEffect=function(e){return e&&"string"==typeof e?(delete this.stateCenter.audioEffectBuffer[e],!0):(this.logger.error(s.ZEGO_WEBRTC_ACTION.UNLOAD_EFFECT+" params error"),!1)},e.prototype.setEffectVolume=function(e,t,r){if(!e||"string"!=typeof e)return this.logger.error(s.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" streamID format error"),!1;r&&"string"!=typeof r&&this.logger.error(s.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" effect ");var o=this.streamCenter.getPublisher(e);return o?o.setEffectVolume(t/100,r):(this.logger.error(s.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" publisher doesn't exist"),!1)},e.prototype.startMixingAudio=function(e,t){return this.logger.info(s.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" call "+e),e&&"string"==typeof e?t?(this.logger.info(s.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" end "+e),Array.isArray(t)&&0!==t.length?this._startMixingAudio(e,t):(this.logger.error(s.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" audio param type error"),!1)):(this.logger.error(s.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" no audio"),!1):(this.logger.error(s.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" stream id type error"),!1)},e.prototype.stopMixingAudio=function(e,t){return e&&"string"==typeof e?Array.isArray(t)&&0!==t.length||void 0===t?this._stopMixingAudio(e,t):(this.logger.error(s.ZEGO_WEBRTC_ACTION.STOP_MIXING_AUDIO+" audio param type error"),!1):(this.logger.error(s.ZEGO_WEBRTC_ACTION.STOP_MIXING_AUDIO+" param streamID format error"),!1)},e.prototype.mixingBuffer=function(e,t,r,o){this.logger.info(s.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" call streamID: "+e+" sourceID:"+t),e&&"string"==typeof e?t&&"string"==typeof t?(this._mixingBuffer(e,t,r,o),this.logger.info(s.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" end")):this.logger.error(s.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" param source id format error"):this.logger.error(s.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" param streamid format error")},e.prototype.stopMixingBuffer=function(e,t){return this.logger.info(s.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" call streamID: "+e+" sourceID:"+t),e&&"string"==typeof e?t&&"string"==typeof t?this._stopMixingBuffer(e,t):(this.logger.error(s.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" param source id format error"),!1):(this.logger.error(s.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" param streamid format error"),!1)},e.prototype.setMixingAudioVolume=function(e,t,r){return this.logger.info(s.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" call"),"string"!=typeof e||""==e?(this.logger.error(s.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" stream ID must be string and not empty"),!1):"number"!=typeof t||t<0||t>100?(this.logger.error(s.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" volume must be a number between 0 and 100"),!1):r&&r instanceof HTMLMediaElement?this._setMixingAudioVolume(e,t,r):(this.logger.error(s.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" no audio"),!1)},e.prototype.getSoundLevel=function(e,t,r){this.logger.info("zc.gsl call");var o=a.getReportSeq();this.dataReport.newReport(o,c.ZegoRTCLogEvent.kZegoTaskGetSoundLevel.event);try{this.ac.resume();var i=this.ac.createMediaStreamSource(e),n=this.ac.createScriptProcessor(4096,1,1);this.stateCenter.audioStreamList[e.id]={mic:i,script:n},i.connect(n),n.connect(this.ac.destination),n.onaudioprocess=function(e){for(var r=e.inputBuffer.getChannelData(0),o=0,i=0;i<r.length;i++)o<r[i]&&(o=r[i]);t(o)},this.dataReport.uploadReport(o)}catch(e){r(e),this.dataReport.addMsgInfo(o,c.ZegoRTCLogEvent.kZegoTaskGetSoundLevel.error.kGetSoundLevelError),this.dataReport.uploadReport(o)}this.logger.info("zc.gsl call success")},e.prototype._preloadEffect=function(e,t,r,o){var i=this,n=new XMLHttpRequest;n.open("GET",r,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||304==n.status){var r=n.response;e.decodeAudioData(r,(function(e){i.logger.info("zc.pe.0 effect preload success"),i.stateCenter.audioEffectBuffer[t]=e,o&&o()}),(function(e){i.logger.error("zc.pe.0 effect preload fail "+e),o&&o(e)}))}else{var s=n.statusText;i.logger.error("zc.pe.0 effect preload fail "+s),o&&o(s)}},n.send()},e.prototype._playEffect=function(e,t,r){var o=this.stateCenter.audioEffectBuffer[e.effectID],i=this.streamCenter.getPublisher(e.streamID);i?o?i.playEffect(e,o,t,r):this.logger.error("zc.pe.1 no audio buffer found"):this.logger.error("zc.pe.1 publisher doesn't exist")},e.prototype._pauseEffect=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.pauseEffect(t):(this.logger.error("zc.pe.2 publisher doesn't exist"),!1)},e.prototype._resumeEffect=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.resumeEffect(t):(this.logger.error("zc.re.0 publisher doesn't exist"),!1)},e.prototype._stopEffect=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.stopEffect(t):(this.logger.error("zc.re.0 publisher doesn't exist"),!1)},e.prototype._setMixingAudioVolume=function(e,t,r){var o=this.streamCenter.getPublisher(e);return o?o.setMixingAudioVolume(t/100,r):(this.logger.error("zc.sma.2 publisher doesn't exist"),!1)},e.prototype._startMixingAudio=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.startMixingAudio(t):(this.logger.error("zc.sma.0 publisher doesn't exist"),!1)},e.prototype._stopMixingAudio=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.stopMixingAudio(t):(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},e.prototype._mixingBuffer=function(e,t,r,o){var i=this.streamCenter.getPublisher(e);i?r instanceof ArrayBuffer?i.mixingBuffer(t,r,o):this.logger.error("zc.mb.0 array buffer not found"):this.logger.error("zc.mb.0 publisher doesn't exist")},e.prototype._stopMixingBuffer=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.stopMixingBuffer(t):(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},e}();t.AudioMixModule=l},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.AdvancedModule=void 0;var i=r(2),n=r(0),s=r(1),a=r(3),c=r(4),d=function(){function e(e,t,r,o){this.logger=e,this.dataReport=t,this.streamCenter=r,this.stateCenter=o,this.screenShotReady=!1}return e.prototype.setVideoConfig=function(e,t){var r=this;return this.logger.info(i.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" call"),new Promise((function(o,c){var d=n.getReportSeq();return r.dataReport.newReport(d,s.ZegoRTCLogEvent.kZegoSetVideoConfig.event),e instanceof MediaStream?t&&"object"==typeof t&&0!=Object.keys(t).length?t.width&&!a.ClientUtil.checkValidNumber(t.width)?(r.logger.error(i.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints width integer number, range[1, 10000]"),r.dataReport.addMsgInfo(d,{error:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,message:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints width integer number, range[1, 10000]"}),r.dataReport.uploadReport(d),void c({errorCode:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):t.height&&!a.ClientUtil.checkValidNumber(t.height)?(r.logger.error(i.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints height integer number, range[1, 10000]"),r.dataReport.addMsgInfo(d,{error:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,message:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints height integer number, range[1, 10000]"}),r.dataReport.uploadReport(d),void c({errorCode:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):void r.setPublishStreamConstraints(e,t,(function(e){r.dataReport.uploadReport(d),o(e)})):(r.logger.error(i.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints wrong"),r.dataReport.addMsgInfo(d,s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError),r.dataReport.uploadReport(d),void c({errorCode:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):(r.logger.error(i.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" localStream not found"),r.dataReport.addMsgInfo(d,s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kLocalStreamError),r.dataReport.uploadReport(d),void c({errorCode:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" localStream no found"}))}))},e.prototype.setAudioConfig=function(e,t){var r=this;return this.logger.info(i.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" call"),new Promise((function(o){var a=n.getReportSeq();return r.dataReport.newReport(a,s.ZegoRTCLogEvent.kZegoSetAudioConfig.event),e instanceof MediaStream?!t||"object"!=typeof t||0==Object.keys(t).length||void 0!==t.AEC&&"boolean"!=typeof t.AEC||void 0!==t.AGC&&"boolean"!=typeof t.AGC||void 0!==t.ANS&&"boolean"!=typeof t.ANS?(r.logger.error(i.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" constraints wrong"),r.dataReport.addMsgInfo(a,s.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError),r.dataReport.uploadReport(a),void o({errorCode:s.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.message+" constraints wrong"})):void r.setPublishStreamConstraints(e,t,(function(e){r.dataReport.uploadReport(a),o(e)})):(r.logger.error(i.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" localStream not found"),r.dataReport.addMsgInfo(a,s.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError),r.dataReport.uploadReport(a),void o({errorCode:s.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.message+" localStream no found"}))}))},e.prototype.enableStream=function(e,t){if(this.logger.info(i.ZEGO_WEBRTC_ACTION.ENABLE_STREAM+" call"),"boolean"!=typeof t.video&&"boolean"!=typeof t.audio)return this.logger.error(i.ZEGO_WEBRTC_ACTION.ENABLE_STREAM+" option error"),!1;var r=!0,o=!0;return"boolean"==typeof t.video&&(r=this.enableCamera(e,t.video,t.retain)),"boolean"==typeof t.audio&&(o=this.enableMicrophone(e,t.audio)),r&&o},e.prototype.enableMicrophoneOnly=function(e){if(this.logger.info(i.ZEGO_WEBRTC_ACTION.ENABLE_MIC_ONLY+" call"),"boolean"!=typeof e)return!1;for(var t=0;t<this.streamCenter.previewStreamList.length;t++)if(!this.streamCenter.previewStreamList[t].enableMicrophoneOnly(e,this.streamCenter))return this.logger.error("zsc.emo.0 previewer "+t+" change mic mute state failed"),!1;return this.streamCenter.isMicEnabled=e,!0},e.prototype.replaceTrack=function(e,t){var r=this;return new Promise((function(o){var a=n.getReportSeq();return r.dataReport.newReport(a,s.ZegoRTCLogEvent.kZegoReplaceTrack.event),e instanceof MediaStream?t&&t instanceof MediaStreamTrack?void r._replaceTrack(e,t,(function(e){r.dataReport.uploadReport(a),o(e)})):(r.logger.error(i.ZEGO_WEBRTC_ACTION.REPLACE_TRACK+" mediastream track no found"),r.dataReport.uploadReport(a,void 0,s.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError),void o({errorCode:s.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" mediastream track no found"})):(r.logger.error(i.ZEGO_WEBRTC_ACTION.REPLACE_TRACK+" localStream not found"),r.dataReport.uploadReport(a,void 0,s.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError),void o({errorCode:s.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" localStream no found"}))}))},e.prototype.setPublishStreamConstraints=function(e,t,r){var o=this,i=null;for(var n in this.logger.info("zsc.spsc.0 constraints",JSON.stringify(t)),this.streamCenter.publisherList)this.streamCenter.publisherList[n].localStream==e&&(i=this.streamCenter.publisherList[n]);if(!i)return this.logger.error("zsc.spsc.0 publisher not found"),void(r&&r({errorCode:c.errorCodeList.PUBLISH_NOT_PUBLISH.code,extendedData:c.errorCodeList.PUBLISH_NOT_PUBLISH.message}));this.logger.info("zsc.spsc.0 streamId ",i.streamID);var s=this.streamCenter.checkPreview(e);if(!s)return this.logger.error("zsc.spsc.0 preview no found"),void(r&&r({errorCode:c.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:c.errorCodeList.PUBLISH_NO_PREVIEW.message}));var a=!1,d=!1;(t.width||t.height||t.frameRate)&&(s.mediaStreamConfig.videoQuality=4,a=!0),void 0===t.ANS&&void 0===t.AGC&&void 0===t.AEC||(d=!0);var l=s.localStream,u=l.getVideoTracks()[0],h=l.getAudioTracks()[0];a&&!u?(this.logger.error("zsc.spsc.0 video track not found"),r&&r({errorCode:c.errorCodeList.TRACK_NOT_FOUND.code,extendedData:c.errorCodeList.TRACK_NOT_FOUND.message})):t.video=!0,d&&!h?(this.logger.error("zsc.spsc.0 audio track not found"),r&&r({errorCode:c.errorCodeList.TRACK_NOT_FOUND.code,extendedData:c.errorCodeList.TRACK_NOT_FOUND.message})):t.audio=!0;var p=JSON.parse(JSON.stringify(s.mediaStreamConfig)),f=Object.assign(s.mediaStreamConfig,t),g=s.getMediaStreamConstraints(f,!0);this.logger.info("zsc.spsc.0 applyConstraints ",JSON.stringify(g));var m=[];if(a&&m.push(u.applyConstraints(g.video)),d&&(h.stop(),m.push(navigator.mediaDevices.getUserMedia({video:!1,audio:g.audio}))),t.maxBitrate){var _=i.publisher.peerConnection.getSenders().find((function(e){return e.track&&"video"===e.track.kind})),v=_.getParameters();_?(v.encodings||(v.encodings=[{}]),v.encodings[0].maxBitrate=1e3*t.maxBitrate,m.push(_.setParameters(v))):this.logger.error("zsc.spsc.0 video sender no found")}if(m.length>0)Promise.all(m).then((function(e){if(o.logger.info("zsc.spsc.0 set constraints success",e[1]),d){var n=(a?e[1]:e[0]).getAudioTracks()[0],s=i.publisher.peerConnection.getSenders().find((function(e){return"audio"===e.track.kind}));if(s&&(s.replaceTrack(n),l)){var c=l.getAudioTracks()[0];l.removeTrack(c),l.addTrack(n);var u=o.streamCenter.checkPreview(l);u&&(u.gainNode=null)}}t.maxBitrate&&i.publisher&&(i.publisher.videoInfo.bitRate=t.maxBitrate),r&&r({errorCode:0,extendedData:""})})).catch((function(e){o.logger.error("zsc.spsc.0 fail reason ",e.name,JSON.stringify(e)),r&&r({errorCode:c.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,extendedData:e.name+" "+(e.constraint?"constraint:"+e.constraint:"")})}));else{if(this.logger.warn("zsc.spsc.0 constaints is no changes"),d){var E=s.getMediaStreamConstraints(p);this.logger.info("zsc.spsc.0 oldMediaStreamConstraints ",JSON.stringify(E)),navigator.mediaDevices.getUserMedia({video:!1,audio:E.audio}).then((function(e){e.getTracks().forEach((function(e){var t=l.getTracks().find((function(t){return t.kind===e.kind})),r=i.publisher.peerConnection.getSenders().find((function(t){return null!==t.track&&t.track.kind===e.kind}));r&&(r.replaceTrack(e),t&&l.removeTrack(t),l.addTrack(e))})),o.logger.info("zsc.spsc.0.1 setbackup suc ")})).catch((function(e){o.logger.error("zsc.spsc.0.1 setbackup fail "+e.name)}))}r&&r({errorCode:c.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,extendedData:"constraints is no changes"})}},e.prototype.useVideoDevice=function(e,t){var r=this;return this.logger.info("zc.uvd.0 call"),new Promise((function(o){var i=n.getReportSeq();if(r.dataReport.newReport(i,s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.event),r.dataReport.addMsgInfo(i,{device:s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.device(t)}),!(e instanceof MediaStream))return r.logger.error("zc.uvd.0 localStream not found"),r.dataReport.addMsgInfo(i,s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kLocalStreamError),r.dataReport.uploadReport(i),void o({errorCode:s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message});if("string"!=typeof t)return r.logger.error("zc.uvd.0 deviceID must be string"),r.dataReport.addMsgInfo(i,{error:s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,message:s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message+" deviceID must be string"}),r.dataReport.uploadReport(i),void o({errorCode:s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message});var c=function(t){var n;r.dataReport.uploadReport(i);var s=r.streamCenter.checkPublish(e);s&&(s.cameraLabel=(null===(n=e.getVideoTracks()[0])||void 0===n?void 0:n.label)||s.cameraLabel),o(t)};a.ClientUtil.getDevices((function(i){if(!i.cameras.find((function(e){return e.deviceID==t})))return r.logger.error("zc.uvd.0 device is not found"),void o({errorCode:s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kDevicesNoFoundError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kDevicesNoFoundError.message});r.switchDevice("video",e,t,c)}),(function(o){r.logger.warn("zc.uvd.0 getDevices err:",o),r.switchDevice("video",e,t,c)}))}))},e.prototype.useAudioDevice=function(e,t){var r=this;return this.logger.info("zc.uad.1 call"),new Promise((function(o){var i=n.getReportSeq();r.dataReport.newReport(i,s.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.event),r.dataReport.addMsgInfo(i,{device:s.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.device(t)});var c=function(e,t){r.logger.error("zc.uad.1 "+t);var n=e;n.message=n.message+(t?" "+t:""),r.dataReport.addMsgInfo(i,n),r.dataReport.uploadReport(i),o({errorCode:n.code,extendedData:n.message})},d=function(t){var n;r.dataReport.uploadReport(i);var s=r.streamCenter.checkPublish(e);s&&(s.microLabel=(null===(n=e.getAudioTracks()[0])||void 0===n?void 0:n.label)||s.microLabel),o(t)};e instanceof MediaStream?"string"==typeof t?a.ClientUtil.getDevices((function(i){if(!i.microphones.find((function(e){return e.deviceID==t})))return r.logger.error("zc.uad.1 device is not found"),void o({errorCode:s.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kDevicesNoFoundError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kDevicesNoFoundError.message});r.switchDevice("audio",e,t,d)}),(function(o){r.logger.warn("zc.uad.1 getDevices err:",o),r.switchDevice("audio",e,t,d)})):c(s.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kParamError,"deviceID must be string"):c(s.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kLocalStreamError,"localStream not found")}))},e.prototype.publishTarget=function(e){var t=this,r=n.getReportSeq();switch(e.type){case"addpush":this.dataReport.newReport(r,s.ZegoRTCLogEvent.kZegoTaskAddPublishCdnUrl.event);break;case"delpush":case"clearpush":this.dataReport.newReport(r,s.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.event)}return this.dataReport.addMsgInfo(r,{stream:s.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.stream(e.streamID),target_url:s.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.target_url(e.pushUrl)}),new Promise((function(o,i){var n=function(e,o){t.logger.error("zb.pt"+(o||e.message)),t.dataReport.addMsgInfo(r,{error:e.code,message:e.message+(o||"")}),t.dataReport.uploadReport(r),i({errorCode:e.code,extendedData:e.message+(o?" "+o:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(e.type))return t.logger.error("zb.sh.pt cdn push type error"),void n(c.errorCodeList.PUBLISHER_CDN_PUSH_ERROR,"type error");if(e.streamID&&"string"==typeof e.streamID)if(e.pushUrl&&"string"==typeof e.pushUrl)if(t.stateCenter.publishStreamList[e.streamID]){var a=t.streamCenter.getRoomByStreamID(e.streamID);a?a.streamHandler._publishTarget(e,o,n):n(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoLoginError)}else n(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kPublishStreamNoFoundError);else n(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"push url error");else n(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"stream id type error")}))},e.prototype.switchDevice=function(e,t,r,i){var n=this,s=this.streamCenter.checkPreview(t);if(!s)return this.logger.error("zsc.sd.0 preview no found"),void(i&&i({errorCode:c.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:c.errorCodeList.PUBLISH_NO_PREVIEW.message}));if("video"===e&&0==s.mediaStreamConfig.video)return this.logger.error("zsc.sd.0 camera can not be changed when video is false"),void(i&&i({errorCode:c.errorCodeList.VIDEO_DEVICE_FALSE.code,extendedData:c.errorCodeList.VIDEO_DEVICE_FALSE.message}));if("audio"===e&&0==s.mediaStreamConfig.audio)return this.logger.error("zsc.sd.0 microphone can not be changed when audio is false"),void(i&&i({errorCode:c.errorCodeList.AUDIO_DEVICE_FALSE.code,extendedData:c.errorCodeList.AUDIO_DEVICE_FALSE.message}));s.mediaStreamConfig.videoInput!==r&&delete s.mediaStreamConfig.facingMode;var d,l={};"video"===e?(l.videoInput=r,d=t.getVideoTracks()[0]):(l.audioInput=r,d=t.getAudioTracks()[0]);var u=a.ClientUtil.getBrowser();this.logger.info("zsc.sd.0 browser "+u),"Firefox"===u&&d.stop();var h=o(o({},s.mediaStreamConfig),l),p=s.getMediaStreamConstraints(h),f=function(r,o){var i=n.streamCenter.checkPublish(t);o.getTracks().forEach((function(t){var o,a=r.getTracks().find((function(e){return e.kind===t.kind}));if(a){var c=null===(o=i.publisher.peerConnection)||void 0===o?void 0:o.getSenders().find((function(e){return null!==e.track&&e.track.kind===t.kind}));a.kind===e&&(c?(c.replaceTrack(t),s.gainNode=null):n.logger.warn("zsc.sd.0 no sender found, only switching device on localMediaElement")),a?a.kind===e?(t.enabled=a.enabled,r.removeTrack(a),a.stop(),r.addTrack(t)):t.stop():r.addTrack(t),"audio"===t.kind&&(s.audioTrack=t);var d=t.enabled?0:20,l=i.publisher,u=l.camera_status,h=l.mic_status;"video"==e&&d!==u&&l.sendStreamStatus(d,h),"audio"==e&&d!==h&&l.sendStreamStatus(u,d)}})),s.restartSoundLevel()};"audio"==e?p.video=!1:p.audio=!1,navigator.mediaDevices.getUserMedia(p).then((function(r){Object.assign(s.mediaStreamConfig,l),f(t,r),n.logger.info("zsc.sd.0 swtich "+e+" device success"),i&&i({errorCode:0,extendedData:""})}),(function(r){var o,a;"video"==e?null===(o=t.getVideoTracks()[0])||void 0===o||o.stop():null===(a=t.getAudioTracks()[0])||void 0===a||a.stop(),n.logger.warn("zsc.sd.0 swtich "+e+" device failed, stop last device and retry. ",r+""),navigator.mediaDevices.getUserMedia(p).then((function(r){Object.assign(s.mediaStreamConfig,l),f(t,r),n.logger.info("zsc.sd.0 swtich "+e+" device success"),i&&i({errorCode:0,extendedData:""})}),(function(r){n.logger.warn("zsc.sd.0 swtich "+e+" device failed and recover last device. ",r+"");var o=s.getMediaStreamConstraints(s.mediaStreamConfig),a=c.errorCodeList.VIDEO_DEVICE_FALSE;"audio"===e&&(a=c.errorCodeList.AUDIO_DEVICE_FALSE),navigator.mediaDevices.getUserMedia(o).then((function(o){f(t,o),n.logger.info("zsc.sd.0 recover last "+e+" device success"),i&&i({errorCode:a.code,extendedData:a.message+" "+JSON.stringify(r)})}),(function(t){n.logger.error("zsc.sd.0 swtich "+e+" device and recover failed, please recreate stream. ",t+""),i&&i({errorCode:a.code,extendedData:a.message+" "+JSON.stringify(t)})}))}))}))},e.prototype._replaceTrack=function(e,t,r){var o=this.streamCenter.checkPreview(e),i=this.streamCenter.checkPublish(e);if(/Safari/.test(navigator.userAgent)&&/Chrome/.test(navigator.userAgent),i){var n=i.publisher.replaceTrack(t);r&&r(n)}else{if(!o)return this.logger.error("zc.rt.0 preview no found"),void(r&&r({errorCode:c.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:c.errorCodeList.PUBLISH_NO_PREVIEW.message}));var s=o.localStream,a=s.getTracks().find((function(e){return e.kind===t.kind}));a?(s.removeTrack(a),s.addTrack(t),r&&r({errorCode:0,extendedData:""})):(this.logger.error("zc.rt.0 track no found"),r&&r({errorCode:c.errorCodeList.TRACK_NOT_FOUND.code,extendedData:c.errorCodeList.TRACK_NOT_FOUND.message}))}},e.prototype.enableMicrophone=function(e,t){var r=this.streamCenter.checkPreview(e);return r?r.enableMicrophone(t,this.streamCenter):(this.logger.error("zsc.em.0 no preview"),!1)},e.prototype.enableCamera=function(e,t,r){var o=this.streamCenter.checkPreview(e);return o?o.enableCamera(t,this.streamCenter,r):(this.logger.error("zsc.ec.0 no preview"),!1)},e}();t.AdvancedModule=d},function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenterWeb=void 0;var s=r(0),a=r(9),c=r(24),d=r(26),l=r(0),u=r(27),h=r(28),p=r(29),f=r(30),g=r(4),m=r(1),_=function(e){function t(t,r,o,i,n,s){var a=e.call(this)||this;return a.testEnvironment=!1,a.heartbeatTimer=null,a.heartbeatInterval=1e4,a.qualityTimerInterval=3e3,a.previewStreamList=[],a.signalList={},a.chargeInfos={itemtype:"ChargeInfos",timestamp_begin:0,timestamp_end:0,timestamp_diff_flag:0,timestamp_diff:0,infos:[]},a.chargeInfosTimer=null,a.chargeInfosInterval=6e4,a.chargeInfoSeq=0,a.soundLevelDelegate=!1,a.soundLevelInterval=1e3,a.isPeer=!0,a.probeList={},a.isMicEnabled=!0,a.playerList={},a.publisherList={},a.playSuccessCallBackList={},a.playErrorCallBackList={},a.tryCountConnectInterval=3e3,a.checkMessageTimeout=function(){for(var e in a.signalList)a.signalList[e].signal&&a.signalList[e].signal.checkMessageTimeout()},a.getAllInUseUrl=function(){var e=[];for(var t in a.signalList)e.push(t);return e},a.onDisconnectHandle=function(e,t){if(a.logger.info("zsc.od.0 call"),a.signalList[e]){for(var r=a.signalList[e],o=0;o<r.publishConnectedList.length;o++){var i=a.publisherList[r.publishConnectedList[o]];i&&i.publisher&&i.publisher.onDisconnect(t)}for(o=0;o<r.playConnectedList.length;o++){var n=a.playerList[r.playConnectedList[o]];n&&n.player&&n.player.onDisconnect(t)}delete a.signalList[e],a.stopSignalHeartbeat(),a.stopChargeInfosUpload(),a.stopSoundLevel()}},a.logger=t,a.stateCenter=r,a.dataReport=o,a.rtm=i,a.ac=n,a.mediaEleSources=s,"PRIVATE"==a.stateCenter.type&&(a.isPeer=!1),a}return i(t,e),Object.defineProperty(t.prototype,"cameraPreviewStream",{get:function(){return this.previewStreamList.find((function(e){return"camera"===e.previewType}))},enumerable:!1,configurable:!0}),t.prototype.onSignalDisconnected=function(e){},t.prototype.setQualityMonitorCycle=function(e){var t=this;return this.logger.debug("zsc.qmc.0 timeInterval "+e),0==Object.keys(this.publisherList).length?this.qualityTimerInterval=e:Object.keys(this.publisherList).forEach((function(r){t.publisherList[r].publisher.qualityTimeInterval=e,t.publisherList[r].publisher.setPublishQualityTimer()})),!0},t.prototype.setSessionInfo=function(e,t,r){this.logger.debug("zsc.ssi.0 called"),this.appid=e,this.userid=t,this.testEnvironment=r},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onUpdateHeartBeatIntervalHandle=function(e){e!=this.heartbeatInterval&&(this.logger.debug("zsc.uhb.0 update "+e),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatInterval=e,this.startSignalHeartbeat())},t.prototype.setPublishStateStart=function(e,t,r,o){var i=this;if(this.logger.info("zsc.pss.0 call "+t),this.stateCenter.networkState==s.ENUM_NETWORK_STATE.offline)return this.logger.error("zsc.pss.0 network offline"),!1;var n=this.publisherList[t],a=this.stateCenter.reportSeqList.startPublish[t];if(this.dataReport.eventStart(a,"setPublishState"),n)return this.logger.error("zsc.pss.0 publisher already exist"),this.dataReport.eventEndWithMsgInfo(a,"setPublishState",{message:"publisher already exist"}),this.dataReport.uploadReport(a,void 0,m.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kIsPublishing),delete this.stateCenter.reportSeqList.startPublish[t],!1;var d=new c.ZegoPublish(this.logger,this.dataReport,this.qualityTimerInterval,this,this.ac,this.mediaEleSources,this.stateCenter);d.state=l.ENUM_PUBLISH_STATE.start,d.isPeer=this.isPeer,d.reportSeq=this.stateCenter.reportSeqList.startPublish[t];var u=r.getVideoTracks()[0]&&r.getVideoTracks()[0].label,h=r.getAudioTracks()[0]&&r.getAudioTracks()[0].label,g=r.getVideoTracks()[0]&&r.getVideoTracks()[0].getSettings().deviceId,_=r.getAudioTracks()[0]&&r.getAudioTracks()[0].getSettings().deviceId,v=new p.RetryStreamHandler(this.logger,this.stateCenter,this,!0);return this.publisherList[t]={seq:0,room:e,localStream:r,publisher:d,serverUrls:[],ttl:0,isCenterNode:!1,streamID:t,publishOption:o,cameraLabel:u||"",microLabel:h||"",cameraDeviceId:g||"",microDeviceId:_||"",deviceStateCount:0,retryStreamHandler:v,retryDispatchHandler:new f.RetryDispatchHandler(this.logger,this.stateCenter,this.rtm,this)},d.onPublishStateUpdate=function(e,r,o,n){var s=i.publisherList[r];s?v.publishStateHandle(e,s.streamID,o,n):i.logger.error("zsc.psuh.0 cannot find publish "+t)},d.onPublishQualityUpdate=function(e,r){var o=i.publisherList[e];o?(i.stateCenter.deviceStateOut&&0===r.audio.audioBitrate?(o.deviceStateCount++,o.deviceStateCount>=2&&(o.deviceStateCount=0,i.stateCenter.deviceStateOut=!1,i.logger.warn("zsc.pss.0 publish audio error by device"))):o.deviceStateCount=0,i.onPublishQualityUpdate(o.streamID,r)):i.logger.error("zsc.psuh.0 cannot find publish "+t)},this.dataReport.eventStart(d.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(d.streamReportSeq,"GetSignalUrl"),!0},t.prototype.startPublishingStream=function(e){this.logger.info("zsc.sps.0 call");var t=this.publisherList[e];if(!t)return this.logger.error("zsc.sps.0 publisher don't exist"),!1;var r=t.publisher;if(this.dataReport.eventEndWithMsg(r.reportSeq,"GetSignalUrl",{urls:t.serverUrls,is_center:t.isCenterNode}),this.dataReport.eventEndWithMsg(r.streamReportSeq,"GetSignalUrl",{urls:t.serverUrls,is_center:t.isCenterNode}),!t.serverUrls||0===t.serverUrls.length)return t.retryStreamHandler.publishStateHandle(l.ENUM_PUBLISH_STATE_UPDATE.error,e,g.errorCodeList.DISPATCH_ERROR),this.logger.info("zsc.sps.0 server don't have signal url"),!1;var o=t.serverUrls.indexOf(this.server);-1!==o&&(t.serverUrls.splice(o,1),t.serverUrls.unshift(this.server));var i=t.retryStreamHandler;return i.invalid(),i.init(this.stateCenter.streamRetryTime),i.initStream(e,t.serverUrls),i.activePublish(0)},t.prototype.updateWaitingList=function(e,t,r,o,i){t?e.publishWaitingList.push({streamID:r,success:o,error:i}):e.playWaitingList.push({streamID:r,success:o,error:i})},t.prototype.publishStream=function(e){var t=this.publisherList[e].publisher;if(t){var r=null,o=null,i=this.publisherList[e].publishOption,n=this.checkPreview(this.publisherList[e].localStream);if(n){r=n.localStream,o=n.videoInfo;var s=this.stateCenter.reportSeqList.startPublish[e];this.dataReport.addMsgInfo(s,{cap_w:m.ZegoRTCLogEvent.kZegoTaskPublishStart.cap_w(n.videoInfo.width),cap_h:m.ZegoRTCLogEvent.kZegoTaskPublishStart.cap_h(n.videoInfo.height),w:m.ZegoRTCLogEvent.kZegoTaskPublishStart.w(n.videoInfo.width),h:m.ZegoRTCLogEvent.kZegoTaskPublishStart.h(n.videoInfo.height),video_en_fps:m.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_fps(n.videoInfo.frameRate),video_en_bps:m.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_bps(n.videoInfo.bitRate)}),r?(this.logger.info("zsc.ps.0 call success"),t.gwNodeTTL<(new Date).getTime()&&(t.gwNode="",t.gwNodeList=[],t.gwNodeTTL=0),t.startPublish(e,r,o,n.mediaStreamConfig,i)):this.logger.error("zsc.ps.0 no localStream found")}else this.logger.error("zsc.ps.0 no preview found")}else this.logger.info("zsc.ps.0 publisher don't exist")},t.prototype.connectPublishServer=function(e,t){var r=this,o=this.publisherList[e];return o?(this.dataReport.eventStart(o.publisher.reportSeq,"ConnectServer"),this.dataReport.eventStart(o.publisher.streamReportSeq,"ConnectServer"),this.connectWithReuseSignalServer(e,!0,t,(function(e,t,o){var i=r.publisherList[e];if(i){var n=i.publisher;if(n){r.dataReport.eventEndWithMsg(n.reportSeq,"ConnectServer",{result:0,server:o}),r.dataReport.eventEndWithMsg(n.streamReportSeq,"ConnectServer",{result:0,server:o});var s=t.tokenInfo;r.logger.info("zsc.cps.0 update token success"),s&&s.report&&(n.qualityUpload=s.report,n.qualityUploadInterval=s.report_interval),n.signal=t.signal,r.server=o,r.publishStream(e),r.getTokenSuccess()}else r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")}),(function(e,t){r.logger.error("zsc.cps.0 "+e+" connect fail "+t);var o=r.publisherList[e];if(o){var i=o.publisher;if(i){r.dataReport.eventEndWithMsg(i.reportSeq,"ConnectServer",{result:t}),r.dataReport.uploadReport(i.reportSeq),delete r.stateCenter.reportSeqList.startPublish[e];var s=n({},g.errorCodeList.CONNECT_FAILED);s.message=s.message+" "+t,1008===t&&(s=g.errorCodeList.TOKEN_EXPIRED),o.retryStreamHandler.publishStateHandle(l.ENUM_PUBLISH_STATE_UPDATE.error,e,s,1008==t)}else r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")})),!0):(this.logger.error("zsc.cps.0 publisher don't exist"),!1)},t.prototype.getTokenSuccess=function(){this.logger.debug("zsc.gts.0 call")},t.prototype.stopPublishingStream=function(e){var t=this.publisherList[e];if(t){var r=t.retryStreamHandler;for(var o in r&&(r.stopMaxTime(),r.invalid()),this.signalList)this.signalList[o].publishWaitingList=this.signalList[o].publishWaitingList.filter((function(t){return t.streamID!==e}));delete this.publisherList[e],t.publisher&&(t.publisher.stopPublish(),delete t.publisher),this.removeStreamFromSignal(!0,e),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),this.logger.debug("zsc.sps.0.1 call success")}else this.logger.warn("zsc.sps.0.1 publisher don't exist")},t.prototype.connectWithReuseSignalServer=function(e,t,r,o,i){var n=this;this.logger.info("zsc.crss.0 begin "+r);var s=null;if(this.signalList[r])(s=this.signalList[r]).state==l.ENUM_SIGNAL_STATE.connected?(this.logger.info("zsc.crss.0 already connected "+r+" streamId: "+e),t?s.publishConnectedList.push(e):s.playConnectedList.push(e),o(e,s,r)):s.state==l.ENUM_SIGNAL_STATE.connecting&&(this.logger.info("zsc.crss.0 signal is connecting "+r+" streamId: "+e),this.updateWaitingList(s,t,e,o,i));else{this.logger.info("zsc.crss.0 new signal "+r+" streamId: "+e);var a=new u.ZegoSignal(this.logger,this.stateCenter);a.setSessionInfo(this.appid,this.userid),a.onUpdateHeartBeatInterval=this.onUpdateHeartBeatIntervalHandle.bind(this),a.onDisconnect=this.onDisconnectHandle;var c=this.publisherList[e]?this.publisherList[e].retryStreamHandler:this.playerList[e]?this.playerList[e].retryStreamHandler:null;if(this.stateCenter.streamConnectTime)a.tryConnectInterval=this.stateCenter.streamConnectTime;else if(c&&c.retryActiveCount){var d=c.retryActiveCount*(c.retryActiveCount-1)/2+2;d=d>l.MAX_RETRY_CONNECT_INTERVAL?l.MAX_RETRY_CONNECT_INTERVAL:d,a.tryConnectInterval=1e3*d}this.signalList[r]={signal:a,state:l.ENUM_SIGNAL_STATE.connecting,publishWaitingList:[],playWaitingList:[],publishConnectedList:[],playConnectedList:[],tokenInfo:null},this.updateWaitingList(this.signalList[r],t,e,o,i),a.connectServer(this.stateCenter.roomList[0].token,r,(function(e,t,o){s=n.signalList[r];var i,a,c=0;if(0!=e){for(n.logger.info("zsc.crss.0 connect failed "+t),c=0;c<s.publishWaitingList.length;c++)(i=s.publishWaitingList[c]).error&&i.error(i.streamID,e);for(c=0;c<s.playWaitingList.length;c++)(a=s.playWaitingList[c]).error&&a.error(a.streamID,e);delete n.signalList[r]}else{for(n.logger.debug("zsc.crss.0 connected success "+t),s.state=l.ENUM_SIGNAL_STATE.connected,s.tokenInfo=o,c=0;c<s.publishWaitingList.length;c++)(i=s.publishWaitingList[c]).success&&i.success(i.streamID,s,t),s.publishConnectedList.push(i.streamID);for(c=0;c<s.playWaitingList.length;c++)(a=s.playWaitingList[c]).success&&a.success(a.streamID,s,t),s.playConnectedList.push(a.streamID);s.publishWaitingList=[],s.playWaitingList=[],null==n.heartbeatTimer&&n.startSignalHeartbeat(),null==n.chargeInfosTimer&&n.startChargeInfosUpload(),n.activeSoundLevel()}}))}},t.prototype.setPlayStateStart=function(e,t){var r=this;if(this.logger.info("zsc.pss.1 call "+e),this.stateCenter.networkState==s.ENUM_NETWORK_STATE.offline)return this.logger.error("zsc.pss.1 network offline"),!1;var o=this.playerList[e],i=this.stateCenter.reportSeqList.startPlay[e];if(this.dataReport.eventStart(i,"setPlayState"),o)return this.logger.error("zsc.pss.1 player already exist"),this.dataReport.eventEndWithMsgInfo(i,"setPlayState",{message:"player already exist"}),this.dataReport.uploadReport(i,void 0,m.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kIsPlaying),delete this.stateCenter.reportSeqList.startPlay[e],!1;var n=this.getPlayRoom(e)||this.stateCenter.roomList[0];if(!n)return this.logger.error("zsc.pss.1 not login room"),this.dataReport.eventEndWithMsgInfo(i,"setPlayState",{message:"not login room"}),this.dataReport.uploadReport(i,void 0,m.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError),!1;var a=new h.ZegoPlayWeb(this.logger,null,this.dataReport,this.qualityTimerInterval,this,this.ac,this.stateCenter);t&&[0,2,3].includes(t.resourceMode)&&(a.resourceMode=t.resourceMode),this.dataReport.addMsgInfo(i,{resourceMode:a.resourceMode,play_room_id:n.roomID,isMulti:this.stateCenter.isMultiRoom}),a.state=l.ENUM_PLAY_STATE.start,a.isPeer=this.isPeer,a.reportSeq=this.stateCenter.reportSeqList.startPlay[e],a.beginTime=(new Date).getTime();var c=new p.RetryStreamHandler(this.logger,this.stateCenter,this,!1);return this.playerList[e]={seq:0,room:n,player:a,signal:null,serverUrls:[],ttl:0,isCenterNode:!1,streamID:e,playOption:t,retryStreamHandler:c,retryDispatchHandler:new f.RetryDispatchHandler(this.logger,this.stateCenter,this.rtm,this)},a.onPlayStateUpdate=function(e,t,o,i){var n=r.playerList[t];n?c.playStateHandle(e,n.streamID,o,i):r.logger.error("zsc.pss.1 cannot find play "+t)},a.onPlayQualityUpdate=function(e,t){var o=r.playerList[e];o?r.onPlayQualityUpdate(o.streamID,t):r.logger.error("zsc.pss.1 cannot find play "+e)},a.onRemoteCameraStatusUpdate=function(e,t,o){var i=r.playerList[e];i?r.onRemoteCameraStatusUpdate(i.streamID,t,o):r.logger.error("zsc.pss.1 cannot find play "+e)},a.onRemoteMicStatusUpdate=function(e,t,o){var i=r.playerList[e];i?r.onRemoteMicStatusUpdate(i.streamID,t,o):r.logger.error("zsc.pss.1 cannot find play "+e)},this.dataReport.eventStart(a.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(a.streamReportSeq,"GetSignalUrl"),!0},t.prototype.onRemoteMicStatusUpdate=function(e,t,r){},t.prototype.onRemoteCameraStatusUpdate=function(e,t,r){},t.prototype.startPlayingStream=function(e,t){this.logger.info("zsc.sps.1 start play called");var r=this.playerList[e];if(!r)return this.logger.error("zsc.sps.1 player don't exist"),!1;var o=r.player;if(this.dataReport.eventEndWithMsg(o.reportSeq,"GetSignalUrl",{urls:r.serverUrls}),this.dataReport.eventEndWithMsg(o.streamReportSeq,"GetSignalUrl",{urls:r.serverUrls}),0==r.serverUrls.length)return r.retryStreamHandler.playStateHandle(l.ENUM_PLAY_STATE_UPDATE.error,e,g.errorCodeList.DISPATCH_ERROR),this.logger.info("zsc.sps.1 server don't have signal url"),!1;var i=r.serverUrls.indexOf(this.server);-1!==i&&(r.serverUrls.splice(i,1),r.serverUrls.unshift(this.server));var n=r.retryStreamHandler;return n.invalid(),n.init(this.stateCenter.streamRetryTime),n.initStream(e,r.serverUrls),n.activePull(0,t)},t.prototype.connectPlayServer=function(e,t,r){var o=this,i=this.playerList[e];return i?(this.dataReport.eventStart(i.player.reportSeq,"ConnectServer"),this.dataReport.eventStart(i.player.streamReportSeq,"ConnectServer"),this.connectWithReuseSignalServer(e,!1,r,(function(e,r,i){var n=o.playerList[e];if(n){var s=n.player;if(s){o.dataReport.eventEndWithMsg(s.reportSeq,"ConnectServer",{result:0,server:i}),o.dataReport.eventEndWithMsg(s.streamReportSeq,"ConnectServer",{result:0,server:i});var a=r.tokenInfo;o.logger.info("zsc.cps.1 update token success"),a&&a.report&&(s.qualityUpload=a.report,s.qualityUploadInterval=a.report_interval),s.signal=r.signal,o.server=i,o.playStream(e,t),o.getTokenSuccess()}else o.logger.error("zsc.cps.1 checkplayer don't exist")}else o.logger.error("zsc.cps.1 after connect player don't exist")}),(function(t,r){var i=o.playerList[t];if(i){o.dataReport.eventEndWithMsg(i.player.reportSeq,"ConnectServer",{result:r}),o.dataReport.uploadReport(i.player.reportSeq),delete o.stateCenter.reportSeqList.startPlay[e];var s=n({},g.errorCodeList.CONNECT_FAILED);s.message=s.message+" "+r,1008===r&&(s=g.errorCodeList.TOKEN_EXPIRED),i.retryStreamHandler.playStateHandle(l.ENUM_PLAY_STATE_UPDATE.error,t,s,1008==r)}else o.logger.error("zsc.cps.1 after connect player don't exist")})),!0):(this.logger.error("zsc.cps.1 player don't exist"),!1)},t.prototype.playStream=function(e,t){var r=this.playerList[e].player;r?(this.logger.info("zsc.ps.1 call success"),r.gwNodeTTL<(new Date).getTime()&&(r.gwNode="",r.gwNodeList=[],r.gwNodeTTL=0),r.startPlay(e,t,this.playerList[e].playOption)):this.logger.warn("zsc.ps.1 player don't exist")},t.prototype.stopSignalHeartbeat=function(){this.logger.debug("zsc.ssh.1 call");var e=0;for(var t in this.signalList)e+=1;this.heartbeatTimer&&0==e&&(this.logger.info("zsc.ssh.1 stop"),clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},t.prototype.removeStreamFromSignal=function(e,t){var r=[];for(var o in this.signalList){var i=this.signalList[o];if(e){for(var n=0;n<i.publishConnectedList.length;n++)if(i.publishConnectedList[n]===t){this.logger.debug("zsc.rsfs.0 found from publish"),i.publishConnectedList.splice(n,1);break}for(n=0;n<i.publishWaitingList.length;n++)if(i.publishWaitingList[n].streamID===t){this.logger.debug("zsc.rsfs.0 found from publish"),i.publishWaitingList.splice(n,1);break}}else{for(var s=0;s<i.playConnectedList.length;s++)if(i.playConnectedList[s]===t){this.logger.debug("zsc.rsfs.0 found from play"),i.playConnectedList.splice(s,1);break}for(s=0;s<i.playWaitingList.length;s++)if(i.playWaitingList[s].streamID===t){this.logger.debug("zsc.rsfs.0 found from play"),i.playWaitingList.splice(s,1);break}}0==i.publishConnectedList.length&&0==i.playConnectedList.length&&0==i.publishWaitingList.length&&0==i.playWaitingList.length&&(i.signal.disconnectServer(),r.push(o))}for(var a=0;a<r.length;a++)delete this.signalList[r[a]],this.server==r[a]&&(this.server="")},t.prototype.stopPlayingStream=function(e){var t=this.playerList[e];if(t){var r=t.retryStreamHandler;for(var o in r&&(r.stopMaxTime(),r.invalid()),this.signalList)this.signalList[o].playWaitingList=this.signalList[o].playWaitingList.filter((function(t){return t.streamID!==e}));delete this.playerList[e],t.player&&(t.player.stopPlay(),delete t.player),this.removeStreamFromSignal(!1,e),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),delete this.playSuccessCallBackList[e],delete this.playErrorCallBackList[e],this.logger.debug("zsc.sps.1.1 call success")}else this.logger.info("zsc.sps.1.1 player don't exist")},t.prototype.reset=function(e){for(var t in this.publisherList)(this.publisherList[t].room.roomID==e||!e)&&this.stopPublishingStream(t);var r=function(t){var r=o.playerList[t].room;if(r.roomID!=e||!r.streamList.find((function(e){return e.stream_id==t}))&&1!=o.stateCenter.roomList.length){if(r.roomID==e&&o.stateCenter.roomList.length>1){var i=o.stateCenter.roomList.find((function(t){return t.roomID!==e}));i?o.playerList[t].room=i:o.stopPlayingStream(t)}}else o.stopPlayingStream(t)},o=this;for(var i in this.playerList)r(i);0==Object.keys(this.publisherList).length&&0==Object.keys(this.playerList).length&&(this.probeList={})},t.prototype.startSignalHeartbeat=function(){var e=this;this.logger.debug("zsc.ssh.0 call"),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatTimer=setTimeout((function(){e.checkSignalHeartbeat()}),this.heartbeatInterval)},t.prototype.startChargeInfosUpload=function(){var e=this;this.logger.debug("zsc.sciu.0 call"),this.chargeInfosTimer&&(clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null),this.chargeInfosTimer=setTimeout((function(){e.checkChargeInfos()}),this.chargeInfosInterval)},t.prototype.checkChargeInfos=function(){this.logger.debug("zsc.cci.0 call");var e={is_publishing:0,play_max_audio_bitrate:0,play_stream_resolution_infos:[]};for(var t in this.chargeInfos.timestamp_begin=(new Date).getTime(),this.publisherList){this.publisherList[t].publisher.state===l.ENUM_PUBLISH_STATE.publishing&&(e.is_publishing=1);break}e.play_max_audio_bitrate=0;var r=function(t){var r=o.playerList[t].player.playStream,i=r&&0!==r.getVideoTracks().length?r.getVideoTracks()[0].getSettings():void 0,n={video_width:i&&i.width?i.width:0,video_height:i&&i.height?i.height:0,count:1};if(!e.play_stream_resolution_infos.find((function(e){return e.video_width==n.video_width&&e.video_height==n.video_height&&(e.count++,!0)}))&&e.play_stream_resolution_infos.push(n),0==n.video_width&&0==n.video_height){var s=1e3*o.playerList[t].player.lastPlayStats.audioBitrate;s>e.play_max_audio_bitrate&&(e.play_max_audio_bitrate=s)}},o=this;for(var i in this.playerList)r(i);0!==this.chargeInfos.timestamp_end?(this.chargeInfos.timestamp_diff=this.chargeInfos.timestamp_begin-this.chargeInfos.timestamp_end,this.chargeInfos.timestamp_diff_flag=1):(this.chargeInfos.timestamp_diff=0,this.chargeInfos.timestamp_diff_flag=0),this.chargeInfos.timestamp_end=(new Date).getTime(),this.chargeInfos.infos=[e],0!==e.play_stream_resolution_infos.length&&this.logger.report(this.chargeInfos),this.chargeInfosTimer&&this.startChargeInfosUpload()},t.prototype.checkSignalHeartbeat=function(){for(var e in this.logger.debug("zsc.csh.0 call"),this.signalList)this.signalList[e].signal&&this.signalList[e].signal.sendHeartbeat();this.heartbeatTimer&&this.startSignalHeartbeat()},t.prototype.stopChargeInfosUpload=function(){this.logger.debug("zsc.sciu.0 call");var e=0;for(var t in this.signalList)e+=1;this.chargeInfosTimer&&0==e&&(this.logger.info("zsc.sciu.0 stop"),clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null)},t.prototype.getPublisher=function(e){var t=null;return this.publisherList[e]&&this.publisherList[e].publisher&&(t=this.publisherList[e].publisher),t},t.prototype.checkPreview=function(e){for(var t=0;t<this.previewStreamList.length;t++)if(this.previewStreamList[t].localStream===e)return this.previewStreamList[t];return null},t.prototype.checkPublish=function(e){for(var t in this.publisherList)if(this.publisherList[t].localStream==e)return this.publisherList[t];return null},t.prototype.removePreview=function(e){for(var t=0;t<this.previewStreamList.length;t++)if(this.previewStreamList[t]===e){this.previewStreamList.splice(t,1);break}},t.prototype.onPlayerStreamUrlUpdate=function(e,t,r){},t.prototype.getScreenConstrains=function(e){var t={};if("boolean"==typeof e&&e)t={audio:!1,frameRate:l.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:l.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate};else if("object"==typeof e){switch(e.videoQuality){case 1:t={frameRate:l.ENUM_SCREEM_RESOLUTION_TYPE.LOW.frameRate,bitRate:l.ENUM_SCREEM_RESOLUTION_TYPE.LOW.bitRate};break;case 3:t={frameRate:l.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.frameRate,bitRate:l.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.bitRate};break;case 4:t={frameRate:e.frameRate,bitRate:e.bitRate,width:e.width,height:e.height};break;case 2:default:t={frameRate:l.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:l.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate}}t.audio="boolean"==typeof e.audio&&e.audio,t.startBitrate=e.startBitrate}return t},t.prototype.createScreenPreviewer=function(e,t){var r=new a.ZegoPreview(this.logger,this.ac,this,"screen"),o=e.getVideoTracks()[0].getSettings();return this.previewStreamList.push(r),r.mediaStreamConfig=t,e.getAudioTracks().length>0&&(r.audioTrack=e.getAudioTracks()[0]),r.localStream=e,r.videoInfo={width:o.width,height:o.height,frameRate:o.frameRate||15,bitRate:(null==t?void 0:t.bitRate)||1e3,startBitrate:null==t?void 0:t.startBitrate},r.previewSuc=!0,r.previewType="screen",r},t.prototype.setSoundLevelDelegate=function(e,t){for(var r in this.logger.info("zsc.ssd.0 call"),t&&(this.soundLevelInterval=t),this.soundLevelDelegate=e,this.previewStreamList){var o=this.previewStreamList[r];e?o.startSoundLevel():o.stopSoundLevel()}for(var r in this.playerList){var i=this.playerList[r].player;e?i.startSoundLevel():i.stopSoundLevel()}e?(this.logger.info("zsc.ssd.0 start getting sound"),this.activeSoundLevel()):(this.logger.info("zsc.ssd.0 stop getting sound"),this.soundLevelTimer&&clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null,this.soundLevelInterval=1e3)},Object.defineProperty(t.prototype,"hasRemoteStream",{get:function(){return Object.keys(this.signalList).length>0},enumerable:!1,configurable:!0}),t.prototype.activeSoundLevel=function(){!this.soundLevelTimer&&this.soundLevelDelegate&&this.startSoundLevel()},t.prototype.startSoundLevel=function(){var e=this;this.soundLevelTimer&&(clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null),this.soundLevelDelegate&&(this.hasRemoteStream&&this.checkSoundLevel(),this.checkMicSoundLevel(),this.soundLevelTimer=setTimeout((function(){e.startSoundLevel()}),this.soundLevelInterval))},t.prototype.checkSoundLevel=function(){this.logger.debug("zsc.csl.0 call");var e=[];for(var t in this.publisherList){var r=0,o=this.publisherList[t].publisher,i=o.previewer;i&&(r=i.soundLevel),e.push({streamID:this.getBackStreamId(o.streamId),soundLevel:r,type:"push"})}for(var t in this.playerList){var n=this.playerList[t].player;n.streamId&&!n.isProbe&&e.push({streamID:this.getBackStreamId(n.streamId),soundLevel:n.soundLevel,type:"pull"})}this.soundLevelDelegate&&e.length>0&&this.onSoundLevelUpdate(e)},t.prototype.checkMicSoundLevel=function(){if(this.cameraPreviewStream&&this.soundLevelDelegate){var e=this.cameraPreviewStream.soundLevel;this.onMicSoundLevelUpdate(e)}},t.prototype.getBackStreamId=function(e){return this.testEnvironment&&e?e.replace("zegotest-"+this.appid+"-",""):e},t.prototype.onSoundLevelUpdate=function(e){},t.prototype.onMicSoundLevelUpdate=function(e){},t.prototype.stopSoundLevel=function(){var e=this.previewStreamList.length;this.soundLevelTimer&&!this.hasRemoteStream&&0===e&&(this.logger.info("zsc.ssl.0 stop"),clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null)},t.prototype.startNetProbe=function(e,t,r){var o=this,i=s.getReportSeq();if(this.dataReport.newReport(i,m.ZegoRTCLogEvent.kZegoNetProbe.event),this.isPeer){var n=!0;0==r.length&&(n=!1,r=e?this.publisherList[t.streamId].serverUrls:this.playerList[t.streamId].serverUrls),r.forEach((function(r){if(!(o.probeList[r]&&o.probeList[r].timeStamp+9e5<(new Date).getTime()||t.probeState==l.ENUM_PROBE_STATE.probed)){var i="zegoprobe-"+(new Date).getTime();o.setPlayStateStart(i);var s=o.playerList[i]?o.playerList[i].player:null;s&&(s.isProbe=!0,n?(s.gwNode=r,s.signal=t.signal,s.startPlay(i,(function(){}))):o.connectPlayServer(i,(function(){}),r),s.onCalNetQualityResult=function(n,a){o.logger.info("zc.ocnqr.0 "+s.gwNode+" "+n+" "+a),o.probeList[r]={result:n,netQuality:a,timeStamp:(new Date).getTime()},t.gwNode==r||t.signal.server==r?t.netQuality=a:o.handleCalNetQualityResult(e,n,a,t,r),o.stopPlayingStream(i)})}})),this.dataReport.addMsgInfo(i,{netQuality:t.netQuality,nodeList:r}),this.dataReport.uploadReport(i)}else this.dataReport.uploadReport(i,void 0,{code:-1,message:"not support peer"})},t.prototype.handleCalNetQualityResult=function(e,t,r,o,i){if(this.logger.info("zc.hcqr.0 "+o.netQuality+" probe "+r+" "+i),0===t){var n=s.getReportSeq();this.dataReport.newReport(n,m.ZegoRTCLogEvent.kZegoNetProbeResult.event);var a=!1;if(r>Math.max(75,o.netQuality+20)&&o.probeState==l.ENUM_PROBE_STATE.tryProbe)if(a=!0,e){var c=o,d=c.streamId,u=c.localStream,h=c.videoInfo,p=c.mediaStreamConfig,f=c.publishOption;0!=c.sessionId&&c.signal&&c.shouldSendCloseSession()&&(c.signal.sendCloseSession(l.getSeq(),c.sessionId,1),c.signal.removeSession(c.sessionId),c.closeSessionSignal=!0),c.resetPublish(),this.publisherList[d].isCenterNode?(c.gwNode=i,c.startPublish(d,u,h,p,f)):this.connectPublishServer(d,i)}else{var g=o,_=(d=g.streamId,g.getRemoteStreamSuc),v=g.playOption;0!=g.sessionId&&g.signal&&g.shouldSendCloseSession()&&(g.signal.sendCloseSession(l.getSeq(),g.sessionId,1),g.signal.removeSession(g.sessionId),g.closeSessionSignal=!0),g.resetPlay(),this.playerList[d].isCenterNode?(g.gwNode=i,g.startPlay(d,_,v)):this.connectPlayServer(d,_,i)}else a=!1,this.logger.warn("zc.hcqr.0 "+o.netQuality+" probe "+r+" "+i);this.dataReport.addMsgInfo(n,{isSwitch:a,isPublish:e,streamID:o.streamId,result:t,node:i,netQuality:o.netQuality,probeNetQuality:r}),this.dataReport.uploadReport(n),o.probeState=l.ENUM_PROBE_STATE.probed}},t.prototype.getRoomByStreamID=function(e){return this.publisherList[e]?this.publisherList[e].room:this.playerList[e]?this.playerList[e].room:void 0},t.prototype.getPlayRoom=function(e){return this.stateCenter.roomList.find((function(t){return!!t.streamList.find((function(t){return t.stream_id==e}))}))},t}(d.ZegoStreamCenter);t.ZegoStreamCenterWeb=_},function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPublish=void 0;var s=r(0),a=n(r(10)),c=r(25),d=r(6),l=r(3),u=r(1),h=r(2),p=r(4),f=function(){function e(e,t,r,o,i,n,a){this.state=s.ENUM_PUBLISH_STATE.stop,this.sessionId=0,this.sessionToken="",this.candidateInfo=[],this.qualityTimer=null,this.publishQualityList=[],this.maxQualityListCount=10,this.lastPublishStats={},this.reportSeq=NaN,this.streamReportSeq=s.getSeq(),this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.qualitySeq=0,this.videoInfo={width:0,height:0,frameRate:0,bitRate:0,channelCount:1,audioBitrate:48e3},this.mediaStreamConfig=null,this.offerSeq=0,this.audioMixList=[],this.arrayBufferMap={},this.effectList=[],this.peerConnection=null,this.qualityCount=0,this.closeSessionSignal=!1,this.channelCount=1,this.localSdpRevert=!1,this.remoteSdpRevert=!1,this.videoCodec="H264",this.stateNego=s.ENUM_PUBLISH_STATE_NEGO.stop,this.negoInterval=25e3,this.publishEvent=!1,this.cameraState="on",this.microState="on",this.gwNode="",this.gwNodeList=[],this.gwNodeTTL=0,this.needIncMax=!1,this.probeCount=0,this.gotMax=!1,this.initFitCnt=0,this.targetRate=0,this.totalBitrateArray=[],this.totalTargetRateArray=[],this.totalRetransRateArray=[],this.isPeer=!1,this.peerFailCount=0,this.peerID=0,this.netQuality=0,this.probeTime=0,this.probeInterval=6e4,this.probeState=s.ENUM_PROBE_STATE.probed,this.toBeReplacedTracks={},this.camera_status=2,this.mic_status=2,this.logger=e,this.dataReport=t,this.qualityTimeInterval=r,this.ac=i,this.mediaEleSources=n,this.streamCenter=o,this.stateCenter=a,this.dataReport.newReport(this.streamReportSeq)}return Object.defineProperty(e.prototype,"previewer",{get:function(){return this.streamCenter.checkPreview(this.localStream)},enumerable:!1,configurable:!0}),e.prototype.publishStateUpdateError=function(e,t){this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STATE_ERROR+"  call ",this.streamId,JSON.stringify(e)),this.streamId&&this.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,this.streamId,e,t),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STATE_ERROR+"  ended")},e.prototype.resetPublish=function(){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_RESET_PUBLISH+"   "+this.streamId+" call"),this.state=s.ENUM_PUBLISH_STATE.stop,this.publishEvent=!1,null==this.peerConnection&&null==this.peerConnection||(this.peerConnection.close(),this.peerConnection=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.clearPublishQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId),this.signal.unregisterPushCallback("SessionResetPush",this.sessionId),this.signal.unregisterPushCallback("PublishEventPush",this.sessionId),this.signal.unregisterPushCallback("ClientInfoPush",this.sessionId)),this.sessionSeq=0,this.offerSeq=0,this.candidateInfo=[],this.publishQualityList=[],this.qualityUploadLastTime=0,this.resetEncBitrate()},e.prototype.clearPublishQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPublishStats={},this.qualityCount=0},e.prototype.shouldSendCloseSession=function(){return this.state!=s.ENUM_PUBLISH_STATE.stop&&this.state!=s.ENUM_PUBLISH_STATE.waitingSessionRsp},e.prototype.startPublish=function(e,t,r,o,i){var n=this;this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+e+" called"),this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),e?(this.streamId=e,this.localStream=t,this.mediaStreamConfig=o,this.channelCount=o.channelCount,this.publishOption=i||{},navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&o&&(o.externalCapture||o.externalMediaStream)&&(this.localStream.onaddtrack=function(){var e,t;n.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+n.streamId+" Track added");var r=n.localStream.getVideoTracks(),o=n.localStream.getAudioTracks();if(r.length>1)null==(i=null===(e=n.peerConnection)||void 0===e?void 0:e.getSenders().find((function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.kind)===r[1].kind})))||i.replaceTrack(r[1]),n.localStream.removeTrack(r[0]);else if(o.length>1){var i;null==(i=null===(t=n.peerConnection)||void 0===t?void 0:t.getSenders().find((function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.kind)===o[1].kind})))||i.replaceTrack(o[1]),n.localStream.removeTrack(o[0])}}),r&&(this.videoInfo=r),i&&i.videoCodec&&(this.videoCodec=i.videoCodec),this.dataReport.addMsgInfo(this.reportSeq,{video_en_codec_id:u.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_codec_id("VP8"==this.videoCodec?2:0),audio_c_channel_count:u.ZegoRTCLogEvent.kZegoTaskPublishStart.audio_c_channel_count(2==this.channelCount?2:1),audio_en_bps:u.ZegoRTCLogEvent.kZegoTaskPublishStart.audio_en_bps(this.videoInfo.audioBitrate),aec_level:u.ZegoRTCLogEvent.kZegoTaskPublishStart.aec_level(1==o.AEC?2:0==o.AEC?0:2),ans_level:u.ZegoRTCLogEvent.kZegoTaskPublishStart.ans_level(1==o.ANS?2:0==o.ANS?0:2),agc:u.ZegoRTCLogEvent.kZegoTaskPublishStart.agc(1==o.AGC?2:0==o.AGC?0:2),traffic_control_min_video_bitrate:u.ZegoRTCLogEvent.kZegoTaskPublishStart.traffic_control_min_video_bitrate(this.videoInfo.bitRate)}),this.isPeer?this.createOffer():this.createSession(),this.negoTimer=setTimeout((function(){n.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" waiting timeout"),n.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNegoTimeoutError)}),this.negoInterval)):this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+e+" streamId is null")},e.prototype.activateSEIInsert=function(e,t){var r=this;return new Promise((function(o,i){return r.signal?(r.signal&&r.signal.activateSEIInsert(s.getSeq(),r.sessionId,r.peerID,e,t,(function(e,t,i){var n=!1;0===i.result?(r.logger.info(h.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" called success"),n=!0):1===i.result?(r.logger.error(h.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" "+i.peer_id+" invalid param."),n=!1):2===i.result&&(r.logger.error(h.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" peer not exist"),n=!1),o(n)}),(function(e){s.SEND_MSG_TIMEOUT===e&&r.logger.error(h.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" request timeout")})),!1):o(!1)}))},e.prototype.createSession=function(e){var t=this;this.sessionSeq=s.getSeq();var r=this.streamId;1==this.streamCenter.testEnvironment&&(r="zegotest-"+this.streamCenter.appid+"-"+this.streamId),this.isPeer?(this.dataReport.eventStart(this.reportSeq,"CreateSessionWithSdp"),this.dataReport.eventStart(this.streamReportSeq,"CreateSessionWithSdp"),this.signal.createSessionWithSdp({seq:this.sessionSeq,type:0,mode:0,streamId:r,videoInfo:this.videoInfo,strAuthParam:this.publishOption&&this.publishOption.streamParams||"",sdp:e.sdp,serverHost:this.gwNode},(function(e,r,o){t.handleCreateSessionWithSdpResp(e,r,o)}),(function(r,o){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:r}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:r}),r==s.SEND_MSG_TIMEOUT&&t.peerFailCount<2?(t.peerFailCount++,t.createSession(e)):r==s.SEND_MSG_TIMEOUT&&t.peerFailCount>=2?(t.isPeer=!1,t.streamCenter.isPeer=!1,t.createSession()):t.publishStateUpdateError(r==s.SEND_MSG_TIMEOUT?u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError:u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)}))):(this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,0,0,r,this.publishOption&&this.publishOption.streamParams,this.gwNode,(function(e,r,o){t.handleCreateSessionResp(e,r,o)}),(function(e,r){t.reportSeq,t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:e}),t.publishStateUpdateError(e==s.SEND_MSG_TIMEOUT?u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError:u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)}))),this.state=s.ENUM_PUBLISH_STATE.waitingSessionRsp,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" called success"),this.stateNego=s.ENUM_PUBLISH_STATE_NEGO.start},e.prototype.handleCreateSessionResp=function(e,t,r){var o=r.turn_server,i=o.split("?")[0]&&o.split("?")[0].slice(5),n=this.streamCenter.server.split("?"),s=n[1]&&n[1].slice(2);this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+i+"/"+s+"/"+this.streamId}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+i+"/"+s+"/"+this.streamId}),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" sessionId:"+r.session_id),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,0!==r.result?(this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create session failed "+r.result),this.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)):(this.sessionId=r.session_id,this.sessionToken=r.session_token,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create session success "+this.sessionId),this.dataReport.addMsgInfo(this.reportSeq,{session_id:u.ZegoRTCLogEvent.kZegoTaskPublishStart.session_id(this.sessionId)}),this.onCreatePublishSessionSuccess(r))):this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" seq is not match.")},e.prototype.handleCreateSessionWithSdpResp=function(e,t,r){var o=this;this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" sessionId:"+t),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSessionWithSdp",{sessionId:t}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSessionWithSdp",{sessionId:t}),0!==r.result?(this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" create session failed "+r.result),this.publishStateUpdateError({code:u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError.code,message:u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError.message+" result:"+r.result})):(this.sessionId=t,this.sessionToken=r.session_token,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" get remote session success "+this.streamId),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,t,r){o.onRecvCloseSession(e,t,r)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,t,r){o.onRecvResetSession(e,t,r)})),this.signal.registerPushCallback("PublishEventPush",this.sessionId,(function(e,t,r){o.onRecvPublishEvent(e,t,r)})),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,(function(e,t,r){o.onRecvClientInfo(e,t,r)})),this.onGetRemoteOfferSuccess(r.sdp))):this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" seq is not match.")},e.prototype.onCreatePublishSessionSuccess=function(e){var t=this;this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" called");var r=[];if(e.turn_server){var o=e.turn_server;this.stateCenter.turnOverTcpOnly&&(o=o.replace("udp","tcp")),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" over tcp "+o),r.push(o)}e.stun_server&&r.push(e.stun_server);var i={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" username: "+e.turn_username),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" credential: "+e.turn_auth_key),this.createOffer(i),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,(function(e,r,o){t.onRecvCandidateInfo(e,r,o)})),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,r,o){t.onRecvCloseSession(e,r,o)})),this.signal.registerPushCallback("MediaDescPush",this.sessionId,(function(e,r,o){t.onRecvMediaDescription(e,r,o)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,r,o){t.onRecvResetSession(e,r,o)})),this.signal.registerPushCallback("PublishEventPush",this.sessionId,(function(e,r,o){t.onRecvPublishEvent(e,r,o)})),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,(function(e,r,o){t.onRecvClientInfo(e,r,o)})),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" call success")},e.prototype.createOffer=function(e){var t=this;this.peerConnection=new RTCPeerConnection(e),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)};var r=[],o=[];this.localStream&&(this.localStream.getTracks().forEach((function(e){var r;null===(r=t.peerConnection)||void 0===r||r.addTrack(e,t.localStream)})),r=this.localStream.getVideoTracks(),o=this.localStream.getAudioTracks(),r.length>0&&this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" video device: "+r[0].label),o.length>0&&this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" audio device: "+o[0].label));var i={offerToReceiveAudio:o.length>0?1:0,offerToReceiveVideo:r.length>0?1:0};this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" createOffer: "+JSON.stringify(i)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(i).then((function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.dataReport.eventEnd(t.streamReportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)}),(function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateOffer",{error:e.toString()}),t.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+t.streamId+" create offer error "+e.toString()),t.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCreateOfferError,!0)}))},e.prototype.onCreateOfferSuccess=function(e){var t,r=this;0!=this.videoInfo.bitRate&&(e.sdp=this.updateBandwidthRestriction(e.sdp,this.videoInfo.bitRate)),e.sdp=e.sdp.replace(/sendrecv/g,"sendonly"),e.sdp=e.sdp.replace(/useinbandfec=\d+/,(this.videoInfo.audioBitrate?"maxaveragebitrate="+this.videoInfo.audioBitrate:"")+(2===this.videoInfo.channelCount?";stereo=1":"")),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" local sdp revert "+this.localSdpRevert),/m=video[\s\S]*m=audio/.test(e.sdp)&&(this.localSdpRevert=!0),e.sdp=d.SdpUtil.getSDPByVideDecodeType(e.sdp,this.videoCodec),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp2 "+e.sdp.substr(e.sdp.length/2)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),null===(t=this.peerConnection)||void 0===t||t.setLocalDescription(e).then((function(){r.dataReport.eventEnd(r.reportSeq,"SetLocalDescription"),r.dataReport.eventEnd(r.streamReportSeq,"SetLocalDescription"),r.onSetLocalDescriptionSuccess(e)}),(function(e){r.dataReport.eventEndWithMsg(r.reportSeq,"SetLocalDescription",{error:e.toString()}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SetLocalDescription",{error:e.toString()}),r.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+r.streamId+" error "+e.toString()),r.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSetLocalDescError,!0)}))},e.prototype.updateBandwidthRestriction=function(e,t){var r="AS";return"firefox"===a.browserDetails.browser&&(t=1e3*(t>>>0),r="TIAS"),-1===e.indexOf("b="+r+":")?(e=e.replace(/c=IN (.*)\r\n/g,"c=IN $1\r\nb="+r+":"+t+"\r\n")).replace("b="+r+":"+t+"\r\n",""):(e=e.replace(new RegExp("b="+r+":.*\r\n","g"),"b="+r+":"+t+"\r\n")).replace("b="+r+":"+t+"\r\n","")},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" success"),this.isPeer)this.createSession(e);else{var r={sdp:e.sdp,width:this.videoInfo.width,height:this.videoInfo.height,frameRate:this.videoInfo.frameRate,video_min_kpbs:this.videoInfo.bitRate,video_max_kpbs:this.videoInfo.bitRate,audio_kpbs:48,keyframe_intv:2};this.offerSeq=s.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.offerSeq,this.sessionId,0,r,(function(e,o,i){t.offerSeq==e&&t.sessionId==o?(t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" send success"),t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{mediaDescription:{width:r.width,height:r.height,frameRate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv}}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{mediaDescription:{width:r.width,height:r.height,frameRate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv}}),t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" send success stateNego:waiterAnswer"),t.stateNego=s.ENUM_PUBLISH_STATE_NEGO.waiterAnswer,t.state=s.ENUM_PUBLISH_STATE.waitingServerAnswer):t.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" seq or sessionId is not equal")}),(function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{error:e}),t.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)})),this.state=s.ENUM_PUBLISH_STATE.waitingOffserRsp,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" call success")}},e.prototype.onRecvMediaDescription=function(e,t,r){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received"),this.state==s.ENUM_PUBLISH_STATE.waitingServerAnswer?(this.stateNego=s.ENUM_PUBLISH_STATE_NEGO.waitingCandidate,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0),1==r.type?this.onGetRemoteOfferSuccess(r.sdp):this.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)):this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onGetRemoteOfferSuccess=function(e){var t,r,o,i,n,c,d,l,p=this;if(this.videoInfo.audioBitrate&&48e3!==this.videoInfo.audioBitrate&&(e=e.replace(/maxaveragebitrate=(\d+)/,"maxaveragebitrate="+this.videoInfo.audioBitrate)),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+NaN+this.localSdpRevert),/m=video[\s\S]*m=audio/.test(e)&&(this.remoteSdpRevert=!0),this.stateCenter.turnOverTcpOnly&&(null===(o=e.match(/candidate.*/g))||void 0===o||o.forEach((function(t){var r=t.replace(/udp/,"tcp");e=e.replace(t,r)}))),this.logger.info("zp.oro.0 "+this.streamId+" sdp revert "+this.localSdpRevert+" "+this.remoteSdpRevert),this.localSdpRevert!==this.remoteSdpRevert){var f=void 0,g=void 0,m=void 0;if(this.remoteSdpRevert){g=(t=[/[\s\S]*m=audio/.exec(e)[0].replace("m=video",""),/m=video[\s\S]*m=audio/.exec(e)[0].replace("m=video",""),/m=audio[\s\S]*/.exec(e)[0]])[1],m=t[2];var _=/a=group:BUNDLE\s+(\w+)\s+(\w+)/.exec(f=t[0]);f=f.replace(/a=group:BUNDLE\s+(\w+)\s+(\w+)/,"a=group:BUNDLE "+_[2]+" "+_[1]),e=f+m+g}else g=(r=[/[\s\S]*m=audio/.exec(e)[0].replace("m=audio",""),/m=video[\s\S]*/.exec(e)[0],/m=audio[\s\S]*m=video/.exec(e)[0].replace("m=video","")])[1],m=r[2],_=/a=group:BUNDLE\s+(\w+)\s+(\w+)/.exec(f=r[0]),f=f.replace(/a=group:BUNDLE\s+(\w+)\s+(\w+)/,"a=group:BUNDLE "+_[2]+" "+_[1]),e=f+g+m;this.localSdpRevert=!1,this.remoteSdpRevert=!1}var v=e.match(/m=video(.|\r|\n)*a=rtpmap(.|\r|\n)*(a=fmtp:(102|96|97).*)/);if("chrome"==a.browserDetails.browser){var E=0;if(this.videoInfo.bitRate&&"target"===this.videoInfo.startBitrate&&(E=this.videoInfo.bitRate),null!==v&&E){var y=v[3];e=-1!==y.indexOf("apt=")?e.replace(y,"a=fmtp:96 x-google-start-bitrate="+E+"\n"+y):e.replace(y,y+";x-google-start-bitrate="+E)}}if(this.videoInfo.bitRate>0){var S=/b=AS.*(\r\n|\n)/.test(e);e=S?e.replace(/AS:(\d+)/,"AS:"+this.videoInfo.bitRate):e.replace(/m=video.*(\r\n|\n)c=.*(\r\n|\n)/,"$&b=AS:"+this.videoInfo.bitRate+"\n");var T=null===(i=this.peerConnection)||void 0===i?void 0:i.getSenders().find((function(e){return e.track&&"video"===e.track.kind}));if(T&&T.getParameters&&T.setParameters){var b=T.getParameters();b.encodings||(b.encodings=[{}]),b.encodings[0].maxBitrate=1e3*this.videoInfo.bitRate;var R=this.lastPublishStats.frameWidth,C=(null===(c=null===(n=this.previewer)||void 0===n?void 0:n.cameraMaxResolution)||void 0===c?void 0:c.maxWidth)||0,I=null===(d=this.previewer)||void 0===d?void 0:d.videoInfo.width,O=R?Math.min(C,R):C;if(C&&I){var L=Math.max(O/I,1);b.encodings[0].scaleResolutionDownBy=L}T.setParameters(b)}}this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+" remoteSdp:",e);var w={type:"answer",sdp:e,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription"),null===(l=this.peerConnection)||void 0===l||l.setRemoteDescription(new RTCSessionDescription(w)).then((function(){p.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+p.streamId+" set success"),p.dataReport.eventEnd(p.reportSeq,"SetRemoteDescription"),p.dataReport.eventEnd(p.streamReportSeq,"SetRemoteDescription")}),(function(e){p.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+p.streamId+" failed: "+e.toString()),p.dataReport.eventEndWithMsg(p.reportSeq,"SetRemoteDescription",{error:e.toString()}),p.dataReport.eventEndWithMsg(p.streamReportSeq,"SetRemoteDescription",{error:e.toString()}),p.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSetRemoteDescError,!0)})),this.state=s.ENUM_PUBLISH_STATE.waitingServerICE,this.logger.debug(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+" call success")},e.prototype.onIceConnectionStateChange=function(e){var t=this;this.state!=s.ENUM_PUBLISH_STATE.stop&&null!=this.peerConnection&&(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState?(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" connected state "+this.state),this.dataReport.eventEnd(this.reportSeq,"IceConnected"),this.dataReport.eventEnd(this.streamReportSeq,"IceConnected"),this.stateNego=s.ENUM_PUBLISH_STATE_NEGO.iceConnected,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateNego:iceConnected"),this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.publishEvent?this.publishSuccess():(this.firstGetStatsTimer&&clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null,this.firstGetStatsTimer=setTimeout((function(){var e;t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" get first stats state "+t.state),t.state!==s.ENUM_PUBLISH_STATE.publishing&&(null===(e=t.peerConnection)||void 0===e||e.getStats().then((function(e){t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" get first stats suc"),e.size>0&&t.publishSuccess()})))}),1e3))):"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.stateNego=s.ENUM_PUBLISH_STATE_NEGO.iceDisconnected,this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)))},e.prototype.onIceCandidate=function(e){if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate"+e.candidate),e.candidate)if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate"+e.candidate.candidate),this.state<s.ENUM_PUBLISH_STATE.connecting||this.state==s.ENUM_PUBLISH_STATE.stop)this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex});else{var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};this.sendCandidateInfo([t])}},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" called"),!(e=e.filter((function(e){return e.candidate.indexOf("relay")>0})))||e.length<1?this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==s.ENUM_PUBLISH_STATE_NEGO.iceConnected&&(this.stateNego=s.ENUM_PUBLISH_STATE_NEGO.sendCandidate),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(s.getSeq(),this.sessionId,e,(function(e,r,o){t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")}),(function(e,r){t.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCandidateError)})))},e.prototype.onConnectionStateChange=function(e){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CONNECTION_STATE_CHANGE+" "+this.streamId+" called "+e.target.signalingState)},e.prototype.onRecvCandidateInfo=function(e,t,r){var o,i=this;if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" received "+JSON.stringify(r.infos)),this.state==s.ENUM_PUBLISH_STATE.waitingServerICE){this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var n=0;n<r.infos.length;n++){var a={sdpMid:r.infos[n].sdpMid,sdpMLineIndex:r.infos[n].sdpMLineIndex,candidate:r.infos[n].candidate};this.logger.debug(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+""+this.streamId+" candidate "+a.candidate),null===(o=this.peerConnection)||void 0===o||o.addIceCandidate(new RTCIceCandidate(a)).then((function(){i.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add success")}),(function(e){i.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add error "+e.toString()),i.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCandidateError,!0)}))}this.state=s.ENUM_PUBLISH_STATE.connecting,this.dataReport.eventStart(this.reportSeq,"IceConnected"),this.dataReport.eventStart(this.streamReportSeq,"IceConnected")}else this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CLOSE_SESSION+""+this.streamId+" "+JSON.stringify(r)),this.dataReport.addEvent(this.reportSeq,"RecvCloseSession"),this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=r.err_info?JSON.parse(r.err_info.toLowerCase()):{},i=o.action?o.action:null,n=1*r.reason,s=JSON.parse(JSON.stringify(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError));s.message+=" reason:"+n+" "+(i?" action:"+i:""),1011===o.err&&(s=u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaServerForbidError),this.negoTimer&&clearTimeout(this.negoTimer);var a=![4,8,10,11,12,14,26,27].includes(n)&&![2,5,6].includes(i);this.publishStateUpdateError(s,a)},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_RESET_SESSION+" "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError;this.negoTimer&&clearTimeout(this.negoTimer),this.publishStateUpdateError(o)}else this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_RESET_SESSION+" "+this.streamId+" cannot find session")},e.prototype.onRecvPublishEvent=function(e,t,r){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_PUBLISH_EVENT+" "+this.streamId+" received"),this.publishEvent=!0,this.firstGetStatsTimer&&(clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null),this.stateNego===s.ENUM_PUBLISH_STATE_NEGO.iceConnected&&0==r.event&&this.publishSuccess()},e.prototype.onRecvClientInfo=function(e,t,r){this.stateCenter.clientIP!==r.clientip&&this.logger.warn(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CLIENT_INFO+" client ip changed "+this.stateCenter.clientIP+" "+r.clientip),this.stateCenter.clientIP=r.clientip,this.peerID=r.peer_id;var o=this.previewer;if(o&&null!==o.activeteSEIConfig){var i=null==o?void 0:o.activeteSEIConfig,n=i.action,s=i.infoType;this.activateSEIInsert(n,s)}},e.prototype.checkPublishConnectionFailedState=function(e){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" streamID "+this.streamId," state "+this.state+" connectionState "+e),this.publishStateUpdateError(u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaConnectionError)},e.prototype.setPublishQualityTimer=function(){var e=this;null==this.qualityTimer&&(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_PLAYER_QUALITY_TIMER+" "+this.streamId+" called"),this.clearPublishQualityTimer(),this.qualityTimer=setInterval((function(){e.peerConnectionGetStats()}),this.qualityTimeInterval),this.lastPublishStats={audioPacketsLost:0,videoPacketsLost:0,videoPacketsSent:0,audioPacketsSent:0,audioRetransmittedPacketsSent:0,videoTime:(new Date).getTime(),audioTime:(new Date).getTime(),time:0,audioBytesSent:0,videoBytesSent:0,framesEncoded:0,framesSent:0,videoRetransmittedPacketsSent:0},this.qualitySeq=s.getSeq(),this.qualityCount=0)},e.prototype.peerConnectionGetStats=function(e){var t=this;if(this.peerConnection){var r=[this.peerConnection.getStats(null)];"Chrome"==l.ClientUtil.getBrowser()&&r.push(new Promise((function(e,r){var o;null===(o=t.peerConnection)||void 0===o||o.getStats((function(t){return e(t)}),(function(e){return r(e)}))}))),Promise.all(r).then((function(r){var o=t.getPublishStats(r[0],r[1]);e&&e(o,r[0],r[1])})).catch((function(e){t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_PLAYER_QUALITY_TIMER+" "+t.streamId+" getStats error "+e.toString())}))}},e.prototype.getPublishStats=function(e,t){var r=this;if(e){for(var o,i=document.querySelectorAll("video, audio"),n=0;n<i.length;n++)i[n].srcObject===this.localStream&&(o=i[n]);var c={audioCodec:"opus",audioTargetBitrate:this.videoInfo.audioBitrate/1e3||0,audioBitrate:0,videoTargetBitrate:this.videoInfo.bitRate||0,videoTargetFPS:this.videoInfo.frameRate||0,videoBitrate:0,audioFPS:0,audioLevel:0,audioInputLevel:0,audioPacketsLost:0,audioPacketsLostRate:0,sendLevel:0,samplingRate:0,videoFPS:0,nackCount:0,pliCount:0,audioQuality:0,videoQuality:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoPacketsLost:0,videoPacketsLostRate:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,googActualEncBitrate:0,googTargetEncBitrate:0,googFrameWidthInput:0,googFrameHeightInput:0,googFrameRateInput:0,codecImplementationName:"",videoMuteState:this.localStream.getVideoTracks().length>0&&this.localStream.getVideoTracks()[0].enabled?"0":"1",audioMuteState:this.localStream.getAudioTracks().length>0&&this.localStream.getAudioTracks()[0].enabled?"0":"1",muted:o?o.muted:void 0,paused:o?o.paused:void 0,volume:o?o.volume:void 0,sinkId:o?o.sinkId:void 0},d=this.lastPublishStats.time,p=0,f=0,g=0,m=0,_=0,v=0;e.forEach((function(e){if(("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"audio"==e.mediaType)0!=d&&(c.audioBitrate=8*(e.bytesSent-r.lastPublishStats.audioBytesSent)/(e.timestamp-d),c.audioFPS=(e.packetsSent-(e.retransmittedPacketsSent-r.lastPublishStats.audioRetransmittedPacketsSent)-r.lastPublishStats.audioPacketsSent)/(e.timestamp-d)*1e3,g=(e.retransmittedPacketsSent-r.lastPublishStats.audioRetransmittedPacketsSent)/(e.packetsSent-r.lastPublishStats.audioPacketsSent)),c.audioBitrate<0&&(c.audioBitrate=0),r.lastPublishStats.audioBytesSent=e.bytesSent,r.lastPublishStats.time=e.timestamp,r.lastPublishStats.audioPacketsSentTimeStamp=e.packetsSent-r.lastPublishStats.audioPacketsSent,r.lastPublishStats.audioPacketsSent=e.packetsSent,r.lastPublishStats.audioRetransmittedPacketsSent=e.retransmittedPacketsSent;else if(("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"video"==e.mediaType)0!=d&&(c.videoBitrate=8*(e.bytesSent-r.lastPublishStats.videoBytesSent)/(e.timestamp-d),c.videoFPS=1e3*(e.framesEncoded-r.lastPublishStats.framesEncoded)/(e.timestamp-d),m=(e.retransmittedPacketsSent-r.lastPublishStats.videoRetransmittedPacketsSent)/(e.packetsSent-r.lastPublishStats.videoPacketsSent)),c.videoBitrate<0&&(c.videoBitrate=0),c.videoFPS<0&&(c.videoFPS=0),c.nackCount=e.nackCount,c.pliCount=e.pliCount,r.lastPublishStats.videoBytesSent=e.bytesSent,r.lastPublishStats.framesEncoded=e.framesEncoded,r.lastPublishStats.time=e.timestamp,r.lastPublishStats.videoPacketsSentTimeStamp=e.packetsSent-r.lastPublishStats.videoPacketsSent,r.lastPublishStats.videoPacketsSent=e.packetsSent,r.lastPublishStats.videoRetransmittedPacketsSent=e.retransmittedPacketsSent;else if("remote-inbound-rtp"==e.type&&"video"==e.kind){e.packetsLost>0&&(c.videoPacketsLost=e.packetsLost);var t=e.packetsLost-r.lastPublishStats.videoPacketsLost;c.videoPacketsLostRate=t>0?t/r.lastPublishStats.videoPacketsSentTimeStamp:0,e.packetsLost>0&&(r.lastPublishStats.videoPacketsLost=e.packetsLost),r.lastPublishStats.videoTime=e.timestamp,f=1e3*e.roundTripTime,v=e.jitter}else if("remote-inbound-rtp"==e.type&&"audio"==e.kind){e.packetsLost>0&&(c.audioPacketsLost=e.packetsLost);var o=e.packetsLost-r.lastPublishStats.audioPacketsLost;c.audioPacketsLostRate=o>0?o/r.lastPublishStats.audioPacketsSentTimeStamp:0,e.packetsLost>0&&(r.lastPublishStats.audioPacketsLost=e.packetsLost),r.lastPublishStats.audioTime=e.timestamp,p=1e3*e.roundTripTime,_=e.jitter}else if("media-source"==e.type&&("audio"==e.kind||e.id.toLowerCase().indexOf("audio")>=0))c.audioLevel=e.audioLevel,c.sendLevel=e.totalAudioEnergy,c.audioInputLevel=32767*e.totalAudioEnergy,c.samplingRate=e.totalSamplesDuration;else if("track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0||e.frameWidth)){if(c.frameHeight=e.frameHeight,c.frameWidth=e.frameWidth,0===d||r.lastPublishStats.frameHeight===e.frameHeight&&r.lastPublishStats.frameWidth===e.frameWidth)0===d&&(r.lastPublishStats.frameHeight=e.frameHeight,r.lastPublishStats.frameWidth=e.frameWidth);else{var i=s.getReportSeq();r.dataReport.newReport(i,u.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.event),r.dataReport.addMsgInfo(i,{session_id:u.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.session_id(r.sessionId),w:u.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.w(e.frameWidth),h:u.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.h(e.frameHeight)}),r.dataReport.uploadReport(i),r.lastPublishStats.frameHeight=e.frameHeight,r.lastPublishStats.frameWidth=e.frameWidth}0!=d&&(c.videoTransferFPS=1e3*(e.framesSent-r.lastPublishStats.framesSent)/(e.timestamp-d)),c.videoTransferFPS<0&&(c.videoTransferFPS=0),r.lastPublishStats.framesSent=e.framesSent}else"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(c.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(c.currentRoundTripTime=e.currentRoundTripTime))})),t&&t.result().forEach((function(e){"ssrc"==e.type&&e.names().indexOf("googBandwidthLimitedResolution")>=0&&(c.googBandwidthLimitedResolution=e.stat("googBandwidthLimitedResolution")),"ssrc"==e.type&&"video"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(c.videoCodecName=e.stat("googCodecName")),"ssrc"==e.type&&"audio"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(c.audioCodecName=e.stat("googCodecName")),"ssrc"==e.type&&e.names().indexOf("googCpuLimitedResolution")>=0&&(c.googCpuLimitedResolution=e.stat("googCpuLimitedResolution")),"ssrc"==e.type&&e.names().indexOf("googFrameWidthInput")>=0&&(c.googFrameWidthInput=e.stat("googFrameWidthInput")),"ssrc"==e.type&&e.names().indexOf("googFrameHeightInput")>=0&&(c.googFrameHeightInput=e.stat("googFrameHeightInput")),"ssrc"==e.type&&e.names().indexOf("googFrameRateInput")>=0&&(c.googFrameRateInput=e.stat("googFrameRateInput")),"ssrc"==e.type&&e.names().indexOf("codecImplementationName")>=0&&(c.codecImplementationName=e.stat("codecImplementationName")),"VideoBwe"==e.type&&e.names().indexOf("googAvailableSendBandwidth")>=0&&(c.googAvailableSendBandwidth=e.stat("googAvailableSendBandwidth")),"VideoBwe"==e.type&&e.names().indexOf("googActualEncBitrate")>=0&&(c.googActualEncBitrate=e.stat("googActualEncBitrate")),"VideoBwe"==e.type&&e.names().indexOf("googTargetEncBitrate")>=0&&(c.googTargetEncBitrate=e.stat("googTargetEncBitrate")),"VideoBwe"==e.type&&e.names().indexOf("googRetransmitBitrate")>=0&&(c.googRetransmitBitrate=e.stat("googRetransmitBitrate"))})),"chrome"===a.browserDetails.browser&&this.handleEncBitrate(Number.parseInt(c.googTargetEncBitrate),Number.parseInt(c.googActualEncBitrate),Number.parseInt(c.googRetransmitBitrate)),f=isNaN(f)||f<0?0:f,m=isNaN(m)||m<0?0:m,v=isNaN(v)||v<0?0:v,p=isNaN(p)||p<0?0:p,g=isNaN(g)||g<0?0:g,_=isNaN(_)||_<0?0:_;var E=l.ClientUtil.getNetQuality(f,m,v),y=l.ClientUtil.getNetQuality(p,g,_);c.videoQuality=d>0?l.ClientUtil.quality2QualityGrade(E):0,c.audioQuality=d>0?l.ClientUtil.quality2QualityGrade(y):0;var S=Math.min(E,y);this.netQuality=S,d>0&&S<=s.QUALITY_CONSTANT.MiddleMinQuality&&(new Date).getTime()>this.probeTime+this.probeInterval&&(this.logger.info(h.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" netQuality "+S+" start net probe"),this.probeState=s.ENUM_PROBE_STATE.tryProbe,this.streamCenter.startNetProbe(!0,this,this.gwNodeList),this.probeTime=(new Date).getTime()),0!==d&&this.uploadPublishQuality(c);var T={video:{videoBitrate:c.videoBitrate,videoFPS:c.videoFPS,videoTransferFPS:c.videoTransferFPS,frameHeight:c.frameHeight,frameWidth:c.frameWidth,muteState:c.videoMuteState,videoQuality:c.videoQuality,videoPacketsLost:c.videoPacketsLost,videoPacketsLostRate:c.videoPacketsLostRate},audio:{audioBitrate:c.audioBitrate,audioCodec:c.audioCodec,muteState:c.audioMuteState,audioQuality:c.audioQuality,audioPacketsLost:c.audioPacketsLost,audioPacketsLostRate:c.audioPacketsLostRate,audioFPS:c.audioFPS},nackCount:c.nackCount,pliCount:c.pliCount,totalRoundTripTime:c.totalRoundTripTime,currentRoundTripTime:c.currentRoundTripTime};return void 0!==c.videoPacketsLost&&(T.video.videoPacketsLost=c.videoPacketsLost,T.video.videoPacketsLostRate=c.videoPacketsLostRate,T.audio.audioPacketsLost=c.audioPacketsLost,T.audio.audioPacketsLostRate=c.audioPacketsLostRate),void 0!==c.muted&&(T.muted=c.muted,T.paused=c.paused,T.volume=c.volume,T.sinkId=c.sinkId),void 0!==c.googBandwidthLimitedResolution&&(T.googBandwidthLimitedResolution=c.googBandwidthLimitedResolution,T.video.googCodecName=c.videoCodecName,T.audio.googCodecName=c.audioCodecName,T.googCpuLimitedResolution=c.googCpuLimitedResolution,T.googFrameWidthInput=c.googFrameWidthInput,T.googFrameHeightInput=c.googFrameHeightInput,T.googFrameRateInput=c.googFrameRateInput,T.codecImplementationName=c.codecImplementationName,T.googAvailableSendBandwidth=c.googAvailableSendBandwidth,T.googActualEncBitrate=c.googActualEncBitrate,T.googTargetEncBitrate=c.googTargetEncBitrate),0!==d&&this.onPublishQualityUpdate(this.streamId,T,e,t),T}},e.prototype.uploadPublishQuality=function(e){var t=this;if(this.qualityUpload){var r=Date.parse(new Date+"");(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="publish",e.stream_id=this.streamId,e.timeStamp=r/1e3,this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_UPLOAD_PUBLISH_QUALITY+" "+this.streamId+" upload"+JSON.stringify(e)),this.signal.QualityReport(s.getSeq(),this.sessionId,e,(function(e,r,o){void 0!==o.report&&(t.qualityUpload=o.report,t.qualityUploadInterval=o.report_interval_ms)}),(function(e,r){t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_UPLOAD_PUBLISH_QUALITY+" "+t.streamId+" upload failed "+e)})),this.qualityUploadLastTime=r)}},e.prototype.stopPublish=function(){if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_PUBLISH+"  .1 "+this.streamId+" called"),Object.keys(this.streamCenter.publisherList).length=1)for(var e in this.streamCenter.playerList){var t=this.streamCenter.playerList[e].player;t.state==s.ENUM_PLAY_STATE.playing&&t.broadcasterStatus==s.ENUM_BROADCASTER_STATUS.start&&(this.signal&&this.signal.sendBroadcasterStatus(s.getSeq(),t.sessionId,0),t.broadcasterStatus=s.ENUM_BROADCASTER_STATUS.stop)}this.stopMixingAudio(),this.stopMixingBuffer(),this.stopEffect(),this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(s.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PublishState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPublish"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.addMsgInfo(this.streamReportSeq,{itemtype:"RTCPublishStream"}),this.dataReport.uploadReport(this.streamReportSeq,"RTCPublishStream"),this.resetPublish()},e.prototype.onPublishStateUpdate=function(e,t,r,o){},e.prototype.onPublishQualityUpdate=function(e,t,r,o){},e.prototype.onDisconnect=function(e){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_DISCONNECT+" "+this.streamId+" call"),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_DISCONNECT+" "+this.streamId+" websocket disconnect"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.publishStateUpdateError(e||u.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kWebsocketDisconnectedError,!!e)},e.prototype.playEffect=function(e,t,r,o){if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" call"),this.effectList.find((function(r){return r.effectID==e.effectID&&r.audioBuffer==t})))this.logger.warn(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" effect alreadly exist ");else{this.streamCenter.soundLevelDelegate&&this.stopSoundLevel();var i=new c.AudioMix(this.logger,this.ac,this.mediaEleSources);i.localStream=this.localStream,i.peerConnection=this.peerConnection,i.audioBuffer=t,this.effectList.push({audioMix:i,effectID:e.effectID,audioBuffer:t}),i.playEffect(e.playTime,e.loop,!1,r,o),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" play effect "+e.effectID+" success")}},e.prototype.pauseEffect=function(e){var t=this.effectList.find((function(t){return t.effectID==e}));if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.pauseEffect(),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PAUSE_EFFECT+" "+this.streamId+" pause "+e+" success");else{if(void 0!==e)return this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PAUSE_EFFECT+" "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach((function(e){return e.audioMix.pauseEffect()})),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!0},e.prototype.resumeEffect=function(e){var t=this.effectList.find((function(t){return t.effectID==e}));if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.resumeEffect(),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_RESUME_EFFECT+" "+this.streamId+" resume"+e+" success");else{if(void 0!==e)return this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_RESUME_EFFECT+" "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach((function(e){return e.audioMix.resumeEffect()})),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!1},e.prototype.stopEffect=function(e){var t=this.effectList.find((function(t){return t.effectID==e}));if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.stopMixingAudio(),this.effectList.splice(this.effectList.indexOf(t),1),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_EFFECT+" "+this.streamId+" pause "+e+" success");else{if(void 0!==e)return this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_EFFECT+" "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach((function(e){return e.audioMix.stopMixingAudio()})),this.effectList=[],this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!0},e.prototype.setEffectVolume=function(e,t){var r=this.effectList.find((function(e){return e.effectID==t}));if(r)r.audioMix.setMixingAudioVolume(e),this.logger.info("zp.sev.0 "+this.streamId+" set volume "+t+" success");else{if(void 0!==t)return this.logger.error("zp.sev.0 "+this.streamId+" no effect ID found"),!1;this.effectList.forEach((function(t){return t.audioMix.setMixingAudioVolume(e)}))}return!0},e.prototype.startMixingAudio=function(e){var t=this;return this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" "+this.streamId+" call"),this.localStream?(this.micTrack||(this.micTrack=this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks()[0]:null),e.forEach((function(e){if(t.audioMixList.find((function(t){return t.media==e})))t.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" "+t.streamId+" mix audio already exist");else{t.streamCenter.soundLevelDelegate&&t.stopSoundLevel();var r=new c.AudioMix(t.logger,t.ac,t.mediaEleSources);r.localStream=t.localStream,r.peerConnection=t.peerConnection,t.audioMixList.push({audioMix:r,media:e}),r.startMixingAudio(e),t.streamCenter.soundLevelDelegate&&t.startSoundLevel()}})),!0):(this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" localStream not found"),!1)},e.prototype.stopMixingAudio=function(e){var t=this;return this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_MIXING_AUDIO+" "+this.streamId+" call"),e?e.forEach((function(e){for(var r=0;r<t.audioMixList.length;r++)if(t.audioMixList[r].media==e){t.audioMixList[r].audioMix.stopMixingAudio()&&t.audioMixList.splice(r--,1);break}})):(this.audioMixList.forEach((function(e){return e.audioMix.stopMixingAudio()})),this.audioMixList=[]),!0},e.prototype.mixingBuffer=function(e,t,r){var o=this;if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_MIXING_BUFFER+" "+this.streamId+" call"),this.micTrack||(this.micTrack=this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks()[0]:null),this.arrayBufferMap[e])this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap[e].mixingBuffer(t,(function(){o.streamCenter.soundLevelDelegate&&o.startSoundLevel(),r&&r()}));else{this.streamCenter.soundLevelDelegate&&this.stopSoundLevel();var i=new c.AudioMix(this.logger,this.ac,this.mediaEleSources);i.localStream=this.localStream,i.peerConnection=this.peerConnection,this.arrayBufferMap[e]=i,i.mixingBuffer(t,(function(){o.streamCenter.soundLevelDelegate&&o.startSoundLevel(),r&&r()}))}},e.prototype.stopMixingBuffer=function(e){if(e&&this.arrayBufferMap[e])return this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap[e].stopMingBuffer(),delete this.arrayBufferMap[e],this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),!0;if(void 0===e){for(var t in this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap)this.arrayBufferMap[t].stopMingBuffer();return this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),!0}return this.logger.warn(h.ZEGO_WEBRTC_ACTION.PUBLISHER_MIXING_BUFFER+" "+this.streamId+" arrayBuffer no found"),!1},e.prototype.setMixingAudioVolume=function(e,t){this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" call");var r=this.audioMixList.find((function(e){return e.media===t}));return r?(r.audioMix.setMixingAudioVolume(e),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" call success"),!0):(this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" audio is not mixing"),!1)},e.prototype.publishSuccess=function(){var e=this;for(var t in this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" call"),this.state!=s.ENUM_PUBLISH_STATE.publishing&&this.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.start,this.streamId,{code:0,message:""},!0),this.isPeer&&(this.peerFailCount=0),this.state=s.ENUM_PUBLISH_STATE.publishing,this.dataReport.eventStart(this.reportSeq,"PublishState"),this.dataReport.eventStart(this.streamReportSeq,"PublishState"),this.streamCenter.playerList){var r=this.streamCenter.playerList[t].player;r.state==s.ENUM_PLAY_STATE.playing&&r.broadcasterStatus==s.ENUM_BROADCASTER_STATUS.stop&&(this.signal&&this.signal.sendBroadcasterStatus(s.getSeq(),r.sessionId,1),r.broadcasterStatus=s.ENUM_BROADCASTER_STATUS.start)}this.setPublishQualityTimer();var o=2,i=2;0!==this.localStream.getVideoTracks().length&&1==this.localStream.getVideoTracks()[0].enabled&&(o=0),0!==this.localStream.getAudioTracks().length&&1==this.localStream.getAudioTracks()[0].enabled&&(i=0),this.sendStreamStatus(o,i),this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" call success"),["video","audio"].forEach((function(t){var r=e.toBeReplacedTracks[t];r&&e.replaceTrack(r)}))},e.prototype.startSoundLevel=function(){var e;if(this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" call streamID: "+this.streamId),this.localStream&&0!=this.localStream.getAudioTracks().length)try{null===(e=this.previewer)||void 0===e||e.startSoundLevel()}catch(e){this.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" "+this.streamId+" get sound level failed "+e)}else this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" "+this.streamId+" local stream no found")},e.prototype.stopSoundLevel=function(){var e;this.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_SOUND_LEVEL+" call streamID: "+this.streamId),null===(e=this.previewer)||void 0===e||e.stopSoundLevel()},e.prototype.rebackMic=function(){var e,t=this;if(this.peerConnection&&this.micTrack instanceof MediaStreamTrack&&0==this.audioMixList.length&&0==Object.keys(this.arrayBufferMap).length&&0==this.effectList.length){var r=null===(e=this.peerConnection)||void 0===e?void 0:e.getSenders().find((function(e){var r,o;return(null===(r=e.track)||void 0===r?void 0:r.kind)===(null===(o=t.micTrack)||void 0===o?void 0:o.kind)}));r&&(r.replaceTrack(this.micTrack),this.localStream.removeTrack(this.localStream.getAudioTracks()[0]),this.localStream.addTrack(this.micTrack))}},e.prototype.handleEncBitrate=function(e,t,r){var o,i=this,n=1e3*this.videoInfo.bitRate,s=0;if(t>0){this.needIncMax||this.gotMax||(this.probeCount++,t>=.75*e?(this.probeCount>=10&&this.initFitCnt>=.6*this.probeCount&&(this.gotMax=!0,this.targetRate=n),this.initFitCnt++):this.probeCount>=10&&this.initFitCnt/this.probeCount<.3&&(this.needIncMax=!0));var a=l.ClientUtil.arrAvg(this.totalBitrateArray,t,10);if(this.needIncMax)if(a>=1.05*n){if(this.targetRate>n){var c=void 0;a>e?(c=a-e,this.targetRate-=c):(c=a-n,this.targetRate-=c),this.targetRate=Math.max(this.targetRate,n),this.targetRate=Math.min(this.targetRate,2*n),s=this.targetRate}}else a<.8*n&&(0===this.targetRate&&(this.targetRate=e),this.targetRate>=n?this.targetRate=this.targetRate+.08*n:this.targetRate=1.05*this.targetRate,this.targetRate=Math.min(this.targetRate,2*n),s=this.targetRate)}if(r>0&&r<n){var d=l.ClientUtil.arrAvg(this.totalRetransRateArray,r,5);this.needIncMax?d+t>1.05*n&&(c=d+t-n,this.targetRate-=c,this.targetRate=Math.max(this.targetRate,n-d),s=this.targetRate):s=this.targetRate-d}else this.targetRate<n&&(this.targetRate=n,s=this.targetRate);if(s>0){s=l.ClientUtil.arrAvg(this.totalTargetRateArray,s,5);var u=null===(o=this.peerConnection)||void 0===o?void 0:o.getSenders().find((function(e){return e.track&&"video"===e.track.kind}));if(!u)return;var p=u.getParameters();p.encodings||(p.encodings=[{}]),p.encodings[0].maxBitrate=s,u.setParameters(p).catch((function(e){i.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISHER_HANDLE_ENC_BITRATE+" "+e)}))}},e.prototype.resetEncBitrate=function(){this.needIncMax=!1,this.probeCount=0,this.gotMax=!1,this.initFitCnt=0,this.targetRate=0,this.totalBitrateArray=[],this.totalTargetRateArray=[],this.totalRetransRateArray=[]},e.prototype.replaceTrack=function(e){var t,r=this.localStream;if(!(null===(t=this.peerConnection)||void 0===t?void 0:t.getSenders)||!this.peerConnection.getSenders()[0].replaceTrack){var o=e.kind;return this.toBeReplacedTracks["video"===o?"video":"audio"]=e,this.logger.info("zc.rt.1 replace track will work after stream published"),{errorCode:0,extendedData:""}}var i=r.getTracks().find((function(t){return t.kind===e.kind})),n=this.peerConnection.getSenders().find((function(t){return t.track.kind===e.kind}));if(i&&n){var s=0,a=0;return e.enabled,i.enabled,"video"===e.kind?(s=!0===e.enabled?0:20,a=r.getAudioTracks()[0]&&1==r.getAudioTracks()[0].enabled?0:20):"audio"===e.kind&&(a=!0===e.enabled?0:20,s=r.getVideoTracks()[0]&&1==r.getVideoTracks()[0].enabled?0:20),n.replaceTrack(e),r.removeTrack(i),r.addTrack(e),this.sendStreamStatus(s,a),this.logger.info("zc.rt.1 replace remote track success"),{errorCode:0,extendedData:""}}return this.logger.error("zc.rt.1 publisher track no found"),{errorCode:p.errorCodeList.TRACK_NOT_FOUND.code,extendedData:p.errorCodeList.TRACK_NOT_FOUND.message}},e.prototype.sendStreamStatus=function(e,t,r){var o=this;void 0===r&&(r=0),this.camera_status=e,this.mic_status=t,r++,this.signal.sendStreamStatus(s.getSeq(),this.sessionId,e,t,this.streamId,(function(){o.camera_status===e&&o.mic_status===t&&r<=1&&o.sendStreamStatus(e,t,r)}))},e}();t.ZegoPublish=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioMix=void 0;var o=r(3),i=r(4),n=function(){function e(e,t,r){this.audioBufferList=[],this.loop=!1,this.replace=!1,this.effectEndedCallBack=null,this.effectEndedListener=null,this.startTimes=0,this.startOffset=0,this.pauseTimes=0,this.resumeOffset=0,this.paused=!1,this.isMixAudio=!1,this.isMixingBuffer=!1,this.audioCurrentTimer=null,this.logger=e,this.ac=t,this.mediaEleSources=r}return e.prototype.preloadEffect=function(e,t){var r=this;this.logger.info("amu.pe.0 start preload effect");var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){if(200==o.status||304==o.status){var e=o.response;r.ac.resume(),r.ac.decodeAudioData(e,(function(e){r.logger.info("amu.pe.0 effect preload success"),t("",e)}),(function(e){t(e)}))}else{var i=o.statusText;t(i)}},o.send()},e.prototype.playEffect=function(e,t,r,o,i){var n=this;!0!==this.isMixAudio?this.audioBuffer?(this.startOffset=e||0,this.loop=t||!1,this.replace=r||!1,this.effectEndedCallBack=i,this.mixEffect(this.audioBuffer,(function(){n.buffSource.loop=!!t,e?n.buffSource.start(0,e/1e3):n.buffSource.start(0),n.startTimes=Date.now(),n.effectEndedListener=n.effectEndedHandler.bind(n),n.buffSource.addEventListener("ended",n.effectEndedListener),o&&o()}))):this.logger.error("amu.pe.1 no audio buffer found"):this.logger.error("amu.pe.1 audio is mixing")},e.prototype.mixingBuffer=function(e,t){var r=this;!0!==this.isMixAudio||0!=this.audioBufferList.length||0!=this.isMixingBuffer?(this.ac.resume(),this.ac.decodeAudioData(e,(function(e){r.audioBufferList.push(e),1==r.audioBufferList.length&&r.playRealTimeEffect(r.audioBufferList[0]),r.isMixingBuffer=!0,t&&t()}),(function(e){r.logger.error("amu.mb.0 "+e),t&&t({code:i.errorCodeList.PUBLISHER_DECODE_AUDIO_FAIL.code,message:i.errorCodeList.PUBLISHER_DECODE_AUDIO_FAIL.message+" "+e})}))):this.logger.error("amu.mb.0 audio is mixing")},e.prototype.stopMingBuffer=function(){return this.isMixingBuffer=!1,this.stopMixingAudio()},e.prototype.playRealTimeEffect=function(e){var t=this;this.mixEffect(e,(function(){t.buffSource&&t.buffSource.start(0),t.buffSource&&t.buffSource.addEventListener("ended",(function(){t.audioBufferList.shift(),t.audioBufferList.length>0&&t.isMixAudio&&t.playRealTimeEffect(t.audioBufferList[0])}))}))},e.prototype.pauseEffect=function(){this.audioBufferList.length>0?this.logger.error("amu.pe.0 real time buffer can not be paused"):(this.stopMixingAudio(),this.resumeOffset=(this.pauseTimes-this.startTimes+this.startOffset)%(1e3*this.audioBuffer.duration),this.paused=!0)},e.prototype.resumeEffect=function(){this.audioBufferList.length>0?this.logger.error("amu.pe.0 real time buffer can not be resume"):(this.playEffect(this.resumeOffset,this.loop,this.replace,void 0,this.effectEndedCallBack),this.startOffset=this.resumeOffset,this.paused=!1)},e.prototype.mixEffect=function(e,t){this.localStream?(this.ac.resume(),this.gainNode=this.ac.createGain(),this.buffSource=this.ac.createBufferSource(),this.buffSource.buffer=e,this.buffSource.connect(this.gainNode),this.gainNode.connect(this.ac.destination),this.replaceTrack()&&t()):this.logger.error("amu.me.0 localStream can not be found")},e.prototype.startMixingAudio=function(e,t){if(this.replace=t||!1,this.isMixAudio)return this.logger.error("amu.sma.0 audio is mixing"),!1;if(!this.localStream)return this.logger.error("amu.sma.0 localStream can not be found"),!1;if(e.captureStream=e.captureStream||e.mozCaptureStream||e.webkitCaptureStream,this.ac.resume(),this.gainNode=this.ac.createGain(),"Safari"===o.ClientUtil.getBrowser()){var r=this.mediaEleSources.find((function(t){return t.audio===e}));if(r)this.mixAudio=r.node;else{var i=this.ac.createMediaElementSource(e);this.mixAudio=i,this.mediaEleSources.push({audio:e,node:i})}e.currentTime=e.currentTime,this.audioCurrentTimer=setInterval((function(){e.currentTime=e.currentTime+.45}),6e3)}else this.mixAudio=this.ac.createMediaStreamSource(e.captureStream());return this.mixAudio.connect(this.gainNode),this.replaceTrack()},e.prototype.replaceTrack=function(){this.streamSource=this.ac.createMediaStreamSource(this.localStream),this.destination=this.ac.createMediaStreamDestination(),!this.replace&&this.streamSource.connect(this.destination),this.gainNode.connect(this.destination);var e=this.destination.stream.getAudioTracks()[0],t=this.peerConnection.getSenders().find((function(t){return t.track.kind===e.kind}));return t?(this.micTrack=this.localStream.getAudioTracks()[0],t.replaceTrack(e),this.localStream.removeTrack(this.micTrack),this.localStream.addTrack(e),this.isMixAudio=!0,!0):(this.logger.error("amu.rt.0 no sender"),!1)},e.prototype.stopMixingAudio=function(){var e=this;return this.paused?(this.logger.info("amu.sma.1 audioEffect paused"),!0):this.isMixAudio?this.localStream?(this.peerConnection.getSenders().find((function(t){return t.track.kind===e.micTrack.kind})),this.mixAudio?(this.mixAudio.disconnect(this.gainNode),this.mixAudio=null,this.audioCurrentTimer&&(clearInterval(this.audioCurrentTimer),this.audioCurrentTimer=null)):this.buffSource&&(this.buffSource.removeEventListener("ended",this.effectEndedListener),this.buffSource.stop(),this.pauseTimes=Date.now(),this.buffSource.disconnect(this.gainNode),this.buffSource=null),this.gainNode.disconnect(this.destination),this.isMixAudio=!1,this.audioBufferList=[],!0):(this.logger.error("amu.sma.1 localStream can not be found"),!1):(this.logger.warn("amu.sma.1 no mixing audio found"),!0)},e.prototype.setMixingAudioVolume=function(e){return this.gainNode?(this.gainNode.gain.value=e,!0):(this.logger.error("amu.sma.2 no mixing audio found"),!1)},e.prototype.effectEndedHandler=function(){this.stopMixingAudio(),this.effectEndedCallBack&&this.effectEndedCallBack()},e}();t.AudioMix=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenter=void 0,t.ZegoStreamCenter=function(){this.publisherList={},this.playerList={}}},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSignal=void 0;var i=r(0),n=r(2),s=r(4),a=function(){function e(e,t){this.sendDataMap={},this.sendDataList=new i.LinkedList,this.sendDataCheckOnceCount=100,this.signalSeq=0,this.pushCallback={},this.sessionInfos={},this.tryHeartbeatCount=0,this.heartbeatInterval=1e4,this.sendDataTimeout=5e3,this.sendDataDropTimeout=1e4,this.sendDataCheckTimer=null,this.sendDataCheckInterval=2e3,this.checkMessageList=["ActivateVideoPlayStreamReq","ActivateAudioPlayStreamReq","CreateSessionReq","CreateSessionWithSdpReq","ActivateSEIInsertReq","StreamStatusNotify"],this.tryConnectCount=1,this.tryConnectTimer=null,this.tryConnectInterval=3e3,this.state=i.ENUM_CONNECT_STATE.disconnect,this.tokenType=0,this.browser=this.getBrowserAndVersion(),this.platform=navigator.platform,this.negoInterval=25e3,this.negoTryCount=1,this.negoTryMaxCount=2,this.logger=e,this.stateCenter=t,this.stateCenter.streamConnectTime&&(this.tryConnectInterval=this.stateCenter.streamConnectTime)}return e.prototype.getBrowserAndVersion=function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(r[1])?{name:"IE",version:(e=/\brv[ :]+([\d\.]+)/g.exec(t)||[])[1]||""}:"Chrome"===r[1]&&null!=(e=t.match(/\bOPR|Edge\/([\d\.]+)/))?{name:"Opera",version:e[1]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/([\d+\.]+)/i))&&r.splice(1,1,e[1]),{name:r[0],version:r[1]})},e.prototype.setSessionInfo=function(e,t){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_SET_SESSION_INFO+" call"),this.appid=e+"",this.userid=t},e.prototype.onDisconnect=function(e,t){},e.prototype.onUpdateHeartBeatInterval=function(e){},e.prototype.resetConnectTimer=function(){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_RESET_CONNECT_TIMER+" call"),clearTimeout(this.tryConnectTimer),this.tryConnectTimer=null,this.tryConnectCount=0},e.prototype.bindWebSocketHandle=function(){var e=this;this.tryHeartbeatCount=0,this.tryConnectInterval=this.stateCenter.streamConnectTime?this.stateCenter.streamConnectTime:3e3,this.websocket.onmessage=function(t){var r=JSON.parse(t.data);e.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" signmsg= ",r.header.cmd),e.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" signmsg= "+JSON.stringify(r)),r.header.appid==e.appid&&r.header.user_id===e.userid?e.handleServerPush(r):e.logger.warn(n.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" check header failed")},this.websocket.onclose=function(t){e.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" close msg = "+JSON.stringify(t.code?t.code:t)),e.state!=i.ENUM_CONNECT_STATE.disconnect&&(e.resetConnectTimer(),e.startConnectTimer((function(t){1008===t&&e.disconnectCallback(s.errorCodeList.TOKEN_EXPIRED)})),e.resetCheckMessage())},this.websocket.onerror=function(t){e.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" msg = "+JSON.stringify(t))}},e.prototype.resetCheckMessage=function(){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_RESET_CHECK_MESSAGE+" call"),clearTimeout(this.sendDataCheckTimer),this.sendDataCheckTimer=null;for(var e=this.sendDataList.getFirst();null!=e;)this.sendDataList.remove(e),e._data.error&&e._data.error(i.SEND_MSG_RESET,e._data.seq),e=this.sendDataList.getFirst();this.sendDataMap={}},e.prototype.handleServerPush=function(e){switch(e.header.cmd){case"LoginRsp":this.handleRespondData("LoginReq",e);break;case"CreateSessionRsp":this.handleRespondData("CreateSessionReq",e),0===e.body.result&&this.addSession(e.header.session_id,e.body.session_token);break;case"CreateSessionWithSdpRsp":this.handleRespondData("CreateSessionWithSdpReq",e),0===e.body.result&&this.addSession(e.header.session_id,e.body.session_token);break;case"MediaDescRsp":this.handleRespondData("MediaDescReq",e);break;case"CandidateInfoRsp":this.handleRespondData("CandidateInfoReq",e);break;case"CloseSessionRsp":this.handleRespondData("CloseSessionReq",e),this.removeSession(e.header.session_id);break;case"ClientHBRsp":this.handleRespondData("ClientHBReq",e);break;case"MediaDescPush":case"CandidateInfoPush":this.handlePushData(e);break;case"CloseSessionPush":this.handlePushData(e),this.removeSession(e.header.session_id);break;case"QualityReportRsp":this.handleRespondData("QualityReportReq",e);break;case"SessionResetPush":this.handlePushResetSessionData(e);break;case"StreamStatusNotifyPush":case"PublishEventPush":case"PlayEventPush":case"ClientInfoPush":this.handlePushData(e);break;case"ActivateVideoPlayStreamRsp":this.handleRespondData("ActivateVideoPlayStreamReq",e);break;case"ActivateAudioPlayStreamRsp":this.handleRespondData("ActivateAudioPlayStreamReq",e);break;case"NetQualityProbeRsp":this.handleRespondData("NetQualityProbeReq",e);break;case"NetQualityInfoPush":this.handlePushData(e);break;case"ActivateSEIInsertRsp":this.handleRespondData("ActivateSEIInsertReq",e);break;case"StreamStatusNotifyAck":this.handleRespondData("StreamStatusNotify",e)}},e.prototype.disconnectCallback=function(e){this.connectCallback&&(this.connectCallback(-1,this.server,void 0),this.connectCallback=null);var t=this.server;this.disconnectServer(),this.onDisconnect(t,e)},e.prototype.updateToken=function(){var e=this;this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_UPDATE_TOKEN+" call");var t={token:this.token,tokenType:this.tokenType,roomid:this.stateCenter.roomList[0].roomID,anchorname:this.stateCenter.anchor_info.anchor_id,sdkversion:i.PROTO_VERSION,osinfo:navigator.appVersion};if(0!=Object.keys(this.sessionInfos).length){var r=[];for(var o in this.sessionInfos){var s=parseInt(o);r.push({session_id:s,session_token:this.sessionInfos[s].token})}t.sessions=r}this.sendMessageWithCallback("LoginReq",i.getSeq(),0,t,(function(t,r,o){if(0==o.result){e.token=o.token,e.tokenType=o.tokenType;var i={report:o.report,report_interval:o.report_interval_ms};o.negoInterval&&(e.negoInterval=o.negoInterval),o.negoTryCount&&(e.negoTryCount=o.negoTryCount),o.negoTryMaxCount&&(e.negoTryMaxCount=o.negoTryMaxCount),null!=e.connectCallback&&(e.connectCallback(0,e.server,i),e.connectCallback=null),e.checkMessageTimeout()}else{var n={error:o.strError};null!=e.connectCallback&&(e.connectCallback(o.result,e.server,n),e.connectCallback=null)}}),(function(){null!=e.connectCallback&&(e.connectCallback(-1,e.server,void 0),e.connectCallback=null)}))},e.prototype.sendMessageWithCallback=function(e,t,r,o,s,a){if(this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" call "+e),!this.websocket||1!==this.websocket.readyState)return this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" connect not establish"),void(a&&a(i.SEND_MSG_TIMEOUT,t));var c={header:this.getHeader(e,t,r),body:o};null==s&&(s=null),null==a&&(a=null);var d={seq:t,deleted:!1,cmd:e,time:Date.parse(new Date+""),success:s,error:a},l=this.sendDataList.push(d);this.sendDataMap[d.seq]=l;var u=JSON.stringify(c);this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" "+u),this.websocket.send(u),this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" success")},e.prototype.getHeader=function(e,t,r){return this.globalHeader={version:"1.0.1",cmd:e,appid:this.appid+"",seq:t,user_id:this.userid,session_id:r},this.globalHeader},e.prototype.connectServer=function(e,t,r){var o=this;if(this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" "+t),this.token=e,this.server=t,this.state=i.ENUM_CONNECT_STATE.connecting,this.connectCallback=r,this.websocket&&1===this.websocket.readyState)this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket is connected"),this.resetConnectTimer(),this.state=i.ENUM_CONNECT_STATE.connected;else{this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" need new websocket");try{this.websocket&&(this.logger.warn(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" close error websocket"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.websocket=new WebSocket(this.server),this.websocket.onopen=function(){o.resetConnectTimer(),o.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket open call"),o.bindWebSocketHandle(),o.updateToken(),o.state=i.ENUM_CONNECT_STATE.connected},this.websocket.onclose=function(e){o.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket close call  "+JSON.stringify(e))},this.websocket.onerror=function(e){o.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket onerror call  "+JSON.stringify(e))}}catch(e){this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket error "+e)}}this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" "+this.tryConnectInterval),this.tryConnectTimer=setTimeout((function(){o.startConnectTimer(r)}),this.tryConnectInterval)},e.prototype.startConnectTimer=function(e){if(this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" call"),this.tryConnectCount>=i.MAX_TRY_CONNECT_COUNT)return this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" beyond "+this.server+"max limit"),void this.disconnectCallback();this.websocket&&1===this.websocket.readyState?(this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" websocket is connected"),this.resetConnectTimer()):(this.tryConnectCount+=1,this.connectServer(this.token,this.server,e))},e.prototype.disconnectServer=function(){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_DISCONNECT_SERVER+" call"),this.connectCallback=null,this.resetCheckMessage(),this.resetConnectTimer(),this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.token="",this.sessionInfos={},this.tokenType=0,this.tryHeartbeatCount=0,this.tryConnectCount=0,this.state=i.ENUM_CONNECT_STATE.disconnect},e.prototype.isServerConnected=function(){return!(!this.websocket||1!==this.websocket.readyState)},e.prototype.createSession=function(e,t,r,o,s,a,c,d){void 0===s&&(s=""),void 0===a&&(a=""),this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CREATE_SESSION+" call: "+o);var l="";i.PROTO_VERSION.split(".").forEach((function(e,t){return 1==e.length&&1==t?l+="0"+e:l+=e}));var u={type:t,stream_id:o,platform:this.platform,browser:this.browser.name,version:this.browser.version,app_id:this.appid,negotiate_mode:r,strAuthParam:s,sdk_version:1*l,turn_server_host:"string"==typeof a?a:""};this.sendMessageWithCallback("CreateSessionReq",e,0,u,c,d)},e.prototype.createSessionWithSdp=function(e,t,r){var o=e.seq,s=e.type,a=e.streamId,c=e.strAuthParam,d=e.sdp,l=e.serverHost,u=e.playBufLevel;this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CREATE_SESSION+" call: "+a);var h="";i.PROTO_VERSION.split(".").forEach((function(e,t){return 1==e.length&&1==t?h+="0"+e:h+=e}));var p={type:s,app_id:this.appid,stream_id:a,sdp:d,user_id:this.userid,platform:this.platform,browser:this.browser.name,sdk_vers:parseInt(h),clientIp:"",media_server_host:"string"==typeof l?l:"",strAuthParam:c};u&&(p.min_play_buf_level_ms=u),this.sendMessageWithCallback("CreateSessionWithSdpReq",o,0,p,t,r)},e.prototype.removeSession=function(e){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_REMOVE_SESSION+" call"+e),this.sessionInfos[e]&&delete this.sessionInfos[e]},e.prototype.sendCloseSession=function(e,t,r,o,i){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_REMOVE_SESSION+" call: "+t);var s={reason:r};this.removeSession(t),this.sendMessageWithCallback("CloseSessionReq",e,t,s,o,i)},e.prototype.sendMessage=function(e,t,r,o){if(this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" call "+e),this.websocket&&1===this.websocket.readyState){var i={header:this.getHeader(e,t,r),body:o},s=JSON.stringify(i);this.websocket.send(s),this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" success")}else this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" connect not establish")},e.prototype.handleRespondData=function(e,t){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" call");var r=this.sendDataMap[t.header.seq];if(null!=r){var o=r._data;o.cmd!==e?this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" command is not match"):o.success&&o.success(t.header.seq,t.header.session_id,t.body),delete this.sendDataMap[t.header.seq],this.sendDataList.remove(r)}else{if("CloseSessionRsp"==t.header.cmd)return;this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" cannot find data "+e)}},e.prototype.addSession=function(e,t){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_ADD_SESSION+" call"+e),this.sessionInfos[e]={token:t}},e.prototype.handlePushData=function(e){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_DATA+" call "+e.header.cmd+" session "+e.header.session_id);var t=this.pushCallback[e.header.cmd+e.header.session_id];t?t.callback&&t.callback(e.header.seq,e.header.session_id,e.body):this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_DATA+" no callbackData "+e.header.cmd+" session: "+e.header.session_id)},e.prototype.handlePushResetSessionData=function(e){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" call ");var t=[];if(0==e.body.cResetType)t=Object.keys(this.sessionInfos);else if(1==e.body.cResetType)for(var r=0;r<e.body.session_ids.length;r++)t.push(e.body.session_ids[r]);if(this.sendResetSessionAck(e.header.seq,0,0),0!=t.length)for(var o=0;o<t.length;o++){var i=this.pushCallback[e.header.cmd+t[o]];null==i?this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" no callbackData "+t[o]):i.callback&&i.callback(e.header.seq,t[o],e.body)}else this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" no session to callback")},e.prototype.sendMediaDesc=function(e,t,r,o,i,s){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC+" call: "+t);var a={type:r,sdp:o.sdp};null!=o.width&&(a.width=o.width),null!=o.height&&(a.height=o.height),null!=o.frameRate&&(a.framerate=o.frameRate),null!=o.video_min_kpbs&&(a.video_min_kpbs=o.video_min_kpbs),null!=o.video_max_kpbs&&(a.video_max_kpbs=o.video_max_kpbs),null!=o.audio_kpbs&&(a.audio_kpbs=o.audio_kpbs),null!=o.keyframe_intv&&(a.keyframe_intv=o.keyframe_intv),null!=o.min_play_buf_level_ms&&(a.min_play_buf_level_ms=o.min_play_buf_level_ms),this.sendMessageWithCallback("MediaDescReq",e,t,a,i,s)},e.prototype.sendCandidateInfo=function(e,t,r,o,i){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CANDIDATE_INFO+" call: "+t);for(var s=[],a=0;a<r.length;a++){var c={candidate:r[a].candidate,sdpMid:r[a].sdpMid,sdpMLineIndex:r[a].sdpMLineIndex};s.push(c)}var d={infos:s};this.sendMessageWithCallback("CandidateInfoReq",e,t,d,o,i)},e.prototype.sendMediaDescAck=function(e,t,r){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC_ACK+" call: "+t);var o={result:r};this.sendMessage("MediaDescAck",e,t,o)},e.prototype.sendCandidateInfoAck=function(e,t,r){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CANDIDATE_INFO_ACK+" call: "+t);var o={result:r};this.sendMessage("CandidateInfoAck",e,t,o)},e.prototype.sendCloseSessionAck=function(e,t,r){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CLOSE_SESSION_ACK+" call: "+t);var o={result:r};this.sendMessage("CloseSessionAck",e,t,o)},e.prototype.sendResetSessionAck=function(e,t,r){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_RESET_SESSION_ACK+" call: "+t);var o={result:r};this.sendMessage("SessionResetAck",e,t,o)},e.prototype.registerPushCallback=function(e,t,r){r&&"function"==typeof r&&(this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_REGISTER_PUSH_CALLBACK+" set callback "+t),this.pushCallback[e+t]={callback:r})},e.prototype.unregisterPushCallback=function(e,t){delete this.pushCallback[e+t]},e.prototype.checkMessageTimeout=function(){for(var e=this,t=this.sendDataList.getFirst(),r=Date.parse(new Date+""),o=0,s=0,a=0;null!=t&&!(t._data.time+this.sendDataTimeout>r);)if(delete this.sendDataMap[t._data.seq],this.sendDataList.remove(t),++s,-1!=this.checkMessageList.indexOf(t._data.cmd)){if(null==t._data.error||this.sendDataDropTimeout>0&&t._data.time+this.sendDataDropTimeout<r?++a:(this.logger.warn(n.ZEGO_WEBRTC_ACTION.SIGNAL_CHECK_MESSAGE_TIMEOUT+" error cmd = "+t._data.cmd),t._data.error&&t._data.error(i.SEND_MSG_TIMEOUT,t._data.seq)),++o>=this.sendDataCheckOnceCount)break;t=this.sendDataList.getFirst()}else t=this.sendDataList.getFirst();this.sendDataCheckTimer=setTimeout((function(){e.checkMessageTimeout()}),this.sendDataCheckInterval),0==s&&0==a||this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CHECK_MESSAGE_TIMEOUT+" call success, state: timeout="+s+" drop="+a)},e.prototype.sendHeartbeat=function(){var e=this;if(this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+"call tryHeartbeatCount:"+this.tryHeartbeatCount),0!=Object.keys(this.sessionInfos).length)if(this.state===i.ENUM_CONNECT_STATE.connected){if(++this.tryHeartbeatCount>i.MAX_TRY_HEARTBEAT_COUNT)return this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" heartbeat try limit"),void this.disconnectCallback();var t=[];for(var r in this.sessionInfos)t.push(parseInt(r));var o={session_ids:t};this.sendMessageWithCallback("ClientHBReq",i.getSeq(),0,o,(function(t,r,o){e.heartbeatInterval!=o.hb_interval&&(e.heartbeatInterval=o.hb_interval,e.onUpdateHeartBeatInterval(o.hb_interval)),e.tryHeartbeatCount=0}),(function(e,t){}))}else this.logger.warn(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" state error");else this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" no need to heartbeat")},e.prototype.QualityReport=function(e,t,r,i,s){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_QUALITY_REPORT+" call");var a={streams:[o(o({},r),{aid:t})]};this.sendMessageWithCallback("QualityReportReq",e,t,a,i,s)},e.prototype.sendStreamStatus=function(e,t,r,o,s,a){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_STREAM_STATUS+" call "+t);var c={mic_status:o,camera_status:r};this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_STREAM_STATUS+" stream "+(s||"")+" status "+JSON.stringify(c)),this.sendMessageWithCallback("StreamStatusNotify",e,t,c,(function(){}),(function(e){e===i.SEND_MSG_TIMEOUT&&a&&a()}))},e.prototype.ActivatePlayVideoStream=function(e,t,r,o,i){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM+" call");var s={active:r?0:1,layer:0};this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM+" activate video "+JSON.stringify(s)),this.sendMessageWithCallback("ActivateVideoPlayStreamReq",e,t,s,o,i)},e.prototype.ActivatePlayAudioStream=function(e,t,r,o,i){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM+" call");var s={active:r?0:1,layer:0};this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM+" activate audio "+JSON.stringify(s)),this.sendMessageWithCallback("ActivateAudioPlayStreamReq",e,t,s,o,i)},e.prototype.sendBroadcasterStatus=function(e,t,r){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_BROADCAST_STATUS+" call "+t);var o={status:r};this.sendMessage("BroadcasterStatusNotify",e,t,o)},e.prototype.sendNetProbe=function(e,t,r,o,i){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_NET_PROBE+" call "+t);var s={peer_id:r,action:1};this.sendMessageWithCallback("NetQualityProbeReq",e,t,s,o,i)},e.prototype.sendNetQualityInfoPushAck=function(e,t,r,o){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_NET_PROBE+" call "+t);var i={peer_id:r,result:o};this.sendMessage("NetQualityInfoAck",e,t,i)},e.prototype.activateSEIInsert=function(e,t,r,o,i,s,a){this.logger.info(n.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" call "+t);var c={peer_id:r,action:o,info_type:i};this.sendMessageWithCallback("ActivateSEIInsertReq",e,t,c,s,a)},e}();t.ZegoSignal=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPlayWeb=void 0;var o=r(0),i=r(6),n=r(3),s=r(1),a=r(2),c=function(){function e(e,t,r,i,n,s,a){this.state=o.ENUM_PLAY_STATE.stop,this.candidateInfo=[],this.qualityTimer=null,this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop,this.playQualityList=[],this.maxQualityListCount=10,this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,audioPacketsReceived:0,videoPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0},this.reportSeq=NaN,this.streamReportSeq=o.getSeq(),this.videoSizeCallback=!1,this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.remoteStream=null,this.playStream=null,this.playOption={},this.closeSessionSignal=!1,this.stateNego=o.ENUM_PLAY_STATE_NEGO.stop,this.negoTimer=null,this.negoInterval=25e3,this.playEvent=!1,this.gotStreamStatus=!1,this.soundLevel=0,this.mic=null,this.script=null,this.beginTime=0,this.firstFrameTime=0,this.resourceMode=0,this.gwNode="",this.gwNodeList=[],this.gwNodeTTL=0,this.isPeer=!1,this.peerFailCount=0,this.isProbe=!1,this.peerID=0,this.netQuality=0,this.probeTime=0,this.probeInterval=6e4,this.probeState=o.ENUM_PROBE_STATE.probed,this.isRecvClientInfo=!1,this.probeTimer=null,this.probeTimeoutInterval=3e4,this.audioMuteState="0",this.videoMuteState="0",this.logger=e,this.signal=t,this.dataReport=r,this.qualityTimeInterval=i,this.streamCenter=n,this.ac=s,this.stateCenter=a,this.dataReport.newReport(this.streamReportSeq),this.dataReport.addMsgInfo(this.streamReportSeq,{abs_time:Date.now()})}return e.prototype.startPlay=function(e,t,r){var o=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" called ",e),this.playEvent=!1,this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),e?(this.streamId=e,this.getRemoteStreamSuc=t,this.playOption=r||{},r&&r.videoCodec&&(this.playOption.videoCodec=r.videoCodec),this.dataReport.addMsgInfo(this.reportSeq,{audio_activate:s.ZegoRTCLogEvent.kZegoTaskPlayStart.audio_activate(1==this.playOption.audio?1:0==this.playOption.audio?0:1),video_activate:s.ZegoRTCLogEvent.kZegoTaskPlayStart.video_activate(1==this.playOption.video?1:0==this.playOption.video?0:1)}),this.isPeer?this.createOffer():this.createSession(),this.negoTimer=setTimeout((function(){o.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" waiting timeout"),o.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNegoTimeoutError)}),this.negoInterval),this.isProbe&&(this.probeTimer=setTimeout((function(){o.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" probe timeout"),o.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kProbeTimeOutError)}),this.probeTimeoutInterval))):this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" streamId is null")},e.prototype.onCreatePlaySessionSuccess=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" success");var r=[];if(e.turn_server){var o=e.turn_server;this.stateCenter.turnOverTcpOnly&&(o=o.replace("udp","tcp")),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" turn over tcp "+o),r.push(o)}e.stun_server&&r.push(e.stun_server);var i={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" username: "+e.turn_username),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" credential: "+e.turn_auth_key),this.createOffer(i),this.signal.registerPushCallback("MediaDescPush",this.sessionId,(function(e,r,o){t.onRecvMediaDesc(e,r,o)})),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,(function(e,r,o){t.onRecvCandidateInfo(e,r,o)})),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,r,o){t.onRecvCloseSession(e,r,o)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,r,o){t.onRecvResetSession(e,r,o)})),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,(function(e,r,o){t.gotStreamStatus=!0,t.streamStatus=o,t.playStream&&t.onRecvStreamStatus(o)})),this.signal.registerPushCallback("PlayEventPush",this.sessionId,(function(e,r,o){t.onRecvPlayEvent(e,r,o)})),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,(function(e,r,o){t.onRecvClientInfo(e,r,o)})),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" call success")},e.prototype.createOffer=function(e){var t=this;this.peerConnection=new RTCPeerConnection(e),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)},this.peerConnection.ontrack=function(e){t.onGotRemoteStream(e.streams[0])};var r={offerToReceiveAudio:1,offerToReceiveVideo:1};this.playOption&&!1===this.playOption.video&&(r.offerToReceiveVideo=0),this.playOption&&!1===this.playOption.audio&&(r.offerToReceiveAudio=0),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" createOffer: "+JSON.stringify(r)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(r).then((function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.dataReport.eventEnd(t.streamReportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)}),(function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateOffer",{error:e.toString()}),t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+t.streamId+" create offer error "+e.toString()),t.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCreateOfferError,!0)}))},e.prototype.createSession=function(e){var t=this;this.sessionSeq=o.getSeq();var r=this.streamId;1==this.streamCenter.testEnvironment&&(r="zegotest-"+this.streamCenter.appid+"-"+this.streamId),this.isPeer?(this.dataReport.eventStart(this.reportSeq,"CreateSessionWithSdp"),this.dataReport.eventStart(this.streamReportSeq,"CreateSessionWithSdp"),this.signal.createSessionWithSdp({seq:this.sessionSeq,type:this.isProbe?2:1,mode:0,streamId:r,strAuthParam:this.playOption&&this.playOption.streamParams||"",sdp:e.sdp,serverHost:this.gwNode,playBufLevel:2==this.resourceMode?500:void 0},(function(e,r,o){t.handleCreateSessionWithSdpResp(e,r,o)}),(function(r,i){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:r}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:r}),!t.isProbe&&r==o.SEND_MSG_TIMEOUT&&t.peerFailCount<2?(t.peerFailCount++,t.createSession(e)):!t.isProbe&&r==o.SEND_MSG_TIMEOUT&&t.peerFailCount>=2?(t.isPeer=!1,t.streamCenter.isPeer=!1,t.createSession()):t.playStateUpdateError(r==o.SEND_MSG_TIMEOUT?s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError:s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)}))):(this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,1,0,r,this.playOption&&this.playOption.streamParams,this.gwNode,(function(e,r,o){t.handleCreateSessionResp(e,r,o)}),(function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:e}),t.playStateUpdateError(e==o.SEND_MSG_TIMEOUT?s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError:s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)}))),this.state=o.ENUM_PLAY_STATE.waitingSessionRsp,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" called success"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.start},e.prototype.handleCreateSessionResp=function(e,t,r){var o=r.turn_server,i=o.split("?")[0]&&o.split("?")[0].slice(5),n=this.streamCenter.server.split("?"),c=n[1]&&n[1].slice(2);this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+i+"/"+c+"/"+this.streamId}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+i+"/"+c+"/"+this.streamId}),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" sessionId:"+r.session_id),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,0!==r.result?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" create error"),this.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)):(this.sessionId=r.session_id,this.sessionToken=r.session_token,this.dataReport.addMsgInfo(this.reportSeq,{session_id:s.ZegoRTCLogEvent.kZegoTaskPlayStart.session_id(this.sessionId)}),this.onCreatePlaySessionSuccess(r))):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" seq is not match.")},e.prototype.handleCreateSessionWithSdpResp=function(e,t,r){var o=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" sessionId:"+t),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSessionWithSdp",{sessionId:t}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSessionWithSdp",{sessionId:t}),0!==r.result?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" create session failed "+r.result),this.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)):(this.sessionId=t,this.sessionToken=r.session_token,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" create session success ",this.streamId),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,t,r){o.onRecvCloseSession(e,t,r)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,t,r){o.onRecvResetSession(e,t,r)})),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,(function(e,t,r){o.gotStreamStatus=!0,o.streamStatus=r,o.playStream&&o.onRecvStreamStatus(r)})),this.signal.registerPushCallback("PlayEventPush",this.sessionId,(function(e,t,r){o.onRecvPlayEvent(e,t,r)})),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,(function(e,t,r){o.onRecvClientInfo(e,t,r)})),this.signal.registerPushCallback("NetQualityProbeRsp",this.sessionId,(function(e,t,r){o.onRecvPlayEvent(e,t,r)})),this.signal.registerPushCallback("NetQualityInfoPush",this.sessionId,(function(e,t,r){o.onRecvNetQualityInfo(e,t,r)})),this.onGetRemoteOfferSuccess(r.sdp))):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" seq is not match.")},e.prototype.onCreateOfferSuccess=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp2 "+e.sdp.substr(e.sdp.length/2)),e.sdp=e.sdp.replace(/sendrecv/g,"recvonly"),e.sdp=e.sdp.replace(/useinbandfec=/,"stereo=1;useinbandfec=");var r=e.sdp.match(/m=video(.|\r|\n)*a=rtpmap(.|\r|\n)*(a=fmtp:(102).*)/);if(null!==r){var o=r[3];e.sdp=e.sdp.replace(o,o+";sps-pps-idr-in-keyframe=1")}this.playOption.videoCodec&&(e.sdp=i.SdpUtil.getSDPByVideDecodeType(e.sdp,this.playOption.videoCodec)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),this.peerConnection.setLocalDescription(e).then((function(){t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription"),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription"),t.onSetLocalDescriptionSuccess(e)}),(function(e){t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+t.streamId+" set error "+e.toString()),t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription",{error:e.toString()}),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription",{error:e.toString()}),t.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSetLocalDescError,!0)}))},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" success"),this.isPeer)this.createSession(e);else{var r={sdp:e.sdp};2==this.resourceMode&&(r.min_play_buf_level_ms=500),this.answerSeq=o.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.answerSeq,this.sessionId,0,r,(function(e,r,i){t.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" sendMediaDesc resp"),t.answerSeq==e&&t.sessionId==r?(t.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" send success stateNego:waiterAnswer"),t.stateNego=o.ENUM_PLAY_STATE_NEGO.waiterAnswer,t.dataReport.eventEnd(t.reportSeq,"SendMediaDesc"),t.dataReport.eventEnd(t.streamReportSeq,"SendMediaDesc"),t.state=o.ENUM_PLAY_STATE.waitingServerAnswer):t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" seq or sessionId is not equal "+t.answerSeq+" "+e,0+t.sessionId+" "+r)}),(function(e,r){t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" failed to send "+e),t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{error:e}),t.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kMediaDescError)})),this.state=o.ENUM_PLAY_STATE.waitingOffserRsp}},e.prototype.onRecvMediaDesc=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received ",r),this.stateNego=o.ENUM_PLAY_STATE_NEGO.waitingCandidate,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.state===o.ENUM_PLAY_STATE.waitingServerAnswer?(this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0),this.onGetRemoteOfferSuccess(r.sdp)):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onGetRemoteOfferSuccess=function(e){var t,r=this,i={type:"answer",sdp:e,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription"),this.stateCenter.turnOverTcpOnly&&(null===(t=i.sdp.match(/candidate.*/g))||void 0===t||t.forEach((function(e){var t=e.replace(/udp/,"tcp");i.sdp=i.sdp.replace(e,t)}))),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" remoteSdp ",i.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(i)).then((function(){r.dataReport.eventEnd(r.reportSeq,"SetRemoteDescription"),r.dataReport.eventEnd(r.streamReportSeq,"SetRemoteDescription"),r.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+r.streamId+" set success")}),(function(e){r.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+r.streamId+" set remote error "+e.toString()),r.dataReport.eventEndWithMsg(r.reportSeq,"SetRemoteDescription",{error:e.toString()}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SetRemoteDescription",{error:e.toString()}),r.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSetRemoteDescError,!0)})),this.state=o.ENUM_PLAY_STATE.waitingServerICE,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" call success")},e.prototype.onRecvCandidateInfo=function(e,t,r){var i=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" received "),this.state==o.ENUM_PLAY_STATE.waitingServerICE){this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var n=0;n<r.infos.length;n++){var c={sdpMid:r.infos[n].sdpMid,sdpMLineIndex:r.infos[n].sdpMLineIndex,candidate:r.infos[n].candidate};this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" candidate "+c.candidate),this.peerConnection.addIceCandidate(new RTCIceCandidate(c)).then((function(){i.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add success")}),(function(e){i.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add error "+e.toString()),i.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCandidateError,!0)}))}this.state=o.ENUM_PLAY_STATE.connecting,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" call success")}else this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvPlayEvent=function(e,t,r){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_PLAY_EVENT+" "+this.streamId+" received"),!0===this.playEvent&&0==r.event){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_PLAY_EVENT+" "+this.streamId+" retry: "+this.streamId);var i=this.streamId,n=this.playOption;this.signal.sendCloseSession(o.getSeq(),this.sessionId,1),this.resetPlay(),this.startPlay(i,this.getRemoteStreamSuc,n)}else this.playEvent=!0},e.prototype.onRecvClientInfo=function(e,t,r){this.stateCenter.clientIP!==r.clientip&&this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CLIENT_INFO+" client ip changed "+this.stateCenter.clientIP+" "+r.clientip),this.stateCenter.clientIP=r.clientip,this.peerID=r.peer_id,this.isProbe&&this.stateNego==o.ENUM_PLAY_STATE_NEGO.iceConnected&&this.signal.sendNetProbe(o.getSeq(),this.sessionId,this.peerID,(function(){}),(function(){})),this.isRecvClientInfo=!0},e.prototype.onRecvNetQualityInfo=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_NET_QUALITY_INFO+" call"),this.probeTimer&&(clearTimeout(this.probeTimer),this.probeTimer=null);var i=0,s=r.lossrate,c=r.rtt;this.peerID===r.peer_id&&null!=typeof s&&null!=typeof c||(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_NET_QUALITY_INFO+" local peerID:"+this.peerID+" remote peerID:"+r.peer_id+" lossrate:"+s+" rtt:"+c),i=1),this.signal.sendNetQualityInfoPushAck(o.getSeq(),this.sessionId,this.peerID,i),0==i&&"number"==typeof s&&"number"==typeof c?this.onCalNetQualityResult(0,n.ClientUtil.getNetQuality(c,s)):this.onCalNetQualityResult(1)},e.prototype.onIceCandidate=function(e){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" called"),null!=e.candidate)if(this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate "+e.candidate.candidate),this.state<o.ENUM_PLAY_STATE.connecting||this.state==o.ENUM_PLAY_STATE.stop)this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" cached"),this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex});else{this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" send");var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};this.sendCandidateInfo([t])}},e.prototype.onConnectionStateChange=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CONNECTION_STATE_CHANGE+" "+this.streamId+" called "+e.target.signalingState)},e.prototype.onIceConnectionStateChange=function(e){if(this.state!=o.ENUM_PLAY_STATE.stop&&null!=this.peerConnection)if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState){if(this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceConnected,this.isProbe&&this.isPeer&&this.isRecvClientInfo)return this.signal.sendNetProbe(o.getSeq(),this.sessionId,this.peerID,(function(){}),(function(){})),void(this.negoTimer&&clearTimeout(this.negoTimer));for(var t in this.negoTimer&&clearTimeout(this.negoTimer),this.dataReport.addEvent(this.reportSeq,"IceConnected"),this.dataReport.addEvent(this.streamReportSeq,"IceConnected"),this.state!=o.ENUM_PLAY_STATE.playing&&this.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.start,this.streamId,{code:0,message:""},!0),this.state=o.ENUM_PLAY_STATE.playing,this.dataReport.eventStart(this.reportSeq,"PlayState"),this.dataReport.eventStart(this.streamReportSeq,"PlayState"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[t].publisher.state==o.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.stop){this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),this.sessionId,1),this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.start;break}if(!this.isProbe&&this.setPlayQualityTimer(),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateNego:iceConnected"),this.isPeer&&(this.peerFailCount=0),0==this.firstFrameTime){this.firstFrameTime=(new Date).getTime()-this.beginTime;var r=o.getReportSeq();this.dataReport.newReport(r,s.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.event),this.dataReport.addMsgInfo(r,{session_id:s.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.session_id(this.sessionId),fft_consumed:s.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.fft_consumed(this.firstFrameTime)}),!this.isProbe&&this.dataReport.uploadReport(r)}}else"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceDisconnected,this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState))},e.prototype.checkPlayConnectionFailedState=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+"  state "+this.state+" connectionState "+e),this.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kMediaConnectionError)},e.prototype.clearPlayQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesDropped:0,framesReceived:0,audioBitrate:0}},e.prototype.resetPlay=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_RESET_PLAY+" "+this.streamId+" call"),this.state=o.ENUM_PLAY_STATE.stop,this.playEvent=!1,this.isRecvClientInfo=!1,null!=this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.probeTimer&&(clearTimeout(this.probeTimer),this.probeTimer=null),this.clearPlayQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId),this.signal.unregisterPushCallback("SessionResetPush",this.sessionId),this.signal.unregisterPushCallback("PublishEventPush",this.sessionId),this.signal.unregisterPushCallback("ClientInfoPush",this.sessionId),this.signal.unregisterPushCallback("NetQualityProbeRsp",this.sessionId),this.signal.unregisterPushCallback("NetQualityInfoPush",this.sessionId)),this.sessionSeq=0,this.answerSeq=0,this.videoSizeCallback=!1,this.stopSoundLevel()},e.prototype.setPlayQualityTimer=function(){var e=this;null==this.qualityTimer&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" "+this.streamId+" startTimer"),this.clearPlayQualityTimer(),this.qualityTimer=setInterval((function(){if(e.peerConnection){var t=[e.peerConnection.getStats(null)];"Chrome"==n.ClientUtil.getBrowser()&&t.push(new Promise((function(t,r){e.peerConnection.getStats((function(e){return t(e)}),(function(e){return r(e)}))}))),Promise.all(t).then((function(t){e.getPlayStats(t[0],t[1])})).catch((function(t){e.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" "+e.streamId+" getStats error "+t.toString())}))}}),this.qualityTimeInterval),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0})},e.prototype.getPlayStats=function(e,t){var r=this;if(null!=e){for(var i,c=document.querySelectorAll("video, audio"),d=0;d<c.length;d++)c[d].srcObject===this.playStream&&(i=c[d]);var l={audioFractionLost:0,audioPacketsLost:0,audioPacketsLostRate:0,audioBitrate:0,audioLevel:0,audioSendLevel:0,audioSamplingRate:0,audioCodec:"opus",audioQuality:0,audioFPS:0,videoQuality:0,videoPacketsLost:0,videoPacketsLostRate:0,videoBitrate:0,videoFPS:0,playData:0,nackCount:0,pliCount:0,audioJitter:0,videoFractionLost:0,videoFramesDecoded:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoFramesDropped:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,audioMuteState:this.audioMuteState,videoMuteState:this.videoMuteState,muted:i?i.muted:void 0,paused:i?i.paused:void 0,volume:i?i.volume:void 0,sinkId:i?i.sinkId:void 0},u=this.lastPlayStats.time,h=0,p=0,f=0,g=0,m=0;e.forEach((function(e){if(("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("audio"==e.mediaType||e.id.indexOf("AudioStream")>=0)){0!=u&&(l.audioBitrate=8*(e.bytesReceived-r.lastPlayStats.audioBytesReceived)/(e.timestamp-u),(i=e.packetsLost-r.lastPlayStats.audioPacketsLost)>0&&(p=i/(i+e.packetsReceived-r.lastPlayStats.audioPacketsReceived))),l.audioBitrate<0&&(l.audioBitrate=0),l.audioJitter=e.jitter,e.packetsLost>0&&(l.audioPacketsLost=e.packetsLost),l.audioFractionLost=e.fractionLost;var t=e.packetsLost-r.lastPlayStats.audioPacketsLost;l.audioFPS=(e.packetsReceived-r.lastPlayStats.audioPacketsReceived)/(e.timestamp-u)*1e3,l.audioPacketsLostRate=t>0?t/(e.packetsReceived-r.lastPlayStats.audioPacketsReceived+t):0,r.lastPlayStats.audioBytesReceived=e.bytesReceived,e.packetsLost>0&&(r.lastPlayStats.audioPacketsLost=e.packetsLost),r.lastPlayStats.audioPacketsReceived=e.packetsReceived,r.lastPlayStats.audioTime=e.timestamp,r.lastPlayStats.time=e.timestamp,r.lastPlayStats.audioBitrate=l.audioBitrate,g=e.jitter}else if(("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("video"==e.mediaType||e.id.indexOf("VideoStream")>=0)){var i;0!=u&&(l.videoBitrate=8*(e.bytesReceived-r.lastPlayStats.videoBytesReceived)/(e.timestamp-u),l.videoFPS=1e3*(e.framesDecoded-r.lastPlayStats.framesDecoded)/(e.timestamp-u),(i=e.packetsLost-r.lastPlayStats.videoPacketsLost)>0&&(f=i/(i+e.packetsReceived-r.lastPlayStats.videoPacketsReceived))),l.videoBitrate<0&&(l.videoBitrate=0),l.videoFPS<0&&(l.videoFPS=0),l.nackCount=e.nackCount,l.pliCount=e.pliCount,l.videoFractionLost=e.fractionLost,l.videoFramesDecoded=e.framesDecoded,e.packetsLost>0&&(l.videoPacketsLost=e.packetsLost),t=e.packetsLost-r.lastPlayStats.videoPacketsLost,l.videoPacketsLostRate=t>0?t/(e.packetsReceived-r.lastPlayStats.videoPacketsReceived+t):0,r.lastPlayStats.videoBytesReceived=e.bytesReceived,r.lastPlayStats.framesDecoded=e.framesDecoded,e.packetsLost>0&&(r.lastPlayStats.videoPacketsLost=e.packetsLost),r.lastPlayStats.videoPacketsReceived=e.packetsReceived,r.lastPlayStats.videoTime=e.timestamp,r.lastPlayStats.time=e.timestamp,m=e.jitter}else if("track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0)||e.frameWidth){if(l.frameHeight=e.frameHeight,l.frameWidth=e.frameWidth,0===u||r.lastPlayStats.frameHeight===e.frameHeight&&r.lastPlayStats.frameWidth===e.frameWidth)0===u&&(r.lastPlayStats.frameHeight=e.frameHeight,r.lastPlayStats.frameWidth=e.frameWidth);else{var n=o.getReportSeq();r.dataReport.newReport(n,s.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.event),r.dataReport.addMsgInfo(n,{session_id:s.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.session_id(r.sessionId),w:s.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.w(e.frameWidth),h:s.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.h(e.frameHeight)}),!r.isProbe&&r.dataReport.uploadReport(n),r.lastPlayStats.frameHeight=e.frameHeight,r.lastPlayStats.frameWidth=e.frameWidth}0!=u&&(l.videoTransferFPS=1e3*(e.framesReceived-r.lastPlayStats.framesReceived)/(e.timestamp-u),l.videoFramesDropped=e.framesDropped-r.lastPlayStats.framesDropped),l.videoTransferFPS<0&&(l.videoTransferFPS=0),l.videoFramesDropped<0&&(l.videoFramesDropped=0),r.lastPlayStats.framesReceived=e.framesReceived,r.lastPlayStats.framesDropped=e.framesDropped}else"track"==e.type&&("audio"==e.kind||e.id.indexOf("audio")>=0)?(l.audioLevel=e.audioLevel,l.audioSendLevel=e.totalAudioEnergy,l.audioSamplingRate=e.totalSamplesDuration):"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(l.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(l.currentRoundTripTime=e.currentRoundTripTime,h=1e3*l.currentRoundTripTime))})),t&&t.result().forEach((function(e){"ssrc"==e.type&&e.names().indexOf("googBandwidthLimitedResolution")>=0&&(l.googBandwidthLimitedResolution=e.stat("googBandwidthLimitedResolution")),"ssrc"==e.type&&e.names().indexOf("codecImplementationName")>=0&&(l.codecImplementationName=e.stat("codecImplementationName")),"ssrc"==e.type&&"video"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(l.videoCodecName=e.stat("googCodecName")),"ssrc"==e.type&&"audio"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(l.audioCodecName=e.stat("googCodecName")),"ssrc"==e.type&&e.names().indexOf("googCpuLimitedResolution")>=0&&(l.googCpuLimitedResolution=e.stat("googCpuLimitedResolution")),"VideoBwe"==e.type&&e.names().indexOf("googAvailableSendBandwidth")>=0&&(l.googAvailableSendBandwidth=e.stat("googAvailableSendBandwidth"))})),f=isNaN(f)||f<0?0:f,m=isNaN(m)||m<0?0:m,p=isNaN(p)||p<0?0:p,g=isNaN(g)||g<0?0:g;var _=n.ClientUtil.getNetQuality(h,f,m),v=n.ClientUtil.getNetQuality(h,p,g);l.audioQuality=u>0?n.ClientUtil.quality2QualityGrade(_):0,l.videoQuality=u>0?n.ClientUtil.quality2QualityGrade(v):0;var E=Math.min(_,v);this.netQuality=E,u>0&&E<=o.QUALITY_CONSTANT.MiddleMinQuality&&(new Date).getTime()>this.probeTime+this.probeInterval&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" netQuality "+E+" start net probe"),this.probeState=o.ENUM_PROBE_STATE.tryProbe,this.streamCenter.startNetProbe(!1,this,this.gwNodeList),this.probeTime=(new Date).getTime()),this.uploadPlayQuality(l);var y={video:{videoBitrate:l.videoBitrate,videoFPS:l.videoFPS,videoTransferFPS:l.videoTransferFPS,videoFramesDecoded:l.videoFramesDecoded,videoFramesDropped:l.videoFramesDropped,videoPacketsLost:l.videoPacketsLost,videoPacketsLostRate:l.videoPacketsLostRate,videoQuality:l.videoQuality,frameHeight:l.frameHeight,frameWidth:l.frameWidth,muteState:l.videoMuteState},audio:{audioBitrate:l.audioBitrate,audioCodec:l.audioCodec,audioJitter:l.audioJitter,audioLevel:l.audioLevel,audioPacketsLost:l.audioPacketsLost,audioPacketsLostRate:l.audioPacketsLostRate,audioQuality:l.audioQuality,audioSamplingRate:l.audioSamplingRate,audioSendLevel:l.audioSendLevel,muteState:l.audioMuteState,audioFPS:l.audioFPS},nackCount:l.nackCount,pliCount:l.pliCount,totalRoundTripTime:l.totalRoundTripTime,playData:l.playData,currentRoundTripTime:l.currentRoundTripTime};void 0!==l.muted&&(y.muted=l.muted,y.paused=l.paused,y.volume=l.volume,y.sinkId=l.sinkId),void 0!==l.videoCodecName&&(y.video.googCodecName=l.videoCodecName,y.audio.googCodecName=l.audioCodecName,y.codecImplementationName=l.codecImplementationName,y.googAvailableSendBandwidth=l.googAvailableSendBandwidth),0!=u&&this.onPlayQualityUpdate(this.streamId,y)}},e.prototype.uploadPlayQuality=function(e){var t=this;if(this.qualityUpload){var r=Date.parse(new Date+"");(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="play",e.stream_id=this.streamId,e.timeStamp=r/1e3,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_UPLOAD_PLAYER_QUALITY+" "+this.streamId+" upload"+JSON.stringify(e)),this.signal.QualityReport(o.getSeq(),this.sessionId,e,(function(e,r,o){void 0!==o.report&&(t.qualityUpload=o.report,t.qualityUploadInterval=o.report_interval_ms)}),(function(e,r){t.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_UPLOAD_PLAYER_QUALITY+" "+t.streamId+" upload failed "+e)})),this.qualityUploadLastTime=r)}},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_RESET_SESSION+" "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=JSON.parse(JSON.stringify(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError));this.negoTimer&&clearTimeout(this.negoTimer),this.playStateUpdateError(o)}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_RESET_SESSION+" "+this.streamId+" cannot find session")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CLOSE_SESSION+" "+this.streamId+" "+JSON.stringify(r)),this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=r.err_info?JSON.parse(r.err_info.toLowerCase()):{},i=o.action?o.action:null,n=1*r.reason,c=JSON.parse(JSON.stringify(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError));c.message+=" reason:"+n+" "+(i?" action:"+i:""),this.negoTimer&&clearTimeout(this.negoTimer);var d=![4,8,10,11,12,14,24,26,27,28].includes(n)&&![2,5,6].includes(i);this.playStateUpdateError(c,d)},e.prototype.onRecvStreamStatus=function(e){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" call"),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" status camera_status: "+e.camera_status+" mic_status: "+e.mic_status),this.cameraStatus!==e.camera_status&&this.onRemoteCameraStatusUpdate(this.streamId,this.getCameraMicStatus(e.camera_status),e.camera_status),this.micStatus!==e.mic_status&&this.onRemoteMicStatusUpdate(this.streamId,this.getCameraMicStatus(e.mic_status),e.mic_status),this.cameraStatus=e.camera_status,this.micStatus=e.mic_status,this.videoMuteState=0===e.camera_status?"0":"1",this.audioMuteState=0===e.mic_status?"0":"1","boolean"==typeof this.playOption.video)this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" has set video option, ignore stream status");else{var t=this.playStream;if(0!==e.camera_status&&20!==e.camera_status?t.getVideoTracks().forEach((function(e){e.enabled=!1,e.stop(),t.removeTrack(e)})):0===t.getVideoTracks().length&&t.addTrack(this.remoteStream.clone().getVideoTracks()[0]),"Safari"===n.ClientUtil.getBrowser())for(var r=document.querySelectorAll("video, audio"),o=0;o<r.length;o++)r[o].srcObject===this.playStream&&(r[o].srcObject=this.playStream)}this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" call success")},e.prototype.onGotRemoteStream=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_GOT_REMOTE_STREAM+" "+this.streamId+" called "+e),e?(this.playStream?(this.playStream.getTracks().forEach((function(e){return t.playStream.removeTrack(e)})),e.clone().getTracks().forEach((function(e){return t.playStream.addTrack(e)}))):this.playStream=e.clone(),this.audioMuteState=this.playStream.getAudioTracks().length>0?"0":"1",this.videoMuteState=this.playStream.getVideoTracks().length>0?"0":"1",this.remoteStream=e,this.getRemoteStreamSuc(this.playStream),this.gotStreamStatus&&this.onRecvStreamStatus(this.streamStatus),this.dataReport.addEvent(this.reportSeq,"GetRemoteStream"),this.streamCenter.soundLevelDelegate&&!this.isProbe&&this.startSoundLevel()):this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_GOT_REMOTE_STREAM+" "+this.streamId+" remote stream is empty")},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" called"),!(e=e.filter((function(e){return!(e.candidate.indexOf("tcp")>0)&&(!!e.candidate||void 0)})))||e.length<1?this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==o.ENUM_PLAY_STATE_NEGO.iceConnected&&(this.stateNego=o.ENUM_PLAY_STATE_NEGO.sendCandidate),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(o.getSeq(),this.sessionId,e,(function(e,r,o){t.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")}),(function(e,r){t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCandidateError)})))},e.prototype.shouldSendCloseSession=function(){return this.state!=o.ENUM_PLAY_STATE_UPDATE.stop&&this.state!=o.ENUM_PLAY_STATE.waitingSessionRsp},e.prototype.playStateUpdateError=function(e,t){this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_STATE_ERROR+" call ",this.streamId,JSON.stringify(e)),this.isProbe?this.onCalNetQualityResult(1):this.streamId&&this.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.error,this.streamId,e,t),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STATE_ERROR+" "+this.streamId+" ended")},e.prototype.getCameraMicStatus=function(e){return 0==e?"OPEN":"MUTE"},e.prototype.onPlayStateUpdate=function(e,t,r,o){},e.prototype.onPlayQualityUpdate=function(e,t){},e.prototype.onRemoteCameraStatusUpdate=function(e,t,r){},e.prototype.onRemoteMicStatusUpdate=function(e,t,r){},e.prototype.stopPlay=function(){for(var e in this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STOP_PLAY+" "+this.streamId+" called"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[e].publisher.state==o.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.start){this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),this.sessionId,0),this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop;break}this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(o.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PlayState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPlay"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.addMsgInfo(this.streamReportSeq,{itemtype:"RTCPlayStream"}),!this.isProbe&&this.dataReport.uploadReport(this.streamReportSeq,"RTCPlayStream"),this.resetPlay()},e.prototype.onDisconnect=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_DISCONNECT+" "+this.streamId+" call"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.playStateUpdateError(e||s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kWebsocketDisconnectedError,!!e)},e.prototype.startSoundLevel=function(){var e=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" call streamID: "+this.streamId),!this.isProbe)if(this.remoteStream&&0!=this.remoteStream.getAudioTracks().length){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.remoteStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var r=t.inputBuffer.getChannelData(0),o=0,i=0;i<r.length;i++)o<r[i]&&(o=r[i]);e.soundLevel=100*o},this.ac.resume()}catch(e){this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" get sound level failed "+e)}}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" "+this.streamId+" remote stream no found")},e.prototype.stopSoundLevel=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STOP_SOUND_LEVEL+" call streamID: "+this.streamId),this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},e.prototype.onCalNetQualityResult=function(e,t){},e}();t.ZegoPlayWeb=c},function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryStreamHandler=void 0;var n=r(0),s=r(11),a=r(1),c=r(2),d=r(3),l=function(e){function t(t,r,o,i){var n=e.call(this)||this;return n.logger=t,n.stateCenter=r,n.streamCenter=o,n.isPublish=i,n.serverUrls=[],n}return i(t,e),t.prototype.initStream=function(e,t){this.streamID=e,this.serverUrls=t},t.prototype.activePublish=function(e){var t=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),this.stateCenter.networkState==n.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has active, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}var o=this.streamCenter.publisherList[this.streamID].publisher,i=this.serverUrls,s=o.signal?o.signal.server:"";i.forEach((function(e,r){return r<=i.indexOf(s)&&t.serverUrls.push(e)})),i.splice(0,i.indexOf(s)+1);var a=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1];return this.retryTimer=setTimeout((function(){t.logger.warn("zc.tsh.a stream "+t.streamID+" connect signal server "+a),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++,t.streamCenter.connectPublishServer(t.streamID,a)}),"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.activePull=function(e,t){var r=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),t&&(this.playStreamSuccess=t),this.stateCenter.networkState==n.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has active, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var o=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=o>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:o}var i=this.streamCenter.playerList[this.streamID].player,s=this.serverUrls,a=i.signal?i.signal.server:"";s.forEach((function(e,t){return t<=s.indexOf(a)&&r.serverUrls.push(e)})),s.splice(0,s.indexOf(a)+1);var c=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1];return this.retryTimer=setTimeout((function(){r.logger.warn("zc.tsh.a stream "+r.streamID+" connect signal server "+c),r.retryTimer&&clearTimeout(r.retryTimer),r.retryTimer=null,r.retryActiveCount++,r.streamCenter.connectPlayServer(r.streamID,r.playStreamSuccess,c)}),"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){if(e.logger.warn(e.streamID+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.invalid(),e.isPublish){if(!e.streamCenter.publisherList[e.streamID])return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" publish no found");e.publishStateHandle(n.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishRetryTimeoutError,!0)}else{if(!e.streamCenter.playerList[e.streamID])return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" play no found");e.playStateHandle(n.ENUM_PLAY_STATE_UPDATE.error,e.streamID,a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRetryTimeoutError,!0)}}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.retryNextSignal=function(e){if(this.stateCenter.networkState==n.ENUM_NETWORK_STATE.offline)return!0;if(this.isPublish){var t=this.streamCenter.publisherList[this.streamID];if(t.publisher.state==n.ENUM_PUBLISH_STATE.stop&&[a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError.code,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNegoTimeoutError.code].includes(e.code))return!0;if(t.isCenterNode&&t.publisher.signal&&t.publisher.signal.websocket&&1==t.publisher.signal.websocket.readyState)return!1;if(!t.isCenterNode&&[a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError.code].includes(e.code)){var r=(o=e.message.match(/reason:(\d+)/))?o[1]:"";return!["26"].includes(r)}return!0}var o,i=this.streamCenter.playerList[this.streamID];return!((i.player.state!=n.ENUM_PLAY_STATE.stop||![a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError.code,a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNegoTimeoutError.code].includes(e.code))&&(i.isCenterNode&&i.player.signal&&i.player.signal.websocket&&1==i.player.signal.websocket.readyState||!i.isCenterNode&&[a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError.code].includes(e.code)&&(r=(o=e.message.match(/reason:(\d+)/))?o[1]:"",["24","26","28"].includes(r))))},t.prototype.publishStateHandle=function(e,t,r,o){this.logger.info(c.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" call "+t+" "+(r?r.code+"":""));var i=o||this.RETRY_MAX_TIME<3;if(!i&&r&&(d.ClientUtil.isReDispatch(r)||0==this.serverUrls.length))return this.stopMaxTime(),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,void this.streamCenter.onPublishStateUpdate(e,t,r);var s=this.streamCenter.publisherList[t],l=s.publisher;if(!i&&r&&0!==r.code){!this.maxTimer&&!i&&this.startMaxTime(),this.stateCenter.publishStreamList[t].state=n.ENUM_PUBLISH_STREAM_STATE.retryPublish;var u=l.localStream,h=l.videoInfo,p=l.mediaStreamConfig,f=l.publishOption;if(0!=l.sessionId&&l.signal&&l.shouldSendCloseSession()&&(l.signal.sendCloseSession(n.getSeq(),l.sessionId,1),l.signal.removeSession(l.sessionId),l.closeSessionSignal=!0),l.resetPublish(),!i&&!this.retryNextSignal(r)){if(s.isCenterNode&&l.gwNodeTTL<(new Date).getTime()&&0!==l.gwNodeList.length)l.gwNode="",l.gwNodeList=[],l.gwNodeTTL=0;else if(s.isCenterNode){var g=l.gwNodeList.findIndex((function(e){return e==l.gwNode}));l.gwNode=l.gwNodeList[++g%l.gwNodeList.length]}return void setTimeout((function(){l.startPublish(t,u,h,p,f)}),3e3)}this.streamCenter.removeStreamFromSignal(!0,t)}if(i)return this.stopMaxTime(),this.invalid(),1===e&&l.resetPublish(),void this.streamCenter.onPublishStateUpdate(e,t,r);if(r&&0!==r.code&&this.activePublish(void 0)){var m=n.getReportSeq();this.streamCenter.dataReport.newReport(m),this.streamCenter.dataReport.addMsgInfo(m,{stream:a.ZegoRTCLogEvent.kZegoTaskRePublish.stream(this.streamID)}),this.streamCenter.dataReport.uploadReport(m,a.ZegoRTCLogEvent.kZegoTaskRePublish.event),this.streamCenter.onPublishStateUpdate(2,t,r)}this.logger.info(c.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" end "+t)},t.prototype.playStateHandle=function(e,t,r,o){this.logger.info(c.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" call "+t+" "+(r?r.code+"":""));var i=o||this.RETRY_MAX_TIME<3;if(!i&&r&&(d.ClientUtil.isReDispatch(r)||0==this.serverUrls.length))return this.stopMaxTime(),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,void this.streamCenter.onPlayStateUpdate(e,t,r);if(r&&0!==r.code){!this.maxTimer&&!i&&this.startMaxTime();var s=this.streamCenter.playerList[t],l=s.player,u=l.playOption;if(0!=l.sessionId&&l.signal&&l.shouldSendCloseSession()&&(l.signal.sendCloseSession(n.getSeq(),l.sessionId,1),l.signal.removeSession(l.sessionId),l.closeSessionSignal=!0),l.resetPlay(),!i&&!this.retryNextSignal(r)){if(s.isCenterNode&&l.gwNodeTTL<(new Date).getTime()&&0!==l.gwNodeList.length)l.gwNode="",l.gwNodeList=[],l.gwNodeTTL=0;else if(s.isCenterNode){var h=l.gwNodeList.findIndex((function(e){return e==l.gwNode}));l.gwNode=l.gwNodeList[++h%l.gwNodeList.length]}return void setTimeout((function(){l.startPlay(t,l.getRemoteStreamSuc,u)}),3e3)}this.streamCenter.removeStreamFromSignal(!1,t)}if(i)return this.stopMaxTime(),this.invalid(),void this.streamCenter.onPlayStateUpdate(e,t,r);if(r&&0!==r.code&&this.activePull(void 0)){var p=n.getReportSeq();this.streamCenter.dataReport.newReport(p),this.streamCenter.dataReport.addMsgInfo(p,{stream:a.ZegoRTCLogEvent.kZegoTaskRePlay.stream(this.streamID)}),this.streamCenter.dataReport.uploadReport(p,a.ZegoRTCLogEvent.kZegoTaskRePlay.event),this.streamCenter.onPlayStateUpdate(2,t,r)}this.logger.info(c.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" end "+t)},t}(s.RetryHandler);t.RetryStreamHandler=l},function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryDispatchHandler=void 0;var n=r(11),s=r(0),a=r(2),c=r(1),d=r(4),l=function(e){function t(t,r,o,i){var n=e.call(this)||this;return n.retryActiveCount=1,n.RETRY_MAX_TIME=90,n.logger=t,n.stateCenter=r,n.rtm=o,n.streamCenter=i,n}return i(t,e),t.prototype.initStream=function(e,t,r){this.streamID=e,this.playOption=t,this.isPublish=r},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" retry call "+this.streamID),this.stateCenter.networkState==s.ENUM_NETWORK_STATE.offline)return this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" has active, ignore"),!1;if(this.isOverTime)return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" retry over time, stop retry"),!1;this.rtm.isLogin()||(this.stopMaxTime(),this.invalid(),this.isPublish?this.streamCenter.publisherList[this.streamID].isReDispatch=!0:this.streamCenter.playerList[this.streamID].isReDispatch=!0);var r,o=this.retryActiveCount-1;if("PUBLIC"===this.stateCenter.type){var i=this.playOption&&2==this.playOption.resourceMode?1:0;r={stream_id:this.streamID,ptype:this.isPublish?"push":"pull",signals:this.streamCenter.getAllInUseUrl(),header_kvs:[{key:"grpc-metadata-push",value:this.playOption&&this.playOption.cdnUrl||""}],retry:o,center_ability:!0,dispatch_type:i}}else r={stream_id:this.streamID,dispatch_type:this.isPublish?1:2,stream_type:3,an_type:this.rtm.getAnType()};return this.retryTimer=setTimeout((function(){t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++;var e=t.streamCenter.getRoomByStreamID(t.streamID),o=t.rtm.service.sendMessage("webrtc_url",r,(function(e,r){t.handleFetchWebRtcUrlRsp(e)}),(function(e,r){t.handleFetchWebRtcUrlRsp(e)}),void 0,{sessionID:null==e?void 0:e.sessionID,roomID:null==e?void 0:e.roomID,roomSessionID:null==e?void 0:e.roomSessionID});t.isPublish&&o?t.streamCenter.publisherList[t.streamID]&&(t.streamCenter.publisherList[t.streamID].seq=o):o&&t.streamCenter.playerList[t.streamID]&&(t.streamCenter.playerList[t.streamID].seq=o)}),"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){e.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_MAX_TIME+" "+e.streamID+" dispatch over max time "+e.RETRY_MAX_TIME+"s stop retry"),e.isOverTime=!0,e.invalid(),e.isPublish?e.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,c.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError):e.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,e.streamID,c.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError)}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.handleFetchWebRtcUrlRsp=function(e){if(e.code&&[d.errorCodeList.TIMEOUT.code].includes(e.code))this.active();else{if(e.code&&[d.errorCodeList.SOCKET_CLOSE.code].includes(e.code))return this.stopMaxTime(),this.invalid(),void(this.isPublish?this.streamCenter.publisherList[this.streamID].isReDispatch=!0:this.streamCenter.playerList[this.streamID].isReDispatch=!0);var t=e,r=t.body.stream_id,o=!1;if(this.isPublish&&(!this.streamCenter.publisherList[r]||t.header.seq!==this.streamCenter.publisherList[this.streamID].seq))return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" seq is not match, ignore "+this.streamID),this.stopMaxTime(),void this.invalid();if(!(this.isPublish||this.streamCenter.playerList[this.streamID]&&t.header.seq===this.streamCenter.playerList[this.streamID].seq))return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" seq is not match, ignore "+this.streamID),this.stopMaxTime(),void this.invalid();if("PUBLIC"===this.stateCenter.type){if(this.stateCenter.clientIP=t.body.clientip||"",0!==t.body.err_code&&2==t.body.need_action)return this.retryActiveInterval=t.body.action_delay/1e3||Math.floor(3*Math.random())+3,void this.active();if(0!==t.body.err_code&&1!==t.body.need_action&&![3102].includes(t.body.err_code))return this.retryActiveInterval=Math.floor(3*Math.random())+3,void this.active();if(this.stopMaxTime(),this.invalid(),t.body.urls&&Array.isArray(t.body.urls)&&t.body.urls.length>0?o=!0:this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" signal url is empty"),"push"===t.body.ptype&&this.streamCenter.publisherList[r]){if(!o)return void this.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,r,c.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError);var i=this.streamCenter.publisherList[r];this.stateCenter.publishStreamList[r]?(i.ttl=t.body.hosts_ttl?(new Date).getTime()+1e3*t.body.hosts_ttl:0,i.isCenterNode="boolean"==typeof t.body.is_center_node&&t.body.is_center_node,i.serverUrls=t.body.urls,this.streamCenter.startPublishingStream(r)):this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" no streamid to publish")}else if("pull"==t.body.ptype&&this.streamCenter.playerList[r]){if(!o){var n=c.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError;return 3102===t.body.err_code&&(n=c.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayUnsupportedResourceMode),void this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,r,n)}(f=this.streamCenter.playerList[r]).ttl=t.body.hosts_ttl?(new Date).getTime()+1e3*t.body.hosts_ttl:0,f.isCenterNode="boolean"==typeof t.body.is_center_node&&t.body.is_center_node,f.serverUrls=t.body.urls,this.streamCenter.startPlayingStream(r,this.streamCenter.playSuccessCallBackList[r])}}else{this.stopMaxTime(),this.invalid();var l=[],u=t.body.stream_url_info&&t.body.stream_url_info.stream_url,h=t.body.stream_url_info&&t.body.stream_url_info.ip_infos,p=/^ws(s)?:\/\/(.*?)\//;if(t.body.stream_url_info&&u&&h?o=!0:this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" signal url is empty"),h&&h.forEach((function(e){var t=e.ip_address+":"+e.port;l.push(u.replace(p.exec(u)[2],t))})),this.isPublish&&this.streamCenter.publisherList[r]){if(!o)return void this.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,r,c.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError);i=this.streamCenter.publisherList[r],this.stateCenter.publishStreamList[r]?(i.serverUrls=l,this.streamCenter.startPublishingStream(r)):this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" no streamid to publish")}else if(!this.isPublish&&this.streamCenter.playerList[r]){if(!o)return void this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,r,c.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError);var f;(f=this.streamCenter.playerList[r]).serverUrls=l,this.streamCenter.startPlayingStream(r,this.streamCenter.playSuccessCallBackList[r])}}}},t}(n.RetryHandler);t.RetryDispatchHandler=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RangeAudio=void 0;var o=r(32);t.RangeAudio={type:"RangeAudio",install:function(e){Object.defineProperty(e.prototype,"createRangeAudioInstance",{value:function(){return this.rangeAudio||(this.rangeAudio=o.ZegoExpressRangeAudio.getInstance(this)),this.rangeAudio},writable:!1})}}},function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressRangeAudio=void 0;var i=o(r(33)),n=function(){function e(e){this.zegoAudioListener=i.default.getInstance(e)}return e.getInstance=function(t){if(!e.instance){if(!t)throw Error("create instance failed.");e.instance=new e(t)}return e.instance},e.prototype.on=function(e,t){return this.zegoAudioListener.on(e,t)},e.prototype.off=function(e,t){return this.zegoAudioListener.off(e,t)},e.prototype.setAudioReceiveRange=function(e){this.zegoAudioListener.setAudioReceiveRange(e)},e.prototype.updateSelfPosition=function(e,t,r,o){this.zegoAudioListener.updateSelfPosition(e,t,r,o)},e.prototype.updateAudioSource=function(e,t){this.zegoAudioListener.updateAudioSource(e,t)},e.prototype.enableSpatializer=function(e){return this.zegoAudioListener.enableSpatializer(e)},e.prototype.enableMicrophone=function(e){return this.zegoAudioListener.enableMicrophone(e)},e.prototype.enableSpeaker=function(e){return this.zegoAudioListener.enableSpeaker(e)},e.prototype.setRangeAudioMode=function(e){this.zegoAudioListener.setRangeAudioMode(e)},e.prototype.setTeamID=function(e){this.zegoAudioListener.setRangeAudioTeamID(e)},e.prototype.isAudioContextRunning=function(){return"running"===this.zegoAudioListener.getAudioContextState()},e.prototype.resumeAudioContext=function(){return this.zegoAudioListener.resumeAudioContext()},e}();t.ZegoExpressRangeAudio=n},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(r(34)),a=n(r(35)),c=n(r(36)),d=n(r(12)),l=r(37),u=r(5),h=function(){function e(e){var t=this;this.isSpatial=!1,this.audioSourceList=[],this.speakingUserIdList=[],this._audioCtx=null,this.zegoRTC=e,this.zegoRTC.on("roomStreamUpdate",(function(e,r,o){var i=o.map((function(e){return e.streamID}));"DELETE"===r?t.speakingUserIdList=t.speakingUserIdList.filter((function(e){var r=!i.includes(e);if(!r){var o=t.audioSourceMap[e];o&&o.isPlaying&&o.stopPlayingAudio()}return r})):"ADD"===r&&(t.speakingUserIdList=t.speakingUserIdList.concat(i),o.forEach((function(e){if(!t.audioSourceMap[e.streamID]){var r=t.getStreamInfo(e.extraInfo),o=r.teamID,i=r.sendMode,n=new s.default({userID:e.streamID,teamID:o,sendMode:i},{audioCtx:t.audioCtx,zegoRTC:t.zegoRTC,isSpatial:t.isSpatial,maxDistance:t.rangeListener.recvRange});t.audioSourceList.push(n),t.playStreamHandler.handlePlayAudioTask()}}))),t.playStreamHandler.setAudioSourceList(t.speakingAudioSourceList)})),this.zegoRTC.on("playerStateUpdate",(function(e){var r=t.audioSourceMap[e.streamID];r&&("NO_PLAY"===e.state?r.isPlaying=!1:r.isPlaying=!0)})),this.zegoRTC.on("streamExtraInfoUpdate",(function(e,r){r.forEach((function(e){var r=t.audioSourceMap[e.streamID];if(r){var o=t.getStreamInfo(e.extraInfo),i=o.teamID,n=o.sendMode;i!==r.teamID&&(r.teamID=i,t.enableSpatializer(t.isSpatial)),void 0!==n&&(r.sendMode=n),t.playStreamHandler.handlePlayAudioTask()}}))})),this.zegoRTC.RTM._on("_roomStateUpdate",(function(e,r){"CONNECTED"===r?(t.roomID=e,t.rangeListener.userID=t.zegoRTC.RTM.getUserID()):"DISCONNECTED"===r&&(t.roomID=void 0,t.rangeListener.reset(),t.audioSourceList=[])}));var r=window.AudioContext||window.webkitAudioContext;this._audioCtx=this.zegoRTC&&this.zegoRTC.ac||new r,this.rangeListener=a.default.getInstance(this.audioCtx,this.zegoRTC),this.playStreamHandler=c.default.getInstance(this.rangeListener),this.eventManager=d.default.getInstance()}return Object.defineProperty(e.prototype,"audioSourceMap",{get:function(){return this.audioSourceList.reduce((function(e,t){return t.userID&&(e[t.userID]=t),e}),{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speakingAudioSourceList",{get:function(){var e=this;return this.audioSourceList.filter((function(t){return!!e.speakingUserIdList.includes(t.userID)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playingAudioSourceList",{get:function(){return this.audioSourceList.filter((function(e){return e.isPlaying}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioCtx",{get:function(){if(!this._audioCtx){var e=window.AudioContext||window.webkitAudioContext;this._audioCtx=new e}return this._audioCtx},enumerable:!1,configurable:!0}),e.getInstance=function(t){return e.instance||(e.instance=new e(t)),e.instance},e.prototype.resumeAudioContext=function(){return o(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){return[2,new Promise((function(t){e.audioCtx.onstatechange=function(){"running"===e.audioCtx.state&&t(!0)},e.audioCtx.suspend(),e.audioCtx.resume(),setTimeout((function(){t(!1)}),3e3)}))]}))}))},e.prototype.getAudioContextState=function(){return this.audioCtx.state},e.prototype.getStreamInfo=function(e){var t=void 0,r=void 0;try{var o=JSON.parse(e);t=o.range_audio_team_id,[u.ZegoRangeAudioMode.World,u.ZegoRangeAudioMode.Team].includes(o.range_audio_mode)&&(r=o.range_audio_mode)}catch(e){}return{teamID:t,sendMode:r}},e.prototype.setAudioReceiveRange=function(e){if(!l.checkNumber(e))throw Error("Failed to execute 'setAudioReceiveRange': Argument 'range' requires to be type number.");if((e=Number(e))<0)throw Error("Failed to execute 'setAudioReceiveRange': Argument 'range' can not be less than 0.");this.rangeListener.recvRange=e,this.audioSourceList.forEach((function(t){t.setMaxDistance(e)}))},e.prototype.updateSelfPosition=function(e,t,r,o){var i=function(e){return"Failed to execute 'updateSelfPosition': Argument '"+e+"' requires an array of type number.\""};if(!l.checkCoordinate(e))throw new Error(i("position"));if(!l.checkCoordinate(t))throw new Error(i("axisForward"));if(!l.checkCoordinate(r))throw new Error(i("axisRight"));if(!l.checkCoordinate(o))throw new Error(i("axisUp"));this.rangeListener&&this.rangeListener.updateSelfPosition(e,t,o),this.playStreamHandler.setListener(this.rangeListener)},e.prototype.updateAudioSource=function(e,t){if(e=String(e),!l.checkCoordinate(t))throw new Error("Failed to execute 'updateAudioSource': Arguments 'position' must be an array of type number.");var r=this.audioSourceMap[e];r?r.setPosition(t):(r=new s.default({userID:e,position:t},{audioCtx:this.audioCtx,zegoRTC:this.zegoRTC,isSpatial:this.isSpatial,maxDistance:this.rangeListener.recvRange}),this.enableSpatializer(this.isSpatial),this.audioSourceList.push(r)),this.playStreamHandler.setAudioSourceList(this.speakingAudioSourceList)},e.prototype.enableMicrophone=function(e){if(void 0===e&&(e=!0),!this.rangeListener.userID)throw new Error("Enable mic failed. Please log in room first.");return e?this.rangeListener.startPublishingStream():this.rangeListener.stopPublishingStream()},e.prototype.enableSpeaker=function(e){if(void 0===e&&(e=!0),!this.roomID)throw new Error("Enable speaker failed. Please log in room first.");this.playStreamHandler.isEnable=e,e?(this.playStreamHandler.startPlayingAudioStream(),this.playStreamHandler.handlePlayAudioTask()):this.playStreamHandler.stopPlayingAudioStream()},e.prototype.enableSpatializer=function(e){var t=this;void 0===e&&(e=!0),this.isSpatial=!!e,this.audioSourceList.forEach((function(r){var o=!(![r.teamID,t.rangeListener.teamID].includes(void 0)&&t.rangeListener.teamID===r.teamID)&&e;r.enableSpatializer(o)})),e&&this.rangeListener.updateListenerEffect()},e.prototype.setRangeAudioTeamID=function(e){this.rangeListener.setTeamID(e),this.enableSpatializer(this.isSpatial),this.playStreamHandler.handlePlayAudioTask()},e.prototype.setRangeAudioMode=function(e){this.rangeListener.setSendMode(e),this.rangeListener.setRecvMode(e),this.playStreamHandler.handlePlayAudioTask()},e.prototype.on=function(e,t){return this.eventManager.addEventHandler(e,t)},e.prototype.off=function(e,t){return this.eventManager.removeEventHandler(e,t)},e}();t.default=h},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),s=function(){function e(e,t){this.panner=null,this.isSpatial=!1,this.autoPlay=!0,this.position=null,this.stream=null,this.sourceNode=null,this.isPlaying=!1,this.distance=null,this.audioCtx=t.audioCtx,this.zegoRTC=t.zegoRTC,this.isSpatial=t.isSpatial,this.maxDistance=t.maxDistance||1e5,this.userID=e.userID,this.teamID=e.teamID,this.sendMode=void 0!==e.sendMode?e.sendMode:n.ZegoRangeAudioMode.World,e.position&&(this.position=e.position)}return Object.defineProperty(e.prototype,"audioWrapper",{get:function(){var e=document.getElementById("#zg-audio-source-wrapper");return e||((e=document.createElement("div")).setAttribute("id","zg-audio-source-wrapper"),document.body.appendChild(e)),e},enumerable:!1,configurable:!0}),e.prototype.createPanner=function(){var e=this.position||[0,0,0],t=this.maxDistance;return new PannerNode(this.audioCtx,{panningModel:"HRTF",distanceModel:"linear",refDistance:1,maxDistance:t,rolloffFactor:1,coneOuterGain:.4,positionX:e[1],positionY:e[0],positionZ:-e[0]})},e.prototype.startPlayingAudio=function(){return o(this,void 0,void 0,(function(){var e,t;return i(this,(function(r){switch(r.label){case 0:return(e=document.getElementById("zg-audio-source-"+this.userID))?[3,2]:((e=document.createElement("audio")).setAttribute("autoplay","autoplay"),e.setAttribute("id","zg-audio-source-"+this.userID),e.setAttribute("crossorigin","anonymous"),t=this,[4,this.zegoRTC.startPlayingStream(this.userID)]);case 1:t.stream=r.sent(),this.audioWrapper.appendChild(e),this.stream&&(e.srcObject=this.stream,this.sourceNode=this.audioCtx.createMediaStreamSource(this.stream)),this.panner||(this.panner=this.createPanner()),this.sourceNode&&this.enableSpatializer(this.isSpatial,!0),"suspended"===this.audioCtx.state&&this.audioCtx.resume(),r.label=2;case 2:return e&&e.parentNode&&e.parentNode.removeChild(e),[2]}}))}))},e.prototype.stopPlayingAudio=function(){this.isPlaying&&this.zegoRTC.stopPlayingStream(this.userID),this.stream=null,this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null)},e.prototype.setPosition=function(e){this.position=e,this.panner&&(this.panner.positionX.value=e[1],this.panner.positionY.value=e[2],this.panner.positionZ.value=-e[0])},e.prototype.setMaxDistance=function(e){this.maxDistance=e,this.panner&&(this.panner.maxDistance=this.maxDistance)},e.prototype.getDistanceFromListener=function(e){var t=this.position,r=e.position;if(!r||!t)return null;var o=[t[0]-r[0],t[1]-r[1],t[2]-r[2]];return this.distance=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)+Math.pow(o[2],2)),this.distance},e.prototype.enableSpatializer=function(e,t){void 0===t&&(t=!1),(t||this.isSpatial!==e)&&(this.isSpatial=e,this.sourceNode&&(e&&this.panner?(this.sourceNode.disconnect(),this.sourceNode.connect(this.panner).connect(this.audioCtx.destination)):e||(this.sourceNode.disconnect(),this.sourceNode.connect(this.audioCtx.destination))))},e}();t.default=s},function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),n=o(r(12)),s=function(){function e(e,t){var r=this;this.recvMode=i.ZegoRangeAudioMode.World,this.sendMode=i.ZegoRangeAudioMode.World,this.recvRange=null,this.position=null,this.forwardAxis=[1,0,0],this.upAxis=[0,0,1],this.audioStream=null,this.isPublishing=!1,this.zegoRTC=t,this.audioCtx=e,this.audioListener=this.audioCtx.listener,this.eventHandler=n.default.getInstance(),this.zegoRTC.on("publisherStateUpdate",(function(e){var t=e.streamID,o=e.state,n=e.errorCode,s=e.extendedData;t===r.userID&&("NO_PUBLISH"===o?(r.isPublishing=!1,r.stopPublishingStream()):r.isPublishing=!0);var a={NO_PUBLISH:i.ZegoRangeAudioMicrophoneState.Off,PUBLISH_REQUESTING:i.ZegoRangeAudioMicrophoneState.TurningOn,PUBLISHING:i.ZegoRangeAudioMicrophoneState.On};r.eventHandler.emit("microphoneStateUpdate",a[o],n,s)}))}return e.getInstance=function(t,r){return e.instance||(e.instance=new e(t,r)),e.instance},e.prototype.updateSelfPosition=function(e,t,r){this.position=e,this.forwardAxis=t,Array.isArray(r)&&(this.upAxis=r),this.updateListenerEffect()},e.prototype.updateListenerEffect=function(){this.position&&(this.audioListener.positionX?(this.audioListener.positionX.value=this.position[1],this.audioListener.positionY.value=this.position[2],this.audioListener.positionZ.value=-this.position[0]):this.audioListener.setPosition(this.position[1],this.position[2],-this.position[0]),this.audioListener.forwardX?(this.audioListener.forwardX.value=this.forwardAxis[1],this.audioListener.forwardY.value=this.forwardAxis[2],this.audioListener.forwardZ.value=-this.forwardAxis[0],this.audioListener.upX.value=this.upAxis[1],this.audioListener.upY.value=this.upAxis[2],this.audioListener.upZ.value=-this.upAxis[0]):this.audioListener.setOrientation(this.forwardAxis[1],this.forwardAxis[2],-this.forwardAxis[0],this.upAxis[1],this.upAxis[2],-this.upAxis[0]))},e.prototype.startPublishingStream=function(){var e=this;this.zegoRTC.createStream({camera:{video:!1,audio:!0,audioBitrate:30}}).then((function(t){if(!e.userID)throw e.zegoRTC.destroyStream(t),Error("Enable mic failed. Please log in room first.");e.audioStream&&e.audioStream!==t&&e.zegoRTC.destroyStream(e.audioStream),e.audioStream=t;var r={range_audio_team_id:e.teamID,range_audio_mode:e.sendMode};e.zegoRTC.startPublishingStream(e.userID,t,{extraInfo:JSON.stringify(r)})})).catch((function(e){throw e}))},e.prototype.stopPublishingStream=function(){this.isPublishing&&this.userID&&this.zegoRTC.stopPublishingStream(this.userID),this.isPublishing=!1,this.audioStream&&(this.zegoRTC.destroyStream(this.audioStream),this.audioStream=null)},e.prototype.setRecvMode=function(e){this.recvMode=e},e.prototype.setSendMode=function(e){this.sendMode=e,this.updateSteamExtraInfo()},e.prototype.setTeamID=function(e){this.teamID=e,this.updateSteamExtraInfo()},e.prototype.updateSteamExtraInfo=function(){this.userID&&this.isPublishing&&this.zegoRTC.setStreamExtraInfo(this.userID,JSON.stringify({range_audio_team_id:this.teamID||void 0,range_audio_mode:this.sendMode}))},e.prototype.reset=function(){this.audioStream&&this.stopPublishingStream(),this.userID=void 0},e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),i=function(){function e(e){this.isEnable=!1,this.interval=3e3,this.timer=null,this.audioSourceList=[],this.hasChanged=!1,this.maxPlayingQuantity=20,this.rangeListener=e}return e.getInstance=function(t){return e.instance||(e.instance=new e(t)),e.instance},e.prototype.setListener=function(e){this.rangeListener=e,this.hasChanged=!0},e.prototype.setAudioSourceList=function(e){this.audioSourceList=e,this.hasChanged=!0},e.prototype.startPlayingAudioStream=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.playAudioTask()},e.prototype.playAudioTask=function(){var e=this;this.hasChanged&&(this.hasChanged=!1,this.handlePlayAudioTask()),this.timer=window.setTimeout((function(){e.playAudioTask()}),this.interval)},e.prototype.handlePlayAudioTask=function(){var e=this;if(this.isEnable){var t=this.getTeamAudioSourceGroup(),r=t.teamList,i=t.otherList,n=0;r.forEach((function(t){n<e.maxPlayingQuantity&&(t.isPlaying||t.startPlayingAudio(),n++)}));var s=this.rangeListener.recvMode===o.ZegoRangeAudioMode.World;s&&(i.forEach((function(t){t.distance=t.getDistanceFromListener(e.rangeListener)})),i.sort((function(e,t){return null===e.distance?1:null===t.distance||e.distance<t.distance?-1:e.distance>t.distance?1:0}))),i.forEach((function(t){s&&n<e.maxPlayingQuantity&&t.sendMode!==o.ZegoRangeAudioMode.Team&&null!==t.distance&&(null===e.rangeListener.recvRange||t.distance<=e.rangeListener.recvRange)?(t.isPlaying||t.startPlayingAudio(),n++):t.stopPlayingAudio()}))}else this.stopPlayingAudioStream()},e.prototype.getTeamAudioSourceGroup=function(){var e=this,t=[],r=[];return this.audioSourceList.forEach((function(o){[o.teamID,e.rangeListener.teamID].includes(void 0)||o.teamID!==e.rangeListener.teamID?r.push(o):t.push(o)})),{teamList:t,otherList:r}},e.prototype.stopPlayingAudioStream=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.audioSourceList.forEach((function(e){e.stopPlayingAudio()}))},e}();t.default=i},function(e,t,r){"use strict";function o(e){return!isNaN(Number(e))&&Number.MAX_SAFE_INTEGER>=Number(e)&&Number(e)>=-Number.MAX_SAFE_INTEGER}Object.defineProperty(t,"__esModule",{value:!0}),t.checkCoordinate=t.checkBoolean=t.checkNumber=void 0,t.checkNumber=o,t.checkBoolean=function(e){return!1},t.checkCoordinate=function(e){if(Array.isArray(e)){for(var t=0;t<3;t++)if(!o(e[t]))return!1;return!0}return!1}},function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressEngine=void 0;var n=r(13),s=r(31);n.ZegoExpressEngine.use(s.RangeAudio);var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(n.ZegoExpressEngine);t.ZegoExpressEngine=a}]))},,,,,,function(e,t,r){"use strict";r.r(t),r.d(t,"ZegoExpressEngine",(function(){return c}));r(308),r(309),r(336),r(51),r(52);var o,i=r(364),n=r(333),s=r(332),a=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),c=function(e){function t(t,r){var o=this;if(!t||isNaN(t)||!r||!r.length||"string"!=typeof r&&!Array.isArray(r))throw new Error("Parameter error.");var i=(o=e.call(this,t,r)||this).zegoWebRTC.getVersion()<"2.0"?o.zegoWebRTC:o.zegoWebRTM;return o.zegoWhiteboard=new n.a(new s.a(i)),o}return a(t,e),t.prototype.loginRoom=function(e,t,r,o){return this.zegoWhiteboard.loginRoom(e,t,r,o)},t.prototype.logoutRoom=function(e){this.zegoWhiteboard.logoutRoom(e)},t.prototype.clear=function(){return this.zegoWhiteboard.clear()},t.prototype.createView=function(e){return this.zegoWhiteboard.createView(e)},t.prototype.destroyView=function(e){return this.zegoWhiteboard.destroyView(e)},t.prototype.attachView=function(e,t){return this.zegoWhiteboard.attachView(e,t)},t.prototype.getViewList=function(){return this.zegoWhiteboard.getViewList()},t.prototype.on=function(r,o){return t.ZegoWhiteboardEvent.includes(r)?this.zegoWhiteboard.on(r,o):e.prototype.on.call(this,r,o)},t.prototype.off=function(r,o){return t.ZegoWhiteboardEvent.includes(r)?this.zegoWhiteboard.off(r,o):e.prototype.off.call(this,r)},t.prototype.getVersion=function(){return"2.1.6"},t.prototype.setDeferredRenderingTime=function(e){this.zegoWhiteboard.setDeferredRenderingTime(e)},t.prototype.enableSyncScale=function(e){this.zegoWhiteboard.enableSyncScale(e)},t.prototype.enableResponseScale=function(e){this.zegoWhiteboard.enableResponseScale(e)},t.prototype.enableHandwriting=function(e){this.zegoWhiteboard.enableHandwriting(e)},t.ZegoWhiteboardEvent=["error","viewAdd","viewRemoved","viewScroll","viewScale","whiteboardAuthChange","whiteboardGraphicAuthChange"],t}(i.ZegoExpressEngine)},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=12)}([function(e,t,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.LoggerStateCenter=t.ZegoDataReport=t.ZegoLogger=t.LinkedList=t.ListNode=t.getReportSeq=t.getSeq=t.REPORT_ACTION=t.E_CLIENT_TYPE=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.PROTO_VERSION="1.9.1",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallProgram=2]="ClientType_SmallProgram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={})),t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},t.getSeq=(o=1,function(){return o++}),t.getReportSeq=function(){var e=1;return function(){return e++}}();var i=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=i;var n=function(){function e(){this.start=new i,this.end=new i,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new i(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=n;var s=r(14);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return s.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return s.ZegoDataReport}}),Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return s.LoggerStateCenter}}),Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return s.createZegoWebSocket}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},TRANS_FREQUENTLY:{code:1102022,msg:"trans send frequently"},IM_CONTENT_NULL:{code:1009001,msg:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,msg:"message content is too long"},IM_SEND_FAILED:{code:1009010,msg:"failed to send message"},FREQ_LIMITED:{code:1109001,msg:"frequency limited."}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_RTM_ACTION=void 0,function(e){e.ZEGOEXPRESSWEBRTM_CONSTRUCTOR="zm.0",e.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER="zm.wl",e.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG="zm.slf",e.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE="zm.sdv",e.ZEGOEXPRESSWEBRTM_LOGIN_ROOM="zm.lg",e.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM="zm.lo",e.ZEGOEXPRESSWEBRTM_SEND_CUSTOM="zm.scc",e.ZEGOEXPRESSWEBRTM_SEND_BCM="zm.sbcm",e.ZEGOEXPRESSWEBRTM_SEND_RLM="zm.srlm",e.ZEGOEXPRESSWEBRTM_SEND_BRM="zm.sbrm",e.ZEGOEXPRESSWEBRTM_SEND_RAM="zm.sram",e.ZEGOEXPRESSWEBRTM_ON="zm.on",e.ZEGOEXPRESSWEBRTM_OFF="zm.off",e.ZEGOEXPRESSWEBRTM_RENEWTOKEN="zm.rntk",e.ZEGOEXPRESSWEBRTM_RESETTOKENTIMER="zm.rstt",e.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM="zm.emr",e.ZEGOEXPRESSWEBRTM_SEND_PB="zm.spb",e.ZEGOEXPRESSWEBRTM_GET_HEADER="zm.gh",e.ROOM_LOGIN_ROOM="zm.rm.lg",e.ROOM_TRY_LOGIN="zm.rm.tl",e.ROOM_OPEN_HANDLER="zm.rm.op",e.ROOM_HANDLE_LOGINRSP="zm.rm.lgr",e.ROOM_CLOSEHANDLER="zm.rm.clh",e.ROOM_LOGOUT="zm.rm.lo",e.ROOM_RESET_ROOM="zm.rm.rr",e.ROOM_DISCONNECT="zm.rm.dcn",e.ROOM_KICK_OUT="zm.rm.kco",e.ROOM_STATUS_CALLBACK="zm.rm.scb",e.ROOM_RESETTOKEN_TIMER="zm.rm.rst",e.HEARTBEAT_START="zm.hb.st",e.HEARTBEAT_HEARTBEAT_RSP="zm.hb.rsp",e.HEARTBEAT_RESET="zm.hb.rst",e.SERVICE_PUSH="zm.sv.ps",e.SERVICE_SEND="zm.sv.sd",e.USER_LOGIN_RSP="zm.us.lgr",e.USER_FETCH_USER="zm.us.ftu",e.USER_FETCH_USER_RSP="zm.us.urp",e.USER_USER_PUSH="zm.us.uph",e.USER_MERGE_SEQ="zm.us.mg",e.USER_MERGE_TIMEOUT="zm.us.mto",e.USER_MERGE="zm.us.mg",e.USER_HB_PATCH="zm.us.pt",e.MESSAGE_SEND_RELIABLE="zm.msg.sdr",e.MESSAGE_FETCH_RELIABLE="zm.msg.frm",e.MESSAGE_RELIABLE_RSP="zm.msg.rlr",e.MESSAGE_RELIABLE_PUSH="zm.msg.rps",e.MESSAGE_SEND_ROOM_MSG="zm.msg.srm",e.MESSAGE_SEND_CUSTOM_MSG="zm.msg.scm",e.MESSAGE_SEND_BIG_MSG="zm.msg.sbm",e.MESSAGE_BIG_MSG_PUSH="zm.msg.bps",e.MESSAGE_SEND_RELAY_MSG="zm.msg.slm",e.LIVE_SEND_SIGNAL="zm.lv.ssg",e.LIVE_RESPOND_JOIN_LIVE="zm.lv.rjl",e.LIVE_PUSH_SIGNAL="zm.lv.pss",e.STATE_ACTION="zm.st.at",e.ZEGOEXPRESSWEBRTM_LOGIN_HALL="zm.lh",e.ZEGOEXPRESSWEBRTM_LOGOUT_HALL="zm.loh",e.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE="zm.scm"}(t.ZEGO_RTM_ACTION||(t.ZEGO_RTM_ACTION={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var o=r(15),i=r(0),n=r(1),s=function(){function e(){}return e.checkConfigParam=function(e,t,r){return e&&"number"==typeof e&&this.checkInteger(e)?!(!t||"string"!=typeof t&&!Array.isArray(t)||""==t)||(r.error("ccp.0 server must be string or string array and not empty"),!1):(r.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkPriConfigParam=function(e,t,r,o,i){return e&&"number"==typeof e&&this.checkInteger(e)?t&&"string"==typeof t?"object"!=typeof r||"string"!=typeof r.deviceID?(i.error("ccp.0 deviceID must be string and not empty"),!1):1===o||0===o||(i.error("ccp.0 anType must be 0 or 1"),!1):(i.error("ccp.0 dispatchServer must be string and not empty"),!1):(i.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){var o,i;t.success&&(o=t.success,r[e+"SuccessCallback"]=o),t.error&&(i=t.error,r[e+"ErrorCallback"]=i)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,o,i){e.registerCallback(t,{success:function(t,i){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];e.dataReportEvent(r,o,t,i,n)}},i)},e.proxyRes=function(t,r,o,i){return{interResolve:function(e){t.uploadReport(r),o(e)},interReject:function(o,n){var s;void 0===n&&(n=""),(s=o.code<2e9&&o.code>1e9?e.decodeServerError(o.code,o.msg):{code:o.code,message:o.msg})&&t.addMsgInfo(r,{error:s.code,message:s.message+n}),t.uploadReport(r),i({errorCode:o.code})}}},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:"};if(0===e)return n.errorCodeList.SUCCESS;var r=n.errorCodeList.ROOM_INNER_ERROR;return r.code=e,r.msg=e>1e9?t[1e9]+e:t[e]?t[e]+" code:"+e:"unknown error code:"+e,r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return r.code=e>1e9?e-1e9+52e6:e+2002e6,t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"ROOM_ERROR_AUTHENTICATION_FAILED",2003:"ROOM_ERROR_LOGIN_TIMEOUT"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.getKickoutError=function(e){var t={code:e,message:"kickout reason = "+e};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,o,i){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,i[0]);break;case"addEventMsg":e.addEventMsg(t,o,i[0],i[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,i[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeUserList=function(e,t,r,o){e.debug("msl.0 call");var i,n=[],s=[];r||(r=[]);for(var a=0;a<r.length;a++){i=!1;for(var c=0;c<t.length;c++)if(r[a].userID===t[c].userID){i=!0;break}i||n.push(r[a])}for(var d=0;d<t.length;d++){i=!1;for(var l=0;l<r.length;l++)if(t[d].userID===r[l].userID){i=!0;break}i||s.push(t[d])}for(t.splice(0),a=0;a<r.length;a++)t.push(t[a]);o(n,s),e.debug("msl.0 call success")},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},e.uuid=function(e,t){var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||o.length,e)for(r=0;r<e;r++)i[r]=o[0|Math.random()*t];else{var n=void 0;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=o[19==r?3&n|8:n])}return i.join("")},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var i=parseInt(e[o]),n=parseInt(t[o]);if(i>n)return 1;if(i<n)return-1}return 0},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),o=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,n=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":r?"Firefox":o?"Opera":i?"Chrome":n?"Safari":"Unkown"},e.isTestEnv=function(e){return-1!=e.indexOf("wss://wssliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://test2-wsliveroom-api.zego.im/ws")||-1!=e.indexOf("wss://wsliveroom-test.zegocloud.com/ws")||-1!=e.indexOf("wss://wsliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test-bak.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-hk-test.zegocloud.com/ws")||-1!=e.indexOf("wss://webliveroom-hk-test-bak.zegocloud.com/ws")},e.getLogLevel=function(e){return i.LOG_LEVEL[e]},e.getUint64=function(e,t,r){var o=r.getUint32(e,t),i=r.getUint32(e+4,t),n=t?o+Math.pow(2,32)*i:Math.pow(2,32)*o+i;return Number.isSafeInteger(n),n},e.decodeTokenExpire=function(t){try{var r,i=Uint8Array.from(o.Base64.base64decode(t),(function(e){return e.charCodeAt(0)})),n=new DataView(i.buffer);return r="function"==typeof n.getBigInt64?n.getBigUint64(0):e.getUint64(0,!1,n),Number(r>0?r:n.getBigUint64(0,!0))}catch(e){}return-1},e}();t.ClientUtil=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTMLogEvent=void 0;var o=r(1),i=function(e){return e};t.ZegoRTMLogEvent={kZegoTaskInitSetting:{event:"/sdk/init",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM},system_info:navigator?navigator.appVersion:""},kZegoTaskSetDebug:{event:"/sdk/set_debug",debug:i},kZegoTaskSetLog:{event:"/sdk/set_log_config",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM},log_level:function(e){return e},remote_log_level:i,log_url:i},kZegoTaskLoginRoom:{event:"/sdk/login",user_update:i,max_member_count:i,message:i,token:i,error:{ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,INPUT_PARAM:o.errorCodeList.INPUT_PARAM,ROOM_ID_TOO_LONG:o.errorCodeList.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:o.errorCodeList.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:o.errorCodeList.USER_ID_NULL,USER_ID_TOO_LONG:o.errorCodeList.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:o.errorCodeList.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:o.errorCodeList.USER_NAME_NULL,USER_NAME_TOO_LONG:o.errorCodeList.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:o.errorCodeList.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:o.errorCodeList.LOGIN_TIMEOUT,INNER_ERROR:o.errorCodeList.ROOM_INNER_ERROR,NETWORK_BROKEN:o.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:i,try_cnt:i},liveroom_login:{event:"liveroom_login",server:i,respond_info:i}}},kZegoTaskReNewToken:{event:"/sdk/reNewToken",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,NOT_LOGIN:o.errorCodeList.NOT_LOGIN}},kZegoTaskLogoutRoom:{event:"/sdk/logout",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskReLoginRoom:{event:"/sdk/relogin",error:{ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,ROOM_DISCONNECT:o.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:i,try_cnt:i},liveroom_login:{event:"liveroom_login",server:i,respond_info:i}}},kZegoTaskLoginHall:{event:"/sdk/login_hall",user_update:i,device_id:i,message:i,token:i,device_type:i,an_type:i,room_flag:i,test_environment:i,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,USER_ID_NULL:o.errorCodeList.USER_ID_NULL,USER_ID_TOO_LONG:o.errorCodeList.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:o.errorCodeList.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:o.errorCodeList.USER_NAME_NULL,USER_NAME_TOO_LONG:o.errorCodeList.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:o.errorCodeList.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:o.errorCodeList.LOGIN_TIMEOUT,INNER_ERROR:o.errorCodeList.ROOM_INNER_ERROR,NETWORK_BROKEN:o.errorCodeList.NETWORK_BROKEN},subEvent:{dispatch_connection:{event:"dispatch_connection"},create_socket:{event:"create_socket",server:i,try_cnt:i},liveroom_login:{event:"liveroom_login",server:i,respond_info:i}}},kZegoTaskLogoutHall:{event:"/sdk/logout_hall",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM}},kZegoTaskEnterRoom:{event:"/sdk/enter",role:i,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,ROOM_ID_TOO_LONG:o.errorCodeList.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:o.errorCodeList.ROOM_ID_INVALID_CHARACTER,NOT_LOGIN:o.errorCodeList.NOT_LOGIN,REPEATEDLY_ENTER_ROOM:o.errorCodeList.REPEATEDLY_ENTER_ROOM}},kZegoTaskLeaveRoom:{event:"/sdk/leave",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM}},kZegoTaskReLoginHall:{event:"/sdk/relogin",error:{ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,ROOM_DISCONNECT:o.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:i,try_cnt:i},liveroom_login:{event:"liveroom_login",server:i,respond_info:i}}},kZegoTaskKickout:{event:"/sdk/kickout",user_id:i,error:{}},kZegoTaskRoomKickout:{event:"/sdk/room_kickout",user_id:i,room_id:i,message:i},kZegoTaskLiveRoomHB:{event:"/liveroom/hb",room_sid:i,error:{NOT_LOGIN:o.errorCodeList.NOT_LOGIN,HB_TIMEOUT:o.errorCodeList.TIMEOUT}},kZegoTaskLiveSendRoomBigIM:{event:"/liveroom/send_big_room_message",room_sid:i,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:o.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:o.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendCustomCommand:{event:"/liveroom/send_custom_command",room_sid:i,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:o.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:o.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendRoomMessage:{event:"/liveroom/send_room_message",room_sid:i,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:o.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:o.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendReliableMessage:{event:"/liveroom/send_reliable_message",room_sid:i,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,TRANS_FREQUENTLY:o.errorCodeList.TRANS_FREQUENTLY,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveGetRoomBigIM:{event:"/liveroom/get_big_room_message"},kZegoTaskLiveRoomGetRoomMessage:{event:"/liveroom/get_room_message",room_sid:i},kZegoTaskLiveRoomGetCustomCommand:{event:"/liveroom/get_custom_command"},kZegoTaskLiveRoomGetUserUpdateInfo:{event:"/liveroom/get_user_update_info",user_update_type:i},kZegoListener:{event:"/sdk/listener"},kZegoEnableMultiRoom:{event:"sdk/enable_multi_room",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM,kAlreadyLoginError:o.errorCodeList.ALREADY_LOGIN}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TryHandler=void 0;var o=function(){function e(e,t){this.logger=e,this.stateCenter=t,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,r,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof o&&(this.RETRY_MAX_TIME_INTERVAL=o)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.TryHandler=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeartBeatHandler=void 0;var o=r(0),i=r(3),n=r(1),s=r(2),a=r(4),c=3,d=function(){function e(e,t,r,o,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=i,this.tryHeartbeatCount=0,this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.initCount=0}return e.prototype.init=function(e){var t,r=this;if("PRIVATE"==this.stateCenter.type){t=e.body.hb_interval<o.MINIUM_HEARTBEAT_INTERVAL?o.MINIUM_HEARTBEAT_INTERVAL:e.body.hb_interval;var i=e.body.hb_timeout||4e4;c=i/t+1}else t=e.body.hearbeat_interval<o.MINIUM_HEARTBEAT_INTERVAL?o.MINIUM_HEARTBEAT_INTERVAL:e.body.hearbeat_interval;this.tryHeartbeatCount=0,this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.loginHeartbeatTimer=setTimeout((function(){r.start(t)}),t),this.initCount++},e.prototype.start=function(e){var t=this;this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" call");var r=o.getReportSeq();if(this.dataReport.newReport(r,a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.event),this.dataReport.addMsgInfo(r,{room_sid:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.room_sid(this.room.sessionID)}),!this.room.isLogin())return this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" state error"),this.dataReport.addMsgInfo(r,{error:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.code,message:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.msg}),void this.dataReport.uploadReport(r);if(++this.tryHeartbeatCount>c)return this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" come to try limit"),this.dataReport.addMsgInfo(r,{error:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.code,message:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.msg}),this.dataReport.uploadReport(r),void this.hbLogout(n.errorCodeList.HEARTBEAT_TIMEOUT);var d=function(e){var o="PRIVATE"==t.stateCenter.type?e.body&&e.body.code:e.body&&e.body.err_code;if(e.header&&e.body){if(0!==o){var s=i.ClientUtil.decodeServerError(e.body.err_code||e.body.code,e.body.err_message||e.body.message);t.dataReport.addMsgInfo(r,{error:s.code,message:s.message+e.body.err_code})}}else t.dataReport.addMsgInfo(r,{error:e.code>0?e.code:n.errorCodeList.ROOM_INNER_ERROR.code,message:e.msg?e.msg:n.errorCodeList.ROOM_INNER_ERROR});t.dataReport.uploadReport(r),"PRIVATE"==t.stateCenter.type?t.handlePrivateHeartbeatRsp(e):t.handleHeartbeatRsp(e)};this.service.heartBeat(d,d,this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.heartbeatInterval=e;var l=this.heartbeatInterval;this.initCount>=2?(l=Math.round(Math.random()*(this.heartbeatInterval+1)),this.initCount=1):l=this.heartbeatInterval,this.heartbeatTimer=setTimeout((function(){t.start(t.heartbeatInterval)}),l),this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" call success")},e.prototype.handleHeartbeatRsp=function(e){return e.body&&e.body.err_code&&0!==e.body.err_code?(this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.err_code),e.body.err_code==o.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(n.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(i.ClientUtil.getServerError(e.body.err_code))):e.header&&e.body?(this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hearbeat_interval,this.heartbeatInterval<o.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=o.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),void this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")):(this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, error=",JSON.stringify(e)),void this.hbLogout(e))},e.prototype.handlePrivateHeartbeatRsp=function(e){if(0!==e.body.code)return this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.code),e.body.code==o.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(n.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(i.ClientUtil.getServerError(e.body.code));this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hb_interval,this.heartbeatInterval<o.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=o.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")},e.prototype.heartbeatRspNotiFy=function(e){},e.prototype.hbLogout=function(e){},e.prototype.resetHeartbeat=function(){clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null,clearTimeout(this.loginHeartbeatTimer),this.loginHeartbeatTimer=null,this.tryHeartbeatCount=0,this.initCount=0,this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_RESET+" call success")},e}();t.HeartBeatHandler=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveHandler=void 0;var o=r(0),i=r(2),n=r(3),s=r(1),a=function(){function e(e,t,r,o){this.logger=e,this.stateCenter=t,this.service=r,this.room=o,this.joinLiveCallbackMap={},this.joinLiveRequestMap={}}return e.prototype.resetLiveHandler=function(){this.joinLiveCallbackMap={},this.joinLiveRequestMap={}},e.prototype.getSignalCmdContent=function(e,t,r){var o={request_id:e,room_id:this.room.roomID,from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,to_userid:t};return null!=r&&(o.result=r),JSON.stringify(o)},e.prototype.requestJoinLive=function(e,t,r,i){var n=this.stateCenter.getRequestId(),s=this.getSignalCmdContent(n,e);return null!=i&&(this.joinLiveCallbackMap[n]=i,this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveRequest,s,e,t,r),!0)},e.prototype.sendSignalCmd=function(e,t,r,o,a){if(this.room.isLogin()){var c={sub_cmd:e,signal_msg:t,dest_id_name:[r]};this.service.sendSignalCmd(c,(function(e){o&&o(e.header.seq)}),(function(e){var t=s.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(t=e),void(a&&a(t,0));a&&a(n.ClientUtil.getServerError(e.body.err_code),e.header.seq)}),this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(i.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" call success"+e)}else this.logger.error(i.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" state error")},e.prototype.inviteJoinLive=function(e,t,r,i){var n=this.stateCenter.getRequestId(),s=this.getSignalCmdContent(n,e);return null!=i&&(this.joinLiveCallbackMap[n]=i,this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveInvite,s,e,t,r),!0)},e.prototype.endJoinLive=function(e,t,r){var i=this.stateCenter.getRequestId(),n=this.getSignalCmdContent(i,e);return this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveStop,n,e,t,r),!0},e.prototype.respondJoinLive=function(e,t,r,n){var s=this.joinLiveRequestMap[e];if(!s)return this.logger.info(i.ZEGO_RTM_ACTION.LIVE_RESPOND_JOIN_LIVE+" no dest id name"),!1;var a=0;!0===t&&(a=1);var c=this.getSignalCmdContent(e,s,a);return this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveResult,c,s,r,n),delete this.joinLiveRequestMap[e],!0},e.prototype.handlePushSignalMsg=function(e){var t=JSON.parse(e.body.signal_msg);switch(this.logger.info(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" hpsm= ",t),e.body.sub_cmd){case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveRequest:this.handlePushJoinLiveRequestMsg(t);break;case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveResult:this.handlePushJoinLiveResultMsg(t);break;case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveInvite:this.handlePushJoinLiveInviteMsg(t);break;case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveStop:this.handlePushJoinLiveStopMsg(t)}},e.prototype.handlePushJoinLiveRequestMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.joinLiveRequestMap[t]=r,this.onRecvJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id),this.logger.info(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvJoinLiveRequest "+r)):this.logger.error(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.onRecvJoinLiveRequest=function(e,t,r,o){this.stateCenter.actionListener("recvJoinLiveRequest",e,t,r,o)},e.prototype.handlePushJoinLiveInviteMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.joinLiveRequestMap[t]=r,this.onRecvInviteJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id),this.logger.info(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvInviteJoinLiveRequest "+r)):this.logger.error(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+"no requestId")},e.prototype.onRecvInviteJoinLiveRequest=function(e,t,r,o){this.stateCenter.actionListener("recvInviteJoinLiveRequest",e,t,r,o)},e.prototype.handlePushJoinLiveResultMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.result;if(null!=r){var o=1==r;if(this.joinLiveCallbackMap[t]){var n=this.joinLiveCallbackMap[t];if(!n)return void this.logger.info(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no callback");this.logger.info(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" joinLiveRequest/invite result "+o),delete this.joinLiveCallbackMap[t],n(o,e.from_userid,e.from_username)}}else this.logger.info(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no result")}else this.logger.error(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.handlePushJoinLiveStopMsg=function(e){var t=e.request_id;"string"==typeof t?(this.logger.info(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvEndJoinLiveCommand "+e.from_userid),this.onRecvEndJoinLiveCommand(t,e.from_userid,e.from_username,e.room_id)):this.logger.error(i.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.onRecvEndJoinLiveCommand=function(e,t,r,o){this.stateCenter.actionListener("recvEndJoinLiveCommand",e,t,r,o)},e}();t.LiveHandler=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var o=r(0),i=r(3),n=r(1),s=r(2),a=r(4),c=function(){function e(e,t,r,o,i){var n=this;this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=i,this.sendRoomMsgTime=0,this.sendRoomMsgInterval=500,this.bigImCallbackMap={},this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImTimer=null,this.relayTimer=null,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.isReliable=!1,this.transSeqMap={},this.onRecvReliableMessage=function(e){var t=e.map((function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.trans_idname,userName:e.trans_nickname},updateTime:e.trans_send_time}}));n.stateCenter.actionListener("roomExtraInfoUpdate",n.room.roomID,t),e.forEach((function(e){n.stateCenter.actionListener("recvReliableMessage",e.trans_type,e.trans_seq,e.trans_data)}))},this.realyMessageList=[]}return e.prototype.loginRsp=function(e){var t=this;if(null!=e.body.ret_timestamp&&"string"==typeof e.body.ret_timestamp){var r=parseFloat(e.body.ret_timestamp);this.serverTimeOffset=0==r?0:e.body.ret_timestamp-(new Date).getTime()}if(e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.datiTimeWindow=e.body.dati_time_window),e.body.trans_seqs)for(var o=0;o<e.body.trans_seqs.length;o++){var i=e.body.trans_seqs[o].trans_channel,n=e.body.trans_seqs[o].trans_seq_array;(n=n.filter((function(e){var r=e.trans_type,o=e.trans_seq;return!t.transSeqMap[r]||t.transSeqMap[r].seq<o}))).length>0&&this.fetchReliableMessage(i,n)}},e.prototype.sendReliableMessage=function(e,t,r,o){var c=this;if(this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" call"),this.isReliable)return this.logger.error(s.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" send too often"),void o(a.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.TRANS_FREQUENTLY);this.transSeqMap[e]||(this.transSeqMap[e]={seq:0});var d={trans_type:e,trans_data:t,trans_local_seq:this.transSeqMap[e].seq,trans_channel:"clt"};this.isReliable=!0,this.service.sendReliableMessage(d,(function(t){c.transSeqMap[e].seq=t.body.trans_seq,c.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" trans "+e+" seq "+t.body.trans_seq),c.isReliable=!1,r({seq:t.header.seq,errorCode:0})}),(function(e){var t=n.errorCodeList.ROOM_INNER_ERROR;e.body&&e.body.err_code?(t=i.ClientUtil.getServerError(e.body.err_code),c.logger.error(s.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+t.msg)):t=e==n.errorCodeList.TIMEOUT?n.errorCodeList.IM_SEND_FAILED:e,c.isReliable=!1,o(t)}),this.room.sessionID,this.room.roomID,this.room.roomSessionID)},e.prototype.fetchReliableMessage=function(e,t){var r=this,o={trans_channel:e,fetch_array:t},i=function(e){r.handleFetchTransRsp(e)};this.service.fetchReliableMessage(o,i,i,this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_FETCH_RELIABLE+" call success")},e.prototype.handleFetchTransRsp=function(e){if(e.body&&0!=e.body.err_code)this.logger.error(s.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+e.body.err_code);else if(e.header&&e.body){var t=e.body.trans_fetch_results,r=[];if(Array.isArray(t)&&t.length>0)for(var i=0;i<t.length;i++){var n=t[i];if(n.err_code!==o.ERROR_CODES.FETCH_TRANS_UNKNOWN_TYPE){var a=n.trans_type,c=n.trans_seq;n.err_code!==o.ERROR_CODES.FETCH_TRANS_WRONG_SEQ?(!this.transSeqMap[a]||this.transSeqMap[a].seq<c?(this.transSeqMap[a]={seq:c},r.push(n)):this.logger.warn(s.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq wrong"),r.length>0&&this.onRecvReliableMessage(r)):(this.logger.warn(s.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq is wrong "+n.err_code),this.transSeqMap[a]={seq:c})}else this.logger.warn(s.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans unknown type "+n.err_code)}}else this.logger.error(s.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+e)},e.prototype.handlePushTransMsg=function(e){var t=e.body.trans_type,r=e.body.trans_seq;!this.transSeqMap[t]||this.transSeqMap[t].seq<r?(this.transSeqMap[t]={seq:r},this.onRecvReliableMessage([e.body])):this.logger.warn(s.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans seq wrong"),this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans "+t+" seq "+r)},e.prototype.sendRoomMsg=function(e,t,r,o,a,c){var d=this;if(!this.room.isLogin())return this.logger.error(s.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" state error"),!1;var l=Date.parse(new Date+"");if(this.sendRoomMsgTime>0&&this.sendRoomMsgTime+this.sendRoomMsgInterval>l)return this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" freq error"),c&&c(n.errorCodeList.FREQ_LIMITED,0,e,o),!1;this.sendRoomMsgTime=l;var u="PRIVATE"==this.stateCenter.type?{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},msg_category:e,msg_type:1,msg_content:o}:{msg_category:e,msg_type:1,msg_content:o};return this.service.sendRoomMsg(u,(function(e){a({seq:e.header.seq,errorCode:0,messageID:e.body.msg_id})}),(function(e){var t,r,o=n.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(o=e),void c({seq:0,errorCode:o.code,messageID:0});o=(t=[i.ClientUtil.getServerError("PRIVATE"==d.stateCenter.type?e.body.code:e.body.err_code),e.body.msg_id])[0],r=t[1],d.logger.error(s.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+o.msg),d.logger.error(s.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+o.msg),o==n.errorCodeList.TIMEOUT&&(o=n.errorCodeList.IM_SEND_FAILED),c({seq:e.header.seq,errorCode:o.code,messageID:r})}),this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  call success"),!0},e.prototype.handlePushRoomMsg=function(e){var t=this,r=o.getReportSeq();this.dataReport.newReport(r),this.dataReport.addMsgInfo(r,{room_sid:a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.room_sid(e.header.session_id)});var i=[];"PRIVATE"==this.stateCenter.type?e.body.chat_data.forEach((function(e){var o={fromUser:{userID:e.user_id,userName:e.user_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id};i.push(o),t.dataReport.addMsgInfo(r,{from_msg_id:e.id_name})})):e.body.chat_data.forEach((function(e){var o={fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id};i.push(o),t.dataReport.addMsgInfo(r,{from_msg_id:e.id_name})})),this.dataReport.uploadReport(r,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.event),this.stateCenter.actionListener("IMRecvBroadcastMessage",this.room.roomID,i),this.stateCenter.actionListener("_recvRoomMsg",e.body.chat_data,e.body.server_msg_id,e.body.ret_msg_id)},e.prototype.sendCustomCommand=function(e,t,r,o){var a=this;if(!this.room.isLogin())return this.logger.error(s.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" state error"),!1;var c={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||"",room_id:this.room.roomID},d="PRIVATE"==this.stateCenter.type?{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},request_id:this.stateCenter.getRequestId(),msg:t,destids:e}:{dest_id_name:e,custom_msg:JSON.stringify(c)};return this.service.sendCustomCommand(d,(function(e){r({seq:e.header.seq,errorCode:0})}),(function(e){var t,r=i.ClientUtil.getServerError("PRIVATE"==a.stateCenter.type?e.body.code:e.body.err_code);a.logger.error(s.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" "+r.msg),t=r==n.errorCodeList.TIMEOUT?n.errorCodeList.IM_SEND_FAILED:r,o({seq:e.header.seq,errorCode:t.code})}),this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" call success"),!0},e.prototype.handlePushCustomMsg=function(e){var t,r,i,n,s,c;if("PRIVATE"==this.stateCenter.type)i=(t=[e.body.from_user_id,e.body.from_user_name,this.room.roomID,e.body.msg])[0],n=t[1],s=t[2],c=t[3];else{var d=JSON.parse(e.body.custommsg);i=(r=[d.from_userid,d.from_username,d.room_id,d.custom_content])[0],n=r[1],s=r[2],c=r[3]}var l=o.getReportSeq();this.dataReport.newReport(l),this.dataReport.uploadReport(l,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetCustomCommand.event),this.stateCenter.actionListener("IMRecvCustomCommand",s,{userID:i,userName:n},c)},e.prototype.sendBigRoomMessage=function(e,t,r,i,n,s){var a=this,c=this.bigimTimeWindow,d=this.serverTimeOffset,l=(new Date).getTime()+d,u=o.getSeq().toString();if(this.bigImCallbackMap[u]={success:n,error:s},0==c){var h={msg_category:e,msg_type:1,msg_content:i,bigmsg_client_id:u};this.sendBigRoomMessageInternal([h],(function(e){a.handleBigImMsgRsp(e)}),(function(e){s&&s(e)}))}else{var p=Math.floor(l/c);if(this.bigImLastTimeIndex<p&&0==this.bigIMmessageList.length){this.bigImLastTimeIndex=p;var f={msg_category:e,msg_type:1,msg_content:i,bigmsg_client_id:u};this.sendBigRoomMessageInternal([f],(function(e){a.handleBigImMsgRsp(e)}),(function(e){s&&s(e)}))}else this.bigIMmessageList.push({msg_category:e,msg_type:1,msg_content:i,bigmsg_client_id:u}),1==this.bigIMmessageList.length&&this.setBigImTimer(d,c)}},e.prototype.sendBigRoomMessageInternal=function(e,t,r){var o={msgs:e};this.service.sendBigRoomMessage(o,(function(e){t(e)}),(function(e){var t=n.errorCodeList.ROOM_INNER_ERROR;e.header&&e.body||(e.code&&e.msg&&(t=e),r(t)),r(t)}),this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_SEND_BIG_MSG+" sendBigRoomMessage called")},e.prototype.handleBigImMsgRsp=function(e){this.bigimTimeWindow=e.body.bigim_time_window;for(var t=0;t<e.body.msgs.length;t++){var r=e.body.msgs[t].bigmsg_client_id,o=e.body.msgs[t].bigmsg_id;if(this.bigImCallbackMap[r]){var i=this.bigImCallbackMap[r].success;null!=i&&i({seq:e.header.seq,errorCode:0,messageID:o}),delete this.bigImCallbackMap[r]}}},e.prototype.setBigImTimer=function(e,t){var r=this,o=t-((new Date).getTime()+e)%t,n=i.ClientUtil.generateRandumNumber(t)+o;this.bigImTimer=setTimeout((function(){r.onBigImTimer()}),n)},e.prototype.onBigImTimer=function(){var e=this,t=(new Date).getTime()+this.serverTimeOffset;this.bigImLastTimeIndex=Math.floor(t/this.bigimTimeWindow);for(var r=[],o=[],i=0;i<this.bigIMmessageList.length&&!(i>=20);i++){var n=this.bigIMmessageList[i];r.push({msg_category:n.msg_category,msg_type:n.msg_type,msg_content:n.msg_content,bigmsg_client_id:n.bigmsg_client_id}),o.push(n.bigmsg_client_id)}this.bigIMmessageList.length>20?this.bigIMmessageList.splice(0,20):this.bigIMmessageList=[],this.sendBigRoomMessageInternal(r,(function(t){e.handleBigImMsgRsp(t)}),(function(t,r){for(var i=0;i<o.length;i++){var n=o[i],s=e.bigImCallbackMap[n];s&&(null!=s.error&&s.error(t,r),delete e.bigImCallbackMap[n])}})),this.bigImTimer&&clearTimeout(this.bigImTimer),this.bigImTimer=null,this.bigIMmessageList.length>0&&this.setBigImTimer(this.serverTimeOffset,this.bigimTimeWindow)},e.prototype.handlePushMergeMsg=function(e){for(var t=0;t<e.body.messages.length;t++)14001===e.body.messages[t].sub_cmd&&this.handlePushBigRooMsg(e.body.messages[t].msg_body)},e.prototype.handlePushBigRooMsg=function(e){var t;try{t=JSON.parse(e)}catch(e){return void this.logger.warn(s.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"parse json error")}if(t){for(var r=t.room_id,o=[],i=0;i<t.msg_data.length;i++){var n=t.msg_data[i];n.id_name!=this.stateCenter.idName?o.push({idName:n.id_name,nickName:n.nick_name,messageId:n.bigmsg_id,category:n.msg_category,type:n.msg_type,content:n.msg_content,time:n.send_time}):this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" self message")}0==o.length?this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" no other pushData except self"):this.onRecvBigRoomMessage(o,r),this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"call success")}else this.logger.warn(s.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" cann't find message body")},e.prototype.onRecvBigRoomMessage=function(e,t){var r=o.getReportSeq();this.dataReport.newReport(r);var i=[];e.forEach((function(e){var t={fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId};i.push(t)})),this.dataReport.uploadReport(r,a.ZegoRTMLogEvent.kZegoTaskLiveGetRoomBigIM.event),this.stateCenter.actionListener("IMRecvBarrageMessage",t,i),this.stateCenter.actionListener("_recvBigRoomMessage",e,t)},e.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this.relayTimer&&(clearTimeout(this.relayTimer),this.relayTimer=null),this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer&&(clearTimeout(this.bigImTimer),this.bigImTimer=null),this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0},e.prototype.sendRelayMessage=function(e,t,r,o){var i=this.datiTimeWindow,n=this.serverTimeOffset;i>0?(this.realyMessageList.push({type:e,data:t,success:r,error:o}),1==this.realyMessageList.length&&this.setRelayTimer(n,i)):this.sendRelayMessageInternal(e,t,r,o)},e.prototype.sendRelayMessageInternal=function(e,t,r,o){this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" call");var a={relay_type:e,relay_data:t},c=this.room;this.service.sendRelayMessage(a,(function(e){r&&r(e.header.seq,e.body.relay_result)}),(function(e){var t=n.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(t=e),void(o&&o(t,0));o&&o(i.ClientUtil.getServerError(e.body.err_code),e.header.seq)}),c.sessionID,c.roomID,c.roomSessionID)},e.prototype.setRelayTimer=function(e,t){var r=this,o=2*t-((new Date).getTime()+e)%t,n=i.ClientUtil.generateRandumNumber(o);this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" setTimer "+n),this.relayTimer=setTimeout((function(){r.onRelayTimer()}),n)},e.prototype.onRelayTimer=function(){if(0!=this.realyMessageList.length){var e=this.realyMessageList[0];this.sendRelayMessageInternal(e.type,e.data,e.success,e.error),this.relayTimer&&clearTimeout(this.relayTimer),this.relayTimer=null,this.realyMessageList.splice(0,1),this.realyMessageList.length>0&&this.setRelayTimer(this.serverTimeOffset,this.datiTimeWindow)}else this.logger.info(s.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+"  no relay data")},e.prototype.getRoomChatInfo=function(e,t,r,o){if(this.logger.debug("zb.mh.grc call"),this.room.isLogin()){var i={room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},msg_id:e,msg_count:t},n=function(e,t){if(0!==e.body.code)o({errorCode:e.body.code,extendData:e.body.message||""});else{var i=e.body.msg_data.map((function(e){return{fromUser:{userID:e.user_id,userName:e.user_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id}}));r({chatData:i})}};this.service.sendMessage("zegochat_js.room_im_chat_fetch",i,n,n),this.logger.info("zb.mh.grc call success")}else this.logger.error("zb.mh.srm no enter room")},e}();t.MessageHandler=c},function(e,t,r){"use strict";var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<r;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,i++)o[i]=n[s];return o};Object.defineProperty(t,"__esModule",{value:!0}),t.UserHandler=void 0;var i=r(0),n=r(3),s=r(2),a=r(4),c=function(){function e(e,t,r,o,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=i,this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=[],this.userSeqMergeMap={},this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}return e.prototype.loginRsp=function(e,t){this.anchor_info=e.body.anchor_info||this.anchor_info,this.userListInterval=e.body.userlist_interval||this.userListInterval,this.userListMergeInterval=e.body.userlist_merge_timeout||this.userListMergeInterval,e.body.anchor_info&&(this.stateCenter.actionListener("getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name),this.stateCenter.actionListener("_getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name)),e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count),this.logger.info(s.ZEGO_RTM_ACTION.USER_LOGIN_RSP+"  userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList(t)},e.prototype.patchUserList=function(e){var t=this;e.body.server_user_seq!==this.userSeq&&this.stateCenter.userStateUpdate&&!this.userSeqMergeMap&&(this.logger.info(s.ZEGO_RTM_ACTION.USER_HB_PATCH+" call update user "+this.userSeq+" server "+e.body.server_user_seq),this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){t.handleMergeTimeout()}),this.userListMergeInterval)),this.minUserSeq=e.body.server_user_seq,null!=e.body.online_count&&0!=e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count)},e.prototype.resetUserHandler=function(){this.userQuerying=!1,this.lastUserQueryTime=0,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=void 0,this.userSeqMergeMap={},this.userSeqMergeTimer=void 0,this.userQueryTimer=void 0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},e.prototype.fetchUserList=function(e){this.userQuerying?this.logger.warn(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" is already querying"):(this.userQuerying=!0,this.userTempList=[],this.fetchUserListWithPage(0,e||0),this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" the first time call"))},e.prototype.fetchUserListWithPage=function(e,t){var r=this,o=function(e){"PRIVATE"==r.stateCenter.type?r.handleFetchUserListPrivateRsp(e):r.handleFetchUserListRsp(e,t)};"PRIVATE"==this.stateCenter.type&&(this.room.roomID,this.room.roomSid,this.room.roomSessionID),"V1"===i.ROOMVERSION?this.service.fetchUserList({user_index:e,sort_type:0},o,o,this.room.sessionID,this.room.roomID,this.room.roomSessionID):this.service.fetchUserListV2({marker:0===e?"":e+"",mode:0,limit:100},o,o,this.room.sessionID,this.room.roomID,this.room.roomSessionID)},e.prototype.handleFetchUserListRsp=function(e,t){var r=this;if(e.body&&0!=e.body.err_code)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e.body.err_code);if(!e.header||!e.body)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e);if(this.stateCenter.userStateUpdate){this.userTempList=o(this.userTempList,e.body.user_baseinfos);var a=e.body.ret_user_index;if(a!=e.body.server_user_index)return this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch another page"),void this.fetchUserListWithPage(a+1,t);this.userSeq=e.body.server_user_seq;for(var c=[],d=[],l=0;l<this.userTempList.length;l++){var u={userID:this.userTempList[l].id_name,userName:this.userTempList[l].nick_name,role:this.userTempList[l].role};c.push(u),d.push({idName:this.userTempList[l].id_name,nickName:this.userTempList[l].nick_name,role:this.userTempList[l].role})}this.stateCenter.actionListener("_getTotalUserList",this.room.roomID,d),t==i.ENUM_RUN_STATE.login?(this.userList&&n.ClientUtil.mergeUserList(this.logger,this.userList,c,(function(e,t){0!==e.length&&r.onUserStateUpdate(r.room.roomID,"ADD",e),0!==t.length&&r.onUserStateUpdate(r.room.roomID,"DELETE",t)})),this.userList=c):(this.userList=c,0!==c.length&&this.onUserStateUpdate(this.room.roomID,"ADD",c)),this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.userTempList=[],this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" call success user_list "+c+" count "+c.length)}},e.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" call"),this.stateCenter.userStateUpdate)if(this.userSeq!==e.body.user_list_seq)if(this.userSeq+e.body.user_actions.length===e.body.user_list_seq){this.userSeq=e.body.user_list_seq;var t,r,o=[];if("PRIVATE"==this.stateCenter.type){t=0,r=1;for(var i=0;i<e.body.user_actions.length;i++){var n={action:e.body.user_actions[i].action,idName:e.body.user_actions[i].user_id,nickName:e.body.user_actions[i].user_name,role:e.body.user_actions[i].role,loginTime:e.body.user_actions[i].login_time};o.push(n)}}else{for(t=1,r=2,i=0;i<e.body.user_actions.length;i++)n={action:e.body.user_actions[i].Action,idName:e.body.user_actions[i].IdName,nickName:e.body.user_actions[i].NickName,role:e.body.user_actions[i].Role,loginTime:e.body.user_actions[i].LoginTime},o.push(n);this.stateCenter.actionListener("_userStateUpdate",e.body.room_id,o)}var a=[],c=[];o.forEach((function(e){e.action==t?a.push({userID:e.idName,userName:e.nickName,role:e.role}):e.action==r&&c.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList&&(this.userList=this.userList.concat(a).filter((function(e){return!c.some((function(t){return t.userID==e.userID}))}))),0!==a.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"ADD",a),0!==c.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"DELETE",c),this.logger.info(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" call success")}else this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else this.logger.warn(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" user_list_seq is the same with local seq");else this.logger.info(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" userStateUpdate is false")},e.prototype.onUserStateUpdate=function(e,t,r){var o=this,n=i.getReportSeq();this.dataReport.newReport(n,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.event);var s=r.filter((function(e){return e.userID!==o.stateCenter.idName}));0!=s.length&&("PRIVATE"!==this.stateCenter.type&&(s=s.map((function(e){return{userID:e.userID,userName:e.userName}}))),this.stateCenter.actionListener("roomUserUpdate",e,t,s),this.dataReport.addMsgInfo(n,{user_update_type:"ADD"==t?a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("added"):a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("deleted")}),this.dataReport.uploadReport(n))},e.prototype.mergeUserByUserSeq=function(e,t){var r=this;this.userSeqMergeMap||(this.logger.warn(s.ZEGO_RTM_ACTION.USER_MERGE_SEQ+" new merge userlist "+this.userSeq+" server "+e),this.userSeqMergeMap={},this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){r.handleMergeTimeout()}),this.userListMergeInterval)),this.userSeqMergeMap[e]=t,this.logger.warn(s.ZEGO_RTM_ACTION.USER_MERGE_SEQ+"  merge userlist "+this.userSeq+" server "+e+" userlist "+t.length)},e.prototype.mergeUser=function(e){var t=this;this.logger.info(s.ZEGO_RTM_ACTION.USER_MERGE+" merge userlist "+this.userSeq+" userSeqList "+e.join(",")),this.userSeq=e[e.length-1],this.lastUserQueryTime=Date.now()+this.userListInterval;var r={};e.forEach((function(e){t.userSeqMergeMap&&t.userSeqMergeMap[e].forEach((function(e){r[e.IdName]=e}))})),this.userSeqMergeMap=null;var o=Object.values(r).map((function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):""}}));o.sort((function(e,t){return e.loginTime.localeCompare(t.loginTime)}));var i=[],n=[];o.forEach((function(e){1==e.action?i.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&n.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList=this.userList&&this.userList.concat(i).filter((function(e){return!n.some((function(t){return t.userID==e.userID}))})),0!==i.length&&this.onUserStateUpdate(this.room.roomID,"ADD",i),0!==n.length&&this.onUserStateUpdate(this.room.roomID,"DELETE",n),this.stateCenter.actionListener("_userStateUpdate",this.room.roomID,o)},e.prototype.handleMergeTimeout=function(){var e=this,t=Object.keys(this.userSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));if(t[t.length-1]-t[0]+1===t.length||t[t.length-1]>=this.minUserSeq)this.mergeUser(t);else{this.userSeqMergeMap=null;var r=this.lastUserQueryTime-Date.now();this.logger.info(s.ZEGO_RTM_ACTION.USER_MERGE_TIMEOUT+"  fetch merge userlist "+this.userSeq+" userSeqList "+t.join(",")+" wait "+r),r>0?(this.userQueryTimer&&clearTimeout(this.userQueryTimer),this.userQueryTimer=setTimeout((function(){e.fetchUserList()}),r)):this.fetchUserList()}},e.prototype.loginPrivateRsp=function(e){this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER," userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList()},e.prototype.handleFetchUserListPrivateRsp=function(e){if(this.logger.debug(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" call"),e.body.code&&0!==e.body.code)return this.userQuerying=!1,void this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" fetch error "+e.body.code+" "+e.body.message);if(this.stateCenter.userStateUpdate){this.userTempList=o(this.userTempList,e.body.users),this.userSeq=e.body.userlist_seq,this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" set user Seq "+this.userSeq);for(var t=[],r=0;r<this.userTempList.length;r++){var i={userID:this.userTempList[r].user_id,userName:this.userTempList[r].user_name,role:this.userTempList[r].role};t.push(i)}this.userQuerying=!1,this.onUserStateUpdate(this.room.roomID,"ADD",t),this.userTempList=[],this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" call success user_list "+t+" count "+t.length)}},e}();t.UserHandler=c},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<r;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,i++)o[i]=n[s];return o};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomService=void 0;var n=r(0),s=r(11),a=r(2),c=r(1),d=function(){function e(e,t){this.stateCenter=e,this.logger=t,this.service=new s.ZegoSocketService(this.stateCenter.ENV),this.cmdSeq=0,this.responseRouters={}}return e.prototype.checkResponse=function(e){return e.header.appid!==this.stateCenter.appid||e.header.user_id!==this.stateCenter.userid},e.prototype.handleSendCommandMsgRsp=function(e){var t=this,r=this.service.sendCommandMap[e.header.seq];if(null!=r){var o=r._data;delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(r),0===e.body.err_code?setTimeout((function(){o&&null!=o.success&&o.success(e,t.cmdSeq)}),0):setTimeout((function(){o&&null!=o.error&&o.error(e,t.cmdSeq)}),0)}},e.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){t instanceof ArrayBuffer?e.stateCenter.actionListener("_protobufResponse",t):t.header?(0!==t.body.err_code?t.body.err_message&&e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", err_code="+t.body.err_code+", err_message="+t.body.err_message+" "):e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", msg="+JSON.stringify(t)+" "),["login","logout"].indexOf(t.header.cmd)>-1?e.handleSendCommandMsgRsp(t):e.checkResponse(t)?e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  check session fail."):(e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+",function="+!!e.responseRouters[t.header.cmd]),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq))):e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" msg type error ")}},e.prototype.handlePushKickout=function(e){var t,r,o,n;if((null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.protocol)&&1!=(null===(r=null==e?void 0:e.body)||void 0===r?void 0:r.protocol)){var s=null===(o=null==e?void 0:e.header)||void 0===o?void 0:o.room_id,c=this.stateCenter.roomModulesList.find((function(e){return e.roomID==s}));if(!c)return void this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(null===(n=e.header)||void 0===n?void 0:n.room_id));c.roomHandler.handlePushKickout(e)}else i(this.stateCenter.roomModulesList).forEach((function(t){return t.roomHandler.handlePushKickout(e,!0)}))},e.prototype.handlePushCustomMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find((function(e){return e.roomID==r}));o?o.messageHandler.handlePushCustomMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushRoomMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find((function(e){return e.roomID==r}));o?o.messageHandler.handlePushRoomMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushUserStateUpdateMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find((function(e){return e.roomID==r}));o?o.userHandler.handlePushUserStateUpdateMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushMergeMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find((function(e){return e.roomID==r}));o?o.messageHandler.handlePushMergeMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushTransMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find((function(e){return e.roomID==r}));o?o.messageHandler.handlePushTransMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handleBigImMsgRsp=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find((function(e){return e.roomID==r}));o?o.messageHandler.handleBigImMsgRsp(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushSignalMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find((function(e){return e.roomID==r}));o?o.liveHandler.handlePushSignalMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.closeHandler=function(e){this.service.closeHandler(e)},e.prototype.openHandler=function(e){this.service.openHandler(e)},e.prototype.errorHandler=function(e){this.service.errorHandler(e)},e.prototype.getHeader=function(e,t,r,o){return{Protocol:"V1"===n.ROOMVERSION?"req":"req_v2",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:t||"",room_id:r||"",room_session_id:o||"",biz_version:this.stateCenter.bizVersion||""}},e.prototype.startCheck=function(){this.service.startCheck()},e.prototype.stopCheck=function(){this.service.stopCheck()},e.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},e.prototype.createSocket=function(e){var t=this;this.service.createSocket(e),this.responseRouters=o(o({},this.responseRouters),{push_kickout:function(e){t.handlePushKickout(e)},push_custommsg:function(e){t.handlePushCustomMsg(e)},push_im_chat:function(e){t.handlePushRoomMsg(e)},push_userlist_update:function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)}})},e.prototype.closeSocket=function(){this.service.closeSocket()},e.prototype.sendMessage=function(e,t,r,o,i,n){var s,d,l;if(this.service.isDisConnect())return this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_SEND+" socket is disconnect"),o(c.errorCodeList.SOCKET_CLOSE),0;var u=(null==n?void 0:n.roomID)?n.roomID:null===(s=this.stateCenter.roomModulesList[0])||void 0===s?void 0:s.roomID,h=(null==n?void 0:n.roomSessionID)?n.roomSessionID:null===(d=this.stateCenter.roomModulesList[0])||void 0===d?void 0:d.roomSessionID,p=(null==n?void 0:n.sessionID)?n.sessionID:null===(l=this.stateCenter.roomModulesList[0])||void 0===l?void 0:l.sessionID,f=i||this.getHeader(e,p,u,h);return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:f,body:t})),this.service.sendMessage(f,t,r,o)},e.prototype.on=function(e,t){this.responseRouters[e]=t},e.prototype.login=function(e,t,r){var o=this.getHeader(e.isMulti?"enter":"login",e.sessionID,e.roomID,e.roomSessionID),i={id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:e.token,version:this.stateCenter.sdKVersion,room_name:e.roomID,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:0===this.stateCenter.ENV?n.E_CLIENT_TYPE.ClientType_Webrtc:n.E_CLIENT_TYPE.ClientType_SmallProgram,third_token:e.thirdToken,user_count_limit:this.stateCenter.maxMemberCount,relate_service:this.stateCenter.relateService.join()||"",login_logic:this.stateCenter.isMultiRoom?3:1,proto_format:this.stateCenter.protoFormat};return this.sendMessage("",i,t,r,o)},e.prototype.logout=function(e,t,r){var o=e.isMulti?"quit":"logout",i={reserve:0};return"logout"==o&&(i.login_logic=this.stateCenter.isMultiRoom?3:1),this.sendMessage(o,i,t,r,void 0,{sessionID:e.sessionID,roomID:e.roomID,roomSessionID:e.roomSessionID})},e.prototype.heartBeat=function(e,t,r,o,i){return this.sendMessage("hb",{reserve:0},e,t,void 0,{sessionID:r,roomID:o,roomSessionID:i})},e.prototype.fetchUserList=function(e,t,r,o,i,n){return this.sendMessage("user_list",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.fetchUserListV2=function(e,t,r,o,i,n){return this.sendMessage("user_list_v2",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.fetchReliableMessage=function(e,t,r,o,i,n){return this.sendMessage("trans_fetch",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendReliableMessage=function(e,t,r,o,i,n){return this.sendMessage("trans",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendRoomMsg=function(e,t,r,o,i,n){return this.sendMessage("im_chat",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendCustomCommand=function(e,t,r,o,i,n){return this.sendMessage("custommsg",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendBigRoomMessage=function(e,t,r,o,i,n){return this.sendMessage("bigim_chat",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendRelayMessage=function(e,t,r,o,i,n){return this.sendMessage("relay",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendSignalCmd=function(e,t,r,o,i,n){return this.sendMessage("signal",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendPB=function(e){return this.service.isDisConnect()?(this.logger.error(a.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" socket is disconnected"),!1):this.service.sendPB(e)},e}();t.LiveRoomService=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSocketService=void 0;var o=r(0),i=r(1),n=function(){function e(e){this.socket=null,this.sendCommandList=new o.LinkedList,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.ENV=e}return e.prototype.createSocket=function(e){this.socket=o.createZegoWebSocket(e,this.ENV%2)},e.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},e.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},e.prototype.sendMessage=function(e,t,r,o,i){void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i={timeOut:6e3});var n={header:e,body:t},s={data:n,seq:e.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:i.timeOut,success:r,error:o},a=this.sendCommandList.push(s);return this.sendCommandMap[s.seq]=a,this.socket&&this.socket.send(JSON.stringify(n)),e.seq},e.prototype.sendPB=function(e){return this.socket&&this.socket.send(e),!0},e.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data&&t._data.error&&setTimeout((function(){t&&t._data&&t._data.error&&t._data.error(i.errorCodeList.TIMEOUT,t._data.data.header.seq,t._data.data.body.custom_msg)}),0),t=e.getFirst()},e.prototype.checkMessageListTimeout=function(e,t){for(var r=e.getFirst(),o=Date.parse(new Date+""),n=0;!(null==r||r._data&&r._data.sendTime+r._data.timeOut>o||(r._data&&delete t[r._data.data.header.seq],e.remove(r),r._data&&null==r._data.error||r._data&&r._data.sendTime+this.sendDataDropTimeout<o||setTimeout((function(){r&&r._data&&r._data.error&&r._data.error(i.errorCodeList.TIMEOUT,r._data.data.header.seq,r._data.data.body.custom_msg)}),0),++n>=this.sendDataCheckOnceCount));)r=e.getFirst()},e.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},e.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},e.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(r){t.socket.binaryType="arraybuffer",t.responseHandler(),e(r)})},e.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){var r="string"==typeof t.data?JSON.parse(t.data):t.data;e.onMessage(r)})},e.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},e.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},e.prototype.onMessage=function(e){},e}();t.ZegoSocketService=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=t.ZegoDataReport=t.ZegoLogger=t.getSeq=t.getReportSeq=t.ZegoExpressWebRTMEngine=void 0;var o=r(13);Object.defineProperty(t,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return o.ZegoExpressWebRTM}});var i=r(0),n=function(){function e(t,r,n){void 0===n&&(n=0),this.logger=new i.ZegoLogger(n),this.dataReport=new i.ZegoDataReport(this.logger),this.zegoWebRTM=new o.ZegoExpressWebRTM(t,r,this.logger,this.dataReport,e.version,n)}return e.prototype.enableMultiRoom=function(e){return this.zegoWebRTM.enableMultiRoom(e)},e.prototype.loginRoom=function(e,t,r,o){return this.zegoWebRTM.loginRoom(e,t,r,o)},e.prototype.logoutRoom=function(e){return this.zegoWebRTM.logoutRoom(e)},e.prototype.renewToken=function(e,t){return this.zegoWebRTM.renewToken(e,t)},e.prototype.sendBarrageMessage=function(e,t){return this.zegoWebRTM.sendBarrageMessage(e,t)},e.prototype.sendBroadcastMessage=function(e,t){return this.zegoWebRTM.sendBroadcastMessage(e,t)},e.prototype.sendCustomCommand=function(e,t,r){return this.zegoWebRTM.sendCustomCommand(e,t,r)},e.prototype.setRoomExtraInfo=function(e,t,r){return this.zegoWebRTM.setRoomExtraInfo(e,t,r)},e.prototype.setLogConfig=function(e){return this.zegoWebRTM.setLogConfig(e)},e.prototype.setDebugVerbose=function(e){return this.zegoWebRTM.setDebugVerbose(e)},e.prototype.on=function(e,t){return this.zegoWebRTM.on(e,t)},e.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},e.prototype.off=function(e,t){return this.zegoWebRTM.off(e,t)},e.prototype.loginHall=function(e,t,r){return this.zegoWebRTM.loginHall(e,t,r)},e.prototype.logoutHall=function(){return this.zegoWebRTM.logoutHall()},e.prototype.enterRoom=function(e,t){return this.zegoWebRTM.enterRoom(e,t)},e.prototype.leaveRoom=function(){return this.zegoWebRTM.leaveRoom()},e.version=i.PROTO_VERSION,e}();t.ZegoExpressWebRTMEngine=n;var s=r(0);Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return s.getReportSeq}}),Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return s.getSeq}}),Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return s.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return s.ZegoDataReport}})},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<r;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,i++)o[i]=n[s];return o};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=void 0;var s=r(0),a=r(1),c=r(3),d=r(0),l=r(16),u=r(17),h=r(18),p=r(19),f=r(21),g=r(2),m=r(4),_=r(24),v=r(10),E=r(25),y=function(){function e(e,t,r,o,i,n){this.logger=r,this.dataReport=o,this.version=i,this.stateCenter=new h.StateCenter(this.logger,this.dataReport),this.stateCenter.ENV=n;var a=d.getReportSeq();if(this.dataReport.newReport(a),(0==n||1==n)&&this.setDebug(t),c.ClientUtil.checkConfigParam(e,t,this.logger)){if(this.stateCenter.appid=e,this.stateCenter.configOK=!0,this.stateCenter.sdKVersion=this.version,0==n||1==n?("string"==typeof t?(this.stateCenter.server=t,this.stateCenter.serverBak=t):Array.isArray(t)&&t.length>0&&(this.stateCenter.server=t[0],this.stateCenter.serverBak=t[1]||t[0]),this.service=new v.LiveRoomService(this.stateCenter,this.logger)):2!=n&&3!=n||(this.service=new E.LiveRoomPrivateService(this.stateCenter,this.logger),this.module=new f.LiveRoomModules(this.stateCenter,this.logger,this.dataReport,this.service),this.stateCenter.priModules=this.module,this.module.dispatchServer=t,this.stateCenter.type="PRIVATE"),0==n||2==n)this.bindWindowListener(),this.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  "+navigator.appVersion),this.stateCenter.networkState=navigator?navigator.onLine?s.ENUM_NETWORK_STATE.online:s.ENUM_NETWORK_STATE.offline:s.ENUM_NETWORK_STATE.online,this.dataReport.addMsgInfo(a,{system_info:m.ZegoRTMLogEvent.kZegoTaskInitSetting.system_info});else if(1==n||3==n){this.bindWxListener();try{var l=wx.getSystemInfoSync(),u={brand:l.brand,model:l.model,system:l.system,platform:l.platform,version:l.version,SDKVersion:l.SDKVersion};this.dataReport.addMsgInfo(a,{system_info:u})}catch(e){this.logger.warn(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" get system info error")}}this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version)}else this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" init sdk error"),this.dataReport.addMsgInfo(a,m.ZegoRTMLogEvent.kZegoTaskInitSetting.error.kInvalidParamError);this.dataReport.uploadReport(a,m.ZegoRTMLogEvent.kZegoTaskInitSetting.event)}return Object.defineProperty(e.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),e.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),r=c.ClientUtil.getBrowser(),o=t?"pagehide":"Firefox"===r?"beforeunload":"unload";window.addEventListener(o,(function(){e.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" "+o),"PUBLIC"===e.stateCenter.type?e.logoutRoom():(e.leaveRoom(),e.logoutHall()),e.logoutRoom()})),window.addEventListener("offline",(function(){e.netOffLineHandle()})),window.addEventListener("online",(function(){e.netOnLineHandle()}))},e.prototype.bindWxListener=function(){var e=this;wx.onNetworkStatusChange((function(t){t.isConnected?e.netOnLineHandle():e.netOffLineHandle()}))},e.prototype.netOnLineHandle=function(){var e=this;this.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+"network is online"),this.stateCenter.networkState=s.ENUM_NETWORK_STATE.online,this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.service.isDisConnect()?t.roomTryHandler.active():t.roomTryHandler&&(t.roomTryHandler.stopMaxTime(),t.roomHandler.roomStateHandle("CONNECTED",{code:0,msg:""}))}))},e.prototype.netOffLineHandle=function(){this.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" network is broken"),this.stateCenter.networkState=s.ENUM_NETWORK_STATE.offline,this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.onactive=function(t,r){e.roomHandler.disconnectedHandle(r)},e.roomTryHandler.startMaxTime(),e.roomHandler.roomStateHandle("CONNECTING",a.errorCodeList.NETWORK_BROKEN))}))},e.prototype.setLogConfig=function(e){this.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call");var t=d.getReportSeq();if(this.dataReport.newReport(t),e.logLevel&&["debug","info","warn","error","report","disable"].includes(e.logLevel)&&(this.logger.setLogLevel(e.logLevel),this.dataReport.addMsgInfo(t,{log_level:m.ZegoRTMLogEvent.kZegoTaskSetLog.log_level(e.logLevel)})),e.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(e.remoteLogLevel)&&(this.logger.setRemoteLogLevel(e.remoteLogLevel),this.dataReport.addMsgInfo(t,{remote_log_level:m.ZegoRTMLogEvent.kZegoTaskSetLog.remote_log_level(e.remoteLogLevel)})),"string"==typeof e.logURL&&(e.logURL.startsWith("wss://")||e.logURL.startsWith("https://")))this.logger.setLogServer(e.logURL),this.dataReport.addMsgInfo(t,{log_url:m.ZegoRTMLogEvent.kZegoTaskSetLog.log_url(e.logURL)}),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskSetLog.event);else if(e.logURL)return this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+"log url must be a wss or https url"),this.dataReport.addMsgInfo(t,m.ZegoRTMLogEvent.kZegoTaskSetLog.error.kInvalidParamError),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskSetLog.event),!1;return this.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call success"),!0},e.prototype.setDebugVerbose=function(e){var t=d.getReportSeq();this.dataReport.newReport(t),"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,this.dataReport.addMsgInfo(t,{debug:m.ZegoRTMLogEvent.kZegoTaskSetDebug.debug(e?"true":"false")})),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskSetDebug.event),this.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE+" call success")},e.prototype.setDebug=function(e){"string"==typeof e&&e.indexOf("wss")>-1?this.stateCenter.debug=c.ClientUtil.isTestEnv(e):Array.isArray(e)&&e.length>0&&e.every((function(e){return"string"==typeof e&&e.indexOf("wss")>-1}))?this.stateCenter.debug=c.ClientUtil.isTestEnv(e[0])||c.ClientUtil.isTestEnv(e[1]):this.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" server wrong"),this.stateCenter.testEnvironment=this.stateCenter.debug},e.prototype.renewToken=function(e,t){var r,o=d.getReportSeq();if(this.dataReport.newReport(o),void 0!==t&&("string"!=typeof t||""==t))return this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" roomID must be string and no empty"),!1;var i=this.getRoomModules(t)||this.stateCenter.roomModulesList[0];return i?"string"==typeof e&&i.roomTryHandler?(null===(r=i.roomTryHandler)||void 0===r||r.renewToken(e),this.dataReport.uploadReport(o,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!0):"string"!=typeof e||i.roomTryHandler?(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" token must be string and not empty"),this.dataReport.addMsgInfo(o,{error:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.code,message:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.msg+" param token error"}),this.dataReport.uploadReport(o,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(o,{error:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(o,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(o,{error:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(o,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1)},e.prototype.loginRoom=function(e,t,r,a){var c=this;return new Promise((function(d,h){return o(c,void 0,void 0,(function(){var o,c,f,_,v,E=this;return i(this,(function(i){switch(i.label){case 0:return 1!==this.stateCenter.ENV?[3,2]:[4,new Promise((function(e){wx.getNetworkType({success:function(t){E.stateCenter.networkState="none"===t.networkType?s.ENUM_NETWORK_STATE.offline:s.ENUM_NETWORK_STATE.online,e()},fail:function(t){E.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" network "+JSON.stringify(t)),E.stateCenter.networkState=s.ENUM_NETWORK_STATE.online,e()}})}))];case 1:i.sent(),i.label=2;case 2:return o=this.loginReport(d,h,t,a),c=o.interResolve,f=o.interReject,!(a=a||{}).maxMemberCount&&(a.maxMemberCount=0),(_=u.checkParams({roomID:{order:0,value:e,rules:[{name:u.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_NULL},{name:u.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:"roomID must be string"},{name:u.RULE_PARAM_NAME.MAX_LENGTH_128,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_TOO_LONG},{name:u.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:t,rules:[{name:u.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM},{name:u.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM}]},user:{order:2,value:r,rules:[{name:u.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."},{name:u.RULE_PARAM_NAME.TYPE_OBJECT,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:r.userID,rules:[{name:u.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_NULL,extMsg:" param user error."},{name:u.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param userID error."},{name:u.RULE_PARAM_NAME.MAX_LENGTH_100,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_TOO_LONG},{name:u.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:r.userName,rules:[{name:u.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" userName must be string."},{name:u.RULE_PARAM_NAME.MAX_LENGTH_256,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_NAME_TOO_LONG}]},config:{order:5,value:a,rules:[]},"config.maxMemberCount":{order:6,value:a.maxMemberCount,rules:[{name:u.RULE_PARAM_NAME.TYPE_INTEGER,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM,logger:this.logger}))!==u.RULE_SUCCESS?(f(_.error,_.extMsg),[2]):(v=this.getRoomModules(e))?(f(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.REPEATEDLY_LOGIN),[2]):(v=new p.LiveRoomModules(e,this.stateCenter,this.logger,this.dataReport,this.service),this.stateCenter.roomModulesList.length>0&&1==this.stateCenter.isMultiRoom?v.isMulti=!0:n(this.stateCenter.roomModulesList).forEach((function(e){return e.roomHandler.logout()})),this.stateCenter.roomModulesList.push(v),v.roomTryHandler||(v.roomTryHandler=new l.RetryRoomHandler(this.logger,this.stateCenter,v)),v.roomTryHandler.init(this.stateCenter.roomRetryTime),v.roomTryHandler.initRoom(v.roomHandler,e,t,r,this.stateCenter.server,this.stateCenter.serverBak,a),v.roomTryHandler.setLoginRoomCallback(c,f),v.roomTryHandler.active(!0),this.stateCenter.setMultiRoom=!0,[2])}}))}))}))},e.prototype.loginReport=function(e,t,r,o){var i=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,c.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.stateCenter.reportList));var n=d.getReportSeq();return this.stateCenter.reportSeqList.login=n,this.dataReport.newReport(n,m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event),"string"==typeof r&&this.dataReport.addMsgInfo(n,{token:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.token(r),isMulti:this.stateCenter.isMultiRoom}),o&&(o.userUpdate&&"boolean"==typeof o.userUpdate&&this.dataReport.addMsgInfo(n,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.user_update(o.userUpdate+"")}),o.maxMemberCount&&"number"==typeof o.maxMemberCount&&this.dataReport.addMsgInfo(n,{max_member_count:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.max_member_count(o.maxMemberCount+"")})),c.ClientUtil.logReportCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.dataReport,n,this.stateCenter.reportList),{interResolve:function(t){i.dataReport.uploadReport(n),i.stateCenter.reportSeqList.login=0,c.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,i.stateCenter.reportList),e(t)},interReject:function(e,r){var o,s;void 0===r&&(r=""),e.code<2e9&&e.code>1e9||e.code<1e6?(o=c.ClientUtil.decodeServerError(e.code,e.msg),s=c.ClientUtil.getLiveRoomError(e.code)):o={code:e.code,message:e.msg},o&&i.dataReport.addMsgInfo(n,{error:o.code,message:o.message+r}),i.dataReport.uploadReport(n),i.stateCenter.reportSeqList.login=0,c.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,i.stateCenter.reportList),s&&a.errorCodeList[s]&&(e.code=a.errorCodeList[s].code),e.code&&e.msg&&""!==r?t({code:e.code,msg:e.msg+r}):t(e)}}},e.prototype.logoutRoom=function(e){var t=d.getReportSeq();if(this.dataReport.newReport(t),this.dataReport.addMsgInfo(t,{roomid:e,isMulti:this.stateCenter.isMultiRoom}),void 0===e)n(this.stateCenter.roomModulesList).forEach((function(e){return e.roomHandler.logout(!0)}));else{if("string"!=typeof e||""==e)return this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" roomID must be string and not empty"),this.dataReport.addMsgInfo(t,{error:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.code,message:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.msg+" param roomID error"}),void this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event);var r=this.getRoomModules(e);r?(r.roomHandler.logout(),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event)):(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" room not exist"),this.dataReport.addMsgInfo(t,{error:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.code,message:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.msg}),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event))}},e.prototype.loginHall=function(e,t,r){var n=this;return new Promise((function(a,c){return o(n,void 0,void 0,(function(){var o,n,d,l,u=this;return i(this,(function(i){switch(i.label){case 0:return 3!==this.stateCenter.ENV?[3,2]:[4,new Promise((function(e){wx.getNetworkType({success:function(t){u.stateCenter.networkState="none"===t.networkType?s.ENUM_NETWORK_STATE.offline:s.ENUM_NETWORK_STATE.online,e()},fail:function(t){u.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" network "+JSON.stringify(t)),u.stateCenter.networkState=s.ENUM_NETWORK_STATE.online,e()}})}))];case 1:i.sent(),i.label=2;case 2:return o=this.loginHallReport(a,c,e,r),n=o.interResolve,d=o.interReject,r=r||{},"string"!=typeof e||""==e?(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" token format error"),d(m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM,"token format error"),[2]):"object"!=typeof t||"string"!=typeof t.userID||"string"!=typeof t.userName?(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" user error"),d(m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," user error"),[2]):"object"!=typeof r||"string"!=typeof r.deviceID?(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" deviceID error"),d(m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," deviceID error"),[2]):"object"!=typeof r||"string"!=typeof r.deviceType?(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" deviceType error"),d(m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," deviceType error"),[2]):"object"!=typeof r||1!==r.anType&&0!==r.anType?(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" anType error"),d(m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," anType error"),[2]):((l=this.module).hallToken=e,l.deviceID=r.deviceID,l.deviceType=r.deviceType,l.anType=r.anType,this.stateCenter.idName=t.userID,this.stateCenter.nickName=t.userName||t.userID,this.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+JSON.stringify(r)),r&&"boolean"==typeof r.roomFlag&&(r.roomFlag?l.roomFlag=1:l.roomFlag=0),r&&"boolean"==typeof r.testEnvironment&&(this.stateCenter.testEnvironment=r.testEnvironment),r&&"boolean"==typeof r.userUpdate&&(this.stateCenter.userStateUpdate=r.userUpdate),l.hallRunState!==s.ENUM_RUN_STATE.logout&&(l.hallHandler.resetHall(),l.hallHandler.hallStateHandle("DISCONNECTED",m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.REPEATEDLY_LOGIN),l.setRoomRunState(s.ENUM_RUN_STATE.logout),l.roomPrivateHandler.resetRoom()),this.dispatchServer((function(){l.retryHallHandler||(l.retryHallHandler=new _.RetryHallHandler(u.logger,u.stateCenter,u.module)),l.retryHallHandler.init(u.stateCenter.roomRetryTime),l.retryHallHandler.initRoom(u.module.hallHandler,t,u.stateCenter.server,r),l.retryHallHandler.onactive=function(e,t){e?n(e):d(t)},l.retryHallHandler.active(!0)})),[2])}}))}))}))},e.prototype.loginHallReport=function(e,t,r,o){var i=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,c.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.stateCenter.reportList));var n=d.getReportSeq();return this.stateCenter.reportSeqList.login=n,this.dataReport.newReport(n,m.ZegoRTMLogEvent.kZegoTaskLoginHall.event),"string"==typeof r&&this.dataReport.addMsgInfo(n,{token:m.ZegoRTMLogEvent.kZegoTaskLoginHall.token(r)}),o&&(o.userUpdate&&"boolean"==typeof o.userUpdate&&this.dataReport.addMsgInfo(n,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.user_update(o.userUpdate+"")}),o.deviceID&&"string"==typeof o.deviceID&&this.dataReport.addMsgInfo(n,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.device_id(o.deviceID)}),o.deviceType&&"string"==typeof o.deviceType&&this.dataReport.addMsgInfo(n,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.device_type(o.deviceType)}),o.anType&&"number"==typeof o.anType&&this.dataReport.addMsgInfo(n,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.an_type(o.anType+"")}),o.roomFlag&&"boolean"==typeof o.roomFlag&&this.dataReport.addMsgInfo(n,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.room_flag(o.roomFlag+"")}),o.testEnvironment&&"boolean"==typeof o.testEnvironment&&this.dataReport.addMsgInfo(n,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.test_environment(o.testEnvironment+"")})),c.ClientUtil.logReportCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.dataReport,n,this.stateCenter.reportList),{interResolve:function(t){i.dataReport.uploadReport(n),i.stateCenter.reportSeqList.login=0,c.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,i.stateCenter.reportList),e(t)},interReject:function(e,r){void 0===r&&(r=""),i.dataReport.addMsgInfo(n,{error:e.code,message:e.msg+r}),i.dataReport.uploadReport(n),i.stateCenter.reportSeqList.login=0,c.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,i.stateCenter.reportList),t({code:e.code,msg:e.msg+r})}}},e.prototype.logoutHall=function(){var e=d.getReportSeq();this.dataReport.newReport(e),this.module.hallHandler.logout(),this.module.setRoomRunState(s.ENUM_RUN_STATE.logout),this.module.roomPrivateHandler.resetRoom(),this.dataReport.uploadReport(e,m.ZegoRTMLogEvent.kZegoTaskLogoutHall.event)},e.prototype.enterRoom=function(e,t){var r=this;return new Promise((function(o,i){var n=d.getReportSeq();if(r.dataReport.newReport(n),"string"!=typeof e||""==e||![0,1].includes(t))return r.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" param error"),void o({errorCode:m.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.INPUT_PARAM.code,extendedData:m.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.INPUT_PARAM.msg});var a=r.module;if(!a.isLogin())return r.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" no login hall before entering room"),void o({errorCode:m.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.NOT_LOGIN.code,extendedData:m.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.NOT_LOGIN.msg});a.runRoomState!==s.ENUM_RUN_STATE.logout&&(r.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" reset"),r.module.roomPrivateHandler.resetRoom(),r.module.roomPrivateHandler.roomStateHandle("DISCONNECTED",m.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.REPEATEDLY_ENTER_ROOM)),a.pri_roomID=e,r.stateCenter.role=t,r.dataReport.addMsgInfo(n,{role:m.ZegoRTMLogEvent.kZegoTaskEnterRoom.role(t+"")}),a.setRoomRunState(s.ENUM_RUN_STATE.trylogin),a.roomPrivateHandler.roomStateHandle("CONNECTING",{code:0,msg:""});var c=function(t,c){if(t.body&&0!==t.body.code||1100002==t.code){a.setRoomRunState(s.ENUM_RUN_STATE.logout);var d=t.body&&t.body.code||t.code,l=t.body&&t.body.message||t.msg;a.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:d,msg:l}),r.dataReport.addMsgInfo(n,{error:d,message:l}),r.dataReport.uploadReport(n,m.ZegoRTMLogEvent.kZegoTaskEnterRoom.event),i({errorCode:d,extendedData:l})}else a.roomID=e,a.timeStamp=t.header.timeStamp,a.roomSid=t.body.room_header.room_sid,a.roomSessionID=t.body.room_header.room_user_session_id,a.userSeq=t.body.userlist_seq,r.dataReport.uploadReport(n,m.ZegoRTMLogEvent.kZegoTaskEnterRoom.event),a.setRoomRunState(s.ENUM_RUN_STATE.login),a.roomPrivateHandler.roomStateHandle("CONNECTED",{code:0,msg:""}),r.module.userHandler.loginPrivateRsp(t),a.roomLoginResponse(t),o({errorCode:0,extendedData:""})};setTimeout((function(){a.roomPrivateHandler.enterRoom(c,c)}),20)}))},e.prototype.leaveRoom=function(){var e=this;return new Promise((function(t){var r=d.getReportSeq();e.dataReport.newReport(r),e.module.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:0,msg:""});var o=function(o,i){0!==o.body.code?(e.dataReport.addMsgInfo(r,{error:o.body.code,message:o.body.message}),e.dataReport.uploadReport(r,m.ZegoRTMLogEvent.kZegoTaskLeaveRoom.event),t({errorCode:o.body.code,extendedData:o.body.message})):(e.dataReport.uploadReport(r,m.ZegoRTMLogEvent.kZegoTaskLeaveRoom.event),t({errorCode:0,extendedData:""}))};e.module.roomPrivateHandler.leaveRoom(o,o)}))},e.prototype.sendCustomCommand=function(e,t,r){var o=this;return new Promise((function(i,n){o._sendCustomCommand(e,t,r).then((function(e){i({errorCode:e.errorCode,extendedData:e.extendedData})})).catch((function(e){n(e)}))}))},e.prototype._sendCustomCommand=function(e,t,r){var o=this;return new Promise((function(i,n){var l=d.getReportSeq();o.dataReport.newReport(l,m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.event);var u=c.ClientUtil.proxyRes(o.dataReport,l,i,n),h=u.interResolve,p=u.interReject;if("string"!=typeof e||""==e)return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" roomid must be string and not empty"),void p(a.errorCodeList.INPUT_PARAM," param roomID error");if(!(r instanceof Array)||r.find((function(e){return"string"!=typeof e})))return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" dstMembers must be string array"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param toUserList error");if("PUBLIC"===o.stateCenter.type&&"string"!=typeof t&&"object"!=typeof t)return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a non empty string or object"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if("PRIVATE"===o.stateCenter.type&&"string"!=typeof t)return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a not empty string"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if("string"==typeof t&&t.length>s.MAX_MESSAGE_LENGTH)return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" command too long"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.IM_CONTENT_TOO_LONG);var f=o.getRoomModules(e);f?(o.dataReport.addMsgInfo(l,{room_sid:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.room_sid(f.sessionID)}),f.messageHandler.sendCustomCommand(r,t,h,p)):p(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.ROOM_NOT_EXIST)}))},e.prototype.sendBroadcastMessage=function(e,t){var r=this;return new Promise((function(o,i){r._sendBroadcastMessage(e,t).then((function(e){o({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){i(e)}))}))},e.prototype._sendBroadcastMessage=function(e,t,r,o){var i=this;return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(n,a){var l=d.getReportSeq();i.dataReport.newReport(l,m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.event);var u=c.ClientUtil.proxyRes(i.dataReport,l,n,a),h=u.interResolve,p=u.interReject;if("string"!=typeof e||""==e)return i.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(void 0===t||""==t)return i.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message is empty"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_NULL);if("string"!=typeof t)return i.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message must be string"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param message error");if(t.length>s.MAX_MESSAGE_LENGTH)return i.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message too long"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_TOO_LONG);var f=i.getRoomModules(e);f?(i.dataReport.addMsgInfo(l,{room_sid:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.room_sid(f.sessionID)}),f.messageHandler.sendRoomMsg(r,o,e,t,h,p)):p(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.ROOM_NOT_EXIST)}))},e.prototype.setRoomExtraInfo=function(e,t,r){return this._setRoomExtraInfo(e,t,r)},e.prototype._setRoomExtraInfo=function(e,t,r){var o=this;return new Promise((function(i,n){var a=d.getReportSeq();o.dataReport.newReport(a,m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.event);var l=c.ClientUtil.proxyRes(o.dataReport,a,i,n),u=l.interResolve,h=l.interReject;if("string"!=typeof e||""==e)return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void h(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(!t||"string"!=typeof t)return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type must be string"),void h({errorCode:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(t.length>s.MAX_TRANS_TYPE_LENGTH)return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void h({errorCode:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(!r||"string"!=typeof r)return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" data must be string"),void h({errorCode:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(r.length>s.MAX_TRANS_DATA_LENGTH)return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void h({errorCode:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});var p=o.getRoomModules(e);p?(o.dataReport.addMsgInfo(a,{room_sid:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.room_sid(p.sessionID)}),p.messageHandler.sendReliableMessage(t,r,u,h)):h(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.ROOM_NOT_EXIST)}))},e.prototype.sendBarrageMessage=function(e,t){var r=this;return new Promise((function(o,i){r._sendBarrageMessage(e,t).then((function(e){o({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){i(e)}))}))},e.prototype._sendBarrageMessage=function(e,t,r,o){var i=this;return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(n,a){var l=d.getReportSeq();i.dataReport.newReport(l,m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.event);var u=c.ClientUtil.proxyRes(i.dataReport,l,n,a),h=u.interResolve,p=u.interReject;if("string"!=typeof e||""==e)return i.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+"roomid must be string and not empty"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param roomID error");if(void 0===t||""==t)return i.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message is empty"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_NULL);if("string"!=typeof t)return i.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message must be string"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param message error");if(t.length>s.MAX_MESSAGE_LENGTH)return i.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message too long"),void p(m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_TOO_LONG);var f=i.getRoomModules(e);f?(i.dataReport.addMsgInfo(l,{room_sid:m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.room_sid(f.sessionID)}),f.messageHandler.sendBigRoomMessage(r,o,e,t,h,p)):p(m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.ROOM_NOT_EXIST)}))},e.prototype.sendRelayMessage=function(e,t,r,o,i){var n=this.getRoomModules(i)||this.stateCenter.roomModulesList[0];n?n.messageHandler.sendRelayMessage(e,t,r,o):o&&o(a.errorCodeList.ROOM_NOT_EXIST,0)},e.prototype.requestJoinLive=function(e,t,r,o,i){var n=this.getRoomModules(i)||this.stateCenter.roomModulesList[0];return n?n.liveHandler.requestJoinLive(e,t,r,o):(r&&r(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.inviteJoinLive=function(e,t,r,o,i){var n=this.getRoomModules(i)||this.stateCenter.roomModulesList[0];return n?n.liveHandler.inviteJoinLive(e,t,r,o):(r&&r(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.endJoinLive=function(e,t,r,o){var i=this.getRoomModules(o)||this.stateCenter.roomModulesList[0];return i?i.liveHandler.endJoinLive(e,t,r):(r&&r(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.respondJoinLive=function(e,t,r,o,i){var n=this.getRoomModules(i)||this.stateCenter.roomModulesList[0];return n?n.liveHandler.respondJoinLive(e,t,r,o):(o&&o(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.getVersion=function(){return this.version},e.prototype.setSdkBizVersion=function(e){"string"==typeof e&&""!==e&&(this.stateCenter.bizVersion=e)},e.prototype.on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype.off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype._on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype._off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype.isTestEnvironment=function(){return this.stateCenter.testEnvironment},e.prototype.isLogin=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return!!t&&t.isLogin()},e.prototype.getMultiRoom=function(){return this.stateCenter.isMultiRoom},e.prototype.getAppID=function(){return this.stateCenter.appid},e.prototype.getUserID=function(){return this.stateCenter.idName},e.prototype.getToken=function(e){return(this.getRoomModules(e)||this.stateCenter.roomModulesList[0]).token},e.prototype.getAnType=function(){return this.module.anType},e.prototype.getRoomSid=function(){return this.module.roomSid},e.prototype.setRoomCreateFlag=function(e){this.stateCenter.roomCreateFlag=e},e.prototype.setRole=function(e){this.stateCenter.role=e},e.prototype.getSessionId=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return t?t.sessionID:"0"},e.prototype.getRoomSessionID=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return t?t.roomSessionID:"0"},e.prototype.enableMultiRoom=function(e){var t=d.getReportSeq();return this.dataReport.newReport(t,m.ZegoRTMLogEvent.kZegoEnableMultiRoom.event),this.dataReport.addMsgInfo(t,{isMulti:e}),"boolean"!=typeof e?(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" param must be boolean"),this.dataReport.uploadReport(t,void 0,m.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):this.stateCenter.roomModulesList.length>0||this.stateCenter.setMultiRoom?(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" multi room can only be set once before first login"),this.dataReport.uploadReport(t,void 0,m.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):(this.dataReport.uploadReport(t),this.stateCenter.isMultiRoom=e,this.stateCenter.setMultiRoom=!0,!0)},e.prototype.getRoomModules=function(e){return this.stateCenter.roomModulesList.find((function(t){return t.roomID==e}))},e.prototype.dispatchServer=function(e){var t=this;this.logger.info("zc.hh.dc call");var r=this.dispatchBodyData(),o=this.module.dispatchServer;if(c.ClientUtil.actionSuccessCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.stateCenter.reportList)&&c.ClientUtil.actionSuccessCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.stateCenter.reportList)(s.REPORT_ACTION.eventStart,m.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.dispatch_connection.event),XMLHttpRequest){var i=new XMLHttpRequest;i.open("POST",o),i.setRequestHeader("Content-type","application/json; charset=utf-8"),i.onreadystatechange=function(){if(200==i.status&&4==i.readyState&&i.responseText&&""!==i.responseText){var r=JSON.parse(i.responseText);r.server_addrs&&0!==r.server_addrs.length&&(t.stateCenter.server=r.server_addrs[0].replace(":443",""),t.module.sessionExpire=r.session_expire+"",c.ClientUtil.actionSuccessCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,t.stateCenter.reportList)&&c.ClientUtil.actionSuccessCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,t.stateCenter.reportList)(s.REPORT_ACTION.eventEndWithMsgInfo,m.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.dispatch_connection.event,{server:t.stateCenter.server,session_expire:t.module.sessionExpire}),e&&e())}},i.send(JSON.stringify(r))}else wx.request({url:o,header:{"Content-Type":"application/json"},method:"POST",data:JSON.stringify(r),dataType:"json",success:function(r){r.data.server_addrs&&0!==r.data.server_addrs.length&&(t.stateCenter.server=r.data.server_addrs[0].replace(":443",""),t.module.sessionExpire=r.data.session_expire+"",e&&e())},fail:function(e){}})},e.prototype.dispatchBodyData=function(){return{seq:1,timestamp:(new Date).getTime,app_id:this.stateCenter.appid,user_id:this.stateCenter.idName,user_name:this.stateCenter.nickName,net_type:2,device_id:this.module.deviceID,login_token:this.module.hallToken,an_type:this.module.anType}},e.prototype.getRoomBroadcastMessages=function(e,t){var r=this;return new Promise((function(o,i){r.module.messageHandler.getRoomChatInfo(e,t,o,i)}))},e.prototype.sendCustomMessage=function(e,t,r){var o=this;return new Promise((function(i){if(e&&"string"==typeof e&&0===e.length)if(t&&"string"==typeof t)if(r)if(o.module.isLogin()){var n=function(e){if(e.body.code&&0!==e.body.code)return o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" server error=",e.body.code),void i(e);i(e),o.logger.info(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" call success.")};o.module.service.sendMessage(e,r,n,n)}else o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" hallState is not login");else o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" rsbodyDatapCmd error");else o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" rspCmd error");else o.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" reqCmd error")}))},e.prototype.getQueueSimpleList=function(){var e=this;return new Promise((function(t,r){e.sendCustomMessage("zegochat_js.queue_list_req","zegochat_js.queue_list_rsp",{}).then((function(o){o.body.code&&0!==o.body.code?(e.logger.error("zc.gqs.0 get list error, code = "+o.body.code),r({errorCode:o.body.code,extendData:o.body.message})):t({queues:o.body.queues})}))}))},e.prototype.setProtoFormat=function(e){if(void 0===e&&(e="json"),!["json","pb"].includes(e))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.stateCenter.protoFormat=e},e.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))&&(this.stateCenter.relateService=e)},e.prototype.sendMessageByService=function(e,t,r,o,i,n){return this.service.sendMessage(e,t,r,o,i,n)},e.prototype.getHeader=function(e){var t=this.stateCenter.roomModulesList[0];if(t&&t.isLogin()){var r=t.roomID,o=t.sessionID,i=t.roomSessionID;return this.service.getHeader(e,o,r,i)}this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_GET_HEADER+" room no found or no login")},e.prototype.sendPB=function(e){return e instanceof Uint8Array?this.service.sendPB(e):(this.logger.error(g.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" type error"),!1)},e.prototype.onPushBizChannel=function(e){e&&this.service.on("push_biz_channel",e)},e.prototype.getRoomID=function(){return this.stateCenter.roomid},e.prototype.getServerTimeOffset=function(){return this.stateCenter.serverTimeOffset},e}();t.ZegoExpressWebRTM=y},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.E_CLIENT_TYPE=t.ENUM_LOG_LEVEL=t.ENUM_REMOTE_TYPE=t.ZEGO_ENV=t.ZEGO_BROWSER_TYPE=void 0,function(e){e[e.IE=0]="IE",e[e.FIREFOX=1]="FIREFOX",e[e.CHROME=2]="CHROME",e[e.SAFARI=3]="SAFARI",e[e.OPERA=4]="OPERA",e[e.WEIXIN=5]="WEIXIN",e[e.WEIXINMINI=6]="WEIXINMINI",e[e.UNKOWN=7]="UNKOWN"}(t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={})),function(e){e[e.BROWSER=0]="BROWSER",e[e.WEIXINMINI=1]="WEIXINMINI"}(t.ZEGO_ENV||(t.ZEGO_ENV={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.HTTPS=2]="HTTPS"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=void 0;var o=function(){function e(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}return e.getInstance=function(){return e.instance||(e.instance=new e,e.instance.init()),e.instance},e.prototype.init=function(){},Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._ENV},set:function(e){this._ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!1,configurable:!0}),e.instance=new e,e}();t.LoggerStateCenter=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.ZegoWeiXinMiniWebSocket=void 0;var o=r(0),i=function(){function e(e,t){this.url=e,this.readyState=3,this._websocket=wx.connectSocket({url:e}),this.init()}return e.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){"function"==typeof e.onmessage&&e.onmessage(t)})))})),this._websocket.onError((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onerror&&e.onerror(t)})))},e.prototype.onopen=function(e){},e.prototype.onerror=function(e){},e.prototype.onclose=function(e){},e.prototype.onmessage=function(e){},e.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},e.prototype.close=function(){this._websocket&&this._websocket.close()},e}();t.ZegoWeiXinMiniWebSocket=i,t.createZegoWebSocket=function(e,t){return t%2===o.ZEGO_ENV.BROWSER?new WebSocket(e):new i(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=t.createZegoWebSocket=t.ZegoDataReport=t.ZegoLogger=void 0;var o=r(1);Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return o.LoggerStateCenter}});var i=r(2);Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return i.createZegoWebSocket}});var n=r(4);Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return n.ZegoDataReport}});var s=r(5);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return s.ZegoLogger}})},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoDataReport=void 0;var i=function(){function e(e){this.dataStatistics={},this.logger=e}return e.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:"success",event:t,events:[]}},e.prototype.addMsgExt=function(e,t){this.dataStatistics[e]&&(this.dataStatistics[e].msg_ext=t)},e.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]&&Object.assign(this.dataStatistics[e],t)},e.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},e.prototype.eventEnd=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o&&0!==o.length){for(var i=o.length-1;i>=0;i--)if(o[i].event==t&&0==o[i].time_consumed){o[i].time_consumed=Date.now()-o[i].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},e.prototype.eventEndWithMsg=function(e,t,r){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(i){for(var n=i.length-1;n>=0;n--)if(i[n].event==t&&0==i[n].time_consumed){i[n].time_consumed=Date.now()-i[n].event_time,null==i[n].msg_ext&&(i[n].msg_ext={}),i[n].msg_ext=o({},r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.eventEndWithMsgInfo=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o){for(var i=o.length-1;i>=0;i--)if(o[i].event==t&&0==o[i].time_consumed){o[i].time_consumed=Date.now()-o[i].event_time,Object.assign(o[i],r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.addEventInfo=function(e,t,r,o){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(null!=i){for(var n=i.length-1;n>=0;n--)if(i[n].event==t&&null!=i[n].time_consumed){null==i[n].msg_ext?i[n].msg_ext={}:i[n].msg_ext&&(i[n].msg_ext[r]=o);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},e.prototype.addEventMsg=function(e,t,r,o){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(null!=i){for(var n=i.length-1;n>=0;n--)if(i[n].event==t){i[n][r]=o;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},e.prototype.addEvent=function(e,t,r){this.dataStatistics[e]?this.dataStatistics[e].events&&(r?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),msg_ext:r}):this.dataStatistics[e].events.push({event:t,event_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},e.prototype.uploadReport=function(e,t,r,o){var i=this.dataStatistics[e];null!=i&&(t&&(i.event=t),i.time_consumed=Date.now()-i.event_time,r&&this.addMsgInfo(e,{error:r.code,message:r.message||r.msg+" "+(o||"")}),this.logger.report(i),delete this.dataStatistics[e])},e}();t.ZegoDataReport=i},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLogger=void 0;var i=r(0),n=r(2),s=r(1),a=r(6),c=function(){function e(e){this.logLevel=i.ENUM_LOG_LEVEL.INFO,this.logRemoteLevel=0,this.websocket=null,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.stateCenter=s.LoggerStateCenter.getInstance(),this.env=e}return e.prototype.setLogLevel=function(e){var t=i.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logLevel=t,!0)},e.prototype.setRemoteLogLevel=function(e){var t=i.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logRemoteLevel=t,!0)},e.prototype.setSessionInfo=function(e,t,r,o,i,n){this.appid=e,this.roomid=t,this.sessionid=r,this.userid=o,this.userName=i,this.version=n},e.prototype.report=function(e){var t=this.logReportParamList(i.ENUM_LOG_LEVEL.REPORT,e);this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&(this.logLevel,i.ENUM_LOG_LEVEL.REPORT),this.RemoteLog(i.ENUM_LOG_LEVEL.REPORT,t,!0)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.DEBUG,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&(this.logLevel,i.ENUM_LOG_LEVEL.DEBUG),this.log(i.ENUM_LOG_LEVEL.DEBUG,r)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.INFO,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&(this.logLevel,i.ENUM_LOG_LEVEL.INFO),this.log(i.ENUM_LOG_LEVEL.INFO,r)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.WARN,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&(this.logLevel,i.ENUM_LOG_LEVEL.WARN),this.log(i.ENUM_LOG_LEVEL.WARN,r)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.ERROR,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.ERROR&&(window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(i.ENUM_LOG_LEVEL.ERROR,r)},e.prototype.log=function(e,t){this.logRemoteLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logRemoteLevel<=e&&this.RemoteLog(e,t)},e.prototype.setLogServer=function(e){try{return e.startsWith("wss:")?(this.logType=i.ENUM_REMOTE_TYPE.WEBSOCKET,this.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=i.ENUM_REMOTE_TYPE.HTTPS,this.openHttpsLogServer(e)):this.logType=i.ENUM_REMOTE_TYPE.DISABLE,!0}catch(e){return this.error(JSON.stringify(e)),!1}},e.prototype.stopLogServer=function(){this.logType==i.ENUM_REMOTE_TYPE.WEBSOCKET?this.stopWebSocketServer():this.logType==i.ENUM_REMOTE_TYPE.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=i.ENUM_REMOTE_TYPE.DISABLE},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.openHttpsLogServer=function(e){var t=this;this.url=e,e&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){t.SendHttpsLog()}),this.logUploadInterval)))},e.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},e.prototype.RemoteLog=function(e,t,r){if(void 0===r&&(r=!1),""!=this.url)if(this.logType==i.ENUM_REMOTE_TYPE.WEBSOCKET)this.RemoteWebSocketLog(e,t);else if(this.logType==i.ENUM_REMOTE_TYPE.HTTPS)this.RemoteHttpsLog(e,t,r);else if(this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=e)for(this.logCacheSend.push(t);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},e.prototype.RemoteWebSocketLog=function(e,t){if("string"==typeof t&&t.length>4e3);else if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var r=this.url;this.url="",this.setLogServer(r),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var i="",n=0;n<this.logCacheSend.length;n++){(i+this.logCacheSend[n]).length>4e3&&(this.websocket.send(i),i="");var s=JSON.parse(this.logCacheSend[n]);s=o(o({},s),{userid:s.userid||this.userid,roomid:s.roomid||this.roomid,userName:s.roomid||this.userName}),i=i+JSON.stringify(s)+"\n"}t=i+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.RemoteHttpsLog=function(e,t,r){this.logCacheSend.push(t),(this.logCacheSend.length>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},e.prototype.logParamList=function(e,t){var r=a.getCurrentTime(),o=[t.substr(0,t.indexOf(" "))||t,t.substr(t.indexOf(" ")+1,4500)||t],i={time:r,level:e,action:o[0],content:o[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(i)},e.prototype.logReportParamList=function(e,t){var r=a.getCurrentTime();return t=o(o({},t),{time:r,level:e,console:this.env%2===i.ZEGO_ENV.BROWSER?"rtc":"xcx",appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+t.event_time+"_"+t.seq}),JSON.stringify(t)},e.prototype.openWebSocketLogServer=function(e){if(this.url!=e){if(this.url=e,!e)return;this.stopWebSocketServer(),this.websocket=n.createZegoWebSocket(e,this.env),this.websocket.onopen=function(){},this.websocket.onclose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}}},e.prototype.SendHttpsLog=function(){0!=this.logCacheSend.length&&(this.env%2===i.ZEGO_ENV.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},e.prototype.SendHttpsLogWeb=function(){var e=this,t=this.logCacheSend.join("\n"),r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){if(0==r.responseText.length)return;try{var t=JSON.parse(r.responseText).interval;"number"==typeof t&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))}catch(e){}}},r.open("POST",this.url,!0),0==this.env?r.send(t):2==this.env&&(r.setRequestHeader("content-type","application/json"),r.send(JSON.stringify({user_id:this.userid,log:t}))),this.logCacheSend=[]},e.prototype.SendHttpsLogWeChatMini=function(){var e=this;!this.existUserID&&this.userid&&this.logCacheSend.forEach((function(t){Array.isArray(t)&&t.forEach((function(r,o){var i=JSON.parse(r);i&&""==JSON.parse(r).userid?(i.userid=e.userid,i.id_name=e.userid,t[o]=JSON.stringify(i)):e.existUserID=!0}))}));var t=this.logCacheSend.join("\n"),r=1==this.env?t:JSON.stringify({user_id:this.userid,log:t});wx.request({url:this.url,data:r,method:"POST",success:function(t){if(0!=t.data.length){var r=t&&t.data&&t.data.interval;"number"==typeof r&&e.logUploadInterval!==r&&(e.timeInterval=r,e.openHttpsLogServer(e.url))}},fail:function(e){}}),this.logCacheSend=[]},e}();t.ZegoLogger=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTime=t.getCurrentEnv=t.getBrowser=void 0;var o=r(0);t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),i=null!=window.opr,n=e.indexOf("Chrome")&&window.chrome,s=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version"),a=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0];return t?o.ZEGO_BROWSER_TYPE.IE:r?o.ZEGO_BROWSER_TYPE.FIREFOX:i?o.ZEGO_BROWSER_TYPE.OPERA:n?o.ZEGO_BROWSER_TYPE.CHROME:s?o.ZEGO_BROWSER_TYPE.SAFARI:a?o.ZEGO_BROWSER_TYPE.WEIXIN:o.ZEGO_BROWSER_TYPE.UNKOWN},t.getCurrentEnv=function(){var e=window.navigator.userAgent;return new Promise((function(t){-1==e.indexOf("MicroMessage")?t(o.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv((function(e){e.miniprogram}))}))};var i=["00","01","02","03","04","05","06","07","08","09"];t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(i[e.getMonth()+1]||e.getMonth()+1)+"/",(i[e.getDate()]||e.getDate())+" ",(i[e.getHours()]||e.getHours())+":",(i[e.getMinutes()]||e.getMinutes())+":",i[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}}])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Base64=void 0;var o=function(){function e(){}return e.base64encode=function(t){var r,o,i,n,s,a;for(i=t.length,o=0,r="";o<i;){if(n=255&t.charCodeAt(o++),o==i){r+=e.base64EncodeChars.charAt(n>>2),r+=e.base64EncodeChars.charAt((3&n)<<4),r+="==";break}if(s=t.charCodeAt(o++),o==i){r+=e.base64EncodeChars.charAt(n>>2),r+=e.base64EncodeChars.charAt((3&n)<<4|(240&s)>>4),r+=e.base64EncodeChars.charAt((15&s)<<2),r+="=";break}a=t.charCodeAt(o++),r+=e.base64EncodeChars.charAt(n>>2),r+=e.base64EncodeChars.charAt((3&n)<<4|(240&s)>>4),r+=e.base64EncodeChars.charAt((15&s)<<2|(192&a)>>6),r+=e.base64EncodeChars.charAt(63&a)}return r},e.base64decode=function(t){var r,o,i,n,s,a,c;for(a=t.length,s=0,c="";s<a;){do{r=e.base64DecodeChars[255&t.charCodeAt(s++)]}while(s<a&&-1==r);if(-1==r)break;do{o=e.base64DecodeChars[255&t.charCodeAt(s++)]}while(s<a&&-1==o);if(-1==o)break;c+=String.fromCharCode(r<<2|(48&o)>>4);do{if(61==(i=255&t.charCodeAt(s++)))return c;i=e.base64DecodeChars[i]}while(s<a&&-1==i);if(-1==i)break;c+=String.fromCharCode((15&o)<<4|(60&i)>>2);do{if(61==(n=255&t.charCodeAt(s++)))return c;n=e.base64DecodeChars[n]}while(s<a&&-1==n);if(-1==n)break;c+=String.fromCharCode((3&i)<<6|n)}return c},e.utf16to8=function(e){var t,r,o,i;for(t="",o=e.length,r=0;r<o;r++)(i=e.charCodeAt(r))>=1&&i<=127?t+=e.charAt(r):i>2047?(t+=String.fromCharCode(224|i>>12&15),t+=String.fromCharCode(128|i>>6&63),t+=String.fromCharCode(128|i>>0&63)):(t+=String.fromCharCode(192|i>>6&31),t+=String.fromCharCode(128|i>>0&63));return t},e.utf8to16=function(e){var t,r,o,i,n,s;for(t="",o=e.length,r=0;r<o;)switch((i=e.charCodeAt(r++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(r-1);break;case 12:case 13:n=e.charCodeAt(r++),t+=String.fromCharCode((31&i)<<6|63&n);break;case 14:n=e.charCodeAt(r++),s=e.charCodeAt(r++),t+=String.fromCharCode((15&i)<<12|(63&n)<<6|(63&s)<<0)}return t},e.base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e.base64DecodeChars=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],e}();t.Base64=o},function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryRoomHandler=void 0;var n=r(5),s=r(0),a=r(2),c=r(1),d=r(3),l=function(e){function t(t,r,o){var i=e.call(this,t,r)||this;return i.logger=t,i.stateCenter=r,i.room=o,i.loginRoomCallback={},i}return i(t,e),t.prototype.renewToken=function(e){if(this.token=e,this.room.token=this.token,"03"===e.substr(0,2)){var t=d.ClientUtil.decodeTokenExpire(e.substr(2));this.roomHandler.resetTokenTimer(1e3*t-(new Date).getTime()-this.stateCenter.local_time_deviation-3e4)}this.stateCenter.actionListener("_tokenRenewed",e,this.room.roomID)},t.prototype.initRoom=function(e,t,r,o,i,n,s){this.roomHandler=e,this.roomID=t,this.renewToken(r),this.user=o,this.server=i,this.serverBak=n||i,this.config=s},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry call"),this.roomHandler.setRunState(s.ENUM_RUN_STATE.trylogin),this.room.isMulti&&this.room.service.isDisConnect())this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" service is disconnected, multi room stop retry");else if(this.stateCenter.networkState!=s.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" has actived, ignore");else if(this.isOverTime)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}this.retryTimer=setTimeout((function(){t.roomHandler.login(t.retryActiveCount%2==1?t.server:t.serverBak,t.roomID,t.token,t.user,t.config,(function(e){t.handleLoginFinish(e)}),(function(e,r){t.handleLoginFinish(!1,e,r)})),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++}),e?0:1e3*this.retryActiveInterval)}else this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){e.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,c.errorCodeList.LOGIN_TIMEOUT),e.loginRoomCallback.fail&&(e.loginRoomCallback.fail(c.errorCodeList.LOGIN_TIMEOUT),e.loginRoomCallback.fail=void 0)}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,t){},t.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){var r=e.code+"";return!["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"].includes(r)&&(!!["1100040001","1100040100"].includes(r)||this.room.lastRunState==s.ENUM_RUN_STATE.login&&(this.room.sessionID="",this.invalid(),!0))}return!0},t.prototype.setLoginRoomCallback=function(e,t){this.loginRoomCallback.success=e,this.loginRoomCallback.fail=t},t.prototype.handleLoginFinish=function(e,t,r){t?this.handleError(t,r)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.loginRoomCallback.fail=void 0)):(this.stopMaxTime(),this.invalid(),this.onactive(e,{code:0,msg:""}),this.loginRoomCallback.success&&(this.loginRoomCallback.success(e),this.loginRoomCallback.fail=void 0))},t}(n.TryHandler);t.RetryRoomHandler=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkParams=t.RULE_SUCCESS=t.RULE_PARAM_NAME=void 0;var o,i=r(3);!function(e){e.NOT_EMPTY="NOT_EMPTY",e.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",e.TYPE_STRING="TYPE_STRING",e.TYPE_INTEGER="TYPE_INTEGER",e.TYPE_OBJECT="TYPE_OBJECT",e.MAX_LENGTH_10="MAX_LENGTH_10",e.MAX_LENGTH_64="MAX_LENGTH_64",e.MAX_LENGTH_100="MAX_LENGTH_100",e.MAX_LENGTH_128="MAX_LENGTH_128",e.MAX_LENGTH_256="MAX_LENGTH_256",e.MAX_LENGTH_1024="MAX_LENGTH_1024"}(o=t.RULE_PARAM_NAME||(t.RULE_PARAM_NAME={})),t.RULE_SUCCESS={error:{code:0,msg:"suc"}};var n={NOT_EMPTY:function(e,r,o,i,n){return void 0===r||""===r||null===r?(i.error(o+" "+e+" is empty"),n):t.RULE_SUCCESS},ILLEGAL_CHARACTERS:function(e,r,o,n,s){return i.ClientUtil.checkIllegalCharacters(r)?t.RULE_SUCCESS:(n.error(o+" "+e+" contains illegal characters"),s)},TYPE_STRING:function(e,r,o,i,n){return"string"!=typeof r?(i.error(o+" "+e+" must be string"),n):t.RULE_SUCCESS},TYPE_INTEGER:function(e,r,o,n,s){return i.ClientUtil.checkInteger(r,!1)?t.RULE_SUCCESS:(n.error(o+" "+e+"  must be integer number"),s)},TYPE_OBJECT:function(e,r,o,i,n){return r&&"object"==typeof r?t.RULE_SUCCESS:(i.error(o+" "+e+"  must be object"),n)},MAX_LENGTH_10:function(e,r,o,i,n){return r.length>10?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS},MAX_LENGTH_64:function(e,r,o,i,n){return r.length>64?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS},MAX_LENGTH_100:function(e,r,o,i,n){return r.length>100?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS},MAX_LENGTH_128:function(e,r,o,i,n){return r.length>128?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS},MAX_LENGTH_256:function(e,r,o,i,n){return r.length>256?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS},MAX_LENGTH_1024:function(e,r,o,i,n){return r.length>1024?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS}};t.checkParams=function(e,r){var i=[],s={};for(var a in e)s[e[a].order]=e[a],e[a].key=a;for(var c in s)i.push(s[c]);for(var d=0;d<i.length;d++)for(var l=i[d].rules,u=0;u<l.length;u++){var h={key:i[d].key,value:i[d].value,action:r.action,logger:r.logger},p=h.key,f=h.value,g=h.action,m=h.logger,_=l[u].name?""+l[u].name:"";if((void 0===f&&_===o.NOT_EMPTY||void 0!==f)&&n[_]){var v=n[_](p,f,g,m,l[u]);if(v!=t.RULE_SUCCESS)return v}}return t.RULE_SUCCESS}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var o=r(0),i=r(2),n=r(4),s=function(){function e(e,t){this.logger=e,this.dataReport=t,this._debug=!1,this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=o.ENUM_NETWORK_STATE.offline,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this._sdkVersion="unknown"}return Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,o.LoggerStateCenter.getInstance().debug=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e,o.LoggerStateCenter.getInstance().testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._env},set:function(e){this._env=e,o.LoggerStateCenter.getInstance().ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),e.prototype.getRequestId=function(){return this.idName+"-"+o.getSeq()},e.prototype.actionListener=function(e){for(var t=this,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];if(this.listenerList[e]){var a=o.getReportSeq();this.dataReport.newReport(a,n.ZegoRTMLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(a,{listener:e,params:r}),this.dataReport.uploadReport(a)}this.listenerList[e]&&this.listenerList[e].forEach((function(o){try{o.apply(void 0,r)}catch(r){t.logger.error(i.ZEGO_RTM_ACTION.STATE_ACTION+" ",e," ",JSON.stringify(r))}}))},Object.defineProperty(e.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(e){this._sdkVersion=e},enumerable:!1,configurable:!0}),e}();t.StateCenter=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var o=r(0),i=r(6),n=r(7),s=r(8),a=r(20),c=r(9),d=function(){function e(e,t,r,d,l){this.roomID=e,this.stateCenter=t,this.logger=r,this.dataReport=d,this.service=l,this.runState=o.ENUM_RUN_STATE.logout,this.lastRunState=o.ENUM_RUN_STATE.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomSessionID="0",this.sessionID="0",this.isMulti=!1,this.token="",this.thirdToken="",this.roomHandler=new a.RoomHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.heartBeatHandler=new i.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.userHandler=new c.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.messageHandler=new s.MessageHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.liveHandler=new n.LiveHandler(this.logger,this.stateCenter,this.service,this),this.init()}return e.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.roomHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.messageHandler.loginRsp(t),e.userHandler.patchUserList(t),e.HBResponse(t)}},e.prototype.bindRoomHandler=function(){var e=this;this.roomHandler.loginSuccessCallBack=function(t,r){e.heartBeatHandler.init(r),e.service.startCheck(),e.userHandler.loginRsp(r,t),e.messageHandler.loginRsp(r),e.isMulti||e.handleMultiRoom(),e.roomLoginResponse(r)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler.resetLiveHandler(),e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler(),e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.stopMaxTime(),e.roomTryHandler=void 0)}},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e.prototype.handleMultiRoom=function(){this.stateCenter.roomModulesList.forEach((function(e){e.runState!==o.ENUM_RUN_STATE.login&&e.roomTryHandler&&1==e.isMulti&&(e.roomTryHandler.onactive=function(t,r){r&&0!==r.code?e.roomHandler.roomStateHandle("DISCONNECTED",r):e.roomHandler.roomStateHandle("CONNECTED",r)},e.roomTryHandler.startMaxTime(),e.roomTryHandler.active())}))},e.prototype.isLogin=function(){return this.runState===o.ENUM_RUN_STATE.login},e}();t.LiveRoomModules=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomHandler=void 0;var o=r(0),i=r(3),n=r(2),s=r(1),a=r(4),c=function(){function e(e,t,r,o,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=i,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4,this.tokenTimer=null,this.beforeExpire=30,this.loginCallback={}}return e.prototype.resetTokenTimer=function(e){var t=this;e=(e=e<0?0:e)>2147483648?2147483648:e,this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESETTOKEN_TIMER+"  call: "+e),this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=setTimeout((function(){t.stateCenter.actionListener("tokenWillExpire",t.room.roomID),t.stateCenter.actionListener("roomTokenWillExpire",t.room.roomID)}),e)},e.prototype.stopTokenTimer=function(){clearTimeout(this.tokenTimer)},e.prototype.setRunState=function(e){this.room.lastRunState=this.room.runState,this.room.runState=e},e.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},e.prototype.resetRoom=function(e){var t=this;if(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.stateCenter.roomModulesList.length>1&&!e&&(this.room.isMulti=!0),this.resetTryLogin(),"0"!==this.room.sessionID&&this.room.runState!==o.ENUM_RUN_STATE.logout&&!this.service.isDisConnect()){var r=function(e){t.handleLogoutRsp(e)};this.service.logout(this.room,r,r)}this.setRunState(o.ENUM_RUN_STATE.logout),this.room.sessionID="",this.room.roomSessionID="",this.room.isMulti||(this.stateCenter.userid="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.service.closeSocket()),this.resetRoomCallBack(),this.stateCenter.roomModulesList=this.stateCenter.roomModulesList.filter((function(e){return e!==t.room}));var i=this.stateCenter.roomModulesList[0];i&&(i.isMulti=!1,i.runState!==o.ENUM_RUN_STATE.login&&i.roomTryHandler&&(i.roomTryHandler.startMaxTime(),i.roomTryHandler.active())),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.handlePushKickout=function(e,t){var r=this;this.logger.info(n.ZEGO_RTM_ACTION.ROOM_KICK_OUT+"  call "+JSON.stringify(e));var c=o.getReportSeq();this.dataReport.newReport(c,a.ZegoRTMLogEvent.kZegoTaskKickout.event),this.dataReport.addMsgInfo(c,{user_id:a.ZegoRTMLogEvent.kZegoTaskKickout.user_id(this.stateCenter.idName)});var d=i.ClientUtil.getKickoutError(e.body.reason);this.dataReport.addMsgInfo(c,{error:d.code,message:d.message}),this.dataReport.uploadReport(c);var l=this.room.roomTryHandler;if(l)if(l.onactive=function(e,t){r.disconnectedHandle(t),r.stateCenter.actionListener("_kickout",t)},e.body.need_relogin&&1==e.body.need_relogin)this.room.sessionID="",l.startMaxTime(),l.active();else{this.resetRoom(t);var u={};e&&e.body.custom_reason?u.custom_kickout_message=e.body.custom_reason:d.name&&s.errorCodeList[d.name]&&(u.custom_kickout_message=s.errorCodeList[d.name].msg+" kickout，reason: "+e.body.reason),d.name&&s.errorCodeList[d.name]?this.disconnectedHandle(s.errorCodeList[d.name],JSON.stringify(u)):this.disconnectedHandle(s.errorCodeList.ROOM_INNER_ERROR,JSON.stringify(u)),this.stateCenter.actionListener("_kickout",{code:s.errorCodeList.MANUAL_KICKOUT.code,msg:s.errorCodeList.MANUAL_KICKOUT.msg+e.body.reason})}else this.logger.info(n.ZEGO_RTM_ACTION.ROOM_KICK_OUT+" try handler no found")},e.prototype.handleHbLogout=function(e){var t=this,r=this.room.roomTryHandler;r&&(r.onactive=function(e,r){t.disconnectedHandle(r)},[s.errorCodeList.HEARTBEAT_TIMEOUT,s.errorCodeList.SOCKET_CLOSE,s.errorCodeList.TIMEOUT].includes(e)||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")?(r.startMaxTime(),r.active()):(r.stopMaxTime(),r.invalid(),this.resetRoom(),this.disconnectedHandle(e)))},e.prototype.onDisconnect=function(e){var t=this;if(this.logger.error(n.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code)this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.code,message:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.msg});else if("number"==typeof e.code){var r;(r=e.code<2e9&&e.code>1e9||e.code<1e6?i.ClientUtil.decodeServerError(e.code,e.msg):{code:e.code,message:e.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:r.code,message:r.message})}this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,i.ClientUtil.unregisterCallback(a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.stateCenter.reportList);var o=this.room.roomTryHandler;o?(o.onactive=function(e,r){r&&0!==r.code?t.roomStateHandle("DISCONNECTED",r):t.roomStateHandle("CONNECTED",r)},o.startMaxTime(),o.active()):this.logger.error(n.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" try handler no found")},e.prototype.onConnecting=function(e){this.roomStateHandle("CONNECTING",e)},e.prototype.disconnectedHandle=function(e,t){e&&0!==e.code?(this.stopTokenTimer(),this.roomStateHandle("DISCONNECTED",e,t)):this.roomStateHandle("CONNECTED",e,t)},e.prototype.roomStateHandle=function(e,t,r){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,r),this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,t?t.code:0,r))},e.prototype.login=function(e,t,r,c,d,l,u){if(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call:",t,r),!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,t,"",c.userID,"",this.stateCenter.sdKVersion),d&&(d.userUpdate&&"boolean"==typeof d.userUpdate&&(this.stateCenter.userStateUpdate=d.userUpdate),d.maxMemberCount&&"number"==typeof d.maxMemberCount&&(this.stateCenter.maxMemberCount=d.maxMemberCount)),!this.stateCenter.configOK)return this.logger.error(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" init sdk wrong"),void u(s.errorCodeList.INIT);if(this.room.runState!==o.ENUM_RUN_STATE.trylogin&&this.setRunState(o.ENUM_RUN_STATE.trylogin),this.room.roomID=t,this.room.token=r,this.room.thirdToken=r,this.stateCenter.idName=c.userID,this.stateCenter.nickName=c.userName||c.userID,this.loginCallback.success=l,this.loginCallback.fail=u,0===this.stateCenter.reportSeqList.login){var h=o.getReportSeq();this.stateCenter.reportSeqList.relogin=h,this.dataReport.newReport(h,a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event),this.dataReport.addMsgInfo(h,{server:e}),i.ClientUtil.logReportCallback(a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.dataReport,h,this.stateCenter.reportList)}this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(e),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call success")},e.prototype.tryLogin=function(e){var t=this;if(this.room.runState===o.ENUM_RUN_STATE.trylogin){var r=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" new websocket"),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&(this.tryLoginCount>1&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventEnd,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.addEventMsg,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.server("server"),e)),this.service.createSocket(e),this.service.openHandler((function(){t.openHandler()})),this.service.closeHandler((function(e){t.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" close "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)})),this.service.errorHandler((function(e){t.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" error "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)}))}catch(e){this.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" use current websocket and sent login"),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var s=function(e,r){t.handleLoginRsp(e,r)};this.service.login(this.room,s,s)}this.tryLoginTimer=setTimeout((function(){t.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),t.loginCallback.fail&&t.loginCallback.fail(a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.openHandler=function(){var e=this;this.logger.info(n.ZEGO_RTM_ACTION.ROOM_OPEN_HANDLER+" websocket.onpen call");var t=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(o.REPORT_ACTION.eventEndWithMsgInfo,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(o.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var r=function(t,r){e.handleLoginRsp(t,r)};this.service.login(this.room,r,r)},e.prototype.handleLoginRsp=function(e,t){var r=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventEndWithMsgInfo,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event),this.room.runState===o.ENUM_RUN_STATE.trylogin)if(e.header&&e.body){if(e.header.seq!==t&&0==this.room.isMulti)return void this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",t+"",",recv=",e.header.seq);0!==e.body.err_code?(this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" server error=",e.body.err_code),this.handleLoginFail(e)):(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" call success."),this.handleLoginSuccess(e))}else this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" "+JSON.stringify(e)),this.handleLoginFail(e);else this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" state error")},e.prototype.handleLoginFail=function(e){this.resetTryLogin();var t=a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INNER_ERROR;e.header&&e.body?t=i.ClientUtil.getServerError(e.body.err_code):e.code&&e.msg&&(t=e),this.loginCallback.fail&&this.loginCallback.fail(t,!0)},e.prototype.handleLoginSuccess=function(e){var t={},r=this.room.lastRunState;if(this.setRunState(o.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_id,this.room.sessionID=e.body.session_id,this.room.roomSessionID=e.body.room_session_id,e.body.ret_timestamp&&"03"===this.room.token.substr(0,2)){var n=(new Date).getTime()-e.body.ret_timestamp;this.stateCenter.local_time_deviation=n<5e3?0:n;var s=i.ClientUtil.decodeTokenExpire(this.room.token.substr(2));this.resetTokenTimer(1e3*s-(new Date).getTime()-this.stateCenter.local_time_deviation-3e4)}!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),e.body.config_info&&(this.logger.setRemoteLogLevel(e.body.config_info.log_level),t.log_level=e.body.config_info.log_level,""==e.body.config_info.log_url||this.logger.url||(this.logger.setLogServer(e.body.config_info.log_url),t.log_url=e.body.config_info.log_url)),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,t.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var c=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;i.ClientUtil.actionSuccessCallback(c,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(c,this.stateCenter.reportList)(o.REPORT_ACTION.addEventMsg,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.respond_info("respond_info"),t),this.resetTryLogin(),this.loginSuccessCallBack(r,e),this.loginCallback.success&&this.loginCallback.success(!0),this.roomStateHandle("CONNECTED",{code:0,msg:""})},e.prototype.closeHandler=function(e){this.logger.error(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(e.code?e.code:e)),this.room.runState!==o.ENUM_RUN_STATE.logout?this.room.runState===o.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),this.loginCallback.fail&&this.loginCallback.fail(1006==e.code?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT:e)):this.room.runState===o.ENUM_RUN_STATE.login&&(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.NETWORK_BROKEN)):this.logger.info(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},e.prototype.logout=function(e){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call"),this.room.runState!==o.ENUM_RUN_STATE.logout?(this.resetRoom(e),this.roomStateHandle("DISCONNECTED",{code:0,msg:""}),this.stopTokenTimer(),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.handleLogoutRsp=function(e){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" result=",e.body&&e.body.err_code?e.body.err_code:"-1")},e}();t.RoomHandler=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var o=r(0),i=r(6),n=r(7),s=r(8),a=r(9),c=r(22),d=r(23),l=r(1),u=r(4),h=function(){function e(e,t,r,l){this.stateCenter=e,this.logger=t,this.dataReport=r,this.service=l,this.roomID="",this.dispatchServer="",this.deviceID="",this.deviceType="",this.anType=0,this.sessionExpire="",this.pri_roomID="",this.roomSid="0",this.roomFlag=1,this.timeStamp=0,this.netType=2,this.userSeq=0,this.hallRunState=o.ENUM_RUN_STATE.logout,this.hallToken="",this.roomSessionID="",this.lastHallRunState=o.ENUM_RUN_STATE.logout,this.runRoomState=o.ENUM_RUN_STATE.logout,this.lastRunRoomState=o.ENUM_RUN_STATE.logout,this.lastHallState="DISCONNECTED",this.hallState="DISCONNECTED",this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.sessionID="",this.hallHandler=new c.HallHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.roomPrivateHandler=new d.RoomPrivateHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.heartBeatHandler=new i.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.stateCenter.priModules),this.userHandler=new a.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.stateCenter.priModules),this.messageHandler=new s.MessageHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.stateCenter.priModules),this.liveHandler=new n.LiveHandler(this.logger,this.stateCenter,this.service,this.stateCenter.priModules),this.init()}return e.prototype.init=function(){this.bindSocketHandler(),this.bindHeatBeatHandler(),this.bindHallHandler(),this.bindMessageHandler(),this.bindLiveHandler(),this.bindRoomHandler()},e.prototype.bindSocketHandler=function(){var e=this;this.service.handleHallKickout=function(t){e.hallHandler.handleHallKickout(t)},this.service.handlePushKickout=function(t){e.logger.info("zb.cm.bsh.0  call hpk");var r=o.getReportSeq();e.dataReport.newReport(r,u.ZegoRTMLogEvent.kZegoTaskRoomKickout.event),e.dataReport.addMsgInfo(r,{user_id:u.ZegoRTMLogEvent.kZegoTaskRoomKickout.user_id(e.stateCenter.idName),room_id:u.ZegoRTMLogEvent.kZegoTaskRoomKickout.room_id(e.stateCenter.priModules.roomID)}),e.dataReport.addMsgInfo(r,{error:t.body.reason,message:t.body.message}),e.dataReport.uploadReport(r),e.setRoomRunState(o.ENUM_RUN_STATE.logout),e.roomPrivateHandler.resetRoom();var i={};t&&t.body&&(t.body.reason&&(i.custom_kickout_message=t.body.message),t.body.reason&&(i.reason=t.body.reason)),e.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:l.errorCodeList.MULTIPLE_LOGIN_KICKOUT.code,msg:i}),e.logger.info("zb.cm.bsh.0  call hpk success")},this.service.handlePushUserStateUpdateMsg=function(t){e.userHandler.handlePushUserStateUpdateMsg(t)},this.service.handlePushTransMsg=function(t){e.messageHandler.handlePushTransMsg(t)},this.service.handlePushRoomMsg=function(t){e.messageHandler.handlePushRoomMsg(t)},this.service.handlePushCustomMsg=function(t){e.messageHandler.handlePushCustomMsg(t)},this.service.handlePushMergeMsg=function(t){e.messageHandler.handlePushMergeMsg(t)},this.service.handlePushSignalMsg=function(t){e.liveHandler.handlePushSignalMsg(t)}},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.hallHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.messageHandler.loginRsp(t),e.HBResponse(t)}},e.prototype.bindHallHandler=function(){var e=this;this.hallHandler.loginSuccessCallBack=function(t,r){if(e.heartBeatHandler.init(r),e.service.startCheck(),e.runRoomState===o.ENUM_RUN_STATE.login){var i=function(t,r){0!==t.body.code?(e.setRoomRunState(o.ENUM_RUN_STATE.logout),e.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:t.body.code,msg:t.body.message})):(e.timeStamp=t.header.timeStamp,e.roomSid=t.body.room_header.room_sid,e.roomSessionID=t.body.room_header.room_user_session_id,e.userSeq=t.body.userlist_seq,e.setRoomRunState(o.ENUM_RUN_STATE.login),e.roomPrivateHandler.roomStateHandle("CONNECTED",{code:0,msg:""}),e.userHandler.loginPrivateRsp(t),e.roomLoginResponse(t))};e.roomPrivateHandler.enterRoom(i,i)}},this.hallHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler.resetLiveHandler(),e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler()}},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.bindRoomHandler=function(){var e=this;this.roomPrivateHandler.resetRoomCallBack=function(){e.liveHandler.resetLiveHandler(),e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler()}},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e.prototype.setRoomRunState=function(e){this.roomPrivateHandler.setRoomRunState(e)},e.prototype.isLogin=function(){return this.hallRunState===o.ENUM_RUN_STATE.login},e}();t.LiveRoomModules=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HallHandler=void 0;var o=r(0),i=r(3),n=r(0),s=r(2),a=r(1),c=r(4),d=function(){function e(e,t,r,o,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=i,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4}return e.prototype.setRunState=function(e){this.room.lastHallRunState=this.room.hallRunState,this.room.hallRunState=e},e.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},e.prototype.resetHall=function(){var e=this;if(this.logger.info(s.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.resetTryLogin(),"0"!==this.room.sessionID&&this.room.hallRunState!==o.ENUM_RUN_STATE.logout){var t=function(t){e.handleLogoutRsp(t)};this.service.logoutHall(t,t)}this.setRunState(o.ENUM_RUN_STATE.logout),this.stateCenter.userid="",this.room.sessionID="",this.room.roomSessionID="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.service.closeSocket(),this.resetRoomCallBack(),this.logger.info(s.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.handleHallKickout=function(e){this.logger.info(s.ZEGO_RTM_ACTION.ROOM_KICK_OUT+"  call "+e);var t=n.getReportSeq();this.dataReport.newReport(t,c.ZegoRTMLogEvent.kZegoTaskKickout.event),this.dataReport.addMsgInfo(t,{user_id:c.ZegoRTMLogEvent.kZegoTaskKickout.user_id(this.stateCenter.idName)});var r=i.ClientUtil.getKickoutError(e.body.reason);this.dataReport.addMsgInfo(t,{error:r.code,message:r.message}),this.dataReport.uploadReport(t),this.resetHall();var o={};e&&e.body&&(e.body.reason&&(o.custom_kickout_message=e.body.message),e.body.reason&&(o.reason=e.body.reason)),this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,"DISCONNECTED",a.errorCodeList.MULTIPLE_LOGIN_KICKOUT.code,o)},e.prototype.handleHbLogout=function(e){var t=this,r=this.room.retryHallHandler;r&&(r.onactive=function(e,r){t.disconnectedHandle(r)},e==a.errorCodeList.HEARTBEAT_TIMEOUT||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")?(r.startMaxTime(),r.active()):(r.stopMaxTime(),r.invalid(),this.resetHall(),this.disconnectedHandle(e)))},e.prototype.onDisconnect=function(e){var t=this;if(this.logger.error(s.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code)this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:c.ZegoRTMLogEvent.kZegoTaskReLoginHall.error.ROOM_DISCONNECT.code,message:c.ZegoRTMLogEvent.kZegoTaskReLoginHall.error.ROOM_DISCONNECT.msg});else if("number"==typeof e.code){var r;(r=e.code<2e9&&e.code>1e9||e.code<1e6?i.ClientUtil.decodeServerError(e.code,e.msg):{code:e.code,message:e.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:r.code,message:r.message})}this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,i.ClientUtil.unregisterCallback(c.ZegoRTMLogEvent.kZegoTaskReLoginHall.event,this.stateCenter.reportList);var o=this.room.retryHallHandler;o?(o.onactive=function(e,r){r?t.hallStateHandle("DISCONNECTED",r):t.hallStateHandle("CONNECTED",r)},o.startMaxTime(),o.active()):this.logger.error(s.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" try handler no found")},e.prototype.onConnecting=function(e){this.hallStateHandle("CONNECTING",e)},e.prototype.disconnectedHandle=function(e){e?this.hallStateHandle("DISCONNECTED",e):this.hallStateHandle("CONNECTED",e)},e.prototype.hallStateHandle=function(e,t,r){this.logger.info(s.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastHallState=this.room.hallState,this.room.hallState=e,this.room.hallState!==this.room.lastHallState&&(this.stateCenter.actionListener("_hallStateUpdate",e,t?t.code:0,r||""),this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,r),this.stateCenter.actionListener("hallStateUpdate",e,t?t.code:0,r||""))},e.prototype.loginHall=function(e,t,r,d,l){if(this.logger.info(s.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call:"),this.logger.setSessionInfo(this.stateCenter.appid,"","",t.userID,"",this.stateCenter.sdKVersion),!this.stateCenter.configOK)return this.logger.error(s.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" init sdk wrong"),void l(a.errorCodeList.INIT);if(this.room.hallRunState!==o.ENUM_RUN_STATE.trylogin&&this.setRunState(o.ENUM_RUN_STATE.trylogin),this.stateCenter.idName=t.userID,this.stateCenter.nickName=t.userName||t.userID,i.ClientUtil.registerCallback("login",{success:d,error:l},this.stateCenter.callbackList),0===this.stateCenter.reportSeqList.login){var u=n.getReportSeq();this.stateCenter.reportSeqList.relogin=u,this.dataReport.newReport(u,c.ZegoRTMLogEvent.kZegoTaskReLoginHall.event),i.ClientUtil.logReportCallback(c.ZegoRTMLogEvent.kZegoTaskReLoginHall.event,this.dataReport,u,this.stateCenter.reportList)}this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLoginHall(e),this.logger.info(s.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call success")},e.prototype.tryLoginHall=function(e){var t=this;if(this.room.hallRunState===o.ENUM_RUN_STATE.trylogin){var r=0!==this.stateCenter.reportSeqList.login?c.ZegoRTMLogEvent.kZegoTaskLoginHall.event:c.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(s.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" new websocket"),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&(this.tryLoginCount>1&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventEnd,c.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,c.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.addEventMsg,c.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event,c.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.server("server"),e)),this.service.createSocket(e),this.service.openHandler((function(){t.openHandler()})),this.service.closeHandler((function(e){t.logger.error(s.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" close "+JSON.stringify(e)),t.service.closeSocket(),t.closeHandler(e)})),this.service.errorHandler((function(e){t.logger.error(s.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" error "+JSON.stringify(e)),t.service.closeSocket(),t.closeHandler(e)}))}catch(e){this.logger.error(s.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(s.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" use current websocket and sent login"),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,c.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event);var a=function(e,r){t.handleLoginRsp(e,r)};this.service.loginHall(a,a)}this.tryLoginTimer=setTimeout((function(){t.logger.info(s.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),i.ClientUtil.actionErrorCallback("login",t.stateCenter.callbackList)(c.ZegoRTMLogEvent.kZegoTaskLoginHall.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.info(s.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.openHandler=function(){var e=this;this.logger.info(s.ZEGO_RTM_ACTION.ROOM_OPEN_HANDLER+" websocket.onpen call");var t=0!==this.stateCenter.reportSeqList.login?c.ZegoRTMLogEvent.kZegoTaskLoginHall.event:c.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(n.REPORT_ACTION.eventEndWithMsgInfo,c.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,c.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event);var r=function(t,r){e.handleLoginRsp(t,r)};this.service.loginHall(r,r)},e.prototype.handleLoginRsp=function(e,t){var r=0!==this.stateCenter.reportSeqList.login?c.ZegoRTMLogEvent.kZegoTaskLoginHall.event:c.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;if(i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventEndWithMsgInfo,c.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event),this.room.hallRunState===o.ENUM_RUN_STATE.trylogin){if(e.header.seq===t)return 0!==e.body.code?(this.logger.error(s.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" server error=",e.body.code),void this.handleLoginFail(e)):(this.logger.info(s.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" call success."),void this.handleLoginSuccess(e));this.logger.error(s.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",t+"",",recv=",e.header.seq)}else this.logger.error(s.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" state error")},e.prototype.handleLoginFail=function(e){this.resetTryLogin();var t={code:e.body.code,msg:e.body.message};i.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(t,!0)},e.prototype.handleLoginSuccess=function(e){var t={},r=this.room.lastHallRunState;this.setRunState(o.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_uid,this.room.sessionID=e.body.session_id,this.room.timeStamp=e.header.timestamp,this.room.roomSessionID=e.body.room_session_id,this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),e.body.log_sever_addr&&""!=e.body.log_sever_addr&&this.logger.logRemoteLevel!==o.ENUM_LOG_LEVEL.disable&&(this.logger.setLogServer(e.body.log_sever_addr),t.log_url=e.body.log_sever_addr),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,t.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var s=0!==this.stateCenter.reportSeqList.login?c.ZegoRTMLogEvent.kZegoTaskLoginHall.event:c.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;i.ClientUtil.actionSuccessCallback(s,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(s,this.stateCenter.reportList)(n.REPORT_ACTION.addEventMsg,c.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event,c.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.respond_info("respond_info"),t),this.resetTryLogin(),this.loginSuccessCallBack(r,e),i.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)&&i.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)(!0),this.hallStateHandle("CONNECTED",{code:0,msg:""})},e.prototype.closeHandler=function(e){this.logger.error(s.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(e.code)),this.room.hallRunState!==o.ENUM_RUN_STATE.logout?this.room.hallRunState===o.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),i.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(1006==e.code?c.ZegoRTMLogEvent.kZegoTaskLoginHall.error.LOGIN_TIMEOUT:e)):this.room.hallRunState===o.ENUM_RUN_STATE.login&&(this.logger.info(s.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(c.ZegoRTMLogEvent.kZegoTaskLoginHall.error.NETWORK_BROKEN)):this.logger.info(s.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},e.prototype.logout=function(){this.logger.info(s.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call"),this.room.hallRunState!==o.ENUM_RUN_STATE.logout?(this.resetHall(),this.hallStateHandle("DISCONNECTED",{code:0,msg:""}),this.logger.info(s.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.handleLogoutRsp=function(e){this.logger.info(s.ZEGO_RTM_ACTION.ROOM_LOGOUT+"result=",e.body&&e.body.err_code?e.body.err_code:"")},e}();t.HallHandler=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomPrivateHandler=void 0;var o=r(0),i=r(2),n=function(){function e(e,t,r,o,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=i,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4}return e.prototype.setRoomRunState=function(e){this.room.lastRunRoomState=this.room.runRoomState,this.room.runRoomState=e},e.prototype.enterRoom=function(e,t){this.service.enterRoom(e,t)},e.prototype.leaveRoom=function(e,t){this.resetRoom(e,t)},e.prototype.resetRoom=function(e,t){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call");var r=e||function(){},n=t||function(){};this.room.runRoomState!==o.ENUM_RUN_STATE.logout&&this.service.leaveRoom(r,n),this.setRoomRunState(o.ENUM_RUN_STATE.logout),this.room.roomSid="0",this.room.roomSessionID="0",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.resetRoomCallBack(),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.roomStateHandle=function(e,t,r){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,r||""),this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,t?t.code:0,r||""))},e}();t.RoomPrivateHandler=n},function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryHallHandler=void 0;var n=r(5),s=r(0),a=r(2),c=r(1),d=function(e){function t(t,r,o){var i=e.call(this,t,r)||this;return i.logger=t,i.stateCenter=r,i.room=o,i}return i(t,e),t.prototype.initRoom=function(e,t,r,o){this.hallHandler=e,this.user=t,this.server=r,this.config=o},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry call"),this.stateCenter.networkState!=s.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" has actived, ignore");else if(this.isOverTime)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}this.retryTimer=setTimeout((function(){t.hallHandler.loginHall(t.server,t.user,t.config,(function(e){t.handleLoginFinish(e)}),(function(e,r){t.handleLoginFinish(!1,e,r)})),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++}),e?0:1e3*this.retryActiveInterval)}else this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){e.isOverTime=!0,e.hallHandler.resetHall(),e.stopMaxTime(),e.invalid(),e.onactive(!1,c.errorCodeList.LOGIN_TIMEOUT)}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,t){},t.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){var r=e.code+"";return!["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"].includes(r)&&(!!["1100040001","1100040100"].includes(r)||this.room.lastHallRunState==s.ENUM_RUN_STATE.login&&(this.room.sessionID="",this.invalid(),!0))}return!0},t.prototype.handleLoginFinish=function(e,t,r){t?this.handleError(t,r)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.hallHandler.resetHall(),this.stopMaxTime(),this.invalid(),this.onactive(e,t)):(this.stopMaxTime(),this.invalid(),this.onactive(e))},t}(n.TryHandler);t.RetryHallHandler=d},function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomPrivateService=void 0;var n=r(11),s=r(0),a=r(2),c=function(e){function t(t,r){var o=e.call(this,t,r)||this;return o.stateCenter=t,o.logger=r,o.service=new n.ZegoSocketService(o.stateCenter.ENV),o.cmdSeq=0,o.responseRouters={},o}return i(t,e),t.prototype.checkResponse=function(e){return e.header.app_id!==this.stateCenter.appid||e.header.user_uid!==this.stateCenter.userid||this.stateCenter.priModules.hallRunState!==s.ENUM_RUN_STATE.login},t.prototype.handleSendCommandMsgRsp=function(e){var t=this,r=this.service.sendCommandMap[e.header.seq];if(null!=r){var o=r._data;delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(r),0===e.body.code||e.body.mod_rsp_header&&0===e.body.mod_rsp_header.code?setTimeout((function(){o&&null!=o.success&&o.success(e,t.cmdSeq)}),0):setTimeout((function(){o&&null!=o.error&&o.error(e,t.cmdSeq)}),0)}},t.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" msg="+JSON.stringify(t)+" "),0!==t.body.code&&t.body.code&&e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", code="+t.body.code+", message="+t.body.message+" "),["zegochat_js.user_login_ws_rsp","zegochat_js.user_logout_rsp"].indexOf(t.header.cmd)>-1?e.handleSendCommandMsgRsp(t):e.stateCenter.priModules.isLogin()?e.checkResponse(t)?e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  check session fail."):(e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+",function="+!!e.responseRouters[t.header.cmd]),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq)):e.logger.warn(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  already logout")}},t.prototype.handleHallKickout=function(e){},t.prototype.handlePushKickout=function(e){},t.prototype.handlePushCustomMsg=function(e){},t.prototype.handlePushRoomMsg=function(e){},t.prototype.handlePushUserStateUpdateMsg=function(e){},t.prototype.handlePushMergeMsg=function(e){},t.prototype.handlePushTransMsg=function(e){},t.prototype.handleBigImMsgRsp=function(e){},t.prototype.handlePushSignalMsg=function(e){},t.prototype.closeHandler=function(e){this.service.closeHandler(e)},t.prototype.openHandler=function(e){this.service.openHandler(e)},t.prototype.errorHandler=function(e){this.service.errorHandler(e)},t.prototype.getHeader=function(e){return{cmd:e,seq:++this.cmdSeq,timestamp:Math.ceil((new Date).getTime()/1e3)+"",app_id:this.stateCenter.appid,user_uid:this.stateCenter.userid||"0",session_id:this.stateCenter.priModules.sessionID||"0"}},t.prototype.startCheck=function(){this.service.startCheck()},t.prototype.stopCheck=function(){this.service.stopCheck()},t.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},t.prototype.createSocket=function(e){var t=this;this.service.createSocket(e),this.responseRouters={"zegochat_js.push_user_kickout":function(e){t.handleHallKickout(e)},"zegochat_js.push_room_kickout":function(e){t.handlePushKickout(e)},"zegochat_js.push_room_custommsg_req":function(e){t.handlePushCustomMsg(e)},"zegochat_js.push_room_im_chat_req":function(e){t.handlePushRoomMsg(e)},"zegochat_js.push_room_userlist_update_req":function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)}}},t.prototype.closeSocket=function(){this.service.closeSocket()},t.prototype.sendMessage=function(e,t,r,o){if(this.service.isDisConnect())return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" socket is disconnect"),0;var i=this.getHeader(e);return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:i,body:t})),this.service.sendMessage(i,t,r,o)},t.prototype.on=function(e,t){this.responseRouters[e]=t},t.prototype.loginHall=function(e,t){var r={user_id:this.stateCenter.idName,device_id:this.stateCenter.priModules.deviceID,session_expire:this.stateCenter.priModules.sessionExpire,user_name:this.stateCenter.nickName,device_type:this.stateCenter.priModules.deviceType,net_type:this.stateCenter.priModules.netType,token:this.stateCenter.priModules.hallToken,an_type:this.stateCenter.priModules.anType+""};this.sendMessage("zegochat_js.user_login_ws_req",r,e,t)},t.prototype.logoutHall=function(e,t){var r={user_id:this.stateCenter.idName||0};this.sendMessage("zegochat_js.user_logout_req",r,e,t)},t.prototype.enterRoom=function(e,t){var r={room_header:{room_id:this.stateCenter.priModules.roomID,room_sid:this.stateCenter.priModules.roomSid||"0",room_user_session_id:this.stateCenter.priModules.roomSessionID||"0"},room_name:"",role:this.stateCenter.role,room_flag:this.stateCenter.priModules.roomFlag};this.sendMessage("zegochat_js.room_enter_req",r,e,t)},t.prototype.leaveRoom=function(e,t){var r={room_header:{room_id:this.stateCenter.priModules.roomID,room_sid:this.stateCenter.priModules.roomSid,room_user_session_id:this.stateCenter.priModules.roomSessionID}};this.sendMessage("zegochat_js.room_quit_req",r,e,t)},t.prototype.heartBeat=function(e,t){return this.sendMessage("zegochat_js.user_hb_req",{reserve:0},e,t)},t.prototype.fetchUserList=function(e,t,r){return this.sendMessage("zegochat_js.room_userlist_req",e,t,r)},t.prototype.fetchReliableMessage=function(e,t,r){return this.sendMessage("trans_fetch",e,t,r)},t.prototype.sendReliableMessage=function(e,t,r){return this.sendMessage("trans",e,t,r)},t.prototype.sendRoomMsg=function(e,t,r){return this.sendMessage("zegochat_js.room_im_chat",e,t,r)},t.prototype.sendCustomCommand=function(e,t,r){return this.sendMessage("zegochat_js.room_custommsg_req",e,t,r)},t.prototype.sendBigRoomMessage=function(e,t,r){return this.sendMessage("bigim_chat",e,t,r)},t.prototype.sendRelayMessage=function(e,t,r){return this.sendMessage("relay",e,t,r)},t.prototype.sendSignalCmd=function(e,t,r){return this.sendMessage("signal",e,t,r)},t}(r(10).LiveRoomService);t.LiveRoomPrivateService=c}])}])}));