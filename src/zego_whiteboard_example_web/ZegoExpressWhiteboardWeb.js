!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=288)}([function(e,t,r){"use strict";var i,o,n,a,s,c;r.d(t,"h",(function(){return i})),r.d(t,"i",(function(){return o})),r.d(t,"j",(function(){return n})),r.d(t,"k",(function(){return a})),r.d(t,"l",(function(){return s})),r.d(t,"m",(function(){return f})),r.d(t,"d",(function(){return g})),r.d(t,"g",(function(){return m})),r.d(t,"f",(function(){return v})),r.d(t,"a",(function(){return y})),r.d(t,"e",(function(){return d})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return u})),function(e){e.DisableH5ImageDrag="disableH5ImageDrag",e.DynamicPPTHD="dynamicPPT_HD",e.PptStepMode="pptStepMode",e.Domain="domain"}(i||(i={})),function(e){e[e.ZegoDocsViewSuccess=0]="ZegoDocsViewSuccess",e[e.ZegoDocsViewErrorInternal=2000001]="ZegoDocsViewErrorInternal",e[e.ZegoDocsViewErrorParamInvalid=2000002]="ZegoDocsViewErrorParamInvalid",e[e.ZegoDocsViewErrorNetworkTimeout=2000003]="ZegoDocsViewErrorNetworkTimeout",e[e.ZegoDocsViewErrorFileNotExist=2010001]="ZegoDocsViewErrorFileNotExist",e[e.ZegoDocsViewErrorUploadFailed=2010002]="ZegoDocsViewErrorUploadFailed",e[e.ZegoDocsViewErrorUnsupportRenderType=2010003]="ZegoDocsViewErrorUnsupportRenderType",e[e.ZegoDocsViewErrorFileEncrypt=2020001]="ZegoDocsViewErrorFileEncrypt",e[e.ZegoDocsViewErrorFileSizeLimit=2020002]="ZegoDocsViewErrorFileSizeLimit",e[e.ZegoDocsViewErrorFileSheetLimit=2020003]="ZegoDocsViewErrorFileSheetLimit",e[e.ZegoDocsViewErrorConvertFail=2020004]="ZegoDocsViewErrorConvertFail",e[e.ZegoDocsViewErrorConvertCancel=2020005]="ZegoDocsViewErrorConvertCancel",e[e.ZegoDocsViewErrorFileContentEmpty=2020006]="ZegoDocsViewErrorFileContentEmpty",e[e.ZegoDocsViewErrorFileReadOnly=2020007]="ZegoDocsViewErrorFileReadOnly",e[e.ZegoDocsViewErrorAuthParamInvalid=2030001]="ZegoDocsViewErrorAuthParamInvalid",e[e.ZegoDocsViewErrorFilePathNotAccess=2030002]="ZegoDocsViewErrorFilePathNotAccess",e[e.ZegoDocsViewErrorInitFailed=2030003]="ZegoDocsViewErrorInitFailed",e[e.ZegoDocsViewErrorSizeInvalid=2030004]="ZegoDocsViewErrorSizeInvalid",e[e.ZegoDocsViewErrorFreeSpaceLimit=2030005]="ZegoDocsViewErrorFreeSpaceLimit",e[e.ZegoDocsViewErrorUploadNotSupported=2030006]="ZegoDocsViewErrorUploadNotSupported",e[e.ZegoDocsViewErrorUploadDuplicated=2030007]="ZegoDocsViewErrorUploadDuplicated",e[e.ZegoDocsViewErrorEmptyDomain=2030008]="ZegoDocsViewErrorEmptyDomain",e[e.ZegoDocsViewErrorHaveInit=2030009]="ZegoDocsViewErrorHaveInit",e[e.ZegoDocsViewErrorServerFileNotExist=2030010]="ZegoDocsViewErrorServerFileNotExist"}(o||(o={})),function(e){e[e.ZegoDocsViewFileTypeUnknown=0]="ZegoDocsViewFileTypeUnknown",e[e.ZegoDocsViewFileTypePPT=1]="ZegoDocsViewFileTypePPT",e[e.ZegoDocsViewFileTypeDOC=2]="ZegoDocsViewFileTypeDOC",e[e.ZegoDocsViewFileTypeELS=4]="ZegoDocsViewFileTypeELS",e[e.ZegoDocsViewFileTypePDF=8]="ZegoDocsViewFileTypePDF",e[e.ZegoDocsViewFileTypeIMG=16]="ZegoDocsViewFileTypeIMG",e[e.ZegoDocsViewFileTypeTXT=32]="ZegoDocsViewFileTypeTXT",e[e.ZegoDocsViewFileTypeDynamicPPTH5=512]="ZegoDocsViewFileTypeDynamicPPTH5",e[e.ZegoDocsViewFileTypeAudio=1024]="ZegoDocsViewFileTypeAudio",e[e.ZegoDocsViewFileTypeVideo=2048]="ZegoDocsViewFileTypeVideo"}(n||(n={})),function(e){e[e.ZegoDocsViewRenderTypeVector=1]="ZegoDocsViewRenderTypeVector",e[e.ZegoDocsViewRenderTypeIMG=2]="ZegoDocsViewRenderTypeIMG",e[e.ZegoDocsViewRenderTypeVectorAndIMG=3]="ZegoDocsViewRenderTypeVectorAndIMG",e[e.ZegoDocsViewRenderTypeDynamicPPTH5=6]="ZegoDocsViewRenderTypeDynamicPPTH5"}(a||(a={})),function(e){e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.WAITING=4]="WAITING",e[e.CONVERTING=8]="CONVERTING",e[e.CONVERTED=16]="CONVERTED",e[e.CONVERT_FAIL=32]="CONVERT_FAIL",e[e.CONVERT_CANCEL=64]="CONVERT_CANCEL"}(s||(s={}));var d,l,u,h=((c={30001:"请求过于频繁",60011:"token无效",60012:"token已过期",60013:"文档转换请求已处理",60014:"不存在的任务ID",60015:"不支持的文件类型"})[o.ZegoDocsViewSuccess]="执行成功",c[o.ZegoDocsViewErrorInternal]="内部错误",c[o.ZegoDocsViewErrorParamInvalid]="参数错误",c[o.ZegoDocsViewErrorNetworkTimeout]="网络超时",c[o.ZegoDocsViewErrorFileNotExist]="找不到对应的本地文件",c[o.ZegoDocsViewErrorUploadFailed]="上传失败",c[o.ZegoDocsViewErrorUnsupportRenderType]="不支持渲染模式",c[o.ZegoDocsViewErrorFileEncrypt]="文件被加密",c[o.ZegoDocsViewErrorFileSizeLimit]="文件内容过大",c[o.ZegoDocsViewErrorFileSheetLimit]="文件页数过多",c[o.ZegoDocsViewErrorConvertFail]="格式转换失败",c[o.ZegoDocsViewErrorConvertCancel]="格式转换被取消",c[o.ZegoDocsViewErrorFileContentEmpty]="文件内容为空",c[o.ZegoDocsViewErrorFileReadOnly]="文件为只读模式",c[o.ZegoDocsViewErrorAuthParamInvalid]="认证参数错误",c[o.ZegoDocsViewErrorFilePathNotAccess]="路径权限不足",c[o.ZegoDocsViewErrorInitFailed]="初始化失败",c[o.ZegoDocsViewErrorSizeInvalid]="无法获取当前 view 宽高",c[o.ZegoDocsViewErrorFreeSpaceLimit]="本地空间不足",c[o.ZegoDocsViewErrorUploadNotSupported]="不支持文件上传功能",c[o.ZegoDocsViewErrorUploadDuplicated]="正在上传相同文件",c[o.ZegoDocsViewErrorEmptyDomain]="空域名",c[o.ZegoDocsViewErrorHaveInit]="已初始化",c[o.ZegoDocsViewErrorServerFileNotExist]="找不到对应的转码后文件",c),p={4:o.ZegoDocsViewErrorParamInvalid,32:o.ZegoDocsViewErrorConvertFail,64:o.ZegoDocsViewErrorConvertCancel,128:o.ZegoDocsViewErrorFileEncrypt,256:o.ZegoDocsViewErrorFileSizeLimit,512:o.ZegoDocsViewErrorFileSheetLimit,1024:o.ZegoDocsViewErrorFileContentEmpty,8192:o.ZegoDocsViewErrorFileReadOnly,60002:o.ZegoDocsViewErrorFileNotExist,60013:o.ZegoDocsViewErrorConvertCancel,60018:o.ZegoDocsViewErrorServerFileNotExist,"-102":o.ZegoDocsViewErrorNetworkTimeout,"-105":o.ZegoDocsViewErrorFileNotExist,"-109":o.ZegoDocsViewErrorUploadFailed,"-110":o.ZegoDocsViewErrorFilePathNotAccess,"-115":o.ZegoDocsViewErrorFreeSpaceLimit,"-116":o.ZegoDocsViewErrorInitFailed,"-117":o.ZegoDocsViewErrorFileSizeLimit,"-118":o.ZegoDocsViewErrorUploadNotSupported,"-119":o.ZegoDocsViewErrorUploadDuplicated,"-120":o.ZegoDocsViewErrorUnsupportRenderType,"-999998":o.ZegoDocsViewErrorSizeInvalid,"-999999":o.ZegoDocsViewErrorParamInvalid},f=function(e,t){return{code:e=p[e]||e,message:t=h[e]||t||h[o.ZegoDocsViewErrorInternal]}},g=100,m=1e3,v=2e4,y={zoom:"zego-docsview-zoom",doc:"zego-docsview-con",render:"zego-docsview-render",iframe:"zego-docsview-iframe",wb:"zego-whiteboard"};!function(e){e[e.PDF=0]="PDF",e[e.PPT=1]="PPT",e[e.H5=2]="H5"}(d||(d={})),function(e){e.Docs="zegodocsevent",e.Whiteboard="zegowbevent"}(l||(l={})),function(e){e.WbInit="wbinit",e.WbDrag="wbdrag",e.WbScale="wbscale",e.WbDestroy="wbdestroy",e.Snapshot="snapshot",e.Page="page",e.ZoomDrag="zoomdrag",e.TargetClick="targetclick",e.H5Snapshot="getH5SnapshotResult",e.DocsAspect="getAspectCache",e.ReloadView="reloadview"}(u||(u={}))},function(e,t,r){"use strict";r.d(t,"b",(function(){return d})),r.d(t,"a",(function(){return l}));r(49),r(54),r(82),r(44),r(28),r(32),r(56),r(74);var i=function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=function(){function e(e,t){this.appid="",this.roomid="",this.userid="",this.token="",this.isTestEnv=!0,this.version="",this.platform="",this.extra={},this.isProd=!1,this.isElectron=!1,this.logCacheSend=[],this.logCacheMax=100,this.platform=e||"",this.isElectron=t,this.openLogServer()}return e.prototype.init=function(e){var t=e.appid,r=e.isTestEnv,i=e.version,o=e.isProd,n=e.liveroom;this.appid=(t||this.appid)+"",this.isTestEnv=r,this.version=i||this.version,this.isProd=o,n&&!this.platform.includes("liveroom")&&(this.platform+=",liveroom")},e.prototype.initRoom=function(e){var t=e.roomid,r=e.userid,i=e.token;this.roomid=t||this.roomid,this.userid=r||this.userid,this.token=i||this.token},e.prototype.setExtraConfig=function(e){Object.assign(this.extra,e)},e.prototype.getConfig=function(){return{appid:+this.appid,roomid:this.roomid,userid:this.userid,token:this.token,isTestEnv:this.isTestEnv}},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(0,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(1,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(2,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(3,e)},e.prototype.writeLocalLog=function(e){},e.prototype.log=function(e,t){var r=this.isProd||this.isElectron?this.logParamList(e,t.join("")):t.join("");return this.isProd&&this.remoteWebSocketLog(e,r),this.isElectron&&this.writeLocalLog(r),r},e.prototype.openLogServer=function(){this.stopWebSocketServer(),this.websocket=new WebSocket("wss://weblogger-edu.zego.im/log")},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.close(),this.websocket=null)},e.prototype.remoteWebSocketLog=function(e,t){if(!("string"==typeof t&&t.length>4e3))if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState)this.openLogServer(),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var r="",i=0;i<this.logCacheSend.length;i++)(r+this.logCacheSend[i]).length>4e3&&(this.websocket.send(r),r=""),r=r+this.logCacheSend[i]+"\n";t=r+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.logParamList=function(e,t){var r=(new Date).toLocaleString(),o=t.indexOf(" "),n=t.substr(0,o)||t,a=t.substr(o+1,4500),s=i(i({time:r,level:e,action:n,content:a,appid:this.appid,userid:this.userid,roomid:this.roomid},this.extra),{version:this.version,platform:this.platform});return JSON.stringify(s)},e}(),n=function(e,t,r){var i=!(!e||!e.versions.electron);return{electron:i,platform:(i?e.platform:t)+","+r[r.length-2]+","+r[r.length-1]}}(window.process,navigator.platform,navigator.userAgent.split(" ")),a=n.electron,s=n.platform,c=a?"ec.":"web.";function d(e,t){return""+c+e+t+" "}var l=window.zegoLogger||(window.zegoLogger=new o(s,a))},function(e,t,r){var i=r(3),o=r(34).f,n=r(15),a=r(18),s=r(85),c=r(113),d=r(91);e.exports=function(e,t){var r,l,u,h,p,f=e.target,g=e.global,m=e.stat;if(r=g?i:m?i[f]||s(f,{}):(i[f]||{}).prototype)for(l in t){if(h=t[l],u=e.noTargetGet?(p=o(r,l))&&p.value:r[l],!d(g?l:f+(m?".":"#")+l,e.forced)&&void 0!==u){if(typeof h==typeof u)continue;c(h,u)}(e.sham||u&&u.sham)&&n(h,"sham",!0),a(r,l,h,e)}}},function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,r(111))},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){"use strict";var i,o=r(131),n=r(11),a=r(3),s=r(8),c=r(10),d=r(58),l=r(15),u=r(18),h=r(12).f,p=r(70),f=r(43),g=r(6),m=r(51),v=a.Int8Array,y=v&&v.prototype,S=a.Uint8ClampedArray,b=S&&S.prototype,E=v&&p(v),C=y&&p(y),_=Object.prototype,T=_.isPrototypeOf,R=g("toStringTag"),I=m("TYPED_ARRAY_TAG"),L=o&&!!f&&"Opera"!==d(a.opera),w=!1,M={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},k={BigInt64Array:8,BigUint64Array:8},P=function(e){if(!s(e))return!1;var t=d(e);return c(M,t)||c(k,t)};for(i in M)a[i]||(L=!1);if((!L||"function"!=typeof E||E===Function.prototype)&&(E=function(){throw TypeError("Incorrect invocation")},L))for(i in M)a[i]&&f(a[i],E);if((!L||!C||C===_)&&(C=E.prototype,L))for(i in M)a[i]&&f(a[i].prototype,C);if(L&&p(b)!==C&&f(b,C),n&&!c(C,R))for(i in w=!0,h(C,R,{get:function(){return s(this)?this[I]:void 0}}),M)a[i]&&l(a[i],I,i);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:L,TYPED_ARRAY_TAG:w&&I,aTypedArray:function(e){if(P(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(f){if(T.call(E,e))return e}else for(var t in M)if(c(M,i)){var r=a[t];if(r&&(e===r||T.call(r,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r){if(n){if(r)for(var i in M){var o=a[i];o&&c(o.prototype,e)&&delete o.prototype[e]}C[e]&&!r||u(C,e,r?t:L&&y[e]||t)}},exportTypedArrayStaticMethod:function(e,t,r){var i,o;if(n){if(f){if(r)for(i in M)(o=a[i])&&c(o,e)&&delete o[e];if(E[e]&&!r)return;try{return u(E,e,r?t:L&&v[e]||t)}catch(e){}}for(i in M)!(o=a[i])||o[e]&&!r||u(o,e,t)}},isView:function(e){if(!s(e))return!1;var t=d(e);return"DataView"===t||c(M,t)||c(k,t)},isTypedArray:P,TypedArray:E,TypedArrayPrototype:C}},function(e,t,r){var i=r(3),o=r(88),n=r(10),a=r(51),s=r(92),c=r(117),d=o("wks"),l=i.Symbol,u=c?l:l&&l.withoutSetter||a;e.exports=function(e){return n(d,e)||(s&&n(l,e)?d[e]=l[e]:d[e]=u("Symbol."+e)),d[e]}},function(e,t,r){var i=r(19),o=Math.min;e.exports=function(e){return e>0?o(i(e),9007199254740991):0}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var i=r(8);e.exports=function(e){if(!i(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var i=r(4);e.exports=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){var i=r(11),o=r(112),n=r(9),a=r(38),s=Object.defineProperty;t.f=i?s:function(e,t,r){if(n(e),t=a(t,!0),n(r),o)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var i=r(45),o=r(50),n=r(14),a=r(7),s=r(104),c=[].push,d=function(e){var t=1==e,r=2==e,d=3==e,l=4==e,u=6==e,h=7==e,p=5==e||u;return function(f,g,m,v){for(var y,S,b=n(f),E=o(b),C=i(g,m,3),_=a(E.length),T=0,R=v||s,I=t?R(f,_):r||h?R(f,0):void 0;_>T;T++)if((p||T in E)&&(S=C(y=E[T],T,b),e))if(t)I[T]=S;else if(S)switch(e){case 3:return!0;case 5:return y;case 6:return T;case 2:c.call(I,y)}else switch(e){case 4:return!1;case 7:c.call(I,y)}return u?-1:d||l?l:I}};e.exports={forEach:d(0),map:d(1),filter:d(2),some:d(3),every:d(4),find:d(5),findIndex:d(6),filterOut:d(7)}},function(e,t,r){var i=r(20);e.exports=function(e){return Object(i(e))}},function(e,t,r){var i=r(11),o=r(12),n=r(35);e.exports=i?function(e,t,r){return o.f(e,t,n(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){"use strict";var i=r(137),o=Object.prototype.toString;function n(e){return"[object Array]"===o.call(e)}function a(e){return void 0===e}function s(e){return null!==e&&"object"==typeof e}function c(e){return"[object Function]"===o.call(e)}function d(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),n(e))for(var r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}e.exports={isArray:n,isArrayBuffer:function(e){return"[object ArrayBuffer]"===o.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isUndefined:a,isDate:function(e){return"[object Date]"===o.call(e)},isFile:function(e){return"[object File]"===o.call(e)},isBlob:function(e){return"[object Blob]"===o.call(e)},isFunction:c,isStream:function(e){return s(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:d,merge:function e(){var t={};function r(r,i){"object"==typeof t[i]&&"object"==typeof r?t[i]=e(t[i],r):t[i]=r}for(var i=0,o=arguments.length;i<o;i++)d(arguments[i],r);return t},deepMerge:function e(){var t={};function r(r,i){"object"==typeof t[i]&&"object"==typeof r?t[i]=e(t[i],r):t[i]="object"==typeof r?e({},r):r}for(var i=0,o=arguments.length;i<o;i++)d(arguments[i],r);return t},extend:function(e,t,r){return d(t,(function(t,o){e[o]=r&&"function"==typeof t?i(t,r):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return d}));var i,o,n,a,s,c,d,l=3e4,u=36e5;!function(e){e[e.TXT=0]="TXT",e[e.MD=1]="MD",e[e.C=2]="C",e[e.CPP=3]="CPP",e[e.H=4]="H",e[e.HPP=5]="HPP",e[e.PY=6]="PY",e[e.JS=7]="JS",e[e.XML=8]="XML"}(i||(i={})),function(e){e[e.JPG=0]="JPG",e[e.JPEG=1]="JPEG",e[e.PNG=2]="PNG",e[e.BMP=3]="BMP",e[e.SVG=4]="SVG",e[e.HEIC=5]="HEIC"}(o||(o={})),function(e){e[e.PDF=0]="PDF"}(n||(n={})),function(e){e[e.XLSX=0]="XLSX",e[e.XLS=1]="XLS"}(a||(a={})),function(e){e[e.DOC=0]="DOC",e[e.DOCX=1]="DOCX"}(s||(s={})),function(e){e[e.PPT=0]="PPT",e[e.PPTX=1]="PPTX"}(c||(c={})),function(e){e[e.PPT=1]="PPT",e[e.DOC=2]="DOC",e[e.ELS=4]="ELS",e[e.PDF=8]="PDF",e[e.IMG=16]="IMG",e[e.TXT=32]="TXT",e[e.H5=64]="H5",e[e.H5PDF=128]="H5PDF",e[e.IMGAndPDF=256]="IMGAndPDF",e[e.PPTH5=512]="PPTH5"}(d||(d={}))},function(e,t,r){var i=r(3),o=r(15),n=r(10),a=r(85),s=r(86),c=r(24),d=c.get,l=c.enforce,u=String(String).split("String");(e.exports=function(e,t,r,s){var c,d=!!s&&!!s.unsafe,h=!!s&&!!s.enumerable,p=!!s&&!!s.noTargetGet;"function"==typeof r&&("string"!=typeof t||n(r,"name")||o(r,"name",t),(c=l(r)).source||(c.source=u.join("string"==typeof t?t:""))),e!==i?(d?!p&&e[t]&&(h=!0):delete e[t],h?e[t]=r:o(e,t,r)):h?e[t]=r:a(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&d(this).source||s(this)}))},function(e,t){var r=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,r){var i=r(50),o=r(20);e.exports=function(e){return i(o(e))}},function(e,t,r){var i;e.exports=(i=i||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},o=i.lib={},n=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,o=e.sigBytes;if(this.clamp(),i%4)for(var n=0;n<o;n++){var a=r[n>>>2]>>>24-n%4*8&255;t[i+n>>>2]|=a<<24-(i+n)%4*8}else for(n=0;n<o;n+=4)t[i+n>>>2]=r[n>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,i=[],o=function(t){t=t;var r=987654321,i=4294967295;return function(){var o=((r=36969*(65535&r)+(r>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},n=0;n<t;n+=4){var s=o(4294967296*(r||e.random()));r=987654071*s(),i.push(4294967296*s()|0)}return new a.init(i,t)}}),s=i.enc={},c=s.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],o=0;o<r;o++){var n=t[o>>>2]>>>24-o%4*8&255;i.push((n>>>4).toString(16)),i.push((15&n).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new a.init(r,t/2)}},d=s.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],o=0;o<r;o++){var n=t[o>>>2]>>>24-o%4*8&255;i.push(String.fromCharCode(n))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new a.init(r,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},u=o.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,i=r.words,o=r.sigBytes,n=this.blockSize,s=o/(4*n),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*n,d=e.min(4*c,o);if(c){for(var l=0;l<c;l+=n)this._doProcessBlock(i,l);var u=i.splice(0,c);r.sigBytes-=d}return new a.init(u,d)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(o.Hasher=u.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}}),i.algo={});return i}(Math),i)},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var i,o,n,a=r(197),s=r(3),c=r(8),d=r(15),l=r(10),u=r(87),h=r(64),p=r(52),f=s.WeakMap;if(a){var g=u.state||(u.state=new f),m=g.get,v=g.has,y=g.set;i=function(e,t){return t.facade=e,y.call(g,e,t),t},o=function(e){return m.call(g,e)||{}},n=function(e){return v.call(g,e)}}else{var S=h("state");p[S]=!0,i=function(e,t){return t.facade=e,d(e,S,t),t},o=function(e){return l(e,S)?e[S]:{}},n=function(e){return l(e,S)}}e.exports={set:i,get:o,has:n,enforce:function(e){return n(e)?o(e):i(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=o(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){"use strict";var i=r(2),o=r(121);i({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},function(e,t,r){var i=r(3),o=r(129),n=r(121),a=r(15);for(var s in o){var c=i[s],d=c&&c.prototype;if(d&&d.forEach!==n)try{a(d,"forEach",n)}catch(e){d.forEach=n}}},function(e,t,r){"use strict";var i=r(21),o=r(69),n=r(55),a=r(24),s=r(122),c=a.set,d=a.getterFor("Array Iterator");e.exports=s(Array,"Array",(function(e,t){c(this,{type:"Array Iterator",target:i(e),index:0,kind:t})}),(function(){var e=d(this),t=e.target,r=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:i,done:!1}:"values"==r?{value:t[i],done:!1}:{value:[i,t[i]],done:!1}}),"values"),n.Arguments=n.Array,o("keys"),o("values"),o("entries")},function(e,t,r){var i=r(2),o=r(159);i({target:"Object",stat:!0,forced:Object.assign!==o},{assign:o})},function(e,t,r){var i=r(93),o=r(18),n=r(208);i||o(Object.prototype,"toString",n,{unsafe:!0})},function(e,t,r){var i=r(19),o=Math.max,n=Math.min;e.exports=function(e,t){var r=i(e);return r<0?o(r+t,0):n(r,t)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t,r){"use strict";var i=r(2),o=r(66);i({target:"RegExp",proto:!0,forced:/./.exec!==o},{exec:o})},function(e,t,r){var i=r(9),o=r(31),n=r(6)("species");e.exports=function(e,t){var r,a=i(e).constructor;return void 0===a||null==(r=i(a)[n])?t:o(r)}},function(e,t,r){var i=r(11),o=r(75),n=r(35),a=r(21),s=r(38),c=r(10),d=r(112),l=Object.getOwnPropertyDescriptor;t.f=i?l:function(e,t){if(e=a(e),t=s(t,!0),d)try{return l(e,t)}catch(e){}if(c(e,t))return n(!o.f.call(e,t),e[t])}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var i=r(114),o=r(3),n=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?n(i[e])||n(o[e]):i[e]&&i[e][t]||o[e]&&o[e][t]}},function(e,t,r){var i,o=r(9),n=r(157),a=r(89),s=r(52),c=r(118),d=r(84),l=r(64),u=l("IE_PROTO"),h=function(){},p=function(e){return"<script>"+e+"<\/script>"},f=function(){try{i=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;f=i?function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t}(i):((t=d("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F);for(var r=a.length;r--;)delete f.prototype[a[r]];return f()};s[u]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(h.prototype=o(e),r=new h,h.prototype=null,r[u]=e):r=f(),void 0===t?r:n(r,t)}},function(e,t,r){var i=r(8);e.exports=function(e,t){if(!i(e))return e;var r,o;if(t&&"function"==typeof(r=e.toString)&&!i(o=r.call(e)))return o;if("function"==typeof(r=e.valueOf)&&!i(o=r.call(e)))return o;if(!t&&"function"==typeof(r=e.toString)&&!i(o=r.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=!1},function(e,t,r){var i=r(115),o=r(89).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,o)}},function(e,t,r){var i=r(12).f,o=r(10),n=r(6)("toStringTag");e.exports=function(e,t,r){e&&!o(e=r?e:e.prototype,n)&&i(e,n,{configurable:!0,value:t})}},function(e,t,r){"use strict";var i=r(4);e.exports=function(e,t){var r=[][e];return!!r&&i((function(){r.call(null,t||function(){throw 1},1)}))}},function(e,t,r){var i=r(9),o=r(207);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return i(r),o(n),t?e.call(r,n):r.__proto__=n,r}}():void 0)},function(e,t,r){var i=r(18),o=Date.prototype,n=o.toString,a=o.getTime;new Date(NaN)+""!="Invalid Date"&&i(o,"toString",(function(){var e=a.call(this);return e==e?n.call(this):"Invalid Date"}))},function(e,t,r){var i=r(31);e.exports=function(e,t,r){if(i(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,o){return e.call(t,r,i,o)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var i=r(11),o=r(12).f,n=Function.prototype,a=n.toString,s=/^\s*function ([^ (]*)/;i&&!("name"in n)&&o(n,"name",{configurable:!0,get:function(){try{return a.call(this).match(s)[1]}catch(e){return""}}})},function(e,t,r){"use strict";var i,o,n,a,s=r(2),c=r(39),d=r(3),l=r(36),u=r(209),h=r(18),p=r(105),f=r(41),g=r(124),m=r(8),v=r(31),y=r(71),S=r(86),b=r(210),E=r(95),C=r(33),_=r(126).set,T=r(211),R=r(213),I=r(214),L=r(128),w=r(215),M=r(24),k=r(91),P=r(6),x=r(96),D=r(106),N=P("species"),A="Promise",O=M.get,U=M.set,z=M.getterFor(A),H=u,B=d.TypeError,q=d.document,V=d.process,W=l("fetch"),F=L.f,G=F,j=!!(q&&q.createEvent&&d.dispatchEvent),Z="function"==typeof PromiseRejectionEvent,J=k(A,(function(){if(!(S(H)!==String(H))){if(66===D)return!0;if(!x&&!Z)return!0}if(c&&!H.prototype.finally)return!0;if(D>=51&&/native code/.test(H))return!1;var e=H.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[N]=t,!(e.then((function(){}))instanceof t)})),Y=J||!E((function(e){H.all(e).catch((function(){}))})),X=function(e){var t;return!(!m(e)||"function"!=typeof(t=e.then))&&t},Q=function(e,t){if(!e.notified){e.notified=!0;var r=e.reactions;T((function(){for(var i=e.value,o=1==e.state,n=0;r.length>n;){var a,s,c,d=r[n++],l=o?d.ok:d.fail,u=d.resolve,h=d.reject,p=d.domain;try{l?(o||(2===e.rejection&&te(e),e.rejection=1),!0===l?a=i:(p&&p.enter(),a=l(i),p&&(p.exit(),c=!0)),a===d.promise?h(B("Promise-chain cycle")):(s=X(a))?s.call(a,u,h):u(a)):h(i)}catch(e){p&&!c&&p.exit(),h(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&$(e)}))}},K=function(e,t,r){var i,o;j?((i=q.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),d.dispatchEvent(i)):i={promise:t,reason:r},!Z&&(o=d["on"+e])?o(i):"unhandledrejection"===e&&I("Unhandled promise rejection",r)},$=function(e){_.call(d,(function(){var t,r=e.facade,i=e.value;if(ee(e)&&(t=w((function(){x?V.emit("unhandledRejection",i,r):K("unhandledrejection",r,i)})),e.rejection=x||ee(e)?2:1,t.error))throw t.value}))},ee=function(e){return 1!==e.rejection&&!e.parent},te=function(e){_.call(d,(function(){var t=e.facade;x?V.emit("rejectionHandled",t):K("rejectionhandled",t,e.value)}))},re=function(e,t,r){return function(i){e(t,i,r)}},ie=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Q(e,!0))},oe=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw B("Promise can't be resolved itself");var i=X(t);i?T((function(){var r={done:!1};try{i.call(t,re(oe,r,e),re(ie,r,e))}catch(t){ie(r,t,e)}})):(e.value=t,e.state=1,Q(e,!1))}catch(t){ie({done:!1},t,e)}}};J&&(H=function(e){y(this,H,A),v(e),i.call(this);var t=O(this);try{e(re(oe,t),re(ie,t))}catch(e){ie(t,e)}},(i=function(e){U(this,{type:A,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=p(H.prototype,{then:function(e,t){var r=z(this),i=F(C(this,H));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=x?V.domain:void 0,r.parent=!0,r.reactions.push(i),0!=r.state&&Q(r,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new i,t=O(e);this.promise=e,this.resolve=re(oe,t),this.reject=re(ie,t)},L.f=F=function(e){return e===H||e===n?new o(e):G(e)},c||"function"!=typeof u||(a=u.prototype.then,h(u.prototype,"then",(function(e,t){var r=this;return new H((function(e,t){a.call(r,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof W&&s({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return R(H,W.apply(d,arguments))}}))),s({global:!0,wrap:!0,forced:J},{Promise:H}),f(H,A,!1,!0),g(A),n=l(A),s({target:A,stat:!0,forced:J},{reject:function(e){var t=F(this);return t.reject.call(void 0,e),t.promise}}),s({target:A,stat:!0,forced:c||J},{resolve:function(e){return R(c&&this===n?H:this,e)}}),s({target:A,stat:!0,forced:Y},{all:function(e){var t=this,r=F(t),i=r.resolve,o=r.reject,n=w((function(){var r=v(t.resolve),n=[],a=0,s=1;b(e,(function(e){var c=a++,d=!1;n.push(void 0),s++,r.call(t,e).then((function(e){d||(d=!0,n[c]=e,--s||i(n))}),o)})),--s||i(n)}));return n.error&&o(n.value),r.promise},race:function(e){var t=this,r=F(t),i=r.reject,o=w((function(){var o=v(t.resolve);b(e,(function(e){o.call(t,e).then(r.resolve,i)}))}));return o.error&&i(o.value),r.promise}})},function(e,t,r){"use strict";var i=r(102).charAt,o=r(24),n=r(122),a=o.set,s=o.getterFor("String Iterator");n(String,"String",(function(e){a(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=s(this),r=t.string,o=t.index;return o>=r.length?{value:void 0,done:!0}:(e=i(r,o),t.index+=e.length,{value:e,done:!1})}))},function(e,t,r){"use strict";var i=r(2),o=r(53).includes,n=r(69);i({target:"Array",proto:!0},{includes:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),n("includes")},function(e,t,r){var i=r(4),o=r(23),n="".split;e.exports=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==o(e)?n.call(e,""):Object(e)}:Object},function(e,t){var r=0,i=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++r+i).toString(36)}},function(e,t){e.exports={}},function(e,t,r){var i=r(21),o=r(7),n=r(30),a=function(e){return function(t,r,a){var s,c=i(t),d=o(c.length),l=n(a,d);if(e&&r!=r){for(;d>l;)if((s=c[l++])!=s)return!0}else for(;d>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},function(e,t,r){"use strict";var i=r(2),o=r(53).indexOf,n=r(42),a=[].indexOf,s=!!a&&1/[1].indexOf(1,-0)<0,c=n("indexOf");i({target:"Array",proto:!0,forced:s||!c},{indexOf:function(e){return s?a.apply(this,arguments)||0:o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t){e.exports={}},function(e,t,r){"use strict";var i=r(2),o=r(194),n=r(20);i({target:"String",proto:!0,forced:!r(195)("includes")},{includes:function(e){return!!~String(n(this)).indexOf(o(e),arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var i=r(100),o=r(9),n=r(7),a=r(19),s=r(20),c=r(101),d=r(201),l=r(103),u=Math.max,h=Math.min;i("replace",2,(function(e,t,r,i){var p=i.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,f=i.REPLACE_KEEPS_$0,g=p?"$":"$0";return[function(r,i){var o=s(this),n=null==r?void 0:r[e];return void 0!==n?n.call(r,o,i):t.call(String(o),r,i)},function(e,i){if(!p&&f||"string"==typeof i&&-1===i.indexOf(g)){var s=r(t,e,this,i);if(s.done)return s.value}var m=o(e),v=String(this),y="function"==typeof i;y||(i=String(i));var S=m.global;if(S){var b=m.unicode;m.lastIndex=0}for(var E=[];;){var C=l(m,v);if(null===C)break;if(E.push(C),!S)break;""===String(C[0])&&(m.lastIndex=c(v,n(m.lastIndex),b))}for(var _,T="",R=0,I=0;I<E.length;I++){C=E[I];for(var L=String(C[0]),w=u(h(a(C.index),v.length),0),M=[],k=1;k<C.length;k++)M.push(void 0===(_=C[k])?_:String(_));var P=C.groups;if(y){var x=[L].concat(M,w,v);void 0!==P&&x.push(P);var D=String(i.apply(void 0,x))}else D=d(L,v,w,M,P,i);w>=R&&(T+=v.slice(R,w)+D,R=w+L.length)}return T+v.slice(R)}]}))},function(e,t,r){var i=r(93),o=r(23),n=r(6)("toStringTag"),a="Arguments"==o(function(){return arguments}());e.exports=i?o:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),n))?r:a?o(t):"Object"==(i=o(t))&&"function"==typeof t.callee?"Arguments":i}},function(e,t,r){var i=r(36);e.exports=i("navigator","userAgent")||""},function(e,t,r){var i=r(2),o=r(3),n=r(59),a=[].slice,s=function(e){return function(t,r){var i=arguments.length>2,o=i?a.call(arguments,2):void 0;return e(i?function(){("function"==typeof t?t:Function(t)).apply(this,o)}:t,r)}};i({global:!0,bind:!0,forced:/MSIE .\./.test(n)},{setTimeout:s(o.setTimeout),setInterval:s(o.setInterval)})},function(e,t,r){var i=r(4),o=r(6),n=r(106),a=o("species");e.exports=function(e){return n>=51||!i((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,r){"use strict";var i=r(2),o=r(8),n=r(67),a=r(30),s=r(7),c=r(21),d=r(80),l=r(6),u=r(61)("slice"),h=l("species"),p=[].slice,f=Math.max;i({target:"Array",proto:!0,forced:!u},{slice:function(e,t){var r,i,l,u=c(this),g=s(u.length),m=a(e,g),v=a(void 0===t?g:t,g);if(n(u)&&("function"!=typeof(r=u.constructor)||r!==Array&&!n(r.prototype)?o(r)&&null===(r=r[h])&&(r=void 0):r=void 0,r===Array||void 0===r))return p.call(u,m,v);for(i=new(void 0===r?Array:r)(f(v-m,0)),l=0;m<v;m++,l++)m in u&&d(i,l,u[m]);return i.length=l,i}})},function(e,t,r){"use strict";var i=r(11),o=r(3),n=r(91),a=r(18),s=r(10),c=r(23),d=r(135),l=r(38),u=r(4),h=r(37),p=r(40).f,f=r(34).f,g=r(12).f,m=r(148).trim,v=o.Number,y=v.prototype,S="Number"==c(h(y)),b=function(e){var t,r,i,o,n,a,s,c,d=l(e,!1);if("string"==typeof d&&d.length>2)if(43===(t=(d=m(d)).charCodeAt(0))||45===t){if(88===(r=d.charCodeAt(2))||120===r)return NaN}else if(48===t){switch(d.charCodeAt(1)){case 66:case 98:i=2,o=49;break;case 79:case 111:i=8,o=55;break;default:return+d}for(a=(n=d.slice(2)).length,s=0;s<a;s++)if((c=n.charCodeAt(s))<48||c>o)return NaN;return parseInt(n,i)}return+d};if(n("Number",!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var E,C=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof C&&(S?u((function(){y.valueOf.call(r)})):"Number"!=c(r))?d(new v(b(t)),r,C):b(t)},_=i?p(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),T=0;_.length>T;T++)s(v,E=_[T])&&!s(C,E)&&g(C,E,f(v,E));C.prototype=y,y.constructor=C,a(o,"Number",C)}},function(e,t,r){var i=r(88),o=r(51),n=i("keys");e.exports=function(e){return n[e]||(n[e]=o(e))}},function(e,t,r){r(2)({target:"Function",proto:!0},{bind:r(199)})},function(e,t,r){"use strict";var i,o,n=r(116),a=r(200),s=RegExp.prototype.exec,c=String.prototype.replace,d=s,l=(i=/a/,o=/b*/g,s.call(i,"a"),s.call(o,"a"),0!==i.lastIndex||0!==o.lastIndex),u=a.UNSUPPORTED_Y||a.BROKEN_CARET,h=void 0!==/()??/.exec("")[1];(l||h||u)&&(d=function(e){var t,r,i,o,a=this,d=u&&a.sticky,p=n.call(a),f=a.source,g=0,m=e;return d&&(-1===(p=p.replace("y","")).indexOf("g")&&(p+="g"),m=String(e).slice(a.lastIndex),a.lastIndex>0&&(!a.multiline||a.multiline&&"\n"!==e[a.lastIndex-1])&&(f="(?: "+f+")",m=" "+m,g++),r=new RegExp("^(?:"+f+")",p)),h&&(r=new RegExp("^"+f+"$(?!\\s)",p)),l&&(t=a.lastIndex),i=s.call(d?r:a,m),d?i?(i.input=i.input.slice(g),i[0]=i[0].slice(g),i.index=a.lastIndex,a.lastIndex+=i[0].length):a.lastIndex=0:l&&i&&(a.lastIndex=a.global?i.index+i[0].length:t),h&&i&&i.length>1&&c.call(i[0],r,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i}),e.exports=d},function(e,t,r){var i=r(23);e.exports=Array.isArray||function(e){return"Array"==i(e)}},function(e,t,r){var i=r(115),o=r(89);e.exports=Object.keys||function(e){return i(e,o)}},function(e,t,r){var i=r(6),o=r(37),n=r(12),a=i("unscopables"),s=Array.prototype;null==s[a]&&n.f(s,a,{configurable:!0,value:o(null)}),e.exports=function(e){s[a][e]=!0}},function(e,t,r){var i=r(10),o=r(14),n=r(64),a=r(206),s=n("IE_PROTO"),c=Object.prototype;e.exports=a?Object.getPrototypeOf:function(e){return e=o(e),i(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?c:null}},function(e,t){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}},function(e,t,r){var i=r(58),o=r(55),n=r(6)("iterator");e.exports=function(e){if(null!=e)return e[n]||e["@@iterator"]||o[i(e)]}},function(e,t,r){var i=r(3),o=r(129),n=r(27),a=r(15),s=r(6),c=s("iterator"),d=s("toStringTag"),l=n.values;for(var u in o){var h=i[u],p=h&&h.prototype;if(p){if(p[c]!==l)try{a(p,c,l)}catch(e){p[c]=l}if(p[d]||a(p,d,u),o[u])for(var f in n)if(p[f]!==n[f])try{a(p,f,n[f])}catch(e){p[f]=n[f]}}}},function(e,t,r){"use strict";var i=r(100),o=r(133),n=r(9),a=r(20),s=r(33),c=r(101),d=r(7),l=r(103),u=r(66),h=r(4),p=[].push,f=Math.min,g=!h((function(){return!RegExp(4294967295,"y")}));i("split",2,(function(e,t,r){var i;return i="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var i=String(a(this)),n=void 0===r?4294967295:r>>>0;if(0===n)return[];if(void 0===e)return[i];if(!o(e))return t.call(i,e,n);for(var s,c,d,l=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,g=new RegExp(e.source,h+"g");(s=u.call(g,i))&&!((c=g.lastIndex)>f&&(l.push(i.slice(f,s.index)),s.length>1&&s.index<i.length&&p.apply(l,s.slice(1)),d=s[0].length,f=c,l.length>=n));)g.lastIndex===s.index&&g.lastIndex++;return f===i.length?!d&&g.test("")||l.push(""):l.push(i.slice(f)),l.length>n?l.slice(0,n):l}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:t.call(this,e,r)}:t,[function(t,r){var o=a(this),n=null==t?void 0:t[e];return void 0!==n?n.call(t,o,r):i.call(String(o),t,r)},function(e,o){var a=r(i,e,this,o,i!==t);if(a.done)return a.value;var u=n(e),h=String(this),p=s(u,RegExp),m=u.unicode,v=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(g?"y":"g"),y=new p(g?u:"^(?:"+u.source+")",v),S=void 0===o?4294967295:o>>>0;if(0===S)return[];if(0===h.length)return null===l(y,h)?[h]:[];for(var b=0,E=0,C=[];E<h.length;){y.lastIndex=g?E:0;var _,T=l(y,g?h:h.slice(E));if(null===T||(_=f(d(y.lastIndex+(g?0:E)),h.length))===b)E=c(h,E,m);else{if(C.push(h.slice(b,E)),C.length===S)return C;for(var R=1;R<=T.length-1;R++)if(C.push(T[R]),C.length===S)return C;E=b=_}}return C.push(h.slice(b)),C}]}),!g)},function(e,t,r){"use strict";var i={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,n=o&&!i.call({1:2},1);t.f=n?function(e){var t=o(this,e);return!!t&&t.enumerable}:i},function(e,t,r){"use strict";var i=r(2),o=r(3),n=r(36),a=r(39),s=r(11),c=r(92),d=r(117),l=r(4),u=r(10),h=r(67),p=r(8),f=r(9),g=r(14),m=r(21),v=r(38),y=r(35),S=r(37),b=r(68),E=r(40),C=r(205),_=r(90),T=r(34),R=r(12),I=r(75),L=r(15),w=r(18),M=r(88),k=r(64),P=r(52),x=r(51),D=r(6),N=r(119),A=r(120),O=r(41),U=r(24),z=r(13).forEach,H=k("hidden"),B=D("toPrimitive"),q=U.set,V=U.getterFor("Symbol"),W=Object.prototype,F=o.Symbol,G=n("JSON","stringify"),j=T.f,Z=R.f,J=C.f,Y=I.f,X=M("symbols"),Q=M("op-symbols"),K=M("string-to-symbol-registry"),$=M("symbol-to-string-registry"),ee=M("wks"),te=o.QObject,re=!te||!te.prototype||!te.prototype.findChild,ie=s&&l((function(){return 7!=S(Z({},"a",{get:function(){return Z(this,"a",{value:7}).a}})).a}))?function(e,t,r){var i=j(W,t);i&&delete W[t],Z(e,t,r),i&&e!==W&&Z(W,t,i)}:Z,oe=function(e,t){var r=X[e]=S(F.prototype);return q(r,{type:"Symbol",tag:e,description:t}),s||(r.description=t),r},ne=d?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof F},ae=function(e,t,r){e===W&&ae(Q,t,r),f(e);var i=v(t,!0);return f(r),u(X,i)?(r.enumerable?(u(e,H)&&e[H][i]&&(e[H][i]=!1),r=S(r,{enumerable:y(0,!1)})):(u(e,H)||Z(e,H,y(1,{})),e[H][i]=!0),ie(e,i,r)):Z(e,i,r)},se=function(e,t){f(e);var r=m(t),i=b(r).concat(ue(r));return z(i,(function(t){s&&!ce.call(r,t)||ae(e,t,r[t])})),e},ce=function(e){var t=v(e,!0),r=Y.call(this,t);return!(this===W&&u(X,t)&&!u(Q,t))&&(!(r||!u(this,t)||!u(X,t)||u(this,H)&&this[H][t])||r)},de=function(e,t){var r=m(e),i=v(t,!0);if(r!==W||!u(X,i)||u(Q,i)){var o=j(r,i);return!o||!u(X,i)||u(r,H)&&r[H][i]||(o.enumerable=!0),o}},le=function(e){var t=J(m(e)),r=[];return z(t,(function(e){u(X,e)||u(P,e)||r.push(e)})),r},ue=function(e){var t=e===W,r=J(t?Q:m(e)),i=[];return z(r,(function(e){!u(X,e)||t&&!u(W,e)||i.push(X[e])})),i};(c||(w((F=function(){if(this instanceof F)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=x(e),r=function(e){this===W&&r.call(Q,e),u(this,H)&&u(this[H],t)&&(this[H][t]=!1),ie(this,t,y(1,e))};return s&&re&&ie(W,t,{configurable:!0,set:r}),oe(t,e)}).prototype,"toString",(function(){return V(this).tag})),w(F,"withoutSetter",(function(e){return oe(x(e),e)})),I.f=ce,R.f=ae,T.f=de,E.f=C.f=le,_.f=ue,N.f=function(e){return oe(D(e),e)},s&&(Z(F.prototype,"description",{configurable:!0,get:function(){return V(this).description}}),a||w(W,"propertyIsEnumerable",ce,{unsafe:!0}))),i({global:!0,wrap:!0,forced:!c,sham:!c},{Symbol:F}),z(b(ee),(function(e){A(e)})),i({target:"Symbol",stat:!0,forced:!c},{for:function(e){var t=String(e);if(u(K,t))return K[t];var r=F(t);return K[t]=r,$[r]=t,r},keyFor:function(e){if(!ne(e))throw TypeError(e+" is not a symbol");if(u($,e))return $[e]},useSetter:function(){re=!0},useSimple:function(){re=!1}}),i({target:"Object",stat:!0,forced:!c,sham:!s},{create:function(e,t){return void 0===t?S(e):se(S(e),t)},defineProperty:ae,defineProperties:se,getOwnPropertyDescriptor:de}),i({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:le,getOwnPropertySymbols:ue}),i({target:"Object",stat:!0,forced:l((function(){_.f(1)}))},{getOwnPropertySymbols:function(e){return _.f(g(e))}}),G)&&i({target:"JSON",stat:!0,forced:!c||l((function(){var e=F();return"[null]"!=G([e])||"{}"!=G({a:e})||"{}"!=G(Object(e))}))},{stringify:function(e,t,r){for(var i,o=[e],n=1;arguments.length>n;)o.push(arguments[n++]);if(i=t,(p(t)||void 0!==e)&&!ne(e))return h(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!ne(t))return t}),o[1]=t,G.apply(null,o)}});F.prototype[B]||L(F.prototype,B,F.prototype.valueOf),O(F,"Symbol"),P[H]=!0},function(e,t,r){"use strict";var i=r(2),o=r(11),n=r(3),a=r(10),s=r(8),c=r(12).f,d=r(113),l=n.Symbol;if(o&&"function"==typeof l&&(!("description"in l.prototype)||void 0!==l().description)){var u={},h=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof h?new l(e):void 0===e?l():l(e);return""===e&&(u[t]=!0),t};d(h,l);var p=h.prototype=l.prototype;p.constructor=h;var f=p.toString,g="Symbol(test)"==String(l("test")),m=/^Symbol\((.*)\)[^)]+$/;c(p,"description",{configurable:!0,get:function(){var e=s(this)?this.valueOf():this,t=f.call(e);if(a(u,e))return"";var r=g?t.slice(7,-1):t.replace(m,"$1");return""===r?void 0:r}}),i({global:!0,forced:!0},{Symbol:h})}},function(e,t,r){r(120)("iterator")},function(e,t,r){"use strict";var i=r(2),o=r(13).map;i({target:"Array",proto:!0,forced:!r(61)("map")},{map:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var i=r(38),o=r(12),n=r(35);e.exports=function(e,t,r){var a=i(t);a in e?o.f(e,a,n(0,r)):e[a]=r}},function(e,t,r){"use strict";var i=r(2),o=r(13).filter;i({target:"Array",proto:!0,forced:!r(61)("filter")},{filter:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var i=r(2),o=r(50),n=r(21),a=r(42),s=[].join,c=o!=Object,d=a("join",",");i({target:"Array",proto:!0,forced:c||!d},{join:function(e){return s.call(n(this),void 0===e?",":e)}})},function(e,t,r){var i,o,n;e.exports=(n=r(22),o=(i=n).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,i=this._map;e.clamp();for(var o=[],n=0;n<r;n+=3)for(var a=(t[n>>>2]>>>24-n%4*8&255)<<16|(t[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|t[n+2>>>2]>>>24-(n+2)%4*8&255,s=0;s<4&&n+.75*s<r;s++)o.push(i.charAt(a>>>6*(3-s)&63));var c=i.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(e){var t=e.length,r=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var n=0;n<r.length;n++)i[r.charCodeAt(n)]=n}var a=r.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,r){for(var i=[],n=0,a=0;a<t;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2,c=r[e.charCodeAt(a)]>>>6-a%4*2;i[n>>>2]|=(s|c)<<24-n%4*8,n++}return o.create(i,n)}(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)},function(e,t,r){var i=r(3),o=r(8),n=i.document,a=o(n)&&o(n.createElement);e.exports=function(e){return a?n.createElement(e):{}}},function(e,t,r){var i=r(3),o=r(15);e.exports=function(e,t){try{o(i,e,t)}catch(r){i[e]=t}return t}},function(e,t,r){var i=r(87),o=Function.toString;"function"!=typeof i.inspectSource&&(i.inspectSource=function(e){return o.call(e)}),e.exports=i.inspectSource},function(e,t,r){var i=r(3),o=r(85),n=i["__core-js_shared__"]||o("__core-js_shared__",{});e.exports=n},function(e,t,r){var i=r(39),o=r(87);(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.9.0",mode:i?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var i=r(4),o=/#|\.prototype\./,n=function(e,t){var r=s[a(e)];return r==d||r!=c&&("function"==typeof t?i(t):!!t)},a=n.normalize=function(e){return String(e).replace(o,".").toLowerCase()},s=n.data={},c=n.NATIVE="N",d=n.POLYFILL="P";e.exports=n},function(e,t,r){var i=r(4);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())}))},function(e,t,r){var i={};i[r(6)("toStringTag")]="z",e.exports="[object z]"===String(i)},function(e,t,r){var i=r(6),o=r(55),n=i("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||a[n]===e)}},function(e,t,r){var i=r(6)("iterator"),o=!1;try{var n=0,a={next:function(){return{done:!!n++}},return:function(){o=!0}};a[i]=function(){return this},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var r=!1;try{var n={};n[i]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r}},function(e,t,r){var i=r(23),o=r(3);e.exports="process"==i(o.process)},function(e,t,r){"use strict";var i=r(2),o=r(30),n=r(19),a=r(7),s=r(14),c=r(104),d=r(80),l=r(61)("splice"),u=Math.max,h=Math.min;i({target:"Array",proto:!0,forced:!l},{splice:function(e,t){var r,i,l,p,f,g,m=s(this),v=a(m.length),y=o(e,v),S=arguments.length;if(0===S?r=i=0:1===S?(r=0,i=v-y):(r=S-2,i=h(u(n(t),0),v-y)),v+r-i>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(l=c(m,i),p=0;p<i;p++)(f=y+p)in m&&d(l,p,m[f]);if(l.length=i,r<i){for(p=y;p<v-i;p++)g=p+r,(f=p+i)in m?m[g]=m[f]:delete m[g];for(p=v;p>v-i+r;p--)delete m[p-1]}else if(r>i)for(p=v-i;p>y;p--)g=p+r-1,(f=p+i-1)in m?m[g]=m[f]:delete m[g];for(p=0;p<r;p++)m[p+y]=arguments[p+2];return m.length=v-i+r,l}})},function(e,t,r){"use strict";r.d(t,"b",(function(){return p})),r.d(t,"a",(function(){return f}));r(62),r(238),r(44),r(29),r(47);var i=r(154),o=r.n(i),n=r(83),a=r.n(n),s=r(155),c=r.n(s),d=r(0),l=r(156),u=r.n(l),h=function(e,t){return a.a.stringify(c()(t,e))},p=function(e){var t=e.access_key_id,r=e.access_key_secret,i=e.bucket_name,n=e.security_token,a=e.endpoint,s=e.object_name,c=e.timeout,d=void 0===c?1:c,l=e.maxSize,u=function(e,t){var r=new Date;r.setHours(r.getHours()+e);var i={expiration:r.toISOString(),conditions:[["content-length-range",0,1024*t*1024]]};return o.a.Base64.encode(JSON.stringify(i))}(d,void 0===l?150:l);return{url:"https://"+i+"."+a,signature:h(r,u),securityToken:n,policy:u,key:s,OSSAccessKeyId:t,successActionStatus:"200",objectName:s}},f=function(e){return new Promise((function(t,r){try{var i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,o=Math.ceil(e.size/1048576),n=new u.a.ArrayBuffer,a=0,s=new FileReader;s.onload=function(){var e=s.result||s.content;e?(n.append(e),++a<o?c():t(n.end())):r(Object(d.m)(d.i.ZegoDocsViewErrorFileContentEmpty))},s.onerror=function(){r(Object(d.m)(d.i.ZegoDocsViewErrorFileNotExist))};var c=function(){var t=1048576*a,r=t+1048576>=e.size?e.size:t+1048576,o=i.call(e,t,r);s.readAsArrayBuffer(o)};c()}catch(e){r(e)}}))}},,function(e,t,r){"use strict";r(32);var i=r(18),o=r(4),n=r(6),a=r(66),s=r(15),c=n("species"),d=!o((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),l="$0"==="a".replace(/./,"$0"),u=n("replace"),h=!!/./[u]&&""===/./[u]("a","$0"),p=!o((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}));e.exports=function(e,t,r,u){var f=n(e),g=!o((function(){var t={};return t[f]=function(){return 7},7!=""[e](t)})),m=g&&!o((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[c]=function(){return r},r.flags="",r[f]=/./[f]),r.exec=function(){return t=!0,null},r[f](""),!t}));if(!g||!m||"replace"===e&&(!d||!l||h)||"split"===e&&!p){var v=/./[f],y=r(f,""[e],(function(e,t,r,i,o){return t.exec===a?g&&!o?{done:!0,value:v.call(t,r,i)}:{done:!0,value:e.call(r,t,i)}:{done:!1}}),{REPLACE_KEEPS_$0:l,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:h}),S=y[0],b=y[1];i(String.prototype,e,S),i(RegExp.prototype,f,2==t?function(e,t){return b.call(e,this,t)}:function(e){return b.call(e,this)})}u&&s(RegExp.prototype[f],"sham",!0)}},function(e,t,r){"use strict";var i=r(102).charAt;e.exports=function(e,t,r){return t+(r?i(e,t).length:1)}},function(e,t,r){var i=r(19),o=r(20),n=function(e){return function(t,r){var n,a,s=String(o(t)),c=i(r),d=s.length;return c<0||c>=d?e?"":void 0:(n=s.charCodeAt(c))<55296||n>56319||c+1===d||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):n:e?s.slice(c,c+2):a-56320+(n-55296<<10)+65536}};e.exports={codeAt:n(!1),charAt:n(!0)}},function(e,t,r){var i=r(23),o=r(66);e.exports=function(e,t){var r=e.exec;if("function"==typeof r){var n=r.call(e,t);if("object"!=typeof n)throw TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==i(e))throw TypeError("RegExp#exec called on incompatible receiver");return o.call(e,t)}},function(e,t,r){var i=r(8),o=r(67),n=r(6)("species");e.exports=function(e,t){var r;return o(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!o(r.prototype)?i(r)&&null===(r=r[n])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)}},function(e,t,r){var i=r(18);e.exports=function(e,t,r){for(var o in t)i(e,o,t[o],r);return e}},function(e,t,r){var i,o,n=r(3),a=r(59),s=n.process,c=s&&s.versions,d=c&&c.v8;d?o=(i=d.split("."))[0]+i[1]:a&&(!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=a.match(/Chrome\/(\d+)/))&&(o=i[1]),e.exports=o&&+o},function(e,t,r){"use strict";var i=r(14),o=r(30),n=r(7);e.exports=function(e){for(var t=i(this),r=n(t.length),a=arguments.length,s=o(a>1?arguments[1]:void 0,r),c=a>2?arguments[2]:void 0,d=void 0===c?r:o(c,r);d>s;)t[s++]=e;return t}},function(e,t,r){"use strict";var i=r(2),o=r(31),n=r(14),a=r(4),s=r(42),c=[],d=c.sort,l=a((function(){c.sort(void 0)})),u=a((function(){c.sort(null)})),h=s("sort");i({target:"Array",proto:!0,forced:l||!u||!h},{sort:function(e){return void 0===e?d.call(n(this)):d.call(n(this),o(e))}})},function(e,t,r){"use strict";var i=r(2),o=r(19),n=r(241),a=r(145),s=r(4),c=1..toFixed,d=Math.floor,l=function(e,t,r){return 0===t?r:t%2==1?l(e,t-1,r*e):l(e*e,t/2,r)},u=function(e,t,r){for(var i=-1,o=r;++i<6;)o+=t*e[i],e[i]=o%1e7,o=d(o/1e7)},h=function(e,t){for(var r=6,i=0;--r>=0;)i+=e[r],e[r]=d(i/t),i=i%t*1e7},p=function(e){for(var t=6,r="";--t>=0;)if(""!==r||0===t||0!==e[t]){var i=String(e[t]);r=""===r?i:r+a.call("0",7-i.length)+i}return r};i({target:"Number",proto:!0,forced:c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!s((function(){c.call({})}))},{toFixed:function(e){var t,r,i,s,c=n(this),d=o(e),f=[0,0,0,0,0,0],g="",m="0";if(d<0||d>20)throw RangeError("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(g="-",c=-c),c>1e-21)if(r=(t=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t}(c*l(2,69,1))-69)<0?c*l(2,-t,1):c/l(2,t,1),r*=4503599627370496,(t=52-t)>0){for(u(f,0,r),i=d;i>=7;)u(f,1e7,0),i-=7;for(u(f,l(10,i,1),0),i=t-1;i>=23;)h(f,1<<23),i-=23;h(f,1<<i),u(f,1,1),h(f,2),m=p(f)}else u(f,0,r),u(f,1<<-t,0),m=p(f)+a.call("0",d);return m=d>0?g+((s=m.length)<=d?"0."+a.call("0",d-s)+m:m.slice(0,s-d)+"."+m.slice(s-d)):g+m}})},function(e,t,r){r(2)({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var i=r(11),o=r(4),n=r(84);e.exports=!i&&!o((function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var i=r(10),o=r(198),n=r(34),a=r(12);e.exports=function(e,t){for(var r=o(t),s=a.f,c=n.f,d=0;d<r.length;d++){var l=r[d];i(e,l)||s(e,l,c(t,l))}}},function(e,t,r){var i=r(3);e.exports=i},function(e,t,r){var i=r(10),o=r(21),n=r(53).indexOf,a=r(52);e.exports=function(e,t){var r,s=o(e),c=0,d=[];for(r in s)!i(a,r)&&i(s,r)&&d.push(r);for(;t.length>c;)i(s,r=t[c++])&&(~n(d,r)||d.push(r));return d}},function(e,t,r){"use strict";var i=r(9);e.exports=function(){var e=i(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,r){var i=r(92);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var i=r(36);e.exports=i("document","documentElement")},function(e,t,r){var i=r(6);t.f=i},function(e,t,r){var i=r(114),o=r(10),n=r(119),a=r(12).f;e.exports=function(e){var t=i.Symbol||(i.Symbol={});o(t,e)||a(t,e,{value:n.f(e)})}},function(e,t,r){"use strict";var i=r(13).forEach,o=r(42)("forEach");e.exports=o?[].forEach:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,r){"use strict";var i=r(2),o=r(158),n=r(70),a=r(43),s=r(41),c=r(15),d=r(18),l=r(6),u=r(39),h=r(55),p=r(123),f=p.IteratorPrototype,g=p.BUGGY_SAFARI_ITERATORS,m=l("iterator"),v=function(){return this};e.exports=function(e,t,r,l,p,y,S){o(r,t,l);var b,E,C,_=function(e){if(e===p&&w)return w;if(!g&&e in I)return I[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},T=t+" Iterator",R=!1,I=e.prototype,L=I[m]||I["@@iterator"]||p&&I[p],w=!g&&L||_(p),M="Array"==t&&I.entries||L;if(M&&(b=n(M.call(new e)),f!==Object.prototype&&b.next&&(u||n(b)===f||(a?a(b,f):"function"!=typeof b[m]&&c(b,m,v)),s(b,T,!0,!0),u&&(h[T]=v))),"values"==p&&L&&"values"!==L.name&&(R=!0,w=function(){return L.call(this)}),u&&!S||I[m]===w||c(I,m,w),h[t]=w,p)if(E={values:_("values"),keys:y?w:_("keys"),entries:_("entries")},S)for(C in E)(g||R||!(C in I))&&d(I,C,E[C]);else i({target:t,proto:!0,forced:g||R},E);return E}},function(e,t,r){"use strict";var i,o,n,a=r(4),s=r(70),c=r(15),d=r(10),l=r(6),u=r(39),h=l("iterator"),p=!1;[].keys&&("next"in(n=[].keys())?(o=s(s(n)))!==Object.prototype&&(i=o):p=!0);var f=null==i||a((function(){var e={};return i[h].call(e)!==e}));f&&(i={}),u&&!f||d(i,h)||c(i,h,(function(){return this})),e.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:p}},function(e,t,r){"use strict";var i=r(36),o=r(12),n=r(6),a=r(11),s=n("species");e.exports=function(e){var t=i(e),r=o.f;a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var i=r(9);e.exports=function(e){var t=e.return;if(void 0!==t)return i(t.call(e)).value}},function(e,t,r){var i,o,n,a=r(3),s=r(4),c=r(45),d=r(118),l=r(84),u=r(127),h=r(96),p=a.location,f=a.setImmediate,g=a.clearImmediate,m=a.process,v=a.MessageChannel,y=a.Dispatch,S=0,b={},E=function(e){if(b.hasOwnProperty(e)){var t=b[e];delete b[e],t()}},C=function(e){return function(){E(e)}},_=function(e){E(e.data)},T=function(e){a.postMessage(e+"",p.protocol+"//"+p.host)};f&&g||(f=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return b[++S]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},i(S),S},g=function(e){delete b[e]},h?i=function(e){m.nextTick(C(e))}:y&&y.now?i=function(e){y.now(C(e))}:v&&!u?(n=(o=new v).port2,o.port1.onmessage=_,i=c(n.postMessage,n,1)):a.addEventListener&&"function"==typeof postMessage&&!a.importScripts&&p&&"file:"!==p.protocol&&!s(T)?(i=T,a.addEventListener("message",_,!1)):i="onreadystatechange"in l("script")?function(e){d.appendChild(l("script")).onreadystatechange=function(){d.removeChild(this),E(e)}}:function(e){setTimeout(C(e),0)}),e.exports={set:f,clear:g}},function(e,t,r){var i=r(59);e.exports=/(iphone|ipod|ipad).*applewebkit/i.test(i)},function(e,t,r){"use strict";var i=r(31),o=function(e){var t,r;this.promise=new e((function(e,i){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=i})),this.resolve=i(t),this.reject=i(r)};e.exports.f=function(e){return new o(e)}},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,r){"use strict";var i=r(3),o=r(11),n=r(131),a=r(15),s=r(105),c=r(4),d=r(71),l=r(19),u=r(7),h=r(132),p=r(216),f=r(70),g=r(43),m=r(40).f,v=r(12).f,y=r(107),S=r(41),b=r(24),E=b.get,C=b.set,_=i.ArrayBuffer,T=_,R=i.DataView,I=R&&R.prototype,L=Object.prototype,w=i.RangeError,M=p.pack,k=p.unpack,P=function(e){return[255&e]},x=function(e){return[255&e,e>>8&255]},D=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},N=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},A=function(e){return M(e,23,4)},O=function(e){return M(e,52,8)},U=function(e,t){v(e.prototype,t,{get:function(){return E(this)[t]}})},z=function(e,t,r,i){var o=h(r),n=E(e);if(o+t>n.byteLength)throw w("Wrong index");var a=E(n.buffer).bytes,s=o+n.byteOffset,c=a.slice(s,s+t);return i?c:c.reverse()},H=function(e,t,r,i,o,n){var a=h(r),s=E(e);if(a+t>s.byteLength)throw w("Wrong index");for(var c=E(s.buffer).bytes,d=a+s.byteOffset,l=i(+o),u=0;u<t;u++)c[d+u]=l[n?u:t-u-1]};if(n){if(!c((function(){_(1)}))||!c((function(){new _(-1)}))||c((function(){return new _,new _(1.5),new _(NaN),"ArrayBuffer"!=_.name}))){for(var B,q=(T=function(e){return d(this,T),new _(h(e))}).prototype=_.prototype,V=m(_),W=0;V.length>W;)(B=V[W++])in T||a(T,B,_[B]);q.constructor=T}g&&f(I)!==L&&g(I,L);var F=new R(new T(2)),G=I.setInt8;F.setInt8(0,2147483648),F.setInt8(1,2147483649),!F.getInt8(0)&&F.getInt8(1)||s(I,{setInt8:function(e,t){G.call(this,e,t<<24>>24)},setUint8:function(e,t){G.call(this,e,t<<24>>24)}},{unsafe:!0})}else T=function(e){d(this,T,"ArrayBuffer");var t=h(e);C(this,{bytes:y.call(new Array(t),0),byteLength:t}),o||(this.byteLength=t)},R=function(e,t,r){d(this,R,"DataView"),d(e,T,"DataView");var i=E(e).byteLength,n=l(t);if(n<0||n>i)throw w("Wrong offset");if(n+(r=void 0===r?i-n:u(r))>i)throw w("Wrong length");C(this,{buffer:e,byteLength:r,byteOffset:n}),o||(this.buffer=e,this.byteLength=r,this.byteOffset=n)},o&&(U(T,"byteLength"),U(R,"buffer"),U(R,"byteLength"),U(R,"byteOffset")),s(R.prototype,{getInt8:function(e){return z(this,1,e)[0]<<24>>24},getUint8:function(e){return z(this,1,e)[0]},getInt16:function(e){var t=z(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=z(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return N(z(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return N(z(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return k(z(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return k(z(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){H(this,1,e,P,t)},setUint8:function(e,t){H(this,1,e,P,t)},setInt16:function(e,t){H(this,2,e,x,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){H(this,2,e,x,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){H(this,4,e,D,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){H(this,4,e,D,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){H(this,4,e,A,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){H(this,8,e,O,t,arguments.length>2?arguments[2]:void 0)}});S(T,"ArrayBuffer"),S(R,"DataView"),e.exports={ArrayBuffer:T,DataView:R}},function(e,t){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},function(e,t,r){var i=r(19),o=r(7);e.exports=function(e){if(void 0===e)return 0;var t=i(e),r=o(t);if(t!==r)throw RangeError("Wrong length or index");return r}},function(e,t,r){var i=r(8),o=r(23),n=r(6)("match");e.exports=function(e){var t;return i(e)&&(void 0!==(t=e[n])?!!t:"RegExp"==o(e))}},function(e,t,r){var i=r(217);e.exports=function(e,t){var r=i(e);if(r%t)throw RangeError("Wrong offset");return r}},function(e,t,r){var i=r(8),o=r(43);e.exports=function(e,t,r){var n,a;return o&&"function"==typeof(n=t.constructor)&&n!==r&&i(a=n.prototype)&&a!==r.prototype&&o(e,a),e}},function(e,t,r){var i=r(31),o=r(14),n=r(50),a=r(7),s=function(e){return function(t,r,s,c){i(r);var d=o(t),l=n(d),u=a(d.length),h=e?u-1:0,p=e?-1:1;if(s<2)for(;;){if(h in l){c=l[h],h+=p;break}if(h+=p,e?h<0:u<=h)throw TypeError("Reduce of empty array with no initial value")}for(;e?h>=0:u>h;h+=p)h in l&&(c=r(c,l[h],h,d));return c}};e.exports={left:s(!1),right:s(!0)}},function(e,t,r){"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];return e.apply(t,r)}}},function(e,t,r){"use strict";var i=r(16);function o(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(i.isURLSearchParams(t))n=t.toString();else{var a=[];i.forEach(t,(function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,(function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),a.push(o(t)+"="+o(e))})))})),n=a.join("&")}if(n){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}},function(e,t,r){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,r){"use strict";(function(t){var i=r(16),o=r(227),n={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s,c={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(s=r(141)),s),transformRequest:[function(e,t){return o(t,"Accept"),o(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(a(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};c.headers={common:{Accept:"application/json, text/plain, */*"}},i.forEach(["delete","get","head"],(function(e){c.headers[e]={}})),i.forEach(["post","put","patch"],(function(e){c.headers[e]=i.merge(n)})),e.exports=c}).call(this,r(226))},function(e,t,r){"use strict";var i=r(16),o=r(228),n=r(138),a=r(230),s=r(233),c=r(234),d=r(142);e.exports=function(e){return new Promise((function(t,l){var u=e.data,h=e.headers;i.isFormData(u)&&delete h["Content-Type"];var p=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",g=e.auth.password||"";h.Authorization="Basic "+btoa(f+":"+g)}var m=a(e.baseURL,e.url);if(p.open(e.method.toUpperCase(),n(m,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,p.onreadystatechange=function(){if(p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in p?s(p.getAllResponseHeaders()):null,i={data:e.responseType&&"text"!==e.responseType?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:r,config:e,request:p};o(t,l,i),p=null}},p.onabort=function(){p&&(l(d("Request aborted",e,"ECONNABORTED",p)),p=null)},p.onerror=function(){l(d("Network Error",e,null,p)),p=null},p.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),l(d(t,e,"ECONNABORTED",p)),p=null},i.isStandardBrowserEnv()){var v=r(235),y=(e.withCredentials||c(m))&&e.xsrfCookieName?v.read(e.xsrfCookieName):void 0;y&&(h[e.xsrfHeaderName]=y)}if("setRequestHeader"in p&&i.forEach(h,(function(e,t){void 0===u&&"content-type"===t.toLowerCase()?delete h[t]:p.setRequestHeader(t,e)})),i.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),e.responseType)try{p.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){p&&(p.abort(),l(e),p=null)})),void 0===u&&(u=null),p.send(u)}))}},function(e,t,r){"use strict";var i=r(229);e.exports=function(e,t,r,o,n){var a=new Error(e);return i(a,t,r,o,n)}},function(e,t,r){"use strict";var i=r(16);e.exports=function(e,t){t=t||{};var r={},o=["url","method","params","data"],n=["headers","auth","proxy"],a=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];i.forEach(o,(function(e){void 0!==t[e]&&(r[e]=t[e])})),i.forEach(n,(function(o){i.isObject(t[o])?r[o]=i.deepMerge(e[o],t[o]):void 0!==t[o]?r[o]=t[o]:i.isObject(e[o])?r[o]=i.deepMerge(e[o]):void 0!==e[o]&&(r[o]=e[o])})),i.forEach(a,(function(i){void 0!==t[i]?r[i]=t[i]:void 0!==e[i]&&(r[i]=e[i])}));var s=o.concat(n).concat(a),c=Object.keys(t).filter((function(e){return-1===s.indexOf(e)}));return i.forEach(c,(function(i){void 0!==t[i]?r[i]=t[i]:void 0!==e[i]&&(r[i]=e[i])})),r}},function(e,t,r){"use strict";function i(e){this.message=e}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,e.exports=i},function(e,t,r){"use strict";var i=r(19),o=r(20);e.exports="".repeat||function(e){var t=String(o(this)),r="",n=i(e);if(n<0||n==1/0)throw RangeError("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r}},function(e,t,r){"use strict";var i=r(2),o=r(13).findIndex,n=r(69),a=!0;"findIndex"in[]&&Array(1).findIndex((function(){a=!1})),i({target:"Array",proto:!0,forced:a},{findIndex:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),n("findIndex")},function(e,t,r){var i=r(2),o=r(192);i({target:"Array",stat:!0,forced:!r(95)((function(e){Array.from(e)}))},{from:o})},function(e,t,r){var i=r(20),o="["+r(149)+"]",n=RegExp("^"+o+o+"*"),a=RegExp(o+o+"*$"),s=function(e){return function(t){var r=String(i(t));return 1&e&&(r=r.replace(n,"")),2&e&&(r=r.replace(a,"")),r}};e.exports={start:s(1),end:s(2),trim:s(3)}},function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},function(e,t,r){var i=r(4);e.exports=!i((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(e,t,r){r(2)({target:"Object",stat:!0,sham:!r(11)},{create:r(37)})},function(e,t,r){r(2)({target:"Object",stat:!0},{setPrototypeOf:r(43)})},function(e,t,r){e.exports=r(221)},function(e,t,r){(function(r){var i;!function(r,o){e.exports=function(r){"use strict";var o,n=(r=r||{}).Base64,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=function(e){for(var t={},r=0,i=e.length;r<i;r++)t[e.charAt(r)]=r;return t}(a),c=String.fromCharCode,d=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?c(192|t>>>6)+c(128|63&t):c(224|t>>>12&15)+c(128|t>>>6&63)+c(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return c(240|t>>>18&7)+c(128|t>>>12&63)+c(128|t>>>6&63)+c(128|63&t)},l=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,u=function(e){return e.replace(l,d)},h=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[a.charAt(r>>>18),a.charAt(r>>>12&63),t>=2?"=":a.charAt(r>>>6&63),t>=1?"=":a.charAt(63&r)].join("")},p=r.btoa&&"function"==typeof r.btoa?function(e){return r.btoa(e)}:function(e){if(e.match(/[^\x00-\xFF]/))throw new RangeError("The string contains invalid characters.");return e.replace(/[\s\S]{1,3}/g,h)},f=function(e){return p(u(String(e)))},g=function(e){return e.replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"})).replace(/=/g,"")},m=function(e,t){return t?g(f(e)):f(e)};r.Uint8Array&&(o=function(e,t){for(var r="",i=0,o=e.length;i<o;i+=3){var n=e[i],s=e[i+1],c=e[i+2],d=n<<16|s<<8|c;r+=a.charAt(d>>>18)+a.charAt(d>>>12&63)+(void 0!==s?a.charAt(d>>>6&63):"=")+(void 0!==c?a.charAt(63&d):"=")}return t?g(r):r});var v,y=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,S=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return c(55296+(t>>>10))+c(56320+(1023&t));case 3:return c((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return c((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},b=function(e){return e.replace(y,S)},E=function(e){var t=e.length,r=t%4,i=(t>0?s[e.charAt(0)]<<18:0)|(t>1?s[e.charAt(1)]<<12:0)|(t>2?s[e.charAt(2)]<<6:0)|(t>3?s[e.charAt(3)]:0),o=[c(i>>>16),c(i>>>8&255),c(255&i)];return o.length-=[0,0,2,1][r],o.join("")},C=r.atob&&"function"==typeof r.atob?function(e){return r.atob(e)}:function(e){return e.replace(/\S{1,4}/g,E)},_=function(e){return C(String(e).replace(/[^A-Za-z0-9\+\/]/g,""))},T=function(e){return function(e){return b(C(e))}(String(e).replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,""))};r.Uint8Array&&(v=function(e){return Uint8Array.from(_(e),(function(e){return e.charCodeAt(0)}))});var R=function(){var e=r.Base64;return r.Base64=n,e};if(r.Base64={VERSION:"2.6.2",atob:_,btoa:p,fromBase64:T,toBase64:m,utob:u,encode:m,encodeURI:function(e){return m(e,!0)},btou:b,decode:T,noConflict:R,fromUint8Array:o,toUint8Array:v},"function"==typeof Object.defineProperty){var I=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};r.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",I((function(){return T(this)}))),Object.defineProperty(String.prototype,"toBase64",I((function(e){return m(this,e)}))),Object.defineProperty(String.prototype,"toBase64URI",I((function(){return m(this,!0)})))}}r.Meteor&&(Base64=r.Base64);e.exports?e.exports.Base64=r.Base64:void 0===(i=function(){return r.Base64}.apply(t,[]))||(e.exports=i);return{Base64:r.Base64}}(r)}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:this)}).call(this,r(111))},function(e,t,r){var i;e.exports=(i=r(22),r(190),r(191),i.HmacSHA1)},function(e,t,r){e.exports=function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],i=e[1],o=e[2],n=e[3];i=((i+=((o=((o+=((n=((n+=((r=((r+=(i&o|~i&n)+t[0]-680876936|0)<<7|r>>>25)+i|0)&i|~r&o)+t[1]-389564586|0)<<12|n>>>20)+r|0)&r|~n&i)+t[2]+606105819|0)<<17|o>>>15)+n|0)&n|~o&r)+t[3]-1044525330|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i&o|~i&n)+t[4]-176418897|0)<<7|r>>>25)+i|0)&i|~r&o)+t[5]+1200080426|0)<<12|n>>>20)+r|0)&r|~n&i)+t[6]-1473231341|0)<<17|o>>>15)+n|0)&n|~o&r)+t[7]-45705983|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i&o|~i&n)+t[8]+1770035416|0)<<7|r>>>25)+i|0)&i|~r&o)+t[9]-1958414417|0)<<12|n>>>20)+r|0)&r|~n&i)+t[10]-42063|0)<<17|o>>>15)+n|0)&n|~o&r)+t[11]-1990404162|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i&o|~i&n)+t[12]+1804603682|0)<<7|r>>>25)+i|0)&i|~r&o)+t[13]-40341101|0)<<12|n>>>20)+r|0)&r|~n&i)+t[14]-1502002290|0)<<17|o>>>15)+n|0)&n|~o&r)+t[15]+1236535329|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i&n|o&~n)+t[1]-165796510|0)<<5|r>>>27)+i|0)&o|i&~o)+t[6]-1069501632|0)<<9|n>>>23)+r|0)&i|r&~i)+t[11]+643717713|0)<<14|o>>>18)+n|0)&r|n&~r)+t[0]-373897302|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i&n|o&~n)+t[5]-701558691|0)<<5|r>>>27)+i|0)&o|i&~o)+t[10]+38016083|0)<<9|n>>>23)+r|0)&i|r&~i)+t[15]-660478335|0)<<14|o>>>18)+n|0)&r|n&~r)+t[4]-405537848|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i&n|o&~n)+t[9]+568446438|0)<<5|r>>>27)+i|0)&o|i&~o)+t[14]-1019803690|0)<<9|n>>>23)+r|0)&i|r&~i)+t[3]-187363961|0)<<14|o>>>18)+n|0)&r|n&~r)+t[8]+1163531501|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i&n|o&~n)+t[13]-1444681467|0)<<5|r>>>27)+i|0)&o|i&~o)+t[2]-51403784|0)<<9|n>>>23)+r|0)&i|r&~i)+t[7]+1735328473|0)<<14|o>>>18)+n|0)&r|n&~r)+t[12]-1926607734|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i^o^n)+t[5]-378558|0)<<4|r>>>28)+i|0)^i^o)+t[8]-2022574463|0)<<11|n>>>21)+r|0)^r^i)+t[11]+1839030562|0)<<16|o>>>16)+n|0)^n^r)+t[14]-35309556|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i^o^n)+t[1]-1530992060|0)<<4|r>>>28)+i|0)^i^o)+t[4]+1272893353|0)<<11|n>>>21)+r|0)^r^i)+t[7]-155497632|0)<<16|o>>>16)+n|0)^n^r)+t[10]-1094730640|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i^o^n)+t[13]+681279174|0)<<4|r>>>28)+i|0)^i^o)+t[0]-358537222|0)<<11|n>>>21)+r|0)^r^i)+t[3]-722521979|0)<<16|o>>>16)+n|0)^n^r)+t[6]+76029189|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((n=((n+=((r=((r+=(i^o^n)+t[9]-640364487|0)<<4|r>>>28)+i|0)^i^o)+t[12]-421815835|0)<<11|n>>>21)+r|0)^r^i)+t[15]+530742520|0)<<16|o>>>16)+n|0)^n^r)+t[2]-995338651|0)<<23|i>>>9)+o|0,i=((i+=((n=((n+=(i^((r=((r+=(o^(i|~n))+t[0]-198630844|0)<<6|r>>>26)+i|0)|~o))+t[7]+1126891415|0)<<10|n>>>22)+r|0)^((o=((o+=(r^(n|~i))+t[14]-1416354905|0)<<15|o>>>17)+n|0)|~r))+t[5]-57434055|0)<<21|i>>>11)+o|0,i=((i+=((n=((n+=(i^((r=((r+=(o^(i|~n))+t[12]+1700485571|0)<<6|r>>>26)+i|0)|~o))+t[3]-1894986606|0)<<10|n>>>22)+r|0)^((o=((o+=(r^(n|~i))+t[10]-1051523|0)<<15|o>>>17)+n|0)|~r))+t[1]-2054922799|0)<<21|i>>>11)+o|0,i=((i+=((n=((n+=(i^((r=((r+=(o^(i|~n))+t[8]+1873313359|0)<<6|r>>>26)+i|0)|~o))+t[15]-30611744|0)<<10|n>>>22)+r|0)^((o=((o+=(r^(n|~i))+t[6]-1560198380|0)<<15|o>>>17)+n|0)|~r))+t[13]+1309151649|0)<<21|i>>>11)+o|0,i=((i+=((n=((n+=(i^((r=((r+=(o^(i|~n))+t[4]-145523070|0)<<6|r>>>26)+i|0)|~o))+t[11]-1120210379|0)<<10|n>>>22)+r|0)^((o=((o+=(r^(n|~i))+t[2]+718787259|0)<<15|o>>>17)+n|0)|~r))+t[9]-343485551|0)<<21|i>>>11)+o|0,e[0]=r+e[0]|0,e[1]=i+e[1]|0,e[2]=o+e[2]|0,e[3]=n+e[3]|0}function i(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function o(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function n(e){var t,o,n,a,s,c,d=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=d;t+=64)r(l,i(e.substring(t-64,t)));for(o=(e=e.substring(t-64)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<o;t+=1)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(r(l,n),t=0;t<16;t+=1)n[t]=0;return a=(a=8*d).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),c=parseInt(a[1],16)||0,n[14]=s,n[15]=c,r(l,n),l}function a(e){var r,i="";for(r=0;r<4;r+=1)i+=t[e>>8*r+4&15]+t[e>>8*r&15];return i}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function c(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function d(e){var t,r=[],i=e.length;for(t=0;t<i-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function l(){this.reset()}return s(n("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,i){var o,n,a,s,c=this.byteLength,d=t(r,c),l=c;return i!==e&&(l=t(i,c)),d>l?new ArrayBuffer(0):(o=l-d,n=new ArrayBuffer(o),a=new Uint8Array(n),s=new Uint8Array(this,d,o),a.set(s),n)}}(),l.prototype.append=function(e){return this.appendBinary(c(e)),this},l.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,o=this._buff.length;for(t=64;t<=o;t+=64)r(this._hash,i(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},l.prototype.end=function(e){var t,r,i=this._buff,o=i.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<o;t+=1)n[t>>2]|=i.charCodeAt(t)<<(t%4<<3);return this._finish(n,o),r=s(this._hash),e&&(r=d(r)),this.reset(),r},l.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},l.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},l.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},l.prototype._finish=function(e,t){var i,o,n,a=t;if(e[a>>2]|=128<<(a%4<<3),a>55)for(r(this._hash,e),a=0;a<16;a+=1)e[a]=0;i=(i=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),n=parseInt(i[1],16)||0,e[14]=o,e[15]=n,r(this._hash,e)},l.hash=function(e,t){return l.hashBinary(c(e),t)},l.hashBinary=function(e,t){var r=s(n(e));return t?d(r):r},l.ArrayBuffer=function(){this.reset()},l.ArrayBuffer.prototype.append=function(e){var t,i,n,a,s,c=(i=this._buff.buffer,n=e,a=!0,(s=new Uint8Array(i.byteLength+n.byteLength)).set(new Uint8Array(i)),s.set(new Uint8Array(n),i.byteLength),a?s:s.buffer),d=c.length;for(this._length+=e.byteLength,t=64;t<=d;t+=64)r(this._hash,o(c.subarray(t-64,t)));return this._buff=t-64<d?new Uint8Array(c.buffer.slice(t-64)):new Uint8Array(0),this},l.ArrayBuffer.prototype.end=function(e){var t,r,i=this._buff,o=i.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<o;t+=1)n[t>>2]|=i[t]<<(t%4<<3);return this._finish(n,o),r=s(this._hash),e&&(r=d(r)),this.reset(),r},l.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.ArrayBuffer.prototype.getState=function(){var e,t=l.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},l.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var r,i=e.length,o=new ArrayBuffer(i),n=new Uint8Array(o);for(r=0;r<i;r+=1)n[r]=e.charCodeAt(r);return t?n:o}(e.buff,!0),l.prototype.setState.call(this,e)},l.ArrayBuffer.prototype.destroy=l.prototype.destroy,l.ArrayBuffer.prototype._finish=l.prototype._finish,l.ArrayBuffer.hash=function(e,t){var i=s(function(e){var t,i,n,a,s,c,d=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=d;t+=64)r(l,o(e.subarray(t-64,t)));for(e=t-64<d?e.subarray(t-64):new Uint8Array(0),i=e.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)n[t>>2]|=e[t]<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(r(l,n),t=0;t<16;t+=1)n[t]=0;return a=(a=8*d).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),c=parseInt(a[1],16)||0,n[14]=s,n[15]=c,r(l,n),l}(new Uint8Array(e)));return t?d(i):i},l}()},function(e,t,r){var i=r(11),o=r(12),n=r(9),a=r(68);e.exports=i?Object.defineProperties:function(e,t){n(e);for(var r,i=a(t),s=i.length,c=0;s>c;)o.f(e,r=i[c++],t[r]);return e}},function(e,t,r){"use strict";var i=r(123).IteratorPrototype,o=r(37),n=r(35),a=r(41),s=r(55),c=function(){return this};e.exports=function(e,t,r){var d=t+" Iterator";return e.prototype=o(i,{next:n(1,r)}),a(e,d,!1,!0),s[d]=c,e}},function(e,t,r){"use strict";var i=r(11),o=r(4),n=r(68),a=r(90),s=r(75),c=r(14),d=r(50),l=Object.assign,u=Object.defineProperty;e.exports=!l||o((function(){if(i&&1!==l({b:1},l(u({},"a",{enumerable:!0,get:function(){u(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol();return e[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=l({},e)[r]||"abcdefghijklmnopqrst"!=n(l({},t)).join("")}))?function(e,t){for(var r=c(e),o=arguments.length,l=1,u=a.f,h=s.f;o>l;)for(var p,f=d(arguments[l++]),g=u?n(f).concat(u(f)):n(f),m=g.length,v=0;m>v;)p=g[v++],i&&!h.call(f,p)||(r[p]=f[p]);return r}:l},function(e,t,r){"use strict";var i=r(2),o=r(4),n=r(130),a=r(9),s=r(30),c=r(7),d=r(33),l=n.ArrayBuffer,u=n.DataView,h=l.prototype.slice;i({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:o((function(){return!new l(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(void 0!==h&&void 0===t)return h.call(a(this),e);for(var r=a(this).byteLength,i=s(e,r),o=s(void 0===t?r:t,r),n=new(d(this,l))(c(o-i)),p=new u(this),f=new u(n),g=0;i<o;)f.setUint8(g++,p.getUint8(i++));return n}})},function(e,t,r){"use strict";var i=r(18),o=r(9),n=r(4),a=r(116),s=RegExp.prototype,c=s.toString,d=n((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),l="toString"!=c.name;(d||l)&&i(RegExp.prototype,"toString",(function(){var e=o(this),t=String(e.source),r=e.flags;return"/"+t+"/"+String(void 0===r&&e instanceof RegExp&&!("flags"in s)?a.call(e):r)}),{unsafe:!0})},function(e,t,r){r(163)("Uint8",(function(e){return function(t,r,i){return e(this,t,r,i)}}))},function(e,t,r){"use strict";var i=r(2),o=r(3),n=r(11),a=r(164),s=r(5),c=r(130),d=r(71),l=r(35),u=r(15),h=r(7),p=r(132),f=r(134),g=r(38),m=r(10),v=r(58),y=r(8),S=r(37),b=r(43),E=r(40).f,C=r(165),_=r(13).forEach,T=r(124),R=r(12),I=r(34),L=r(24),w=r(135),M=L.get,k=L.set,P=R.f,x=I.f,D=Math.round,N=o.RangeError,A=c.ArrayBuffer,O=c.DataView,U=s.NATIVE_ARRAY_BUFFER_VIEWS,z=s.TYPED_ARRAY_TAG,H=s.TypedArray,B=s.TypedArrayPrototype,q=s.aTypedArrayConstructor,V=s.isTypedArray,W=function(e,t){for(var r=0,i=t.length,o=new(q(e))(i);i>r;)o[r]=t[r++];return o},F=function(e,t){P(e,t,{get:function(){return M(this)[t]}})},G=function(e){var t;return e instanceof A||"ArrayBuffer"==(t=v(e))||"SharedArrayBuffer"==t},j=function(e,t){return V(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Z=function(e,t){return j(e,t=g(t,!0))?l(2,e[t]):x(e,t)},J=function(e,t,r){return!(j(e,t=g(t,!0))&&y(r)&&m(r,"value"))||m(r,"get")||m(r,"set")||r.configurable||m(r,"writable")&&!r.writable||m(r,"enumerable")&&!r.enumerable?P(e,t,r):(e[t]=r.value,e)};n?(U||(I.f=Z,R.f=J,F(B,"buffer"),F(B,"byteOffset"),F(B,"byteLength"),F(B,"length")),i({target:"Object",stat:!0,forced:!U},{getOwnPropertyDescriptor:Z,defineProperty:J}),e.exports=function(e,t,r){var n=e.match(/\d+$/)[0]/8,s=e+(r?"Clamped":"")+"Array",c="get"+e,l="set"+e,g=o[s],m=g,v=m&&m.prototype,R={},I=function(e,t){P(e,t,{get:function(){return function(e,t){var r=M(e);return r.view[c](t*n+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var o=M(e);r&&(i=(i=D(i))<0?0:i>255?255:255&i),o.view[l](t*n+o.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};U?a&&(m=t((function(e,t,r,i){return d(e,m,s),w(y(t)?G(t)?void 0!==i?new g(t,f(r,n),i):void 0!==r?new g(t,f(r,n)):new g(t):V(t)?W(m,t):C.call(m,t):new g(p(t)),e,m)})),b&&b(m,H),_(E(g),(function(e){e in m||u(m,e,g[e])})),m.prototype=v):(m=t((function(e,t,r,i){d(e,m,s);var o,a,c,l=0,u=0;if(y(t)){if(!G(t))return V(t)?W(m,t):C.call(m,t);o=t,u=f(r,n);var g=t.byteLength;if(void 0===i){if(g%n)throw N("Wrong length");if((a=g-u)<0)throw N("Wrong length")}else if((a=h(i)*n)+u>g)throw N("Wrong length");c=a/n}else c=p(t),o=new A(a=c*n);for(k(e,{buffer:o,byteOffset:u,byteLength:a,length:c,view:new O(o)});l<c;)I(e,l++)})),b&&b(m,H),v=m.prototype=S(B)),v.constructor!==m&&u(v,"constructor",m),z&&u(v,z,s),R[s]=m,i({global:!0,forced:m!=g,sham:!U},R),"BYTES_PER_ELEMENT"in m||u(m,"BYTES_PER_ELEMENT",n),"BYTES_PER_ELEMENT"in v||u(v,"BYTES_PER_ELEMENT",n),T(s)}):e.exports=function(){}},function(e,t,r){var i=r(3),o=r(4),n=r(95),a=r(5).NATIVE_ARRAY_BUFFER_VIEWS,s=i.ArrayBuffer,c=i.Int8Array;e.exports=!a||!o((function(){c(1)}))||!o((function(){new c(-1)}))||!n((function(e){new c,new c(null),new c(1.5),new c(e)}),!0)||o((function(){return 1!==new c(new s(2),1,void 0).length}))},function(e,t,r){var i=r(14),o=r(7),n=r(72),a=r(94),s=r(45),c=r(5).aTypedArrayConstructor;e.exports=function(e){var t,r,d,l,u,h,p=i(e),f=arguments.length,g=f>1?arguments[1]:void 0,m=void 0!==g,v=n(p);if(null!=v&&!a(v))for(h=(u=v.call(p)).next,p=[];!(l=h.call(u)).done;)p.push(l.value);for(m&&f>2&&(g=s(g,arguments[2],2)),r=o(p.length),d=new(c(this))(r),t=0;r>t;t++)d[t]=m?g(p[t],t):p[t];return d}},function(e,t,r){"use strict";var i=r(5),o=r(218),n=i.aTypedArray;(0,i.exportTypedArrayMethod)("copyWithin",(function(e,t){return o.call(n(this),e,t,arguments.length>2?arguments[2]:void 0)}))},function(e,t,r){"use strict";var i=r(5),o=r(13).every,n=i.aTypedArray;(0,i.exportTypedArrayMethod)("every",(function(e){return o(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var i=r(5),o=r(107),n=i.aTypedArray;(0,i.exportTypedArrayMethod)("fill",(function(e){return o.apply(n(this),arguments)}))},function(e,t,r){"use strict";var i=r(5),o=r(13).filter,n=r(219),a=i.aTypedArray;(0,i.exportTypedArrayMethod)("filter",(function(e){var t=o(a(this),e,arguments.length>1?arguments[1]:void 0);return n(this,t)}))},function(e,t,r){"use strict";var i=r(5),o=r(13).find,n=i.aTypedArray;(0,i.exportTypedArrayMethod)("find",(function(e){return o(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var i=r(5),o=r(13).findIndex,n=i.aTypedArray;(0,i.exportTypedArrayMethod)("findIndex",(function(e){return o(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var i=r(5),o=r(13).forEach,n=i.aTypedArray;(0,i.exportTypedArrayMethod)("forEach",(function(e){o(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var i=r(5),o=r(53).includes,n=i.aTypedArray;(0,i.exportTypedArrayMethod)("includes",(function(e){return o(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var i=r(5),o=r(53).indexOf,n=i.aTypedArray;(0,i.exportTypedArrayMethod)("indexOf",(function(e){return o(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var i=r(3),o=r(5),n=r(27),a=r(6)("iterator"),s=i.Uint8Array,c=n.values,d=n.keys,l=n.entries,u=o.aTypedArray,h=o.exportTypedArrayMethod,p=s&&s.prototype[a],f=!!p&&("values"==p.name||null==p.name),g=function(){return c.call(u(this))};h("entries",(function(){return l.call(u(this))})),h("keys",(function(){return d.call(u(this))})),h("values",g,!f),h(a,g,!f)},function(e,t,r){"use strict";var i=r(5),o=i.aTypedArray,n=i.exportTypedArrayMethod,a=[].join;n("join",(function(e){return a.apply(o(this),arguments)}))},function(e,t,r){"use strict";var i=r(5),o=r(178),n=i.aTypedArray;(0,i.exportTypedArrayMethod)("lastIndexOf",(function(e){return o.apply(n(this),arguments)}))},function(e,t,r){"use strict";var i=r(21),o=r(19),n=r(7),a=r(42),s=Math.min,c=[].lastIndexOf,d=!!c&&1/[1].lastIndexOf(1,-0)<0,l=a("lastIndexOf"),u=d||!l;e.exports=u?function(e){if(d)return c.apply(this,arguments)||0;var t=i(this),r=n(t.length),a=r-1;for(arguments.length>1&&(a=s(a,o(arguments[1]))),a<0&&(a=r+a);a>=0;a--)if(a in t&&t[a]===e)return a||0;return-1}:c},function(e,t,r){"use strict";var i=r(5),o=r(13).map,n=r(33),a=i.aTypedArray,s=i.aTypedArrayConstructor;(0,i.exportTypedArrayMethod)("map",(function(e){return o(a(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(s(n(e,e.constructor)))(t)}))}))},function(e,t,r){"use strict";var i=r(5),o=r(136).left,n=i.aTypedArray;(0,i.exportTypedArrayMethod)("reduce",(function(e){return o(n(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var i=r(5),o=r(136).right,n=i.aTypedArray;(0,i.exportTypedArrayMethod)("reduceRight",(function(e){return o(n(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var i=r(5),o=i.aTypedArray,n=i.exportTypedArrayMethod,a=Math.floor;n("reverse",(function(){for(var e,t=o(this).length,r=a(t/2),i=0;i<r;)e=this[i],this[i++]=this[--t],this[t]=e;return this}))},function(e,t,r){"use strict";var i=r(5),o=r(7),n=r(134),a=r(14),s=r(4),c=i.aTypedArray;(0,i.exportTypedArrayMethod)("set",(function(e){c(this);var t=n(arguments.length>1?arguments[1]:void 0,1),r=this.length,i=a(e),s=o(i.length),d=0;if(s+t>r)throw RangeError("Wrong length");for(;d<s;)this[t+d]=i[d++]}),s((function(){new Int8Array(1).set({})})))},function(e,t,r){"use strict";var i=r(5),o=r(33),n=r(4),a=i.aTypedArray,s=i.aTypedArrayConstructor,c=i.exportTypedArrayMethod,d=[].slice;c("slice",(function(e,t){for(var r=d.call(a(this),e,t),i=o(this,this.constructor),n=0,c=r.length,l=new(s(i))(c);c>n;)l[n]=r[n++];return l}),n((function(){new Int8Array(1).slice()})))},function(e,t,r){"use strict";var i=r(5),o=r(13).some,n=i.aTypedArray;(0,i.exportTypedArrayMethod)("some",(function(e){return o(n(this),e,arguments.length>1?arguments[1]:void 0)}))},function(e,t,r){"use strict";var i=r(5),o=i.aTypedArray,n=i.exportTypedArrayMethod,a=[].sort;n("sort",(function(e){return a.call(o(this),e)}))},function(e,t,r){"use strict";var i=r(5),o=r(7),n=r(30),a=r(33),s=i.aTypedArray;(0,i.exportTypedArrayMethod)("subarray",(function(e,t){var r=s(this),i=r.length,c=n(e,i);return new(a(r,r.constructor))(r.buffer,r.byteOffset+c*r.BYTES_PER_ELEMENT,o((void 0===t?i:n(t,i))-c))}))},function(e,t,r){"use strict";var i=r(3),o=r(5),n=r(4),a=i.Int8Array,s=o.aTypedArray,c=o.exportTypedArrayMethod,d=[].toLocaleString,l=[].slice,u=!!a&&n((function(){d.call(new a(1))}));c("toLocaleString",(function(){return d.apply(u?l.call(s(this)):s(this),arguments)}),n((function(){return[1,2].toLocaleString()!=new a([1,2]).toLocaleString()}))||!n((function(){a.prototype.toLocaleString.call([1,2])})))},function(e,t,r){"use strict";var i=r(5).exportTypedArrayMethod,o=r(4),n=r(3).Uint8Array,a=n&&n.prototype||{},s=[].toString,c=[].join;o((function(){s.call({})}))&&(s=function(){return c.call(this)});var d=a.toString!=s;i("toString",s,d)},function(e,t,r){var i,o,n,a,s,c,d,l;e.exports=(l=r(22),o=(i=l).lib,n=o.WordArray,a=o.Hasher,s=i.algo,c=[],d=s.SHA1=a.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,i=r[0],o=r[1],n=r[2],a=r[3],s=r[4],d=0;d<80;d++){if(d<16)c[d]=0|e[t+d];else{var l=c[d-3]^c[d-8]^c[d-14]^c[d-16];c[d]=l<<1|l>>>31}var u=(i<<5|i>>>27)+s+c[d];u+=d<20?1518500249+(o&n|~o&a):d<40?1859775393+(o^n^a):d<60?(o&n|o&a|n&a)-1894007588:(o^n^a)-899497514,s=a,a=n,n=o<<30|o>>>2,o=i,i=u}r[0]=r[0]+i|0,r[1]=r[1]+o|0,r[2]=r[2]+n|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(i+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA1=a._createHelper(d),i.HmacSHA1=a._createHmacHelper(d),l.SHA1)},function(e,t,r){var i,o,n,a;e.exports=(i=r(22),n=(o=i).lib.Base,a=o.enc.Utf8,void(o.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=a.parse(t));var r=e.blockSize,i=4*r;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),n=this._iKey=t.clone(),s=o.words,c=n.words,d=0;d<r;d++)s[d]^=1549556828,c[d]^=909522486;o.sigBytes=n.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))},function(e,t,r){"use strict";var i=r(45),o=r(14),n=r(220),a=r(94),s=r(7),c=r(80),d=r(72);e.exports=function(e){var t,r,l,u,h,p,f=o(e),g="function"==typeof this?this:Array,m=arguments.length,v=m>1?arguments[1]:void 0,y=void 0!==v,S=d(f),b=0;if(y&&(v=i(v,m>2?arguments[2]:void 0,2)),null==S||g==Array&&a(S))for(r=new g(t=s(f.length));t>b;b++)p=y?v(f[b],b):f[b],c(r,b,p);else for(h=(u=S.call(f)).next,r=new g;!(l=h.call(u)).done;b++)p=y?n(u,v,[l.value,b],!0):l.value,c(r,b,p);return r.length=b,r}},function(e,t,r){var i=r(7),o=r(145),n=r(20),a=Math.ceil,s=function(e){return function(t,r,s){var c,d,l=String(n(t)),u=l.length,h=void 0===s?" ":String(s),p=i(r);return p<=u||""==h?l:(c=p-u,(d=o.call(h,a(c/h.length))).length>c&&(d=d.slice(0,c)),e?l+d:d+l)}};e.exports={start:s(!1),end:s(!0)}},function(e,t,r){var i=r(133);e.exports=function(e){if(i(e))throw TypeError("The method doesn't accept regular expressions");return e}},function(e,t,r){var i=r(6)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[i]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,r){"use strict";var i=r(2),o=r(4),n=r(67),a=r(8),s=r(14),c=r(7),d=r(80),l=r(104),u=r(61),h=r(6),p=r(106),f=h("isConcatSpreadable"),g=p>=51||!o((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),m=u("concat"),v=function(e){if(!a(e))return!1;var t=e[f];return void 0!==t?!!t:n(e)};i({target:"Array",proto:!0,forced:!g||!m},{concat:function(e){var t,r,i,o,n,a=s(this),u=l(a,0),h=0;for(t=-1,i=arguments.length;t<i;t++)if(v(n=-1===t?a:arguments[t])){if(h+(o=c(n.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(r=0;r<o;r++,h++)r in n&&d(u,h,n[r])}else{if(h>=9007199254740991)throw TypeError("Maximum allowed index exceeded");d(u,h++,n)}return u.length=h,u}})},function(e,t,r){var i=r(3),o=r(86),n=i.WeakMap;e.exports="function"==typeof n&&/native code/.test(o(n))},function(e,t,r){var i=r(36),o=r(40),n=r(90),a=r(9);e.exports=i("Reflect","ownKeys")||function(e){var t=o.f(a(e)),r=n.f;return r?t.concat(r(e)):t}},function(e,t,r){"use strict";var i=r(31),o=r(8),n=[].slice,a={},s=function(e,t,r){if(!(t in a)){for(var i=[],o=0;o<t;o++)i[o]="a["+o+"]";a[t]=Function("C,a","return new C("+i.join(",")+")")}return a[t](e,r)};e.exports=Function.bind||function(e){var t=i(this),r=n.call(arguments,1),a=function(){var i=r.concat(n.call(arguments));return this instanceof a?s(t,i.length,i):t.apply(e,i)};return o(t.prototype)&&(a.prototype=t.prototype),a}},function(e,t,r){"use strict";var i=r(4);function o(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=i((function(){var e=o("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),t.BROKEN_CARET=i((function(){var e=o("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},function(e,t,r){var i=r(14),o=Math.floor,n="".replace,a=/\$([$&'`]|\d\d?|<[^>]*>)/g,s=/\$([$&'`]|\d\d?)/g;e.exports=function(e,t,r,c,d,l){var u=r+e.length,h=c.length,p=s;return void 0!==d&&(d=i(d),p=a),n.call(l,p,(function(i,n){var a;switch(n.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(u);case"<":a=d[n.slice(1,-1)];break;default:var s=+n;if(0===s)return i;if(s>h){var l=o(s/10);return 0===l?i:l<=h?void 0===c[l-1]?n.charAt(1):c[l-1]+n.charAt(1):i}a=c[s-1]}return void 0===a?"":a}))}},function(e,t,r){"use strict";var i,o=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},n=function(){var e={};return function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}e[t]=r}return e[t]}}(),a=[];function s(e){for(var t=-1,r=0;r<a.length;r++)if(a[r].identifier===e){t=r;break}return t}function c(e,t){for(var r={},i=[],o=0;o<e.length;o++){var n=e[o],c=t.base?n[0]+t.base:n[0],d=r[c]||0,l="".concat(c," ").concat(d);r[c]=d+1;var u=s(l),h={css:n[1],media:n[2],sourceMap:n[3]};-1!==u?(a[u].references++,a[u].updater(h)):a.push({identifier:l,updater:m(h,t),references:1}),i.push(l)}return i}function d(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var o=r.nc;o&&(i.nonce=o)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var a=n(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var l,u=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function h(e,t,r,i){var o=r?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=u(t,o);else{var n=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(n,a[t]):e.appendChild(n)}}function p(e,t,r){var i=r.css,o=r.media,n=r.sourceMap;if(o?e.setAttribute("media",o):e.removeAttribute("media"),n&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var f=null,g=0;function m(e,t){var r,i,o;if(t.singleton){var n=g++;r=f||(f=d(t)),i=h.bind(null,r,n,!1),o=h.bind(null,r,n,!0)}else r=d(t),i=p.bind(null,r,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=o());var r=c(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<r.length;i++){var o=s(r[i]);a[o].references--}for(var n=c(e,t),d=0;d<r.length;d++){var l=s(r[d]);0===a[l].references&&(a[l].updater(),a.splice(l,1))}r=n}}}},function(e,t,r){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r=e[1]||"",i=e[3];if(!i)return r;if(t&&"function"==typeof btoa){var o=(a=i,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(c," */")),n=i.sources.map((function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")}));return[r].concat(n).concat([o]).join("\n")}var a,s,c;return[r].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r})).join("")},t.i=function(e,r,i){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(i)for(var n=0;n<this.length;n++){var a=this[n][0];null!=a&&(o[a]=!0)}for(var s=0;s<e.length;s++){var c=[].concat(e[s]);i&&o[c[0]]||(r&&(c[2]?c[2]="".concat(r," and ").concat(c[2]):c[2]=r),t.push(c))}},t}},function(e,t){!function(){if(-1!==window.navigator.userAgent.indexOf("Trident")){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}e.prototype=window.Event.prototype,window.CustomEvent=e,document.body.scrollTo||(Element.prototype.scrollTo=function(e,t){this.scrollLeft=e,this.scrollTop=t}),document.body.scrollBy||(Element.prototype.scrollBy=function(e,t){this.scrollLeft+=e,this.scrollTop+=t}),FileReader.prototype.readAsBinaryString||(FileReader.prototype.readAsBinaryString=function(e){var t=this,r=new FileReader;r.onload=function(e){for(var i="",o=new Uint8Array(r.result),n=o.byteLength,a=0;a<n;a++)i+=String.fromCharCode(o[a]);t.content=i,t.result=i,t.onload()},r.readAsArrayBuffer(e)})}}()},function(e,t,r){var i=r(21),o=r(40).f,n={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==n.call(e)?function(e){try{return o(e)}catch(e){return a.slice()}}(e):o(i(e))}},function(e,t,r){var i=r(4);e.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){var i=r(8);e.exports=function(e){if(!i(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,r){"use strict";var i=r(93),o=r(58);e.exports=i?{}.toString:function(){return"[object "+o(this)+"]"}},function(e,t,r){var i=r(3);e.exports=i.Promise},function(e,t,r){var i=r(9),o=r(94),n=r(7),a=r(45),s=r(72),c=r(125),d=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,r){var l,u,h,p,f,g,m,v=r&&r.that,y=!(!r||!r.AS_ENTRIES),S=!(!r||!r.IS_ITERATOR),b=!(!r||!r.INTERRUPTED),E=a(t,v,1+y+b),C=function(e){return l&&c(l),new d(!0,e)},_=function(e){return y?(i(e),b?E(e[0],e[1],C):E(e[0],e[1])):b?E(e,C):E(e)};if(S)l=e;else{if("function"!=typeof(u=s(e)))throw TypeError("Target is not iterable");if(o(u)){for(h=0,p=n(e.length);p>h;h++)if((f=_(e[h]))&&f instanceof d)return f;return new d(!1)}l=u.call(e)}for(g=l.next;!(m=g.call(l)).done;){try{f=_(m.value)}catch(e){throw c(l),e}if("object"==typeof f&&f&&f instanceof d)return f}return new d(!1)}},function(e,t,r){var i,o,n,a,s,c,d,l,u=r(3),h=r(34).f,p=r(126).set,f=r(127),g=r(212),m=r(96),v=u.MutationObserver||u.WebKitMutationObserver,y=u.document,S=u.process,b=u.Promise,E=h(u,"queueMicrotask"),C=E&&E.value;C||(i=function(){var e,t;for(m&&(e=S.domain)&&e.exit();o;){t=o.fn,o=o.next;try{t()}catch(e){throw o?a():n=void 0,e}}n=void 0,e&&e.enter()},f||m||g||!v||!y?b&&b.resolve?(d=b.resolve(void 0),l=d.then,a=function(){l.call(d,i)}):a=m?function(){S.nextTick(i)}:function(){p.call(u,i)}:(s=!0,c=y.createTextNode(""),new v(i).observe(c,{characterData:!0}),a=function(){c.data=s=!s})),e.exports=C||function(e){var t={fn:e,next:void 0};n&&(n.next=t),o||(o=t,a()),n=t}},function(e,t,r){var i=r(59);e.exports=/web0s(?!.*chrome)/i.test(i)},function(e,t,r){var i=r(9),o=r(8),n=r(128);e.exports=function(e,t){if(i(e),o(t)&&t.constructor===e)return t;var r=n.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var i=r(3);e.exports=function(e,t){var r=i.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t){var r=Math.abs,i=Math.pow,o=Math.floor,n=Math.log,a=Math.LN2;e.exports={pack:function(e,t,s){var c,d,l,u=new Array(s),h=8*s-t-1,p=(1<<h)-1,f=p>>1,g=23===t?i(2,-24)-i(2,-77):0,m=e<0||0===e&&1/e<0?1:0,v=0;for((e=r(e))!=e||e===1/0?(d=e!=e?1:0,c=p):(c=o(n(e)/a),e*(l=i(2,-c))<1&&(c--,l*=2),(e+=c+f>=1?g/l:g*i(2,1-f))*l>=2&&(c++,l/=2),c+f>=p?(d=0,c=p):c+f>=1?(d=(e*l-1)*i(2,t),c+=f):(d=e*i(2,f-1)*i(2,t),c=0));t>=8;u[v++]=255&d,d/=256,t-=8);for(c=c<<t|d,h+=t;h>0;u[v++]=255&c,c/=256,h-=8);return u[--v]|=128*m,u},unpack:function(e,t){var r,o=e.length,n=8*o-t-1,a=(1<<n)-1,s=a>>1,c=n-7,d=o-1,l=e[d--],u=127&l;for(l>>=7;c>0;u=256*u+e[d],d--,c-=8);for(r=u&(1<<-c)-1,u>>=-c,c+=t;c>0;r=256*r+e[d],d--,c-=8);if(0===u)u=1-s;else{if(u===a)return r?NaN:l?-1/0:1/0;r+=i(2,t),u-=s}return(l?-1:1)*r*i(2,u-t)}}},function(e,t,r){var i=r(19);e.exports=function(e){var t=i(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}},function(e,t,r){"use strict";var i=r(14),o=r(30),n=r(7),a=Math.min;e.exports=[].copyWithin||function(e,t){var r=i(this),s=n(r.length),c=o(e,s),d=o(t,s),l=arguments.length>2?arguments[2]:void 0,u=a((void 0===l?s:o(l,s))-d,s-c),h=1;for(d<c&&c<d+u&&(h=-1,d+=u-1,c+=u-1);u-- >0;)d in r?r[c]=r[d]:delete r[c],c+=h,d+=h;return r}},function(e,t,r){var i=r(5).aTypedArrayConstructor,o=r(33);e.exports=function(e,t){for(var r=o(e,e.constructor),n=0,a=t.length,s=new(i(r))(a);a>n;)s[n]=t[n++];return s}},function(e,t,r){var i=r(9),o=r(125);e.exports=function(e,t,r,n){try{return n?t(i(r)[0],r[1]):t(r)}catch(t){throw o(e),t}}},function(e,t,r){"use strict";var i=r(16),o=r(137),n=r(222),a=r(143);function s(e){var t=new n(e),r=o(n.prototype.request,t);return i.extend(r,n.prototype,t),i.extend(r,t),r}var c=s(r(140));c.Axios=n,c.create=function(e){return s(a(c.defaults,e))},c.Cancel=r(144),c.CancelToken=r(236),c.isCancel=r(139),c.all=function(e){return Promise.all(e)},c.spread=r(237),e.exports=c,e.exports.default=c},function(e,t,r){"use strict";var i=r(16),o=r(138),n=r(223),a=r(224),s=r(143);function c(e){this.defaults=e,this.interceptors={request:new n,response:new n}}c.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[a,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)r=r.then(t.shift(),t.shift());return r},c.prototype.getUri=function(e){return e=s(this.defaults,e),o(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function(e){c.prototype[e]=function(t,r){return this.request(i.merge(r||{},{method:e,url:t}))}})),i.forEach(["post","put","patch"],(function(e){c.prototype[e]=function(t,r,o){return this.request(i.merge(o||{},{method:e,url:t,data:r}))}})),e.exports=c},function(e,t,r){"use strict";var i=r(16);function o(){this.handlers=[]}o.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},o.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},o.prototype.forEach=function(e){i.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=o},function(e,t,r){"use strict";var i=r(16),o=r(225),n=r(139),a=r(140);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=o(e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return s(e),t.data=o(t.data,t.headers,e.transformResponse),t}),(function(t){return n(t)||(s(e),t&&t.response&&(t.response.data=o(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,r){"use strict";var i=r(16);e.exports=function(e,t,r){return i.forEach(r,(function(r){e=r(e,t)})),e}},function(e,t){var r,i,o=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===n||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:n}catch(e){r=n}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,d=[],l=!1,u=-1;function h(){l&&c&&(l=!1,c.length?d=c.concat(d):u=-1,d.length&&p())}function p(){if(!l){var e=s(h);l=!0;for(var t=d.length;t;){for(c=d,d=[];++u<t;)c&&c[u].run();u=-1,t=d.length}c=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new f(e,t)),1!==d.length||l||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,r){"use strict";var i=r(16);e.exports=function(e,t){i.forEach(e,(function(r,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[i])}))}},function(e,t,r){"use strict";var i=r(142);e.exports=function(e,t,r){var o=r.config.validateStatus;!o||o(r.status)?e(r):t(i("Request failed with status code "+r.status,r.config,null,r.request,r))}},function(e,t,r){"use strict";e.exports=function(e,t,r,i,o){return e.config=t,r&&(e.code=r),e.request=i,e.response=o,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,r){"use strict";var i=r(231),o=r(232);e.exports=function(e,t){return e&&!i(t)?o(e,t):t}},function(e,t,r){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,r){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,r){"use strict";var i=r(16),o=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,n,a={};return e?(i.forEach(e.split("\n"),(function(e){if(n=e.indexOf(":"),t=i.trim(e.substr(0,n)).toLowerCase(),r=i.trim(e.substr(n+1)),t){if(a[t]&&o.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([r]):a[t]?a[t]+", "+r:r}})),a):a}},function(e,t,r){"use strict";var i=r(16);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function o(e){var i=e;return t&&(r.setAttribute("href",i),i=r.href),r.setAttribute("href",i),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=o(window.location.href),function(t){var r=i.isString(t)?o(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},function(e,t,r){"use strict";var i=r(16);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,r,o,n,a){var s=[];s.push(e+"="+encodeURIComponent(t)),i.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),i.isString(o)&&s.push("path="+o),i.isString(n)&&s.push("domain="+n),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";var i=r(144);function o(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;e((function(e){r.reason||(r.reason=new i(e),t(r.reason))}))}o.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},o.source=function(){var e;return{token:new o((function(t){e=t})),cancel:e}},e.exports=o},function(e,t,r){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,r){var i=r(2),o=r(239);i({target:"Date",proto:!0,forced:Date.prototype.toISOString!==o},{toISOString:o})},function(e,t,r){"use strict";var i=r(4),o=r(193).start,n=Math.abs,a=Date.prototype,s=a.getTime,c=a.toISOString;e.exports=i((function(){return"0385-07-25T07:06:39.999Z"!=c.call(new Date(-50000000000001))}))||!i((function(){c.call(new Date(NaN))}))?function(){if(!isFinite(s.call(this)))throw RangeError("Invalid time value");var e=this.getUTCFullYear(),t=this.getUTCMilliseconds(),r=e<0?"-":e>9999?"+":"";return r+o(n(e),r?6:4,0)+"-"+o(this.getUTCMonth()+1,2,0)+"-"+o(this.getUTCDate(),2,0)+"T"+o(this.getUTCHours(),2,0)+":"+o(this.getUTCMinutes(),2,0)+":"+o(this.getUTCSeconds(),2,0)+"."+o(t,3,0)+"Z"}:c},function(e,t,r){r(2)({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,r){var i=r(23);e.exports=function(e){if("number"!=typeof e&&"Number"!=i(e))throw TypeError("Incorrect invocation");return+e}},function(e,t,r){var i=r(2),o=r(150),n=r(4),a=r(8),s=r(243).onFreeze,c=Object.freeze;i({target:"Object",stat:!0,forced:n((function(){c(1)})),sham:!o},{freeze:function(e){return c&&a(e)?c(s(e)):e}})},function(e,t,r){var i=r(52),o=r(8),n=r(10),a=r(12).f,s=r(51),c=r(150),d=s("meta"),l=0,u=Object.isExtensible||function(){return!0},h=function(e){a(e,d,{value:{objectID:"O"+ ++l,weakData:{}}})},p=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!n(e,d)){if(!u(e))return"F";if(!t)return"E";h(e)}return e[d].objectID},getWeakData:function(e,t){if(!n(e,d)){if(!u(e))return!0;if(!t)return!1;h(e)}return e[d].weakData},onFreeze:function(e){return c&&p.REQUIRED&&u(e)&&!n(e,d)&&h(e),e}};i[d]=!0},function(e,t,r){"use strict";var i=r(2),o=r(13).some;i({target:"Array",proto:!0,forced:!r(42)("some")},{some:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var i=r(2),o=r(14),n=r(68);i({target:"Object",stat:!0,forced:r(4)((function(){n(1)}))},{keys:function(e){return n(o(e))}})},function(e,t,r){"use strict";var i=r(2),o=r(273);i({target:"String",proto:!0,forced:r(274)("bold")},{bold:function(){return o(this,"b","","")}})},,,,,,,,function(e,t,r){var i=r(2),o=r(271).values;i({target:"Object",stat:!0},{values:function(e){return o(e)}})},function(e,t,r){"use strict";var i=r(100),o=r(9),n=r(7),a=r(20),s=r(101),c=r(103);i("match",1,(function(e,t,r){return[function(t){var r=a(this),i=null==t?void 0:t[e];return void 0!==i?i.call(t,r):new RegExp(t)[e](String(r))},function(e){var i=r(t,e,this);if(i.done)return i.value;var a=o(e),d=String(this);if(!a.global)return c(a,d);var l=a.unicode;a.lastIndex=0;for(var u,h=[],p=0;null!==(u=c(a,d));){var f=String(u[0]);h[p]=f,""===f&&(a.lastIndex=s(d,n(a.lastIndex),l)),p++}return 0===p?null:h}]}))},function(e,t,r){var i=r(2),o=r(178);i({target:"Array",proto:!0,forced:o!==[].lastIndexOf},{lastIndexOf:o})},,,function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROTO_VERSION="1.15.0",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.sdkErrorList={CLIENT:"Client.",SERVER:"Server.",SUCCESS:{code:"Success",msg:"success."},PARAM:{code:"Error.Param",msg:"input error."},HEARTBEAT_TIMEOUT:{code:"Error.Timeout",msg:"heartbeat timeout."},LOGIN_TIMEOUT:{code:"Error.Timeout",msg:"login timeout."},SEND_MSG_TIMEOUT:{code:"Error.Timeout",msg:"send customsg timeout."},RESET_QUEUE:{code:"Error.Timeout",msg:"msg waiting ack is clear when reset."},LOGIN_DISCONNECT:{code:"Error.Network",msg:"network is broken and login fail."},KICK_OUT:{code:"Error.Kickout",msg:"kickout reason="},UNKNOWN:{code:"Error.Unknown",msg:"unknown error."},FREQ_LIMITED:{code:"Error.requencyLimited",msg:"Frequency Limited."}},t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5},t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2},t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,t.MIXSTREAM_ERROR_CODE=1e4,function(e){e[e.low=1]="low",e[e.stantard=2]="stantard",e[e.hight=3]="hight",e[e.custome=4]="custome"}(t.QUALITYLEVEL||(t.QUALITYLEVEL={})),t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra"}(t.ENUM_PLAY_SOURCE_TYPE||(t.ENUM_PLAY_SOURCE_TYPE={})),function(e){e[e.stop=0]="stop",e[e.start=1]="start"}(t.ENUM_BROADCASTER_STATUS||(t.ENUM_BROADCASTER_STATUS={})),function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra",e[e.customUrl=2]="customUrl"}(t.ENUM_DISPATCH_TYPE||(t.ENUM_DISPATCH_TYPE={})),function(e){e[e.CDN=0]="CDN",e[e.BGP=1]="BGP"}(t.ENUM_SOURCE_TYPE||(t.ENUM_SOURCE_TYPE={})),function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}));var i=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=i;var o=function(){function e(){this.start=new i,this.end=new i,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new i(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,i=null;t.hasNext()&&!r;)e(t=t.next)&&(i=t,r=!0);return i},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=o},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(o,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,i,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(3),s=r(4),c=function(){function e(){}return e.checkConfigParam=function(e,t,r){return e&&"number"==typeof e&&this.checkInteger(e)?!(!t||"string"!=typeof t&&!Array.isArray(t)||""==t)||(r.error("ccp.0 server must be string or string array and not empty"),!1):(r.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkStreamID=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){var i,o;t.success&&(i=t.success,r[e+"SuccessCallback"]=i),t.error&&(o=t.error,r[e+"ErrorCallback"]=o)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,i,o){e.registerCallback(t,{success:function(t,o){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];e.dataReportEvent(r,i,t,o,n)}},o)},e.proxyRes=function(t,r,i,o){return{interResolve:function(e){t.uploadReport(r),i(e)},interReject:function(i,n){var a;if(void 0===n&&(n=""),i.code<2e9&&i.code>1e9)a=e.decodeServerError(i.code,i.msg);else{var c=s.codeErrMap[i.code];a=s.errorList[c]}a&&t.addMsgInfo(r,{error:a.code,message:a.message+n}),t.uploadReport(r),o(i)}}},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:"};if(0===e)return a.commonErrorList.SUCCESS;var r=a.liveRoomErrorList.SERVER;return r.code=e,r.msg=e>1e9?t[1e9]+e:t[e]?t[e]+" code:"+e:"unknown error code:"+e,r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return r.code=e>1e9?e-1e9+52e6:e+2002e6,t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"ROOM_ERROR_AUTHENTICATION_FAILED",2003:"ROOM_ERROR_LOGIN_TIMEOUT"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.mixServerError=function(e){var t={82000001:"kMixStreamFailError",82000002:"kMixStreamInputError",82000003:"kMixStreamAuthError",82000150:"kMixStreamNotExistError",82000151:"kMixStreamStartMixError",82000152:"kMixStreamStopMixError",82000155:"kMixStreamInputFormatError",82000156:"kMixStreamOutputFormatError",82000157:"kMixStreamNotOpenError",82000158:"kMixStreamInputExceedError",82000159:"kMixStreamDispatchError",82000160:"kMixStreamStopMixOwnerError",82000170:"kMixStreamWaterMarkParamError",82000171:"kMixStreamWaterMarkImageError",82000190:"kMixStreamQpsOverloadError"},r={1:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",190:"MIXER_START_REQUEST_ERROR"},i=[];if(e>1e9){var o=e-1e9+82e6;i[0]=t[o]?t[o]:"",i[1]=r[e-1e9]?r[e-1e9]:""}return i},e.getKickoutError=function(e){var t={};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,i,o){switch(r){case"eventStart":e.eventStart(t,i);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,i,o[0]);break;case"addEventMsg":e.addEventMsg(t,i,o[0],o[1]);break;case"addEvent":e.addEvent(t,i);break;case"eventEnd":e.eventEnd(t,i);break;case"addMsgInfo":e.addMsgInfo(t,o[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeStreamList=function(e,t,r,i,o){e.debug("msl.0 call");var n,a=[],s=[],c=[];i||(i=[]);for(var d=0;d<i.length;d++)if(i[d].anchor_id_name!=t){n=!1;for(var l=0;l<r.length;l++)if(i[d].stream_id===r[l].stream_id){i[d].extra_info!==r[l].extra_info&&c.push(i[d]),n=!0;break}n||a.push(i[d])}else e.debug("msl.0 have self stream added");for(var u=0;u<r.length;u++){n=!1;for(var h=0;h<i.length;h++)if(r[u].stream_id===i[h].stream_id){n=!0;break}n||s.push(r[u])}for(r.splice(0),d=0;d<i.length;d++)r.push(i[d]);o(a,s,c),e.debug("msl.0 call success")},e.mergeUserList=function(e,t,r,i){e.debug("msl.0 call");var o,n=[],a=[];r||(r=[]);for(var s=0;s<r.length;s++){o=!1;for(var c=0;c<t.length;c++)if(r[s].userID===t[c].userID){o=!0;break}o||n.push(r[s])}for(var d=0;d<t.length;d++){o=!1;for(var l=0;l<r.length;l++)if(t[d].userID===r[l].userID){o=!0;break}o||a.push(t[d])}for(t.splice(0),s=0;s<r.length;s++)t.push(t[s]);i(n,a),e.debug("msl.0 call success")},e.checkCustomCommandParam=function(e){return!0},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},e.uuid=function(e,t){var r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(t=t||i.length,e)for(r=0;r<e;r++)o[r]=i[0|Math.random()*t];else{var n=void 0;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",r=0;r<36;r++)o[r]||(n=0|16*Math.random(),o[r]=i[19==r?3&n|8:n])}return o.join("")},e.supportDetection=function(e,t){return i(this,void 0,void 0,(function(){var r,i,n,a,s,c;return o(this,(function(o){switch(o.label){case 0:return r={webRTC:!1,customCapture:!1,camera:!1,microphone:!1,videoCodec:{H264:!1,H265:!1,VP8:!1,VP9:!1},screenSharing:e,errInfo:{}},((i=document.createElement("video")).captureStream||i.mozCaptureStream)&&(r.customCapture=!0),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"https:"===window.location.protocol||"file:"===window.location.protocol||-1!=window.location.hostname.indexOf("127.0.0.1")||-1!=window.location.hostname.indexOf("localhost")?[3,1]:(r.camera=!1,[3,7]):[3,7];case 1:return o.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({video:!0})];case 2:return(n=o.sent())&&(r.camera=!0)&&n.getTracks().forEach((function(e){return e.stop()})),[3,4];case 3:return a=o.sent(),r.errInfo.camera={name:a.name,message:a.message},[3,4];case 4:return o.trys.push([4,6,,7]),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 5:return(s=o.sent())&&(r.microphone=!0)&&s.getTracks().forEach((function(e){return e.stop()})),[3,7];case 6:return c=o.sent(),r.errInfo.microphone={name:c.name,message:c.message},[3,7];case 7:return this.supportVideoCodeType((function(e,i){r.videoCodec.H264=e.H264,r.videoCodec.H265=e.H265,r.videoCodec.VP8=e.VP8,r.videoCodec.VP9=e.VP9,r.webRTC=e.webRTC,i&&(r.errInfo.webRTC={name:i.name,message:i.message}),t&&t(r)})),[2]}}))}))},e.getNetQuality=function(e,t){return e&&e<600?t>.4?2:t>.3?4:5:e<900?t>.4?2:t>.2?3:4:t>.2?2:3},e.getDevices=function(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){for(var r=[],i=[],o=[],n=0;n<t.length;n++){var a=t[n];"audioinput"===a.kind&&r.push({deviceName:a.label,deviceID:a.deviceId}),"audiooutput"===a.kind&&i.push({deviceName:a.label,deviceID:a.deviceId}),"videoinput"===a.kind&&o.push({deviceName:a.label,deviceID:a.deviceId})}e&&e({microphones:r,speakers:i,cameras:o})})).catch((function(e){t&&t(a.commonErrorList.ENUMERATE_DEVICES_FAIL)})):t&&t(a.publishErrorList.BROWSER_NOT_SUPPORT)},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var i=0;i<r;i++){var o=parseInt(e[i]),n=parseInt(t[i]);if(o>n)return 1;if(o<n)return-1}return 0},e.isSupportLive=function(e,t){var r=wx.getSystemInfoSync().SDKVersion,i={code:-1,msg:""};this.compareVersion(r,"1.7.0")<0&&(i={code:10001,msg:"当前微信版本过低，无法使用相关组件"},e&&e(i)),wx.getSetting({success:function(t){var r=t.authSetting;r["scope.camera"]&&r["scope.record"]||(i={code:10002,msg:"需要摄像头和录音功能的授权"}),e&&e(i)},fail:function(e){t&&t(e)}})},e.supportVideoCodeType=function(e){var t={webRTC:!1,H264:!1,VP8:!1,VP9:!1,H265:!1};try{(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){if(t.webRTC=!0,r&&r.sdp){var i=r.sdp.split("\r\n");t.H264=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H264/")>-1})),t.VP8=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP8/")>-1})),t.VP9=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP9/")>-1})),t.H265=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H264/")>-1})),e&&e(t)}}))}catch(r){e&&e(t,r)}},e.inlineWorker=function(e){if(Worker&&e){var t=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],r=URL.createObjectURL(new window.Blob([t],{type:"text/javascript"}));return new Worker(r)}return null},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),i=null!=window.opr,o=e.indexOf("Chrome")&&window.chrome,n=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":r?"Firefox":i?"Opera":o?"Chrome":n?"Safari":"Unkown"},e.isTestEnv=function(e){return-1!=e.indexOf("wss://wssliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://test2-wsliveroom-api.zego.im/ws")||-1!=e.indexOf("wss://wsliveroom-test.zegocloud.com/ws")||-1!=e.indexOf("wss://wsliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test-bak.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-hk-test.zegocloud.com/ws")||-1!=e.indexOf("wss://webliveroom-hk-test-bak.zegocloud.com/ws")},e.setDebug=function(t,r){"string"==typeof t&&t.indexOf("wss")>-1?r.debug=e.isTestEnv(t):Array.isArray(t)&&t.length>0&&t.every((function(e){return"string"==typeof e&&e.indexOf("wss")>-1}))&&(r.debug=this.isTestEnv(t[0])||this.isTestEnv(t[1])),r.testEnvironment=r.debug},e.getPublisherStateType=function(e){return 0==e||1==e?0==e?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"},e.getPlayerStateType=function(e){return 0==e||1==e?0==e?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"},e.getSteamUpdateType=function(e){return 0==e?"DELETE":"ADD"},e.getLogLevel=function(e){return n.LOG_LEVEL[e]},e}();t.ClientUtil=c},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},t.getSeq=(i=1,function(){return i++}),t.getReportSeq=function(){var e=1;return function(){return e++}}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commonErrorList={SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},PARAM:{code:2000000002,msg:"input parm error."},DETECT_TIMEOUT:{code:2000000003,msg:"detect time out"},DETECT_FAIL:{code:2000000004,msg:"detect fail"},SCREEN:{code:2000000005,msg:"screen sharing fail"},DEVICE_NO_FOUND:{code:2000000006,msg:"device no found"},ENUMERATE_DEVICES_FAIL:{code:2000000007,msg:"enumerate devices fail"},NOT_LOGIN:{code:2000000008,msg:"not login"},STOP_MIX_FAIL:{code:2000000009,msg:"stop mix stream fail"},MIX_VIDEOC:{code:2000000010,msg:"mix video code type wrong"},MIX_OUTPUT:{code:2000000011,msg:"mix output wrong"}},t.liveRoomErrorList={SERVER:{code:0,msg:"liverooom cmd error"},HEARTBEAT_TIMEOUT:{code:2001000002,msg:"heartbeat timeout."},LOGIN_TIMEOUT:{code:2001000003,msg:"login timeout."},SEND_MSG_TIMEOUT:{code:2001000004,msg:"send customsg timeout."},RESET_QUEUE:{code:2001000005,msg:"msg waiting ack is clear when reset."},LOGIN_DISCONNECT:{code:2001000006,msg:"network is broken and login fail."},UNKNOWN:{code:2001000007,msg:"unknown error."},FREQ_LIMITED:{code:2001000008,msg:"frequency limited."}},t.publishErrorList={PARAM:{code:2002000001,msg:"input param error."},BROWSER_NOT_SUPPORT:{code:2002000002,msg:"browser do not support"},DISPATCH_ERROR:{code:2002000003,msg:"dispatch request error"},DISPATCH_TIMEOUT:{code:2002000004,msg:"dispatch request timeout"},TOKEN_ERROR:{code:2002000005,msg:"login token error"},SEND_SESSION_TIMEOUT:{code:2002000006,msg:"send session request timeout"},CREATE_SESSION_ERROR:{code:2002000007,msg:"create session error"},CREATE_OFFER_ERROR:{code:2002000008,msg:"create offer error"},SET_LOCAL_DESC_ERROR:{code:2002000009,msg:"setLocalDescription error"},SEND_MEDIA_DESC_TIMEOUT:{code:2002000010,msg:"send mediaDesc timeout"},SERVER_MEDIA_DESC_TIMEOUT:{code:2002000011,msg:"waiting server mediaDesc timeout"},SERVER_MEDIA_DESC_ERROR:{code:2002000012,msg:"server mediaDesc type error"},SET_REMOTE_DESC_ERROR:{code:2002000013,msg:"other side offer error"},SEND_CANDIDATE_TIMEOUT:{code:2002000014,msg:"sendIceCandidate error"},SERVER_CANDIDATE_TIMEOUT:{code:2002000015,msg:"waiting candidate timeout"},SERVER_CANDIDATE_ERROR:{code:2002000016,msg:"recv candidate error"},SESSION_CLOSED:{code:2002000017,msg:"server session closed"},MEDIA_CONNECTION_FAILED:{code:2002000018,msg:"ice Connection state failed"},MEDIA_CONNECTION_CLOSED:{code:2002000019,msg:"ice connection state closed"},WEBSOCKET_ERROR:{code:2002000020,msg:"network error"},CONSTRAINTS_ERROR:{code:2002000021,msg:"constraint error"},MEDIA_CONNECTION_DISCONNECTED:{code:2002000022,msg:"ice connection state disconnected"},SERVER_NEGO_TIMEOUT:{code:2002000023,msg:"negotiation timeout"},CONNECT_FAILED:{code:2002000024,msg:"connect signal fail"},RETRY_TIMEOUT:{code:2002000025,msg:"retry timeout"},NETWORK_BROKEN:{code:2002000026,msg:"network broken"}},t.playErrorList={PARAM:{code:2003000001,msg:"input parm error."},REPEATED_PULL:{code:2003000002,msg:"repeated pull same stream"},DISPATCH_ERROR:{code:2003000003,msg:"dispatch request error"},DISPATCH_TIMEOUT:{code:2003000004,msg:"dispatch request timeout"},TOKEN_ERROR:{code:2003000005,msg:"login token error"},SEND_SESSION_TIMEOUT:{code:2003000006,msg:"send session request timeout"},CREATE_SESSION_ERROR:{code:2003000007,msg:"create session error"},CREATE_OFFER_ERROR:{code:2003000008,msg:"create offer error"},SERVER_MEDIA_DESC_TIMEOUT:{code:2003000009,msg:"wating server mediaDesc timeout"},SET_REMOTE_DESC_ERROR:{code:2003000010,msg:"other side offer error"},CREATE_ANSWER_ERROR:{code:2003000011,msg:"create offer error"},SET_LOCAL_DESC_ERROR:{code:2003000012,msg:"setLocalDescription error"},SEND_MEDIA_DESC_TIMEOUT:{code:2003000013,msg:"send mediaDesc timeout"},SEND_CANDIDATE_ERROR:{code:2003000014,msg:"send candidate error"},SEND_CANDIDATE_TIMEOUT:{code:2003000015,msg:"send candidate timeout"},SERVER_CANDIDATE_TIMEOUT:{code:2003000016,msg:"waiting candidate timeout"},SERVER_CANDIDATE_ERROR:{code:2003000017,msg:"recv candidate error"},MEDIA_CONNECTION_FAILED:{code:2003000018,msg:"ice Connection state failed"},MEDIA_CONNECTION_CLOSED:{code:2003000019,msg:"ice connection state closed"},SESSION_CLOSED:{code:2003000020,msg:"server session closed"},WEBSOCKET_ERROR:{code:2003000021,msg:"network error"},MEDIA_CONNECTION_DISCONNECTED:{code:2002000022,msg:"ice connection state disconnected"},SERVER_NEGO_TIMEOUT:{code:2002000023,msg:"negotiation timeout"},CONNECT_FAILED:{code:2002000024,msg:"connect signal fail"},RETRY_TIMEOUT:{code:2002000025,msg:"retry timeout"},NETWORK_BROKEN:{code:2002000026,msg:"network broken"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventList={kZegoTaskInitSetting:"/sdk/init",kZegoTaskLoginRoom:"/sdk/login",kZegoTaskLogoutRoom:"/sdk/logout",kZegoTaskReLoginRoom:"/sdk/relogin",kZegoTaskSdkDisconnect:"/sdk/disconnect",kZegoTaskKickout:"/sdk/kickout",kZegoTaskSessionClose:"/sdk/session_close",kZegoTaskLiveRoomhHB:"/liveroom/hb",kZegoTaskLiveSendRoomBigIM:"/liveroom/send_big_room_message",kZegoTaskLiveGetRoomBigIM:"/liveroom/get_big_room_message",kZegoTaskLiveRoomGetUserUpdateInfo:"/liveroom/get_user_update_info",kZegoTaskLiveRoomGetRoomMessage:"/liveroom/get_room_message",kZegoTaskLiveRoomSendRoomMessage:"/liveroom/send_room_message",kZegoTaskLiveRoomSendCustomCommand:"/liveroom/send_custom_command",kZegoTaskLiveRoomGetCustomCommand:"/liveroom/get_custom_command",kZegoTaskLiveRoomSendStreamExtraInfo:"/liveroom/send_stream_extra_info",kZegoTaskLiveRoomGetStreamExtraInfo:"/liveroom/get_stream_extra_info",kZegoTaskLiveRoomGetStreamUpdateInfo:"/liveroom/get_stream_update_info",kZegoTaskPublishStart:"/sdk/start_publish",kZegoTaskRePublish:"/sdk/republish",kZegoTaskPublishStop:"/sdk/stop_publish",kZegoTaskPlayStart:"/sdk/start_play",kZegoTaskRePlay:"/sdk/replay",kZegoTaskPlayStop:"/sdk/stop_play",kZegoTaskMixStart:"/mix/start_mix",kZegoTaskMixStop:"/mix/stop_mix",kZegoTaskMixConfig:"/mix/config_mix",kZegoTaskEnumDevices:"/sdk/enum_devices",kZegoTaskSetDebug:"/sdk/set_debug",kZegoTaskSetLog:"/sdk/set_log_config",kZegoTaskUseVideoDevice:"/sdk/use_video_device",kZegoTaskUseAudioDevice:"/sdk/use_audio_device",kZegoTaskCheckSystemRequirements:"/sdk/check_system",kZegoTaskMutePublishVideo:"/sdk/mute_publish_video",kZegoTaskMutePublishAudio:"/sdk/mute_publish_audio",kZegoTaskMutePlayVideo:"/sdk/mute_play_video",kZegoTaskMutePlayAudio:"/sdk/mute_play_audio",kZegoTaskRemoteCameraUpdate:"/sdk/remote_camera_update",kZegoTaskRemoteMicUpdate:"/sdk/remote_mic_update",kZegoTaskGetSoundLevel:"/sdk/get_sound_level",kZegoTaskStopSoundLevel:"/sdk/stop_sound_level",kZegoTaskAddPublishCdnUrl:"/sdk/add_publish_cdn_url",kZegoTaskRemovePublishCdnUrl:"/sdk/remove_publish_cdn_url",kZegoTaskClearPublishCdnUrl:"/sdk/clear_publish_cdn_url",kZegoTaskCreateStream:"/sdk/create_stream",kZegoTaskDestroyStream:"/sdk/destroy_stream",kZegoTaskScreenSharingEnded:"/sdk/screen_share_end",kZegoTaskVideoDeviceChanged:"/sdk/video_device_state_changed",kZegoTaskAudioDeviceChanged:"/sdk/audio_device_state_changed",kZegoTaskDeviceError:"/sdk/device_error",kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoSetPublishConstraints:"/sdk/set_video_config",kZegoSetAudioConfig:"/sdk/set_audio_config"},t.errorList={kOK:0,kEnd:1,kNoneAppIdError:10000101,kNotLoginError:{code:10000105,message:"sdk error, not login room"},kPublishBadNameError:10000106,kInvalidParamError:{code:10001001,message:"sdk error, invalid param."},kInvalidChannelError:10001002,kNullPointerError:10001003,kInvalidUserIDError:10001004,kInvalidRoomIDError:10001005,kNoFreeChannelError:10001101,kFormatUrlError:10001102,kInvalidExtraUrlError:10001103,kNoPushIpError:10001104,kUnmatchStreamIDError:10002001,kUnmatchSeqError:{code:10002002,message:"sdk error, unmatch seq"},kNoneSeqError:10002003,kUnmatchStateError:10002004,kRedirectError:10003001,kOutOfMemeryError:10004001,kStartThreadError:10004002,kStartRequestError:10005001,kStartUpdateStreamInfoError:10006001,kNoMultiRoomLoginRole:10007001,kMultiRoomIDMappingOther:10007002,kNetWorkProbeNoUrl:10007003,kNetWorkProbeStopPublish:10007004,kNetWorkProbeStopPlay:10007005,kFetalError1:10007101,kFetalError2:10007102,kFetalError3:10007103,kFetalError4:10007104,kFetalError5:10007105,kFetalError6:10007106,kFetalError7:10007107,kSDKNoMoudleFunction:10008001,kDeviceError:10009001,kNetworkNotConnectError:11000101,kNetworkDnsResolveError:11000404,kEngineCreateError:12101001,kEngineStatusError:12101002,kEngineStartError:12101003,kDeniedMaxRetryError:12101004,kDeniedDisableSwitchLineError:12101005,kEngineNoPlayDataError:12102001,kEngineNoPublishDataError:12102002,kEngineUnknownError:122e5,kEngineConnectServerError:12200001,kEngineRtmpHandshakeError:12200002,kEngineRtmpAppConnectError:12200003,kEngineRtmpCreateStreamError:12200004,kEngineRtmpPublishBadNameError:12200005,kEngineServerDisconnectError:12200006,kEngineRtpConnectServerError:12200100,kEngineRtpHelloTimeoutError:12200101,kEngineRtpCreateSessionTimeoutError:12200102,kEngineRtpCreateSessionFailError:12200103,kEngineRtpPlayOrPublishTimeoutError:12200104,kEngineRtpPlayOrPublishDeniedError:12200105,kEngineRtpTimeoutError:12200106,kEngineRtpDecryptError:12200107,kEngineRtpDecryptNotSupport:12200108,kEngineRtpSockError:12200109,kEngineHttpFlvProtocolError:12200200,kEngineHttpFlvHttpCodeError:12200201,kEngineHttpFlvParseFlvError:12200202,kEngineHttpFlvServerDisconnectError:12200203,kEngineHttpFlvRedirectError:12200204,kPlayStreamNotExistError:12301004,kMediaServerForbidError:12301011,kMediaServerPublishBadNameError:12301012,kMediaServerStopPublishError:12301014,kConfigDecryptError:20000001,kConfigOfflineError:20000002,kConfigDomainError:20000003,kConfigMediaNetworkNoneError:20000004,kConfigMediaNetworkNoUrlError:20000005,kConfigServerCouldntConnectError:21200007,kConfigServerTimeoutError:21200028,kConfigServerSslCaCertError:21200060,kDispatchServerInvalidError:30000001,kDispatchNoIpError:30000404,kDispatchServerCouldntConnectError:31200007,kDispatchServerTimeoutError:31200028,kDispatchServerSslCaCertError:31200060,kDispatchNotChangedError:32000001,kDispatchEmptyPublishIpsError:32001002,kDispatchEmptyPlayIpsError:32001003,kDispatchStreamNotExistError:32001004,kDispatchAgentTimeoutError:35500001,kDispatchAgentDroppedError:35500002,kLogicServerNoUrlError:40000404,kLogicServerNoIpError:40000405,kLogicServerNoStreamInfoError:40000406,kLogicServerFetalError1:40700001,kLogicServerCouldntConnectError:41200007,kLogicServerTimeoutError:41200028,kLogicServerSslCaCertError:41200060,kLoginAgentTimeoutError:45500001,kLoginAgentDroppedError:45500002,kLiveRoomRequestParamError:50001001,kLiveRoomHBTimeoutError:{code:50001002,message:"liveroom error, hb timeout"},kLiveRoomNoPushServerAddrError:50001003,kLiveRoomNoPushCryptoKeyError:50001004,kLiveRoomNoPushTokenError:50001005,kLiveRoomAutoRetryMaxTimeOut:50001006,kLiveRoomRetryRightNow:50001009,kLiveRoomWaitNetOKWillRetry:50001010,kLiveRoomLogoutWhenLogining:50001011,kLiveRoomLogoutUserCancel:50001012,kLiveRoomHBErrorNoResp:50001050,kLiveRoomHBErrorByHttpTiemout:50001051,kLiveRoomReliableMessageParseBufError:50001200,kLiveRoomReliableMessageTransChannelError:50001201,kLiveRoomReliableUserMessageBufEmpty:50001202,kLiveRoomReliableUserMessageParseBufError:50001203,kLiveRoomGetUserListParseBufError:50001204,kLiveRoomHttpNullPtrError:50001205,kLiveRoomMultiZPushSessionIDNotMatchError:50005021,kLiveRoomMultiLimitRoomCountError:50005022,kLiveRoomCouldntConnectError:51200007,kLiveRoomTimeoutError:51200028,kLiveRoomSslCaCertError:51200060,kLiveRoomInvalidRspError:51400003,kLiveRoomInputParamsError:52000002,kLiveRoomRoomAuthError:52000101,kLiveRoomRoomNotExistError:52000104,kLiveRoomUserNotExistError:52000105,kLiveRoomSetStreamInfoError:52000123,kLiveRoomStreamInfoNotExist:52000138,kLiveRoomSessionError:52000141,kLiveRoomQpsLimitError:52000201,kLiveRoomLuaSessionError:52001001,kLiveRoomAddUserError:52001002,kLiveRoomDelUserError:52001003,kLiveRoomAddTransError:52001009,kLiveRoomMaxUserCountError:52001105,kLiveRoomPublishBadNameError:52001012,kLiveRoomRequiredReloginError:52002001,kLiveRoomThirdTokenAuthError:52002002,kLiveRoomNetBrokenTimeoutError:52002003,kLiveRoomAgentTimeoutError:55500001,kLiveRoomAgentDroppedError:55500002,kRoomConnectError:60001001,kRoomDoHandShakeReqError:60001002,kRoomDoLoginReqError:60001003,kRoomTimeoutError:60001004,kRoomHbTimeoutError:60001005,kRoomStartConnectError:60001006,kRoomReconnectFailError:60001008,kRoomLoginZPushNoCryptoKey:60001009,kRoomLoginCheckMD5Fail:60001010,kRoomRetryIPOver:60001011,kRoomRetryActiveIPError:60001012,kRoomSendLoginNoZPushRsp:60001013,kRoomDoSendLoginMultiRoomReqError:60001014,kRoomZPushTcpClosed:60001015,kRoomConnectErrorQuic:60001016,kRoomInvalidSocketError:60002001,kRoomInvalidRspError:60003001,kRoomDecodeSignError:62001001,kRoomDecodeLoginError:62001002,kRoomReplayAttacksError:62002001,kRoomThirdTokenAuthError:62002002,kRoomLoginCreateUserError:62010001,kRoomLoginSameCreateUserError:62010002,kRoomStatusTimeoutError:62010005,kRoomStatusRspError:62010006,kRoomDispatchTokenBuildError:62030011,kRoomDispatchTokenDecodeError:62030012,kRoomDispatchTokenInvalidError:62030013,kRoomDispatchTokenExpiredError:62030014,kRoomMultipleLoginKickoutError:{code:63000001,message:"zpush multiple login kickout"},kRoomManualKickoutError:{code:63000002,message:"zpush manual kickout"},kRoomSessionErrorKickoutError:{code:63000003,message:"zpush room session error"},kRoomDispatchError:64000001,kRoomDispatchResultNotMatch:64000002,kRoomNoDispatchToken:64000003,kRoomSdkZpushError:65000001,kMixStreamNoneMixConfigError:80000001,kMixStreamCouldntConnectError:81200007,kMixStreamTimeoutError:81200028,kMixStreamSslCaCertError:81200060,kMixStreamFailError:{code:82000001,message:"failure"},kMixStreamInputError:{code:82000002,message:"input params error"},kMixStreamAuthError:{code:82000003,message:"Auth Failure"},kMixStreamNotExistError:{code:82000150,message:"mix stream not exist"},kMixStreamStartMixError:{code:82000151,message:"mix stream fail"},kMixStreamStopMixError:{code:82000152,message:"unmix stream fail"},kMixStreamInputFormatError:{code:82000155,message:"mix stream input format error"},kMixStreamOutputFormatError:{code:82000156,message:"mix stream output format error"},kMixStreamNotOpenError:{code:82000157,message:"mix not open"},kMixStreamInputExceedError:{code:82000158,message:"mix stream input exceed"},kMixStreamDispatchError:{code:82000159,message:"mix_dispatch fail"},kMixStreamStopMixOwnerError:{code:82000160,message:"unmix owner fail"},kMixStreamWaterMarkParamError:{code:82000170,message:"water mark params error"},kMixStreamWaterMarkImageError:{code:82000171,message:"water mark image empty"},kMixStreamQpsOverloadError:{code:82000190,message:"mix_start qps overload"},kMixStreamAgentTimeoutError:85500001,kMixStreamAgentDroppedError:85500002,kInitSdkError:{code:2001100001,message:"login but init sdk wrong"},kScreenSharingFail:{code:2001100002,message:"screen share fail"},kEnumerateDevicesFail:{code:2001100003,message:"enumerate devices fail"},kMixVideocError:{code:2001100004,message:"mix video code type wrong"},kWxGetSettingFail:{code:2001100005,message:"wx getsetting fail"},kDevicesDetectError:{code:2001100006,message:"devices detect error"},kVideoCodecDetectError:{code:2001100007,message:"videoCodec detect error"},kMixStopFail:{code:2001100008,message:"stop mix stream fail"},kLoginTimeoutError:{code:2001110001,message:"login timeout"},kSendMsgTimeout:{code:2001110002,message:"send customsg timeout."},kLiveRoomDisconnect:{code:2001110003,message:"network is broken and login fail."},kMsgFrequencyLimited:{code:2001110004,message:"send msg freq error"},kLiveRoomNotLoginError:{code:2001110005,message:"liveroom not login"},kLiveRoomMessageParseError:{code:2001110006,message:"message parse error"},kLiveRoomMessageNoneError:{code:2001110007,message:"message none error"},kBrowserNotSupport:{code:2001120001,message:"browser do not support"},kHttpsRequired:{code:2001120002,message:"https or localhost required"},kDispatchError:{code:2001120003,message:"dispatch request error"},kDispatchTimeout:{code:2001120004,message:"dispatch request timeout"},kTokenError:{code:2001120005,message:"login token error"},kSendSessionTimeout:{code:2001120006,message:"send session request timeout"},kCreateSessionError:{code:2001120007,message:"create session error"},kCreateOfferError:{code:2001120008,message:"create offer error"},kSetLocalDescError:{code:2001120009,message:"setLocalDescription error"},kSendMediaDescTimeout:{code:2001120010,message:"send mediaDesc timeout"},kServerMediaDescTimeout:{code:2001120011,message:"waiting server mediaDesc timeout"},kServerMediaDescError:{code:2001120012,message:"server mediaDesc type error"},kSetRemoteDescError:{code:2001120013,message:"other side offer error"},kSendCandidateTimeout:{code:2001120014,message:"sendIceCandidate error"},kServerCandidateTimeout:{code:2001120015,message:"waiting candidate timeout"},kServerCandidateError:{code:2001120016,message:"recv candidate error"},kSessionClosed:{code:2001120017,message:"server session closed"},kMediaConnectionFailed:{code:2001120018,message:"Iice Connection state failed"},kMediaConnectionClosed:{code:2001120019,message:"ice connection state closed"},kWebsocketError:{code:2001120020,message:"network error"},kConstraintError:{code:2001120021,message:"constraint error"},kMediaConnectionDisconnected:{code:2001120022,message:"ice connection state disconnected"},kServerNegoTimeout:{code:2001120023,message:"negotiation timeout"},kLocalStreamError:{code:2001120024,message:"local stream error"},kPublishConstraintsNotSupport:{code:2001120025,message:"publish constraints is not supported"},kGetSoundLevelError:{code:2001120026,message:"get sound level error"},kPublishStreamNotFound:{code:2001120027,message:"publish stream not found"},kPublisherRepeatError:{code:2001120028,message:"publisher already exist, publish repeat"},kPlayerRepeatError:{code:2001120029,message:"player already exist, play repeat"},kStopWhenPublishing:{code:2001120030,message:"stop publish when publishing error"},kStopWhenPlaying:{code:2001120031,message:"stop play when playing error"},kPublishRetryFail:{code:2001120032,message:"publish retry fail"},kPlayRetryFail:{code:2001120033,message:"play retry fail"},kUrlsNone:{code:2001120034,message:"url none"},kIsPublishing:{code:2001120035,message:"stream is publishing"},kIsPlaying:{code:2001120035,message:"stream is pulling"},kDecodeAudioDataFail:{code:2001120036,message:"decode audio fail"},kNoPreviewBeforePublish:{code:2001120037,message:"stream is not created by zego"},kDeviceChangeError:{code:2001130038,message:"publish error by device change"},kNoVideo:{code:2001130039,message:"video is false"},kNoAudio:{code:2001130040,message:"audio is false"},kTrackNotFound:{code:2001130041,message:"track not found"}},t.codeErrMap={1101e3:"kInitSdkError",1100001:"kInvalidParamError",1103001:"kInvalidParamError",1104001:"kInvalidParamError",1000014:"kInvalidParamError",1000015:"kInvalidParamError",1000016:"kInvalidParamError",1101001:"kInvalidParamError",1002005:"kInvalidParamError",1002006:"kInvalidParamError",1002007:"kInvalidParamError",1002008:"kInvalidParamError",1002009:"kInvalidParamError",1002010:"kInvalidParamError",1002011:"kInvalidParamError",1002012:"kInvalidParamError",1002013:"kInvalidParamError",1103010:"kScreenSharingFail",1103011:"kEnumerateDevicesFail",1103029:"kConstraintError",1103040:"kPublishStreamNotFound",1103041:"kDeviceChangeError",1103044:"kNoPreviewBeforePublish",1103045:"kNoVideo",1103046:"kNoAudio",1103047:"kTrackNotFound",1000002:"kNotLoginError",1005001:"kInvalidParamError",1005002:"kInvalidParamError",1005003:"kInvalidParamError",1005005:"kInvalidParamError",1005006:"kInvalidParamError",1005020:"kInvalidParamError",1005021:"kInvalidParamError",1005067:"kInvalidParamError",1005011:"kMixStopFail",1005023:"kMixVideocError",1102001:"kLiveRoomHBTimeoutError",1002031:"kLoginTimeoutError",1002053:"kLiveRoomDisconnect",1109001:"kMsgFrequencyLimited",2002000001:"kInvalidParamError",2002000002:"kBrowserNotSupport",2002000003:"kDispatchError",2002000004:"kDispatchTimeout",2002000005:"kTokenError",2002000006:"kSendSessionTimeout",2002000007:"kCreateSessionError",2002000008:"kCreateOfferError",2002000009:"kSetLocalDescError",2002000010:"kSendMediaDescTimeout",2002000011:"kServerMediaDescTimeout",2002000012:"kServerMediaDescError",2002000013:"kSetRemoteDescError",2002000014:"kSendCandidateTimeout",2002000015:"kServerCandidateTimeout",2002000016:"kServerCandidateError",2002000017:"kSessionClosed",2002000018:"kMediaConnectionFailed",2002000019:"kMediaConnectionClosed",2002000020:"kWebsocketError",2002000021:"kConstraintError",2002000022:"kMediaConnectionDisconnected",2002000023:"kServerNegoTimeout",2003000003:"kDispatchError",2003000004:"kDispatchTimeout",2003000005:"kTokenError",2003000006:"kSendSessionTimeout",2003000007:"kCreateSessionError",2003000008:"kCreateOfferError",2003000009:"kSetLocalDescError",2003000010:"kSendMediaDescTimeout",2003000011:"kServerMediaDescTimeout",2003000012:"kServerMediaDescError",2003000013:"kSetRemoteDescError",2003000014:"kSendCandidateTimeout",2003000015:"kServerCandidateTimeout",2003000016:"kServerCandidateError",2003000017:"kSessionClosed",2003000018:"kMediaConnectionFailed",2003000019:"kMediaConnectionClosed",2003000020:"kWebsocketError",2003000021:"kConstraintError",2003000022:"kMediaConnectionDisconnected",2003000023:"kServerNegoTimeout"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.internalErrList={SEND_MSG_TIMEOUT:{code:"Error.Timeout",msg:"send customsg timeout."}},t.errorCodeList={NOT_LOGIN:{code:1000002,msg:"not login room"},STREAMID_TOO_LONG:{code:1000014,msg:"stream ID is too long"},STREAM_ID_NULL:{code:1000015,msg:"streamID is empty"},STREAM_ID_INVALID_CHARACTER:{code:1000016,msg:"stream ID contains illegal characters"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,msg:"extra info of publshing stream is null"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,msg:"stream extra info is too long"},PUBLISHER_PARAM:{code:1103001,msg:"input parm error"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,msg:"browser do not support"},PUBLISHER_DISPATCH_FAIL:{code:1103003,msg:"dispatch request error"},PUBLISHER_SCREEN_FAILED:{code:1103010,msg:"screen fail"},ENUMERATE_DEVICES_FAIL:{code:1103011,msg:"enumerate devices fail"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,msg:"dispatch request fail"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,msg:"session request fail"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,msg:"create offer error"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,msg:"setLocalDescription error"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,msg:"mediaDesc error"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,msg:"other side offer error"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,msg:"candidate error"},PUBLISHER_SESSION_CLOSED:{code:1103027,msg:"server session closed"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,msg:"ice connection error"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,msg:"constraint error"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,msg:"negotiation timeout"},PUBLISH_NOT_PUBLISH:{code:1103040,msg:"publisher not found"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,msg:"device change "},PUBLISH_SCREEN_CANCELED:{code:1103042,msg:"screen canceled"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,msg:"screen not support"},PUBLISH_NO_PREVIEW:{code:1103044,msg:"stream is not from zego"},VIDEO_DEVICE_FALSE:{code:1103045,msg:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,msg:"audio is false"},TRACK_NOT_FOUND:{code:1103047,msg:"track is not found"},DEVICE_NOT_FOUND:{code:1103048,msg:"device is not found"},PLAYER_PARAM:{code:1104001,msg:"input parm error"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,msg:"dispatch request fail"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,msg:"session request fail"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,msg:"create offer error"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,msg:"setLocalDescription error"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,msg:"mediaDesc error"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,msg:"other side offer error"},PLAYER_CANDIDATE_ERROR:{code:1104026,msg:"candidate error"},PLAYER_SESSION_CLOSED:{code:1104027,msg:"server session closed"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,msg:"ice connection error"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,msg:"negotiation timeout"},MIXER_NO_SERVICES:{code:1005e3,msg:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,msg:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,msg:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,msg:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,msg:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,msg:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,msg:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,msg:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOPMIXER:{code:1005012,msg:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,msg:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,msg:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,msg:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,msg:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,msg:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,msg:"stream input parameters are wrong"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,msg:"more than the maximum number of output streams"},MIXER_AUTHENTICATION_FAILED:{code:1005050,msg:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,msg:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,msg:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,msg:"illegal input background image URL"},MIXER_INNER_ERROR:{code:1005099,msg:"mixed stream internal error"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,msg:"the device is unplugged"},IM_CONTENT_NULL:{code:1009001,msg:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,msg:"message content is too long"},IM_SEND_FAILED:{code:1009010,msg:"failed to send message"},FREQ_LIMITED:{code:1109001,msg:"frequency limited."}},t.exterErrorCodeMap={2002000001:"PUBLISHER_PARAM",2002000002:"PUBLISHER_BROWSER_NOT_SUPPORT",2002000003:"PUBLISHER_DISPATCH_REQUEST_FAIL",2002000004:"PUBLISHER_DISPATCH_REQUEST_FAIL",2002000005:"TOKEN_ERROR",2002000006:"PUBLISHER_SESSION_REQUEST_FAIL",2002000007:"PUBLISHER_SESSION_REQUEST_FAIL",2002000008:"PUBLISHER_CREATE_OFFER_ERROR",2002000009:"PUBLISHER_SET_LOCAL_DESC_ERROR",2002000010:"PUBLISHER_MEDIA_DESC_ERROR",2002000011:"PUBLISHER_MEDIA_DESC_ERROR",2002000012:"PUBLISHER_SET_REMOTE_DESC_ERROR",2002000013:"PUBLISHER_SET_REMOTE_DESC_ERROR",2002000014:"PUBLISHER_CANDIDATE_ERROR",2002000015:"PUBLISHER_CANDIDATE_ERROR",2002000016:"PUBLISHER_CANDIDATE_ERROR",2002000017:"PUBLISHER_SESSION_CLOSED",2002000018:"PUBLISHER_MEDIA_CONNECTION_ERROR",2002000019:"PUBLISHER_MEDIA_CONNECTION_ERROR",2002000020:"PUBLISHER_MEDIA_CONNECTION_ERROR",2002000022:"PUBLISHER_MEDIA_CONNECTION_ERROR",2002000021:"PUBLISHER_CONSTRAINTS_ERROR",2002000023:"PUBLISHER_SERVER_NEGO_TIMEOUT",2003000001:"PLAYER_PARAM",2003000003:"PLAYER_DISPATCH_REQUEST_FAIL",2003000004:"PLAYER_DISPATCH_REQUEST_FAIL",2003000005:"TOKEN_ERROR",2003000006:"PLAYER_SESSION_REQUEST_FAIL",2003000007:"PLAYER_SESSION_REQUEST_FAIL",2003000009:"PLAYER_MEDIA_DESC_ERROR",2003000010:"PLAYER_SET_REMOTE_DESC_ERROR",2003000008:"PLAYER_CREATE_OFFER_ERROR",2003000011:"PLAYER_CREATE_OFFER_ERROR",2003000012:"PLAYER_SET_LOCAL_DESC_ERROR",2003000014:"PLAYER_CANDIDATE_ERROR",2003000015:"PLAYER_CANDIDATE_ERROR",2003000016:"PLAYER_CANDIDATE_ERROR",2003000017:"PLAYER_CANDIDATE_ERROR",2003000020:"PLAYER_SESSION_CLOSED",2003000018:"PLAYER_MEDIA_CONNECTION_ERROR",2003000019:"PLAYER_MEDIA_CONNECTION_ERROR",2003000022:"PLAYER_MEDIA_CONNECTION_ERROR",2003000021:"PLAYER_MEDIA_CONNECTION_ERROR",2003000023:"PLAYER_SERVER_NEGO_TIMEOUT"}},function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<r;t++)for(var n=arguments[t],a=0,s=n.length;a<s;a++,o++)i[o]=n[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.zegoSdp=function(e){var t=e.split("\r\n"),r=[],o=[];t.forEach((function(e){var t=e.match(/a=rtpmap:(\d+)\s+((H264\/90000)|(opus\/48000\/2))/);t&&t[1]&&t[2]&&("H264/90000"===t[2]&&r.push(t[1]),"opus/48000/2"===t[2]&&o.push(t[1]))}));var n=[];return t.map((function(e){var t=!0,a=e.match(/((a=rtcp-fb:)|(a=rtpmap:)|(a=fmtp:))(\d+)/);if(a&&a[5]&&(i(r,o).some((function(e){return e==a[5]}))||(t=!1)),e.indexOf("m=video")>-1){var s=e.split(" ");e=i([s[0],s[1],s[2]],r).join(" ")}else e.indexOf("m=audio")>-1&&(s=e.split(" "),e=i([s[0],s[1],s[2]],o).join(" "));t&&n.push(e)})),n.join("\r\n")},e.getSDPByVideDecodeType=function(e,t){var r={str:"",arr:[],obj:{H264:[],H265:[],VP8:[],VP9:[],OHTER:[]}};if(!e.includes("m=video"))return e;var o=/m=video.+/.exec(e)[0];o=o.match(/[\s|\d]+/g)[1].replace(" ",""),r.str=o,r.arr=r.str.split(" "),r.arr.forEach((function(t){var i=new RegExp("a=rtpmap:"+t+".+").exec(e)[0];i.includes("H264")?r.obj.H264.push(t):i.includes("H265")?r.obj.H265.push(t):i.includes("VP8")?r.obj.VP8.push(t):i.includes("VP9")?r.obj.VP9.push(t):r.obj.OHTER.push(t)})),r.obj.OHTER.forEach((function(t){var i=new RegExp("a=fmtp:"+t+".+apt=(\\d+)").exec(e),o=i&&i[1];o&&(r.obj.H264.includes(o)?r.obj.H264.push(t):r.obj.H265.includes(o)?r.obj.H265.push(t):r.obj.VP8.includes(o)?r.obj.VP8.push(t):r.obj.VP9.includes(o)&&r.obj.VP9.push(t))}));var n=[];return"VP9"===t?n=i(r.obj.H265,r.obj.H264,r.obj.VP8):"VP8"===t?n=i(r.obj.H265,r.obj.H264,r.obj.VP9):"H264"===t?n=i(r.obj.H265,r.obj.VP8,r.obj.VP9):"H265"===t&&(n=i(r.obj.VP8,r.obj.H264,r.obj.VP9)),n.forEach((function(t){var i=r.arr.indexOf(t);r.arr.splice(i,1);var o=new RegExp("a=rtpmap:"+t+".+\\s\\n","g"),n=new RegExp("a=rtcp-fb:"+t+".+\\s\\n","g"),a=new RegExp("a=fmtp:"+t+".+\\s\\n","g");e=(e=(e=e.replace(o,"")).replace(n,"")).replace(a,"")})),e=e.replace(o,r.arr.join(" "))},e}();t.SdpUtil=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,r,i){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof i&&(this.RETRY_MAX_TIME_INTERVAL=i)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.TryHandler=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(9),o=function(){function e(e,t){this.zegoWebRTC=new i.ZegoWebRTC(e,t)}return e.prototype.addPublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWebRTC.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.addPublishCdnUrl(e,t)},e.prototype.checkSystemRequirements=function(){return this.zegoWebRTC.checkSystemRequirements()},e.prototype.createStream=function(e){return this.zegoWebRTC.createStream(e)},e.prototype.destroyStream=function(e){return this.zegoWebRTC.destroyStream(e)},e.prototype.enumDevices=function(){return this.zegoWebRTC.enumDevices()},e.prototype.getVersion=function(){return this.zegoWebRTC.getVersion()},e.prototype.loginRoom=function(e,t,r,i){return this.zegoWebRTC.loginRoom(e,t,r,i)},e.prototype.logoutRoom=function(e){return this.zegoWebRTC.logoutRoom(e)},e.prototype.mutePlayStreamAudio=function(e,t){return this.zegoWebRTC.mutePlayStreamAudio(e,t)},e.prototype.mutePlayStreamVideo=function(e,t){return this.zegoWebRTC.mutePlayStreamVideo(e,t)},e.prototype.mutePublishStreamAudio=function(e,t){return this.zegoWebRTC.mutePublishStreamAudio(e,t)},e.prototype.mutePublishStreamVideo=function(e,t){return this.zegoWebRTC.mutePublishStreamVideo(e,t)},e.prototype.off=function(e){return this.zegoWebRTC.off(e)},e.prototype.on=function(e,t){return this.zegoWebRTC.on(e,t)},e.prototype.removePublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWebRTC.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.removePublishCdnUrl(e,t)},e.prototype.replaceTrack=function(e,t){return this.zegoWebRTC.replaceTrack(e,t)},e.prototype.sendBarrageMessage=function(e,t){return this.zegoWebRTC.sendBarrageMessage(e,t)},e.prototype.sendBroadcastMessage=function(e,t){return this.zegoWebRTC.sendBroadcastMessage(e,t)},e.prototype.sendCustomCommand=function(e,t,r){return this.zegoWebRTC.sendCustomCommand(e,t,r)},e.prototype.setDebugVerbose=function(e){return this.zegoWebRTC.setDebugVerbose(e)},e.prototype.setLogConfig=function(e){return this.zegoWebRTC.setLogConfig(e)},e.prototype.setMixerTaskConfig=function(e){return this.zegoWebRTC.setMixerTaskConfig(e)},e.prototype.setMixingAudioVolume=function(e,t,r){return this.zegoWebRTC.setMixingAudioVolume(e,t,r)},e.prototype.setRoomExtraInfo=function(e,t,r){return this.zegoWebRTC.setRoomExtraInfo(e,t,r)},e.prototype.setSoundLevelDelegate=function(e,t){return this.zegoWebRTC.setSoundLevelDelegate(e,t)},e.prototype.setStreamExtraInfo=function(e,t){return this.zegoWebRTC.setStreamExtraInfo(e,t)},e.prototype.setVideoConfig=function(e,t){return this.zegoWebRTC.setVideoConfig(e,t)},e.prototype.startMixerTask=function(e){return this.zegoWebRTC.startMixerTask(e)},e.prototype.startMixingAudio=function(e,t){return this.zegoWebRTC.startMixingAudio(e,t)},e.prototype.startPlayingStream=function(e,t){return this.zegoWebRTC.startPlayingStream(e,t)},e.prototype.startPublishingStream=function(e,t,r){return this.zegoWebRTC.startPublishingStream(e,t,r)},e.prototype.stopMixerTask=function(e){return this.zegoWebRTC.stopMixerTask(e)},e.prototype.stopMixingAudio=function(e,t){return this.zegoWebRTC.stopMixingAudio(e,t)},e.prototype.stopPlayingStream=function(e){return this.zegoWebRTC.stopPlayingStream(e)},e.prototype.stopPublishingStream=function(e){return this.zegoWebRTC.stopPublishingStream(e)},e.prototype.useAudioDevice=function(e,t){return this.zegoWebRTC.useAudioDevice(e,t)},e.prototype.useVideoDevice=function(e,t){return this.zegoWebRTC.useVideoDevice(e,t)},e}();t.ZegoExpressEngine=o},function(e,t,r){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(10),c=r(12),d=r(1),l=r(21),u=r(30),h=r(31),p=r(32),f=r(3),g=r(33),m=r(2),v=r(4),y=r(5),S=function(e){function t(t,r){var i=e.call(this)||this;i.mediaEleSources=[];var o=new u.StateCenter,n=new s.LoggerWeb(o);o.logger=n,i.dataReport=new g.ZegoDataReport(n),i.ac=new("undefined"!=typeof webkitAudioContext?webkitAudioContext:AudioContext);var l=new c.ZegoStreamCenterWeb(n,o,i.dataReport,i.ac,i.mediaEleSources);i.streamCenter=l,i.logger=n,i.stateCenter=o,i.stateCenter.clientType="rtc";var h=m.getReportSeq();return i.dataReport.newReport(h),i.init(),d.ClientUtil.setDebug(r,i.stateCenter),d.ClientUtil.checkConfigParam(t,r,n)?(i.stateCenter.appid=t,"string"==typeof r?(i.stateCenter.server=r,i.stateCenter.serverBak=r):Array.isArray(r)&&r.length>0&&(i.stateCenter.server=r[0],i.stateCenter.serverBak=r[1]||r[0]),i.stateCenter.configOK=!0,i.bindWindowListener(),n.info("zc.0 "+navigator.appVersion),i.dataReport.addMsgInfo(h,{system_info:navigator.appVersion})):(n.error("zc.0 init sdk error"),i.dataReport.addMsgInfo(h,{error:v.errorList.kInvalidParamError.code,message:v.errorList.kInvalidParamError.message})),i.logger.setSessionInfo(i.stateCenter.appid,"","","","",a.PROTO_VERSION),i.stateCenter.networkState=navigator?navigator.onLine?a.ENUM_NETWORK_STATE.online:a.ENUM_NETWORK_STATE.offline:a.ENUM_NETWORK_STATE.online,i.dataReport.uploadReport(h,v.eventList.kZegoTaskInitSetting),i}return o(t,e),t.prototype.getSocket=function(e){return new WebSocket(e)},t.prototype.on=function(e,t){return this.bindListener(e,t)},t.prototype.off=function(e,t){return this.deleteListener(e,t)},t.prototype.mutePublishStreamVideo=function(e,t){var r=m.getReportSeq();this.dataReport.newReport(r,v.eventList.kZegoTaskMutePublishVideo);var i=this.enableStream(e,{video:!t});return this.dataReport.uploadReport(r),i},t.prototype.mutePublishStreamAudio=function(e,t){var r=m.getReportSeq();this.dataReport.newReport(r,v.eventList.kZegoTaskMutePublishAudio);var i=this.enableStream(e,{audio:!t});return this.dataReport.uploadReport(r),i},t.prototype.mutePlayStreamVideo=function(e,t){return this.logger.info("zc.mpsv.0 call "+e+" "+t),this.streamCenter.mutePlayStream(e,"video",t)},t.prototype.mutePlayStreamAudio=function(e,t){return this.logger.info("zc.mpsa.0 call "+e+" "+t),this.streamCenter.mutePlayStream(e,"audio",t)},t.prototype.enableStream=function(e,t){if(this.logger.debug("zc.p.ec.0 call"),"boolean"!=typeof t.video&&"boolean"!=typeof t.audio)return this.logger.error("zc.p.es.0 option error"),!1;var r=!0,i=!0;return"boolean"==typeof t.video&&(r=this.streamCenter.enableCamera(e,t.video)),"boolean"==typeof t.audio&&(i=this.streamCenter.enableMicrophone(e,t.audio)),r&&i},t.prototype.setAudioOutput=function(e,t){return this.logger.debug("zc.p.slao call"),"string"==typeof t&&this.streamCenter.setStreamAudioOutput(e,t)},t.prototype.setCustomSignalUrl=function(e){if(this.logger.debug("zc.p.scs.0 call: "+e),!e||0==e.length)return this.logger.error("zc.p.scs.0 param error"),!1;var t=!0;e.forEach((function(e){return 0!=e.indexOf("wss://")&&(t=!1)})),t?this.stateCenter.customUrl=e:this.logger.error("zc.p.scs.0 url is not correct")},t.prototype.setQualityMonitorCycle=function(e){return"number"==typeof e&&e>=1e3?(this.streamCenter.setQualityMonitorCycle(e),!0):(this.logger.error("zc.sqmc.0 time must be number and bigger than 1000"),!1)},t.prototype.startPlayingStream=function(e,t){var r=this;return this.logger.info("zc.p.sps.0 call ",e),new Promise((function(i,o){var n=m.getReportSeq();if(r.stateCenter.reportSeqList.startPlay[e]=n,r.dataReport.newReport(n,v.eventList.kZegoTaskPlayStart),void 0===e||""===e)return r.logger.error("zc.p.sps.0 streamID required"),r.dataReport.uploadReport(n,void 0,v.errorList.kInvalidParamError,"stream id required"),o(y.errorCodeList.STREAM_ID_NULL),!1;if("string"!=typeof e)return r.logger.error("zc.p.sps.0 streamID must be string and not empty"),r.dataReport.uploadReport(n,void 0,v.errorList.kInvalidParamError,"stream id type error"),o(y.errorCodeList.PLAYER_PARAM),!1;if(e.length>a.MAX_STREAM_ID_LENGTH){var s="stream id length limit";return r.logger.error("zc.sps.0 "+s),r.dataReport.uploadReport(n,void 0,v.errorList.kInvalidParamError,s),delete r.stateCenter.reportSeqList.startPlay[e],o(y.errorCodeList.STREAMID_TOO_LONG),!1}if(!d.ClientUtil.checkIllegalCharacters(e))return s="stream ID contains illegal characters",r.logger.error("zc.sps.0 "+s),r.dataReport.uploadReport(n,void 0,v.errorList.kInvalidParamError,s),delete r.stateCenter.reportSeqList.startPlay[e],o(y.errorCodeList.STREAM_ID_INVALID_CHARACTER),!1;if(void 0!==t&&"object"!=typeof t)return r.logger.error("zc.p.sps.0 playOption must be object"),r.dataReport.uploadReport(n,void 0,v.errorList.kInvalidParamError,"playOption must be object"),o(y.errorCodeList.PLAYER_PARAM),!1;if(r.stateCenter.customUrl&&r.stateCenter.customUrl.length>0)return r.streamCenter.setPlayStateStart(e,t)?(r.streamCenter.onPlayStateUpdate(a.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,msg:""}),r.streamCenter.startPlayingStream(e,r.stateCenter.customUrl,i)):(r.logger.error("zc.p.sps.0 cannot start play"),o(f.playErrorList.REPEATED_PULL),!1);if(r.dataReport.addMsgInfo(n,{streamID:e,playOption:t}),!r.stateCenter.isLogin())return r.logger.error("zc.p.sps.0 not login"),r.dataReport.uploadReport(n,void 0,v.errorList.kNotLoginError),o(y.errorCodeList.NOT_LOGIN),!1;for(var c=!1,l=0;l<r.stateCenter.streamList.length;l++)if(r.stateCenter.streamList[l].stream_id===e){c=!0;break}if(0==c&&r.logger.info("zc.p.sps.0 cannot find stream"),r.stateCenter.pullLimited||(e=NaN+e),t&&t.videoCodec&&(t.videoCodec=t.videoCodec.toUpperCase()),!r.streamCenter.setPlayStateStart(e,t))return r.logger.info("zc.p.sps.0 cannot start play"),o(f.playErrorList.REPEATED_PULL),!1;r.streamCenter.onPlayStateUpdate(a.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,msg:""});var u={stream_id:e,ptype:"pull",signals:r.streamCenter.getAllInUseUrl()};r.streamCenter.playSuccessCallBackList[e]=i,r.socketCenter.registerRouter("webrtc_url",(function(e){r.handleFetchWebRtcUrlRsp(e)}));var h=r.socketCenter.sendMessage("webrtc_url",u,void 0,(function(t){r.logger.info("zc.p.sps.0 dispatch error"),t==y.errorCodeList.TIMEOUT?r.streamCenter.onPlayStateUpdate(a.ENUM_PLAY_STATE_UPDATE.error,e,f.playErrorList.DISPATCH_TIMEOUT):r.streamCenter.onPlayStateUpdate(a.ENUM_PLAY_STATE_UPDATE.error,e,f.playErrorList.DISPATCH_ERROR),r.streamCenter.stopPlayingStream(e)}));return r.streamCenter.playerList[e]&&(r.streamCenter.playerList[e].seq=h),!0}))},t.prototype.stopPlayingStream=function(e){this.logger.info("zc.p.sps.1.0 call",e);var t=m.getReportSeq();if(this.stateCenter.reportSeqList.stopPlay[e]=t,this.dataReport.newReport(t,v.eventList.kZegoTaskPlayStop),this.dataReport.addMsgInfo(t,{streamID:e}),"string"!=typeof e||""===e)return this.logger.error("zc.p.sps.1.0 streamid must be string and not empty"),this.dataReport.uploadReport(t,void 0,v.errorList.kInvalidParamError,"stream id type error"),void delete this.stateCenter.reportSeqList.stopPlay[e];var r=this.streamCenter.playerList[e],i=r&&r.player&&r.player.state!==a.ENUM_PLAY_STATE.stop;for(var o in this.streamCenter.stopPlayingStream(e),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[o]===e){delete this.stateCenter.streamUrlMap[o];break}this.dataReport.uploadReport(t),i&&this.streamCenter.onPlayStateUpdate(a.ENUM_PLAY_STATE_UPDATE.error,e,{code:0,msg:""}),this.logger.debug("zc.p.sps.1.0 call success")},t.prototype.setTurnOverTcpOnly=function(e){this.logger.info("zc.stoto.0 call "+e),"boolean"==typeof e?this.stateCenter.turnOverTcpOnly=e:this.logger.error("zc.p.stoto.0 param must be param")},t.prototype.createStream=function(e){var r=this;return this.logger.debug("ze.cs.0 call"),e&&e.camera&&e.camera.audioBitRate&&(e.camera.audioBitrate=e.camera.audioBitRate),e&&e.camera&&e.camera.bitrate&&(e.camera.bitRate=e.camera.bitrate),e&&e.screen&&"object"==typeof e.screen&&e.screen.bitrate&&(e.screen.bitRate=e.screen.bitrate),e&&e.custom&&e.custom.bitrate&&(e.custom.bitRate=e.custom.bitrate),new Promise((function(i,o){var n=m.getReportSeq();r.dataReport.newReport(n,v.eventList.kZegoTaskCreateStream);var a=function(e){r.dataReport.uploadReport(n),i(e)},s=function(e,t){void 0===t&&(t="");var i=v.codeErrMap[e.code];i?r.dataReport.addMsgInfo(n,{error:v.errorList[i].code,message:v.errorList[i].message+t}):r.dataReport.addMsgInfo(n,{error:e.code,message:e.msg}),r.dataReport.uploadReport(n),e.code>2e9&&y.exterErrorCodeMap[e.code]&&(e.code=y.errorCodeList[y.exterErrorCodeMap[e.code]].code),e.code&&e.msg&&t?o({code:e.code,msg:e.msg+t}):o(e)};if("https:"!==window.location.protocol&&"file:"!==window.location.protocol&&-1==window.location.hostname.indexOf("127.0.0.1")&&-1==window.location.hostname.indexOf("localhost"))return r.logger.error("ze.cs.0 https or localhost required "),r.dataReport.addMsgInfo(n,{error:v.errorList.kHttpsRequired.code,message:v.errorList.kHttpsRequired.message}),r.dataReport.uploadReport(n),void o({code:y.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT.code,msg:y.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT.msg+" https or localhost required"});if(e&&e.screen){if(!r.checkScreenParams(e.screen,s))return;var c=d.ClientUtil.getBrowser(),l=r.streamCenter.getScreenConstrains(e.screen);r.dataReport.addMsgInfo(n,{stream_type:"screen",screen:l});var u=function(e){r.streamCenter.createScreenPreviewer(e,l)&&a(e),e.getVideoTracks()[0].onended=function(){var t=m.getReportSeq();r.dataReport.newReport(t),r.dataReport.uploadReport(t,v.eventList.kZegoTaskScreenSharingEnded),e&&r.streamCenter.stopPreview(e),r.stateCenter.actionListener("screenSharingEnded",e)}};"Firefox"==c?r.startScreenShotFirFox("screen",l,(function(e,t,r){e?t&&u(t):r&&s(r)})):"Chrome"==c&&t.screenShotReady?r.startScreenShotChrome((function(e,t,i){e?(r.logger.info("ze.cs.0 using extention"),t&&u(t)):(i&&r.logger.error("ze.cs.0 extention "+i),"SS_DIALOG_CANCEL"!==i?r.startScreenSharing(l,(function(e,t,i){e?t&&u(t):(r.logger.error("ze.cs.0 "+i),i&&s(i))})):i&&s(y.errorCodeList.PUBLISH_SCREEN_CANCELED))})):r.startScreenSharing(l,(function(e,t,r){e?t&&u(t):r&&s(r)}))}else{if(e&&"object"==typeof e.camera&&void 0!==e.camera.videoQuality&&!d.ClientUtil.checkInteger(e.camera.videoQuality))return r.logger.error("ze.cs.0 videoQuality must be integer number"),void s(f.publishErrorList.PARAM," videoQuality must be integer number");if(e&&e.camera&&e.camera.audioBitrate){if(!d.ClientUtil.checkInteger(e.camera.audioBitrate))return r.logger.error("ze.cs.0 audioBitrate must be integer number"),void s(f.publishErrorList.PARAM," audioBitrate must be integer number");if(e.camera.audioBitrate<6)return r.logger.error("ze.cs.0 audioBitrate cannot less 6 kbps"),void s(f.publishErrorList.PARAM," audioBitrate cannot less 6 kbps");if(e.camera.audioBitrate>510)return r.logger.error("ze.cs.0 audioBitrate cannot greater than 510 kbps"),void s(f.publishErrorList.PARAM," audioBitrate cannot greater than 510 kbps");r.stateCenter.audioBitRate=1e3*e.camera.audioBitrate}if(e&&e.camera&&e.camera.bitRate){if("number"!=typeof e.camera.bitRate)return r.logger.error("ze.cs.0 bitrate must be integer number"),void s(f.publishErrorList.PARAM," bitrate must be integer number");if(e.camera.bitRate>10240)return r.logger.error("ze.cs.0 bitrate cannot greater than 10 Mbps"),void s(f.publishErrorList.PARAM," bitrate cannot greater than 10 Mbps")}if(e&&e.camera&&void 0!==e.camera.channelCount&&!d.ClientUtil.checkInteger(e.camera.channelCount))return r.logger.error("ze.cs.0 channelCount must be integer number"),void s(f.publishErrorList.PARAM," channelCount must be integer number");if(e&&e.camera&&4===e.camera.videoQuality&&!r.checkCameraParams(e.camera,s))return;if(e&&e.custom&&e.custom.bitRate){if(!d.ClientUtil.checkInteger(e.custom.bitRate))return r.logger.error("ze.cs.0 bitrate must be integer number"),void s(f.publishErrorList.PARAM," bitrate must be integer number");if(e.custom.bitRate>10240)return r.logger.error("ze.cs.0 bitrate cannot greater than 10 Mbps"),void s(f.publishErrorList.PARAM," bitrate cannot greater than 10 Mbps")}var h={};e&&e.camera?(h=e.camera,r.dataReport.addMsgInfo(n,{stream_type:"camera",camera:e.camera}),"boolean"!=typeof h.video&&(h.video=!0),"boolean"!=typeof h.audio&&(h.audio=!0)):e&&e.custom&&(h=e.custom,r.dataReport.addMsgInfo(n,{stream_type:"custom",custom:e.custom})),r.streamCenter.startPreview(h,a,s)}}))},t.prototype.checkScreenParams=function(e,t){if("object"==typeof e&&void 0!==e.videoQuality&&!d.ClientUtil.checkInteger(e.videoQuality))return this.logger.error("ze.cs.0 videoQuality must be integer number"),t(f.publishErrorList.PARAM," videoQuality must be integer number"),!1;if("object"==typeof e&&4===e.videoQuality){if(void 0===e.bitRate)return this.logger.error("ze.cs.0 bitrate is required when videoQuality is 4"),t(f.publishErrorList.PARAM," bitrate is required when videoQuality is 4"),!1;if(!d.ClientUtil.checkInteger(e.bitRate))return this.logger.error("ze.cs.0 bitrate must be integer number"),t(f.publishErrorList.PARAM," bitrate must be integer number"),!1;if(e.bitRate>10240)return this.logger.error("ze.cs.0 bitrate cannot greater than 10 Mbps"),t(f.publishErrorList.PARAM," bitrate cannot greater than 10 Mbps"),!1;if(void 0===e.frameRate)return this.logger.error("ze.cs.0 frameRate is required when videoQuality is 4"),t(f.publishErrorList.PARAM," frameRate is required when videoQuality is 4"),!1;if(!d.ClientUtil.checkInteger(e.frameRate))return this.logger.error("ze.cs.0 frameRate must be integer number"),t(f.publishErrorList.PARAM," frameRate must be integer number"),!1;if(void 0===e.width)return this.logger.error("ze.cs.0 width is required when videoQuality is 4"),t(f.publishErrorList.PARAM," width is required when videoQuality is 4"),!1;if(!d.ClientUtil.checkInteger(e.width))return this.logger.error("ze.cs.0 width must be integer number"),t(f.publishErrorList.PARAM," width must be integer number"),!1;if(void 0===e.height)return this.logger.error("ze.cs.0 height is required when videoQuality is 4"),t(f.publishErrorList.PARAM," height is required when videoQuality is 4"),!1;if(!d.ClientUtil.checkInteger(e.height))return this.logger.error("ze.cs.0 height must be integer number"),t(f.publishErrorList.PARAM," height must be integer number"),!1}return!0},t.prototype.checkCameraParams=function(e,t){return e.width&&d.ClientUtil.checkValidNumber(e.width)?e.height&&d.ClientUtil.checkValidNumber(e.height)?e.frameRate&&d.ClientUtil.checkValidNumber(e.frameRate)?!(!e.bitRate||!d.ClientUtil.checkValidNumber(e.bitRate))||(this.logger.error("ze.cs.0 bitrate must be integer number"),t(f.publishErrorList.PARAM," bitrate must be integer number"),!1):(this.logger.error("ze.cs.0 frameRate must be integer number"),t(f.publishErrorList.PARAM," frameRate must be integer number"),!1):(this.logger.error("ze.cs.0 height must be integer number"),t(f.publishErrorList.PARAM," height must be integer number"),!1):(this.logger.error("ze.cs.0 width must be integer number"),t(f.publishErrorList.PARAM," width must be integer number"),!1)},t.prototype.destroyStream=function(e){this.logger.info("zc.p.sp.1 call");var t=m.getReportSeq();if(this.dataReport.newReport(t),!(e instanceof MediaStream)||e instanceof MediaStream&&0==e.getTracks().length)return this.logger.error("zc.p.sp.1 localStream is not mediaStream or tracks is null"),this.dataReport.addMsgInfo(t,{error:v.errorList.kLocalStreamError.code,message:v.errorList.kLocalStreamError.message}),void this.dataReport.uploadReport(t,v.eventList.kZegoTaskDestroyStream);this.streamCenter.stopPreview(e),this.dataReport.uploadReport(t,v.eventList.kZegoTaskDestroyStream)},t.prototype.startPublishingStream=function(e,t,r){var i=this;this.logger.info("zc.sps.0 call ",e);var o=m.getReportSeq();if(this.stateCenter.reportSeqList.startPublish[e]=o,this.dataReport.newReport(o,v.eventList.kZegoTaskPublishStart),void 0===e)return this.logger.error("zc.p.sps.0 streamID required"),this.dataReport.uploadReport(o,void 0,v.errorList.kInvalidParamError,"stream id required"),!1;if(!e||"string"!=typeof e){var n="stream id type wrong";return this.logger.error("zc.sps.0 "+n),this.dataReport.uploadReport(o,void 0,v.errorList.kInvalidParamError,n),delete this.stateCenter.reportSeqList.startPublish[e],!1}if(e.length>a.MAX_STREAM_ID_LENGTH)return n="stream id length limit",this.logger.error("zc.sps.0 "+n),this.dataReport.uploadReport(o,void 0,v.errorList.kInvalidParamError,n),delete this.stateCenter.reportSeqList.startPublish[e],!1;if(!d.ClientUtil.checkIllegalCharacters(e))return n="stream ID contains illegal characters",this.logger.error("zc.sps.0 "+n),this.dataReport.uploadReport(o,void 0,v.errorList.kInvalidParamError,n),delete this.stateCenter.reportSeqList.startPublish[e],!1;if(!t||t instanceof MediaStream&&0==t.getTracks().length)return n="localStream wrong",this.logger.error("zc.sps.0 "+n),this.dataReport.uploadReport(o,void 0,v.errorList.kInvalidParamError,n),delete this.stateCenter.reportSeqList.startPublish[e],!1;if(!this.streamCenter.checkPreview(t))return n="stream is not from zego",this.logger.error("zc.sps.0 "+n),this.dataReport.uploadReport(o,void 0,v.errorList.kNoPreviewBeforePublish,n),delete this.stateCenter.reportSeqList.startPublish[e],!1;if(void 0!==r&&"object"!=typeof r)return this.logger.error("zc.p.sps.0 publishOption must be object"),this.dataReport.uploadReport(o,void 0,v.errorList.kInvalidParamError,"publishOption must be object"),!1;if(void 0!==r&&void 0!==r.streamParams&&"string"!=typeof r.streamParams)return this.logger.error("zc.p.sps.0 publishOption streamParams must be string"),this.dataReport.uploadReport(o,void 0,v.errorList.kInvalidParamError," publishOption streamParams must be string"),!1;if(void 0!==r&&void 0!==r.extraInfo&&"string"!=typeof r.extraInfo)return this.logger.error("zc.p.sps.0 publishOption extraInfo must be string"),this.dataReport.uploadReport(o,void 0,v.errorList.kInvalidParamError," publishOption extraInfo must be string"),!1;if(void 0!==r&&void 0!==r.videoCodec&&"string"!=typeof r.videoCodec)return this.logger.error("zc.p.sps.0 publishOption videoCodec must be string"),this.dataReport.uploadReport(o,void 0,v.errorList.kInvalidParamError," publishOption videoCodec must be string"),!1;if(!this.stateCenter.isLogin())return this.logger.error("zc.p.sps.1 not login"),this.dataReport.uploadReport(o,void 0,v.errorList.kNotLoginError),delete this.stateCenter.reportSeqList.startPublish[e],!1;if(r||(r={}),r&&r.videoCodec&&(r.videoCodec=r.videoCodec.toUpperCase()),this.dataReport.addMsgInfo(o,{streamID:e,publishOption:r}),r.audioBitRate=this.stateCenter.audioBitRate,this.stateCenter.customUrl&&0!=this.stateCenter.customUrl.length)return this.stateCenter.publishStreamList[e]={state:a.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},this.streamCenter.setPublishStateStart(e,t,r)?(this.streamHandler.onPublishStateUpdate(a.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,msg:""}),this.streamCenter.startPublishingStream(e,this.stateCenter.customUrl)):(this.logger.info("zc.p.sps.1 cannot start publish"),!1);if(this.stateCenter.publishStreamList[e]={state:a.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},!this.streamCenter.setPublishStateStart(e,t,r))return this.logger.error("zc.p.sps.1 cannot start publish"),!1;this.logger.info("zc.p.sps.1 start publish"),this.streamHandler.onPublishStateUpdate(a.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,msg:""});var s={stream_id:e,ptype:"push",signals:this.streamCenter.getAllInUseUrl(),header_kvs:[{key:"grpc-metadata-push",value:r&&r.cdnUrl||""}]};this.socketCenter.registerRouter("webrtc_url",(function(e){i.handleFetchWebRtcUrlRsp(e)}));var c=this.socketCenter.sendMessage("webrtc_url",s,void 0,(function(t){i.logger.info("zc.p.sps.1 dispatch error"),t==y.errorCodeList.TIMEOUT?i.streamHandler.onPublishStateUpdate(a.ENUM_PUBLISH_STATE_UPDATE.error,e,f.publishErrorList.DISPATCH_TIMEOUT):i.streamHandler.onPublishStateUpdate(a.ENUM_PUBLISH_STATE_UPDATE.error,e,f.publishErrorList.DISPATCH_ERROR),i.streamCenter.stopPublishingStream(e)}));return this.streamCenter.publisherList[e]&&(this.streamCenter.publisherList[e].seq=c),!0},t.prototype.stopPublishingStream=function(e){this.logger.info("zc.p.sps.1.1 call ",e);var t=m.getReportSeq();if(this.stateCenter.reportSeqList.stopPublish[e]=t,this.dataReport.newReport(t,v.eventList.kZegoTaskPublishStop),this.dataReport.addMsgInfo(t,{streamID:e}),"string"!=typeof e||""==e)return this.logger.error("zc.p.sps.1.1 streamID must be string and not empty"),this.dataReport.uploadReport(t,void 0,v.errorList.kInvalidParamError,"stream id type error"),delete this.stateCenter.reportSeqList.stopPublish[e],!1;var r=this.streamCenter.publisherList[e],i=r&&r.publisher&&r.publisher.state!==a.ENUM_PUBLISH_STATE.stop;if(this.streamCenter.stopPublishingStream(e),this.stateCenter.publishStreamList[e]){if(this.stateCenter.publishStreamList[e].state>=a.ENUM_PUBLISH_STREAM_STATE.update_info){this.streamHandler.updateStreamInfo(e,a.ENUM_STREAM_SUB_CMD.liveEnd);for(var o=0;o<this.stateCenter.streamList.length;o++)if(this.stateCenter.streamList[o].stream_id==e){this.stateCenter.streamList.splice(o--,1);break}}delete this.stateCenter.publishStreamList[e]}return this.dataReport.uploadReport(t),i&&this.streamHandler.onPublishStateUpdate(a.ENUM_PUBLISH_STATE_UPDATE.error,e,{code:0,msg:""}),!0},t.prototype.setVideoConfig=function(e,t){var r=this;return this.logger.info("zc.spsc.0 call"),new Promise((function(i,o){var n=m.getReportSeq();return r.dataReport.newReport(n,v.eventList.kZegoSetPublishConstraints),e instanceof MediaStream?t&&"object"==typeof t&&0!=Object.keys(t).length?t.width&&!d.ClientUtil.checkValidNumber(t.width)?(r.logger.error("zc.spsc.0 constraints width integer number, range[1, 10000]"),r.dataReport.addMsgInfo(n,{error:v.errorList.kInvalidParamError.code,message:v.errorList.kInvalidParamError.message+" constraints width integer number, range[1, 10000]"}),r.dataReport.uploadReport(n),void o({errorCode:y.errorCodeList.PUBLISHER_PARAM.code,extendedData:y.errorCodeList.PUBLISHER_PARAM.msg+" constraints wrong"})):t.height&&!d.ClientUtil.checkValidNumber(t.height)?(r.logger.error("zc.spsc.0 constraints height integer number, range[1, 10000]"),r.dataReport.addMsgInfo(n,{error:v.errorList.kInvalidParamError.code,message:v.errorList.kInvalidParamError.message+" constraints height integer number, range[1, 10000]"}),r.dataReport.uploadReport(n),void o({errorCode:y.errorCodeList.PUBLISHER_PARAM.code,extendedData:y.errorCodeList.PUBLISHER_PARAM.msg+" constraints wrong"})):void r.streamCenter.setPublishStreamConstraints(e,t,(function(){r.dataReport.uploadReport(n),i({errorCode:0,extendedData:""})}),(function(e){var t=v.codeErrMap[e.code];t?r.dataReport.addMsgInfo(n,{error:v.errorList[t].code,message:e.msg}):r.dataReport.addMsgInfo(n,{error:e.code,message:e.msg}),r.dataReport.uploadReport(n),o({errorCode:e.code,extendedData:e.msg})})):(r.logger.error("zc.spsc.0 constraints wrong"),r.dataReport.addMsgInfo(n,{error:v.errorList.kInvalidParamError.code,message:v.errorList.kInvalidParamError.message}),r.dataReport.uploadReport(n),void o({errorCode:y.errorCodeList.PUBLISHER_PARAM.code,extendedData:y.errorCodeList.PUBLISHER_PARAM.msg+" constraints wrong"})):(r.logger.error("zc.spsc.0 localStream not found"),r.dataReport.addMsgInfo(n,{error:v.errorList.kLocalStreamError.code,message:v.errorList.kLocalStreamError.message}),r.dataReport.uploadReport(n),void o({errorCode:y.errorCodeList.PUBLISHER_PARAM.code,extendedData:y.errorCodeList.PUBLISHER_PARAM.msg+" localStream no found"}))}))},t.prototype.setAudioConfig=function(e,t){var r=this;return this.logger.info("zc.sac.0 call"),new Promise((function(i,o){var n=m.getReportSeq();return r.dataReport.newReport(n,v.eventList.kZegoSetAudioConfig),e instanceof MediaStream?t&&"object"==typeof t&&0!=Object.keys(t).length?void r.streamCenter.setPublishStreamConstraints(e,t,(function(){r.dataReport.uploadReport(n),i({errorCode:0,extendedData:""})}),(function(e){var t=v.codeErrMap[e.code];t?r.dataReport.addMsgInfo(n,{error:v.errorList[t].code,message:e.msg}):r.dataReport.addMsgInfo(n,{error:e.code,message:e.msg}),r.dataReport.uploadReport(n),o({errorCode:e.code,extendedData:e.msg})})):(r.logger.error("zc.spsc.0 constraints wrong"),r.dataReport.addMsgInfo(n,{error:v.errorList.kInvalidParamError.code,message:v.errorList.kInvalidParamError.message}),r.dataReport.uploadReport(n),void o({errorCode:y.errorCodeList.PUBLISHER_PARAM.code,extendedData:y.errorCodeList.PUBLISHER_PARAM.msg+" constraints wrong"})):(r.logger.error("zc.spsc.0 localStream not found"),r.dataReport.addMsgInfo(n,{error:v.errorList.kLocalStreamError.code,message:v.errorList.kLocalStreamError.message}),r.dataReport.uploadReport(n),void o({errorCode:y.errorCodeList.PUBLISHER_PARAM.code,extendedData:y.errorCodeList.PUBLISHER_PARAM.msg+" localStream no found"}))}))},t.prototype.replaceTrack=function(e,t){var r=this;return new Promise((function(i,o){return e instanceof MediaStream?t&&t instanceof MediaStreamTrack?void r.streamCenter.replaceTrack(e,t,i,o):(r.logger.error("zp.rt.0 mediastream track no found"),void o({errorCode:y.errorCodeList.INPUT_PARAM.code,extendedData:y.errorCodeList.INPUT_PARAM.msg+" mediastream track no found"})):(r.logger.error("zp.rt.0 localStream not found"),void o({errorCode:y.errorCodeList.INPUT_PARAM.code,extendedData:y.errorCodeList.INPUT_PARAM.msg+" localStream no found"}))}))},t.prototype.preloadEffect=function(e,t,r){e&&"string"==typeof e&&t&&"string"==typeof t?this.stateCenter.audioEffectBuffer[e]?this.logger.error("zc.pe.0 audio buffer already exists"):(this.logger.info("zc.pe.0 start preload effect"),this.streamCenter.preloadEffect(this.ac,e,t,r)):this.logger.error("zc.pe.0 params error")},t.prototype.playEffect=function(e,t,r){e.streamID&&"string"==typeof e.streamID&&e.effectID&&"string"==typeof e.effectID?this.stateCenter.audioEffectBuffer[e.effectID]?this.streamCenter.playEffect(e,t,r):this.logger.error("zc,pe.1 audio buffer dosesn't exists"):this.logger.error("zc.pe.1 params error")},t.prototype.pauseEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error("zc.pe.2 effect "),this.streamCenter.pauseEffect(e,t)):(this.logger.error("zc.pe.2 streamID format error"),!1)},t.prototype.resumeEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error("zc.pe.2 effect "),this.streamCenter.resumeEffect(e,t)):(this.logger.error("zc.pe.2 streamID format error"),!1)},t.prototype.stopEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error("zc.pe.2 effect "),this.streamCenter.stopEffect(e,t)):(this.logger.error("zc.pe.2 streamID format error"),!1)},t.prototype.unloadEffect=function(e){return e&&"string"==typeof e?(delete this.stateCenter.audioEffectBuffer[e],!0):(this.logger.error("zc.ue.0 params error"),!1)},t.prototype.startMixingAudio=function(e,t){return this.logger.debug("zc.sma.0 call"),e&&"string"==typeof e?t?Array.isArray(t)&&0!==t.length?this.streamCenter.startMixingAudio(e,t):(this.logger.error("zc.sma.0 audio param type error"),!1):(this.logger.error("zc.sma.0 no audio"),!1):(this.logger.error("zc.sma.0 stream id type error"),!1)},t.prototype.stopMixingAudio=function(e,t){return e&&"string"==typeof e?Array.isArray(t)&&0!==t.length||void 0===t?this.streamCenter.stopMixingAudio(e,t):(this.logger.error("zc.sma.0 audio param type error"),!1):(this.logger.error("zc.sma.1 param streamID format error"),!1)},t.prototype.mixingBuffer=function(e,t,r,i){return this.logger.info("zc.mb.0 call "+t),e&&"string"==typeof e?t&&"string"==typeof t?void this.streamCenter.mixingBuffer(e,t,r,i):(this.logger.error("zc.mb.0 param source id format error"),!1):(this.logger.error("zc.mb.0 param streamid format error"),!1)},t.prototype.stopMixingBuffer=function(e,t){return this.logger.info("zc.smb.0 call "+t),e&&"string"==typeof e?t&&"string"==typeof t?this.streamCenter.stopMixingBuffer(e,t):(this.logger.error("zc.sma.1 param source id format error"),!1):(this.logger.error("zc.sma.1 param streamid format error"),!1)},t.prototype.setMixingAudioVolume=function(e,t,r){return this.logger.debug("zc.sma.2 call"),"string"!=typeof e||""==e?(this.logger.error("zc.sma.2 stream ID must be string and not empty"),!1):"number"!=typeof t||t<0||t>100?(this.logger.error("zc.sma.2 volume must be a number between 0 and 100"),!1):r&&r instanceof HTMLMediaElement?this.streamCenter.setMixingAudioVolume(e,t,r):(this.logger.error("zc.sma.2 no audio"),!1)},t.prototype.startScreenShotChrome=function(e){if(t.screenShotReady)window.postMessage({type:"SS_UI_REQUEST",text:"start"},"*"),d.ClientUtil.registerCallback("screenShare",{success:e},this.stateCenter.callbackList);else{var r='zc.b.ss Please install the extension:1. Go to chrome://extensions  2. Check: "Enable Developer mode   3. Click: "Load the unpacked extension... 4. Choose "extension" folder from the repository 5. Reload this page';this.logger.error(r),e(!1,null,{code:y.errorCodeList.PUBLISHER_SCREEN_FAILED.code,msg:y.errorCodeList.PUBLISHER_SCREEN_FAILED.msg+" "+r})}},t.prototype.startScreenSharing=function(e,t){var r=this;"getDisplayMedia"in navigator.mediaDevices?navigator.mediaDevices.getDisplayMedia({audio:e.audio,video:{frameRate:e.frameRate,width:e.width,height:e.height}}).then((function(e){t(!0,e)})).catch((function(e){r.logger.error("zc.b.sss "+e),e.message&&"permission denied"==e.message.toLowerCase()?t(!1,null,y.errorCodeList.PUBLISH_SCREEN_CANCELED):t(!1,null,{code:y.errorCodeList.PUBLISHER_SCREEN_FAILED.code,msg:y.errorCodeList.PUBLISHER_SCREEN_FAILED.msg+" "+e})})):(this.logger.error("zc.b.sss brower does not support getDisplayMedia"),t(!1,null,y.errorCodeList.PUBLISH_SCREEN_NOT_SUPPORT))},t.prototype.startScreenShotFirFox=function(e,t,r){var i=this,o={video:{frameRate:t.frameRate,bitRate:t.bitRate,width:t.width,height:t.height},audio:t.audio};o.video.mediaSource=e,navigator.mediaDevices.getUserMedia(o).then((function(e){r(!0,e)})).catch((function(e){i.logger.error("ze.ssf.1 "+e),r(!1,null,{code:y.errorCodeList.PUBLISHER_SCREEN_FAILED.code,msg:y.errorCodeList.PUBLISHER_SCREEN_FAILED.msg+" "+e})}))},t.prototype.stopScreenShot=function(){this.stateCenter.screenShotStream.getTracks().forEach((function(e){e.stop()})),window.postMessage({type:"SS_UI_CANCEL",text:"start"},"*")},t.prototype.WebrtcOnPublishStateUpdateHandle=function(e,t,r){this.stateCenter.publishStreamList[t].state==a.ENUM_PUBLISH_STREAM_STATE.publishing&&this.streamHandler.onPublishStateUpdate(e,t,r)},t.prototype.setCDNInfo=function(e,t){e.urlFlv=t.urls_flv instanceof Array?t.urls_flv[0]:"string"==typeof t.urls_flv?t.urls_flv:"",e.urlHls=t.urls_m3u8 instanceof Array?t.urls_m3u8[0]:"string"==typeof t.urls_m3u8?t.urls_m3u8:"",e.urlHttpsFlv=t.urls_https_flv instanceof Array?t.urls_https_flv[0]:"string"==typeof t.urls_https_flv?t.urls_https_flv:"",e.urlHttpsHls=t.urls_https_m3u8 instanceof Array?t.urls_https_m3u8[0]:"string"==typeof t.urls_https_m3u8?t.urls_https_m3u8:"",e.urlRtmp=t.urls_rtmp instanceof Array?t.urls_rtmp[0]:"string"==typeof t.urls_rtmp?t.urls_rtmp:""},t.prototype.loginBodyData=function(){return{id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:this.stateCenter.token,version:a.PROTO_VERSION,room_name:this.stateCenter.roomid,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:a.E_CLIENT_TYPE.ClientType_Webrtc,third_token:this.stateCenter.third_token,user_count_limit:this.stateCenter.maxMemberCount,relate_service:this.stateCenter.relateService.join()||""}},t.prototype.screenStreamFrom=function(e,t,r){var i={};i.audio={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}},i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:window.screen.width,maxHeight:window.screen.height}},!t&&(i.audio=!1),navigator.mediaDevices.getUserMedia(i).then((function(e){r(!0,e)})).catch((function(e){r(!1,null,e)}))},t.prototype.filterStreamList=function(e){var t={},r={},i={},o=[],n=0;for(var a in this.stateCenter.streamList.forEach((function(t,r){t.stream_id==e&&(n=r)})),this.stateCenter.streamList[n])"urls_flv"!=a&&"urls_https_flv"!=a||(t[a]=this.stateCenter.streamList[n][a]),"urls_m3u8"!=a&&"urls_https_m3u8"!=a||(r[a]=this.stateCenter.streamList[n][a]),"urls_rtmp"==a&&(i[a]=this.stateCenter.streamList[n][a]);var s=window.location.protocol,c=window.navigator.userAgent;if(/Safari/.test(c)&&!/Chrome/.test(c))for(var a in r)r[a]&&r[a].forEach((function(e){-1!==e.indexOf(s)&&o.push(e)}));else if("http:"==s)for(var a in t)t[a]&&t[a].forEach((function(e){-1===e.indexOf("http")&&-1===e.indexOf("https")||o.push(e)}));else if("https:"==s)for(var a in t)t[a]&&t[a].forEach((function(e){-1!==e.indexOf(s)&&o.push(e)}));else if("rtmp:"==s)for(var a in i)i[a]&&i[a].forEach((function(e){-1!==e.indexOf(s)&&o.push(e)}));return o.filter((function(e,t,r){return r.indexOf(e)==t}))},t.prototype.checkSystemRequirements=function(){var e=this,r=navigator&&navigator.mediaDevices&&(t.screenShotReady||"getDisplayMedia"in navigator.mediaDevices);return new Promise((function(t){var i=m.getReportSeq();e.dataReport.newReport(i,v.eventList.kZegoTaskCheckSystemRequirements),d.ClientUtil.supportDetection(r,(function(r){e.dataReport.addMsgInfo(i,{capability:r}),e.dataReport.uploadReport(i),t(r)}))}))},t.prototype.enumDevices=function(){var e=this;return this.logger.info("zc.ed.0 call"),new Promise((function(t,r){var i=m.getReportSeq();e.dataReport.newReport(i,v.eventList.kZegoTaskEnumDevices),d.ClientUtil.getDevices((function(r){e.dataReport.addMsgInfo(i,{microphones:r.microphones,speakers:r.speakers,cameras:r.cameras}),e.dataReport.uploadReport(i),t(r)}),(function(t){var o=v.codeErrMap[t.code];o&&e.dataReport.addMsgInfo(i,{error:v.errorList[o].code,message:v.errorList[o].message}),e.dataReport.uploadReport(i),r(t)}))}))},t.prototype.getAudioInfo=function(e,t,r){if(!e)return!1;var i=n({},r);return new h.MediaUtil(this.ac,i).connectToSource(e,(function(e){t(e)}))},t.prototype.getSoundLevel=function(e,t,r){this.logger.info("zc.gsl call");var i=m.getReportSeq();this.dataReport.newReport(i,v.eventList.kZegoTaskGetSoundLevel);try{var o=this.ac.createMediaStreamSource(e),n=this.ac.createScriptProcessor(4096,1,1);this.stateCenter.audioStreamList[e.id]={mic:o,script:n},o.connect(n),n.connect(this.ac.destination),n.onaudioprocess=function(e){for(var r=e.inputBuffer.getChannelData(0),i=0,o=0;o<r.length;o++)i<r[o]&&(i=r[o]);t(i)},this.dataReport.uploadReport(i)}catch(e){r(e),this.dataReport.addMsgInfo(i,{error:v.errorList.kGetSoundLevelError.code,message:v.errorList.kGetSoundLevelError.message}),this.dataReport.uploadReport(i)}this.logger.info("zc.gsl call success")},t.prototype.stopSoundLevel=function(e){this.logger.info("zc.ssl call");var t=m.getReportSeq();this.dataReport.newReport(t,v.eventList.kZegoTaskStopSoundLevel);var r=this.stateCenter.audioStreamList[e.id];r.mic.disconnect(),r.script.disconnect(),delete this.stateCenter.audioStreamList[e.id],this.dataReport.uploadReport(t)},t.handleDataAvailable=function(e){e.data&&e.data.size>0&&t.recordedBlobs.push(e.data)},t.prototype.startRecord=function(e){var r=e.captureStream();t.recordedBlobs=[];var i={mimeType:"video/webm;codecs=vp9"};p.MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:"video/webm;codecs=vp8"},p.MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:"video/webm"},p.MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:""})));try{t.mediaRecorder=new p.MediaRecorder(r,i)}catch(e){return}t.mediaRecorder.onstop=function(e){},t.mediaRecorder.ondataavailable=t.handleDataAvailable,t.mediaRecorder.start(10)},t.prototype.stopRecord=function(){t.mediaRecorder&&t.mediaRecorder.stop()},t.prototype.resumeRecord=function(){t.mediaRecorder&&t.mediaRecorder.resume()},t.prototype.pauseRecord=function(){t.mediaRecorder&&t.mediaRecorder.pause()},t.prototype.saveRecord=function(e){if(t.mediaRecorder&&t.recordedBlobs){var r=new Blob(t.recordedBlobs,{type:"video/webm"}),i=window.URL.createObjectURL(r),o=document.createElement("a");o.style.display="none",o.href=i,o.download=e+".webm",document.body.appendChild(o),o.click(),setTimeout((function(){document.body.removeChild(o),window.URL.revokeObjectURL(i)}),100)}},t.prototype.takeSnapShot=function(e,t){if(e&&0!==e.videoHeight){var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;var i=r.getContext("2d");i&&i.drawImage(e,0,0,r.width,r.height),t.src=r.toDataURL("image/jpeg")}},t.prototype.saveSnapShot=function(e,t){if(e&&0!==e.videoHeight){var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;var i=r.getContext("2d");i&&i.drawImage(e,0,0,r.width,r.height),r.toBlob((function(e){var r=window.URL.createObjectURL(e),i=document.createElement("a");i.style.display="none",i.href=r,i.download=t+".jpeg",document.body.appendChild(i),i.click(),setTimeout((function(){document.body.removeChild(i),window.URL.revokeObjectURL(r)}),100)}))}},t.prototype.useVideoDevice=function(e,t){var r=this;return this.logger.info("zc.uvd.0 call"),new Promise((function(i,o){var n=m.getReportSeq();if(r.dataReport.newReport(n,v.eventList.kZegoTaskUseVideoDevice),r.dataReport.addMsgInfo(n,{deviceID:t}),!(e instanceof MediaStream))return r.logger.error("zc.uvd.0 localStream not found"),r.dataReport.addMsgInfo(n,{error:v.errorList.kLocalStreamError.code,message:v.errorList.kLocalStreamError.message}),r.dataReport.uploadReport(n),void o({errorCode:y.errorCodeList.PUBLISHER_PARAM.code,extendedData:y.errorCodeList.PUBLISHER_PARAM.msg});if("string"!=typeof t)return r.logger.error("zc.uvd.0 deviceID must be string"),r.dataReport.addMsgInfo(n,{error:v.errorList.kInvalidParamError.code,message:v.errorList.kInvalidParamError.message+" deviceID must be string"}),r.dataReport.uploadReport(n),void o({errorCode:y.errorCodeList.PUBLISHER_PARAM.code,extendedData:y.errorCodeList.PUBLISHER_PARAM.msg});var a=function(e){r.dataReport.uploadReport(n),i(e)},s=function(e){var t=v.codeErrMap[e.code];t&&r.dataReport.addMsgInfo(n,{error:v.errorList[t].code,message:v.errorList[t].message}),r.dataReport.uploadReport(n),o({errorCode:e.code,extendData:e.msg})};d.ClientUtil.getDevices((function(i){if(!i.cameras.find((function(e){return e.deviceID==t})))return r.logger.error("zc.uvd.0 device is not found"),void o({errorCode:y.errorCodeList.DEVICE_NOT_FOUND.code,extendedData:y.errorCodeList.DEVICE_NOT_FOUND.msg});r.streamCenter.switchDevice("video",e,t,a,s)}),(function(i){r.logger.warn("zc.uvd.0 getDevices err:",i),r.streamCenter.switchDevice("video",e,t,a,s)}))}))},t.prototype.useAudioDevice=function(e,t){var r=this;return this.logger.info("zc.uad.1 call"),new Promise((function(i,o){var n=m.getReportSeq();if(r.dataReport.newReport(n,v.eventList.kZegoTaskUseAudioDevice),r.dataReport.addMsgInfo(n,{deviceID:t}),!(e instanceof MediaStream))return r.logger.error("zc.uad.1 localStream not found"),r.dataReport.addMsgInfo(n,{error:v.errorList.kLocalStreamError.code,message:v.errorList.kLocalStreamError.message}),r.dataReport.uploadReport(n),void o({errorCode:y.errorCodeList.PUBLISHER_PARAM.code,extendedData:y.errorCodeList.PUBLISHER_PARAM.msg});if("string"!=typeof t)return r.logger.error("zc.uad.1 deviceID must be string"),r.dataReport.addMsgInfo(n,{error:v.errorList.kInvalidParamError.code,message:v.errorList.kInvalidParamError.message+" deviceID must be string"}),r.dataReport.uploadReport(n),void o({errorCode:y.errorCodeList.PUBLISHER_PARAM.code,extendedData:y.errorCodeList.PUBLISHER_PARAM.msg});var a=function(e){r.dataReport.uploadReport(n),i(e)},s=function(e){var t=v.codeErrMap[e.code];t&&r.dataReport.addMsgInfo(n,{error:v.errorList[t].code,message:v.errorList[t].message}),r.dataReport.uploadReport(n),o({errorCode:e.code,extendData:e.msg})};d.ClientUtil.getDevices((function(i){if(!i.microphones.find((function(e){return e.deviceID==t})))return r.logger.error("zc.uad.1 device is not found"),void o({errorCode:y.errorCodeList.DEVICE_NOT_FOUND.code,extendedData:y.errorCodeList.DEVICE_NOT_FOUND.msg});r.streamCenter.switchDevice("audio",e,t,a,s)}),(function(i){r.logger.warn("zc.uad.1 getDevices err:",i),r.streamCenter.switchDevice("audio",e,t,a,s)}))}))},t.prototype.setSoundLevelDelegate=function(e,t){this.logger.info("zc.ssd.0 call"),"boolean"==typeof e?t&&(!d.ClientUtil.checkInteger(t)||t<100||t>3e3)?this.logger.error("zc.ssd.0 soundLevel interval must be integer number which is between 100 and 3000"):this.streamCenter.setSoundLevelDelegate(e,t):this.logger.error("zc.ssd.0 param 1 must be boolean")},t.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)?"pagehide":"unload";window.addEventListener(t,(function(){for(var t in window.event&&(window.event.cancelBubble=!0),e.streamCenter.publisherList)e.stopPublishingStream(t);for(var t in e.streamCenter.playerList)e.stopPlayingStream(t);e.logoutRoom(e.stateCenter.roomid)})),window.addEventListener("message",(function(t){var r=t.data,i=r.type,o=r.streamId,n=r.canRequestAudioTrack;"SS_DIALOG_SUCCESS"===i&&e.screenStreamFrom(o,n,d.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)),"SS_DIALOG_CANCEL"===i&&d.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)(!1,null,i)})),window.addEventListener("offline",(function(t){for(var r in e.logger.info("zc.off.0 newtwork is broken"),e.stateCenter.networkState=a.ENUM_NETWORK_STATE.offline,e.stateCenter.roomTryHandler&&(e.stateCenter.roomTryHandler.invalid(),e.stateCenter.roomTryHandler.onactive=function(t,r){e.disconnectedHandle(r)},e.stateCenter.roomTryHandler.startMaxTime(),e.roomStateHandle("CONNECTING",y.errorCodeList.NETWORK_BROKEN)),e.streamCenter.publisherList)(i=e.streamCenter.publisherList[r].streamTryHandler).startMaxTime(),i.invalid();for(var r in e.streamCenter.playerList){var i;(i=e.streamCenter.playerList[r].streamTryHandler).startMaxTime(),i.invalid()}})),window.addEventListener("online",(function(t){if(e.logger.info("zc.on.0 network is online"),e.stateCenter.networkState=a.ENUM_NETWORK_STATE.online,e.stateCenter.roomTryHandler&&e.socketCenter.isDisConnect())e.stateCenter.roomTryHandler.active();else if(e.stateCenter.roomTryHandler){for(var r in e.stateCenter.roomTryHandler.stopMaxTime(),e.streamCenter.publisherList)for(var i=e.streamCenter.publisherList[r].publisher,o=0;o<e.stateCenter.streamList.length;o++)if(i.state==a.ENUM_PUBLISH_STATE.stop&&e.stateCenter.streamList[o].stream_id==r){e.streamHandler.updateStreamInfo(r,a.ENUM_STREAM_SUB_CMD.liveEnd,e.stateCenter.publishStreamList[r].extra_info),e.stateCenter.streamList.splice(o--,1);break}e.roomStateHandle("CONNECTED",{code:0,msg:""})}for(var r in e.streamCenter.publisherList){i=e.streamCenter.publisherList[r].publisher;var n=e.streamCenter.publisherList[r].streamTryHandler;i.state==a.ENUM_PUBLISH_STATE.stop||i.stateNego!==a.ENUM_PUBLISH_STATE_NEGO.iceConnected?!n.isOverTime&&e.streamCenter.publishStateHandle(a.ENUM_PUBLISH_STATE_UPDATE.error,r,f.publishErrorList.NETWORK_BROKEN):i.state==a.ENUM_PUBLISH_STATE.publishing&&n.stopMaxTime()}for(var r in e.streamCenter.playerList){var s=e.streamCenter.playerList[r].player;n=e.streamCenter.playerList[r].streamTryHandler,s.state==a.ENUM_PLAY_STATE.stop||s.stateNego!==a.ENUM_PLAY_STATE_NEGO.iceConnected?!n.isOverTime&&e.streamCenter.playStateHandle(a.ENUM_PLAY_STATE_UPDATE.error,r,f.playErrorList.NETWORK_BROKEN):s.state==a.ENUM_PLAY_STATE.playing&&n.stopMaxTime()}}))},t.screenShotReady=!1,t}(l.BaseCenter);t.ZegoWebRTC=S,window.addEventListener("message",(function(e){var t=e.data.type;e.origin,window.location.origin,"SS_PING"===t&&(S.screenShotReady=!0)}))},function(e,t,r){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=r(11),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.openWebSocketLogServer=function(e){if(this.url!=e){if(this.url=e,!e)return;this.stopWebSocketServer(),this.websocket=new WebSocket(e),this.websocket.onopen=function(e){},this.websocket.onclose=function(e){},this.websocket.onmessage=function(e){},this.websocket.onerror=function(e){}}},t.prototype.SendHttpsLog=function(){var e=this;if(0!=this.logCacheSend.length){var t=this.logCacheSend.join("\n"),r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){if(0==r.responseText.length)return;try{var t=JSON.parse(r.responseText).interval;"number"==typeof t&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))}catch(e){}}},r.open("POST",this.url,!0),r.send(t),this.logCacheSend=[]}},t.prototype.logReportParamList=function(e,t){var r=new Date,i=r.getFullYear()+"/";return i+=(n.D[r.getMonth()+1]||r.getMonth()+1)+"/",i+=(n.D[r.getDate()]||r.getDate())+" ",i+=(n.D[r.getHours()]||r.getHours())+":",i+=(n.D[r.getMinutes()]||r.getMinutes())+":",i+=n.D[r.getSeconds()]||r.getSeconds(),i+="."+r.getTime()%1e3,t.time=i,t.level=e,t.console="rtc",t.appid=this.appid,t.room_id=this.roomid,t.roomid=this.roomid,t.userid=this.userid,t.id_name=this.userid,t.userName=this.userName,t.sessionid=this.sessionid,t.sdk_version=this.version,t.test_environment=this.stateCenter.testEnvironment,t.version=this.version,this.appid&&this.userid&&(t.event_id=this.appid+"_"+this.userid+"_"+t.event_time+"_"+t.seq),[JSON.stringify(t)]},t}(n.Logger);t.LoggerWeb=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0);t.D=["00","01","02","03","04","05","06","07","08","09"];var o=function(){function e(e){this.logLevel=i.ENUM_LOG_LEVEL.info,this.logRemoteLevel=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.stateCenter=e}return e.prototype.setLogLevel=function(e){this.logLevel<i.ENUM_LOG_LEVEL.debug||this.logLevel>i.ENUM_LOG_LEVEL.report?this.logLevel=i.ENUM_LOG_LEVEL.disable:this.logLevel=e},e.prototype.setRemoteLogLevel=function(e){this.logRemoteLevel<i.ENUM_LOG_LEVEL.debug||this.logRemoteLevel>i.ENUM_LOG_LEVEL.report?this.logRemoteLevel=i.ENUM_LOG_LEVEL.disable:this.logRemoteLevel=e},e.prototype.setSessionInfo=function(e,t,r,i,o,n){this.appid=e,this.roomid=t,this.sessionid=r,this.userid=i,this.userName=o,this.version=n},e.prototype.openLogServer=function(e){try{e.startsWith("wss:")?(this.logType=i.ENUM_REMOTE_TYPE.websocket,this.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=i.ENUM_REMOTE_TYPE.https,this.openHttpsLogServer(e)):this.logType=i.ENUM_REMOTE_TYPE.disable}catch(e){this.error(JSON.stringify(e))}},e.prototype.stopLogServer=function(){this.logType==i.ENUM_REMOTE_TYPE.websocket?this.stopWebSocketServer():this.logType==i.ENUM_REMOTE_TYPE.https&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=i.ENUM_REMOTE_TYPE.disable},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.openHttpsLogServer=function(e){var t=this;this.url=e,e&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){t.SendHttpsLog()}),this.logUploadInterval)))},e.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},e.prototype.report=function(e){var t=this.logReportParamList(i.ENUM_LOG_LEVEL.report,e);this.logLevel!==i.ENUM_LOG_LEVEL.disable&&(this.logLevel,i.ENUM_LOG_LEVEL.report),this.RemoteLog(i.ENUM_LOG_LEVEL.report,t,!0)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.debug,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.disable&&(this.logLevel,i.ENUM_LOG_LEVEL.debug),this.log(i.ENUM_LOG_LEVEL.debug,r)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.info,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.disable&&(this.logLevel,i.ENUM_LOG_LEVEL.info),this.log(i.ENUM_LOG_LEVEL.info,r)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.warn,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.disable&&(this.logLevel,i.ENUM_LOG_LEVEL.warn),this.log(i.ENUM_LOG_LEVEL.warn,r)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.error,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.disable&&this.logLevel<=i.ENUM_LOG_LEVEL.error&&(window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(i.ENUM_LOG_LEVEL.error,r)},e.prototype.log=function(e,t){this.logRemoteLevel!==i.ENUM_LOG_LEVEL.disable&&this.logRemoteLevel<=e&&this.RemoteLog(e,t)},e.prototype.RemoteLog=function(e,t,r){if(void 0===r&&(r=!1),""!=this.url)if(this.logType==i.ENUM_REMOTE_TYPE.websocket)this.RemoteWebSocketLog(e,t);else if(this.logType==i.ENUM_REMOTE_TYPE.https)this.RemoteHttpsLog(e,t,r);else if(this.logLevel!==i.ENUM_LOG_LEVEL.disable&&this.logLevel<=e)for(this.logCacheSend.push(t);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},e.prototype.RemoteWebSocketLog=function(e,t){if("string"==typeof t&&t.length>4e3);else if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var r=this.url;this.url="",this.openLogServer(r),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var i="",o=0;o<this.logCacheSend.length;o++)(i+this.logCacheSend[o]).length>4e3&&(this.websocket.send(i),i=""),i=i+this.logCacheSend[o]+"\n";t=i+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.RemoteHttpsLog=function(e,t,r){this.logCacheSend.push(t),(this.logCacheSend.length>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},e.prototype.logParamList=function(e,r){var i=new Date,o=i.getFullYear()+"/";o+=(t.D[i.getMonth()+1]||i.getMonth()+1)+"/",o+=(t.D[i.getDate()]||i.getDate())+" ",o+=(t.D[i.getHours()]||i.getHours())+":",o+=(t.D[i.getMinutes()]||i.getMinutes())+":",o+=t.D[i.getSeconds()]||i.getSeconds(),o+="."+i.getTime()%1e3;var n=r.substr(0,r.indexOf(" "));0==n.length&&(n=r);var a=r.substr(r.indexOf(" ")+1,4500);0==a.length&&(a="");var s={time:o,level:e,action:n,content:a,appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(s)},e}();t.Logger=o},function(e,t,r){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<r;t++)for(var n=arguments[t],a=0,s=n.length;a<s;a++,o++)i[o]=n[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var a=r(13),s=r(14),c=r(3),d=r(2),l=r(0),u=r(17),h=r(18),p=r(19),f=r(4),g=r(1),m=r(5),v=r(20),y=function(e){function t(t,r,i,o,n){var a=e.call(this,t,r)||this;return a.testEnvironment=!1,a.heartbeatTimer=null,a.heartbeatInterval=1e4,a.qualityTimerInterval=3e3,a.previewVideoList=[],a.signalList={},a.chargeInfos={itemtype:"ChargeInfos",timestamp_begin:0,timestamp_end:0,timestamp_diff_flag:0,timestamp_diff:0,infos:[]},a.chargeInfosTimer=null,a.chargeInfosInterval=6e4,a.chargeInfoSeq=0,a.soundLevelDelegate=!1,a.soundLevelInterval=1e3,a.tryCountConnectInterval=3e3,a.checkMessageTimeout=function(){for(var e in a.signalList)a.signalList[e].signal&&a.signalList[e].signal.checkMessageTimeout()},a.getAllInUseUrl=function(){var e=[];for(var t in a.signalList)e.push(t);return e},a.onDisconnectHandle=function(e){if(a.logger.info("zsc.od.0 call"),a.signalList[e]){for(var t=a.signalList[e],r=0;r<t.publishConnectedList.length;r++){var i=a.publisherList[t.publishConnectedList[r]];i&&i.publisher&&i.publisher.onDisconnect()}for(r=0;r<t.playConnectedList.length;r++){var o=a.playerList[t.playConnectedList[r]];o&&o.player&&o.player.onDisconnect()}delete a.signalList[e],a.stopSignalHeartbeat(),a.stopChargeInfosUpload(),a.stopSoundLevel()}},a.logger=t,a.stateCenter=r,a.dataReport=i,a.ac=o,a.mediaEleSources=n,a}return o(t,e),t.prototype.onSignalDisconnected=function(e){},t.prototype.setQualityMonitorCycle=function(e){var t=this;return this.logger.debug("zsc.qmc.0 timeInterval "+e),0==Object.keys(this.publisherList).length?this.qualityTimerInterval=e:Object.keys(this.publisherList).forEach((function(r){t.publisherList[r].publisher.qualityTimeInterval=e,t.publisherList[r].publisher.setPublishQualityTimer()})),!0},t.prototype.setSessionInfo=function(e,t,r,i){this.logger.debug("zsc.ssi.0 called"),this.appid=e,this.userid=t,this.token=r,this.testEnvironment=i},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onUpdateHeartBeartIntervalHandle=function(e){e!=this.heartbeatInterval&&(this.logger.debug("zsc.uhb.0 update "+e),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatInterval=e,this.startSignalHeartbeat())},t.prototype.enableMicrophone=function(e,t){var r=this.checkPreview(e);return r?r.enableMicrophone(t,this):(this.logger.error("zsc.em.0 no preview"),!1)},t.prototype.enableCamera=function(e,t){var r=this.checkPreview(e);return r?r.enableCamera(t,this):(this.logger.error("zsc.ec.0 no preview"),!1)},t.prototype.mutePlayStream=function(e,t,r){var i=this;return this.logger.info("zsc.mps.0 call "+t+" "+r),new Promise((function(o,n){if("string"!=typeof e||""==e)return i.logger.error("zsc.mps.0 streamID must be string and not empty"),void n(!1);if("boolean"!=typeof r)return i.logger.error("zsc.mps.0 mute must be boolean"),void n(!1);var a=i.playerList[e];if(!a)return i.logger.error("zsc.mps.0 player not found"),void n(!1);if("video"===t){if(a.playOption&&!1===a.playOption.video||a.player&&0!==a.player.cameraStatus)return i.logger.error("zsc.mps.0 stream no contain video"),void n(!1);a.player.signal.ActivatePlayVideoStream(d.getSeq(),a.player.sessionId,r,(function(){i.logger.info("zsc.mps.0 suc"),o(!0)}),(function(){i.logger.error("zsc.mps.0 fail"),n(!1)}))}else{if(a.playOption&&!1===a.playOption.audio||a.player&&0!==a.player.micStatus)return i.logger.error("zsc.mps.0 stream no contain audio"),void n(!1);a.player.signal.ActivatePlayAudioStream(d.getSeq(),a.player.sessionId,r,(function(){i.logger.info("zsc.mps.0 suc"),o(!0)}),(function(){i.logger.error("zsc.mps.0 fail"),n(!1)}))}}))},t.prototype.recordDevices=function(){var e=this;this.logger.info("zsc.rd.0 call"),g.ClientUtil.getDevices((function(t){e.stateCenter.deviceInfos={microphones:t.microphones,speakers:t.speakers,cameras:t.cameras}}),(function(t){e.logger.warn("zsc.rd.0 getDevices err:",t)})),void 0!==navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(t){e.logger.info("zsc.rd.0 devicechange"),e.stateCenter.deviceChangeTimer&&(clearTimeout(e.stateCenter.deviceChangeTimer),e.stateCenter.deviceChangeTimer=null),e.stateCenter.deviceChangeTimer=setTimeout((function(){g.ClientUtil.getDevices((function(t){for(var r=[],i=function(i){var o=e.stateCenter.deviceInfos.cameras[i];t.cameras.find((function(e){return e.deviceID===o.deviceID}))||r.push(o)},o=0;o<e.stateCenter.deviceInfos.cameras.length;o++)i(o);e.stateCenter.deviceStateOut=!1;var n=!1;r.length>0&&(n=!0),r.forEach((function(t){for(var r in e.publisherList){var i=e.publisherList[r].localStream;if(i&&e.publisherList[r].cameraLabel===t.deviceName){n=!1;var o=e.publisherList[r].publisher;o.signal.sendStreamStatus(d.getSeq(),o.sessionId,-6,i.getAudioTracks()[0]&&1==i.getAudioTracks()[0].enabled?0:2,o.streamId);var a=d.getReportSeq();e.dataReport.newReport(a,f.eventList.kZegoTaskDeviceError),e.dataReport.addMsgInfo(a,{stream_id:o.streamId,reason:"device out",device:t.deviceName}),e.dataReport.uploadReport(a),e.stateCenter.actionListener("deviceError",m.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,t.deviceName)}i&&0===i.getAudioTracks().length&&(n=!1)}})),n&&(e.stateCenter.deviceStateOut=!0);var a=e.stateCenter.deviceInfos.microphones.filter((function(e){return!t.microphones.find((function(t){return t.deviceID===e.deviceID}))}));a.forEach((function(t){for(var r in e.publisherList){var i=e.publisherList[r].localStream;if(i&&(e.publisherList[r].microLabel===t.deviceName||e.publisherList[r].microLabel.includes(t.deviceName))){var o=e.publisherList[r].publisher;o.signal.sendStreamStatus(d.getSeq(),o.sessionId,i.getVideoTracks()[0]&&1==i.getVideoTracks()[0].enabled?0:2,-6,o.streamId);var n=d.getReportSeq();e.dataReport.newReport(n,f.eventList.kZegoTaskDeviceError),e.dataReport.addMsgInfo(n,{stream_id:o.streamId,reason:"device out",device:t.deviceName}),e.dataReport.uploadReport(n),e.stateCenter.actionListener("deviceError",m.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,e.publisherList[r].microLabel)}}}));var s=e.stateCenter.deviceInfos.speakers.filter((function(e){return!t.speakers.find((function(t){return t.deviceID===e.deviceID}))})),c=t.cameras.filter((function(t){return!e.stateCenter.deviceInfos.cameras.find((function(e){return e.deviceID===t.deviceID}))})),l=t.microphones.filter((function(t){return!e.stateCenter.deviceInfos.microphones.find((function(e){return e.deviceID===t.deviceID}))})),u=t.speakers.filter((function(t){return!e.stateCenter.deviceInfos.speakers.find((function(e){return e.deviceID===t.deviceID}))}));r.forEach((function(t){var r=d.getReportSeq();e.dataReport.newReport(r,f.eventList.kZegoTaskVideoDeviceChanged),e.dataReport.addMsgInfo(r,{update_type:"delete",device:t}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("videoDeviceStateChanged","DELETE",t)})),a.forEach((function(t){var r=d.getReportSeq();e.dataReport.newReport(r,f.eventList.kZegoTaskAudioDeviceChanged),e.dataReport.addMsgInfo(r,{update_type:"delete",device_type:"input",device:t}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Input",t)})),s.forEach((function(t){var r=d.getReportSeq();e.dataReport.newReport(r,f.eventList.kZegoTaskAudioDeviceChanged),e.dataReport.addMsgInfo(r,{update_type:"delete",device_type:"output",device:t}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Output",t)})),c.forEach((function(t){var r=d.getReportSeq();e.dataReport.newReport(r,f.eventList.kZegoTaskVideoDeviceChanged),e.dataReport.addMsgInfo(r,{update_type:"add",device:t}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("videoDeviceStateChanged","ADD",t)})),l.forEach((function(t){var r=d.getReportSeq();e.dataReport.newReport(r,f.eventList.kZegoTaskAudioDeviceChanged),e.dataReport.addMsgInfo(r,{update_type:"add",device_type:"input",device:t}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("audioDeviceStateChanged","ADD","Input",t)})),u.forEach((function(t){var r=d.getReportSeq();e.dataReport.newReport(r,f.eventList.kZegoTaskAudioDeviceChanged),e.dataReport.addMsgInfo(r,{update_type:"add",device_type:"output",device:t}),e.dataReport.uploadReport(r),e.stateCenter.actionListener("audioDeviceStateChanged","ADD","Output",t)})),e.stateCenter.deviceInfos={microphones:t.microphones,speakers:t.speakers,cameras:t.cameras}}),(function(t){e.logger.warn("zsc.rd.0 getDevices err:",t)}))}),500)})},t.prototype.startPreview=function(e,t,r){var i=this,o=null;return o=new a.ZegoPreview(this.logger),this.previewVideoList.push(o),o.startPreview(e,(function(e){i.logger.debug("zsc.sp.0 call success"),!i.stateCenter.deviceInfos&&i.recordDevices(),t&&t(e)}),(function(e){i.previewVideoList=i.previewVideoList.filter((function(e){return e!==o})),r&&r(e)})),!0},t.prototype.stopPreview=function(e){if(!e)return this.logger.warn("zsc.sp.0 localStream null"),!1;for(var t in this.publisherList)this.publisherList[t].localStream===e&&(this.publisherList[t].localStream=null);var r=this.checkPreview(e);return r?(r.previewSuc&&(r.stopPreview(),this.removePreview(r)),!0):(this.logger.warn("zsc.sp.0 no preview"),!1)},t.prototype.setPublishStateStart=function(e,t,r){var i=this,o=this.publisherList[e],n=this.stateCenter.reportSeqList.startPublish[e];if(this.dataReport.eventStart(n,"setPublishState"),o)return this.logger.error("zsc.pss.0 publisher already exist"),this.dataReport.eventEndWithMsgInfo(n,"setPublishState",{message:"publisher already exist"}),this.dataReport.uploadReport(n,void 0,f.errorList.kIsPublishing),delete this.stateCenter.reportSeqList.startPublish[e],!1;var a=new s.ZegoPublish(this.logger,null,this.dataReport,this.qualityTimerInterval,this,this.ac,this.mediaEleSources,this.stateCenter);a.state=l.ENUM_PUBLISH_STATE.start,a.reportSeq=this.stateCenter.reportSeqList.startPublish[e]||0,a.onPublishStateUpdate=function(t,r,o,n){var a=i.publisherList[r];a?i.publishStateHandle(t,a.streamID,o,n):i.logger.error("zsc.psuh.0 cannot find publish "+e)},a.onPublishQualityUpdate=function(t,r){var o=i.publisherList[t];o?(i.stateCenter.deviceStateOut&&0===r.audio.audioBitrate?(o.deviceStateCount++,o.deviceStateCount>=2&&(o.deviceStateCount=0,i.stateCenter.deviceStateOut=!1,i.logger.warn("zsc.pss.0 publish audio error by device"))):o.deviceStateCount=0,i.onPublishQualityUpdate(o.streamID,r)):i.logger.error("zsc.psuh.0 cannot find publish "+e)};var c=t.getVideoTracks()[0]&&t.getVideoTracks()[0].label,d=t.getAudioTracks()[0]&&t.getAudioTracks()[0].label,u=t.getVideoTracks()[0]&&t.getVideoTracks()[0].getSettings().deviceId,h=t.getAudioTracks()[0]&&t.getAudioTracks()[0].getSettings().deviceId;return this.publisherList[e]={seq:0,localStream:t,publisher:a,serverUrls:[],streamID:e,publishOption:r,cameraLabel:c||"",microLabel:d||"",cameraDeviceId:u||"",microDeviceId:h||"",deviceStateCount:0,streamTryHandler:new v.TryStreamHandler(this.logger,this.stateCenter)},this.dataReport.eventStart(a.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(a.streamReportSeq,"GetSignalUrl"),!0},t.prototype.startPublishingStream=function(e,t){this.logger.info("zsc.sps.0 call");var r=this.publisherList[e];if(!r)return this.logger.error("zsc.sps.0 publisher don't exist"),!1;var i=r.publisher;if(this.dataReport.eventEndWithMsg(i.reportSeq,"GetSignalUrl",{urls:t}),this.dataReport.eventEndWithMsg(i.streamReportSeq,"GetSignalUrl",{urls:t}),!t||0===t.length)return this.publishStateHandle(d.ENUM_PUBLISH_STATE_UPDATE.error,e,c.publishErrorList.DISPATCH_ERROR),this.logger.info("zsc.sps.0 server don't have signal url"),!1;r.serverUrls=n(r.serverUrls,t);var o=t.indexOf(this.server);-1!==o&&(r.serverUrls.splice(o,1),r.serverUrls.unshift(this.server));var a=r.streamTryHandler;return a.invalid(),a.init(this.stateCenter.streamRetryTime),a.initStream(this,!0,e,t),a.active(0)},t.prototype.updateWaitingList=function(e,t,r,i,o){t?e.publishWaitingList.push({streamID:r,success:i,error:o}):e.playWaitingList.push({streamID:r,success:i,error:o})},t.prototype.publishStream=function(e){var t=this.publisherList[e].publisher;if(t){var r=null,i=null,o=this.publisherList[e].publishOption,n=this.checkPreview(this.publisherList[e].localStream);n?(r=n.localStream,i=n.videoInfo,r?(this.logger.info("zsc.ps.0 call success"),t.startPublish(e,r,i,n.mediaStreamConfig,o)):this.logger.error("zsc.ps.0 no localStream found")):this.logger.error("zsc.ps.0 no preview found")}else this.logger.info("zsc.ps.0 publisher don't exist")},t.prototype.connectPublishServer=function(e,t){var r=this,i=this.publisherList[e];return i?(this.dataReport.eventStart(i.publisher.reportSeq,"ConnectServer"),this.dataReport.eventStart(i.publisher.streamReportSeq,"ConnectServer"),this.connetWithReuseSignalServer(e,!0,t,(function(e,t,i){var o=r.publisherList[e];if(o){var n=o.publisher;if(n){r.dataReport.eventEndWithMsg(n.reportSeq,"ConnectServer",{result:0,server:i}),r.dataReport.eventEndWithMsg(n.streamReportSeq,"ConnectServer",{result:0,server:i});var a=t.tokenInfo;r.logger.info("zsc.cps.0 update token success"),a&&a.report&&(n.qualityUpload=a.report,n.qualityUploadInterval=a.report_interval),n.signal=t.signal,r.server=i,r.publishStream(e),r.getTokenSuccess()}else r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")}),(function(e,t){r.logger.error("zsc.cps.0 "+e+" connect fail "+t);var i=r.publisherList[e];if(i){var o=i.publisher;o?(r.dataReport.eventEndWithMsg(o.reportSeq,"ConnectServer",{result:t}),r.dataReport.uploadReport(o.reportSeq),delete r.stateCenter.reportSeqList.startPublish[e],r.publishStateHandle(d.ENUM_PUBLISH_STATE_UPDATE.error,e,c.publishErrorList.CONNECT_FAILED)):r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")})),!0):(this.logger.error("zsc.cps.0 publisher don't exist"),!1)},t.prototype.getTokenSuccess=function(){this.logger.debug("zsc.gts.0 call")},t.prototype.stopPublishingStream=function(e){var t=this.publisherList[e];if(t){var r=t.streamTryHandler;for(var i in r&&(r.stopMaxTime(),r.invalid()),this.signalList)this.signalList[i].publishWaitingList=this.signalList[i].publishWaitingList.filter((function(t){return t.streamID!==e}));delete this.publisherList[e],t.publisher&&(t.publisher.stopPublish(),delete t.publisher),this.removeStreamFromSignal(!0,e),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),this.logger.debug("zsc.sps.0.1 call success")}else this.logger.warn("zsc.sps.0.1 publisher don't exist")},t.prototype.setStreamAudioOutput=function(e,t){var r=this;return!(null==t||0==t.length||!e||(this.logger.debug("zsc.ssao.0 device "+t),e?"undefined"!==e.sinkId?(e.setSinkId(t).then((function(){r.logger.info("zsc.ssao.0 success device: "+t)})).catch((function(e){r.logger.info("zsc.ssao.0 "+e.name)})),0):(this.logger.error("zsc.ssao.0 browser does not suppport"),1):(this.logger.error("zsc.ssao.0 no localVideo"),1)))},t.prototype.connetWithReuseSignalServer=function(e,t,r,i,o){var n=this;this.logger.info("zsc.crss.0 begin "+r);var a=null;if(this.signalList[r])(a=this.signalList[r]).state==l.ENUM_SIGNAL_STATE.connected?(this.logger.info("zsc.crss.0 already connected "+r+" streamId: "+e),t?a.publishConnectedList.push(e):a.playConnectedList.push(e),i(e,a,r)):a.state==l.ENUM_SIGNAL_STATE.connecting&&(this.logger.debug("zsc.crss.0 signal is connecting "+r+" streamId: "+e),this.updateWaitingList(a,t,e,i,o));else{this.logger.info("zsc.crss.0 new signal "+r+" streamId: "+e);var s=new u.ZegoSignal(this.logger,this.stateCenter);s.setSessionInfo(this.appid,this.userid),s.onUpdateHeartBeartInterval=this.onUpdateHeartBeartIntervalHandle.bind(this),s.onDisconnect=this.onDisconnectHandle,this.signalList[r]={signal:s,state:l.ENUM_SIGNAL_STATE.connecting,publishWaitingList:[],playWaitingList:[],publishConnectedList:[],playConnectedList:[],tokenInfo:null},this.updateWaitingList(this.signalList[r],t,e,i,o),s.connectServer(this.token,r,(function(e,t,i){a=n.signalList[r];var o,s,c=0;if(0!=e){for(n.logger.debug("zsc.crss.0 connect failed "+t),c=0;c<a.publishWaitingList.length;c++)(o=a.publishWaitingList[c]).error&&o.error(o.streamID,e);for(c=0;c<a.playWaitingList.length;c++)(s=a.playWaitingList[c]).error&&s.error(s.streamID,e);delete n.signalList[r]}else{for(n.logger.debug("zsc.crss.0 connected success "+t),a.state=l.ENUM_SIGNAL_STATE.connected,a.tokenInfo=i,c=0;c<a.publishWaitingList.length;c++)(o=a.publishWaitingList[c]).success&&o.success(o.streamID,a,t),a.publishConnectedList.push(o.streamID);for(c=0;c<a.playWaitingList.length;c++)(s=a.playWaitingList[c]).success&&s.success(s.streamID,a,t),a.playConnectedList.push(s.streamID);a.publishWaitingList=[],a.playWaitingList=[],null==n.heartbeatTimer&&n.startSignalHeartbeat(),null==n.chargeInfosTimer&&n.startChargeInfosUpload(),null==n.soundLevelTimer&&n.soundLevelDelegate&&n.startSoundLevel()}}))}},t.prototype.setPlayStateStart=function(e,t){var r=this,i=this.playerList[e],o=this.stateCenter.reportSeqList.startPlay[e];if(this.dataReport.eventStart(o,"setPlayState"),i)return this.logger.error("zsc.pss.1 player already exist"),this.dataReport.eventEndWithMsgInfo(o,"setPlayState",{message:"player already exist"}),this.dataReport.uploadReport(o,void 0,f.errorList.kIsPlaying),delete this.stateCenter.reportSeqList.startPlay[e],!1;var n=new h.ZegoPlayWeb(this.logger,null,this.dataReport,this.qualityTimerInterval,this,this.ac,this.stateCenter);return n.state=l.ENUM_PLAY_STATE.start,n.reportSeq=this.stateCenter.reportSeqList.startPlay[e],this.playerList[e]={seq:0,player:n,signal:null,serverUrls:[],streamID:e,playOption:t,streamTryHandler:new v.TryStreamHandler(this.logger,this.stateCenter)},n.onPlayStateUpdate=function(e,t,i,o){var n=r.playerList[t];n?r.playStateHandle(e,n.streamID,i,o):r.logger.error("zsc.pss.1 cannot find play "+t)},n.onPlayQualityUpdate=function(e,t){var i=r.playerList[e];i?r.onPlayQualityUpdate(i.streamID,t):r.logger.error("zsc.pss.1 cannot find play "+e)},n.onRemoteCameraStatusUpdate=function(e,t){var i=r.playerList[e];i?r.onRemoteCameraStatusUpdate(i.streamID,t):r.logger.error("zsc.pss.1 cannot find play "+e)},n.onRemoteMicStatusUpdate=function(e,t){var i=r.playerList[e];i?r.onRemoteMicStatusUpdate(i.streamID,t):r.logger.error("zsc.pss.1 cannot find play "+e)},this.dataReport.eventStart(n.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(n.streamReportSeq,"GetSignalUrl"),!0},t.prototype.startPlayingStream=function(e,t,r){this.logger.info("zsc.sps.1 start play called");var i=this.playerList[e];if(!i)return this.logger.error("zsc.sps.1 player don't exist"),!1;var o=i.player;if(this.dataReport.eventEndWithMsg(o.reportSeq,"GetSignalUrl",{urls:t}),this.dataReport.eventEndWithMsg(o.streamReportSeq,"GetSignalUrl",{urls:t}),0==t.length)return this.playStateHandle(d.ENUM_PLAY_STATE_UPDATE.error,e,c.playErrorList.DISPATCH_ERROR),this.logger.info("zsc.sps.1 server don't have signal url"),!1;i.serverUrls=n(i.serverUrls,t);var a=t.indexOf(this.server);-1!==a&&(i.serverUrls.splice(a,1),i.serverUrls.unshift(this.server));var s=i.streamTryHandler;return s.invalid(),s.init(this.stateCenter.streamRetryTime),s.initStream(this,!1,e,t),s.active(0,r)},t.prototype.connectPlayServer=function(e,t,r){var i=this,o=this.playerList[e];return o?(this.dataReport.eventStart(o.player.reportSeq,"ConnectServer"),this.dataReport.eventStart(o.player.streamReportSeq,"ConnectServer"),this.connetWithReuseSignalServer(e,!1,r,(function(e,r,o){var n=i.playerList[e];if(n){var a=n.player;if(a){i.dataReport.eventEndWithMsg(a.reportSeq,"ConnectServer",{result:0,server:o}),i.dataReport.eventEndWithMsg(a.streamReportSeq,"ConnectServer",{result:0,server:o});var s=r.tokenInfo;i.logger.info("zsc.cps.1 update token success"),s&&s.report&&(a.qualityUpload=s.report,a.qualityUploadInterval=s.report_interval),a.signal=r.signal,i.server=o,i.playStream(e,t),i.getTokenSuccess()}else i.logger.error("zsc.cps.1 checkplayer don't exist")}else i.logger.error("zsc.cps.1 after connect player don't exist")}),(function(t,r){var o=i.playerList[t];o?(i.dataReport.eventEndWithMsg(o.player.reportSeq,"ConnectServer",{result:r}),i.dataReport.uploadReport(o.player.reportSeq),delete i.stateCenter.reportSeqList.startPlay[e],i.playStateHandle(d.ENUM_PLAY_STATE_UPDATE.error,t,c.playErrorList.CONNECT_FAILED)):i.logger.error("zsc.cps.1 after connect player don't exist")})),!0):(this.logger.error("zsc.cps.1 player don't exist"),!1)},t.prototype.playStream=function(e,t){var r=this.playerList[e].player;r?(this.logger.info("zsc.ps.1 call success"),r.startPlay(e,t,this.playerList[e].playOption)):this.logger.warn("zsc.ps.1 player don't exist")},t.prototype.removeStreamFromSignal=function(e,t){var r=[];for(var i in this.signalList){var o=this.signalList[i];if(e){for(var n=0;n<o.publishConnectedList.length;n++)if(o.publishConnectedList[n]===t){this.logger.debug("zsc.rsfs.0 found from publish"),o.publishConnectedList.splice(n,1);break}for(n=0;n<o.publishWaitingList.length;n++)if(o.publishWaitingList[n].streamID===t){this.logger.debug("zsc.rsfs.0 found from publish"),o.publishWaitingList.splice(n,1);break}}else{for(var a=0;a<o.playConnectedList.length;a++)if(o.playConnectedList[a]===t){this.logger.debug("zsc.rsfs.0 found from play"),o.playConnectedList.splice(a,1);break}for(a=0;a<o.playWaitingList.length;a++)if(o.playWaitingList[a].streamID===t){this.logger.debug("zsc.rsfs.0 found from play"),o.playWaitingList.splice(a,1);break}}0==o.publishConnectedList.length&&0==o.playConnectedList.length&&0==o.publishWaitingList.length&&0==o.playWaitingList.length&&(o.signal.disconnectServer(),r.push(i))}for(var s=0;s<r.length;s++)delete this.signalList[r[s]]},t.prototype.stopSignalHeartbeat=function(){this.logger.debug("zsc.ssh.1 call");var e=0;for(var t in this.signalList)e+=1;this.heartbeatTimer&&0==e&&(this.logger.info("zsc.ssh.1 stop"),clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},t.prototype.publishStateHandle=function(e,t,r,i){this.logger.info("zsc.psh.0 call "+t);var o=this.publisherList[t].streamTryHandler,n=i||o.RETRY_MAX_TIME<3;if(r&&0!==r.code){!o.maxTimer&&!n&&o.startMaxTime();var a=this.publisherList[t].publisher;if(this.stateCenter.publishStreamList[t].state=l.ENUM_PUBLISH_STREAM_STATE.tryPublish,r.code===c.publishErrorList.SESSION_CLOSED.code||a.stateNego!=l.ENUM_PUBLISH_STATE_NEGO.iceConnected||i){var s=a.streamId,u=a.localStream,h=a.videoInfo,p=a.mediaStreamConfig,f=a.publishOption;if(a.resetPublish(),0!=a.sessionId&&a.signal&&a.shouldSendCloseSession(r)&&(a.signal.sendCloseSession(d.getSeq(),a.sessionId,1),a.signal.removeSession(a.sessionId),a.closeSessionSignal=!0),!n&&!o.retryNextSignal(r))return void a.startPublish(s,u,h,p,f)}else this.logger.info("zsc.psh.0 ice is connected");this.removeStreamFromSignal(!0,t)}if(n)return o.stopMaxTime(),o.invalid(),void this.onPublishStateUpdate(e,t,r);r&&o.active(void 0)&&this.onPublishStateUpdate(2,t,r),this.logger.info("zsc.psh.0 end "+t)},t.prototype.playStateHandle=function(e,t,r,i){this.logger.info("zsc.psh.1 call "+t);var o=this.playerList[t].streamTryHandler,n=i||o.RETRY_MAX_TIME<3;if(r&&0!==r.code){!o.maxTimer&&!n&&o.startMaxTime();var a=this.playerList[t].player;if(r.code===c.playErrorList.SESSION_CLOSED.code||a.stateNego!=l.ENUM_PUBLISH_STATE_NEGO.iceConnected||i){var s=a.streamId,u=a.playOption;if(a.resetPlay(),0!=a.sessionId&&a.signal&&a.shouldSendCloseSession(r)&&(a.signal.sendCloseSession(d.getSeq(),a.sessionId,1),a.signal.removeSession(a.sessionId),a.closeSessionSignal=!0),!n&&!o.retryNextSignal(r))return void a.startPlay(s,a.getRomoteStreamSuc,u)}else this.logger.info("zsc.psh.1 ice is connected");this.removeStreamFromSignal(!0,t)}if(n)return o.stopMaxTime(),o.invalid(),void this.onPlayStateUpdate(e,t,r);r&&o.active(void 0)&&this.onPlayStateUpdate(2,t,r),this.logger.info("zsc.psh.1 end "+t)},t.prototype.stopPlayingStream=function(e){var t=this.playerList[e];if(t){var r=t.streamTryHandler;for(var i in r&&(r.stopMaxTime(),r.invalid()),this.signalList)this.signalList[i].playWaitingList=this.signalList[i].playWaitingList.filter((function(t){return t.streamID!==e}));delete this.playerList[e],t.player&&(t.player.stopPlay(),delete t.player),this.removeStreamFromSignal(!1,e),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),delete this.playSuccessCallBackList[e],this.logger.debug("zsc.sps.1.1 call success")}else this.logger.info("zsc.sps.1.1 player don't exist")},t.prototype.reset=function(){for(var e in this.publisherList)(r=this.publisherList[e].streamTryHandler)&&(r.stopMaxTime(),r.invalid()),this.publisherList[e].publisher&&this.publisherList[e].publisher.stopPublish();for(var t in this.playerList){var r;(r=this.playerList[t].streamTryHandler)&&(r.stopMaxTime(),r.invalid()),this.playerList[t].player&&this.playerList[t].player.stopPlay()}for(var i in this.signalList)this.signalList[i].signal&&this.signalList[i].signal.disconnectServer();this.playerList={},this.publisherList={},this.signalList={},this.server="",this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},t.prototype.replaceTrack=function(e,t,r,i){var o=this.checkPreview(e),n=this.checkPublish(e);if(/Safari/.test(navigator.userAgent)&&/Chrome/.test(navigator.userAgent),n){var a=n.publisher.localStream;if(!n.publisher.peerConnection.getSenders||!n.publisher.peerConnection.getSenders()[0].replaceTrack)return this.logger.error("zc.rt.0 replack track is not supported"),void(i&&i({code:m.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT.code,msg:m.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT.msg+" replack track is not supported"}));h=a.getTracks().find((function(e){return e.kind===t.kind}));var s=n.publisher.peerConnection.getSenders().find((function(e){return e.track.kind===t.kind}));if(h&&s){var c=0,l=0,u=t.enabled!==h.enabled;"video"===t.kind?(c=!0===t.enabled?0:2,l=a.getAudioTracks()[0]&&1==a.getAudioTracks()[0].enabled?0:2):"audio"===t.kind&&(l=!0===t.enabled?0:2,c=a.getVideoTracks()[0]&&1==a.getVideoTracks()[0].enabled?0:2),s.replaceTrack(t),a.removeTrack(h),a.addTrack(t),u&&n.publisher.signal&&n.publisher.signal.sendStreamStatus(d.getSeq(),n.publisher.sessionId,c,l,n.publisher.streamId),r&&r({code:0,msg:""})}else this.logger.error("zc.rt.0 publisher track no found"),i&&i({code:m.errorCodeList.TRACK_NOT_FOUND.code,msg:m.errorCodeList.TRACK_NOT_FOUND.msg})}else{if(!o)return this.logger.error("zc.rt.0 preview no found"),void(i&&i(m.errorCodeList.PUBLISH_NO_PREVIEW));var h,p=o.localStream;(h=p.getTracks().find((function(e){return e.kind===t.kind})))?(p.removeTrack(h),p.addTrack(t),r&&r({code:0,msg:""})):(this.logger.error("zc.rt.0 track no found"),i&&i({code:m.errorCodeList.TRACK_NOT_FOUND.code,msg:m.errorCodeList.TRACK_NOT_FOUND.msg}))}},t.prototype.startSignalHeartbeat=function(){var e=this;this.logger.debug("zsc.ssh.0 call"),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatTimer=setTimeout((function(){e.checkSignalHeartbeat()}),this.heartbeatInterval)},t.prototype.startChargeInfosUpload=function(){var e=this;this.logger.debug("zsc.sciu.0 call"),this.chargeInfosTimer&&(clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null),this.chargeInfosTimer=setTimeout((function(){e.checkChargeInfos()}),this.chargeInfosInterval)},t.prototype.checkChargeInfos=function(){this.logger.debug("zsc.cci.0 call");var e={is_publishing:0,play_max_audio_bitrate:0,play_stream_resolution_infos:[]};for(var t in this.chargeInfos.timestamp_begin=(new Date).getTime(),this.publisherList){this.publisherList[t].publisher.state===l.ENUM_PUBLISH_STATE.publishing&&(e.is_publishing=1);break}e.play_max_audio_bitrate=0;var r=function(t){var r=i.playerList[t].player.playStream,o=r&&0!==r.getVideoTracks().length?r.getVideoTracks()[0].getSettings():void 0,n={video_width:o&&o.width?o.width:0,video_height:o&&o.height?o.height:0,count:1};if(!e.play_stream_resolution_infos.find((function(e){return e.video_width==n.video_width&&e.video_height==n.video_height&&(e.count++,!0)}))&&e.play_stream_resolution_infos.push(n),0==n.video_width&&0==n.video_height){var a=1e3*i.playerList[t].player.lastPlayStats.audioBitrate;a>e.play_max_audio_bitrate&&(e.play_max_audio_bitrate=a)}},i=this;for(var o in this.playerList)r(o);0!==this.chargeInfos.timestamp_end?(this.chargeInfos.timestamp_diff=this.chargeInfos.timestamp_begin-this.chargeInfos.timestamp_end,this.chargeInfos.timestamp_diff_flag=1):(this.chargeInfos.timestamp_diff=0,this.chargeInfos.timestamp_diff_flag=0),this.chargeInfos.timestamp_end=(new Date).getTime(),this.chargeInfos.infos=[e],0!==e.play_stream_resolution_infos.length&&this.logger.report(this.chargeInfos),this.chargeInfosTimer&&this.startChargeInfosUpload()},t.prototype.checkSignalHeartbeat=function(){for(var e in this.logger.debug("zsc.csh.0 call"),this.signalList)this.signalList[e].signal&&this.signalList[e].signal.sendHeartbeat();this.heartbeatTimer&&this.startSignalHeartbeat()},t.prototype.stopChargeInfosUpload=function(){this.logger.debug("zsc.sciu.0 call");var e=0;for(var t in this.signalList)e+=1;this.chargeInfosTimer&&0==e&&(this.logger.info("zsc.sciu.0 stop"),clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null)},t.prototype.getPublisher=function(e){var t=null;return this.publisherList[e]&&this.publisherList[e].publisher&&(t=this.publisherList[e].publisher),t},t.prototype.checkPreview=function(e){for(var t=0;t<this.previewVideoList.length;t++)if(this.previewVideoList[t].localStream===e)return this.previewVideoList[t];return null},t.prototype.checkPublish=function(e){for(var t in this.publisherList)if(this.publisherList[t].localStream==e)return this.publisherList[t];return null},t.prototype.removePreview=function(e){for(var t=0;t<this.previewVideoList.length;t++)if(this.previewVideoList[t]===e){this.previewVideoList.splice(t,1);break}},t.prototype.onPlayerStreamUrlUpdate=function(e,t,r){},t.prototype.getScreenConstrains=function(e){var t={};if("boolean"==typeof e&&e)t={audio:!1,frameRate:15,bitRate:1500};else if("object"==typeof e){switch(e.videoQuality){case 1:t={frameRate:l.ENUM_SCREEM_RESOLUTION_TYPE.LOW.frameRate,bitRate:l.ENUM_SCREEM_RESOLUTION_TYPE.LOW.bitRate};break;case 2:t={frameRate:l.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:l.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate};break;case 3:t={frameRate:l.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.frameRate,bitRate:l.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.bitRate};break;case 4:t={frameRate:e.frameRate,bitRate:e.bitRate,width:e.width,height:e.height}}t.audio="boolean"==typeof e.audio&&e.audio}return t},t.prototype.createScreenPreviewer=function(e,t){var r=new a.ZegoPreview(this.logger),i=e.getVideoTracks()[0].getSettings();return this.previewVideoList.push(r),r.mediaStreamConfig=t,e.getAudioTracks().length>0&&(r.micTrack=e.getAudioTracks()[0]),r.localStream=e,r.videoInfo={width:i.width,height:i.height,frameRate:i.frameRate||0,bitRate:t.bitRate||0},r.previewSuc=!0,r},t.prototype.switchDevice=function(e,t,r,i,o){var n=this,a=this.checkPreview(t);if(!a)return this.logger.error("zsc.sd.0 preview no found"),void(o&&o(m.errorCodeList.PUBLISH_NO_PREVIEW));var s=null;for(var c in this.publisherList)this.publisherList[c].localStream==t&&(s=this.publisherList[c]);if("video"===e&&0==a.mediaStreamConfig.video)return this.logger.error("zsc.sd.0 camera can not be changed when video is false"),void(o&&o(m.errorCodeList.VIDEO_DEVICE_FALSE));if("audio"===e&&0==a.mediaStreamConfig.audio)return this.logger.error("zsc.sd.0 microphone can not be changed when audio is false"),void(o&&o(m.errorCodeList.AUDIO_DEVICE_FALSE));a.mediaStreamConfig.videoInput!==r&&delete a.mediaStreamConfig.facingMode;var d,l={};"video"===e?(l.videoInput=r,d=t.getVideoTracks()[0]):(l.audioInput=r,d=t.getAudioTracks()[0]);var u=g.ClientUtil.getBrowser();this.logger.info("zsc.sd.0 browser "+u),"Firefox"===u&&d.stop();var h=Object.assign(a.mediaStreamConfig,l),p=a.getMediaStreamConstraints(h),f=t.clone();navigator.mediaDevices.getUserMedia(p).then((function(r){r.getTracks().forEach((function(e){var r=t.getTracks().find((function(t){return t.kind===e.kind}));if(e.enabled=r.enabled,s){var i=s.publisher.peerConnection.getSenders().find((function(t){return null!==t.track&&t.track.kind===e.kind}));i?i.replaceTrack(e):n.logger.warn("zsc.sd.0 no sender found, only swithcing device on localMediaElement")}t.removeTrack(r),t.addTrack(e)})),f.getTracks().forEach((function(e){return e.stop()})),n.logger.info("zsc.sd.0 swtich "+e+" device success"),i&&i()}),(function(r){n.logger.error("zsc.sd.0 swtich "+e+"device fail ",r.name,JSON.stringify(r)),"Firefox"===u&&f.getTracks().forEach((function(e){var r=t.getTracks().find((function(t){return t.kind===e.kind}));s.publisher.peerConnection.getSenders().find((function(t){return null!==t.track&&t.track.kind===e.kind})).replaceTrack(e),t.removeTrack(r),t.addTrack(e)})),o&&o(r)}))},t.prototype.setPublishStreamConstraints=function(e,t,r,i){var o=this,n=(/Safari/.test(navigator.userAgent)&&/Chrome/.test(navigator.userAgent),null);for(var a in this.logger.info("zsc.spsc.0 constraints",JSON.stringify(t)),this.publisherList)this.publisherList[a].localStream==e&&(n=this.publisherList[a]);if(!n)return this.logger.error("zsc.spsc.0 publisher not found"),void(i&&i(m.errorCodeList.PUBLISH_NOT_PUBLISH));this.logger.info("zsc.spsc.0 streamId ",n.streamID);var s=this.checkPreview(e);if(!s)return this.logger.error("zsc.spsc.0 preview no found"),void(i&&i(m.errorCodeList.PUBLISH_NO_PREVIEW));var c=!1,d=!1;(t.width||t.height||t.frameRate)&&(s.mediaStreamConfig.videoQuality=4,c=!0),void 0===t.ANS&&void 0===t.AGC&&void 0===t.AEC||(d=!0);var l=s.localStream,u=l.getVideoTracks()[0],h=l.getAudioTracks()[0];c&&!u&&(this.logger.error("zsc.spsc.0 video track not found"),i&&i(m.errorCodeList.TRACK_NOT_FOUND)),d&&!h&&(this.logger.error("zsc.spsc.0 audio track not found"),i&&i(m.errorCodeList.TRACK_NOT_FOUND));var p=JSON.parse(JSON.stringify(s.mediaStreamConfig)),f=Object.assign(s.mediaStreamConfig,t),g=s.getMediaStreamConstraints(f,!0);this.logger.info("zsc.spsc.0 applyConstraints ",JSON.stringify(g));var v=[];if(c&&v.push(u.applyConstraints(g.video)),d&&(h.stop(),v.push(navigator.mediaDevices.getUserMedia({video:!1,audio:g.audio}))),t.maxBitrate){var y=n.publisher.peerConnection.getSenders().find((function(e){return e.track&&"video"===e.track.kind})),S=y.getParameters();S.encodings||(S.encodings=[{}]),S.encodings[0].maxBitrate=1e3*t.maxBitrate,v.push(y.setParameters(S))}if(v.length>0)Promise.all(v).then((function(e){if(o.logger.info("zsc.spsc.0 set constraints success",e[1]),d){var t=(c?e[1]:e[0]).getAudioTracks()[0];if(n.publisher.peerConnection.getSenders().find((function(e){return"audio"===e.track.kind})).replaceTrack(t),l){var i=l.getAudioTracks()[0];l.removeTrack(i),l.addTrack(t)}}r&&r()})).catch((function(e){o.logger.error("zsc.spsc.0 fail reason ",e.name,JSON.stringify(e)),i&&i({code:m.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,msg:e.name+" "+(e.constraint?"constraint:"+e.constraint:"")})}));else{if(this.logger.warn("zsc.spsc.0 constaints is no changes"),d){var b=s.getMediaStreamConstraints(p);this.logger.info("zsc.spsc.0 oldMediaStreamConstraints ",JSON.stringify(b)),navigator.mediaDevices.getUserMedia({video:!1,audio:b.audio}).then((function(e){e.getTracks().forEach((function(e){var t=l.getTracks().find((function(t){return t.kind===e.kind}));n.publisher.peerConnection.getSenders().find((function(t){return null!==t.track&&t.track.kind===e.kind})).replaceTrack(e),t&&l.removeTrack(t),l.addTrack(e)})),o.logger.info("zsc.spsc.0.1 setbackup suc ")})).catch((function(e){o.logger.error("zsc.spsc.0.1 setbackup fail "+e.name)}))}i&&i({code:m.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,msg:"constaints is no changes"})}},t.prototype.preloadEffect=function(e,t,r,i){var o=this,n=new XMLHttpRequest;n.open("GET",r,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||304==n.status){var r=n.response;e.decodeAudioData(r,(function(e){o.logger.info("zc.pe.0 effect preload success"),o.stateCenter.audioEffectBuffer[t]=e,i&&i()}),(function(e){o.logger.error("zc.pe.0 effect preload fail "+e),i&&i(e)}))}else{var a=n.statusText;o.logger.error("zc.pe.0 effect preload fail "+a),i&&i(a)}},n.send()},t.prototype.playEffect=function(e,t,r){var i=this.stateCenter.audioEffectBuffer[e.effectID],o=this.getPublisher(e.streamID);o?i?o.playEffect(e,i,t,r):this.logger.error("zc.pe.1 no audio buffer found"):this.logger.error("zc.pe.1 publisher doesn't exist")},t.prototype.pauseEffect=function(e,t){var r=this.getPublisher(e);return r?r.pauseEffect(t):(this.logger.error("zc.pe.2 publisher doesn't exist"),!1)},t.prototype.resumeEffect=function(e,t){var r=this.getPublisher(e);return r?r.resumeEffect(t):(this.logger.error("zc.re.0 publisher doesn't exist"),!1)},t.prototype.stopEffect=function(e,t){var r=this.getPublisher(e);return r?r.stopEffect(t):(this.logger.error("zc.re.0 publisher doesn't exist"),!1)},t.prototype.setMixingAudioVolume=function(e,t,r){var i=this.getPublisher(e);return i?i.setMixingAudioVolume(t/100,r):(this.logger.error("zc.sma.2 publisher doesn't exist"),!1)},t.prototype.startMixingAudio=function(e,t){var r=this.getPublisher(e);return r?r.startMixingAudio(t):(this.logger.error("zc.sma.0 publisher doesn't exist"),!1)},t.prototype.stopMixingAudio=function(e,t){var r=this.getPublisher(e);return r?r.stopMixingAudio(t):(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},t.prototype.mixingBuffer=function(e,t,r,i){var o=this.getPublisher(e);o?r instanceof ArrayBuffer?o.mixingBuffer(t,r,i):this.logger.error("zc.mb.0 array buffer not found"):this.logger.error("zc.mb.0 publisher doesn't exist")},t.prototype.stopMixingBuffer=function(e,t){var r=this.getPublisher(e);return r?r.stopMixingBuffer(t):(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},t.prototype.setSoundLevelDelegate=function(e,t){for(var r in this.logger.info("zsc.ssd.0 call"),t&&(this.soundLevelInterval=t),this.soundLevelDelegate=e,this.publisherList){var i=this.publisherList[r].publisher;e?i.startSoundLevel():i.stopSoundLevel()}for(var r in this.playerList){var o=this.playerList[r].player;e?o.startSoundLevel():o.stopSoundLevel()}if(e){this.logger.info("zsc.ssd.0 start getting sound");var n=0;for(var a in this.signalList)n+=1;null==this.soundLevelTimer&&n>0&&this.startSoundLevel()}else this.logger.info("zsc.ssd.0 stop getting sound"),this.soundLevelTimer&&clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null,this.soundLevelInterval=1e3},t.prototype.startSoundLevel=function(){var e=this;this.logger.debug("zsc.ssl.0 call"),this.soundLevelTimer&&(clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null),this.soundLevelTimer=setTimeout((function(){e.checkSoundLevel()}),this.soundLevelInterval)},t.prototype.checkSoundLevel=function(){this.logger.debug("zsc.csl.0 call");var e=[];for(var t in this.publisherList){var r=this.publisherList[t].publisher;e.push({streamID:this.getBackStreamId(r.streamId),soundLevel:r.soundLevel,type:"push"})}for(var t in this.playerList){var i=this.playerList[t].player;e.push({streamID:this.getBackStreamId(i.streamId),soundLevel:i.soundLevel,type:"pull"})}this.soundLevelDelegate&&e.length>0&&this.onSoundLevelUpdate(e),this.soundLevelDelegate&&this.startSoundLevel()},t.prototype.getBackStreamId=function(e){return this.testEnvironment&&e?e.replace("zegotest-"+this.appid+"-",""):e},t.prototype.onSoundLevelUpdate=function(e){},t.prototype.stopSoundLevel=function(){var e=0;for(var t in this.signalList)e+=1;this.soundLevelTimer&&0==e&&(this.logger.info("zsc.ssl.0 stop"),clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null,this.soundLevelInterval=1e3)},t}(p.ZegoStreamCenter);t.ZegoStreamCenterWeb=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(3),n=r(2),a=function(){function e(e){var t=this;this.log=e,this.localStream=null,this.videoInfo={},this.previewSuc=!1,this.micTrack=null,this.enableMicrophone=function(e,r){if(!t.localStream)return t.logger.error("zp.em.2 no localStream"),!1;for(var i in t.localStream.getAudioTracks().forEach((function(t){t.enabled=e})),r.publisherList){var o=r.publisherList[i].publisher;o.localStream==t.localStream&&o.signal.sendStreamStatus(n.getSeq(),o.sessionId,t.localStream.getVideoTracks()[0]&&!0===t.localStream.getVideoTracks()[0].enabled?0:2,e?0:2,o.streamId)}return t.logger.debug("zp.em.2 call success"),!0},this.enableCamera=function(e,r){if(!t.localStream)return t.logger.error("zp.ec.2 no localStream"),!1;for(var i in t.localStream.getVideoTracks().forEach((function(t){t.enabled=e})),r.publisherList){var o=r.publisherList[i].publisher;o.localStream==t.localStream&&o.signal.sendStreamStatus(n.getSeq(),o.sessionId,e?0:2,t.localStream.getAudioTracks()[0]&&1==t.localStream.getAudioTracks()[0].enabled?0:2,o.streamId)}return t.logger.debug("zp.ec.2 call success"),!0},this.logger=e}return e.prototype.getMediaStreamConstraints=function(e,t){var r={audio:null,video:null};if(r.audio=!0,r.video={width:640,height:480,frameRate:15,bitRate:800},e.audio?void 0===e.audioInput&&void 0===e.ANS&&void 0===e.AGC&&void 0===e.AEC&&void 0===e.channelCount?(r.audio={},r.audio.noiseSuppression=!0,r.audio.autoGainControl=!0,r.audio.echoCancellation=!0,r.audio.channelCount=1):(r.audio={},void 0!==e.audioInput&&null!==e.audioInput&&(r.audio.deviceId=e.audioInput),void 0!==e.ANS&&(r.audio.noiseSuppression=e.ANS),void 0!==e.AGC&&(r.audio.autoGainControl=e.AGC),void 0!==e.AEC&&(r.audio.echoCancellation=e.AEC),void 0!==e.channelCount&&(r.audio.channelCount=e.channelCount)):!1===e.audio&&(r.audio=!1),e.video){var o=640,n=480,a=15,s=800;if(1===e.videoQuality?(o=i.ENUM_RESOLUTION_TYPE.LOW.width,n=i.ENUM_RESOLUTION_TYPE.LOW.height,a=i.ENUM_RESOLUTION_TYPE.LOW.frameRate,s=i.ENUM_RESOLUTION_TYPE.LOW.bitRate):2===e.videoQuality?(o=i.ENUM_RESOLUTION_TYPE.MEDIUM.width,n=i.ENUM_RESOLUTION_TYPE.MEDIUM.height,a=i.ENUM_RESOLUTION_TYPE.MEDIUM.frameRate,s=i.ENUM_RESOLUTION_TYPE.MEDIUM.bitRate):3===e.videoQuality?(o=i.ENUM_RESOLUTION_TYPE.HIGH.width,n=i.ENUM_RESOLUTION_TYPE.HIGH.height,a=i.ENUM_RESOLUTION_TYPE.HIGH.frameRate,s=i.ENUM_RESOLUTION_TYPE.HIGH.bitRate):4===e.videoQuality?(o=e.width,n=e.height,a=e.frameRate,s=e.bitRate||800):this.logger.info("zp.gmsc.2 use default"),t&&(e.width&&(o=e.width),e.height&&(n=e.height),e.frameRate&&(a=e.frameRate),e.bitRate&&(s=e.bitRate)),!1===e.horizontal){var c=n;n=o,o=c}r.video={width:o,height:n,frameRate:a,bitRate:s},null!=e.facingMode?r.video.facingMode=e.facingMode:null!=e.videoInput&&null!=e.videoInput&&(r.video.deviceId={exact:e.videoInput}),this.logger.info("zp.gmsc.2 width: "+o+" height: "+n+" rate: "+a)}else!1===e.video&&(r.video=!1);return r},e.prototype.startPreview=function(e,t,r){var i=this;if(this.logger.debug("zp.sv.2 called"),this.mediaStreamConfig=e,void 0!==navigator.mediaDevices&&null!=navigator.mediaDevices.getUserMedia){if(e.source instanceof MediaStream){var n=e.source.getVideoTracks(),a=n.length>0?n[0].getSettings():{width:0,height:0,frameRate:0};return this.logger.debug("zp.sv.2 use external media stream"),this.previewSuc=!0,this.localStream=e.source,e.source.getAudioTracks().length>0&&(this.micTrack=e.source.getAudioTracks()[0]),this.videoInfo={width:a.width,height:a.height,frameRate:a.frameRate,bitRate:e.bitRate||0},void(t&&t(this.localStream))}if(e.source instanceof HTMLMediaElement){var s=this.captureStream(e.source);s?(this.videoInfo.bitRate=e.bitRate||0,this.previewSuc=!0,s.getAudioTracks().length>0&&(this.micTrack=s.getAudioTracks()[0]),t&&t(s)):r&&r(o.publishErrorList.BROWSER_NOT_SUPPORT)}else{var c=this.getMediaStreamConstraints(e);this.videoInfo=c.video,this.mediaStreamConfig.video=!!c.video,this.mediaStreamConfig.audio=!!c.audio,this.logger.info("zp.sv.2 ",JSON.stringify(c)),navigator.mediaDevices.getUserMedia(c).then((function(e){i.logger.info("zp.sv.2 success"),i.localStream=e,i.previewSuc=!0,e.getAudioTracks().length>0&&(i.micTrack=e.getAudioTracks()[0]),t&&t(e)}),(function(e){i.logger.info("zp.sv.2 failed ",e.name," ",e.message),r&&r(e)}))}}else r&&r(o.publishErrorList.BROWSER_NOT_SUPPORT)},e.prototype.captureStream=function(e){if(!e)return this.logger.info("zp.cs.2 no local video"),null;var t;if(e.captureStream)t=e.captureStream(),this.logger.debug("zp.cs.2 captureStream");else{if(!e.mozCaptureStream)return this.logger.info("zp.cs.2 don't support"),null;t=e.mozCaptureStream(),this.logger.debug("zp.cs.2 mozCaptureStream")}return 0==t.getTracks().length?(this.logger.error("zp.cs.2 external capture tracks no found"),null):(this.localStream=t,this.videoInfo={width:e.videoWidth,height:e.videoHeight,frameRate:0,bitRate:0},this.logger.debug("zp.cs.2 called success"),this.localStream)},e.prototype.stopPreview=function(){if(this.logger.info("zp.sv.2.1 called"),this.localStream){var e=this.localStream.getTracks();e.reverse(),e.forEach((function(e){e.stop()})),this.micTrack&&this.micTrack.stop(),this.localStream=null,this.videoInfo={}}},e}();t.ZegoPreview=a},function(e,t,r){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),n=r(2),a=r(3),s=i(r(15)),c=r(16),d=r(6),l=r(1),u=function(){function e(e,t,r,i,a,s,c,d){this.state=o.ENUM_PUBLISH_STATE.stop,this.sessionId=0,this.waitingICETimeInterval=5e3,this.waitingAnswerTimeInterval=5e3,this.candidateInfo=[],this.waitingICETimer=null,this.waitingAnswerTimer=null,this.qualityTimer=null,this.publishQualityList=[],this.maxQualityListCount=10,this.lastPublishStats={},this.reportSeq=n.getSeq(),this.streamReportSeq=n.getSeq(),this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.qualitySeq=0,this.maxRetryCount=3,this.waitingServerTimerInterval=3e3,this.waitingServerTimer=null,this.videoInfo={width:0,height:0,frameRate:0,bitRate:0},this.mediaStreamConfig=null,this.offerSeq=0,this.audioMixList=[],this.arrayBufferMap={},this.effectList=[],this.qualityCount=0,this.closeSessionSignal=!1,this.audioBitRate=48e3,this.channelCount=1,this.localSdpRevert=!1,this.videoCodec="H264",this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.stop,this.negoInterval=25e3,this.publishEvent=!1,this.soundLevel=0,this.script=null,this.mic=null,this.cameraState="on",this.microState="on",this.logger=e,this.signal=t,this.dataReport=r,this.qualityTimeInterval=i,this.ac=s,this.mediaEleSources=c,this.streamCenter=a,this.stateCenter=d,this.dataReport.newReport(this.streamReportSeq)}return e.prototype.publishStateUpdateError=function(e,t){this.logger.error("zp.psue.0 call ",this.streamId,JSON.stringify(e)),this.streamId&&this.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.error,this.streamId,e,t),this.logger.info("zp.psue.0 ended")},e.prototype.resetPublish=function(){this.logger.info("zp.rp.0 "+this.streamId+" call"),this.state=o.ENUM_PUBLISH_STATE.stop,this.publishEvent=!1,null==this.peerConnection&&null==this.peerConnection||(this.peerConnection.close(),this.peerConnection=null),null!=this.waitingAnswerTimer&&(clearTimeout(this.waitingAnswerTimer),this.waitingAnswerTimer=null),null!=this.waitingICETimer&&(clearTimeout(this.waitingICETimer),this.waitingICETimer=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.clearPublishQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId)),this.sessionSeq=0,this.offerSeq=0,this.candidateInfo=[],this.publishQualityList=[],this.qualityUploadLastTime=0,this.stopSoundLevel()},e.prototype.clearPublishQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPublishStats={},this.qualityCount=0},e.prototype.shouldSendCloseSession=function(e){return this.state!=o.ENUM_PUBLISH_STATE.stop&&this.state!=o.ENUM_PUBLISH_STATE.waitingSessionRsp},e.prototype.startPublish=function(e,t,r,i,s){var c=this;if(this.logger.info("zp.sp.0 "+e+" called"),this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),e)if(this.peerConnection&&this.stateNego==o.ENUM_PUBLISH_STATE_NEGO.iceConnected)this.logger.info("zp.sp.0 ice connected");else{this.streamId=e,this.localStream=t,this.mediaStreamConfig=i,this.channelCount=i.channelCount,this.publishOption=s||{},navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&i&&(i.externalCapture||i.externalMediaStream)&&(this.localStream.onaddtrack=function(){c.logger.info("zp.sp.0 "+c.streamId+" Track added");var e=c.localStream.getVideoTracks(),t=c.localStream.getAudioTracks();e.length>1?(c.peerConnection.getSenders().find((function(t){return t.track.kind===e[1].kind})).replaceTrack(e[1]),c.localStream.removeTrack(e[0])):t.length>1&&(c.peerConnection.getSenders().find((function(e){return e.track.kind===t[1].kind})).replaceTrack(t[1]),c.localStream.removeTrack(t[0]))}),r&&(this.videoInfo=r),s&&s.audioBitRate&&(this.audioBitRate=s.audioBitRate),s&&s.videoCodec&&(this.videoCodec=s.videoCodec),this.sessionSeq=n.getSeq(),this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession");var d=e;1==this.streamCenter.testEnvironment&&(d="zegotest-"+this.streamCenter.appid+"-"+e),this.signal.createSession(this.sessionSeq,0,0,d,s&&s.streamParams,(function(e,t,r){var i=r.turn_server,o=i.split("?")[0]&&i.split("?")[0].slice(5),n=c.streamCenter.server.split("?"),s=n[1]&&n[1].slice(2);c.dataReport.eventEndWithMsg(c.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+o+"/"+s+"/"+c.streamId}),c.dataReport.eventEndWithMsg(c.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+o+"/"+s+"/"+c.streamId}),c.logger.info("zp.sp.0 "+c.streamId+" sessionId:"+r.session_id),c.sessionSeq==e?0!==r.result?(c.logger.error("zp.sp.0 "+c.streamId+" create session failed "+r.result),c.publishStateUpdateError(a.publishErrorList.CREATE_SESSION_ERROR)):(c.sessionId=r.session_id,c.logger.info("zp.sp.0 "+c.streamId+" create session success "+c.sessionId),c.onCreatePublishSessionSuccess(r)):c.logger.error("zp.sp.0 "+c.streamId+" seq is not match.")}),(function(e,t){c.reportSeq,c.dataReport.eventEndWithMsg(c.reportSeq,"CreateSession",{error:e}),c.dataReport.eventEndWithMsg(c.streamReportSeq,"CreateSession",{error:e}),c.publishStateUpdateError(a.publishErrorList.SEND_SESSION_TIMEOUT)})),this.state=o.ENUM_PUBLISH_STATE.waitingSessionRsp,this.logger.info("zp.sp.0 "+this.streamId+" called success"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.start,this.negoTimer=setTimeout((function(){c.logger.error("zp.sp.0 waiting timeout"),c.publishStateUpdateError(a.publishErrorList.SERVER_NEGO_TIMEOUT)}),this.negoInterval)}else this.logger.error("zp.sp.0 "+e+" streamId is null")},e.prototype.onCreatePublishSessionSuccess=function(e){var t=this;this.logger.info("zp.ops.0 "+this.streamId+" called");var r=[];if(e.turn_server){var i=e.turn_server;this.stateCenter.turnOverTcpOnly&&(i=i.replace("udp","tcp")),this.logger.info("zp.ops.0 over tcp "+i),r.push(i)}e.stun_server&&r.push(e.stun_server);var o={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info("zp.ops.0 "+this.streamId+" username: "+e.turn_username),this.logger.info("zp.ops.0 "+this.streamId+" credential: "+e.turn_auth_key),this.peerConnection=new RTCPeerConnection(o),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)};var n=[],s=[];this.localStream&&(this.localStream.getTracks().forEach((function(e){t.peerConnection.addTrack(e,t.localStream)})),n=this.localStream.getVideoTracks(),s=this.localStream.getAudioTracks(),n.length>0&&this.logger.info("zp.ops.0 "+this.streamId+" video device: "+n[0].label),s.length>0&&this.logger.info("zp.ops.0 "+this.streamId+" audio device: "+s[0].label));var c={offerToReceiveAudio:s.length>0?1:0,offerToReceiveVideo:n.length>0?1:0};this.logger.info("zp.ops.0 "+this.streamId+" createOffer: "+JSON.stringify(c)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(c).then((function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.dataReport.eventEnd(t.streamReportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)}),(function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateOffer",{error:e.toString()}),t.logger.error("zp.ops.0 "+t.streamId+" create offer error "+e.toString()),t.publishStateUpdateError(a.publishErrorList.CREATE_OFFER_ERROR,!0)})),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,(function(e,r,i){t.onRecvCandidateInfo(e,r,i)})),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,r,i){t.onRecvCloseSession(e,r,i)})),this.signal.registerPushCallback("MediaDescPush",this.sessionId,(function(e,r,i){t.onRecvMediaDescription(e,r,i)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,r,i){t.onRecvResetSession(e,r,i)})),this.signal.registerPushCallback("PublishEventPush",this.sessionId,(function(e,r,i){t.onRecvPublishEvent(e,r,i)})),this.logger.info("zp.ops.0 "+this.streamId+" call success")},e.prototype.onCreateOfferSuccess=function(e){var t=this;0!=this.videoInfo.bitRate&&(e.sdp=this.updateBandwidthRestriction(e.sdp,this.videoInfo.bitRate)),e.sdp=e.sdp.replace(/sendrecv/g,"sendonly"),e.sdp=e.sdp.replace(/useinbandfec=\d+/,"maxaveragebitrate="+this.audioBitRate+(2===this.channelCount?";stereo=1":"")),this.logger.info("zp.oco.0 "+this.streamId+" local sdp revert "+this.localSdpRevert),/m=video[\s\S]*m=audio/.test(e.sdp)&&(this.localSdpRevert=!0),e.sdp=d.SdpUtil.getSDPByVideDecodeType(e.sdp,this.videoCodec),this.logger.info("zp.oco.0 "+this.streamId+" localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info("zp.oco.0 "+this.streamId+" localSdp2 "+e.sdp.substr(e.sdp.length/2)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),this.peerConnection.setLocalDescription(e).then((function(){t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription"),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription"),t.onSetLocalDescriptionSuccess(e)}),(function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"SetLocalDescription",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SetLocalDescription",{error:e.toString()}),t.logger.error("zp.oco.0 "+t.streamId+" error "+e.toString()),t.publishStateUpdateError(a.publishErrorList.SET_LOCAL_DESC_ERROR,!0)}))},e.prototype.updateBandwidthRestriction=function(e,t){var r="AS";return"firefox"===s.browserDetails.browser&&(t=1e3*(t>>>0),r="TIAS"),-1===e.indexOf("b="+r+":")?(e=e.replace(/c=IN (.*)\r\n/g,"c=IN $1\r\nb="+r+":"+t+"\r\n")).replace("b="+r+":"+t+"\r\n",""):(e=e.replace(new RegExp("b="+r+":.*\r\n","g"),"b="+r+":"+t+"\r\n")).replace("b="+r+":"+t+"\r\n","")},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;this.logger.info("zp.osd.0 "+this.streamId+" success");var r={sdp:e.sdp,width:this.videoInfo.width,height:this.videoInfo.height,frameRate:this.videoInfo.frameRate,video_min_kpbs:this.videoInfo.bitRate,video_max_kpbs:this.videoInfo.bitRate,audio_kpbs:48,keyframe_intv:2};this.offerSeq=n.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.offerSeq,this.sessionId,0,r,(function(e,i,n){t.offerSeq==e&&t.sessionId==i?(t.logger.info("zp.osd.0 "+t.streamId+" send success"),t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{mediaDescription:{width:r.width,height:r.height,frameRate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv}}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{mediaDescription:{width:r.width,height:r.height,frameRate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv}}),t.waitingAnswerTimer=setTimeout((function(){t.state==o.ENUM_PUBLISH_STATE.waitingServerAnswer&&(t.logger.error("zp.osd.0 "+t.streamId+" waiting timeout"),t.publishStateUpdateError(a.publishErrorList.SERVER_MEDIA_DESC_TIMEOUT))}),t.waitingAnswerTimeInterval),t.logger.info("zp.osd.0 "+t.streamId+" send success stateNego:waiterAnswer"),t.stateNego=o.ENUM_PUBLISH_STATE_NEGO.waiterAnswer,t.state=o.ENUM_PUBLISH_STATE.waitingServerAnswer):t.logger.error("zp.osd.0 "+t.streamId+" seq or sessionId is not equal")}),(function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{error:e}),t.publishStateUpdateError(a.publishErrorList.SEND_MEDIA_DESC_TIMEOUT)})),this.state=o.ENUM_PUBLISH_STATE.waitingOffserRsp,this.logger.info("zp.osd.0 "+this.streamId+" call success")},e.prototype.onRecvMediaDescription=function(e,t,r){this.logger.info("zp.ormd.0 "+this.streamId+" received"),this.state==o.ENUM_PUBLISH_STATE.waitingServerAnswer?(this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.waitingCandidate,this.logger.info("zp.orm.0 "+this.streamId+" received stateNego:waitingCandidate"),null!=this.waitingAnswerTimer&&(clearTimeout(this.waitingAnswerTimer),this.waitingAnswerTimer=null),this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0),1==r.type?this.onGetRemoteOfferSucceses(r.sdp):this.publishStateUpdateError(a.publishErrorList.SERVER_MEDIA_DESC_ERROR)):this.logger.info("zp.ormd.0 "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onGetRemoteOfferSucceses=function(e){var t=this;if(48e3!==this.audioBitRate&&(e=e.replace(/maxaveragebitrate=(\d+)/,"maxaveragebitrate="+this.audioBitRate)),this.logger.info("zp.oro.0 "+this.streamId+NaN+this.localSdpRevert),this.localSdpRevert){var r=[/[\s\S]*m=audio/.exec(e)[0].replace("m=audio",""),/m=video[\s\S]*/.exec(e)[0],/m=audio[\s\S]*m=video/.exec(e)[0].replace("m=video","")],i=r[0],n=r[1],s=r[2],c=/a=group:BUNDLE\s+(\w+)\s+(\w+)/.exec(i);e=(i=i.replace(/a=group:BUNDLE\s+(\w+)\s+(\w+)/,"a=group:BUNDLE "+c[2]+" "+c[1]))+n+s,this.localSdpRevert=!1}this.logger.info("zp.oro.0 "+this.streamId+" remoteSdp:",e);var d={type:"answer",sdp:e,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription"),this.peerConnection.setRemoteDescription(new RTCSessionDescription(d)).then((function(){t.logger.info("zp.oro.0 "+t.streamId+" set success"),t.dataReport.eventEnd(t.reportSeq,"SetRemoteDescription"),t.dataReport.eventEnd(t.streamReportSeq,"SetRemoteDescription")}),(function(e){t.logger.error("zp.oro.0 "+t.streamId+" failed: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SetRemoteDescription",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SetRemoteDescription",{error:e.toString()}),t.publishStateUpdateError(a.publishErrorList.SET_REMOTE_DESC_ERROR,!0)})),this.state=o.ENUM_PUBLISH_STATE.waitingServerICE,this.waitingICETimer=setTimeout((function(){t.state==o.ENUM_PUBLISH_STATE.waitingServerICE&&(t.logger.error("zp.orod.0 "+t.streamId+" waiting server timeout"),t.publishStateUpdateError(a.publishErrorList.SERVER_CANDIDATE_TIMEOUT))}),this.waitingICETimeInterval),this.logger.debug("zp.oro.0 "+this.streamId+" call success")},e.prototype.onIceConnectionStateChange=function(e){var t=this;this.state!=o.ENUM_PUBLISH_STATE.stop&&null!=this.peerConnection&&(this.logger.info("zp.oics.0 "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState?(this.logger.info("zp.oics.0 "+this.streamId+" connected state "+this.state),this.dataReport.eventEnd(this.reportSeq,"IceConnected"),this.dataReport.eventEnd(this.streamReportSeq,"IceConnected"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.iceConnected,this.logger.info("zp.oisc.0 "+this.streamId+" stateNego:iceConnected"),this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.publishEvent?this.publishSuccess():(this.firstGetStatsTimer&&clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null,this.firstGetStatsTimer=setTimeout((function(){t.logger.info("zp.oisc.0 get first stats state "+t.state),t.state!==o.ENUM_PUBLISH_STATE.publishing&&t.peerConnection.getStats().then((function(e){t.logger.info("zp.oisc.0 get first stats suc"),e.size>0&&t.publishSuccess()}))}),1e3))):"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.iceDisconnected,this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)))},e.prototype.onIceCandidate=function(e){if(this.logger.info("zp.oic.0 "+this.streamId+" candidate"+e.candidate),e.candidate)if(this.logger.info("zp.oic.0 "+this.streamId+" candidate"+e.candidate.candidate),this.state<o.ENUM_PUBLISH_STATE.connecting||this.state==o.ENUM_PUBLISH_STATE.stop)this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex});else{var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};this.sendCandidateInfo([t])}},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info("zp.sci.0 "+this.streamId+" called"),!(e=e.filter((function(e){return e.candidate.indexOf("relay")>0})))||e.length<1?this.logger.info("zp.sci.0 "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==o.ENUM_PUBLISH_STATE_NEGO.iceConnected&&(this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.sendCandidate),this.logger.info("zp.sci.0 "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(n.getSeq(),this.sessionId,e,(function(e,r,i){t.logger.info("zp.sci.0 "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")}),(function(e,r){t.logger.error("zp.sci.0 "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.publishStateUpdateError(a.publishErrorList.SEND_CANDIDATE_TIMEOUT)})))},e.prototype.onConnectionStateChange=function(e){this.logger.info("zp.ocs.0 "+this.streamId+" called "+e.target.signalingState)},e.prototype.onRecvCandidateInfo=function(e,t,r){var i=this;if(this.logger.info("zp.oci.0 "+this.streamId+" received "+JSON.stringify(r.infos)),this.state==o.ENUM_PUBLISH_STATE.waitingServerICE){null!=this.waitingICETimer&&(clearTimeout(this.waitingICETimer),this.waitingICETimer=null),this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var n=0;n<r.infos.length;n++){var s={sdpMid:r.infos[n].sdpMid,sdpMLineIndex:r.infos[n].sdpMLineIndex,candidate:r.infos[n].candidate};this.logger.debug("zp.orci.0 "+this.streamId+" candidate "+s.candidate),this.peerConnection.addIceCandidate(new RTCIceCandidate(s)).then((function(){i.logger.info("zp.oci.0 "+i.streamId+" add success")}),(function(e){i.logger.error("zp.oci.0 "+i.streamId+" add error "+e.toString()),i.publishStateUpdateError(a.publishErrorList.SERVER_CANDIDATE_ERROR,!0)}))}this.state=o.ENUM_PUBLISH_STATE.connecting,this.dataReport.eventStart(this.reportSeq,"IceConnected"),this.dataReport.eventStart(this.streamReportSeq,"IceConnected")}else this.logger.info("zp.oci.0 "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info("zp.orcs.0 "+this.streamId+" reason: "+r.reason),this.dataReport.addEvent(this.reportSeq,"RecvCloseSession"),this.signal.sendCloseSessionAck(e,this.sessionId,0);var i=JSON.parse(JSON.stringify(a.publishErrorList.SESSION_CLOSED));i.msg+=" reason:"+r.reason+(r.err_info&&JSON.parse(r.err_info).action?"action:"+JSON.parse(r.err_info).action:""),this.negoTimer&&clearTimeout(this.negoTimer);var o=1*r.reason,n=r.err_info&&JSON.parse(r.err_info).action?JSON.parse(r.err_info).action:null,s=![4,8,10,11,12,14,26,27].includes(o)&&5!=n&&2!=n;this.publishStateUpdateError(i,s)},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info("zp.orrs.0 "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(e,this.sessionId,0);var i=JSON.parse(JSON.stringify(a.publishErrorList.SESSION_CLOSED));this.negoTimer&&clearTimeout(this.negoTimer),this.publishStateUpdateError(i)}else this.logger.error("zp.orrs.0 "+this.streamId+" cannot find session")},e.prototype.onRecvPublishEvent=function(e,t,r){this.logger.info("zp.orpe.0 "+this.streamId+" received"),this.publishEvent=!0,this.firstGetStatsTimer&&(clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null),this.stateNego===o.ENUM_PUBLISH_STATE_NEGO.iceConnected&&0==r.event&&this.publishSuccess()},e.prototype.checkPublishConnectionFailedState=function(e){var t=null;"failed"==e?t=a.publishErrorList.MEDIA_CONNECTION_FAILED:"closed"==e?t=a.publishErrorList.MEDIA_CONNECTION_CLOSED:"disconnected"==e&&(t=a.publishErrorList.MEDIA_CONNECTION_DISCONNECTED),null!=t&&(this.logger.info("zp.oics.0 streamID "+this.streamId," state "+this.state+" connectionState "+e),this.publishStateUpdateError(t))},e.prototype.setPublishQualityTimer=function(){var e=this;if(null==this.qualityTimer){this.logger.info("zp.spq.0 "+this.streamId+" called"),this.clearPublishQualityTimer();var t=!0;this.peerConnection.getStats((function(){})).catch((function(r){e.logger.info("zp.spq.0 "+e.streamId+" getStats callback not support"),t=!1})),this.qualityTimer=setInterval((function(){e.peerConnectionGetStats(t)}),this.qualityTimeInterval),this.lastPublishStats={audioPacketsLost:0,videoPacketsLost:0,videoPacketsSent:0,audioPacketsSent:0,audioRetransmittedPacketsSent:0,videoTime:(new Date).getTime(),audioTime:(new Date).getTime(),time:(new Date).getTime(),audioBytesSent:0,videoBytesSent:0,framesEncoded:0,framesSent:0},this.qualitySeq=n.getSeq(),this.qualityCount=0}},e.prototype.peerConnectionGetStats=function(e,t){var r=this;if(this.peerConnection){var i=[this.peerConnection.getStats(null)];e&&i.push(new Promise((function(e,t){r.peerConnection.getStats((function(t){return e(t)}),(function(e){return t(e)}))}))),Promise.all(i).then((function(e){var i=r.getPublishStats(e[0],e[1]);t&&t(i)})).catch((function(e){r.logger.info("zp.spq.0 "+r.streamId+" getStats error "+e.toString())}))}},e.prototype.getPublishStats=function(e,t){var r=this;if(e){for(var i,o=document.querySelectorAll("video, audio"),n=0;n<o.length;n++)o[n].srcObject===this.localStream&&(i=o[n]);var a={audioCodec:"opus",audioBitrate:0,videoBitrate:0,audioFPS:0,audioLevel:0,audioInputLevel:0,audioPacketsLost:0,audioPacketsLostRate:0,sendLevel:0,samplingRate:0,videoFPS:0,nackCount:0,pliCount:0,audioQuality:0,videoQuality:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoPacketsLost:0,videoPacketsLostRate:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,googActualEncBitrate:0,googTargetEncBitrate:0,googFrameWidthInput:0,googFrameHeightInput:0,googFrameRateInput:0,codecImplementationName:"",videoMuteState:this.localStream.getVideoTracks().length>0&&this.localStream.getVideoTracks()[0].enabled?"0":"1",audioMuteState:this.localStream.getAudioTracks().length>0&&this.localStream.getAudioTracks()[0].enabled?"0":"1",muted:i?i.muted:void 0,paused:i?i.paused:void 0,volume:i?i.volume:void 0,sinkId:i?i.sinkId:void 0},s=this.lastPublishStats.time,c=0;e.forEach((function(e){if(("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"audio"==e.mediaType)0!=s&&(a.audioBitrate=8*(e.bytesSent-r.lastPublishStats.audioBytesSent)/(e.timestamp-s),a.audioFPS=(e.packetsSent-(e.retransmittedPacketsSent-r.lastPublishStats.audioRetransmittedPacketsSent)-r.lastPublishStats.audioPacketsSent)/(e.timestamp-s)*1e3),a.audioBitrate<0&&(a.audioBitrate=0),r.lastPublishStats.audioBytesSent=e.bytesSent,r.lastPublishStats.time=e.timestamp,r.lastPublishStats.audioPacketsSentTimeStamp=e.packetsSent-r.lastPublishStats.audioPacketsSent,r.lastPublishStats.audioPacketsSent=e.packetsSent,r.lastPublishStats.audioRetransmittedPacketsSent=e.retransmittedPacketsSent;else if(("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"video"==e.mediaType)0!=s&&(a.videoBitrate=8*(e.bytesSent-r.lastPublishStats.videoBytesSent)/(e.timestamp-s),a.videoFPS=1e3*(e.framesEncoded-r.lastPublishStats.framesEncoded)/(e.timestamp-s)),a.videoBitrate<0&&(a.videoBitrate=0),a.videoFPS<0&&(a.videoFPS=0),a.nackCount=e.nackCount,a.pliCount=e.pliCount,r.lastPublishStats.videoBytesSent=e.bytesSent,r.lastPublishStats.framesEncoded=e.framesEncoded,r.lastPublishStats.time=e.timestamp,r.lastPublishStats.videoPacketsSentTimeStamp=e.packetsSent-r.lastPublishStats.videoPacketsSent,r.lastPublishStats.videoPacketsSent=e.packetsSent;else if("remote-inbound-rtp"==e.type&&"video"==e.kind){e.packetsLost>0&&(a.videoPacketsLost=e.packetsLost);var t=e.packetsLost-r.lastPublishStats.videoPacketsLost;a.videoPacketsLostRate=t>0?t/r.lastPublishStats.videoPacketsSentTimeStamp:0,e.packetsLost>0&&(r.lastPublishStats.videoPacketsLost=e.packetsLost),r.lastPublishStats.videoTime=e.timestamp}else if("remote-inbound-rtp"==e.type&&"audio"==e.kind){e.packetsLost>0&&(a.audioPacketsLost=e.packetsLost);var i=e.packetsLost-r.lastPublishStats.audioPacketsLost;a.audioPacketsLostRate=i>0?i/r.lastPublishStats.audioPacketsSentTimeStamp:0,e.packetsLost>0&&(r.lastPublishStats.audioPacketsLost=e.packetsLost),r.lastPublishStats.audioTime=e.timestamp}else"media-source"==e.type&&("audio"==e.kind||e.id.toLowerCase().indexOf("audio")>=0)?(a.audioLevel=e.audioLevel,a.sendLevel=e.totalAudioEnergy,a.audioInputLevel=32767*e.totalAudioEnergy,a.samplingRate=e.totalSamplesDuration):"track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0||e.frameWidth)?(a.frameHeight=e.frameHeight,a.frameWidth=e.frameWidth,0!=s&&(a.videoTransferFPS=1e3*(e.framesSent-r.lastPublishStats.framesSent)/(e.timestamp-s)),a.videoTransferFPS<0&&(a.videoTransferFPS=0),r.lastPublishStats.framesSent=e.framesSent):"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(a.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(a.currentRoundTripTime=e.currentRoundTripTime,c=1e3*a.currentRoundTripTime))})),t&&t.result().forEach((function(e){"ssrc"==e.type&&e.names().indexOf("googBandwidthLimitedResolution")>=0&&(a.googBandwidthLimitedResolution=e.stat("googBandwidthLimitedResolution")),"ssrc"==e.type&&"video"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(a.videoCodecName=e.stat("googCodecName")),"ssrc"==e.type&&"audio"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(a.audioCodecName=e.stat("googCodecName")),"ssrc"==e.type&&e.names().indexOf("googCpuLimitedResolution")>=0&&(a.googCpuLimitedResolution=e.stat("googCpuLimitedResolution")),"ssrc"==e.type&&e.names().indexOf("googFrameWidthInput")>=0&&(a.googFrameWidthInput=e.stat("googFrameWidthInput")),"ssrc"==e.type&&e.names().indexOf("googFrameHeightInput")>=0&&(a.googFrameHeightInput=e.stat("googFrameHeightInput")),"ssrc"==e.type&&e.names().indexOf("googFrameRateInput")>=0&&(a.googFrameRateInput=e.stat("googFrameRateInput")),"ssrc"==e.type&&e.names().indexOf("codecImplementationName")>=0&&(a.codecImplementationName=e.stat("codecImplementationName")),"VideoBwe"==e.type&&e.names().indexOf("googAvailableSendBandwidth")>=0&&(a.googAvailableSendBandwidth=e.stat("googAvailableSendBandwidth")),"VideoBwe"==e.type&&e.names().indexOf("googActualEncBitrate")>=0&&(a.googActualEncBitrate=e.stat("googActualEncBitrate")),"VideoBwe"==e.type&&e.names().indexOf("googTargetEncBitrate")>=0&&(a.googTargetEncBitrate=e.stat("googTargetEncBitrate"))})),a.audioQuality=l.ClientUtil.getNetQuality(c,a.audioPacketsLostRate),a.videoQuality=l.ClientUtil.getNetQuality(c,a.videoPacketsLostRate),0!==s&&this.uploadPublishQuality(a);var d={video:{videoBitrate:a.videoBitrate,videoFPS:a.videoFPS,videoTransferFPS:a.videoTransferFPS,frameHeight:a.frameHeight,frameWidth:a.frameWidth,muteState:a.videoMuteState,videoQuality:a.videoQuality,videoPacketsLost:a.videoPacketsLost,videoPacketsLostRate:a.videoPacketsLostRate},audio:{audioBitrate:a.audioBitrate,audioCodec:a.audioCodec,muteState:a.audioMuteState,audioQuality:a.audioQuality,audioPacketsLost:a.audioPacketsLost,audioPacketsLostRate:a.audioPacketsLostRate,audioFPS:a.audioFPS},nackCount:a.nackCount,pliCount:a.pliCount,totalRoundTripTime:a.totalRoundTripTime,currentRoundTripTime:a.currentRoundTripTime};return void 0!==a.videoPacketsLost&&(d.video.videoPacketsLost=a.videoPacketsLost,d.video.videoPacketsLostRate=a.videoPacketsLostRate,d.audio.audioPacketsLost=a.audioPacketsLost,d.audio.audioPacketsLostRate=a.audioPacketsLostRate),void 0!==a.muted&&(d.muted=a.muted,d.paused=a.paused,d.volume=a.volume,d.sinkId=a.sinkId),void 0!==a.googBandwidthLimitedResolution&&(d.googBandwidthLimitedResolution=a.googBandwidthLimitedResolution,d.video.googCodecName=a.videoCodecName,d.audio.googCodecName=a.audioCodecName,d.googCpuLimitedResolution=a.googCpuLimitedResolution,d.googFrameWidthInput=a.googFrameWidthInput,d.googFrameHeightInput=a.googFrameHeightInput,d.googFrameRateInput=a.googFrameRateInput,d.codecImplementationName=a.codecImplementationName,d.googAvailableSendBandwidth=a.googAvailableSendBandwidth,d.googActualEncBitrate=a.googActualEncBitrate,d.googTargetEncBitrate=a.googTargetEncBitrate),0!==s&&this.onPublishQualityUpdate(this.streamId,d),d}},e.prototype.uploadPublishQuality=function(e){var t=this;if(this.qualityUpload){var r=Date.parse(new Date+"");(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="publish",e.stream_id=this.streamId,e.timeStamp=r/1e3,this.logger.info("zp.upq.0 "+this.streamId+" upload"+JSON.stringify(e)),this.signal.QualityReport(n.getSeq(),this.sessionId,e,(function(e,r,i){void 0!==i.report&&(t.qualityUpload=i.report,t.qualityUploadInterval=i.report_interval_ms)}),(function(e,r){t.logger.info("zp.upq.0 "+t.streamId+" upload failed "+e)})),this.qualityUploadLastTime=r)}},e.prototype.stopPublish=function(){if(this.logger.info("zp.sp.0.1 "+this.streamId+" called"),Object.keys(this.streamCenter.publisherList).length=1)for(var e in this.streamCenter.playerList){var t=this.streamCenter.playerList[e].player;t.state==o.ENUM_PLAY_STATE.playing&&t.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.start&&(this.signal&&this.signal.sendBroadcasterStatus(n.getSeq(),t.sessionId,0),t.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop)}this.stopMixingAudio(),this.stopMixingBuffer(),this.stopEffect(),this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(n.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PublishState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPublish"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.addMsgInfo(this.streamReportSeq,{itemtype:"RTCPublishStream"}),this.dataReport.uploadReport(this.streamReportSeq,"RTCPublishStream"),this.resetPublish()},e.prototype.onPublishStateUpdate=function(e,t,r,i){},e.prototype.onPublishQualityUpdate=function(e,t){},e.prototype.onDisconnect=function(){this.logger.info("zp.od.0 "+this.streamId+" call"),this.logger.info("zp.od.0 "+this.streamId+" websocket disconnect"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.publishStateUpdateError(a.publishErrorList.WEBSOCKET_ERROR)},e.prototype.playEffect=function(e,t,r,i){if(this.logger.info("zp.pe.0 "+this.streamId+" call"),this.effectList.find((function(r){return r.effectID==e.effectID&&r.audioBuffer==t})))this.logger.warn("zp.pe.0 "+this.streamId+" effect alreadly exist ");else{this.streamCenter.soundLevelDelegate&&this.stopSoundLevel();var o=new c.AudioMixUtil(this.logger,this.ac,this.mediaEleSources);o.localStream=this.localStream,o.peerConnection=this.peerConnection,o.audioBuffer=t,this.effectList.push({audioMix:o,effectID:e.effectID,audioBuffer:t}),o.playEffect(e.playTime,e.loop,!1,r,i),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info("zp.pe.0 "+this.streamId+" play effect "+e.effectID+" success")}},e.prototype.pauseEffect=function(e){var t=this.effectList.find((function(t){return t.effectID==e}));if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.pauseEffect(),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info("zp.pe.1 "+this.streamId+" pause "+e+" success");else{if(void 0!==e)return this.logger.error("zp.pe.1 "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach((function(e){return e.audioMix.pauseEffect()})),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!0},e.prototype.resumeEffect=function(e){var t=this.effectList.find((function(t){return t.effectID==e}));if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.resumeEffect(),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info("zp.pe.1 "+this.streamId+" resume"+e+" success");else{if(void 0!==e)return this.logger.error("zp.pe.1 "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach((function(e){return e.audioMix.resumeEffect()})),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!1},e.prototype.stopEffect=function(e){var t=this.effectList.find((function(t){return t.effectID==e}));if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.stopMixingAudio(),this.effectList.splice(this.effectList.indexOf(t),1),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info("zp.pe.1 "+this.streamId+" pause "+e+" success");else{if(void 0!==e)return this.logger.error("zp.pe.1 "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach((function(e){return e.audioMix.stopMixingAudio()})),this.effectList=[],this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!0},e.prototype.startMixingAudio=function(e){var t=this;return this.logger.info("zp.sma.0 "+this.streamId+" call"),this.localStream?(this.micTrack||(this.micTrack=this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks()[0]:null),e.forEach((function(e){if(t.audioMixList.find((function(t){return t.media==e})))t.logger.info("zp.sma.0 "+t.streamId+" mix audio already exist");else{t.streamCenter.soundLevelDelegate&&t.stopSoundLevel();var r=new c.AudioMixUtil(t.logger,t.ac,t.mediaEleSources);r.localStream=t.localStream,r.peerConnection=t.peerConnection,t.audioMixList.push({audioMix:r,media:e}),r.startMixingAudio(e),t.streamCenter.soundLevelDelegate&&t.startSoundLevel()}})),!0):(this.logger.error("zp.sma.0 localStream not found"),!1)},e.prototype.stopMixingAudio=function(e){var t=this;return this.logger.info("zp.sma.0.0 "+this.streamId+" call"),e?e.forEach((function(e){for(var r=0;r<t.audioMixList.length;r++)if(t.audioMixList[r].media==e){t.audioMixList[r].audioMix.stopMixingAudio()&&t.audioMixList.splice(r--,1);break}})):(this.audioMixList.forEach((function(e){return e.audioMix.stopMixingAudio()})),this.audioMixList=[]),!0},e.prototype.mixingBuffer=function(e,t,r){var i=this;if(this.logger.info("zp.mb.0 "+this.streamId+" call"),this.micTrack||(this.micTrack=this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks()[0]:null),this.arrayBufferMap[e])this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap[e].mixingBuffer(t,(function(){i.streamCenter.soundLevelDelegate&&i.startSoundLevel(),r&&r()}));else{this.streamCenter.soundLevelDelegate&&this.stopSoundLevel();var o=new c.AudioMixUtil(this.logger,this.ac,this.mediaEleSources);o.localStream=this.localStream,o.peerConnection=this.peerConnection,this.arrayBufferMap[e]=o,o.mixingBuffer(t,(function(){i.streamCenter.soundLevelDelegate&&i.startSoundLevel(),r&&r()}))}},e.prototype.stopMixingBuffer=function(e){if(e&&this.arrayBufferMap[e])return this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap[e].stopMingBuffer(),delete this.arrayBufferMap[e],this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),!0;if(void 0===e){for(var t in this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap)this.arrayBufferMap[t].stopMingBuffer();return this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),!0}return this.logger.warn("zp.smb.0 "+this.streamId+" arrayBuffer no found"),!1},e.prototype.setMixingAudioVolume=function(e,t){this.logger.info("zp.sma.0.1 "+this.streamId+" call");var r=this.audioMixList.find((function(e){return e.media===t}));return r?(r.audioMix.setMixingAudioVolume(e),this.logger.info("zp.sma.0.1 "+this.streamId+" call success"),!0):(this.logger.error("zp.sma.0.1 "+this.streamId+" audio is not mixing"),!1)},e.prototype.publishSuccess=function(){for(var e in this.logger.info("zp.ps.0 call"),this.state!=o.ENUM_PUBLISH_STATE.publishing&&this.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.start,this.streamId,{code:0,msg:""},!0),this.state=o.ENUM_PUBLISH_STATE.publishing,this.dataReport.eventStart(this.reportSeq,"PublishState"),this.dataReport.eventStart(this.streamReportSeq,"PublishState"),this.streamCenter.playerList){var t=this.streamCenter.playerList[e].player;t.state==o.ENUM_PLAY_STATE.playing&&t.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.stop&&(this.signal&&this.signal.sendBroadcasterStatus(n.getSeq(),t.sessionId,1),t.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.start)}this.setPublishQualityTimer();var r=2,i=2;0!==this.localStream.getVideoTracks().length&&1==this.localStream.getVideoTracks()[0].enabled&&(r=0),0!==this.localStream.getAudioTracks().length&&1==this.localStream.getAudioTracks()[0].enabled&&(i=0),this.signal.sendStreamStatus(n.getSeq(),this.sessionId,r,i,this.streamId),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info("zp.ps.0 call success")},e.prototype.startSoundLevel=function(){var e=this;if(this.logger.info("zp.ssl.0 call streamID: "+this.streamId),this.localStream&&0!=this.localStream.getAudioTracks().length){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.localStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var r=t.inputBuffer.getChannelData(0),i=0,o=0;o<r.length;o++)i<r[o]&&(i=r[o]);e.soundLevel=100*i},this.ac.resume()}catch(e){this.logger.error("zp.ssl.0 "+this.streamId+" get sound level failed "+e)}}else this.logger.info("zp.ssl.0 "+this.streamId+" local stream no found")},e.prototype.stopSoundLevel=function(){this.logger.info("zp.ssl.0.1 call streamID: "+this.streamId),this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},e.prototype.rebackMic=function(){var e=this;this.peerConnection&&this.micTrack instanceof MediaStreamTrack&&0==this.audioMixList.length&&0==Object.keys(this.arrayBufferMap).length&&0==this.effectList.length&&(this.peerConnection.getSenders().find((function(t){return t.track.kind===e.micTrack.kind})).replaceTrack(this.micTrack),this.localStream.removeTrack(this.localStream.getAudioTracks()[0]),this.localStream.addTrack(this.micTrack))},e}();t.ZegoPublish=u},function(e,t,r){e.exports=function e(t,r,i){function o(a,s){if(!r[a]){if(!t[a]){if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=r[a]={exports:{}};t[a][0].call(d.exports,(function(e){return o(t[a][1][e]||e)}),d,d.exports,e,t,r,i)}return r[a].exports}for(var n=!1,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,r){"use strict";var i=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=i},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=i.log,d=i.detectBrowser(e),l={browserDetails:d,commonShim:c,extractVersion:i.extractVersion,disableLog:i.disableLog,disableWarnings:i.disableWarnings};switch(d.browser){case"chrome":if(!o||!o.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),l;r("adapter.js shimming chrome."),l.browserShim=o,o.shimGetUserMedia(e),o.shimMediaStream(e),o.shimPeerConnection(e),o.shimOnTrack(e),o.shimAddTrackRemoveTrack(e),o.shimGetSendersWithDtmf(e),o.shimGetStats(e),o.shimSenderReceiverGetStats(e),o.fixNegotiationNeeded(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;case"firefox":if(!a||!a.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),l;r("adapter.js shimming firefox."),l.browserShim=a,a.shimGetUserMedia(e),a.shimPeerConnection(e),a.shimOnTrack(e),a.shimRemoveStream(e),a.shimSenderGetStats(e),a.shimReceiverGetStats(e),a.shimRTCDataChannel(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"edge":if(!n||!n.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),l;r("adapter.js shimming edge."),l.browserShim=n,n.shimGetUserMedia(e),n.shimGetDisplayMedia(e),n.shimPeerConnection(e),n.shimReplaceTrack(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"safari":if(!s||!t.shimSafari)return r("Safari shim is not included in this adapter release."),l;r("adapter.js shimming safari."),l.browserShim=s,s.shimRTCIceServerUrls(e),s.shimCreateOfferLegacy(e),s.shimCallbacksAPI(e),s.shimLocalStreamsAPI(e),s.shimRemoteStreamsAPI(e),s.shimTrackEventTransceiver(e),s.shimGetUserMedia(e),c.shimRTCIceCandidate(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;default:r("Unsupported browser!")}return l};var i=d(e("./utils")),o=d(e("./chrome/chrome_shim")),n=d(e("./edge/edge_shim")),a=d(e("./firefox/firefox_shim")),s=d(e("./safari/safari_shim")),c=d(e("./common_shim"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}});var n=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return n.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(e){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)a.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(i){var o;o=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===i.track.id})):{track:i.track};var n=new Event("track");n.track=i.track,n.receiver=o,n.transceiver={receiver:o},n.streams=[t.stream],r.dispatchEvent(n)})),t.stream.getTracks().forEach((function(i){var o;o=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===i.id})):{track:i};var n=new Event("track");n.track=i,n.receiver=o,n.transceiver={receiver:o},n.streams=[t.stream],r.dispatchEvent(n)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}},r.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){var o=r.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){o.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var r=t._senders.find((function(t){return t.track===e}));r&&t._senders.splice(t._senders.indexOf(r),1)}))}}else if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},r.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,i){var o=this,n=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){n[1](s(a(e)))};return t.apply(this,[c,arguments[0]])}return new Promise((function(e,r){t.apply(o,[function(t){e(s(a(t)))},r])})).then(r,i)}}},r.shimSenderReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return a.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var o=e.RTCPeerConnection.prototype.getReceivers;o&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=o.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),a.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return a.filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,i=void 0,o=void 0;return this.getSenders().forEach((function(e){e.track===t&&(r?o=!0:r=e)})),this.getReceivers().forEach((function(e){return e.track===t&&(i?o=!0:i=e),e.track===t})),o||r&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}}},r.shimAddTrackRemoveTrackWithNative=s,r.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=a.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return s(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(r.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var o=new e.MediaStream(t.getTracks());this._streams[t.id]=o,this._reverseStreams[o.id]=t,t=o}i.apply(this,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var i=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var n=this.getSenders().find((function(e){return e.track===t}));if(n)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[r.id];if(a)a.addTrack(t),Promise.resolve().then((function(){i.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments,i=arguments.length&&"function"==typeof arguments[0];return i?r.apply(this,[function(r){var i=d(e,r);t[0].apply(null,[i])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return d(e,t)}))}}));var n=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=l(this,arguments[0]),n.apply(this,arguments)):n.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:d(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var r=void 0;Object.keys(this._streams).forEach((function(i){t._streams[i].getTracks().find((function(t){return e.track===t}))&&(r=t._streams[i])})),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function d(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var i=e._reverseStreams[t],o=e._streams[i.id];r=r.replace(new RegExp(o.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function l(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var i=e._reverseStreams[t],o=e._streams[i.id];r=r.replace(new RegExp(i.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:r})}},r.shimPeerConnection=function(e){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}}));var t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},r.fixNegotiationNeeded=function(e){a.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));function s(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(i)&&this._shimmedLocalStreams[r.id].push(i):this._shimmedLocalStreams[r.id]=[r,i],i};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var i=this.getSenders();r.apply(this,arguments);var o=this.getSenders().filter((function(e){return-1===i.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(o)};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var i=t._shimmedLocalStreams[r].indexOf(e);-1!==i&&t._shimmedLocalStreams[r].splice(i,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),o.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&"function"==typeof t&&(e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var i=r.video&&r.video.width,o=r.video&&r.video.height,n=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:n||3}},i&&(r.video.mandatory.maxWidth=i),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)}))})}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var r=o.detectBrowser(e),a=function(e){if("object"!==(void 0===e?"undefined":i(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var o="object"===i(e[r])?e[r]:{ideal:e[r]};void 0!==o.exact&&"number"==typeof o.exact&&(o.min=o.max=o.exact);var n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==o.ideal){t.optional=t.optional||[];var a={};"number"==typeof o.ideal?(a[n("min",r)]=o.ideal,t.optional.push(a),(a={})[n("max",r)]=o.ideal,t.optional.push(a)):(a[n("",r)]=o.ideal,t.optional.push(a))}void 0!==o.exact&&"number"!=typeof o.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",r)]=o.exact):["min","max"].forEach((function(e){void 0!==o[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,r)]=o[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,o){if(r.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===i(e.audio)){var s=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};s((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=a(e.audio)}if(e&&"object"===i(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":i(c))?c:{ideal:c});var d=r.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||d)){delete e.video.facingMode;var l=void 0;if("environment"===c.exact||"environment"===c.ideal?l=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(l=["front"]),l)return t.mediaDevices.enumerateDevices().then((function(t){var r=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return l.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!r&&t.length&&l.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=c.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=a(e.video),n("chrome: "+JSON.stringify(e)),o(e)}))}e.video=a(e.video)}return n("chrome: "+JSON.stringify(e)),o(e)},c=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,r,i){s(e,(function(e){t.webkitGetUserMedia(e,r,(function(e){i&&i(c(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){var d=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return s(e,(function(e){return d(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(c(e))}))}))}}}};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js")),n=o.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function(e){if(e.RTCIceCandidate&&(!e.RTCIceCandidate||!("foundation"in e.RTCIceCandidate.prototype))){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),o=n.default.parseCandidate(e.candidate),a=Object.assign(r,o);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,a.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}},r.shimMaxMessageSize=function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=a.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=n.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=n.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},o=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},s=function(e,r){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var o=n.default.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(i=2147483637),i},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r(arguments[0])){var e=i(arguments[0]),t=o(e),n=s(arguments[0],e),a=void 0;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);var d={};Object.defineProperty(d,"maxMessageSize",{get:function(){return a}}),this._sctp=d}return c.apply(this,arguments)}}},r.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},a.wrapPeerConnectionEvent(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var i=arguments[0],o=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}},r.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}},r.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=a.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n")),r.apply(this,arguments)}}}};var o,n=(o=e("sdp"))&&o.__esModule?o:{default:o},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),r.shimPeerConnection=function(e){var t=a.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var i=(0,c.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,s.filterIceServers)(e.iceServers,t.version),a.log("ICE servers after filtering:",e.iceServers)),new i(e)},e.RTCPeerConnection.prototype=i.prototype},r.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var n,a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")),s=e("./filtericeservers"),c=(n=e("rtcpeerconnection-shim"))&&n.__esModule?n:{default:n}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&i.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"==typeof t;return o&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r})),delete e.url,e.urls=o?t[0]:t,!!t.length}}))};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}});var n=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return n.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":i(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(e){var t=a.detectBrowser(e);if("object"===(void 0===e?"undefined":i(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}}));var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,i){return n.apply(this,[e||null]).then((function(e){if(t.version<53&&!r)try{e.forEach((function(e){e.type=o[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:o[t.type]||t.type}))}))}return e})).then(r,i)}}},r.shimSenderGetStats=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},r.shimReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),a.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},r.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;a.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)}))})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=o.detectBrowser(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,i){o.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":i(e))&&"object"===i(e.audio)&&(e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","mozAutoGainControl"),a(e.audio,"noiseSuppression","mozNoiseSuppression")),s(e)},n&&n.prototype.getSettings){var c=n.prototype.getSettings;n.prototype.getSettings=function(){var e=c.apply(this,arguments);return a(e,"mozAutoGainControl","autoGainControl"),a(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var d=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":i(e))&&(e=JSON.parse(JSON.stringify(e)),a(e,"autoGainControl","mozAutoGainControl"),a(e,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[e])}}}};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getTracks().forEach((function(i){return t.call(r,i,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var i=e.getTracks();this.getSenders().forEach((function(e){i.includes(e.track)&&t.removeTrack(e)}))}})}},r.shimRemoteStreamsAPI=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))}),t.apply(e,arguments)}}},r.shimCallbacksAPI=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,o=t.createAnswer,n=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[i]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=o.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var c=function(e,t,r){var i=n.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i};t.setLocalDescription=c,c=function(e,t,r){var i=a.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.setRemoteDescription=c,c=function(e,t,r){var i=s.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.addIceCandidate=c}},r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,i=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return i(n(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,i){t.mediaDevices.getUserMedia(e).then(r,i)}.bind(t))},r.shimConstraints=n,r.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var i=[],n=0;n<e.iceServers.length;n++){var a=e.iceServers[n];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[n])}e.iceServers=i}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video")}return t.apply(this,arguments)}};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"));function n(e){return e&&void 0!==e.video?Object.assign({},e,{video:o.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=n,r.wrapPeerConnectionEvent=function(e,t,r){if(e.RTCPeerConnection){var i=e.RTCPeerConnection.prototype,o=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return o.apply(this,arguments);var n=function(e){var t=r(e);t&&i(t)};return this._eventMap=this._eventMap||{},this._eventMap[i]=n,o.apply(this,[e,n])};var n=i.removeEventListener;i.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return n.apply(this,arguments);var i=this._eventMap[r];return delete this._eventMap[r],n.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},r.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":i(e))+". Please use a boolean."):(o=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},r.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":i(e))+". Please use a boolean."):"adapter.js deprecation warnings "+(e?"disabled":"enabled")},r.log=function(){if("object"===("undefined"==typeof window?"undefined":i(window))){if(o)return;"undefined"!=typeof console&&console.log}},r.deprecated=function(e,t){},r.detectBrowser=function(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=n(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=n(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=n(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=n(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r},r.compactObject=function e(t){return"object"!==(void 0===t?"undefined":i(t))?t:Object.keys(t).reduce((function(r,o){var n="object"===i(t[o]),a=n?e(t[o]):t[o],s=n&&!Object.keys(a).length;return void 0===a||s?r:Object.assign(r,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},o,a))}),{})},r.walkStats=a,r.filterStats=function(e,t,r){var i=r?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;var n=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&n.push(e)})),n.forEach((function(t){e.forEach((function(r){r.type===i&&r.trackId===t.id&&a(e,r,o)}))})),o};var o=!0;function n(e,t,r){var i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function a(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((function(i){i.endsWith("Id")?a(e,e.get(t[i]),r):i.endsWith("Ids")&&t[i].forEach((function(t){a(e,e.get(t),r)}))})))}},{}],16:[function(e,t,r){"use strict";var i=e("sdp");function o(e,t,r,o,n){var a=i.writeRtpDescription(e.kind,t);if(a+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":n||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(o?o.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),a}function n(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},o=function(e,t,r,o){var n=i(e.parameters.apt,r),a=i(t.parameters.apt,o);return n&&a&&n.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach((function(i){for(var n=0;n<t.codecs.length;n++){var a=t.codecs[n];if(i.name.toLowerCase()===a.name.toLowerCase()&&i.clockRate===a.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&a.parameters.apt&&!o(i,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(i.numChannels,a.numChannels),r.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var i=0;i<t.headerExtensions.length;i++){var o=t.headerExtensions[i];if(e.uri===o.uri){r.headerExtensions.push(o);break}}})),r}function a(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function s(e,t){var r=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,r,i,o){var n=new Event("track");n.track=r,n.receiver=i,n.transceiver={receiver:i},n.streams=o,e.setTimeout((function(){t._dispatchEvent("track",n)}))}var l=function(r){var o=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){o[e]=n[e].bind(n)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&e.urls;var o="string"==typeof i;return o&&(i=[i]),i=i.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)})),delete e.url,e.urls=o?i[0]:i,!!i.length}}))}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=i.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,i={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)i.iceTransport=this.transceivers[0].iceTransport,i.dtlsTransport=this.transceivers[0].dtlsTransport;else{var o=this._createIceAndDtlsTransports();i.iceTransport=o.iceTransport,i.dtlsTransport=o.dtlsTransport}return t||this.transceivers.push(i),i},l.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(i=this.transceivers[o]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),i.track=t,i.stream=r,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},l.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach((function(t){r.addTrack(t,e)}));else{var i=e.clone();e.getTracks().forEach((function(e,t){var r=i.getTracks()[t];e.addEventListener("enabled",(function(e){r.enabled=e.enabled}))})),i.getTracks().forEach((function(e){r.addTrack(e,i)}))}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find((function(e){return e.rtpSender===t}));if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var i=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(i)&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var r=t.getSenders().find((function(t){return t.track===e}));r&&t.removeTrack(r)}))},l.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},l.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},l.prototype._createIceGatherer=function(t,r){var i=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var o=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(o,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;o.state=r?"completed":"gathering",null!==i.transceivers[t].bufferedCandidateEvents&&i.transceivers[t].bufferedCandidateEvents.push(e)},o.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),o},l.prototype._gather=function(t,r){var o=this,n=this.transceivers[r].iceGatherer;if(!n.onlocalcandidate){var a=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,n.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),n.onlocalcandidate=function(e){if(!(o.usingBundle&&r>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==n.state&&"gathering"!==n.state||(n.state="completed");else{"new"===n.state&&(n.state="gathering"),s.component=1,s.ufrag=n.getLocalParameters().usernameFragment;var d=i.writeCandidate(s);a.candidate=Object.assign(a.candidate,i.parseCandidate(d)),a.candidate.candidate=d,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var l=i.getMediaSections(o._localDescription.sdp);l[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",o._localDescription.sdp=i.getDescription(o._localDescription.sdp)+l.join("");var u=o.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==o.iceGatheringState&&(o.iceGatheringState="gathering",o._emitGatheringStateChange()),c||o._dispatchEvent("icecandidate",a),u&&(o._dispatchEvent("icecandidate",new Event("icecandidate")),o.iceGatheringState="complete",o._emitGatheringStateChange())}},e.setTimeout((function(){a.forEach((function(e){n.onlocalcandidate(e)}))}),0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new e.RTCDtlsTransport(r);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:i}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var i=this.transceivers[e].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,r,o){var a=n(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:i.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),o&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},l.prototype.setLocalDescription=function(e){var t,r,o=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,o.signalingState)||o._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+o.signalingState));if("offer"===e.type)t=i.splitSections(e.sdp),r=t.shift(),t.forEach((function(e,t){var r=i.parseRtpParameters(e);o.transceivers[t].localCapabilities=r})),o.transceivers.forEach((function(e,t){o._gather(e.mid,t)}));else if("answer"===e.type){t=i.splitSections(o._remoteDescription.sdp),r=t.shift();var s=i.matchPrefix(r,"a=ice-lite").length>0;t.forEach((function(e,t){var a=o.transceivers[t],c=a.iceGatherer,d=a.iceTransport,l=a.dtlsTransport,u=a.localCapabilities,h=a.remoteCapabilities;if(!(i.isRejected(e)&&0===i.matchPrefix(e,"a=bundle-only").length||a.rejected)){var p=i.getIceParameters(e,r),f=i.getDtlsParameters(e,r);s&&(f.role="server"),o.usingBundle&&0!==t||(o._gather(a.mid,t),"new"===d.state&&d.start(c,p,s?"controlling":"controlled"),"new"===l.state&&l.start(f));var g=n(u,h);o._transceive(a,g.codecs.length>0,!1)}}))}return o._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?o._updateSignalingState("have-local-offer"):o._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(o){var l=this;if(-1===["offer","answer"].indexOf(o.type))return Promise.reject(c("TypeError",'Unsupported type "'+o.type+'"'));if(!a("setRemoteDescription",o.type,l.signalingState)||l._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+o.type+" in state "+l.signalingState));var u={};l.remoteStreams.forEach((function(e){u[e.id]=e}));var h=[],p=i.splitSections(o.sdp),f=p.shift(),g=i.matchPrefix(f,"a=ice-lite").length>0,m=i.matchPrefix(f,"a=group:BUNDLE ").length>0;l.usingBundle=m;var v=i.matchPrefix(f,"a=ice-options:")[0];return l.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,p.forEach((function(a,c){var d=i.splitLines(a),p=i.getKind(a),v=i.isRejected(a)&&0===i.matchPrefix(a,"a=bundle-only").length,y=d[0].substr(2).split(" ")[2],S=i.getDirection(a,f),b=i.parseMsid(a),E=i.getMid(a)||i.generateIdentifier();if(v||"application"===p&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))l.transceivers[c]={mid:E,kind:p,protocol:y,rejected:!0};else{var C,_,T,R,I,L,w,M,k;!v&&l.transceivers[c]&&l.transceivers[c].rejected&&(l.transceivers[c]=l._createTransceiver(p,!0));var P,x,D=i.parseRtpParameters(a);v||(P=i.getIceParameters(a,f),(x=i.getDtlsParameters(a,f)).role="client"),w=i.parseRtpEncodingParameters(a);var N=i.parseRtcpParameters(a),A=i.matchPrefix(a,"a=end-of-candidates",f).length>0,O=i.matchPrefix(a,"a=candidate:").map((function(e){return i.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===o.type||"answer"===o.type)&&!v&&m&&c>0&&l.transceivers[c]&&(l._disposeIceAndDtlsTransports(c),l.transceivers[c].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[c].iceTransport=l.transceivers[0].iceTransport,l.transceivers[c].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[c].rtpSender&&l.transceivers[c].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[c].rtpReceiver&&l.transceivers[c].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),"offer"!==o.type||v)"answer"!==o.type||v||(_=(C=l.transceivers[c]).iceGatherer,T=C.iceTransport,R=C.dtlsTransport,I=C.rtpReceiver,L=C.sendEncodingParameters,M=C.localCapabilities,l.transceivers[c].recvEncodingParameters=w,l.transceivers[c].remoteCapabilities=D,l.transceivers[c].rtcpParameters=N,O.length&&"new"===T.state&&(!g&&!A||m&&0!==c?O.forEach((function(e){s(C.iceTransport,e)})):T.setRemoteCandidates(O)),m&&0!==c||("new"===T.state&&T.start(_,P,"controlling"),"new"===R.state&&R.start(x)),!n(C.localCapabilities,C.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,l._transceive(C,"sendrecv"===S||"recvonly"===S,"sendrecv"===S||"sendonly"===S),!I||"sendrecv"!==S&&"sendonly"!==S?delete C.rtpReceiver:(k=I.track,b?(u[b.stream]||(u[b.stream]=new e.MediaStream),r(k,u[b.stream]),h.push([k,I,u[b.stream]])):(u.default||(u.default=new e.MediaStream),r(k,u.default),h.push([k,I,u.default]))));else{(C=l.transceivers[c]||l._createTransceiver(p)).mid=E,C.iceGatherer||(C.iceGatherer=l._createIceGatherer(c,m)),O.length&&"new"===C.iceTransport.state&&(!A||m&&0!==c?O.forEach((function(e){s(C.iceTransport,e)})):C.iceTransport.setRemoteCandidates(O)),M=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(M.codecs=M.codecs.filter((function(e){return"rtx"!==e.name}))),L=C.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var U,z=!1;"sendrecv"===S||"sendonly"===S?(z=!C.rtpReceiver,I=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,p),z&&(k=I.track,b&&"-"===b.stream||(b?(u[b.stream]||(u[b.stream]=new e.MediaStream,Object.defineProperty(u[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(k,"id",{get:function(){return b.track}}),U=u[b.stream]):(u.default||(u.default=new e.MediaStream),U=u.default)),U&&(r(k,U),C.associatedRemoteMediaStreams.push(U)),h.push([k,I,U]))):C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach((function(t){var r=t.getTracks().find((function(e){return e.id===C.rtpReceiver.track.id}));r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)})),C.associatedRemoteMediaStreams=[]),C.localCapabilities=M,C.remoteCapabilities=D,C.rtpReceiver=I,C.rtcpParameters=N,C.sendEncodingParameters=L,C.recvEncodingParameters=w,l._transceive(l.transceivers[c],!1,z)}}})),void 0===l._dtlsRole&&(l._dtlsRole="offer"===o.type?"active":"passive"),l._remoteDescription={type:o.type,sdp:o.sdp},"offer"===o.type?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(u).forEach((function(t){var r=u[t];if(r.getTracks().length){if(-1===l.remoteStreams.indexOf(r)){l.remoteStreams.push(r);var i=new Event("addstream");i.stream=r,e.setTimeout((function(){l._dispatchEvent("addstream",i)}))}h.forEach((function(e){var t=e[0],i=e[1];r.id===e[2].id&&d(l,t,i,[r])}))}})),h.forEach((function(e){e[2]||d(l,e[0],e[1],[])})),e.setTimeout((function(){l&&l.transceivers&&l.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&e.iceTransport.addRemoteCandidate({})}))}),4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},l.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter((function(e){return"audio"===e.kind})).length,a=r.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(n=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)}));n>0||a>0;)n>0&&(r._createTransceiver("audio"),n--),a>0&&(r._createTransceiver("video"),a--);var d=i.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach((function(o,n){var a=o.track,s=o.kind,c=o.mid||i.generateIdentifier();o.mid=c,o.iceGatherer||(o.iceGatherer=r._createIceGatherer(n,r.usingBundle));var d=e.RTCRtpSender.getCapabilities(s);t<15019&&(d.codecs=d.codecs.filter((function(e){return"rtx"!==e.name}))),d.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),o.remoteCapabilities&&o.remoteCapabilities.codecs&&o.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),d.headerExtensions.forEach((function(e){(o.remoteCapabilities&&o.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var l=o.sendEncodingParameters||[{ssrc:1001*(2*n+1)}];a&&t>=15019&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),o.wantReceive&&(o.rtpReceiver=new e.RTCRtpReceiver(o.dtlsTransport,s)),o.localCapabilities=d,o.sendEncodingParameters=l})),"max-compat"!==r._config.bundlePolicy&&(d+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",r.transceivers.forEach((function(e,t){d+=o(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,d+="a="+i.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))}));var l=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(l)},l.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var a=i.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(a+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var s=i.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(e,i){if(!(i+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var d=n(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=o(e,d,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}}));var d=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(d)},l.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(o,n){if(!r._remoteDescription)return n(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<r.transceivers.length;d++)if(r.transceivers[d].mid===e.sdpMid){a=d;break}var l=r.transceivers[a];if(!l)return n(c("OperationError","Can not add ICE candidate"));if(l.rejected)return o();var u=Object.keys(e.candidate).length>0?i.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return o();if(u.component&&1!==u.component)return o();if((0===a||a>0&&l.iceTransport!==r.transceivers[0].iceTransport)&&!s(l.iceTransport,u))return n(c("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),(t=i.getMediaSections(r._remoteDescription.sdp))[a]+="a="+(u.type?h:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=i.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var p=0;p<r.transceivers.length&&(r.transceivers[p].rejected||(r.transceivers[p].iceTransport.addRemoteCandidate({}),(t=i.getMediaSections(r._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=i.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));p++);o()}))},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)})),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var i=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&i.push(e[t].getStats())}))})),Promise.all(i).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var i=r.prototype.getStats;r.prototype.getStats=function(){return i.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(r){var i;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(i=e[r]).type]||i.type,t.set(r,e[r])})),t}))}}}));var u=["createOffer","createAnswer"];return u.forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),l}},{sdp:17}],17:[function(e,t,r){"use strict";var i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},i.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},i.getDescription=function(e){var t=i.splitSections(e);return t&&t[0]},i.getMediaSections=function(e){var t=i.splitSections(e);return t.shift(),t},i.matchPrefix=function(e,t){return i.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},i.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":r.relatedAddress=t[i+1];break;case"rport":r.relatedPort=parseInt(t[i+1],10);break;case"tcptype":r.tcpType=t[i+1];break;case"ufrag":r.ufrag=t[i+1],r.usernameFragment=t[i+1];break;default:r[t[i]]=t[i+1]}return r},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},i.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,r={},i=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<i.length;o++)r[(t=i[o].trim().split("="))[0].trim()]=t[1];return r},i.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+r+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(r.attribute=e.substr(t+1,i-t-1),r.value=e.substr(i+1)):r.attribute=e.substr(t+1),r},i.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},i.getIceParameters=function(e,t){var r=i.splitLines(e);return{usernameFragment:(r=r.concat(i.splitLines(t))).filter((function(e){return 0===e.indexOf("a=ice-ufrag:")}))[0].substr(12),password:r.filter((function(e){return 0===e.indexOf("a=ice-pwd:")}))[0].substr(10)}},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=i.splitLines(e)[0].split(" "),o=3;o<r.length;o++){var n=r[o],a=i.matchPrefix(e,"a=rtpmap:"+n+" ")[0];if(a){var s=i.parseRtpMap(a),c=i.matchPrefix(e,"a=fmtp:"+n+" ");switch(s.parameters=c.length?i.parseFmtp(c[0]):{},s.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+n+" ").map(i.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(i.parseExtmap(e))})),t},i.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){r+=i.writeRtpMap(e),r+=i.writeFmtp(e),r+=i.writeRtcpFb(e)}));var o=0;return t.codecs.forEach((function(e){e.maxptime>o&&(o=e.maxptime)})),o>0&&(r+="a=maxptime:"+o+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){r+=i.writeExtmap(e)})),r},i.parseRtpEncodingParameters=function(e){var t,r=[],o=i.parseRtpParameters(e),n=-1!==o.fecMechanisms.indexOf("RED"),a=-1!==o.fecMechanisms.indexOf("ULPFEC"),s=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,d=i.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),o.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(i.rtx={ssrc:t}),r.push(i),n&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(i))}})),0===r.length&&c&&r.push({ssrc:c});var l=i.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=l}))),r},i.parseRtcpParameters=function(e){var t={},r=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var o=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=o.length>0,t.compound=0===o.length;var n=i.matchPrefix(e,"a=rtcp-mux");return t.mux=n.length>0,t},i.parseMsid=function(e){var t,r=i.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var o=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return o.length>0?{stream:(t=o[0].value.split(" "))[0],track:t[1]}:void 0},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t,r){var o=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||i.generateSessionId())+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,r,o){var n=i.writeRtpDescription(e.kind,t);if(n+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",e.direction?n+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?n+="a=sendrecv\r\n":e.rtpSender?n+="a=sendonly\r\n":e.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",e.rtpSender){var a="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n";n+="a="+a,n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),n},i.getDirection=function(e,t){for(var r=i.splitLines(e),o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){var t=i.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},i.parseOLine=function(e){var t=i.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},i.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=i.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=i)},{}]},{},[1])(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),o=r(1),n=function(){function e(e,t,r){this.audioBufferList=[],this.loop=!1,this.replace=!1,this.effectEndedCallBack=null,this.effectEndedListener=null,this.startTimes=0,this.startOffset=0,this.pauseTimes=0,this.resumeOffset=0,this.paused=!1,this.isMixAudio=!1,this.isMixingBuffer=!1,this.audioCurrentTimer=null,this.logger=e,this.ac=t,this.mediaEleSources=r}return e.prototype.preloadEffect=function(e,t){var r=this;this.logger.info("amu.pe.0 start preload effect");var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){if(200==i.status||304==i.status){var e=i.response;r.ac.decodeAudioData(e,(function(e){r.logger.info("amu.pe.0 effect preload success"),t("",e)}),(function(e){t(e)}))}else{var o=i.statusText;t(o)}},i.send()},e.prototype.playEffect=function(e,t,r,i,o){var n=this;!0!==this.isMixAudio?this.audioBuffer?(this.startOffset=e||0,this.loop=t||!1,this.replace=r||!1,this.effectEndedCallBack=o,this.mixEffect(this.audioBuffer,(function(){n.buffSource.loop=!!t,e?n.buffSource.start(0,e/1e3):n.buffSource.start(0),n.startTimes=Date.now(),n.effectEndedListener=n.effectEndedHandler.bind(n),n.buffSource.addEventListener("ended",n.effectEndedListener),i&&i()}))):this.logger.error("amu.pe.1 no audio buffer found"):this.logger.error("amu.pe.1 audio is mixing")},e.prototype.mixingBuffer=function(e,t){var r=this;!0!==this.isMixAudio||0!=this.audioBufferList.length||0!=this.isMixingBuffer?this.ac.decodeAudioData(e,(function(e){r.audioBufferList.push(e),1==r.audioBufferList.length&&r.playRealTimeEffect(r.audioBufferList[0]),r.isMixingBuffer=!0,t&&t()}),(function(e){r.logger.error("amu.mb.0 "+e),t&&t({code:i.errorList.kDecodeAudioDataFail.code,message:i.errorList.kDecodeAudioDataFail.message+" "+e})})):this.logger.error("amu.mb.0 audio is mixing")},e.prototype.stopMingBuffer=function(){return this.isMixingBuffer=!1,this.stopMixingAudio()},e.prototype.playRealTimeEffect=function(e){var t=this;this.mixEffect(e,(function(){t.buffSource&&t.buffSource.start(0),t.buffSource&&t.buffSource.addEventListener("ended",(function(){t.audioBufferList.shift(),t.audioBufferList.length>0&&t.isMixAudio&&t.playRealTimeEffect(t.audioBufferList[0])}))}))},e.prototype.pauseEffect=function(){this.audioBufferList.length>0?this.logger.error("amu.pe.0 real time buffer can not be paused"):(this.stopMixingAudio(),this.resumeOffset=(this.pauseTimes-this.startTimes+this.startOffset)%(1e3*this.audioBuffer.duration),this.paused=!0)},e.prototype.resumeEffect=function(){this.audioBufferList.length>0?this.logger.error("amu.pe.0 real time buffer can not be resume"):(this.playEffect(this.resumeOffset,this.loop,this.replace,void 0,this.effectEndedCallBack),this.startOffset=this.resumeOffset,this.paused=!1)},e.prototype.mixEffect=function(e,t){this.localStream?(this.gainNode=this.ac.createGain(),this.buffSource=this.ac.createBufferSource(),this.buffSource.buffer=e,this.buffSource.connect(this.gainNode),this.gainNode.connect(this.ac.destination),this.replaceTrack()&&t()):this.logger.error("amu.me.0 localStream can not be found")},e.prototype.startMixingAudio=function(e,t){if(this.replace=t||!1,this.isMixAudio)return this.logger.error("amu.sma.0 audio is mixing"),!1;if(!this.localStream)return this.logger.error("amu.sma.0 localStream can not be found"),!1;if(e.captureStream=e.captureStream||e.mozCaptureStream||e.webkitCaptureStream,this.gainNode=this.ac.createGain(),"Safari"===o.ClientUtil.getBrowser()){var r=this.mediaEleSources.find((function(t){return t.audio===e}));if(r)this.mixAudio=r.node;else{var i=this.ac.createMediaElementSource(e);this.mixAudio=i,this.mediaEleSources.push({audio:e,node:i})}e.currentTime=e.currentTime,this.audioCurrentTimer=setInterval((function(){e.currentTime=e.currentTime+.45}),6e3)}else this.mixAudio=this.ac.createMediaStreamSource(e.captureStream());return this.mixAudio.connect(this.gainNode),this.replaceTrack()},e.prototype.replaceTrack=function(){this.streamSource=this.ac.createMediaStreamSource(this.localStream),this.destination=this.ac.createMediaStreamDestination(),!this.replace&&this.streamSource.connect(this.destination),this.gainNode.connect(this.destination);var e=this.destination.stream.getAudioTracks()[0],t=this.peerConnection.getSenders().find((function(t){return t.track.kind===e.kind}));return t?(this.micTrack=this.localStream.getAudioTracks()[0],t.replaceTrack(e),this.localStream.removeTrack(this.micTrack),this.localStream.addTrack(e),this.isMixAudio=!0,!0):(this.logger.error("amu.rt.0 no sender"),!1)},e.prototype.stopMixingAudio=function(){var e=this;return this.paused?(this.logger.info("amu.sma.1 audioEffect paused"),!0):this.isMixAudio?this.localStream?(this.peerConnection.getSenders().find((function(t){return t.track.kind===e.micTrack.kind})),this.mixAudio?(this.mixAudio.disconnect(this.gainNode),this.mixAudio=null,this.audioCurrentTimer&&(clearInterval(this.audioCurrentTimer),this.audioCurrentTimer=null)):this.buffSource&&(this.buffSource.removeEventListener("ended",this.effectEndedListener),this.buffSource.stop(),this.pauseTimes=Date.now(),this.buffSource.disconnect(this.gainNode),this.buffSource=null),this.gainNode.disconnect(this.destination),this.isMixAudio=!1,this.audioBufferList=[],!0):(this.logger.error("amu.sma.1 localStream can not be found"),!1):(this.logger.warn("amu.sma.1 no mixing audio found"),!0)},e.prototype.setMixingAudioVolume=function(e){return this.gainNode?(this.gainNode.gain.value=e,!0):(this.logger.error("amu.sma.2 no mixing audio found"),!1)},e.prototype.effectEndedHandler=function(){this.stopMixingAudio(),this.effectEndedCallBack&&this.effectEndedCallBack()},e}();t.AudioMixUtil=n},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),n=r(2),a=function(){function e(e,t){this.sendDataMap={},this.sendDataList=new o.LinkedList,this.sendDataCheckOnceCount=100,this.signalSeq=0,this.pushCallback={},this.sessionInfos={},this.tryHeartbeatCount=0,this.heartbeatInterval=1e4,this.sendDataTimeout=5e3,this.sendDataDropTimeout=1e4,this.sendDataCheckTimer=null,this.sendDataCheckInterval=2e3,this.checkMessageList=["ActivateVideoPlayStreamReq","ActivateAudioPlayStreamReq"],this.tryConnectCount=1,this.tryConnectTimer=null,this.tryConnectInterval=3e3,this.state=o.ENUM_CONNECT_STATE.disconnect,this.tokenType=0,this.browser=this.getBrowserAndVersion(),this.platform=navigator.platform,this.negoInterval=25e3,this.negoTryCount=1,this.negoTryMaxCount=2,this.logger=e,this.stateCenter=t}return e.prototype.getBrowserAndVersion=function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(r[1])?{name:"IE",version:(e=/\brv[ :]+([\d\.]+)/g.exec(t)||[])[1]||""}:"Chrome"===r[1]&&null!=(e=t.match(/\bOPR|Edge\/([\d\.]+)/))?{name:"Opera",version:e[1]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/([\d+\.]+)/i))&&r.splice(1,1,e[1]),{name:r[0],version:r[1]})},e.prototype.setSessionInfo=function(e,t){this.logger.debug("zs.ssi.0 call"),this.appid=e+"",this.userid=t},e.prototype.onDisconnect=function(e){},e.prototype.onUpdateHeartBeartInterval=function(e){},e.prototype.resetConnectTimer=function(){this.logger.info("zs.rct.0 call"),clearTimeout(this.tryConnectTimer),this.tryConnectTimer=null,this.tryConnectCount=0},e.prototype.bindWebSocketHandle=function(){var e=this;this.tryHeartbeatCount=0,this.websocket.onmessage=function(t){var r=JSON.parse(t.data);e.logger.info("zs.bsh.0 signmsg= ",r.header.cmd),e.logger.info("zs.bsh.0 signmsg= "+JSON.stringify(r)),r.header.appid==e.appid&&r.header.user_id===e.userid?e.handleServerPush(r):e.logger.warn("zs.bsh.0 check header failed")},this.websocket.onclose=function(t){e.logger.info("zs.bsh.0 close msg = "+JSON.stringify(t)),e.state!=o.ENUM_CONNECT_STATE.disconnect&&(e.resetConnectTimer(),e.startConnectTimer(),e.resetCheckMessage())},this.websocket.onerror=function(t){e.logger.error("zs.bsh.0 msg = "+JSON.stringify(t))}},e.prototype.resetCheckMessage=function(){this.logger.debug("zs.rcm.0 call"),clearTimeout(this.sendDataCheckTimer),this.sendDataCheckTimer=null;for(var e=this.sendDataList.getFirst();null!=e;)this.sendDataList.remove(e),e._data.error&&e._data.error(o.SEND_MSG_RESET,e._data.seq),e=this.sendDataList.getFirst();this.sendDataMap={}},e.prototype.handleServerPush=function(e){switch(e.header.cmd){case"LoginRsp":this.handleRespondData("LoginReq",e);break;case"CreateSessionRsp":this.handleRespondData("CreateSessionReq",e),0===e.body.result&&this.addSession(e.header.session_id,e.body.session_token);break;case"MediaDescRsp":this.handleRespondData("MediaDescReq",e);break;case"CandidateInfoRsp":this.handleRespondData("CandidateInfoReq",e);break;case"CloseSessionRsp":this.handleRespondData("CloseSessionReq",e),this.removeSession(e.header.session_id);break;case"ClientHBRsp":this.handleRespondData("ClientHBReq",e);break;case"MediaDescPush":case"CandidateInfoPush":this.handlePushData(e);break;case"CloseSessionPush":this.handlePushData(e),this.removeSession(e.header.session_id);break;case"QualityReportRsp":this.handleRespondData("QualityReportReq",e);break;case"SessionResetPush":this.handlePushResetSessionData(e);break;case"StreamStatusNotifyPush":case"PublishEventPush":case"PlayEventPush":this.handlePushData(e);break;case"ActivateVideoPlayStreamRsp":this.handleRespondData("ActivateVideoPlayStreamReq",e);break;case"ActivateAudioPlayStreamRsp":this.handleRespondData("ActivateAudioPlayStreamReq",e)}},e.prototype.disconnectCallback=function(){this.connectCallback&&(this.connectCallback(-1,this.server,void 0),this.connectCallback=null);var e=this.server;this.disconnectServer(),this.onDisconnect(e)},e.prototype.updateToken=function(){var e=this;this.logger.info("zs.ut.0 call");var t={token:this.token,tokenType:this.tokenType,roomid:this.stateCenter.roomid,anchorname:this.stateCenter.anchor_info.anchor_id,sdkversion:o.PROTO_VERSION,osinfo:navigator.appVersion};if(0!=Object.keys(this.sessionInfos).length){var r=[];for(var i in this.sessionInfos){var a=parseInt(i);r.push({session_id:a,session_token:this.sessionInfos[a].token})}t.sessions=r}this.sendMessageWithCallback("LoginReq",n.getSeq(),0,t,(function(t,r,i){if(0==i.result){e.token=i.token,e.tokenType=i.tokenType;var o={report:i.report,report_interval:i.report_interval_ms};i.negoInterval&&(e.negoInterval=i.negoInterval),i.negoTryCount&&(e.negoTryCount=i.negoTryCount),i.negoTryMaxCount&&(e.negoTryMaxCount=i.negoTryMaxCount),null!=e.connectCallback&&(e.connectCallback(0,e.server,o),e.connectCallback=null),e.checkMessageTimeout()}else{var n={error:i.strError};null!=e.connectCallback&&(e.connectCallback(i.result,e.server,n),e.connectCallback=null)}}),(function(){null!=e.connectCallback&&(e.connectCallback(-1,e.server,void 0),e.connectCallback=null)}))},e.prototype.sendMessageWithCallback=function(e,t,r,i,n,a){if(this.logger.debug("zs.smwc.0 call "+e),!this.websocket||1!==this.websocket.readyState)return this.logger.error("zs.smwc.0 connect not establish"),void(a&&a(o.SEND_MSG_TIMEOUT,t));var s={header:this.getHeader(e,t,r),body:i};null==n&&(n=null),null==a&&(a=null);var c={seq:t,deleted:!1,cmd:e,time:Date.parse(new Date+""),success:n,error:a},d=this.sendDataList.push(c);this.sendDataMap[c.seq]=d;var l=JSON.stringify(s);this.websocket.send(l),this.logger.debug("zs.smwc.0 success")},e.prototype.getHeader=function(e,t,r){return this.globalHeader={version:"1.0.1",cmd:e,appid:this.appid+"",seq:t,user_id:this.userid,session_id:r},this.globalHeader},e.prototype.connectServer=function(e,t,r){var i=this;if(this.token=e,this.server=t,this.state=o.ENUM_CONNECT_STATE.connecting,this.connectCallback=r,this.websocket&&1===this.websocket.readyState)this.resetConnectTimer(),this.state=o.ENUM_CONNECT_STATE.connected;else{this.logger.info("zs.cs.0 need new websocket");try{this.websocket&&(this.logger.warn("zs.cs.0 close error websocket"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.websocket=new WebSocket(this.server),this.websocket.onopen=function(){i.resetConnectTimer(),i.logger.info("zs.cs.0 websocket open call"),i.bindWebSocketHandle(),i.updateToken(),i.state=o.ENUM_CONNECT_STATE.connected},this.websocket.onclose=function(e){i.logger.info("zs.cs.0 websocket close call  "+JSON.stringify(e))},this.websocket.onerror=function(e){i.logger.info("zs.cs.0 websocket onerror call  "+JSON.stringify(e))}}catch(e){this.logger.error("zs.cs.0 websocket error "+e)}}this.tryConnectTimer=setTimeout((function(){i.startConnectTimer(r)}),this.tryConnectInterval)},e.prototype.startConnectTimer=function(e){if(this.logger.info("zs.sct.0 call"),this.tryConnectCount>=o.MAX_TRY_CONNECT_COUNT)return this.logger.info("zs.sct.0 beyond "+this.server+"max limit"),void this.disconnectCallback();this.websocket&&1===this.websocket.readyState?this.resetConnectTimer():(this.tryConnectCount+=1,this.connectServer(this.token,this.server,e))},e.prototype.disconnectServer=function(){this.logger.debug("zs.ds.0 call"),this.connectCallback=null,this.resetCheckMessage(),this.resetConnectTimer(),this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.token="",this.sessionInfos={},this.tokenType=0,this.tryHeartbeatCount=0,this.tryConnectCount=0,this.state=o.ENUM_CONNECT_STATE.disconnect},e.prototype.isServerConnected=function(){return!(!this.websocket||1!==this.websocket.readyState)},e.prototype.createSession=function(e,t,r,i,n,a,s){void 0===n&&(n=""),this.logger.debug("zs.cs.1 call: ",i);var c="";o.PROTO_VERSION.split(".").forEach((function(e,t){return 1==e.length&&1==t?c+="0"+e:c+=e}));var d={type:t,stream_id:i,platform:this.platform,browser:this.browser.name,version:this.browser.version,app_id:this.appid,negotiate_mode:r,strAuthParam:n,sdk_version:1*c};this.sendMessageWithCallback("CreateSessionReq",e,0,d,a,s)},e.prototype.removeSession=function(e){this.logger.info("zs.rs.0 call"),this.sessionInfos[e]&&delete this.sessionInfos[e]},e.prototype.sendCloseSession=function(e,t,r,i,o){this.logger.debug("zs.scs.0 call: ",t);var n={reason:r};this.removeSession(t),this.sendMessageWithCallback("CloseSessionReq",e,t,n,i,o)},e.prototype.sendMessage=function(e,t,r,i){if(this.logger.debug("zs.sm.0 call "+e),this.websocket&&1===this.websocket.readyState){var o={header:this.getHeader(e,t,r),body:i},n=JSON.stringify(o);this.websocket.send(n),this.logger.debug("zs.sm.0 success")}else this.logger.error("zs.sm.0 connect not establish")},e.prototype.handleRespondData=function(e,t){this.logger.debug("zs.hrd.0 call");var r=this.sendDataMap[t.header.seq];if(null!=r){var i=r._data;i.cmd!==e?this.logger.error("sz.hrd.0 command is not match"):i.success&&i.success(t.header.seq,t.header.session_id,t.body),delete this.sendDataMap[t.header.seq],this.sendDataList.remove(r)}else{if("CloseSessionRsp"==t.header.cmd)return;this.logger.error("zs.hrd.0 cannot find data "+e)}},e.prototype.addSession=function(e,t){this.logger.info("zs.as.0 call"),this.sessionInfos[e]={token:t}},e.prototype.handlePushData=function(e){this.logger.debug("zs.hpd.0 call "+e.header.cmd+" session "+e.header.session_id);var t=this.pushCallback[e.header.cmd+e.header.session_id];t?t.callback&&t.callback(e.header.seq,e.header.session_id,e.body):this.logger.info("zs.hpd.0 no callbackData "+e.header.cmd+" session: "+e.header.session_id)},e.prototype.handlePushResetSessionData=function(e){this.logger.debug("zs.hprsd.0 call ");var t=[];if(0==e.body.cResetType)t=Object.keys(this.sessionInfos);else if(1==e.body.cResetType)for(var r=0;r<e.body.session_ids.length;r++)t.push(e.body.session_ids[r]);if(this.sendResetSessionAck(e.header.seq,0,0),0!=t.length)for(var i=0;i<t.length;i++){var o=this.pushCallback[e.header.cmd+t[i]];null==o?this.logger.info("zs.hprsd.0 no callbackData "+t[i]):o.callback&&o.callback(e.header.seq,t[i],e.body)}else this.logger.info("zs.hprsd.0 no session to callback")},e.prototype.sendMediaDesc=function(e,t,r,i,o,n){this.logger.debug("zs.smd.0 call: ",t);var a={type:r,sdp:i.sdp};null!=i.width&&(a.width=i.width),null!=i.height&&(a.height=i.height),null!=i.frameRate&&(a.framerate=i.frameRate),null!=i.video_min_kpbs&&(a.video_min_kpbs=i.video_min_kpbs),null!=i.video_max_kpbs&&(a.video_max_kpbs=i.video_max_kpbs),null!=i.audio_kpbs&&(a.audio_kpbs=i.audio_kpbs),null!=i.keyframe_intv&&(a.keyframe_intv=i.keyframe_intv),this.sendMessageWithCallback("MediaDescReq",e,t,a,o,n)},e.prototype.sendCandidateInfo=function(e,t,r,i,o){this.logger.debug("zs.sci.0 call: ",t);for(var n=[],a=0;a<r.length;a++){var s={candidate:r[a].candidate,sdpMid:r[a].sdpMid,sdpMLineIndex:r[a].sdpMLineIndex};n.push(s)}var c={infos:n};this.sendMessageWithCallback("CandidateInfoReq",e,t,c,i,o)},e.prototype.sendMediaDescAck=function(e,t,r){this.logger.debug("zs.smda.0 call: ",t);var i={result:r};this.sendMessage("MediaDescAck",e,t,i)},e.prototype.sendCandidateInfoAck=function(e,t,r){this.logger.debug("zs.scia.0 call: ",t);var i={result:r};this.sendMessage("CandidateInfoAck",e,t,i)},e.prototype.sendCloseSessionAck=function(e,t,r){this.logger.debug("zs.scsa.0 call: ",t);var i={result:r};this.sendMessage("CloseSessionAck",e,t,i)},e.prototype.sendResetSessionAck=function(e,t,r){this.logger.debug("zs.ssra.0 call: ",t);var i={result:r};this.sendMessage("SessionResetAck",e,t,i)},e.prototype.registerPushCallback=function(e,t,r){r&&"function"==typeof r&&(this.logger.debug("zs.rpc.0 setcallback"),this.pushCallback[e+t]={callback:r})},e.prototype.unregisterPushCallback=function(e,t){delete this.pushCallback[e+t]},e.prototype.checkMessageTimeout=function(){for(var e=this,t=this.sendDataList.getFirst(),r=Date.parse(new Date+""),i=0,n=0,a=0;!(null==t||-1==this.checkMessageList.indexOf(t._data.cmd)||t._data.time+this.sendDataTimeout>r||(delete this.sendDataMap[t._data.seq],this.sendDataList.remove(t),++n,null==t._data.error||this.sendDataDropTimeout>0&&t._data.time+this.sendDataDropTimeout<r?++a:(this.logger.warn("zs.cmt.0 error cmd = "+t._data.cmd),t._data.error&&t._data.error(o.SEND_MSG_TIMEOUT,t._data.seq)),++i>=this.sendDataCheckOnceCount));)t=this.sendDataList.getFirst();this.sendDataCheckTimer=setTimeout((function(){e.checkMessageTimeout()}),this.sendDataCheckInterval),0==n&&0==a||this.logger.debug("zs.cmt.0 call success, state: timeout=",n," drop=",a)},e.prototype.sendHeartbeat=function(){var e=this;if(this.logger.debug("zs.shb.0 call tryHeartbeatCount:"+this.tryHeartbeatCount),0!=Object.keys(this.sessionInfos).length)if(this.state===o.ENUM_CONNECT_STATE.connected){if(++this.tryHeartbeatCount>o.MAX_TRY_HEARTBEAT_COUNT)return this.logger.error("zs.shb.0 heartbeat try limit"),void this.disconnectCallback();var t=[];for(var r in this.sessionInfos)t.push(parseInt(r));var i={session_ids:t};this.sendMessageWithCallback("ClientHBReq",n.getSeq(),0,i,(function(t,r,i){e.heartbeatInterval!=i.hb_interval&&(e.heartbeatInterval=i.hb_interval,e.onUpdateHeartBeartInterval(i.hb_interval)),e.tryHeartbeatCount=0}),(function(e,t){}))}else this.logger.warn("zs.shb.0 state error");else this.logger.info("zs.shb.0 no need to heartbeat")},e.prototype.QualityReport=function(e,t,r,o,n){this.logger.debug("zs.qr.0 call");var a={streams:[i(i({},r),{aid:t})]};this.sendMessageWithCallback("QualityReportReq",e,t,a,o,n)},e.prototype.sendStreamStatus=function(e,t,r,i,o){this.logger.debug("zs.sss.0 call");var n={mic_status:i,camera_status:r};this.logger.info("zs.sss.0 stream "+(o||"")+" status "+JSON.stringify(n)),this.sendMessage("StreamStatusNotify",e,t,n)},e.prototype.ActivatePlayVideoStream=function(e,t,r,i,o){this.logger.info("zs.apvs.0 call");var n={active:r?0:1,layer:0};this.logger.info("zs.apvs.0 activate video "+JSON.stringify(n)),this.sendMessageWithCallback("ActivateVideoPlayStreamReq",e,t,n,i,o)},e.prototype.ActivatePlayAudioStream=function(e,t,r,i,o){this.logger.info("zs.apas.0 call");var n={active:r?0:1,layer:0};this.logger.info("zs.apas.0 activate audio "+JSON.stringify(n)),this.sendMessageWithCallback("ActivateAudioPlayStreamReq",e,t,n,i,o)},e.prototype.sendBroadcasterStatus=function(e,t,r){this.logger.debug("zs.sss.0 call");var i={status:r};this.sendMessage("BroadcasterStatusNotify",e,t,i)},e}();t.ZegoSignal=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(2),n=r(3),a=r(6),s=r(1),c=function(){function e(e,t,r,n,a,s,c){this.state=i.ENUM_PLAY_STATE.stop,this.candidateInfo=[],this.waitICETimer=null,this.waitingICETimeInterval=5e3,this.waitingOfferTimer=null,this.waitingOfferTimeInterval=5e3,this.waitingServerTimer=null,this.waitingServerTimerInterval=3e3,this.qualityTimer=null,this.broadcasterStatus=i.ENUM_BROADCASTER_STATUS.stop,this.playQualityList=[],this.maxQualityListCount=10,this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,audioPacketsReceived:0,videoPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0},this.reportSeq=o.getSeq(),this.streamReportSeq=o.getSeq(),this.videoSizeCallback=!1,this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.remoteStream=null,this.playStream=null,this.playOption={},this.closeSessionSignal=!1,this.stateNego=i.ENUM_PLAY_STATE_NEGO.stop,this.negoTimer=null,this.negoInterval=25e3,this.playEvent=!1,this.gotStreamStatus=!1,this.soundLevel=0,this.mic=null,this.script=null,this.logger=e,this.signal=t,this.dataReport=r,this.qualityTimeInterval=n,this.streamCenter=a,this.ac=s,this.stateCenter=c,this.dataReport.newReport(this.streamReportSeq),this.dataReport.addMsgInfo(this.streamReportSeq,{abs_time:Date.now()})}return e.prototype.startPlay=function(e,t,r){var a=this;if(this.logger.info("zp.sp.1 called ",e),this.playEvent=!1,this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),e){this.streamId=e,this.getRomoteStreamSuc=t,this.playOption=r||{},r&&r.videoCodec&&(this.playOption.videoCodec=r.videoCodec),this.sessionSeq=o.getSeq(),this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession");var s=e;1==this.streamCenter.testEnvironment&&(s="zegotest-"+this.streamCenter.appid+"-"+e),this.signal.createSession(this.sessionSeq,1,0,s,r&&r.streamParams,(function(e,t,r){var i=r.turn_server,o=i.split("?")[0]&&i.split("?")[0].slice(5),s=a.streamCenter.server.split("?"),c=s[1]&&s[1].slice(2);a.dataReport.eventEndWithMsg(a.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+o+"/"+c+"/"+a.streamId}),a.dataReport.eventEndWithMsg(a.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+o+"/"+c+"/"+a.streamId}),a.logger.info("zp.sp.1 "+a.streamId+" sessionId:"+r.session_id),a.sessionSeq==e?0!==r.result?(a.logger.error("zp.sp.1 "+a.streamId+" create error"),a.playStateUpdateError(n.playErrorList.CREATE_SESSION_ERROR)):(a.sessionId=r.session_id,a.onCreatePlaySessionSuccess(r)):a.logger.error("zp.sp.1 seq is not match.")}),(function(e,t){a.dataReport.eventEndWithMsg(a.reportSeq,"CreateSession",{error:e}),a.dataReport.eventEndWithMsg(a.streamReportSeq,"CreateSession",{error:e}),a.playStateUpdateError(n.playErrorList.SEND_SESSION_TIMEOUT)})),this.state=i.ENUM_PLAY_STATE.waitingSessionRsp,this.logger.info("zp.sp.1 "+this.streamId+" called success"),this.stateNego=i.ENUM_PLAY_STATE_NEGO.start,this.negoTimer=setTimeout((function(){a.logger.error("zp.sp.1 waiting timeout"),a.playStateUpdateError(n.playErrorList.SERVER_NEGO_TIMEOUT)}),this.negoInterval)}else this.logger.warn("zp.sp.1 streamId is null")},e.prototype.onCreatePlaySessionSuccess=function(e){var t=this;this.logger.info("zp.ops.1 "+this.streamId+" success");var r=[];if(e.turn_server){var i=e.turn_server;this.stateCenter.turnOverTcpOnly&&(i=i.replace("udp","tcp")),this.logger.info("zp ops.1 turn over tcp "+i),r.push(i)}e.stun_server&&r.push(e.stun_server);var o={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info("zp.ops.1 "+this.streamId+" username: "+e.turn_username),this.logger.info("zp.ops.1 "+this.streamId+" credential: "+e.turn_auth_key),this.peerConnection=new RTCPeerConnection(o),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)},this.peerConnection.ontrack=function(e){t.onGotRemoteStream(e.streams[0])};var a={offerToReceiveAudio:1,offerToReceiveVideo:1};this.playOption&&!1===this.playOption.video&&(a.offerToReceiveVideo=0),this.playOption&&!1===this.playOption.audio&&(a.offerToReceiveAudio=0),this.logger.info("zp.ops.1 "+this.streamId+" createOffer: "+JSON.stringify(a)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(a).then((function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.dataReport.eventEnd(t.streamReportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)}),(function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateOffer",{error:e.toString()}),t.logger.error("zp.ops.0 "+t.streamId+" create offer error "+e.toString()),t.playStateUpdateError(n.playErrorList.CREATE_OFFER_ERROR,!0)})),this.signal.registerPushCallback("MediaDescPush",this.sessionId,(function(e,r,i){t.onRecvMediaDesc(e,r,i)})),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,(function(e,r,i){t.onRecvCandidateInfo(e,r,i)})),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,r,i){t.onRecvCloseSession(e,r,i)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,r,i){t.onRecvResetSession(e,r,i)})),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,(function(e,r,i){t.gotStreamStatus=!0,t.streamStatus=i,t.playStream&&t.onRecvStreamStatus(i)})),this.signal.registerPushCallback("PlayEventPush",this.sessionId,(function(e,r,i){t.onRecvPlayEvent(e,r,i)})),this.logger.info("zp.ops.1 "+this.streamId+" call success")},e.prototype.onCreateOfferSuccess=function(e){var t=this;this.logger.info("zp.oco.1 "+this.streamId+" localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info("zp.oco.1 "+this.streamId+" localSdp2 "+e.sdp.substr(e.sdp.length/2)),e.sdp=e.sdp.replace(/sendrecv/g,"recvonly"),e.sdp=e.sdp.replace(/useinbandfec=/,"stereo=1;useinbandfec="),this.playOption.videoCodec&&(e.sdp=a.SdpUtil.getSDPByVideDecodeType(e.sdp,this.playOption.videoCodec)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),this.peerConnection.setLocalDescription(e).then((function(){t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription"),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription"),t.onSetLocalDescriptionSuccess(e)}),(function(e){t.logger.error("zp.oca.1 "+t.streamId+" set error "+e.toString()),t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription",{error:e.toString()}),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription",{error:e.toString()}),t.playStateUpdateError(n.playErrorList.SET_LOCAL_DESC_ERROR,!0)}))},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;this.logger.info("zp.osd.1 "+this.streamId+" success");var r={sdp:e.sdp};this.answerSeq=o.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.answerSeq,this.sessionId,0,r,(function(e,r,o){t.logger.info("zp.osd.1 "+t.streamId+" sendMediaDesc resp"),t.answerSeq==e&&t.sessionId==r?(t.logger.info("zp.osd.1 "+t.streamId+" send success stateNego:waiterAnswer"),t.stateNego=i.ENUM_PLAY_STATE_NEGO.waiterAnswer,t.dataReport.eventEnd(t.reportSeq,"SendMediaDesc"),t.dataReport.eventEnd(t.streamReportSeq,"SendMediaDesc"),t.waitingOfferTimer=setTimeout((function(){t.state==i.ENUM_PLAY_STATE.waitingOffserRsp&&(t.logger.error("zp.osd.1 "+t.streamId+" waiting timeout"),t.playStateUpdateError(n.playErrorList.SERVER_CANDIDATE_TIMEOUT))}),t.waitingOfferTimeInterval),t.state=i.ENUM_PLAY_STATE.waitingServerAnswer):t.logger.error("zp.osd.1 "+t.streamId+" seq or sessionId is not equal "+t.answerSeq+" "+e,0+t.sessionId+" "+r)}),(function(e,r){t.logger.error("zp.osd.1 "+t.streamId+" failed to send "+e),t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{error:e}),t.playStateUpdateError(n.playErrorList.SEND_MEDIA_DESC_TIMEOUT)})),this.state=i.ENUM_PLAY_STATE.waitingOffserRsp},e.prototype.onRecvMediaDesc=function(e,t,r){var o=this;if(this.logger.info("zp.orm.1 "+this.streamId+" received ",r),this.stateNego=i.ENUM_PLAY_STATE_NEGO.waitingCandidate,this.logger.info("zp.orm.1 "+this.streamId+" received stateNego:waitingCandidate"),this.state===i.ENUM_PLAY_STATE.waitingServerAnswer){null!=this.waitingOfferTimer&&(clearTimeout(this.waitingOfferTimer),this.waitingOfferTimer=null),this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0);var a={type:"answer",sdp:r.sdp,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription"),this.logger.info("zp.orm.1 "+this.streamId+" remoteSdp ",a.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(a)).then((function(){o.dataReport.eventEnd(o.reportSeq,"SetRemoteDescription"),o.dataReport.eventEnd(o.streamReportSeq,"SetRemoteDescription"),o.logger.info("zp.orm.1 "+o.streamId+" set success")}),(function(e){o.logger.error("zp.orm.1 "+o.streamId+" set remote error "+e.toString()),o.dataReport.eventEndWithMsg(o.reportSeq,"SetRemoteDescription",{error:e.toString()}),o.dataReport.eventEndWithMsg(o.streamReportSeq,"SetRemoteDescription",{error:e.toString()}),o.playStateUpdateError(n.playErrorList.SET_REMOTE_DESC_ERROR,!0)})),this.waitICETimer=setTimeout((function(){o.state==i.ENUM_PLAY_STATE.waitingServerICE&&(o.logger.error("zp.orm.1 "+o.streamId+" waiting server timeout"),o.playStateUpdateError(n.playErrorList.SERVER_CANDIDATE_TIMEOUT))}),this.waitingICETimeInterval),this.state=i.ENUM_PLAY_STATE.waitingServerICE,this.logger.info("zp.orm.1 "+this.streamId+" call success")}else this.logger.error("zp.orm.1 "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvCandidateInfo=function(e,t,r){var o=this;if(this.logger.info("zp.orci.1 "+this.streamId+" received "),this.state==i.ENUM_PLAY_STATE.waitingServerICE){null!=this.waitICETimer&&(clearTimeout(this.waitICETimer),this.waitICETimer=null),this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var a=0;a<r.infos.length;a++){var s={sdpMid:r.infos[a].sdpMid,sdpMLineIndex:r.infos[a].sdpMLineIndex,candidate:r.infos[a].candidate};this.logger.info("zp.orci.1 "+this.streamId+" candidate "+s.candidate),this.peerConnection.addIceCandidate(new RTCIceCandidate(s)).then((function(){o.logger.debug("zp.orci.1 "+o.streamId+" add success")}),(function(e){o.logger.error("zp.orci.1 "+o.streamId+" add error "+e.toString()),o.playStateUpdateError(n.playErrorList.SERVER_CANDIDATE_ERROR,!0)}))}this.state=i.ENUM_PLAY_STATE.connecting,this.logger.info("zp.orci.1 "+this.streamId+" call success")}else this.logger.warn("zp.orci.1 "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvPlayEvent=function(e,t,r){if(this.logger.info("zp.orpe.1 "+this.streamId+" received"),!0===this.playEvent&&0==r.event){this.logger.info("zp.orpe.1 "+this.streamId+" retry: "+this.streamId);var i=this.streamId,n=this.playOption;this.signal.sendCloseSession(o.getSeq(),this.sessionId,1),this.resetPlay(),this.startPlay(i,this.getRomoteStreamSuc,n)}else this.playEvent=!0},e.prototype.onIceCandidate=function(e){if(this.logger.info("zp.oic.1 "+this.streamId+" called"),null!=e.candidate)if(this.logger.debug("zp.oic.1 "+this.streamId+" candidate "+e.candidate.candidate),this.state<i.ENUM_PLAY_STATE.connecting||this.state==i.ENUM_PLAY_STATE.stop)this.logger.debug("zp.oic.1 "+this.streamId+" cached"),this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex});else{this.logger.debug("zp.oic.1 "+this.streamId+" send");var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};this.sendCandidateInfo([t])}},e.prototype.onConnectionStateChange=function(e){this.logger.info("zp.oisc.1 "+this.streamId+" called "+e.target.signalingState)},e.prototype.onIceConnectionStateChange=function(e){if(this.state!=i.ENUM_PLAY_STATE.stop&&null!=this.peerConnection)if(this.logger.info("zp.oisc.1 "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState){for(var t in this.dataReport.addEvent(this.reportSeq,"IceConnected"),this.dataReport.addEvent(this.streamReportSeq,"IceConnected"),this.state!=i.ENUM_PLAY_STATE.playing&&this.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.start,this.streamId,{code:0,msg:""},!0),this.state=i.ENUM_PLAY_STATE.playing,this.dataReport.eventStart(this.reportSeq,"PlayState"),this.dataReport.eventStart(this.streamReportSeq,"PlayState"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[t].publisher.state==i.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==i.ENUM_BROADCASTER_STATUS.stop){this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),this.sessionId,1),this.broadcasterStatus=i.ENUM_BROADCASTER_STATUS.start;break}this.setPlayQualityTimer(),this.stateNego=i.ENUM_PLAY_STATE_NEGO.iceConnected,this.logger.info("zp.oisc.1 "+this.streamId+" stateNego:iceConnected"),this.negoTimer&&clearTimeout(this.negoTimer)}else"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.stateNego=i.ENUM_PLAY_STATE_NEGO.iceDisconnected,this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState))},e.prototype.checkPlayConnectionFailedState=function(e){var t=null;"failed"==e?t=n.playErrorList.MEDIA_CONNECTION_FAILED:"closed"==e?t=n.playErrorList.MEDIA_CONNECTION_CLOSED:"disconnected"==e&&(t=n.playErrorList.MEDIA_CONNECTION_DISCONNECTED),null!=t&&(this.logger.info("zp.oics.1  state "+this.state+" connectionState "+e),this.playStateUpdateError(t))},e.prototype.clearPlayQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesDropped:0,framesReceived:0,audioBitrate:0}},e.prototype.resetPlay=function(){this.logger.info("zp.rp.1 "+this.streamId+" call"),this.state=i.ENUM_PLAY_STATE.stop,this.playEvent=!1,null!=this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),null!=this.waitingOfferTimer&&(clearTimeout(this.waitingOfferTimer),this.waitingOfferTimer=null),null!=this.waitICETimer&&(clearTimeout(this.waitICETimer),this.waitICETimer=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.clearPlayQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId)),this.sessionSeq=0,this.answerSeq=0,this.videoSizeCallback=!1,this.stopSoundLevel()},e.prototype.setPlayQualityTimer=function(){var e=this;if(null==this.qualityTimer){this.logger.info("zp.spq.1 "+this.streamId+" startTimer"),this.clearPlayQualityTimer();var t=!0;this.peerConnection.getStats((function(){})).catch((function(r){e.logger.info("zp.spq.1 "+e.streamId+" getStats callback not support"),t=!1})),this.qualityTimer=setInterval((function(){if(e.peerConnection){var r=[e.peerConnection.getStats(null)];t&&r.push(new Promise((function(t,r){e.peerConnection.getStats((function(e){return t(e)}),(function(e){return r(e)}))}))),Promise.all(r).then((function(t){e.getPlayStats(t[0],t[1])})).catch((function(t){e.logger.info("zp.spq.1 "+e.streamId+" getStats error "+t.toString())}))}}),this.qualityTimeInterval),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:(new Date).getTime(),audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0}}},e.prototype.getPlayStats=function(e,t){var r=this;if(null!=e){for(var i,o=document.querySelectorAll("video, audio"),n=0;n<o.length;n++)o[n].srcObject===this.playStream&&(i=o[n]);var a={audioFractionLost:0,audioPacketsLost:0,audioPacketsLostRate:0,audioBitrate:0,audioLevel:0,audioSendLevel:0,audioSamplingRate:0,audioCodec:"opus",audioQuality:0,audioFPS:0,videoQuality:0,videoPacketsLost:0,videoPacketsLostRate:0,videoBitrate:0,videoFPS:0,playData:0,nackCount:0,pliCount:0,audioJitter:0,videoFractionLost:0,videoFramesDecoded:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoFramesDropped:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,audioMuteState:this.playStream&&this.playStream.getAudioTracks().length>0&&this.playStream.getAudioTracks()[0].enabled?"0":"1",videoMuteState:this.playStream&&this.playStream.getVideoTracks().length>0&&this.playStream.getVideoTracks()[0].enabled?"0":"1",muted:i?i.muted:void 0,paused:i?i.paused:void 0,volume:i?i.volume:void 0,sinkId:i?i.sinkId:void 0},c=this.lastPlayStats.time,d=0;e.forEach((function(e){if(("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("audio"==e.mediaType||e.id.indexOf("AudioStream")>=0)){0!=c&&(a.audioBitrate=8*(e.bytesReceived-r.lastPlayStats.audioBytesReceived)/(e.timestamp-c)),a.audioBitrate<0&&(a.audioBitrate=0),a.audioJitter=e.jitter,e.packetsLost>0&&(a.audioPacketsLost=e.packetsLost),a.audioFractionLost=e.fractionLost;var t=e.packetsLost-r.lastPlayStats.audioPacketsLost;a.audioFPS=(e.packetsReceived-r.lastPlayStats.audioPacketsReceived)/(e.timestamp-c)*1e3,a.audioPacketsLostRate=t>0?t/(e.packetsReceived-r.lastPlayStats.audioPacketsReceived+t):0,r.lastPlayStats.audioBytesReceived=e.bytesReceived,e.packetsLost>0&&(r.lastPlayStats.audioPacketsLost=e.packetsLost),r.lastPlayStats.audioPacketsReceived=e.packetsReceived,r.lastPlayStats.audioTime=e.timestamp,r.lastPlayStats.time=e.timestamp,r.lastPlayStats.audioBitrate=a.audioBitrate}else("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("video"==e.mediaType||e.id.indexOf("VideoStream")>=0)?(0!=c&&(a.videoBitrate=8*(e.bytesReceived-r.lastPlayStats.videoBytesReceived)/(e.timestamp-c),a.videoFPS=1e3*(e.framesDecoded-r.lastPlayStats.framesDecoded)/(e.timestamp-c)),a.videoBitrate<0&&(a.videoBitrate=0),a.videoFPS<0&&(a.videoFPS=0),a.nackCount=e.nackCount,a.pliCount=e.pliCount,a.videoFractionLost=e.fractionLost,a.videoFramesDecoded=e.framesDecoded,e.packetsLost>0&&(a.videoPacketsLost=e.packetsLost),t=e.packetsLost-r.lastPlayStats.videoPacketsLost,a.videoPacketsLostRate=t>0?t/(e.packetsReceived-r.lastPlayStats.videoPacketsReceived+t):0,r.lastPlayStats.videoBytesReceived=e.bytesReceived,r.lastPlayStats.framesDecoded=e.framesDecoded,e.packetsLost>0&&(r.lastPlayStats.videoPacketsLost=e.packetsLost),r.lastPlayStats.videoPacketsReceived=e.packetsReceived,r.lastPlayStats.videoTime=e.timestamp,r.lastPlayStats.time=e.timestamp):"track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0)||e.frameWidth?(a.frameHeight=e.frameHeight,a.frameWidth=e.frameWidth,0!=c&&(a.videoTransferFPS=1e3*(e.framesReceived-r.lastPlayStats.framesReceived)/(e.timestamp-c),a.videoFramesDropped=e.framesDropped-r.lastPlayStats.framesDropped),a.videoTransferFPS<0&&(a.videoTransferFPS=0),a.videoFramesDropped<0&&(a.videoFramesDropped=0),r.lastPlayStats.framesReceived=e.framesReceived,r.lastPlayStats.framesDropped=e.framesDropped):"track"==e.type&&("audio"==e.kind||e.id.indexOf("audio")>=0)?(a.audioLevel=e.audioLevel,a.audioSendLevel=e.totalAudioEnergy,a.audioSamplingRate=e.totalSamplesDuration):"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(a.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(a.currentRoundTripTime=e.currentRoundTripTime,d=1e3*a.currentRoundTripTime))})),t&&t.result().forEach((function(e){"ssrc"==e.type&&e.names().indexOf("googBandwidthLimitedResolution")>=0&&(a.googBandwidthLimitedResolution=e.stat("googBandwidthLimitedResolution")),"ssrc"==e.type&&e.names().indexOf("codecImplementationName")>=0&&(a.codecImplementationName=e.stat("codecImplementationName")),"ssrc"==e.type&&"video"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(a.videoCodecName=e.stat("googCodecName")),"ssrc"==e.type&&"audio"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(a.audioCodecName=e.stat("googCodecName")),"ssrc"==e.type&&e.names().indexOf("googCpuLimitedResolution")>=0&&(a.googCpuLimitedResolution=e.stat("googCpuLimitedResolution")),"VideoBwe"==e.type&&e.names().indexOf("googAvailableSendBandwidth")>=0&&(a.googAvailableSendBandwidth=e.stat("googAvailableSendBandwidth"))})),a.audioQuality=s.ClientUtil.getNetQuality(d,a.audioPacketsLostRate),a.videoQuality=s.ClientUtil.getNetQuality(d,a.videoPacketsLostRate),this.uploadPlayQuality(a);var l={video:{videoBitrate:a.videoBitrate,videoFPS:a.videoFPS,videoTransferFPS:a.videoTransferFPS,videoFramesDecoded:a.videoFramesDecoded,videoFramesDropped:a.videoFramesDropped,videoPacketsLost:a.videoPacketsLost,videoPacketsLostRate:a.videoPacketsLostRate,videoQuality:a.videoQuality,frameHeight:a.frameHeight,frameWidth:a.frameWidth,muteState:a.videoMuteState},audio:{audioBitrate:a.audioBitrate,audioCodec:a.audioCodec,audioJitter:a.audioJitter,audioLevel:a.audioLevel,audioPacketsLost:a.audioPacketsLost,audioPacketsLostRate:a.audioPacketsLostRate,audioQuality:a.audioQuality,audioSamplingRate:a.audioSamplingRate,audioSendLevel:a.audioSendLevel,muteState:a.audioMuteState,audioFPS:a.audioFPS},nackCount:a.nackCount,pliCount:a.pliCount,totalRoundTripTime:a.totalRoundTripTime,playData:a.playData,currentRoundTripTime:a.currentRoundTripTime};void 0!==a.muted&&(l.muted=a.muted,l.paused=a.paused,l.volume=a.volume,l.sinkId=a.sinkId),void 0!==a.videoCodecName&&(l.video.googCodecName=a.videoCodecName,l.audio.googCodecName=a.audioCodecName,l.codecImplementationName=a.codecImplementationName,l.googAvailableSendBandwidth=a.googAvailableSendBandwidth),0!=c&&this.onPlayQualityUpdate(this.streamId,l)}},e.prototype.uploadPlayQuality=function(e){var t=this;if(this.qualityUpload){var r=Date.parse(new Date+"");(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="play",e.stream_id=this.streamId,e.timeStamp=r/1e3,this.logger.info("zp.upq.1 "+this.streamId+" upload"+JSON.stringify(e)),this.signal.QualityReport(o.getSeq(),this.sessionId,e,(function(e,r,i){void 0!==i.report&&(t.qualityUpload=i.report,t.qualityUploadInterval=i.report_interval_ms)}),(function(e,r){t.logger.info("zp.upq.1 "+t.streamId+" upload failed "+e)})),this.qualityUploadLastTime=r)}},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info("zp.orrs.1 "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(e,this.sessionId,0);var i=JSON.parse(JSON.stringify(n.playErrorList.SESSION_CLOSED));this.negoTimer&&clearTimeout(this.negoTimer),this.playStateUpdateError(i)}else this.logger.info("zp.orrs.1 "+this.streamId+" cannot find session")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info("zp.orcs.1 "+this.streamId+" reason: "+r.reason),this.signal.sendCloseSessionAck(e,this.sessionId,0);var i=JSON.parse(JSON.stringify(n.playErrorList.SESSION_CLOSED));i.msg+=" reason:"+r.reason+(r.err_info&&JSON.parse(r.err_info).action?"action:"+JSON.parse(r.err_info).action:""),this.negoTimer&&clearTimeout(this.negoTimer);var o=1*r.reason,a=r.err_info&&JSON.parse(r.err_info).action?JSON.parse(r.err_info).action:null,s=![4,8,10,11,12,14,24,26,27,28].includes(o)&&5!=a&&2!=a;this.playStateUpdateError(i,s)},e.prototype.onRecvStreamStatus=function(e){if(this.logger.info("zp.orss.0 "+this.streamId+" call"),this.logger.info("zp.orss.0 "+this.streamId+" status camera_status: "+e.camera_status+" mic_status: "+e.mic_status),this.cameraStatus!==e.camera_status&&this.onRemoteCameraStatusUpdate(this.streamId,this.getCameraMicStatus(e.camera_status)),this.micStatus!==e.mic_status&&this.onRemoteMicStatusUpdate(this.streamId,this.getCameraMicStatus(e.mic_status)),this.cameraStatus=e.camera_status,this.micStatus=e.mic_status,"boolean"!=typeof this.playOption.video&&"boolean"!=typeof this.playOption.audio){var t=this.playStream;0!==e.camera_status&&"Safari"!==s.ClientUtil.getBrowser()&&t.getVideoTracks().forEach((function(e){setTimeout((function(){e.enabled=!1,e.stop(),t.removeTrack(e)}),500)})),0==e.camera_status&&"Safari"!==s.ClientUtil.getBrowser()&&0==t.getVideoTracks().length&&t.addTrack(this.remoteStream.clone().getVideoTracks()[0]),this.logger.info("zp.orss.0 "+this.streamId+" call success")}else this.logger.info("zp.orss.0 "+this.streamId+" has set playType, ignore stream status")},e.prototype.onGotRemoteStream=function(e){var t=this;this.logger.info("zp.ogrs.0 "+this.streamId+" called "+e),e?(this.playStream?(this.playStream.getTracks().forEach((function(e){return t.playStream.removeTrack(e)})),e.clone().getTracks().forEach((function(e){return t.playStream.addTrack(e)}))):this.playStream=e.clone(),this.remoteStream=e,this.getRomoteStreamSuc(this.playStream),this.gotStreamStatus&&this.onRecvStreamStatus(this.streamStatus),this.dataReport.addEvent(this.reportSeq,"GetRemoteStream"),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()):this.logger.warn("zp.ogrs.0 "+this.streamId+" remote stream is empty")},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info("zp.sci.1 "+this.streamId+" called"),!(e=e.filter((function(e){return!(e.candidate.indexOf("tcp")>0)&&(!!e.candidate||void 0)})))||e.length<1?this.logger.info("zp.sci.1 "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==i.ENUM_PLAY_STATE_NEGO.iceConnected&&(this.stateNego=i.ENUM_PLAY_STATE_NEGO.sendCandidate),this.logger.info("zp.sci.1 "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(o.getSeq(),this.sessionId,e,(function(e,r,i){t.logger.debug("zp.sci.1 "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")}),(function(e,r){t.logger.error("zp.sci.1 "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.playStateUpdateError(n.playErrorList.SEND_CANDIDATE_ERROR)})))},e.prototype.shouldSendCloseSession=function(e){return this.state!=o.ENUM_PLAY_STATE_UPDATE.stop&&this.state!=i.ENUM_PLAY_STATE.waitingSessionRsp},e.prototype.playStateUpdateError=function(e,t){this.logger.info("zp.psue.1 "+this.streamId+" called ",e.code),this.streamId&&this.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.error,this.streamId,e,t),this.logger.info("zp.psue.1 "+this.streamId+" ended")},e.prototype.getCameraMicStatus=function(e){return 0==e?"OPEN":"MUTE"},e.prototype.onPlayStateUpdate=function(e,t,r,i){},e.prototype.onPlayQualityUpdate=function(e,t){},e.prototype.onRemoteCameraStatusUpdate=function(e,t){},e.prototype.onRemoteMicStatusUpdate=function(e,t){},e.prototype.stopPlay=function(){for(var e in this.logger.info("zp.sp.1.1 "+this.streamId+" called"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[e].publisher.state==i.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==i.ENUM_BROADCASTER_STATUS.start){this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),this.sessionId,0),this.broadcasterStatus=i.ENUM_BROADCASTER_STATUS.stop;break}this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(o.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PlayState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPlay"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.addMsgInfo(this.streamReportSeq,{itemtype:"RTCPlayStream"}),this.dataReport.uploadReport(this.streamReportSeq,"RTCPlayStream"),this.resetPlay()},e.prototype.onDisconnect=function(){this.logger.info("zp.od.1 "+this.streamId+" call"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.playStateUpdateError(n.playErrorList.WEBSOCKET_ERROR)},e.prototype.startSoundLevel=function(){var e=this;if(this.logger.info("zp.ssl.1 call streamID: "+this.streamId),this.remoteStream&&0!=this.remoteStream.getAudioTracks().length){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.remoteStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var r=t.inputBuffer.getChannelData(0),i=0,o=0;o<r.length;o++)i<r[o]&&(i=r[o]);e.soundLevel=100*i},this.ac.resume()}catch(e){this.logger.error("zp.ssl.1 get sound level failed "+e)}}else this.logger.info("zp.ssl.1 "+this.streamId+" remote stream no found")},e.prototype.stopSoundLevel=function(){this.logger.info("zp.ssl.1.1 call streamID: "+this.streamId),this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},e}();t.ZegoPlayWeb=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.playerList={},this.publisherList={},this.playSuccessCallBackList={},this.playErrorCallBackList={}}return e.prototype.onRemoteCameraStatusUpdate=function(e,t){},e.prototype.onRemoteMicStatusUpdate=function(e,t){},e.prototype.setSessionInfo=function(e,t,r,i){},e}();t.ZegoStreamCenter=i},function(e,t,r){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=r(7),a=r(0),s=r(2),c=r(3),d=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.logger=t,i.stateCenter=r,i}return o(t,e),t.prototype.initStream=function(e,t,r,i){this.streamCenter=e,this.isPublish=t,this.streamID=r,this.serverUrls=i},t.prototype.active=function(e,t){var r=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),!this.isPublish&&t&&(this.playStreamSuccess=t),this.stateCenter.networkState==a.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has actived, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var i=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=i>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:i}var o,n=this.serverUrls;if(this.isPublish){var s=this.streamCenter.publisherList[this.streamID].publisher;o=s.signal?s.signal.server:""}else{var c=this.streamCenter.playerList[this.streamID].player;o=c.signal?c.signal.server:""}n.forEach((function(e,t){return t<=n.indexOf(o)&&r.serverUrls.push(e)})),n.splice(0,n.indexOf(o)+1);var d=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1];return this.retryTimer=setTimeout((function(){r.retryTimer&&clearTimeout(r.retryTimer),r.retryTimer=null,r.retryActiveCount++,r.isPublish?r.streamCenter.connectPublishServer(r.streamID,d):r.streamCenter.connectPlayServer(r.streamID,r.playStreamSuccess,d)}),"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){if(e.isOverTime=!0,e.invalid(),e.isPublish){var t=e.streamCenter.publisherList[e.streamID];if(!t)return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" publish no found");t.publisher.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,c.publishErrorList.RETRY_TIMEOUT,!0)}else{var r=e.streamCenter.playerList[e.streamID];if(!r)return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" play no found");r.player.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,e.streamID,c.playErrorList.RETRY_TIMEOUT,!0)}}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.retryNextSignal=function(e){if(e.code==c.publishErrorList.SESSION_CLOSED.code||e.code==c.playErrorList.SESSION_CLOSED.code){var t=e.msg.match(/reason:(\d+)/),r=t?t[1]:"";return this.isPublish?!["26"].includes(r):!["24","26","28"].includes(r)}return!0},t}(n.TryHandler);t.TryStreamHandler=d},function(e,t,r){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=r(22),a=r(0),s=r(23),c=r(24),d=r(25),l=r(26),u=r(27),h=r(28),p=r(5),f=r(1),g=r(2),m=r(4),v=r(29),y=function(e){function t(){return e.call(this)||this}return o(t,e),t.prototype.init=function(){this.bindSocketHandler(),this.bindStreamHandler(),this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler(),this.bindStreamCenterHandler()},t.prototype.bindSocketHandler=function(){var e=this;this.socketCenter=new s.SocketCenter(this.logger,this.stateCenter),this.socketCenter.registerRouter("push_signal",(function(t){e.liveHandler.handlePushSignalMsg(t)})),this.socketCenter.getSocket=function(t){return e.getSocket(t)},this.socketCenter.handlePushKickout=function(t){e.logger.info("zb.cm.bsh.0  call "+t);var r=g.getReportSeq();e.dataReport.newReport(r,m.eventList.kZegoTaskKickout),e.dataReport.addMsgInfo(r,{user_id:e.stateCenter.idName});var i=f.ClientUtil.getKickoutError(t.body.reason);e.dataReport.addMsgInfo(r,{error:i.code,message:i.message});var o=e.stateCenter.roomTryHandler;o?(o.onactive=function(t,r){e.disconnectedHandle(r)},t.body.need_relogin&&1==t.body.need_relogin?(e.stateCenter.sessionid="",o.startMaxTime(),o.active()):(e.roomHandler.resetRoom(),i.name&&p.errorCodeList[i.name]?e.disconnectedHandle({code:p.errorCodeList[i.name].code,msg:p.errorCodeList[i.name].msg+" kickout，reason "+t.body.reason}):e.disconnectedHandle({code:p.errorCodeList.ROOM_INNER_ERROR.code,msg:i.message}))):e.logger.info("zb.cm.bsh.0 try handler no found"),e.logger.info("zb.cm.bsh.0 end")},this.socketCenter.handlePushCustomMsg=function(t){e.messageHandler.handlePushCustomMsg(t)},this.socketCenter.handlePushUserStateUpdateMsg=function(t){e.roomHandler.handlePushUserStateUpdateMsg(t)},this.socketCenter.handlePushRoomMsg=function(t){var r=g.getReportSeq();e.dataReport.newReport(r),e.dataReport.addMsgInfo(r,{room_sid:t.header.session_id});var i=[];t.body.chat_data.forEach((function(t){var o={fromUser:{userID:t.id_name,userName:t.nick_name},message:t.msg_content,sendTime:t.send_time,messageID:t.msg_id};i.push(o),e.dataReport.addMsgInfo(r,{from_msg_id:t.id_name})})),e.dataReport.uploadReport(r,m.eventList.kZegoTaskLiveRoomGetRoomMessage),e.stateCenter.actionListener("IMRecvBroadcastMessage",e.stateCenter.roomid,i)},this.socketCenter.handlePushMergeMsg=function(t){e.messageHandler.handlePushMergeMsg(t)},this.socketCenter.handlePushTransMsg=function(t){e.messageHandler.handlePushTransMsg(t)},this.socketCenter.handleBigImMsgRsp=function(t){e.messageHandler.handleBigImMsgRsp(t)}},t.prototype.bindStreamHandler=function(){var e=this;this.streamHandler=new d.StreamHandler(this.logger,this.stateCenter,this.socketCenter,this.dataReport,this.streamCenter),this.streamHandler.onStreamUpdated=function(t,r,i){var o=i.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo,urlsFLV:e.urlFlv,urlsRTMP:e.urlRtmp,urlsHLS:e.urlHls,urlsHttpsFLV:e.urlHttpsFlv,urlsHttpsHLS:e.urlHttpsHls}})),n=g.getReportSeq();if(e.dataReport.newReport(n,m.eventList.kZegoTaskLiveRoomGetStreamUpdateInfo),e.dataReport.addMsgInfo(n,{stream_update_type:1===r?"added":"deleted",update_stream:o}),e.dataReport.uploadReport(n),e.stateCenter.actionListener("roomStreamUpdate",t,f.ClientUtil.getSteamUpdateType(r),o),1===r){var a=[];o.forEach((function(e){e.extraInfo&&a.push({streamID:e.streamID,user:e.user,extraInfo:e.extraInfo})})),a.length>0&&e.stateCenter.actionListener("streamExtraInfoUpdate",t,a)}},this.streamHandler.onPublishStateUpdate=function(t,r,i){if(e.logger.info("zb.opsu ",r),"xcx"==e.stateCenter.clientType)0==t?(f.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+r,e.stateCenter.reportList)&&f.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+r,e.stateCenter.reportList)(g.REPORT_ACTION.eventEnd,"publish_state"),e.dataReport.uploadReport(e.stateCenter.reportSeqList.startPublish[r]),delete e.stateCenter.reportSeqList.startPublish[r],f.ClientUtil.unregisterCallback("kZegoTaskPublishStart"+r,e.stateCenter.reportList)):1==t&&(e.dataReport.addMsgInfo(e.stateCenter.reportSeqList.startPublish[r],{error:i.code,message:i.msg}),e.dataReport.uploadReport(e.stateCenter.reportSeqList.startPublish[r]),delete e.stateCenter.reportSeqList.startPublish[r],f.ClientUtil.unregisterCallback("kZegoTaskPublishStart"+r,e.stateCenter.reportList));else{var o=e.stateCenter.reportSeqList.startPublish[r],n=e.streamCenter.publisherList[r];n&&n.publisher&&(0==t||1==t)&&o&&(e.dataReport.eventEndWithMsgInfo(o,"PublishState",{type:t}),1==t&&e.dataReport.addMsgInfo(o,{error:i.code,message:i.msg}),e.dataReport.uploadReport(o),delete e.stateCenter.reportSeqList.startPublish[r])}i.code&&p.exterErrorCodeMap[i.code]&&(i.code=p.errorCodeList[p.exterErrorCodeMap[i.code]].code),e.stateCenter.actionListener("publisherStateUpdate",{state:f.ClientUtil.getPublisherStateType(t),streamID:r,errorCode:i.code,extendedData:i.msg})},this.streamHandler.onStreamExtraInfoUpdated=function(t,r){var i=r.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})),o=g.getReportSeq();e.dataReport.newReport(o,m.eventList.kZegoTaskLiveRoomGetStreamExtraInfo),e.dataReport.addMsgInfo(o,{update_stream:i}),e.dataReport.uploadReport(o),e.stateCenter.actionListener("streamExtraInfoUpdate",t,i)},this.streamHandler.setCDNInfo=function(t,r){e.setCDNInfo(t,r)},this.streamHandler.roomStateHandle=function(t,r){e.roomStateHandle(t,r)}},t.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler=new l.HeartBeatHandler(this.logger,this.stateCenter,this.socketCenter,this.dataReport),this.heartBeatHandler.onRecvReliableMessage=function(t){var r=t.map((function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.trans_idname,userName:e.trans_nickname},updateTime:e.trans_send_time}}));e.stateCenter.actionListener("roomExtraInfoUpdate",e.stateCenter.roomid,r),t.forEach((function(t){e.stateCenter.actionListener("recvReliableMessage",t.trans_type,t.trans_seq,t.trans_data)}))},this.heartBeatHandler.handleFetchStreamListRsp=function(t){e.streamHandler.handleFetchStreamListRsp(t)},this.heartBeatHandler.fetchUserList=function(){e.roomHandler.fetchUserList()},this.heartBeatHandler.onUpdateOnlineCount=function(t,r){e.stateCenter.actionListener("roomOnlineUserCountUpdate",t,r)},this.heartBeatHandler.updateStreamInfo=function(t,r,i,o){void 0===i&&(i=""),e.streamHandler.updateStreamInfo(t,r,i,o)},this.heartBeatHandler.hbLogout=function(t){e.logger.error("hhbr.0 "+t.msg);var r=e.stateCenter.roomTryHandler;r&&(r.onactive=function(t,r){e.disconnectedHandle(r)},t==p.errorCodeList.HEARTBEAT_TIMEOUT||t.msg.endsWith("1000002001")||t.msg.endsWith("1000000152")?(r.startMaxTime(),r.active()):(r.stopMaxTime(),r.invalid(),e.roomHandler.resetRoom(),e.disconnectedHandle(t))),e.logger.info("zc.hl.0 end")},this.heartBeatHandler.fetchReliableMessage=function(t,r){e.messageHandler.fetchReliableMessage(t,r)}},t.prototype.bindRoomHandler=function(){var e=this;this.roomHandler=new c.RoomHandler(this.logger,this.stateCenter,this.socketCenter),this.roomHandler.loginSuccessCallBack=function(t,r){var i=r.body.hearbeat_interval<a.MINIUM_HEARTBEAT_INTERVAL?a.MINIUM_HEARTBEAT_INTERVAL:r.body.hearbeat_interval;e.stateCenter.tryHeartbeatCount=0,e.stateCenter.heartbeatTimer&&clearTimeout(e.stateCenter.heartbeatTimer),e.stateCenter.loginHeartbeatTimer=setTimeout((function(){e.heartBeatHandler.start(i)}),i),e.heartBeatHandler.resetCheckMessage(),e.heartBeatHandler.startCheckMessageTimeout(),e.streamCenter.setSessionInfo(e.stateCenter.appid,e.stateCenter.idName,e.stateCenter.token,e.stateCenter.testEnvironment),r.body.anchor_info&&e.stateCenter.actionListener("getAnchorInfo",r.body.anchor_info.anchor_id_name,r.body.anchor_info.anchor_nick_name),r.body.online_count&&e.stateCenter.actionListener("roomOnlineUserCountUpdate",e.stateCenter.roomid,r.body.online_count),e.logger.info("zb.cm.brh hls userStateUpdate "+e.stateCenter.userStateUpdate),e.stateCenter.userStateUpdate&&(e.logger.info("zb.cm.brh hls fetch all new userlist"),e.roomHandler.fetchUserList(t)),e.streamHandler.handleStreamStart(t,r)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.heartBeatHandler.resetCheckMessage(),e.resetStreamCenter()},this.roomHandler.onUserStateUpdate=function(t,r,i){var o=g.getReportSeq();e.dataReport.newReport(o,m.eventList.kZegoTaskLiveRoomGetUserUpdateInfo);var n=i.filter((function(t){return t.userID!==e.stateCenter.idName}));0!==n.length&&e.stateCenter.actionListener("roomUserUpdate",t,r,n),e.dataReport.addMsgInfo(o,{user_update_type:"ADD"==r?"added":"deleted"})},this.roomHandler.onDisconnect=function(t){if(e.logger.error("zc.od.0 "+t.msg),"string"==typeof t.code&&"Error.Network"===t.code)e.dataReport.addMsgInfo(e.stateCenter.reportSeqList.relogin,{error:m.errorList.kLiveRoomDisconnect.code,message:m.errorList.kLiveRoomDisconnect.message});else if("number"==typeof t.code){var r;(r=t.code<2e9&&t.code>1e9||t.code<1e6?f.ClientUtil.decodeServerError(t.code,t.msg):m.codeErrMap[t.code])&&e.dataReport.addMsgInfo(e.stateCenter.reportSeqList.relogin,{error:r.code,message:r.message})}e.dataReport.uploadReport(e.stateCenter.reportSeqList.relogin),e.stateCenter.reportSeqList.relogin=0,f.ClientUtil.unregisterCallback("kZegoTaskReLoginRoom",e.stateCenter.reportList);var i=e.stateCenter.roomTryHandler;i?(i.onactive=function(t,r){e.disconnectedHandle(r)},i.startMaxTime(),i.active()):e.logger.info("zc.od.0 try handler no found"),e.logger.info("zc.od.0 end")},this.roomHandler.onConnecting=function(t){if(0===e.stateCenter.reportSeqList.login){var r=g.getReportSeq();e.stateCenter.reportSeqList.relogin=r,e.dataReport.newReport(r,m.eventList.kZegoTaskReLoginRoom),f.ClientUtil.logReportCallback("kZegoTaskReLoginRoom",e.dataReport,r,e.stateCenter.reportList)}e.roomStateHandle("CONNECTING",t)},this.roomHandler.fetchReliableMessage=function(t,r){e.messageHandler.fetchReliableMessage(t,r)},this.roomHandler.loginBodyData=function(){return e.loginBodyData()},this.roomHandler.roomStateHandle=function(t,r){e.roomStateHandle(t,r)}},t.prototype.bindMessageHandler=function(){var e=this;this.messageHandler=new u.MessageHandler(this.logger,this.stateCenter,this.socketCenter,this.dataReport),this.messageHandler.onRecvCustomCommand=function(t,r,i,o){var n=g.getReportSeq();e.dataReport.newReport(n),e.dataReport.uploadReport(n,m.eventList.kZegoTaskLiveRoomGetCustomCommand),e.stateCenter.actionListener("IMRecvCustomCommand",i,{userID:t,userName:r},o)},this.messageHandler.onRecvBigRoomMessage=function(t,r){var i=g.getReportSeq();e.dataReport.newReport(i);var o=[];t.forEach((function(e){var t={fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId};o.push(t)})),e.dataReport.uploadReport(i,m.eventList.kZegoTaskLiveGetRoomBigIM),e.stateCenter.actionListener("IMRecvBarrageMessage",r,o)},this.messageHandler.onRecvReliableMessage=function(t){var r=t.map((function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.trans_idname,userName:e.trans_nickname},updateTime:e.trans_send_time}}));e.stateCenter.actionListener("roomExtraInfoUpdate",e.stateCenter.roomid,r),t.forEach((function(t){e.stateCenter.actionListener("recvReliableMessage",t.trans_type,t.trans_seq,t.trans_data)}))}},t.prototype.bindLiveHandler=function(){var e=this;this.liveHandler=new h.LiveHandler(this.logger,this.stateCenter,this.socketCenter),this.liveHandler.onRecvEndJoinLiveCommand=function(t,r,i,o){e.stateCenter.actionListener("recvEndJoinLiveCommand",t,r,i,o)},this.liveHandler.onRecvInviteJoinLiveRequest=function(t,r,i,o){e.stateCenter.actionListener("RecvInviteJoinLiveRequest",t,r,i,o)},this.liveHandler.onRecvJoinLiveRequest=function(t,r,i,o){e.stateCenter.actionListener("recvJoinLiveRequest",t,r,i,o)}},t.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,i){if("xcx"==e.stateCenter.clientType)0==t?(f.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+r,e.stateCenter.reportList)&&f.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+r,e.stateCenter.reportList)("eventEnd","play_state"),e.dataReport.uploadReport(e.stateCenter.reportSeqList.startPlay[r]),delete e.stateCenter.reportSeqList.startPlay[r],f.ClientUtil.unregisterCallback("kZegoTaskPlayStart"+r,e.stateCenter.reportList)):1==t&&(e.dataReport.uploadReport(e.stateCenter.reportSeqList.startPlay[r]),delete e.stateCenter.reportSeqList.startPlay[r],f.ClientUtil.unregisterCallback("kZegoTaskPlayStart"+r,e.stateCenter.reportList)),e.stateCenter.actionListener("playerStateUpdate",{state:f.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:i&&i.code,extendedData:i&&i.msg});else{var o=e.stateCenter.reportSeqList.startPlay[r],n=e.streamCenter.playerList[r];n&&n.player&&(0==t||1==t)&&o&&(e.dataReport.eventEndWithMsgInfo(o,"PlayState",{type:t}),1==t&&i&&e.dataReport.addMsgInfo(o,{error:i.code,message:i.msg}),e.dataReport.uploadReport(o),delete e.stateCenter.reportSeqList.startPlay[r]),i.code&&p.exterErrorCodeMap[i.code]&&(i.code=p.errorCodeList[p.exterErrorCodeMap[i.code]].code),e.stateCenter.actionListener("playerStateUpdate",{state:f.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:i&&i.code,extendedData:i&&i.msg})}},this.streamCenter.onPublishStateUpdate=function(t,r,i){e.onPublishStateUpdateHandle(t,r,i)},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener("publishQualityUpdate",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener("playQualityUpdate",t,r)},this.streamCenter.onRemoteCameraStatusUpdate=function(t,r){var i=g.getReportSeq();e.dataReport.newReport(i,m.eventList.kZegoTaskRemoteCameraUpdate),e.dataReport.addMsgInfo(i,{stream_id:t,status:r}),e.dataReport.uploadReport(i),e.stateCenter.actionListener("remoteCameraStatusUpdate",t,r)},this.streamCenter.onRemoteMicStatusUpdate=function(t,r){var i=g.getReportSeq();e.dataReport.newReport(i,m.eventList.kZegoTaskRemoteMicUpdate),e.dataReport.addMsgInfo(i,{stream_id:t,status:r}),e.dataReport.uploadReport(i),e.stateCenter.actionListener("remoteMicStatusUpdate",t,r)},this.streamCenter.onSoundLevelUpdate=function(t){e.stateCenter.actionListener("soundLevelUpdate",t)}},t.prototype.setLogConfig=function(e){this.logger.info("zb.cm.clf call");var t=g.getReportSeq();if(this.dataReport.newReport(t),e.logLevel){var r=f.ClientUtil.getLogLevel(e.logLevel);r&&this.logger.setLogLevel(r),this.dataReport.addMsgInfo(t,{log_level:e.logLevel})}if(e.remoteLogLevel&&[0,1,2,3,99,100].includes(f.ClientUtil.getLogLevel(e.remoteLogLevel))&&(this.logger.setRemoteLogLevel(f.ClientUtil.getLogLevel(e.remoteLogLevel)),this.dataReport.addMsgInfo(t,{remote_log_level:e.remoteLogLevel})),"string"==typeof e.logURL&&(e.logURL.startsWith("wss://")||e.logURL.startsWith("https://")))this.logger.openLogServer(e.logURL),this.dataReport.addMsgInfo(t,{log_url:e.logURL});else if(e.logURL)return this.logger.error("zb.cm.clf log url must be a wss or https url"),!1;return this.dataReport.uploadReport(t,m.eventList.kZegoTaskSetLog),this.logger.info("zb.cm.clf call success"),!0},t.prototype.setDebugVerbose=function(e){this.logger.info("zb.cm.sd call");var t=g.getReportSeq();this.dataReport.newReport(t),"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,this.dataReport.addMsgInfo(t,{debug:e?"true":"false"})),this.dataReport.uploadReport(t,m.eventList.kZegoTaskSetDebug),this.logger.info("zb.cm.sd call success")},t.prototype.loginRoom=function(e,t,r,i){var o=this;return new Promise((function(n,s){var c=o.loginReport(n,s,t,i),d=c.interResolve,l=c.interReject;return void 0===e||""==e?(o.logger.error("zb.rh.lg roomID is empty"),void l(p.errorCodeList.ROOM_ID_NULL)):"string"!=typeof e?(o.logger.error("zb.rh.lg roomid must be string"),void l(p.errorCodeList.INPUT_PARAM,"roomID must be string")):(e.length>a.MAX_ROOM_ID_LENGTH&&(o.logger.error("zb.rh.lg room ID is too long"),l(p.errorCodeList.ROOM_ID_TOO_LONG)),f.ClientUtil.checkIllegalCharacters(e)?"string"!=typeof t||""==t?(o.logger.error("zb.rh.lg token must be string and not empty"),void l(p.errorCodeList.INPUT_PARAM)):r&&"object"==typeof r?void 0===r.userID||""==r.userID?(o.logger.error("zb.rh.lg userID is empty"),void l(p.errorCodeList.USER_ID_NULL)):"string"!=typeof r.userID?(o.logger.error("zb.rh.lg userID must be string"),void l(p.errorCodeList.INPUT_PARAM," param userID error.")):r.userID.length>a.MAX_USER_ID_LENGTH?(o.logger.error("zb.rh.lg user ID is too long"),void l(p.errorCodeList.USER_ID_TOO_LONG)):f.ClientUtil.checkIllegalCharacters(r.userID)?void 0===r.userName||""==r.userName?(o.logger.error("zb.rh.lg userName is empty"),void l(p.errorCodeList.USER_NAME_NULL)):"string"!=typeof r.userName?(o.logger.error("zb.rh.lg userName must be string"),void l(p.errorCodeList.INPUT_PARAM," userName must be string.")):r.userName.length>a.MAX_USER_NAME_LENGTH?(o.logger.error("zb.rh.lg user name is too long"),void l(p.errorCodeList.USER_NAME_TOO_LONG)):void 0===i||void 0===i.maxMemberCount||f.ClientUtil.checkInteger(i.maxMemberCount,!1)?(o.stateCenter.runState!==a.ENUM_RUN_STATE.logout&&o.roomHandler.resetRoom(),o.stateCenter.roomTryHandler||(o.stateCenter.roomTryHandler=new v.RetryRoomHandler(o.logger,o.stateCenter)),o.stateCenter.roomTryHandler.init(o.stateCenter.roomRetryTime),o.stateCenter.roomTryHandler.initRoom(o.roomHandler,e,t,r,o.stateCenter.server,o.stateCenter.serverBak,i),o.stateCenter.roomTryHandler.onactive=function(e,t){e?d(e):l(t)},void o.stateCenter.roomTryHandler.active(!0)):(o.logger.error("zb.rh.lg maxMemberCount must be integer number"),void l(p.errorCodeList.INPUT_PARAM," maxMemberCount must be integer number.")):(o.logger.error("zb.rh.lg user ID contains illegal characters"),void l(p.errorCodeList.USER_ID_INVALID_CHARACTER)):(o.logger.error("zb.rh.lg user must be exist and is an object"),void l(p.errorCodeList.INPUT_PARAM," param user error.")):(o.logger.error("zb.rh.lg roomID contains illegal characters"),void l(p.errorCodeList.ROOM_ID_INVALID_CHARACTER)))}))},t.prototype.loginReport=function(e,t,r,i){var o=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,f.ClientUtil.unregisterCallback("kZegoTaskLoginRoom",this.stateCenter.reportList));var n=g.getReportSeq();return this.stateCenter.reportSeqList.login=n,this.dataReport.newReport(n,m.eventList.kZegoTaskLoginRoom),"string"==typeof r&&this.dataReport.addMsgInfo(n,{token:r}),i&&(i.userUpdate&&"boolean"==typeof i.userUpdate&&this.dataReport.addMsgInfo(n,{user_update:i.userUpdate}),i.maxMemberCount&&"number"==typeof i.maxMemberCount&&this.dataReport.addMsgInfo(n,{max_member_count:i.maxMemberCount})),f.ClientUtil.logReportCallback("kZegoTaskLoginRoom",this.dataReport,n,this.stateCenter.reportList),{interResolve:function(t){o.dataReport.uploadReport(n),o.stateCenter.reportSeqList.login=0,f.ClientUtil.unregisterCallback("kZegoTaskLoginRoom",o.stateCenter.reportList),e(t)},interReject:function(e,r){var i,a;if(void 0===r&&(r=""),e.code<2e9&&e.code>1e9||e.code<1e6)i=f.ClientUtil.decodeServerError(e.code,e.msg),a=f.ClientUtil.getLiveRoomError(e.code);else{var s=m.codeErrMap[e.code];i=m.errorList[s]}i&&o.dataReport.addMsgInfo(n,{error:i.code,message:i.message+r}),o.dataReport.uploadReport(n),o.stateCenter.reportSeqList.login=0,f.ClientUtil.unregisterCallback("kZegoTaskLoginRoom",o.stateCenter.reportList),a&&p.errorCodeList[a]&&(e.code=p.errorCodeList[a].code),e.code&&e.msg&&""!==r?t({code:e.code,msg:e.msg+r}):t(e)}}},t.prototype.logoutRoom=function(e){var t=g.getReportSeq();if(this.dataReport.newReport(t),this.dataReport.addMsgInfo(t,{roomid:e}),void 0===e)e=this.stateCenter.roomid;else{if("string"!=typeof e||""==e)return this.logger.error("zb.rh.lg roomID must be string and not empty"),this.dataReport.addMsgInfo(t,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" param roomID error"}),void this.dataReport.uploadReport(t,m.eventList.kZegoTaskLogoutRoom);if(e!==this.stateCenter.roomid)return this.logger.error("zb.rh.lg roomID is error"),this.dataReport.addMsgInfo(t,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" roomID is error"}),void this.dataReport.uploadReport(t,m.eventList.kZegoTaskLogoutRoom)}this.roomHandler.logout(e),this.dataReport.uploadReport(t,m.eventList.kZegoTaskLogoutRoom)},t.prototype.sendCustomCommand=function(e,t,r){var i=this;return new Promise((function(o,n){var s=g.getReportSeq();i.dataReport.newReport(s,m.eventList.kZegoTaskLiveRoomSendCustomCommand),i.dataReport.addMsgInfo(s,{room_sid:i.stateCenter.sessionid});var c=f.ClientUtil.proxyRes(i.dataReport,s,o,n),d=c.interResolve,l=c.interReject;return"string"!=typeof e||""==e?(i.logger.error("zb.scc roomid must be string and not empty"),void l(p.errorCodeList.INPUT_PARAM," param roomID error")):r instanceof Array&&!r.find((function(e){return"string"!=typeof e}))?"string"!=typeof t&&"object"!=typeof t?(i.logger.error("zb.scc custom content must be a non empty string or object"),void l(p.errorCodeList.INPUT_PARAM," param command error")):"string"==typeof t&&t.length>a.MAX_MESSAGE_LENGTH?(i.logger.error("zb.sbcm command too long"),void l(p.errorCodeList.IM_CONTENT_TOO_LONG)):void i.messageHandler.sendCustomCommand(r,t,d,l):(i.logger.error("zb.scc dstMembers must be string array"),void l(p.errorCodeList.INPUT_PARAM," param toUserList error"))}))},t.prototype.sendBroadcastMessage=function(e,t){var r=this;return new Promise((function(i,o){var n=g.getReportSeq();r.dataReport.newReport(n,m.eventList.kZegoTaskLiveRoomSendRoomMessage),r.dataReport.addMsgInfo(n,{room_sid:r.stateCenter.sessionid});var s=f.ClientUtil.proxyRes(r.dataReport,n,i,o),c=s.interResolve,d=s.interReject;return"string"!=typeof e||""==e?(r.logger.error("zb.sbcm roomid must be string and not empty"),void d(p.errorCodeList.INPUT_PARAM," param roomID error")):void 0===t||""==t?(r.logger.error("zb.sbcm message is empty"),void d(p.errorCodeList.IM_CONTENT_NULL)):"string"!=typeof t?(r.logger.error("zb.sbcm message must be string"),void d(p.errorCodeList.INPUT_PARAM," param message error")):t.length>a.MAX_MESSAGE_LENGTH?(r.logger.error("zb.sbcm message too long"),void d(p.errorCodeList.IM_CONTENT_TOO_LONG)):void r.messageHandler.sendRoomMsg(r.stateCenter.msgCategory,e,t,c,d)}))},t.prototype.sendReliableMessage=function(e,t,r,i){return e&&"string"==typeof e?e.length>a.MAX_TRANS_TYPE_LENGTH?(this.logger.error("zb.cm.srm type is too long"),void i(p.errorCodeList.INPUT_PARAM,-1)):t&&"string"==typeof t?t.length>a.MAX_TRANS_DATA_LENGTH?(this.logger.error("zb.cm.srm type is too long"),void i(p.errorCodeList.INPUT_PARAM,-1)):void this.messageHandler.sendReliableMessage(e,t,r,i):(this.logger.error("zb.cm.srm data must be string"),void i(p.errorCodeList.INPUT_PARAM,-1)):(this.logger.error("zb.cm.srm type must be string"),void i(p.errorCodeList.INPUT_PARAM,-1))},t.prototype.setRoomExtraInfo=function(e,t,r){var i=this;return new Promise((function(e,o){return t&&"string"==typeof t?t.length>a.MAX_TRANS_TYPE_LENGTH?(i.logger.error("zb.cm.srxi0.0 type is too long"),void o({errorCode:p.errorCodeList.INPUT_PARAM.code})):r&&"string"==typeof r?r.length>a.MAX_TRANS_DATA_LENGTH?(i.logger.error("zb.cm.srxi0.0 type is too long"),void o({errorCode:p.errorCodeList.INPUT_PARAM.code})):void i.messageHandler.sendReliableMessage(t,r,(function(t){e({errorCode:0})}),o):(i.logger.error("zb.cm.srxi0.0 data must be string"),void o({errorCode:p.errorCodeList.INPUT_PARAM.code})):(i.logger.error("zb.cm.srxi0.0 type must be string"),void o({errorCode:p.errorCodeList.INPUT_PARAM.code}))}))},t.prototype.sendBarrageMessage=function(e,t){var r=this;return new Promise((function(i,o){var n=g.getReportSeq();r.dataReport.newReport(n,m.eventList.kZegoTaskLiveSendRoomBigIM),r.dataReport.addMsgInfo(n,{room_sid:r.stateCenter.sessionid});var s=f.ClientUtil.proxyRes(r.dataReport,n,i,o),c=s.interResolve,d=s.interReject;return"string"!=typeof e||""==e?(r.logger.error("zb.sbm roomid must be string and not empty"),void d(p.errorCodeList.INPUT_PARAM," param roomID error")):void 0===t||""==t?(r.logger.error("zb.sbm message is empty"),void d(p.errorCodeList.IM_CONTENT_NULL)):"string"!=typeof t?(r.logger.error("zb.sbm message must be string"),void d(p.errorCodeList.INPUT_PARAM," param message error")):t.length>a.MAX_MESSAGE_LENGTH?(r.logger.error("zb.sbm message too long"),void d(p.errorCodeList.IM_CONTENT_TOO_LONG)):void r.messageHandler.sendBigRoomMessage(r.stateCenter.msgCategory,e,t,c,d)}))},t.prototype.sendRelayMessage=function(e,t,r,i){this.messageHandler.sendRelayMessage(e,t,r,i)},t.prototype.requestJoinLive=function(e,t,r,i){return this.liveHandler.requestJoinLive(e,t,r,i)},t.prototype.inviteJoinLive=function(e,t,r,i){return this.liveHandler.inviteJoinLive(e,t,r,i)},t.prototype.endJoinLive=function(e,t,r){return this.liveHandler.endJoinLive(e,t,r)},t.prototype.respondJoinLive=function(e,t,r,i){return this.liveHandler.respondJoinLive(e,t,r,i)},t.prototype.startMixerTask=function(e){var t=this;return new Promise((function(r,i){e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var o=g.getReportSeq();t.dataReport.newReport(o,m.eventList.kZegoTaskMixStart),f.ClientUtil.logReportCallback("kZegoTaskMixStart"+e.taskID,t.dataReport,o,t.stateCenter.reportList),t.streamHandler.updateMixStream(e,(function(i){t.dataReport.uploadReport(o),f.ClientUtil.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),r(i)}),(function(r){var n,a,s;r.errorCode<2e9&&r.errorCode>1e9?(n=f.ClientUtil.mixServerError(r.errorCode)[0],s=m.errorList[n],a=f.ClientUtil.mixServerError(r.errorCode)[1]):r.errorCode<1e6?(s=f.ClientUtil.decodeServerError(r.errorCode,r.extendedData),a=f.ClientUtil.getLiveRoomError(r.errorCode)):(n=m.codeErrMap[r.errorCode],s=m.errorList[n]),s?t.dataReport.addMsgInfo(o,{error:s.code,message:s.message}):t.dataReport.addMsgInfo(o,{error:r.errorCode,message:r.extendedData}),t.dataReport.uploadReport(o),f.ClientUtil.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),a&&(r.errorCode=p.errorCodeList[a].code),i(r)}))}))},t.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,i){var o=g.getReportSeq();t.dataReport.newReport(o,m.eventList.kZegoTaskMixConfig),f.ClientUtil.logReportCallback("kZegoTaskMixConfig",t.dataReport,o,t.stateCenter.reportList),t.streamHandler.setMixerTaskConfig(e).then((function(e){t.dataReport.uploadReport(o),f.ClientUtil.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),r(e)})).catch((function(e){var r=m.codeErrMap[e.errorCode];r&&t.dataReport.addMsgInfo(o,{error:m.errorList[r].code,message:m.errorList[r].message}),t.dataReport.uploadReport(o),f.ClientUtil.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),i(e)}))}))},t.prototype.stopMixerTask=function(e){var t=this;return new Promise((function(r,i){var o=g.getReportSeq();return t.dataReport.newReport(o,m.eventList.kZegoTaskMixStop),e?"string"!=typeof e?(t.logger.error("zb.rh.lg taskID must be string"),t.dataReport.addMsgInfo(o,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" param taskID error"}),t.dataReport.uploadReport(o),void i({errorCode:p.errorCodeList.INPUT_PARAM.code,extendedData:""})):e.length>a.MAX_MIX_TASK_ID_LENGTH?(t.logger.error("zb.sh.ums taskID is too long"),t.dataReport.addMsgInfo(o,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" param taskID error"}),t.dataReport.uploadReport(o),void i({errorCode:p.errorCodeList.MIXER_TASK_ID_TOO_LONG.code,extendedData:""})):f.ClientUtil.checkIllegalCharacters(e)?void t.streamHandler.stopMixStream(e,(function(e){t.dataReport.uploadReport(o),r(e)}),(function(e){var r,n,s;e.errorCode<2e9&&e.errorCode>1e9?(r=f.ClientUtil.mixServerError(e.errorCode-a.MIXSTREAM_ERROR_CODE)[0],n=m.errorList[r],s=f.ClientUtil.mixServerError(e.errorCode-a.MIXSTREAM_ERROR_CODE)[1]):e.errorCode<1e6?(n=f.ClientUtil.decodeServerError(e.errorCode,e.extendedData),s=f.ClientUtil.getLiveRoomError(e.errorCode)):(r=m.codeErrMap[e.errorCode],n=m.errorList[r]),n?t.dataReport.addMsgInfo(o,{error:n.code,message:n.message}):t.dataReport.addMsgInfo(o,{error:e.errorCode,message:e.extendedData}),t.dataReport.uploadReport(o),s&&(e.errorCode=p.errorCodeList[s].code),i(e)})):(t.logger.error("zb.sh.ums taskID contains illegal characters"),t.dataReport.addMsgInfo(o,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" param taskID error"}),t.dataReport.uploadReport(o),void i({errorCode:p.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER.code,extendedData:""})):(t.logger.error("zb.sh.ums no taskID found"),t.dataReport.addMsgInfo(o,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" param taskID error"}),t.dataReport.uploadReport(o),void i({errorCode:p.errorCodeList.MIXER_TASK_ID_NULL.code,extendedData:""}))}))},t.prototype.addPublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.publishTarget({type:"addpush",streamID:e,pushUrl:t})},t.prototype.removePublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.publishTarget({type:"delpush",streamID:e,pushUrl:t})},t.prototype.clearPublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.publishTarget({type:"clearpush",streamID:e,pushUrl:t})},t.prototype.publishTarget=function(e){var t=this,r=g.getReportSeq();switch(e.type){case"addpush":this.dataReport.newReport(r,m.eventList.kZegoTaskAddPublishCdnUrl);break;case"delpush":case"clearpush":this.dataReport.newReport(r,m.eventList.kZegoTaskRemovePublishCdnUrl)}return this.dataReport.addMsgInfo(r,{stream_id:e.streamID,target_url:e.pushUrl}),new Promise((function(i,o){return e.streamID&&"string"==typeof e.streamID?e.pushUrl&&"string"==typeof e.pushUrl?t.stateCenter.publishStreamList[e.streamID]?void t.streamHandler.publishTarget(e,(function(e){t.dataReport.uploadReport(r),i(e)}),(function(e){var i=f.ClientUtil.getServerError(e.errorCode),n=f.ClientUtil.decodeServerError(i.code,i.msg);t.dataReport.addMsgInfo(r,{error:n.code,message:n.message}),t.dataReport.uploadReport(r),o(e)})):(t.logger.error("zb.pt publish stream no found"),t.dataReport.addMsgInfo(r,{error:m.errorList.kPublishStreamNotFound.code,message:m.errorList.kPublishStreamNotFound.message}),t.dataReport.uploadReport(r),void o({errorCode:p.errorCodeList.PUBLISH_NOT_PUBLISH.code,extendedData:p.errorCodeList.PUBLISH_NOT_PUBLISH.msg})):(t.logger.error("zb.pt pushurl error"),t.dataReport.addMsgInfo(r,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" pushurl error"}),t.dataReport.uploadReport(r),void o({errorCode:p.errorCodeList.INPUT_PARAM.code,extendedData:p.errorCodeList.INPUT_PARAM.msg})):(t.logger.error("zb.pt streamid error"),t.dataReport.addMsgInfo(r,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" streamid error"}),t.dataReport.uploadReport(r),void o({errorCode:p.errorCodeList.INPUT_PARAM.code,extendedData:p.errorCodeList.INPUT_PARAM.msg}))}))},t.prototype.setStreamExtraInfo=function(e,t){var r=this;return new Promise((function(i,o){var n=g.getReportSeq();return r.dataReport.newReport(n,m.eventList.kZegoTaskLiveRoomSendStreamExtraInfo),r.dataReport.addMsgInfo(n,{stream_id:e,stream_extra_info:t,room_sid:r.stateCenter.sessionid}),"string"!=typeof e||""==e?(r.logger.error("zb.ssei streamID must be string and not empty"),r.dataReport.addMsgInfo(n,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" streamID must be string and not empty"}),r.dataReport.uploadReport(n),o({errorCode:p.errorCodeList.INPUT_PARAM.code,extendedData:p.errorCodeList.INPUT_PARAM.msg}),!1):void 0===t||""===t?(r.logger.error("zb.ssei extraInfo is empty"),r.dataReport.addMsgInfo(n,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" extraInfo is empty"}),r.dataReport.uploadReport(n),o({errorCode:p.errorCodeList.PUBLISHER_EXTRA_INFO_NULL.code,extendedData:p.errorCodeList.INPUT_PARAM.msg}),!1):"string"!=typeof t||""==t?(r.logger.error("zb.ssei extraInfo must be string"),r.dataReport.addMsgInfo(n,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message+" extraInfo must be string"}),r.dataReport.uploadReport(n),o({errorCode:p.errorCodeList.INPUT_PARAM.code,extendedData:p.errorCodeList.INPUT_PARAM.msg}),!1):r.stateCenter.isLogin()?r.stateCenter.publishStreamList[e]?(r.streamHandler.updateStreamExtraInfo(e,t),r.dataReport.uploadReport(n),void i({errorCode:0,extendedData:""})):(r.logger.error("zb.ssei publish stream no found"),r.dataReport.addMsgInfo(n,{error:m.errorList.kPublishStreamNotFound.code,message:m.errorList.kPublishStreamNotFound.message}),r.dataReport.uploadReport(n),void o({errorCode:p.errorCodeList.PUBLISH_NOT_PUBLISH.code,extendedData:p.errorCodeList.PUBLISH_NOT_PUBLISH.msg})):(r.logger.error("zb.ssei not login"),r.dataReport.uploadReport(n,void 0,m.errorList.kNotLoginError),r.dataReport.addMsgInfo(n,{error:m.errorList.kNotLoginError.code,message:m.errorList.kNotLoginError.message}),o({errorCode:p.errorCodeList.NOT_LOGIN.code,extendedData:p.errorCodeList.NOT_LOGIN.msg}),!1)}))},t.prototype.bindListener=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error("zc.o.0 listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error("zc.o.0 event "+e+" no found"),!1)},t.prototype.deleteListener=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error("zc.o.1 listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},t.prototype.getVersion=function(){return a.PROTO_VERSION},t.prototype.setSdkBizVersion=function(e){"string"==typeof e&&""!==e&&(this.stateCenter.bizVersion=e)},t.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))&&(this.stateCenter.relateService=e)},t.prototype.disconnectedHandle=function(e){e?this.roomStateHandle("DISCONNECTED",e):this.roomStateHandle("CONNECTED",e)},t.prototype.roomStateHandle=function(e,t){this.stateCenter.lastRoomState=this.stateCenter.roomState,this.stateCenter.roomState=e,this.stateCenter.roomState!==this.stateCenter.lastRoomState&&this.stateCenter.actionListener("roomStateUpdate",this.stateCenter.roomid,e,t.code,t.msg||"")},t}(n.Common);t.BaseCenter=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(3),n=r(1),a=function(){function e(){}return e.prototype.getSocket=function(e){return null},e.prototype.setCDNInfo=function(e,t){},e.prototype.onPublishStateUpdateHandle=function(e,t,r){this.logger.info("zc.opsuh.0 call"),0==e?this.stateCenter.publishStreamList[t]&&(this.stateCenter.publishStreamList[t].state!=i.ENUM_PUBLISH_STREAM_STATE.tryPublish||this.stateCenter.streamList.find((function(e){return e.stream_id==t}))?(this.stateCenter.publishStreamList[t].state=i.ENUM_PUBLISH_STREAM_STATE.publishing,this.WebrtcOnPublishStateUpdateHandle(e,t,r),"xcx"==this.stateCenter.clientType&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.startPublish[t]),delete this.stateCenter.reportSeqList.startPublish[t],n.ClientUtil.unregisterCallback("kZegoTaskPublishStart"+t,this.stateCenter.reportList))):(this.stateCenter.publishStreamList[t].state=i.ENUM_PUBLISH_STREAM_STATE.update_info,this.streamHandler.updateStreamInfo(t,i.ENUM_STREAM_SUB_CMD.liveBegin,this.stateCenter.publishStreamList[t].extra_info))):this.streamHandler.onPublishStateUpdate(e,t,r)},e.prototype.WebrtcOnPublishStateUpdateHandle=function(e,t,r){},e.prototype.loginBodyData=function(){},e.prototype.resetStreamCenter=function(){if(this.stateCenter.customUrl&&(this.stateCenter.customUrl=null),this.streamCenter.reset(),!this.socketCenter.isDisConnect())for(var e in this.stateCenter.publishStreamList)if(this.stateCenter.publishStreamList[e].state==i.ENUM_PUBLISH_STREAM_STATE.publishing){this.streamHandler.updateStreamInfo(e,i.ENUM_STREAM_SUB_CMD.liveEnd,this.stateCenter.publishStreamList[e].extra_info);for(var t=0;t<this.stateCenter.streamList.length;t++)if(this.stateCenter.streamList[t].stream_id==e){this.stateCenter.streamList.splice(t--,1);break}}},e.prototype.handleFetchWebRtcUrlRsp=function(e){var t=e.body.stream_id,r=!1;if(e.body.urls&&Array.isArray(e.body.urls)&&e.body.urls.length>0?r=!0:this.logger.error("cb.cm.hfwur signal url is empty"),"push"===e.body.ptype&&this.streamCenter.publisherList[t]){if(e.header.seq!==this.streamCenter.publisherList[t].seq)return void this.logger.info("cb.cm.hfwur seq is not match, ignore "+t);if(!r)return this.streamHandler.onPublishStateUpdate(1,t,o.publishErrorList.DISPATCH_ERROR),void this.stopPublishingStream(t);this.stateCenter.publishStreamList[t]?this.streamCenter.startPublishingStream(t,e.body.urls):this.logger.error("cb.cm.hfwur no streamid to publish")}else if("pull"==e.body.ptype&&this.streamCenter.playerList[t]){if(e.header.seq!==this.streamCenter.playerList[t].seq)return void this.logger.info("cb.cm.hfwur seq is not match, ignore "+t);if(!r)return this.streamCenter.onPlayStateUpdate(1,t,o.playErrorList.DISPATCH_ERROR),void this.stopPlayingStream(t);for(var i=!1,n=0;n<this.stateCenter.streamList.length;n++)if(this.stateCenter.streamList[n].stream_id===t){i=!0;break}0==i&&this.logger.warn("cb.cm.hfwur cannot find stream, continue to play"),this.streamCenter.startPlayingStream(t,e.body.urls,this.streamCenter.playSuccessCallBackList[t])}},e}();t.Common=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(1),n=function(){function e(e,t){var r=this;this.websocket=null,this.cmdSeq=0,this.responseRouters={},this.logger=e,this.stateCenter=t,this.responseRouters={push_kickout:function(e){r.handlePushKickout(e)},push_custommsg:function(e){r.handlePushCustomMsg(e)},push_im_chat:function(e){r.handlePushRoomMsg(e)},push_userlist_update:function(e){r.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){r.handlePushMergeMsg(e)},trans:function(e){r.handleTransRsp(e)},push_trans:function(e){r.handlePushTransMsg(e)}}}return e.prototype.handlePushKickout=function(e){},e.prototype.handlePushCustomMsg=function(e){},e.prototype.handlePushRoomMsg=function(e){},e.prototype.handlePushUserStateUpdateMsg=function(e){},e.prototype.handlePushMergeMsg=function(e){},e.prototype.handlePushTransMsg=function(e){},e.prototype.handleBigImMsgRsp=function(e){},e.prototype.handleTransRsp=function(e){if(this.stateCenter.isLogin())if(0==e.body.err_code){var t=e.body.trans_type;this.stateCenter.transSeqMap[t]?(this.stateCenter.transSeqMap[t].seq=e.body.trans_seq,this.logger.debug("zb.sc.htr trans "+t+" seq "+e.body.trans_seq)):this.logger.error("zb.sc.htr cannot match send info")}else this.logger.error("zb.sc.htr trans send error "+e.body.err_code);else this.logger.error("zb.sc.htr not login")},e.prototype.handleBizChannelRspCallback=function(e,t){0===e.body.err_code?null!=t.success&&t.success(e.header.seq,e.body.cmd,e.body.rsp_body):null!=t.error&&t.error(e.body.err_code,e.header.seq,e.body.rsp_body,t.isRetry)},e.prototype.registerRouter=function(e,t){this.responseRouters[e]=t},e.prototype.getSocket=function(e){return null},e.prototype.getHeaderV2=function(e){return{Protocol:"req_v2",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:this.stateCenter.sessionid||"",room_id:this.stateCenter.roomid||"",room_session_id:this.stateCenter.roomSessionId||"",biz_version:this.stateCenter.bizVersion||""}},e.prototype.getHeader=function(e){return{Protocol:"req",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:this.stateCenter.sessionid||"",room_id:this.stateCenter.roomid||"",room_session_id:this.stateCenter.roomSessionId||"",biz_version:this.stateCenter.bizVersion||""}},e.prototype.sendMessage=function(e,t,r,o,n){if(this.logger.info("zb.sc.sm call "+e),this.isDisConnect())return this.logger.error("zb.sc.sm error "+e+" websocket is disconnected"),-1;var a="V1"===i.ROOMVERSION?this.getHeader(e):this.getHeaderV2(e),s={header:a,body:t};if(null==r&&(r=null),null==o&&(o=null),null!=r||null!=o){var c={data:s,seq:a.seq,deleted:!1,time:Date.parse(new Date+""),success:r,error:o,isRetry:n},d=this.stateCenter.sendCommandList.push(c);this.stateCenter.sendCommandMap[c.seq]=d}return this.logger.info("zb.sc.sm data ",JSON.stringify(s)),this.websocket&&this.websocket.send(JSON.stringify(s)),this.logger.debug("zb.sc.sm success"),a.seq},e.prototype.sendCustomMessage=function(e,t,r,o){if(this.logger.debug("zb.sc.scm call"),this.isDisConnect())return this.logger.error("zb.sc.scm error"),!1;var n="V1"===i.ROOMVERSION?this.getHeader(e):this.getHeaderV2(e),a={header:n,body:t},s=JSON.stringify(a);null==r&&(r=null),null==o&&(o=null);var c={data:a,seq:n.seq,deleted:!1,time:Date.parse(new Date+""),success:r,error:o},d=this.stateCenter.sendDataList.push(c);return this.stateCenter.sendDataMap[c.seq]=d,this.logger.info("zb.sc.scm data ",s),this.websocket&&this.websocket.send(s),this.logger.debug("zb.sc.scm success seq: ",n.seq),!0},e.prototype.isDisConnect=function(){return!this.websocket||1!==this.websocket.readyState},e.prototype.closeSocket=function(){this.websocket&&(this.logger.info("zb.sc.cs close websocket"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.createSocket=function(e){this.websocket=this.getSocket(e)},e.prototype.openHandler=function(e){this.websocket&&(this.websocket.onopen=e)},e.prototype.closeHandler=function(e){this.websocket&&(this.websocket.onclose=e)},e.prototype.errorHandler=function(e){this.websocket&&(this.websocket.onerror=e)},e.prototype.checkResponse=function(e){return(e.header.appid!==this.stateCenter.appid||e.header.session_id!==this.stateCenter.sessionid||e.header.user_id!==this.stateCenter.userid||e.header.room_id!==this.stateCenter.roomid||this.stateCenter.runState!==i.ENUM_RUN_STATE.login)&&(this.logger.error("zb.sc.crp check session fail."),!0)},e.prototype.responseHandler=function(){var e=this;this.websocket&&(this.websocket.onmessage=function(t){var r="string"==typeof t.data?JSON.parse(t.data):JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t.data)));e.logger.info("zb.sc.ws.rph jsonmsg= ",r.header.cmd),e.logger.info("zb.sc.ws.rph jsonmsg= ",t.data),0!==r.body.err_code&&r.body.err_message&&e.logger.error("zb.sc.ws.rph cmd="+r.header.cmd+", err_code="+r.body.err_code+", err_message="+r.body.err_message+" "),"login"!==r.header.cmd?"logout"!==r.header.cmd?e.stateCenter.isLogin()?e.checkResponse(r)?e.logger.error("zb.sc.ws.rph check session fail."):(e.handleSendCommandMsgRsp(r),e.logger.info("zb.sc.ws.rph cmd="+r.header.cmd+",function="+!!e.responseRouters[r.header.cmd]),e.responseRouters[r.header.cmd]&&e.responseRouters[r.header.cmd](r)):e.logger.warn("zb.sc.ws.rph  already logout"):e.responseRouters.logout(r,e.cmdSeq):e.responseRouters.login(r,e.cmdSeq)})},e.prototype.handleSendCommandMsgRsp=function(e){this.logger.debug("zb.sc.hscmr call");var t,r=this.stateCenter.sendCommandMap[e.header.seq];null!=r&&(t=r._data,delete this.stateCenter.sendCommandMap[e.header.seq],this.stateCenter.sendCommandList.remove(r),"login"==t.data.header.cmd?this.logger.debug("zb.sc.hscmr don't check "+t.data.header.cmd):"relay"==t.data.header.cmd?this.handleRelayRspCallback(e,t):"bigim_chat"==t.data.header.cmd?this.handleBigImRspCallback(e,t):"biz_channel"==t.data.header.cmd?this.handleBizChannelRspCallback(e,t):0===e.body.err_code?null!=t.success&&t.success(e.header.seq):null!=t.error&&t.error(o.ClientUtil.getServerError(e.body.err_code),e.header.seq)),this.logger.debug("zb.sc.hscmr call success")},e.prototype.handleRelayRspCallback=function(e,t){0===e.body.err_code?null!=t.success&&t.success(e.header.seq,e.body.relay_result):null!=t.error&&t.error(o.ClientUtil.getServerError(e.body.err_code),e.header.seq)},e.prototype.handleBigImRspCallback=function(e,t){0===e.body.err_code?null!=t.success&&this.handleBigImMsgRsp(e):null!=t.error&&t.error({errorCode:o.ClientUtil.getServerError(e.body.err_code).code,messageID:""})},e}();t.SocketCenter=n},function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<r;t++)for(var n=arguments[t],a=0,s=n.length;a<s;a++,o++)i[o]=n[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),n=r(1),a=r(3),s=r(2),c=function(){function e(e,t,r){this.logger=e,this.socketCenter=r,this.stateCenter=t}return e.prototype.setRunState=function(e){this.logger.debug("zb.rh.srs old="+this.stateCenter.runState+", new="+e),this.stateCenter.lastRunState=this.stateCenter.runState,this.stateCenter.runState=e},e.prototype.resetTryLogin=function(){this.logger.debug("zb.rh.rtl call"),clearTimeout(this.stateCenter.tryLoginTimer),this.stateCenter.tryLoginTimer=null,this.logger.debug("zb.rh.rtl call success")},e.prototype.resetBigRoomInfo=function(){this.stateCenter.transSeqMap={},this.stateCenter.realyMessageList=[],this.stateCenter.relayTimer&&(clearTimeout(this.stateCenter.relayTimer),this.stateCenter.relayTimer=null),this.stateCenter.bigImLastTimeIndex=0,this.stateCenter.bigIMmessageList=[],this.stateCenter.bigImCallbackMap={},this.stateCenter.bigImTimer&&(clearTimeout(this.stateCenter.bigImTimer),this.stateCenter.bigImTimer=null),this.stateCenter.serverTimeOffset=0,this.stateCenter.datiTimeWindow=0,this.stateCenter.bigimTimeWindow=0},e.prototype.resetRoom=function(e){var t=this;this.logger.info("zb.rh.rr call"),this.resetTryLogin(),this.resetRoomCallBack(),this.stateCenter.roomTryHandler&&(this.stateCenter.roomTryHandler.invalid(),this.stateCenter.roomTryHandler.stopMaxTime(),this.stateCenter.roomTryHandler=void 0),this.stateCenter.streamList=[],this.stateCenter.streamQuerying=!1,this.stateCenter.publishStreamList={},this.stateCenter.joinLiveCallbackMap={},this.stateCenter.joinLiveRequestMap={},this.stateCenter.streamUrlMap={},this.resetBigRoomInfo(),this.stateCenter.cmdCallback={},this.logger.info("zb.rh.rr call send logout=",this.stateCenter.sessionid),"0"!==this.stateCenter.sessionid&&this.stateCenter.runState!==o.ENUM_RUN_STATE.logout&&(this.socketCenter.registerRouter("logout",(function(e){t.handleLogoutRsp(e)})),this.socketCenter.sendMessage("logout",{reserve:0})),this.socketCenter.closeSocket(),this.setRunState(o.ENUM_RUN_STATE.logout),this.stateCenter.userid="",this.stateCenter.sessionid="",this.stateCenter.roomSessionId="",this.logger.setSessionInfo(this.stateCenter.appid,this.stateCenter.roomid,this.stateCenter.sessionid,this.stateCenter.idName,this.stateCenter.nickName,o.PROTO_VERSION),this.logger.info("zb.rh.rr call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.onDisconnect=function(e){},e.prototype.onConnecting=function(e){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.fetchReliableMessage=function(e,t){},e.prototype.login=function(e,t,r,i,s,c,d){if(this.logger.setSessionInfo(this.stateCenter.appid,t,"",i.userID,"",o.PROTO_VERSION),this.logger.info("zb.rh.lg call:",t,r),s&&(s.userUpdate&&"boolean"==typeof s.userUpdate&&(this.stateCenter.userStateUpdate=s.userUpdate),s.maxMemberCount&&"number"==typeof s.maxMemberCount&&(this.stateCenter.maxMemberCount=s.maxMemberCount)),!this.stateCenter.configOK)return this.logger.error("zb.rh.lg init sdk wrong"),void d(a.commonErrorList.INIT);this.logger.debug("zb.rh.lg begin"),this.stateCenter.runState!==o.ENUM_RUN_STATE.trylogin&&this.setRunState(o.ENUM_RUN_STATE.trylogin),this.stateCenter.roomid=t,this.stateCenter.token=r,this.stateCenter.third_token=r,this.stateCenter.idName=i.userID,this.stateCenter.nickName=i.userName,n.ClientUtil.registerCallback("login",{success:c,error:d},this.stateCenter.callbackList),this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(e),this.logger.info("zb.rh.lg call success")},e.prototype.loginBodyData=function(){},e.prototype.tryLogin=function(e){var t=this;if(this.logger.debug("zb.rh.tl call"),this.stateCenter.runState===o.ENUM_RUN_STATE.trylogin){this.stateCenter.startConnceTime=(new Date).getTime();var r=0!==this.stateCenter.reportSeqList.login?"kZegoTaskLoginRoom":"kZegoTaskReLoginRoom";if(this.socketCenter.isDisConnect()){this.logger.debug("zb.rh.tl need new websocket");try{this.socketCenter.closeSocket(),this.logger.debug("zb.rh.tl new websocket"),n.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&(this.stateCenter.tryLoginCount>1&&n.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(s.REPORT_ACTION.eventEnd,"create_socket"),n.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(s.REPORT_ACTION.eventStart,"create_socket"),n.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(s.REPORT_ACTION.addEventMsg,"create_socket","server",e)),this.socketCenter.createSocket(e),this.socketCenter.registerRouter("login",(function(e,r){t.handleLoginRsp(e,r)})),this.socketCenter.closeHandler((function(e){t.socketCenter.closeSocket(),t.closeHandler(e)})),this.socketCenter.openHandler((function(){t.openHandler()})),this.socketCenter.errorHandler((function(e){t.logger.error("zb.rh.tl "+e),t.socketCenter.closeSocket(),t.closeHandler(e)}))}catch(e){this.logger.error("zb.rh.tl websocket err:"+e)}}else{var i=this.loginBodyData();this.logger.info("zb.rh.tl use current websocket and sent login"),n.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&n.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(s.REPORT_ACTION.eventStart,"liveroom_login"),this.socketCenter.sendMessage("login",i)}this.stateCenter.tryLoginTimer=setTimeout((function(){t.logger.warn("zb.rh.tl over time no response, login timeout"),n.ClientUtil.actionErrorCallback("login",t.stateCenter.callbackList)(o.sdkErrorList.LOGIN_TIMEOUT)}),this.stateCenter.tryLoginInterval),this.logger.info("zb.rh.tl call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.handleLoginRsp=function(e,t){this.logger.debug("zb.rh.hlr call");var r=0!==this.stateCenter.reportSeqList.login?"kZegoTaskLoginRoom":"kZegoTaskReLoginRoom";if(n.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&n.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(s.REPORT_ACTION.eventEndWithMsgInfo,"liveroom_login"),this.stateCenter.runState===o.ENUM_RUN_STATE.trylogin){if(e.header.seq===t)return 0!==e.body.err_code?(this.handleLoginFail(e),void this.logger.error("zb.rh.hlr server error=",e.body.err_code)):(this.handleLoginSuccess(e),void this.logger.info("zb.rh.hlr call success."));this.logger.error("zb.rh.hlr in wrong seq, local=",t,",recv=",e.header.seq)}else this.logger.error("zb.rh.hlr state error")},e.prototype.handleLoginFail=function(e){this.logger.debug("zb.rh.hlf call"),this.resetTryLogin();var t=n.ClientUtil.getServerError(e.body.err_code);n.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(t,!0),this.logger.debug("zb.rh.hlf call success")},e.prototype.handleLoginSuccess=function(e){var t=this;this.stateCenter.startloginSucTime=(new Date).getTime(),this.logger.info("zb.rh.hls call");var r={},i=this.stateCenter.lastRunState;if(this.setRunState(o.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_id,this.stateCenter.sessionid=e.body.session_id,this.stateCenter.roomSessionId=e.body.room_session_id,this.stateCenter.anchor_info=e.body.anchor_info||this.stateCenter.anchor_info,this.stateCenter.userListInterval=e.body.userlist_interval||this.stateCenter.userListInterval,this.stateCenter.userListMergeInterval=e.body.userlist_merge_timeout||this.stateCenter.userListMergeInterval,this.logger.setSessionInfo(this.stateCenter.appid,this.stateCenter.roomid,this.stateCenter.sessionid,this.stateCenter.idName,this.stateCenter.nickName,o.PROTO_VERSION),e.body.trans_seqs)for(var a=0;a<e.body.trans_seqs.length;a++){var c=e.body.trans_seqs[a].trans_channel,d=e.body.trans_seqs[a].trans_seq_array;(d=d.filter((function(e){var r=e.trans_type,i=e.trans_seq;return!t.stateCenter.transSeqMap[r]||t.stateCenter.transSeqMap[r].seq<i}))).length>0&&this.fetchReliableMessage(c,d)}if(e.body.config_info&&(this.logger.setRemoteLogLevel(e.body.config_info.log_level),r.log_level=e.body.config_info.log_level,""!=e.body.config_info.log_url&&(this.logger.openLogServer(e.body.config_info.log_url),r.log_url=e.body.config_info.log_url)),null!=e.body.ret_timestamp&&"string"==typeof e.body.ret_timestamp){var l=parseFloat(e.body.ret_timestamp);this.stateCenter.serverTimeOffset=0==l?0:e.body.ret_timestamp-(new Date).getTime()}e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.stateCenter.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.stateCenter.datiTimeWindow=e.body.dati_time_window),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,r.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var u=0!==this.stateCenter.reportSeqList.login?"kZegoTaskLoginRoom":"kZegoTaskReLoginRoom";n.ClientUtil.actionSuccessCallback(u,this.stateCenter.reportList)&&n.ClientUtil.actionSuccessCallback(u,this.stateCenter.reportList)(s.REPORT_ACTION.addEventMsg,"liveroom_login","respond_info",r),this.resetTryLogin(),this.loginSuccessCallBack(i,e)},e.prototype.openHandler=function(){this.logger.info("zb.rh.oh websocket.onpen call");var e=0!==this.stateCenter.reportSeqList.login?"kZegoTaskLoginRoom":"kZegoTaskReLoginRoom";n.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)&&n.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)(s.REPORT_ACTION.eventEndWithMsgInfo,"create_socket",{try_cnt:this.stateCenter.tryLoginCount}),this.socketCenter.responseHandler();var t=this.loginBodyData();this.logger.info("zb.rh.oh websocket.onpen send login"),this.stateCenter.startloginTime=(new Date).getTime(),n.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)&&n.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)(s.REPORT_ACTION.eventStart,"liveroom_login"),this.socketCenter.sendMessage("login",t),this.logger.debug("zb.rh.oh websocket.onpen call success")},e.prototype.closeHandler=function(e){this.logger.error("zb.rh.ws.oc room websocket close "+JSON.stringify(e.code)),this.stateCenter.runState!==o.ENUM_RUN_STATE.logout?this.stateCenter.runState===o.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),n.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(1006==e.code?o.sdkErrorList.LOGIN_TIMEOUT:e)):this.stateCenter.runState===o.ENUM_RUN_STATE.login&&(this.logger.info("zb.rh.ws.oc is called because of network broken"),this.resetTryLogin(),this.onDisconnect(o.sdkErrorList.LOGIN_DISCONNECT)):this.logger.info("zb.rh.ws.oc onclose logout flow call websocket.close")},e.prototype.logout=function(e){this.logger.info("zb.rh.lo call"),this.stateCenter.runState!==o.ENUM_RUN_STATE.logout?(this.resetRoom(e),this.roomStateHandle("DISCONNECTED",{code:0,msg:""}),this.logger.info("zb.rh.lo call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.fetchUserList=function(e){this.logger.debug("zb.rh.ful call"),this.stateCenter.userQuerying?this.logger.warn("zb.rh.ful is already querying"):(this.stateCenter.userQuerying=!0,this.stateCenter.userTempList=[],"V1"===o.ROOMVERSION?this.fetchUserListWithPage(0,e||0):this.fetchUserListWithPageV2(0),this.logger.info("zb.rh.ful the first time call"))},e.prototype.fetchUserListWithPageV2=function(e){var t=this;this.logger.debug("zb.rh.fulwp call"),this.socketCenter.registerRouter("user_list_v2",(function(r){t.handleFetchUserListRspV2(e,r)})),this.socketCenter.sendMessage("user_list_v2",{marker:0===e?"":e+"",mode:0,limit:100}),this.logger.info("zb.rh.fulwp call success")},e.prototype.fetchUserListWithPage=function(e,t){var r=this;this.logger.debug("zb.rh.fulwp call"),this.socketCenter.registerRouter("user_list",(function(e){r.handleFetchUserListRsp(e,t)})),this.socketCenter.sendMessage("user_list",{user_index:e,sort_type:0}),this.logger.info("zb.rh.fulwp call success")},e.prototype.handleFetchUserListRspV2=function(e,t){if(this.logger.debug("zb.rh.hfulr call"),0!=t.body.err_code)return this.stateCenter.userQuerying=!1,this.stateCenter.lastUserQueryTime=Date.now()+this.stateCenter.userListInterval,void this.logger.info("zb.rh.hfulr fetch error "+t.body.err_code);if(this.stateCenter.userStateUpdate){if(this.stateCenter.userTempList=i(this.stateCenter.userTempList,t.body.user_baseinfos),e!=t.body.marker)return this.logger.warn("zb.rh.hfulr fetch another page"),void this.fetchUserListWithPageV2(e+1);this.stateCenter.userSeq=t.body.server_user_seq,this.logger.info("zb.rh.hfulr set user Seq "+this.stateCenter.userSeq);for(var r=[],o=0;o<this.stateCenter.userTempList.length;o++){var n={userId:this.stateCenter.userTempList[o].id_name,userName:this.stateCenter.userTempList[o].nick_name};r.push(n)}this.stateCenter.userQuerying=!1,this.stateCenter.lastUserQueryTime=Date.now()+this.stateCenter.userListInterval,this.stateCenter.userTempList=[],this.logger.info("zb.rh.hfulr call success user_list "+r+" count "+r.length)}},e.prototype.handleFetchUserListRsp=function(e,t){var r=this;if(this.logger.debug("zb.rh.hfulr call"),0!=e.body.err_code)return this.stateCenter.userQuerying=!1,this.stateCenter.lastUserQueryTime=Date.now()+this.stateCenter.userListInterval,void this.logger.info("zb.rh.hfulr fetch error "+e.body.err_code);if(this.stateCenter.userStateUpdate){this.stateCenter.userTempList=i(this.stateCenter.userTempList,e.body.user_baseinfos);var a=e.body.ret_user_index;if(a!=e.body.server_user_index)return this.logger.warn("zb.rh.hfulr fetch another page"),void this.fetchUserListWithPage(a+1,t);this.stateCenter.userSeq=e.body.server_user_seq,this.logger.info("zb.rh.hfulr set user Seq "+this.stateCenter.userSeq);for(var s=[],c=0;c<this.stateCenter.userTempList.length;c++){var d={userID:this.stateCenter.userTempList[c].id_name,userName:this.stateCenter.userTempList[c].nick_name};s.push(d)}t==o.ENUM_RUN_STATE.login?(n.ClientUtil.mergeUserList(this.logger,this.stateCenter.userList,s,(function(e,t){0!==e.length&&r.onUserStateUpdate(r.stateCenter.roomid,"ADD",e),0!==t.length&&r.onUserStateUpdate(r.stateCenter.roomid,"DELETE",t)})),this.stateCenter.userList=s):(this.stateCenter.userList=s,0!==s.length&&this.onUserStateUpdate(this.stateCenter.roomid,"ADD",s)),this.stateCenter.userQuerying=!1,this.stateCenter.lastUserQueryTime=Date.now()+this.stateCenter.userListInterval,this.stateCenter.userTempList=[],this.logger.info("zb.rh.hfulr call success user_list "+s+" count "+s.length)}},e.prototype.handleLogoutRsp=function(e){this.logger.debug("zb.rh.hlor result=",e.body.err_code)},e.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info("zb.rh.hpus call"),this.stateCenter.isLogin())if(this.stateCenter.userStateUpdate)if(this.stateCenter.userSeq!==e.body.user_list_seq)if(this.stateCenter.userSeq+e.body.user_actions.length===e.body.user_list_seq){this.stateCenter.userSeq=e.body.user_list_seq,this.logger.debug("zb.rh.hpus push userSeq "+this.stateCenter.userSeq);for(var t=[],r=0;r<e.body.user_actions.length;r++){var i={action:e.body.user_actions[r].Action,idName:e.body.user_actions[r].IdName,nickName:e.body.user_actions[r].NickName,loginTime:e.body.user_actions[r].LoginTime};t.push(i)}var o=[],n=[];t.forEach((function(e){1==e.action?o.push({userID:e.idName,userName:e.nickName}):2==e.action&&n.push({userID:e.idName,userName:e.nickName})})),this.stateCenter.userList=this.stateCenter.userList.concat(o).filter((function(e){return!n.some((function(t){return t.userID==e.userID}))})),0!==o.length&&this.onUserStateUpdate(e.body.room_id,"ADD",o),0!==n.length&&this.onUserStateUpdate(e.body.room_id,"DELETE",n),this.logger.info("zb.rh.hpus call success")}else this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else this.logger.warn("zb.rh.hpus user_list_seq is the same with local seq");else this.logger.info("zb.rh.hpus no userStateUpdate flag");else this.logger.error("zb.rh.hpus not login")},e.prototype.onUserStateUpdate=function(e,t,r){},e.prototype.roomStateHandle=function(e,t){},e.prototype.mergeUserByUserSeq=function(e,t){var r=this;this.stateCenter.userSeqMergeMap||(this.logger.warn("zb.rh.hpus new merge userlist "+this.stateCenter.userSeq+" server "+e),this.stateCenter.userSeqMergeMap={},this.stateCenter.userSeqMergeTimer&&clearTimeout(this.stateCenter.userSeqMergeTimer),this.stateCenter.userSeqMergeTimer=setTimeout((function(){var e=Object.keys(r.stateCenter.userSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));if(e[e.length-1]-e[0]+1===e.length)r.mergeUser(e);else{r.stateCenter.userSeqMergeMap=null;var t=r.stateCenter.lastUserQueryTime-Date.now();r.logger.info("zb.rh.hpus fetch merge userlist "+r.stateCenter.userSeq+" userSeqList "+e.join(",")+" wait "+t),t>0?(r.stateCenter.userQueryTimer&&clearTimeout(r.stateCenter.userQueryTimer),r.stateCenter.userQueryTimer=setTimeout((function(){r.fetchUserList()}),t)):r.fetchUserList()}}),this.stateCenter.userListMergeInterval)),this.logger.warn("zb.rh.hpus merge userlist "+this.stateCenter.userSeq+" server "+e+" userlist "+t.length),this.stateCenter.userSeqMergeMap[e]=t},e.prototype.mergeUser=function(e){var t=this;this.logger.info("zb.rh.hpus merge userlist "+this.stateCenter.userSeq+" userSeqList "+e.join(",")),this.stateCenter.userSeq=e[e.length-1];var r={};e.forEach((function(e){t.stateCenter.userSeqMergeMap[e].forEach((function(e){r[e.IdName]=e}))})),this.stateCenter.userSeqMergeMap=null;var i=Object.values(r).map((function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):""}}));i.sort((function(e,t){return e.loginTime.localeCompare(t.loginTime)}));var o=[],n=[];i.forEach((function(e){1==e.action?o.push({userID:e.idName,userName:e.nickName}):2==e.action&&n.push({userID:e.idName,userName:e.nickName})})),this.stateCenter.userList=this.stateCenter.userList.concat(o).filter((function(e){return!n.some((function(t){return t.userID==e.userID}))})),0!==o.length&&this.onUserStateUpdate(this.stateCenter.roomid,"ADD",o),0!==n.length&&this.onUserStateUpdate(this.stateCenter.roomid,"DELETE",n)},e}();t.RoomHandler=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(1),n=r(2),a=r(5),s=function(){function e(e,t,r,i,o){this.logger=e,this.socketCenter=r,this.stateCenter=t,this.dataReport=i,this.streamCenter=o}return e.prototype.setCDNInfo=function(e,t){},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e,t){var r=this;if(this.stateCenter.streamQuerying=!1,this.socketCenter.registerRouter("stream",(function(e){r.handleStreamUpdateRsp(e)})),this.socketCenter.registerRouter("push_stream_update",(function(e){r.handlePushStreamUpdateMsg(e)})),this.stateCenter.reportSeqList.relogin&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,o.ClientUtil.unregisterCallback("kZegoTaskReLoginRoom",this.stateCenter.reportList)),this.roomStateHandle("CONNECTED",{code:0,msg:""}),e==i.ENUM_RUN_STATE.login)this.logger.info("zb.sh.hss recover from disconnect so call streamupdate"),this.handleFullUpdateStream(t.body.stream_seq,t.body.stream_info||[]),this.handleReconnectStream(t.body.stream_info),o.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)(!0);else{this.logger.info("zb.sh.hss success callback user"),this.stateCenter.streamList=t.body.stream_info||[],this.stateCenter.streamSeq=t.body.stream_seq;for(var n=0;n<this.stateCenter.streamList.length;n++)this.stateCenter.streamList[n].anchor_id_name==this.stateCenter.idName&&(this.updateStreamInfo(this.stateCenter.streamList[n].stream_id,i.ENUM_STREAM_SUB_CMD.liveEnd),this.stateCenter.streamList.splice(n--,1));var a=this.makeCallbackStreamList(this.stateCenter.streamList);o.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)&&o.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)(!0),a.length>0&&this.onStreamUpdated(this.stateCenter.roomid,i.ENUM_STREAM_UPDATE_TYPE.added,a)}},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.updateStreamInfo=function(e,t,r,i){var o=this;void 0===r&&(r=""),this.logger.debug("zb.sh.usi call");var n={stream_id:e,extra_info:r},a={sub_cmd:t,stream_msg:JSON.stringify(n)};this.socketCenter.registerRouter("stream",(function(e){o.handleStreamUpdateRsp(e)})),this.socketCenter.sendMessage("stream",a,void 0,i),this.logger.info("zb.sh.usi call success cmd "+t)},e.prototype.handleStreamUpdateRsp=function(e){if(this.stateCenter.isLogin())if(0==e.body.err_code){this.logger.info("zb.sh.hsur stream seq "+this.stateCenter.streamSeq+" server seq "+e.body.stream_seq),this.stateCenter.streamSeq=e.body.stream_seq;for(var t=function(t){var o=e.body.stream_info[t].stream_id;if(!r.stateCenter.publishStreamList[o])return r.logger.info("hsur.0 stream is not exist"),{value:void 0};r.stateCenter.publishStreamList[o].state==i.ENUM_PUBLISH_STREAM_STATE.update_info&&(r.stateCenter.publishStreamList[o].state=i.ENUM_PUBLISH_STREAM_STATE.publishing,r.stateCenter.streamList.find((function(e){return e.stream_id==o}))||r.stateCenter.streamList.push(e.body.stream_info[t]),r.onPublishStateUpdate(0,o,{code:0,msg:""}))},r=this,o=0;o<e.body.stream_info.length;o++){var n=t(o);if("object"==typeof n)return n.value}}else this.logger.error("zb.sh.hsur stream update error "+e.body.err_code);else this.logger.error("zb.sh.hsur not login")},e.prototype.handleFetchStreamListRsp=function(e){this.logger.info("zb.sh.hfslr call"),this.stateCenter.streamQuerying=!1,0===e.body.err_code?this.stateCenter.streamSeq!==e.body.stream_seq?(this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info),this.logger.debug("zb.sh.hfslr call success")):this.logger.info("zb.sh.hfslr same seq"):this.logger.info("zb.sh.hfslr server error=",e.body.err_code)},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.debug("zb.sh.hfus call"),this.stateCenter.streamSeq=e,this.logger.debug("zb.sh.hfus server seq "+this.stateCenter.streamSeq),o.ClientUtil.mergeStreamList(this.logger,this.stateCenter.idName,this.stateCenter.streamList,t,(function(e,t,o){0!==e.length&&(r.logger.debug("zb.sh.hfus callback addstream"),r.onStreamUpdated(r.stateCenter.roomid,i.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug("zb.sh.hfus callback delstream"),r.onStreamUpdated(r.stateCenter.roomid,i.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(t))),0!==o.length&&(r.logger.debug("zb.sh.hfus callback updatestream"),r.onStreamExtraInfoUpdated(r.stateCenter.roomid,r.makeCallbackStreamList(o)))})),this.logger.info("zb.sh.hfus call success")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.stream_info&&0!==e.body.stream_info.length){if(e.body.stream_info.length+this.stateCenter.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.fetchStreamList();switch(this.stateCenter.streamSeq=e.body.stream_seq,e.body.stream_cmd){case i.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(e.body.stream_info);break;case i.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(e.body.stream_info);break;case i.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handleAddedStreamList=function(e){this.logger.debug("zb.sh.hasl call");for(var t,r=[],o=0;o<e.length;o++)if(e[o].anchor_id_name!=this.stateCenter.idName){t=!1;for(var n=0;n<this.stateCenter.streamList.length;n++)if(e[o].stream_id===this.stateCenter.streamList[n].stream_id){t=!0;break}t||r.push(e[o])}else this.logger.debug("hdsl.0 have self stream added");if(0!==r.length){this.logger.debug("zb.sh.hasl callback addstream");for(var a=0;a<r.length;a++)this.stateCenter.streamList.push(r[a]);this.onStreamUpdated(this.stateCenter.roomid,i.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info("zb.sh.hasl call success")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug("zb.sh.hdsl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName){for(var o=this.stateCenter.streamList.length-1;o>=0;o--)if(e[r].stream_id===this.stateCenter.streamList[o].stream_id){this.stateCenter.streamList.splice(o,1),t.push(e[r]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");0!==t.length&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(this.stateCenter.roomid,i.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.hdsl call")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug("zb.sh.husl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName){for(var i=0;i<this.stateCenter.streamList.length;i++)if(e[r].stream_id===this.stateCenter.streamList[i].stream_id){e[r].extra_info!==this.stateCenter.streamList[i].extra_info&&(this.stateCenter.streamList[i]=e[r],t.push(e[r]));break}}else this.logger.debug("hsul.0 have self stream updated");0!==t.length&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.stateCenter.roomid,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.husl call success")},e.prototype.fetchStreamList=function(){this.logger.info("zb.sh.fsl call"),this.stateCenter.isLogin()?this.stateCenter.streamQuerying?this.logger.info("zb.sh.fsl already doing"):(this.stateCenter.streamQuerying=!0,this.logger.debug("zb.sh.fsl send fetch request"),this.socketCenter.registerRouter("stream_info",this.handleFetchStreamListRsp.bind(this)),this.socketCenter.sendMessage("stream_info",{reserve:0}),this.logger.debug("zb.sh.fsl call success")):this.logger.info("zb.sh.fsl state error")},e.prototype.handleReconnectStream=function(e){this.logger.info("zb.sh.hrs call");var t=this.streamCenter.publisherList,r=function(r){if(t[r].publisher.state!=i.ENUM_PUBLISH_STATE.publishing||e.find((function(e){return e.stream_id==r}))){if(t[r].publisher.state==i.ENUM_PUBLISH_STATE.stop&&e.find((function(e){return e.stream_id==r}))){o.updateStreamInfo(r,i.ENUM_STREAM_SUB_CMD.liveEnd);for(var n=0;n<o.stateCenter.streamList.length;n++)if(o.stateCenter.streamList[n].stream_id==r){o.stateCenter.streamList.splice(n--,1);break}}}else o.updateStreamInfo(r,i.ENUM_STREAM_SUB_CMD.liveBegin,o.stateCenter.publishStreamList[r].extra_info)},o=this;for(var n in t)r(n);this.logger.info("zb.sh.hrs end")},e.prototype.makeCallbackStreamList=function(e){var t=[];if(e&&e.length>0)for(var r=0;r<e.length;r++){var i={user:{userID:e[r].anchor_id_name,userName:e[r].anchor_nick_name},extraInfo:e[r].extra_info,streamID:e[r].stream_id,roomID:"",urlFlv:"",urlRtmp:"",urlHls:"",urlHttpsFlv:"",urlHttpsHls:""};this.setCDNInfo(i,e[r]),t.push(i)}return t},e.prototype.updateMixStream=function(e,t,r){var s,c=this;if(this.logger.info("zb.sh.ums call"),!e.taskID)return this.logger.error("zb.sh.ums no taskId found"),r({errorCode:a.errorCodeList.MIXER_TASK_ID_NULL.code,extendedData:""}),!1;if("string"!=typeof e.taskID)return this.logger.error("zb.rh.lg taskId must be string"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;if(e.taskID.length>i.MAX_MIX_TASK_ID_LENGTH)return this.logger.error("zb.sh.ums taskId is too long"),r({errorCode:a.errorCodeList.MIXER_TASK_ID_TOO_LONG.code,extendedData:""}),!1;if(!o.ClientUtil.checkIllegalCharacters(e.taskID))return this.logger.error("zb.sh.ums task ID contains illegal characters"),r({errorCode:a.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER.code,extendedData:""}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error("zb.sh.ums input list wrong"),r({errorCode:a.errorCodeList.MIXER_INPUTLIST_NULL.code,extendedData:""}),!1;e.inputList.forEach((function(e){"AUDIO"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)}));for(var d=e.inputList.every((function(e){return"AUDIO"===e.contentType})),l=0;l<e.inputList.length;l++){var u=e.inputList[l];if("object"!=typeof u.layout)return this.logger.error("zb.sh.ums input layout must be object"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;if(!(o.ClientUtil.checkInteger(u.layout.top,!1)&&o.ClientUtil.checkInteger(u.layout.bottom,!1)&&o.ClientUtil.checkInteger(u.layout.left,!1)&&o.ClientUtil.checkInteger(u.layout.right,!1)))return this.logger.error("zb.sh.ums top、left、bottom、right must be integer number"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1}if(!e.outputList||0==e.outputList.length)return this.logger.error("zb.sh.ums no output list found"),r({errorCode:a.errorCodeList.MIXER_OUTPUTLIST_NULL.code,extendedData:""}),!1;if(e.outputList.some((function(e){return"string"==typeof e&&!o.ClientUtil.isUrl(e)&&!o.ClientUtil.checkIllegalCharacters(e)||"object"==typeof e&&e.target&&!o.ClientUtil.isUrl(e.target)&&!o.ClientUtil.checkIllegalCharacters(e.target)})))return this.logger.error("zb.sh.ums stream output target is incorrect"),r({errorCode:a.errorCodeList.MIXER_OUTPUT_TARGET_INVALID.code,extendedData:""}),!1;if(!(d||e.outputConfig&&"object"==typeof e.outputConfig))return this.logger.error("zb.sh.ums no output config found"),r({errorCode:a.errorCodeList.MIXER_NO_OUTPUT_TARGET.code,extendedData:""}),!1;if(d&&(void 0===e.outputConfig&&(e.outputConfig={outputBitrate:0,outputFPS:0,outputWidth:0,outputHeight:0}),e.outputConfig.outputBitrate=.001,e.outputConfig.outputFPS=1,e.outputConfig.outputWidth=1,e.outputConfig.outputHeight=1),!(d||e.outputConfig.outputBitrate&&o.ClientUtil.checkInteger(e.outputConfig.outputBitrate)))return this.logger.error("zb.sh.ums bitrate param is required and must be integer number"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;if(!e.outputConfig.outputFPS||!o.ClientUtil.checkInteger(e.outputConfig.outputFPS))return this.logger.error("zb.sh.ums fps param is required and must be integer number"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;if(!e.outputConfig.outputWidth||!o.ClientUtil.checkInteger(e.outputConfig.outputWidth))return this.logger.error("zb.sh.ums width param is required and must be integer number"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;if(!e.outputConfig.outputHeight||!o.ClientUtil.checkInteger(e.outputConfig.outputHeight))return this.logger.error("zb.sh.ums height param is required and must be integer number"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;if(void 0!==e.outputConfig.outputAudioCodecID&&!o.ClientUtil.checkInteger(e.outputConfig.outputAudioCodecID,!1))return this.logger.error("zb.sh.ums AudioCodecID param must be integer number"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;if(void 0!==e.outputConfig.outputAudioBitrate&&!o.ClientUtil.checkInteger(e.outputConfig.outputAudioBitrate))return this.logger.error("zb.sh.ums AudioBitrate param must be integer number"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;if(void 0!==e.outputConfig.outputAudioChannels&&!o.ClientUtil.checkInteger(e.outputConfig.outputAudioChannels,!1))return this.logger.error("zb.sh.ums AudioChannels param must be integer number"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;var h=0;e.outputConfig.singleStreamPassThrough&&"boolean"==typeof e.outputConfig.singleStreamPassThrough&&(h=e.outputConfig.singleStreamPassThrough?1:0);var p={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.stateCenter.roomid,appid:this.stateCenter.appid,version:i.PROTO_VERSION,bypass:h},f=this.stateCenter.mixStreamAdvance;f&&(f.videoCodec&&(p.extra_params=[{key:"video_encode",value:f.videoCodec}]),f.backgroundColor&&(p.output_bg_color=f.backgroundColor),f.backgroundImage&&(p.output_bg_image=f.backgroundImage),f.waterMark&&(p.watermark=f.waterMark),f.extraParams&&(!p.extra_params&&(p.extra_params=[]),(s=p.extra_params).push.apply(s,f.extraParams)));var g=[];for(l=0;l<e.inputList.length;l++){var m=e.inputList[l],v=m.streamID;this.stateCenter.testEnvironment&&(v="zegotest-"+this.stateCenter.appid+"-"+m.streamID),g.push({stream_id:v,content_control:"AUDIO"===m.contentType?1:0,rect:{layer:l,top:m.layout.top,left:m.layout.left,bottom:m.layout.bottom,right:m.layout.right}})}p.MixInput=g,o.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(n.REPORT_ACTION.addMsgInfo,void 0,{mix_stream_id:e.taskID,stream_cnt:g.length,input_stream_list:g});var y=[];e.outputList.forEach((function(t){var i={},o="";if("string"==typeof t)o=t;else{if("object"!=typeof t||!t.target)return c.logger.error("zb.sh.ums output target required"),r({errorCode:a.errorCodeList.MIXER_OUTPUTLIST_NULL.code,extendedData:""}),!1;o=t.target}o.startsWith("rtmp://")||o.startsWith("https://")&&o.endsWith(".flv")||o.startsWith("https://")&&o.endsWith(".m3u8")?i.mixurl=o:c.stateCenter.testEnvironment?i.stream_id="zegotest-"+c.stateCenter.appid+"-"+o:i.stream_id=o,i.bitrate=1e3*e.outputConfig.outputBitrate,i.fps=e.outputConfig.outputFPS,i.width=e.outputConfig.outputWidth,i.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID&&(i.audio_enc_id=e.outputConfig.outputAudioCodecID),"vp8"===f.videoCodec?i.audio_enc_id=3:"h264"===f.videoCodec&&(i.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(i.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(i.audio_channel_cnt=e.outputConfig.outputAudioChannels),c.stateCenter.testEnvironment?i.testenv=1:i.testenv=0,y.push(i)})),p.MixOutput=y,o.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(n.REPORT_ACTION.addMsgInfo,void 0,{output_target_list:y});var S={channel:"zeus",cmd:"start_mix",req_body:JSON.stringify(p)};return this.logger.debug("zb.sh.ums send command"),this.sendBizChannelRequest(S,(function(e,n,a){c.logger.debug("zb.sh.ums receive message");var s="zegotest-"+c.stateCenter.appid+"-";if(0!=a.length){for(var d=JSON.parse(a),l=[],u=0;u<d.play.length;u++){var h={rtmpURL:"",hlsURL:"",flvURL:""},p=d.play[u].stream_alias||"";c.stateCenter.testEnvironment&&p&&p.startsWith(s)&&(p=p.slice(s.length)),h.streamID=p,d.play[u].rtmp_url&&d.play[u].rtmp_url.length>0&&(h.rtmpURL=d.play[u].rtmp_url),d.play[u].hls_url&&d.play[u].hls_url.length>0&&(h.hlsURL=d.play[u].hls_url),d.play[u].hdl_url&&d.play[u].hdl_url.length>0&&(h.flvURL=d.play[u].hdl_url),l.push(h)}if(t){var f={mixerOutputList:l};t({errorCode:0,extendedData:JSON.stringify(f)})}}else r&&r({errorCode:o.ClientUtil.getServerError(i.MIXSTREAM_ERROR_CODE+1).code,extendedData:""})}),(function(e,t,i){if("number"==typeof e){c.logger.debug("zb.sh.ums error: "+e);var n=[];if(1000000150==e&&0!=i.length)for(var s=JSON.parse(i),d="zegotest-"+c.stateCenter.appid+"-",l=0;l<s.non_exist_streams.length;l++){var u=s.non_exist_streams[l];c.stateCenter.testEnvironment&&u.startsWith(d)?n.push(u.slice(d.length)):n.push(u)}r&&r({errorCode:o.ClientUtil.getServerError(e).code,extendedData:""})}else{var h;c.logger.debug("zb.sh.ums error code "+e.code),h=e==a.errorCodeList.TIMEOUT?a.errorCodeList.MIXER_START_REQUEST_ERROR:a.errorCodeList.MIXER_INNER_ERROR,r&&r({errorCode:h.code,extendedData:""})}})),!0},e.prototype.sendBizChannelRequest=function(e,t,r,i){var o=this;void 0===i&&(i=!1),e=Object.assign(e,{is_retry_req:i?1:0}),this.socketCenter.sendMessage("biz_channel",e,t,(function(i,n,a,s){"number"!=typeof i||2002!==i||s?r(i,n,a):o.sendBizChannelRequest(e,t,r,!0)}),i)},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,i){var s={},c={};if(e&&e.videoCodec){var d=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(d))return t.logger.error("zb.sh.ums param videoCode error"),i({errorCode:a.errorCodeList.MIXER_VIDEO_CONFIG_INVALID.code,extendedData:""}),!1;s.videoCodec=d,c.video_codec=d}if(e.backgroundColor){if(!o.ClientUtil.checkInteger(e.backgroundColor))return t.logger.error("zb.sh.ums param backgroundColor must be integer number"),i({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;s.backgroundColor=e.backgroundColor,c.background_color=e.backgroundColor}if(e.backgroundImage){if("string"!=typeof e.backgroundImage)return t.logger.error("zb.sh.ums param outputBgImage error"),i({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:""}),!1;if(!e.backgroundImage.startsWith("preset-id://")||!e.backgroundImage.endsWith(".jpg")&&!e.backgroundImage.endsWith(".png"))return t.logger.error("zb.sh.ums illegal input background image URL"),i({errorCode:a.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID.code,extendedData:""}),!1;s.backgroundImage=e.backgroundImage,c.background_image=e.backgroundImage}e.waterMark&&(s.waterMark=e.waterMark,c.water_mark=e.waterMark),t.stateCenter.mixStreamAdvance=s,o.ClientUtil.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)(n.REPORT_ACTION.addMsgInfo,void 0,{config:c}),r({errorCode:0,extendedData:""})}))},e.prototype.publishTarget=function(e,t,r){var n=this;if(-1!=["addpush","delpush","clearpush"].indexOf(e.type)){this.logger.info("zb.sh.ptcall");var a=Math.ceil((new Date).getTime()/1e3),s=e.streamID;this.stateCenter.testEnvironment&&(s="zegotest-"+this.stateCenter.appid+"-"+e.streamID);var c={appid:this.stateCenter.appid,biz_type:0,timestamp:a,seq:this.stateCenter.cdnSeq++,version:1*i.PROTO_VERSION,stream_id:s,pushurl:e.pushUrl},d={channel:"media",cmd:e.type,req_body:JSON.stringify(c)};this.logger.debug("zb.sh.pt send command"),this.sendBizChannelRequest(d,(function(a,s,c){if(n.logger.debug("zb.sh.pt receive message"),0!=c.length){var d=JSON.parse(c),l=d.code,u=d.message;if(l&&0!=l)return n.logger.error("zb.sh.pt "+e.type+" error code: "+l+" "+u),void(r&&r({errorCode:l,extendedData:u}));n.logger.info("zb.sh.pt "+e.type+" success"),t&&t({errorCode:0,extendedData:""})}else r&&r({errorCode:o.ClientUtil.getServerError(i.MIXSTREAM_ERROR_CODE+1).code,extendedData:o.ClientUtil.getServerError(i.MIXSTREAM_ERROR_CODE+1).msg})}),(function(e,t,i){n.logger.debug("zb.sh.pt error: "+r);var o="";2001==e?o="invalid channel":2002==e&&(o="bizchannel error"),n.logger.error("zb.sh.pt "+o),r&&r({errorCode:e,extendedData:o})}))}else this.logger.error("zb.sh.pt cdn push type error")},e.prototype.stopMixStream=function(e,t,r){var n=this;this.logger.info("zb.sh.sms call");var s={id_name:this.stateCenter.idName,live_channel:this.stateCenter.roomid,appid:this.stateCenter.appid,version:i.PROTO_VERSION,task_id:e},c={channel:"zeus",cmd:"stop_mix",req_body:JSON.stringify(s)};return this.sendBizChannelRequest(c,(function(){t&&t({errorCode:0})}),(function(e){var t;"number"==typeof e?r&&r({errorCode:o.ClientUtil.getServerError(i.MIXSTREAM_ERROR_CODE+e).code,extendedData:""}):(n.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(e)),t=e==a.errorCodeList.TIMEOUT?a.errorCodeList.MIXER_STOP_REQUEST_ERROR:a.errorCodeList.MIXER_INNER_ERROR,r&&r({errorCode:t.code,extendedData:""}))})),!0},e.prototype.updateStreamExtraInfo=function(e,t){return this.logger.info("zb.sh.usei call"),this.stateCenter.publishStreamList[e]&&(this.stateCenter.publishStreamList[e].extra_info=t,this.stateCenter.publishStreamList[e].state>=i.ENUM_PUBLISH_STREAM_STATE.update_info&&this.updateStreamInfo(e,i.ENUM_STREAM_SUB_CMD.liveUpdate,t)),!0},e.prototype.roomStateHandle=function(e,t){},e}();t.StreamHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(1),n=r(2),a=r(4),s=r(5),c=function(){function e(e,t,r,i){this.logger=e,this.socketCenter=r,this.stateCenter=t,this.dataReport=i}return e.prototype.resetHeartbeat=function(){this.logger.debug("zb.hb.rht call"),clearTimeout(this.stateCenter.heartbeatTimer),this.stateCenter.heartbeatTimer=null,clearTimeout(this.stateCenter.loginHeartbeatTimer),this.stateCenter.loginHeartbeatTimer=null,this.stateCenter.tryHeartbeatCount=0,this.logger.debug("zb.hb.rht call success")},e.prototype.hbLogout=function(e){},e.prototype.fetchReliableMessage=function(e,t){},e.prototype.start=function(e){var t=this;this.logger.info("zb.hb.sht call");var r=n.getReportSeq();return this.dataReport.newReport(r,a.eventList.kZegoTaskLiveRoomhHB),this.dataReport.addMsgInfo(r,{room_sid:this.stateCenter.sessionid}),this.stateCenter.isLogin()?++this.stateCenter.tryHeartbeatCount>3?(this.logger.error("zb.hb.sht come to try limit"),this.dataReport.addMsgInfo(r,{error:a.errorList.kLiveRoomHBTimeoutError.code,message:a.errorList.kLiveRoomHBTimeoutError.message}),this.dataReport.uploadReport(r),void this.hbLogout(s.errorCodeList.HEARTBEAT_TIMEOUT)):(this.logger.debug("zb.hb.sht send packet"),this.socketCenter.registerRouter("hb",(function(e){if(0!==e.body.err_code){var i=o.ClientUtil.decodeServerError(e.body.err_code,e.body.err_message);t.dataReport.addMsgInfo(r,{error:i.code,message:i.message+e.body.err_code})}t.dataReport.uploadReport(r),t.handleHeartbeatRsp(e)})),this.socketCenter.sendMessage("hb",{reserve:0}),this.logger.info("zb.hb.sht call success"),this.stateCenter.heartbeatInterval=e,void(this.stateCenter.heartbeatTimer=setTimeout((function(){t.start(t.stateCenter.heartbeatInterval)}),this.stateCenter.heartbeatInterval))):(this.logger.error("zb.hb.sht state error"),this.dataReport.addMsgInfo(r,{error:a.errorList.kLiveRoomNotLoginError.code,message:a.errorList.kLiveRoomNotLoginError.message}),void this.dataReport.uploadReport(r))},e.prototype.relogin=function(){},e.prototype.handleHeartbeatRsp=function(e){if(this.logger.debug("zb.hb.hhbr call"),e.body.err_code!=i.ERROR_CODES.ROOM_SESSION_ID_ERR){if(0!==e.body.err_code)return this.logger.error("zb.hb.hhbr call disconnect, server error=",e.body.err_code),void this.hbLogout(o.ClientUtil.getServerError(e.body.err_code));for(var t in this.stateCenter.tryHeartbeatCount=0,this.stateCenter.heartbeatInterval=e.body.hearbeat_interval,this.stateCenter.heartbeatInterval<i.MINIUM_HEARTBEAT_INTERVAL&&(this.stateCenter.heartbeatInterval=i.MINIUM_HEARTBEAT_INTERVAL),e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.stateCenter.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.stateCenter.datiTimeWindow=e.body.dati_time_window),this.ReliableMessageHandler(e),this.fetchStreamList(e),this.patchUserList(e),this.stateCenter.publishStreamList)this.stateCenter.publishStreamList[t].state==i.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.logger.info("zb.hb.hhbr try to update stream info"),this.updateStreamInfo(t,i.ENUM_STREAM_SUB_CMD.liveBegin,this.stateCenter.publishStreamList[t].extra_info));null!=e.body.online_count&&0!=e.body.online_count&&this.onUpdateOnlineCount(this.stateCenter.roomid,e.body.online_count),this.logger.debug("zb.hb.hhbr call success")}else this.hbLogout(s.errorCodeList.HEARTBEAT_TIMEOUT)},e.prototype.ReliableMessageHandler=function(e){var t=this;if(e.body.trans_seqs)for(var r=0;r<e.body.trans_seqs.length;r++){var i=e.body.trans_seqs[r].trans_channel,o=e.body.trans_seqs[r].trans_seq_array;(o=o.filter((function(e){var r=e.trans_type,i=e.trans_seq;return!t.stateCenter.transSeqMap[r]||t.stateCenter.transSeqMap[r].seq<i}))).length>0&&this.fetchReliableMessage(i,o)}},e.prototype.fetchStreamList=function(e){var t=this;e.body.stream_seq!==this.stateCenter.streamSeq&&(this.logger.debug("zb.hb.fsl current seq "+this.stateCenter.streamSeq+" server Seq "+e.body.stream_seq),this.logger.debug("zb.hb.fsl call"),this.stateCenter.isLogin()?this.stateCenter.streamQuerying?this.logger.warn("zb.hb.fsl already doing"):(this.stateCenter.streamQuerying=!0,this.logger.debug("zb.hb.fsl send fetch request"),this.socketCenter.registerRouter("stream_info",(function(e){t.handleFetchStreamListRsp(e)})),this.socketCenter.sendMessage("stream_info",{reserve:0}),this.logger.debug("zb.hb.fsl call success")):this.logger.error("zb.hb.fsl state error"))},e.prototype.patchUserList=function(e){var t=this;if(e.body.server_user_seq!==this.stateCenter.userSeq&&this.stateCenter.userStateUpdate&&!this.stateCenter.userSeqMergeMap){var r=this.stateCenter.lastUserQueryTime-Date.now();this.logger.info("zb.hb.hhbr call update user "+this.stateCenter.userSeq+" server "+e.body.server_user_seq+" wait "+r),r>0?(this.stateCenter.userQueryTimer&&clearTimeout(this.stateCenter.userQueryTimer),this.stateCenter.userQueryTimer=setTimeout((function(){t.fetchUserList()}),r)):this.fetchUserList()}},e.prototype.handleFetchStreamListRsp=function(e){},e.prototype.fetchUserList=function(){},e.prototype.updateStreamInfo=function(e,t,r,i){void 0===r&&(r="")},e.prototype.onUpdateOnlineCount=function(e,t){},e.prototype.onRecvReliableMessage=function(e){},e.prototype.resetCheckMessage=function(){this.logger.debug("zb.hb.rcm call"),clearTimeout(this.stateCenter.sendDataCheckTimer),this.stateCenter.sendDataCheckTimer=null,this.checkSendMessageList(this.stateCenter.sendDataList),this.checkSendMessageList(this.stateCenter.sendCommandList),this.stateCenter.sendDataMap={},this.stateCenter.sendCommandMap={},this.logger.debug("zb.hb.rcm call success")},e.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data.error&&(t._data.data.body.custom_msg?t._data.error(s.errorCodeList.TIMEOUT,t._data.data.header.seq,t._data.data.body.custom_msg):t._data.error(s.errorCodeList.TIMEOUT,t._data.data.header.seq)),t=e.getFirst()},e.prototype.checkMessageListTimeout=function(e,t){for(var r=e.getFirst(),i=Date.parse(new Date+""),o=0,n=0,a=0;null!=r;){var c="biz_channel"===r._data.data.header.cmd?this.stateCenter.sendDataBizTimeout:this.stateCenter.sendDataTimeout;if(r._data.time+c>i)break;if(delete t[r._data.data.header.seq],e.remove(r),++n,null==r._data.error||this.stateCenter.sendDataDropTimeout>0&&r._data.time+this.stateCenter.sendDataDropTimeout<i?++a:r._data.data.body.custom_msg?r._data.error(s.errorCodeList.TIMEOUT,r._data.data.header.seq,r._data.data.body.custom_msg):r._data.error(s.errorCodeList.TIMEOUT,r._data.data.header.seq),++o>=this.stateCenter.sendDataCheckOnceCount)break;r=e.getFirst()}0==n&&0==a||this.logger.debug("zb.hb.cmt call success, stat: timeout=",n,"drop=",a)},e.prototype.startCheckMessageTimeout=function(){var e=this;this.stateCenter.isLogin()?(this.checkMessageListTimeout(this.stateCenter.sendDataList,this.stateCenter.sendDataMap),this.checkMessageListTimeout(this.stateCenter.sendCommandList,this.stateCenter.sendCommandMap),this.stateCenter.sendDataCheckTimer=setTimeout((function(){e.startCheckMessageTimeout()}),this.stateCenter.sendDataCheckInterval)):this.logger.error("zb.hb.scmt state error")},e}();t.HeartBeatHandler=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(1),n=r(5),a=function(){function e(e,t,r,i){this.logger=e,this.socketCenter=r,this.stateCenter=t,this.dataReport=i}return e.prototype.sendCustomCommand=function(e,t,r,i){var a=this;if(this.logger.debug("zb.mh.scc call"),this.stateCenter.isLogin()){var s={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||"",room_id:this.stateCenter.roomid},c={dest_id_name:e,custom_msg:JSON.stringify(s)};o.ClientUtil.checkCustomCommandParam(c)?(this.socketCenter.registerRouter("custommsg",(function(e){a.handleSendCustomMsgRsp(e)})),this.socketCenter.sendCustomMessage("custommsg",c,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[0];r({errorCode:i})}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,o=e[0];a.logger.error("zb.mh.scc "+o.msg),r=o==n.errorCodeList.TIMEOUT?n.errorCodeList.IM_SEND_FAILED:o,i({errorCode:r.code})})),this.logger.info("zb.mh.scc call success")):this.logger.error("zb.mh.scc param error")}else this.logger.error("zb.mh.scc state error")},e.prototype.handleSendCustomMsgRsp=function(e){this.logger.debug("zb.mh.hscmrcall");var t,r=this.stateCenter.sendDataMap[e.header.seq];null!=r?("custommsg"!=(t=r._data).data.header.cmd?this.logger.error("zb.mh.hscmrcmd wrong"+t.data.header.cmd):0===e.body.err_code?(JSON.parse(t.data.body.custom_msg),null!=t.success&&t.success(0)):null!=t.error&&t.error(o.ClientUtil.getServerError(e.body.err_code)),delete this.stateCenter.sendDataMap[e.header.seq],this.stateCenter.sendDataList.remove(r)):this.logger.error("zb.mh.hscmrno found seq="+e.header.seq),this.logger.debug("zb.mh.hscmr  call success")},e.prototype.handlePushCustomMsg=function(e){var t=JSON.parse(e.body.custommsg);this.logger.debug("zb.mh.hpcm submsg=",t),this.onRecvCustomCommand(t.from_userid,t.from_username,t.room_id,t.custom_content)},e.prototype.onRecvCustomCommand=function(e,t,r,i){},e.prototype.sendRoomMsg=function(e,t,r,i,o){var a=this;if(this.logger.debug("zb.mh.srm call"),this.stateCenter.isLogin()){var s=Date.parse(new Date+"");if(this.stateCenter.sendRoomMsgTime>0&&this.stateCenter.sendRoomMsgTime+this.stateCenter.SendRoomMsgInterval>s)return this.logger.info("zb.mh.srm freq error"),void(o&&o(n.errorCodeList.FREQ_LIMITED,0,e,r));this.stateCenter.sendRoomMsgTime=s,this.logger.debug("zb.mh.srm send fetch request");var c={msg_category:e,msg_type:1,msg_content:r};this.socketCenter.registerRouter("im_chat",(function(e){a.handleSendRoomMsgRsp(e)})),this.socketCenter.sendCustomMessage("im_chat",c,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],o=e[1];i({errorCode:r,messageID:o})}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,i=e[0],s=e[1];a.logger.error("zb.mh.srm "+i.msg),r=i==n.errorCodeList.TIMEOUT?n.errorCodeList.IM_SEND_FAILED:i,o({errorCode:r.code,messageID:s})})),this.logger.info("zb.mh.srm call success")}else this.logger.error("zb.mh.srm state error")},e.prototype.handleSendRoomMsgRsp=function(e){this.logger.debug("zb.mh.hsrmr call");var t,r=this.stateCenter.sendDataMap[e.header.seq];null!=r?("im_chat"!=(t=r._data).data.header.cmd?this.logger.error("zb.mh.hsrmr cmd wrong"+t.data.header.cmd):0===e.body.err_code?t.success&&t.success(0,e.body.msg_id):t.error&&t.error(o.ClientUtil.getServerError(e.body.err_code),e.body.msg_id),delete this.stateCenter.sendDataMap[e.header.seq],this.stateCenter.sendDataList.remove(r)):this.logger.error("hzb.mh.hsrmr no found seq="+e.header.seq),this.logger.info("zb.mh.hsrmr call success")},e.prototype.onRecvRoomMsg=function(e,t,r){},e.prototype.sendReliableMessage=function(e,t,r,i){this.logger.debug("zb.mh.srirm call"),this.stateCenter.transSeqMap[e]||(this.stateCenter.transSeqMap[e]={seq:0});var o={trans_type:e,trans_data:t,trans_local_seq:this.stateCenter.transSeqMap[e].seq,trans_channel:"clt"};this.socketCenter.sendMessage("trans",o,r,i)},e.prototype.sendBigRoomMessage=function(e,t,r,i,o){var n=this;this.logger.debug("zb.mh.sbim call");var a=this.stateCenter.bigimTimeWindow,s=this.stateCenter.serverTimeOffset,c=(new Date).getTime()+s,d=(++this.stateCenter.cmdSeq).toString();if(this.stateCenter.bigImCallbackMap[d]={success:i,error:o},0==a){var l={msg_category:e,msg_type:1,msg_content:r,bigmsg_client_id:d};this.logger.debug("zb.mh.sbim no time window"),this.sendBigRoomMessageInternal([l],(function(e){n.handleBigImMsgRsp(e)}),o)}else{var u=Math.floor(c/a);if(this.logger.debug("currentIndex "+u+" lastTimeIndex "+this.stateCenter.bigImLastTimeIndex),this.stateCenter.bigImLastTimeIndex<u&&0==this.stateCenter.bigImMessageList.length){this.stateCenter.bigImLastTimeIndex=u;var h={msg_category:e,msg_type:1,msg_content:r,bigmsg_client_id:d};this.sendBigRoomMessageInternal([h],(function(e){n.handleBigImMsgRsp(e)}),o)}else this.stateCenter.bigImMessageList.push({msg_category:e,msg_type:1,msg_content:r,bigmsg_client_id:d}),1==this.stateCenter.bigImMessageList.length&&this.setBigImTimer(s,a)}},e.prototype.handlePushMergeMsg=function(e){if(this.stateCenter.isLogin()){for(var t=0;t<e.body.messages.length;t++)14001===e.body.messages[t].sub_cmd&&this.handlePushBigRooMsg(e.body.messages[t].msg_body);this.logger.debug("zb.mh.hpmm call success")}else this.logger.error("zb.mh.hpmmnot login")},e.prototype.handlePushBigRooMsg=function(e){var t;try{t=JSON.parse(e)}catch(e){return void this.logger.warn("zb.mh.hpbrm parse json error")}if(t){for(var r=t.room_id,i=[],o=0;o<t.msg_data.length;o++){var n=t.msg_data[o];n.id_name!=this.stateCenter.idName?i.push({idName:n.id_name,nickName:n.nick_name,messageId:n.bigmsg_id,category:n.msg_category,type:n.msg_type,content:n.msg_content,time:n.send_time}):this.logger.debug("zb.mh.hpbrm self message")}0==i.length?this.logger.debug("zb.mh.hpbrm no other pushData except self"):this.onRecvBigRoomMessage(i,r),this.logger.debug("zb.mh.hpbrm call success")}else this.logger.warn("zb.mh.hpbrm cann't find message body")},e.prototype.onRecvBigRoomMessage=function(e,t){},e.prototype.sendBigRoomMessageInternal=function(e,t,r){this.logger.debug("zb.mh.sbim call");var i={msgs:e};this.socketCenter.sendMessage("bigim_chat",i,t,r)},e.prototype.handleBigImMsgRsp=function(e){if(this.stateCenter.isLogin()){this.stateCenter.bigimTimeWindow!=e.body.bigim_time_window&&(this.stateCenter.bigimTimeWindow=e.body.bigim_time_window);for(var t=0;t<e.body.msgs.length;t++){var r=e.body.msgs[t].bigmsg_client_id,i=e.body.msgs[t].bigmsg_id;if(this.stateCenter.bigImCallbackMap[r]){var o=this.stateCenter.bigImCallbackMap[r].success;null!=o&&o({errorCode:0,messageID:i}),delete this.stateCenter.bigImCallbackMap[r]}}}else this.logger.info("zb.mh.hbmr not login")},e.prototype.setBigImTimer=function(e,t){var r=this,i=t-((new Date).getTime()+e)%t,n=o.ClientUtil.generateRandumNumber(t)+i;this.logger.info("zb.mh.sbt setTimer "+n),this.stateCenter.bigImTimer=setTimeout((function(){r.onBigImTimer()}),n)},e.prototype.onBigImTimer=function(){var e=this,t=(new Date).getTime()+this.stateCenter.serverTimeOffset;this.stateCenter.bigImLastTimeIndex=Math.floor(t/this.stateCenter.bigimTimeWindow);for(var r=[],i=[],o=0;o<this.stateCenter.bigImMessageList.length&&!(o>=20);o++){var n=this.stateCenter.bigImMessageList[o];r.push({msg_category:n.msg_category,msg_type:n.msg_type,msg_content:n.msg_content,bigmsg_client_id:n.bigmsg_client_id}),i.push(n.bigmsg_client_id)}this.stateCenter.bigImMessageList.length>20?this.stateCenter.bigImMessageList.splice(0,20):this.stateCenter.bigImMessageList=[],this.sendBigRoomMessageInternal(r,(function(t){e.handleBigImMsgRsp(t)}),(function(t,r){for(var o=0;o<i.length;o++){var n=i[o],a=e.stateCenter.bigImCallbackMap[n];a&&(null!=a.error&&a.error(t,r),delete e.stateCenter.bigImCallbackMap[n])}})),clearTimeout(this.stateCenter.bigImTimer),this.stateCenter.bigImTimer=null,this.stateCenter.bigImMessageList.length>0&&this.setBigImTimer(this.stateCenter.serverTimeOffset,this.stateCenter.bigimTimeWindow)},e.prototype.sendRelayMessage=function(e,t,r,i){this.logger.debug("zb.mh.srm call");var o=this.stateCenter.datiTimeWindow,n=this.stateCenter.serverTimeOffset;o>0?(this.stateCenter.realyMessageList.push({type:e,data:t,success:r,error:i}),1==this.stateCenter.realyMessageList.length&&this.setRelayTimer(n,o)):this.sendRelayMessageInternal(e,t,r,i)},e.prototype.sendRelayMessageInternal=function(e,t,r,i){this.logger.debug("zb.mh.srmi call");var o={relay_type:e,relay_data:t};this.socketCenter.sendMessage("relay",o,r,i)},e.prototype.setRelayTimer=function(e,t){var r=this,i=2*t-((new Date).getTime()+e)%t,n=o.ClientUtil.generateRandumNumber(i);this.logger.info("zb.mh.srt setTimer "+n),this.stateCenter.relayTimer=setTimeout((function(){r.onRelayTimer()}),n)},e.prototype.onRelayTimer=function(){if(0!=this.stateCenter.realyMessageList.length){var e=this.stateCenter.realyMessageList[0];this.sendRelayMessageInternal(e.type,e.data,e.success,e.error),clearTimeout(this.stateCenter.relayTimer),this.stateCenter.relayTimer=null,this.stateCenter.realyMessageList.splice(0,1),this.stateCenter.realyMessageList.length>0&&this.setRelayTimer(this.stateCenter.serverTimeOffset,this.stateCenter.datiTimeWindow)}else this.logger.info("zb.mh.ort no relay data")},e.prototype.handlePushTransMsg=function(e){if(this.stateCenter.isLogin()){var t=e.body.trans_type,r=e.body.trans_seq;!this.stateCenter.transSeqMap[t]||this.stateCenter.transSeqMap[t].seq<r?(this.stateCenter.transSeqMap[t]={seq:r},this.onRecvReliableMessage([e.body])):this.logger.warn("zb.mh.hptr trans seq wrong"),this.logger.info("zb.mh.hptr trans "+t+" seq "+r)}else this.logger.error("zb.mh.hptr not login")},e.prototype.onRecvReliableMessage=function(e){},e.prototype.relogin=function(){},e.prototype.fetchReliableMessage=function(e,t){var r=this;this.logger.debug("zb.hb.frm call");var i={trans_channel:e,fetch_array:t};this.socketCenter.registerRouter("trans_fetch",(function(e){r.handleFetchTransRsp(e)})),this.socketCenter.sendMessage("trans_fetch",i),this.logger.debug("zb.hb.frm call success")},e.prototype.handleFetchTransRsp=function(e){if(this.stateCenter.isLogin())if(e.body.err_code!=i.ERROR_CODES.ROOM_SESSION_ID_ERR)if(0==e.body.err_code){var t=e.body.trans_fetch_results,r=[];if(Array.isArray(t)&&t.length>0)for(var o=0;o<t.length;o++){var n=t[o];if(n.err_code!==i.ERROR_CODES.FETCH_TRANS_UNKNOWN_TYPE){var a=n.trans_type,s=n.trans_seq;n.err_code!==i.ERROR_CODES.FETCH_TRANS_WRONG_SEQ?(!this.stateCenter.transSeqMap[a]||this.stateCenter.transSeqMap[a].seq<s?(this.stateCenter.transSeqMap[a]={seq:s},r.push(n)):this.logger.warn("zb.hb.hftr fetch trans seq wrong"),r.length>0&&this.onRecvReliableMessage(r),this.logger.debug("zb.hb.hftr trans "+a+" seq "+s)):(this.logger.warn("zb.hb.hftr fetch trans seq is wrong "+n.err_code),this.stateCenter.transSeqMap[a]={seq:s})}else this.logger.warn("zb.hb.hftr fetch trans unknown type "+n.err_code)}}else this.logger.error("zb.hb.hftr trans send error "+e.body.err_code);else this.relogin();else this.logger.error("zb.hb.hftr not login")},e}();t.MessageHandler=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(){function e(e,t,r){this.logger=e,this.socketCenter=r,this.stateCenter=t}return e.prototype.requestJoinLive=function(e,t,r,o){this.logger.debug("zb.lh.rjl call");var n=this.stateCenter.getRequestId(),a=this.stateCenter.getSignalCmdContent(n,e);return null!=o&&(this.stateCenter.joinLiveCallbackMap[n]=o,this.sendSignalCmd(i.ENUM_SIGNAL_SUB_CMD.joinLiveRequest,a,e,t,r),!0)},e.prototype.inviteJoinLive=function(e,t,r,o){this.logger.debug("zb.lh.ijl call");var n=this.stateCenter.getRequestId(),a=this.stateCenter.getSignalCmdContent(n,e);return null!=o&&(this.stateCenter.joinLiveCallbackMap[n]=o,this.sendSignalCmd(i.ENUM_SIGNAL_SUB_CMD.joinLiveInvite,a,e,t,r),!0)},e.prototype.endJoinLive=function(e,t,r){this.logger.debug("zb.lh.ejl call");var o=this.stateCenter.getRequestId(),n=this.stateCenter.getSignalCmdContent(o,e);return this.sendSignalCmd(i.ENUM_SIGNAL_SUB_CMD.joinLiveStop,n,e,t,r),!0},e.prototype.respondJoinLive=function(e,t,r,o){this.logger.debug("zb.lh.rpjl call");var n=this.stateCenter.joinLiveRequestMap[e];if(!n)return this.logger.info("zb.lh.rpjl no dest id name"),!1;var a=0;!0===t&&(a=1);var s=this.stateCenter.getSignalCmdContent(e,n,a);return this.sendSignalCmd(i.ENUM_SIGNAL_SUB_CMD.joinLiveResult,s,n,r,o),delete this.stateCenter.joinLiveRequestMap[e],!0},e.prototype.sendSignalCmd=function(e,t,r,i,o){if(this.logger.debug("zb.lh.ssc call"),this.stateCenter.isLogin()){this.logger.debug("zb.lh.ssc send signal cmd "+e);var n={sub_cmd:e,signal_msg:t,dest_id_name:[r]};this.socketCenter.sendMessage("signal",n,i,o),this.logger.info("zb.lh.ssc call success")}else this.logger.error("zb.lh.ssc state error")},e.prototype.handlePushSignalMsg=function(e){if(this.stateCenter.isLogin()){var t=JSON.parse(e.body.signal_msg);switch(this.logger.debug("zb.lh.hpcm hpsm= ",t),e.body.sub_cmd){case i.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveRequest:this.handlePushJoinLiveRequestMsg(t);break;case i.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveResult:this.handlePushJoinLiveResultMsg(t);break;case i.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveInvite:this.handlePushJoinLiveInviteMsg(t);break;case i.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveStop:this.handlePushJoinLiveStopMsg(t)}this.logger.debug("zb.lh.hpsm call end")}else this.logger.warn("zb.lh.hpsm not login")},e.prototype.handlePushJoinLiveRequestMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.stateCenter.joinLiveRequestMap[t]=r,this.logger.info("zb.lh.hpjlrm onRecvJoinLiveRequest "+r),this.onRecvJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id)):this.logger.error("zb.lh.hpjlrm no from user")}else this.logger.error("zb.lh.hpjlrm no requestId")},e.prototype.onRecvJoinLiveRequest=function(e,t,r,i){},e.prototype.handlePushJoinLiveInviteMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.stateCenter.joinLiveRequestMap[t]=r,this.logger.info("zb.lh.hpjlim onRecvInviteJoinLiveRequest "+r),this.onRecvInviteJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id)):this.logger.error("zb.lh.hpjlim no from user")}else this.logger.error("zb.lh.hpjlim no requestId")},e.prototype.onRecvInviteJoinLiveRequest=function(e,t,r,i){},e.prototype.handlePushJoinLiveResultMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.result;if(null!=r){var i=1==r;if(this.stateCenter.joinLiveCallbackMap[t]){var o=this.stateCenter.joinLiveCallbackMap[t];if(!o)return void this.logger.info("hpjlrm.o no callback");this.logger.info("zb.lh.hpjlrm joinLiveRequest/invite result "+i),delete this.stateCenter.joinLiveCallbackMap[t],o(i,e.from_userid,e.from_username)}}else this.logger.info("zb.lh.hpjlrm no result")}else this.logger.error("zb.lh.hpjlrm no requestId")},e.prototype.handlePushJoinLiveStopMsg=function(e){var t=e.request_id;"string"==typeof t?(this.logger.info("zb.lh.hpjlsm onRecvEndJoinLiveCommand "+e.from_userid),this.onRecvEndJoinLiveCommand(t,e.from_userid,e.from_username,e.room_id)):this.logger.error("zb.lh.hpjlsm no requestId")},e.prototype.onRecvEndJoinLiveCommand=function(e,t,r,i){},e}();t.LiveHandler=o},function(e,t,r){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var n=r(7),a=r(0),s=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.logger=t,i.stateCenter=r,i}return o(t,e),t.prototype.initRoom=function(e,t,r,i,o,n,a){this.roomHandler=e,this.roomID=t,this.token=r,this.user=i,this.server=o,this.serverBak=n||o,this.config=a},t.prototype.active=function(e){var t=this;if(this.logger.info("zc.rrh.a retry call"),this.stateCenter.networkState!=a.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info("zc.rrh.a has actived, ignore");else if(this.isOverTime)this.logger.info("zc.rrh.a retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}this.retryTimer=setTimeout((function(){t.roomHandler.login(t.retryActiveCount%2==1?t.server:t.serverBak,t.roomID,t.token,t.user,t.config,(function(e){t.handleLoginFinish(e)}),(function(e,r){t.handleLoginFinish(!1,e,r)})),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++}),e?0:1e3*this.retryActiveInterval)}else this.logger.info("zc.rrh.a network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,a.sdkErrorList.LOGIN_TIMEOUT)}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,t){},t.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){var r=e.code+"";return!["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"].includes(r)&&(!!["1100040001","1100040100"].includes(r)||this.stateCenter.lastRunState==a.ENUM_RUN_STATE.login&&(this.stateCenter.sessionid="",this.invalid(),!0))}return!0},t.prototype.handleLoginFinish=function(e,t,r){t?this.handleError(t,r)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,t)):(this.stopMaxTime(),this.invalid(),this.onactive(e))},t}(n.TryHandler);t.RetryRoomHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(2),n=function(){function e(){this.debug=!1,this.debugCustom=!1,this.testEnvironment=!1,this.third_token="",this.pullLimited=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.runState=i.ENUM_RUN_STATE.logout,this.lastRunState=i.ENUM_RUN_STATE.logout,this.callbackList={},this.streamQuerying=!1,this.streamSeq=0,this.streamList=[],this.publishStreamList={},this.userQuerying=!1,this.userTempList=[],this.userList=[],this.userSeq=0,this.userSeqMergeMap=null,this.userSeqMergeTimer=null,this.userQueryTimer=null,this.lastUserQueryTime=0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.sendCommandMap={},this.sendCommandList=new i.LinkedList,this.sendDataMap={},this.sendDataList=new i.LinkedList,this.joinLiveCallbackMap={},this.joinLiveRequestMap={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.transSeqMap={},this.realyMessageList=[],this.relayTimer=null,this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer=null,this.msgCategory=2,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.bigImMessageList=[],this.tryLoginCount=0,this.tryLoginTimer=null,this.tryLoginInterval=1e4,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.sendDataCheckTimer=null,this.sendDataCheckInterval=2e3,this.sendDataTimeout=5e3,this.sendDataBizTimeout=6e3,this.sendDataDropTimeout=1e4,this.sendDataCheckOnceCount=100,this.sendRoomMsgTime=0,this.SendRoomMsgInterval=500,this.cmdSeq=0,this.turnOverTcpOnly=!1,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],roomStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[]},this.reportList={},this.reportSeqList={login:0,relogin:0,startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.mixStreamAdvance={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.networkState=i.ENUM_NETWORK_STATE.offline,this.roomRetryTime=300,this.streamRetryTime=300}return e.prototype.isLogin=function(){return this.runState===i.ENUM_RUN_STATE.login},e.prototype.getRequestId=function(){return this.idName+"-"+o.getSeq()},e.prototype.getSignalCmdContent=function(e,t,r){var i={request_id:e,room_id:this.roomid,from_userid:this.idName,from_username:this.nickName,to_userid:t};return null!=r&&(i.result=r),JSON.stringify(i)},e.prototype.actionListener=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.listenerList[e]&&this.listenerList[e].forEach((function(i){try{i.apply(void 0,r)}catch(r){t.logger.error("zb.sct.al0.0 ",e," ",r)}}))},e}();t.StateCenter=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=function(){function e(e,t){var r=this,i=t.type,o=t.channels,n=void 0===o?1:o,a=t.bufferSize,s=void 0===a?0:a,c=t.sampleBit,d=void 0===c?16:c,l=t.sampleRate,u=void 0===l?44100:l;this.instant=0,this.slow=0,this.clip=0,this.context=e,this.type=i,this.channels=n,this.bufferSize=s,this.sampleBit=d,this.sampleRate=u,this.script=e.createScriptProcessor(s,n,n),(new Date).getTime(),this.script.addEventListener("audioprocess",(function(e){var t,o=e.inputBuffer.getChannelData(0),n=0,a=0;for(t=0;t<o.length;++t)n+=o[t]*o[t],Math.abs(o[t])>.99&&(a+=1);if(r.instant=Math.sqrt(n/o.length),r.slow=.95*r.slow+.05*r.instant,r.clip=a/o.length,"pcm"===i||"wav"===i){for(var s=[],c=0;c<r.channels;c++)s.push(e.inputBuffer.getChannelData(c));r.recorderBuffer(s)}})),"pcm"!==i&&"wav"!==i||this.initRecorderBuffer(i)}return e.prototype.connectToSource=function(e,t){try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),void 0!==t&&t(null)}catch(e){void 0!==t&&t(e)}return this},e.prototype.recorderBuffer=function(e){this.worker.postMessage({command:"record",val:e})},e.prototype.initRecorderBuffer=function(e){var t=this,r=this;this.worker=i.ClientUtil.inlineWorker((function(){var e,r,i,o,n,a,s=[],c=t;function d(e,t,r){for(var i=0;i<r.length;i++,t+=2){var o=Math.max(-1,Math.min(1,r[i]));e.setInt16(t,o<0?32768*o:32767*o,!0)}}function l(e,t,r){for(var i=0;i<r.length;i++,t++){var o=Math.max(-1,Math.min(1,r[i])),n=o<0?128*o:127*o;n+=128,e.setInt8(t,n)}}function u(e,t,r){for(var i=0;i<r.length;i++)e.setUint8(t+i,r.charCodeAt(i))}function h(e,t){for(var r=new Float32Array(t.length/e),i=0,o=0;i<r.length;)r[i]=t[o],o+=e,i++;return r}function p(e,t,r){for(var i=new Float32Array(t*e.length),o=0,n=0;n<r[0].length;n++)i.set(r[0][n],o),o+=r[0][n].length;return i}function f(e,t){for(var r=new Float32Array(e.length+t.length),i=0;i<e.length+t.length;i+=2)r[i]=e[i/2>>0],r[i+1]=t[i/2>>0];return r}function g(t){var r,i;if(1==e)r=p(s[0],n,s),1!=t&&(i=h(t,r));else if(2==e){var o=p(s[0],n,s),a=p(s[1],n,s);1!=t?i=f(h(t,o),h(t,a)):r=f(o,a)}return 1!=t?i:r}function m(e){var t=function(e,t){var i;8==t?i=e.length:16==t&&(i=e.length,i*=2);var o=new ArrayBuffer(i),n=new DataView(o);return 8==t?l(n,0,e):16==r&&d(n,0,e),n}(g(e),r);c.postMessage({command:"exportPcmLive",val:t})}function v(t){var o=function(t,o){var n;8==o?n=t.length:16==r&&(n=t.length,n*=2);var a=new ArrayBuffer(n+44),s=new DataView(a),c=i,h=r,p=e;return u(s,0,"RIFF"),s.setUint32(4,36+n,!0),u(s,8,"WAVE"),u(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,p,!0),s.setUint32(24,c,!0),s.setUint32(28,c*p*(h/8),!0),s.setUint16(32,p*(h/8),!0),s.setUint16(34,h,!0),u(s,36,"data"),s.setUint32(40,n,!0),8==r?l(s,44,t):16==r&&d(s,44,t),s}(g(t),r);c.postMessage({command:"exportWav",val:o})}t.onmessage=function(t){switch(t.data.command){case"init":c=t.data.val,e=c.sampleChannel,r=c.sampleBit,i=c.sampleRate,o=c.oldSampleRate,n=c.bufferSize,a=c.type;break;case"record":!function(t){for(var r=0;r<e;r++)s[r]||(s[r]=[]),s[r].push(t[r]);var n=Math.round(o/i);"pcm"===a?m(n):"wav"===a&&v(n),s=[]}(t.data.val)}var c}})),this.worker.postMessage({command:"init",val:{sampleChannel:this.channels,sampleBit:this.sampleBit,sampleRate:this.sampleRate,oldSampleRate:this.context.sampleRate,bufferSize:this.bufferSize,type:e}}),this.worker.onmessage=function(e){switch(e.data.command){case"exportPcmLive":r.onReceiveBuffer(e.data.val);break;case"exportWav":r.onReceiveWav(e.data.val)}}},e.prototype.onReceiveBuffer=function(e){},e.prototype.onReceiveWav=function(e){},e.prototype.writeString=function(e,t,r){for(var i=0;i<r.length;i++)e.setUint8(t+i,r.charCodeAt(i))},e.prototype.writeBuffer=function(e,t,r){for(var i=0;i<r.byteLength;i++)e.setUint8(t+i,r[i])},e.prototype.concatenation=function(e){for(var t=0,r=0;r<e.length;++r)t+=e[r].buffer.byteLength;var i=new Uint8Array(t),o=0;for(r=0;r<e.length;++r)i.set(new Uint8Array(e[r].buffer),o),o+=e[r].buffer.byteLength;return i},e.prototype.encodeWave=function(e){var t=this.concatenation(e),r=t.byteLength,i=new ArrayBuffer(r+44),o=new DataView(i),n=this.sampleRate,a=this.sampleBit,s=this.channels;return this.writeString(o,0,"RIFF"),o.setUint32(4,36+r,!0),this.writeString(o,8,"WAVE"),this.writeString(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,s,!0),o.setUint32(24,n,!0),o.setUint32(28,n*s*(a/8),!0),o.setUint16(32,s*(a/8),!0),o.setUint16(34,a,!0),this.writeString(o,36,"data"),o.setUint32(40,r,!0),this.writeBuffer(o,44,t),o},e.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()},e}();t.MediaUtil=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.log=e,this.dataStatistics={},this.logger=e}return e.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:"success",event:t,events:[]}},e.prototype.addMsgExt=function(e,t){this.dataStatistics[e]&&(this.dataStatistics[e].msg_ext=t)},e.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]&&Object.assign(this.dataStatistics[e],t)},e.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},e.prototype.eventEnd=function(e,t,r){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(i&&0!==i.length){for(var o=i.length-1;o>=0;o--)if(i[o].event==t&&0==i[o].time_consumed){i[o].time_consumed=Date.now()-i[o].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},e.prototype.eventEndWithMsg=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o){for(var n=o.length-1;n>=0;n--)if(o[n].event==t&&0==o[n].time_consumed){o[n].time_consumed=Date.now()-o[n].event_time,null==o[n].msg_ext&&(o[n].msg_ext={}),o[n].msg_ext=i({},r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.eventEndWithMsgInfo=function(e,t,r){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(i){for(var o=i.length-1;o>=0;o--)if(i[o].event==t&&0==i[o].time_consumed){i[o].time_consumed=Date.now()-i[o].event_time,Object.assign(i[o],r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.addEventInfo=function(e,t,r,i){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(null!=o){for(var n=o.length-1;n>=0;n--)if(o[n].event==t&&null!=o[n].time_consumed){null==o[n].msg_ext?o[n].msg_ext={}:o[n].msg_ext&&(o[n].msg_ext[r]=i);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},e.prototype.addEventMsg=function(e,t,r,i){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(null!=o){for(var n=o.length-1;n>=0;n--)if(o[n].event==t){o[n][r]=i;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},e.prototype.addEvent=function(e,t,r){this.dataStatistics[e]?this.dataStatistics[e].events&&(r?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),msg_ext:r}):this.dataStatistics[e].events.push({event:t,event_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},e.prototype.uploadReport=function(e,t,r,i){var o=this.dataStatistics[e];null!=o&&(t&&(o.event=t),o.time_consumed=Date.now()-o.event_time,r&&this.addMsgInfo(e,{error:r.code,message:r.message+" "+(i||"")}),this.logger.report(o),delete this.dataStatistics[e])},e}();t.ZegoDataReport=o}])},,,,,,,,,,function(e,t,r){var i=r(202),o=r(270);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var n={insert:"head",singleton:!1};i(o,n);e.exports=o.locals||{}},function(e,t,r){(t=r(203)(!1)).push([e.i,"#zego-whiteboard-input {\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    padding: 0px;\n    border: none;\n}\n\n[id^='zego-whiteboard-zoom'] {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n}\n\n[id^='zego-whiteboard-con'],\n[id^='zego-whiteboard-con'] > div {\n    transform-origin: 0 0;\n}\n\n[id^='zego-whiteboard'] {\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n    position: absolute;\n}\n[id^='zego-whiteboard'] *,\n[id^='zego-whiteboard'] ::after,\n[id^='zego-whiteboard'] ::before {\n    box-sizing: border-box !important;\n}\n[id^='zego-whiteboard'] [id^='zego-graphics-bg-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n[id^='zego-whiteboard'] [id^='zego-graphics-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    overflow: hidden;\n}\n\n[id^='zego-graphics-container'] [id^='zego-laser'] {\n    transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear;\n    -moz-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear; /* Firefox 4 */\n    -webkit-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear; /* Safari 和 Chrome */\n    -o-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear; /* Opera */\n    -ms-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear;\n    margin-left: -8px;\n    margin-top: -8px;\n}\n\n/* [id^='zego-graphics-container'] path.transition {\n    transition: transform 0.2s linear;\n    -moz-transition: transform 0.2s linear;\n    -webkit-transition: transform 0.2s linear;\n    -o-transition: transform 0.2s linear;\n    -ms-transition: transform 0.2s linear;\n}\n\n[id^='zego-graphics-container'] line.transition {\n    transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -moz-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -webkit-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -o-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -ms-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n}\n\n[id^='zego-graphics-container'] rect.transition {\n    transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -moz-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -webkit-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -o-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -ms-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n}\n\n[id^='zego-graphics-container'] ellipse.transition {\n    transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -moz-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -webkit-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -o-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -ms-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n} */\n\n[id^='zego-whiteboard'] [id^='zego-box-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    overflow: hidden;\n}\n[id^='zego-whiteboard'] svg {\n    transform-origin: 0px 0px 0px;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    margin: 0px;\n    padding: 0px;\n    left: 0;\n    right: 0;\n    pointer-events: none;\n}\n[id^='zego-whiteboard'] textarea {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    border: none;\n    outline: none;\n    background: transparent;\n    resize: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    left: 0;\n    bottom: 0;\n    padding: 0 6px;\n    line-height: 1.5;\n    font-family: inherit;\n    font-size: inherit;\n    box-sizing: border-box;\n    color: inherit;\n    font-style: inherit;\n    font-weight: inherit;\n    white-space: pre-wrap;\n    word-break: break-all;\n    overflow: hidden;\n}\n[id^='zego-whiteboard'] pre {\n    display: block;\n    visibility: hidden;\n    margin: 0px 0px;\n    font-family: inherit;\n    font-size: inherit;\n    color: inherit;\n    font-style: inherit;\n    font-weight: inherit;\n    line-height: 1.5;\n    padding: 0 6px;\n}\n[id^='zego-graphics-box'] {\n    position: absolute;\n}\n[id^='zego-textarea'] {\n    position: absolute;\n    border: 1px dashed transparent;\n}\n[id^='zego-other-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    cursor: none;\n    overflow: hidden;\n}\n[id^='zego-other-container'] div {\n    box-sizing: border-box;\n}\n[id^='zego-laser'] {\n    width: 16px;\n    height: 16px;\n    border-radius: 50%;\n    background: rgba(255, 78, 51, 1);\n    border: 2px solid rgba(255, 144, 128, 1);\n    box-shadow: 0px 0px 8px 0px rgba(254, 94, 70, 0.7);\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n\n[id^='zego-box-container'] .img-editor-box,\n[id^='zego-box-container'] .graphics-box {\n    display: none;\n    position: absolute;\n    overflow: visible;\n    margin: 0;\n    padding: 0;\n    z-index: 2;\n    border: 2px solid #b0b3b8;\n    box-shadow: 0 0 1px 0 #ffffff, inset 0 0 1px 0 #ffffff;\n    transform-origin: 0px 0px 0px;\n    transition: border 0.3s;\n    -moz-transition: border 0.3s; /* Firefox 4 */\n    -webkit-transition: border 0.3s; /* Safari 和 Chrome */\n    -o-transition: border 0.3s; /* Opera */\n}\n\n[id^='zego-box-container'] .operation-point-desktop {\n    width: 12px;\n    height: 12px;\n    position: absolute;\n    background-color: #ffffff;\n    border: 2px solid #b0b3b8;\n}\n[id^='zego-box-container'] .operation-point-desktop:active,\n[id^='zego-box-container'] .operation-point-desktop:hover {\n    transform: scale(1.5);\n    border: 2px solid #eb98c7;\n}\n\n[id^='zego-box-container'] .operation-point-desktop.left-top {\n    left: -6px;\n    top: -6px;\n    cursor: nwse-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right-top {\n    right: -6px;\n    top: -6px;\n    cursor: nesw-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.left-bottom {\n    left: -6px;\n    bottom: -6px;\n    cursor: nesw-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right-bottom {\n    right: -6px;\n    bottom: -6px;\n    cursor: nwse-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.top {\n    top: -6px;\n    cursor: ns-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right {\n    right: -6px;\n    cursor: ew-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.bottom {\n    bottom: -6px;\n    cursor: ns-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.left {\n    left: -6px;\n    cursor: ew-resize;\n}\n",""]),e.exports=t},function(e,t,r){var i=r(11),o=r(68),n=r(21),a=r(75).f,s=function(e){return function(t){for(var r,s=n(t),c=o(s),d=c.length,l=0,u=[];d>l;)r=c[l++],i&&!a.call(s,r)||u.push(e?[r,s[r]]:s[r]);return u}};e.exports={entries:s(!0),values:s(!1)}},function(e,t,r){"use strict";var i,o=r(2),n=r(34).f,a=r(7),s=r(194),c=r(20),d=r(195),l=r(39),u="".startsWith,h=Math.min,p=d("startsWith");o({target:"String",proto:!0,forced:!!(l||p||(i=n(String.prototype,"startsWith"),!i||i.writable))&&!p},{startsWith:function(e){var t=String(c(this));s(e);var r=a(h(arguments.length>1?arguments[1]:void 0,t.length)),i=String(e);return u?u.call(t,i,r):t.slice(r,r+i.length)===i}})},function(e,t,r){var i=r(20),o=/"/g;e.exports=function(e,t,r,n){var a=String(i(e)),s="<"+t;return""!==r&&(s+=" "+r+'="'+String(n).replace(o,"&quot;")+'"'),s+">"+a+"</"+t+">"}},function(e,t,r){var i=r(4);e.exports=function(e){return i((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},function(e,t,r){var i=r(2),o=r(107),n=r(69);i({target:"Array",proto:!0},{fill:o}),n("fill")},function(e,t,r){"use strict";var i=r(2),o=r(13).find,n=r(69),a=!0;"find"in[]&&Array(1).find((function(){a=!1})),i({target:"Array",proto:!0,forced:a},{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),n("find")},function(e,t,r){"use strict";var i=r(2),o=r(67),n=[].reverse,a=[1,2];i({target:"Array",proto:!0,forced:String(a)===String(a.reverse())},{reverse:function(){return o(this)&&(this.length=this.length),n.call(this)}})},function(e,t,r){var i=r(2),o=r(279);i({global:!0,forced:parseFloat!=o},{parseFloat:o})},function(e,t,r){var i=r(3),o=r(148).trim,n=r(149),a=i.parseFloat,s=1/a(n+"-0")!=-1/0;e.exports=s?function(e){var t=o(String(e)),r=a(t);return 0===r&&"-"==t.charAt(0)?-0:r}:a},function(e,t,r){var i=r(2),o=r(281);i({global:!0,forced:parseInt!=o},{parseInt:o})},function(e,t,r){var i=r(3),o=r(148).trim,n=r(149),a=i.parseInt,s=/^[+-]?0[Xx]/,c=8!==a(n+"08")||22!==a(n+"0x16");e.exports=c?function(e,t){var r=o(String(e));return a(r,t>>>0||(s.test(r)?16:10))}:a},function(e,t,r){"use strict";var i=r(2),o=r(193).start;i({target:"String",proto:!0,forced:r(283)},{padStart:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var i=r(59);e.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(i)},function(e,t,r){var i;!function(){"use strict";function o(e,t,r){var i=t.x,o=t.y,n=r.x-i,a=r.y-o;if(0!==n||0!==a){var s=((e.x-i)*n+(e.y-o)*a)/(n*n+a*a);s>1?(i=r.x,o=r.y):s>0&&(i+=n*s,o+=a*s)}return(n=e.x-i)*n+(a=e.y-o)*a}function n(e,t){var r=e.length-1,i=[e[0]];return function e(t,r,i,n,a){for(var s,c=n,d=r+1;d<i;d++){var l=o(t[d],t[r],t[i]);l>c&&(s=d,c=l)}c>n&&(s-r>1&&e(t,r,s,n,a),a.push(t[s]),i-s>1&&e(t,s,i,n,a))}(e,0,r,t,i),i.push(e[r]),i}function a(e,t,r){if(e.length<=2)return e;var i=void 0!==t?t*t:1;return e=n(e=r?e:function(e,t){for(var r,i,o,n,a,s=e[0],c=[s],d=1,l=e.length;d<l;d++)r=e[d],o=s,n=void 0,a=void 0,n=(i=r).x-o.x,a=i.y-o.y,n*n+a*a>t&&(c.push(r),s=r);return s!==r&&c.push(r),c}(e,i),i)}void 0===(i=function(){return a}.call(t,r,t,e))||(e.exports=i)}()},function(e,t,r){e.exports=function(e,t){var r,i,o,n,a,s,c,d;for(r=3&e.length,i=e.length-r,o=t,a=3432918353,s=461845907,d=0;d<i;)c=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24,++d,o=27492+(65535&(n=5*(65535&(o=(o^=c=(65535&(c=(c=(65535&c)*a+(((c>>>16)*a&65535)<<16)&4294967295)<<15|c>>>17))*s+(((c>>>16)*s&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(n>>>16)&65535)<<16);switch(c=0,r){case 3:c^=(255&e.charCodeAt(d+2))<<16;case 2:c^=(255&e.charCodeAt(d+1))<<8;case 1:o^=c=(65535&(c=(c=(65535&(c^=255&e.charCodeAt(d)))*a+(((c>>>16)*a&65535)<<16)&4294967295)<<15|c>>>17))*s+(((c>>>16)*s&65535)<<16)&4294967295}return o^=e.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0}},function(e,t,r){r(163)("Int32",(function(e){return function(t,r,i){return e(this,t,r,i)}}))},function(e,t,r){"use strict";var i=r(164);(0,r(5).exportTypedArrayStaticMethod)("from",r(165),i)},function(e,t,r){"use strict";r.r(t),r.d(t,"ZegoExpressEngine",(function(){return rt}));r(76),r(77),r(78),r(49),r(27),r(151),r(152),r(29),r(48),r(73);var i,o,n,a,s,c=r(259);r(65),r(269),r(204),r(196),r(25),r(54),r(244),r(108),r(46),r(245),r(254),r(47),r(26),r(60),r(147),r(79),r(63),r(109),r(28),r(32),r(56),r(57),r(74),r(272),r(246);!function(e){e[e.ZegoWhiteboardViewErrorInternal=3000001]="ZegoWhiteboardViewErrorInternal",e[e.ZegoWhiteboardViewErrorParamInvalid=3000002]="ZegoWhiteboardViewErrorParamInvalid",e[e.ZegoWhiteboardViewErrorNetworkTimeout=3000003]="ZegoWhiteboardViewErrorNetworkTimeout",e[e.ZegoWhiteboardViewErrorNetworkDisconnect=3000004]="ZegoWhiteboardViewErrorNetworkDisconnect",e[e.ZegoWhiteboardViewErrorInvalidRsp=3000005]="ZegoWhiteboardViewErrorInvalidRsp",e[e.ZegoWhiteboardViewErrorRequestTooMany=3000006]="ZegoWhiteboardViewErrorRequestTooMany",e[e.ZegoWhiteboardViewErrorNoLoginRoom=3010001]="ZegoWhiteboardViewErrorNoLoginRoom",e[e.ZegoWhiteboardViewErrorUserNotExist=3010002]="ZegoWhiteboardViewErrorUserNotExist",e[e.ZegoWhiteboardViewErrorViewNotExist=3020001]="ZegoWhiteboardViewErrorViewNotExist",e[e.ZegoWhiteboardViewErrorViewCreateFail=3020002]="ZegoWhiteboardViewErrorViewCreateFail",e[e.ZegoWhiteboardViewErrorViewModifyFail=3020003]="ZegoWhiteboardViewErrorViewModifyFail",e[e.ZegoWhiteboardViewErrorViewNameLimit=3020004]="ZegoWhiteboardViewErrorViewNameLimit",e[e.ZegoWhiteboardViewErrorViewParentNotExist=3020005]="ZegoWhiteboardViewErrorViewParentNotExist",e[e.ZegoWhiteboardViewErrorViewNumLimit=3020006]="ZegoWhiteboardViewErrorViewNumLimit",e[e.ZegoWhiteboardViewErrorGraphicNotExist=3030001]="ZegoWhiteboardViewErrorGraphicNotExist",e[e.ZegoWhiteboardViewErrorGraphicCreateFail=3030002]="ZegoWhiteboardViewErrorGraphicCreateFail",e[e.ZegoWhiteboardViewErrorGraphicModifyFail=3030003]="ZegoWhiteboardViewErrorGraphicModifyFail",e[e.ZegoWhiteboardViewErrorGraphicUnableDraw=3030004]="ZegoWhiteboardViewErrorGraphicUnableDraw",e[e.ZegoWhiteboardViewErrorGraphicDataLimit=3030005]="ZegoWhiteboardViewErrorGraphicDataLimit",e[e.ZegoWhiteboardViewErrorGraphicNumLimit=3030006]="ZegoWhiteboardViewErrorGraphicNumLimit",e[e.ZegoWhiteboardViewErrorGraphicTextLimit=3030007]="ZegoWhiteboardViewErrorGraphicTextLimit",e[e.ZegoWhiteboardViewErrorGraphicImageSizeLimit=3030008]="ZegoWhiteboardViewErrorGraphicImageSizeLimit",e[e.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport=3030009]="ZegoWhiteboardViewErrorGraphicImageTypeNotSupport",e[e.ZegoWhiteboardViewErrorGraphicIllegalUrl=3030010]="ZegoWhiteboardViewErrorGraphicIllegalUrl",e[e.ZegoWhiteboardViewErrorInitFail=3040001]="ZegoWhiteboardViewErrorInitFail",e[e.ZegoWhiteboardViewErrorGetListFail=3040002]="ZegoWhiteboardViewErrorGetListFail",e[e.ZegoWhiteboardViewErrorCreateFail=3040003]="ZegoWhiteboardViewErrorCreateFail",e[e.ZegoWhiteboardViewErrorDestroyFail=3040004]="ZegoWhiteboardViewErrorDestroyFail",e[e.ZegoWhiteboardViewErrorAttachFail=3040005]="ZegoWhiteboardViewErrorAttachFail",e[e.ZegoWhiteboardViewErrorClearFail=3040006]="ZegoWhiteboardViewErrorClearFail",e[e.ZegoWhiteboardViewErrorScrollFail=3040007]="ZegoWhiteboardViewErrorScrollFail",e[e.ZegoWhiteboardViewErrorUndoFail=3040008]="ZegoWhiteboardViewErrorUndoFail",e[e.ZegoWhiteboardViewErrorRedoFail=3040009]="ZegoWhiteboardViewErrorRedoFail"}(i||(i={})),function(e){e[e.ZegoWhiteboardViewToolPen=1]="ZegoWhiteboardViewToolPen",e[e.ZegoWhiteboardViewToolText=2]="ZegoWhiteboardViewToolText",e[e.ZegoWhiteboardViewToolLine=4]="ZegoWhiteboardViewToolLine",e[e.ZegoWhiteboardViewToolRect=8]="ZegoWhiteboardViewToolRect",e[e.ZegoWhiteboardViewToolEllipse=16]="ZegoWhiteboardViewToolEllipse",e[e.ZegoWhiteboardViewToolSelector=32]="ZegoWhiteboardViewToolSelector",e[e.ZegoWhiteboardViewToolEraser=64]="ZegoWhiteboardViewToolEraser",e[e.ZegoWhiteboardViewToolLaser=128]="ZegoWhiteboardViewToolLaser",e[e.ZegoWhiteboardViewToolClick=256]="ZegoWhiteboardViewToolClick",e[e.ZegoWhitebaordViewToolCustomImage=512]="ZegoWhitebaordViewToolCustomImage"}(o||(o={})),function(e){e[e.ZegoWhiteboardOperationModeNone=1]="ZegoWhiteboardOperationModeNone",e[e.ZegoWhiteboardOperationModeScroll=2]="ZegoWhiteboardOperationModeScroll",e[e.ZegoWhiteboardOperationModeDraw=4]="ZegoWhiteboardOperationModeDraw",e[e.ZegoWhiteboardOperationModeZoom=8]="ZegoWhiteboardOperationModeZoom"}(n||(n={})),function(e){e[e.ZegoWhiteboardViewImageGraphic=0]="ZegoWhiteboardViewImageGraphic",e[e.ZegoWhiteboardViewImageCustom=1]="ZegoWhiteboardViewImageCustom"}(a||(a={})),function(e){e[e.Center=0]="Center",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(s||(s={}));var d,l,u,h,p,f,g,m,v,y,S={sizeWidth:1280,placeWidth:128e4,minFontSize:window.hasOwnProperty("ontouchstart")?1:12,maxFontSize:100,minLineWidth:1,maxLineWidth:100};!function(e){e[e.PPT=1]="PPT",e[e.DOC=2]="DOC",e[e.ELS=4]="ELS",e[e.PDF=8]="PDF",e[e.IMG=16]="IMG",e[e.TXT=32]="TXT",e[e.PPTH5=512]="PPTH5"}(d||(d={})),function(e){e[e.Single=1]="Single",e[e.Multi=2]="Multi",e[e.Other=4]="Other"}(l||(l={})),function(e){e[e.Append=1]="Append",e[e.Update=2]="Update",e[e.Delete=4]="Delete",e[e.Move=8]="Move",e[e.Create=32]="Create"}(u||(u={})),function(e){e[e.Local=0]="Local",e[e.Remote=1]="Remote",e[e.UnReDo=2]="UnReDo"}(h||(h={})),function(e){e[e.Pencil=1]="Pencil",e[e.Text=2]="Text",e[e.Line=4]="Line",e[e.Rect=8]="Rect",e[e.Ellipse=16]="Ellipse",e[e.Laser=128]="Laser",e[e.Image=256]="Image",e[e.RealTime=999]="RealTime"}(p||(p={})),function(e){e[e.Pc=1]="Pc",e[e.Mobile=2]="Mobile"}(f||(f={})),function(e){e[e.Init=1]="Init",e[e.Down=2]="Down",e[e.Move=3]="Move",e[e.DownMove=4]="DownMove",e[e.DownMoveUp=5]="DownMoveUp",e[e.DownNoMoveUp=6]="DownNoMoveUp",e[e.Leave=7]="Leave",e[e.DownLeave=8]="DownLeave"}(g||(g={})),function(e){e[e.success=1]="success",e[e.error=2]="error"}(m||(m={})),function(e){e[e.InProgress=1]="InProgress",e[e.Pending=2]="Pending"}(v||(v={}));var b=((y={})[i.ZegoWhiteboardViewErrorInternal]="内部错误",y[i.ZegoWhiteboardViewErrorParamInvalid]="参数错误",y[i.ZegoWhiteboardViewErrorNetworkTimeout]="网络超时",y[i.ZegoWhiteboardViewErrorNetworkDisconnect]="网络断开",y[i.ZegoWhiteboardViewErrorInvalidRsp]="网络回包错误",y[i.ZegoWhiteboardViewErrorRequestTooMany]="请求过于频繁",y[i.ZegoWhiteboardViewErrorNoLoginRoom]="未登录房间",y[i.ZegoWhiteboardViewErrorUserNotExist]="用户不存在",y[i.ZegoWhiteboardViewErrorViewNotExist]="白板view不存在",y[i.ZegoWhiteboardViewErrorViewCreateFail]="创建白板view失败",y[i.ZegoWhiteboardViewErrorViewModifyFail]="修改白板view失败",y[i.ZegoWhiteboardViewErrorViewNameLimit]="白板view名称过长",y[i.ZegoWhiteboardViewErrorViewParentNotExist]="白板view的parent不存在",y[i.ZegoWhiteboardViewErrorViewNumLimit]="超过图元最大数量限制",y[i.ZegoWhiteboardViewErrorGraphicNotExist]="图元不存在",y[i.ZegoWhiteboardViewErrorGraphicCreateFail]="创建图元错误",y[i.ZegoWhiteboardViewErrorGraphicModifyFail]="修改图元错误",y[i.ZegoWhiteboardViewErrorGraphicUnableDraw]="未开启绘制",y[i.ZegoWhiteboardViewErrorGraphicDataLimit]="图元数据大小超过限制",y[i.ZegoWhiteboardViewErrorGraphicNumLimit]="超过图元最大数量限制",y[i.ZegoWhiteboardViewErrorGraphicTextLimit]="文本字数超过上限",y[i.ZegoWhiteboardViewErrorGraphicImageSizeLimit]="图片图元大小超限制",y[i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport]="不支持的图片类型",y[i.ZegoWhiteboardViewErrorGraphicIllegalUrl]="非法图片url",y[i.ZegoWhiteboardViewErrorInitFail]="初始化失败",y[i.ZegoWhiteboardViewErrorGetListFail]="拉取白板view列表失败",y[i.ZegoWhiteboardViewErrorCreateFail]="创建白板view失败",y[i.ZegoWhiteboardViewErrorDestroyFail]="销毁白板view失败",y[i.ZegoWhiteboardViewErrorAttachFail]="attach白板view失败",y[i.ZegoWhiteboardViewErrorClearFail]="清空白板view失败",y[i.ZegoWhiteboardViewErrorScrollFail]="滚动白板view失败",y[i.ZegoWhiteboardViewErrorUndoFail]="撤销操作失败",y[i.ZegoWhiteboardViewErrorRedoFail]="重做操作失败",y),E={1003:i.ZegoWhiteboardViewErrorNoLoginRoom,1014:i.ZegoWhiteboardViewErrorUserNotExist,1101:i.ZegoWhiteboardViewErrorViewNotExist,1102:i.ZegoWhiteboardViewErrorViewCreateFail,1104:i.ZegoWhiteboardViewErrorViewModifyFail,1114:i.ZegoWhiteboardViewErrorViewNumLimit,1212:i.ZegoWhiteboardViewErrorGraphicCreateFail,1201:i.ZegoWhiteboardViewErrorGraphicModifyFail,1202:i.ZegoWhiteboardViewErrorGraphicModifyFail,1219:i.ZegoWhiteboardViewErrorGraphicModifyFail,1217:i.ZegoWhiteboardViewErrorGraphicDataLimit,1222:i.ZegoWhiteboardViewErrorGraphicDataLimit,1223:i.ZegoWhiteboardViewErrorGraphicNumLimit,10001e3:i.ZegoWhiteboardViewErrorInternal,10001001:i.ZegoWhiteboardViewErrorParamInvalid,111001002:i.ZegoWhiteboardViewErrorNetworkTimeout,111001001:i.ZegoWhiteboardViewErrorNetworkDisconnect,60003001:i.ZegoWhiteboardViewErrorInvalidRsp,111101001:i.ZegoWhiteboardViewErrorRequestTooMany,112001003:i.ZegoWhiteboardViewErrorNoLoginRoom,112001014:i.ZegoWhiteboardViewErrorUserNotExist,112001101:i.ZegoWhiteboardViewErrorViewNotExist,112001102:i.ZegoWhiteboardViewErrorViewCreateFail,112001104:i.ZegoWhiteboardViewErrorViewModifyFail,112001114:i.ZegoWhiteboardViewErrorViewNumLimit,112001212:i.ZegoWhiteboardViewErrorGraphicCreateFail,112001201:i.ZegoWhiteboardViewErrorGraphicModifyFail,112001202:i.ZegoWhiteboardViewErrorGraphicModifyFail,112001219:i.ZegoWhiteboardViewErrorGraphicModifyFail,112001217:i.ZegoWhiteboardViewErrorGraphicDataLimit,112001222:i.ZegoWhiteboardViewErrorGraphicDataLimit,112001223:i.ZegoWhiteboardViewErrorGraphicNumLimit,110000003:i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport,110000004:i.ZegoWhiteboardViewErrorGraphicImageSizeLimit,110000005:i.ZegoWhiteboardViewErrorGraphicIllegalUrl},C=function(e,t,r){return{code:e=E[e]||e,msg:t=b[e]&&r&&t?t:b[e]||t||b[i.ZegoWhiteboardViewErrorInternal]}},_=(r(275),r(81),r(276),r(146),r(82),r(277),r(62),r(97),r(110),r(44),r(255),r(278),r(280),r(161),r(282),"undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)),T=new Uint8Array(16);function R(){if(!_)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _(T)}for(var I=[],L=0;L<256;++L)I.push((L+256).toString(16).substr(1));var w=function(e,t){var r=t||0;return(I[e[r+0]]+I[e[r+1]]+I[e[r+2]]+I[e[r+3]]+"-"+I[e[r+4]]+I[e[r+5]]+"-"+I[e[r+6]]+I[e[r+7]]+"-"+I[e[r+8]]+I[e[r+9]]+"-"+I[e[r+10]]+I[e[r+11]]+I[e[r+12]]+I[e[r+13]]+I[e[r+14]]+I[e[r+15]]).toLowerCase()};var M=function(e,t,r){var i=(e=e||{}).random||(e.rng||R)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=i[o];return t}return w(i)},k=r(284),P=r(285),x=function(){return""+P(M())},D=function(e){if(e){var t=e.parentNode;t?t.removeChild(e):e.remove?e.remove():e.removeNode()}},N=function(e,t,r,i){var o,n=S.sizeWidth,a=S.minFontSize,s=S.minLineWidth;return i?o=Math.round(e*n/r):(o=Math.round(r*e/n),p.Text===t?o<a&&(o=a):o<s&&(o=s)),o},A=function(e){for(var t=e.length,r=.1,i=t-4,o="M"+e[0]+", "+e[1],n=0;n<t-2;n+=2){var a=n?e[n-2]:e[0],s=n?e[n-1]:e[1],c=e[n+0],d=e[n+1],l=e[n+2],u=e[n+3],h=n!==i?e[n+4]:l,p=n!==i?e[n+5]:u;o+=" C"+(Number(c)+(l-a)/6*r)+","+(Number(d)+(u-s)/6*r)+","+(Number(l)-(h-c)/6*r)+","+(Number(u)-(p-d)/6*r)+","+l+","+u}return o},O=function(e){var t=e[0],r=e[1],i=e[2],o=e[3];return[Math.min(t,i||t),Math.min(r,o||r)]},U=function(e,t){var r;switch(e){case p.Pencil:r={d:A(t)};break;case p.Line:r={x1:t[0],y1:t[1],x2:t[2]||t[0],y2:t[3]||t[1]};break;case p.Rect:var i=Math.abs((t[2]||t[0])-t[0]),o=Math.abs((t[3]||t[1])-t[1]),n=O(t);r={x:n[0],y:n[1],width:i,height:o};break;case p.Ellipse:var a=Math.abs((t[2]||t[0])-t[0])/2,s=Math.abs((t[3]||t[1])-t[1])/2,c=O(t);r={cx:c[0]+a,cy:c[1]+s,rx:a,ry:s};break;default:r=!1}return r},z=function(e,t){t.forEach((function(t){e.setAttribute(t.attr,t.value)}))},H=function(e,t,r,i){var o,n=document.querySelector("#"+e);if(n)return i&&n.setAttribute("data-z",i+""),[o=n.querySelector("#"+t)];n=document.createElementNS("http://www.w3.org/2000/svg","svg");var a=document.createElementNS("http://www.w3.org/2000/svg","g");return o=document.createElementNS("http://www.w3.org/2000/svg",r),n.id=e,n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("version","1.1"),i&&n.setAttribute("data-z",i+""),o.id=t,a.appendChild(o),n.appendChild(a),[o,n]},B=function(e){var t=[],r=[];return e.forEach((function(e,t,i){t%2==0&&r.push({x:e,y:i[t+1]})})),k(r,1).forEach((function(e){t=t.concat([e.x,e.y])})),t},q=function(e){return e.children||e.childNodes},V=function(e){var t=e.split(",");return{beginX:t[0],beginY:t[1],text:t.slice(2).join(",")}},W=function(e,t,r){return parseInt(t)+","+parseInt(r)+","+e},F=function(e){return/^#[0-9a-fA-F]{6}|rgba?\(*.+\d\)$/.test(e)},G=function(e,t){return t?"#"+(e=e.toString(16)).slice(2).padStart(6,"0"):(e=function(e){if(0===e.indexOf("#"))return e;var t=e.replace(/rgba?/,"").replace(/\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),r=parseFloat(t[3]||"1"),i=Math.floor(r*parseInt(t[0])+255*(1-r)),o=Math.floor(r*parseInt(t[1])+255*(1-r)),n=Math.floor(r*parseInt(t[2])+255*(1-r));return"#"+("0"+i.toString(16)).slice(-2)+("0"+o.toString(16)).slice(-2)+("0"+n.toString(16)).slice(-2)}(e),parseInt("0xFF"+e.split("#")[1]))},j=function(e){return"number"==typeof e&&!isNaN(e)},Z=function(){return(Z=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},J=function(){function e(e){var t=this;this.bindFlag=!1,this.eventList=[{name:"moveEventName",handle:"mousemoveHandle"},{name:"leaveEventName",handle:"mouseleaveHandle"}],this.laserInfo={hiddenX:-100,hiddenY:-100,initX:0,initY:0},this.mousemoveHandle=function(e){if(t.toolInstance.canDraw){e instanceof TouchEvent&&e.preventDefault(),t.drawLaserMoveBeforeHandle();var r=t.getMouseChangedPoint(e),i=t.addLaserHandle(void 0,r);i.x=r.clientX,i.y=r.clientY,i.is_end_draw=!0,i.operate_id=x(),t.drawGraphicsHandle(i,!0),t.toolInstance.updateToRemoteNewHandle([t.calLaserActualPlaceHandle(i)],u.Move)}},this.mouseleaveHandle=function(){t.toolInstance.canDraw&&t.laserHiddenHandle()},this.wheelHandle=function(e){var r;if(t.toolInstance.canDraw){e.preventDefault();var i=t.toolInstance,o=i.whiteboardID,n=i.whiteboardStore.reservedPrefix.whiteboard,a=null===(r=document.querySelector("#"+n+o))||void 0===r?void 0:r.parentNode,s=a.getBoundingClientRect(),c=s.width;s.height!==a.scrollHeight&&(a.scrollTop+=Number(e.deltaY.toFixed(7))),c!==a.scrollWidth&&(a.scrollLeft+=Number(e.deltaX.toFixed(7)))}},this.toolInstance=e,this.laserContainerNode=this.addLaserConDomHandle(),this.updateZIndexHandle(-1)}return e.prototype.transLocationHandle=function(e){var t=e.clientX,r=e.clientY,i=this.toolInstance,o=i.offsetData,n=i.scrollData,a=o.offsetLeft,s=o.offsetTop,c=n.scrollTop,d=n.scrollLeft,l=this.toolInstance.conNode,u=l.scrollLeft,h=l.scrollTop;return{clientX:Math.round(t-a+d-u),clientY:Math.round(r-s+c-h)}},e.prototype.getMouseChangedPoint=function(e){var t;if(e instanceof MouseEvent){var r=e,i=r.clientX,o=r.clientY;t=this.transLocationHandle({clientX:i,clientY:o})}else{var n=e.changedTouches[0];i=n.clientX,o=n.clientY;t=this.transLocationHandle({clientX:i,clientY:o})}return t},e.prototype.drawLaserMoveBeforeHandle=function(){this.toolInstance.updateOffsetHandle(),this.toolInstance.updateScrollHandle()},e.prototype.laserHiddenHandle=function(e){var t=this.findLaserHandle(e);if(t){var r=this.laserInfo,i=r.hiddenX,o=r.hiddenY;Object.assign(t,{x:i,y:o,px:0,py:0}),this.toolInstance.moveGraphicsHandle(t.graphic_id,i,o),e||(t.is_end_draw=!0,t.operate_id=x(),this.toolInstance.updateToRemoteNewHandle([t],u.Move))}},e.prototype.addLaserHandle=function(e,t){var r=this.toolInstance,i=r.whiteboardStore,o=r.graphicList;if(!e){var n=this.findLaserHandle();if(n)return n;var a=this.laserInfo,s=a.initX,c=a.initY,d=a.hiddenX,l=a.hiddenY;e=Z(Z({graphic_id:x()},i.basicState),{type:p.Laser,x:d,y:l,px:0,py:0,data:[s,c],zorder:this.toolInstance.serviceHandle.createZorder()})}return(e=e).operate_id=x(),e.is_end_draw=!0,o.push(e),this.drawGraphicsHandle(e,!0),this.toolInstance.updateToRemoteNewHandle([this.calLaserActualPlaceHandle(e)],u.Create),e},e.prototype.findLaserHandle=function(e){var t=this;return this.toolInstance.graphicList.filter((function(r){return e?r.graphic_id===e:r.type===p.Laser&&(!r.id_name||r.id_name===t.toolInstance.getUserName())}))[0]},e.prototype.addLaserConDomHandle=function(){var e=this.toolInstance,t=e.whiteboardID,r=""+e.whiteboardStore.reservedPrefix.laserContainer+t,i=this.toolInstance.userNode.querySelector("#"+r);return i||((i=document.createElement("div")).id=r,this.toolInstance.zoomNode.appendChild(i),this.updateLaserConSize(i),i)},e.prototype.updateZIndexHandle=function(e){this.laserContainerNode.style.zIndex=""+e,this.laserContainerNode.style.visibility=-1===e?"hidden":"visible"},e.prototype.drawGraphicsHandle=function(e,t){var r=this.toolInstance.getUserName(),i=e.graphic_id,o=e.data,n=e.id_name,a=e.x,s=e.y;if(n===r&&!t){t=!0;var c=this.calLaserPlaceHandle(a,s),d=c.x,l=c.y;e.x=d,e.y=l,a=d,s=l}var u=this.toolInstance.whiteboardStore.reservedPrefix,h=""+u.graphics+i,f=""+u.laserCon+i,g=this.toolInstance.userNode.querySelector("#"+h);if(!g){g=document.createElement("div");var m=document.createElement("div");g.id=h,m.id=f,m.appendChild(g),t?this.laserContainerNode.appendChild(m):this.toolInstance.appendGraphicsDomHandle(m,p.Laser)}var v="transform:translate("+(a||0)+"px, "+(s||0)+"px)"+(t?";":"scale("+1/this.toolInstance.viewInfo.zoom+");")+"left:"+o[0]+"px;top:"+o[1]+"px;";g.parentNode.style.cssText=v},e.prototype.bindEventsHandle=function(){var e=this;if(this.updateZIndexHandle("initial"),!this.bindFlag){this.bindFlag=!0;var t=this.toolInstance.whiteboardStore;this.eventList.forEach((function(t){var r=t.name,i=t.handle;e.toolInstance.toolAddEL(e.laserContainerNode,r,e[i])})),this.toolInstance.viewInfo.isScroll&&this.laserContainerNode.addEventListener(t.wheelEventName,this.wheelHandle)}},e.prototype.removeEventsHandle=function(){var e=this;if(this.bindFlag){this.bindFlag=!1,this.updateZIndexHandle(-1);var t=this.toolInstance.whiteboardStore;this.eventList.forEach((function(t){var r=t.name,i=t.handle;e.toolInstance.toolRmEl(e.laserContainerNode,r,e[i])})),this.laserContainerNode.removeEventListener(t.wheelEventName,this.wheelHandle)}},e.prototype.calLaserActualPlaceHandle=function(e){var t=(e=JSON.parse(JSON.stringify(e))).x,r=e.y,i=this.toolInstance.viewInfo,o=i.zoom,n=i.zoomTX,a=i.zoomTY,s=i.offsetPageX,c=i.offsetPageY,d=this.toolInstance.conNode,l=d.scrollLeft,u=d.scrollTop;return e.x=Math.round((t+8+l-n)/o+s),e.y=Math.round((r+8+u-a)/o+c),e},e.prototype.calLaserPlaceHandle=function(e,t){var r=this.toolInstance.viewInfo,i=r.zoom,o=r.zoomTX,n=r.zoomTY,a=r.offsetPageX,s=r.offsetPageY,c=this.toolInstance.conNode,d=c.scrollLeft,l=c.scrollTop;return{x:e=Math.round((e-a)*i+o-d),y:t=Math.round((t-s)*i+n-l)}},e.prototype.pushActualPlaceHandle=function(){this.toolInstance.updateScrollHandle();var e=this.findLaserHandle();e&&(e.is_end_draw=!0,e.operate_id=x(),this.toolInstance.updateToRemoteNewHandle([this.calLaserActualPlaceHandle(e)],u.Move))},e.prototype.clearLaserHandle=function(e){var t;(t=e?this.toolInstance.graphicList.filter((function(t){return t.id_name===e}))[0]:this.findLaserHandle())&&(t.is_end_draw=!0,t.operate_id=x(),this.toolInstance.deleteHandle(t.graphic_id),this.toolInstance.updateToRemoteNewHandle([t],u.Delete))},e.prototype.updateLaserConSize=function(e){var t;e=e||this.laserContainerNode;var r=this.toolInstance.viewInfo.isScroll?18:0,i="z-index:"+(e.style.zIndex||"initial")+";";if(r){var o=this.toolInstance,n=o.whiteboardID,a=o.whiteboardStore.reservedPrefix.whiteboard,s=null===(t=document.querySelector("#"+a+n))||void 0===t?void 0:t.parentNode,c=s.getBoundingClientRect(),d=c.width,l=c.height;l!==s.scrollHeight&&(i+="width:"+(d-r)+"px;"),d!==s.scrollWidth&&(i+="height:"+(l-r)+"px;")}e.style.cssText=i},e}(),Y=function(){return(Y=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},X=function(){function e(e){var t=this;this.bindFlag=!1,this.eventList=[{name:"downEventName",handle:"mousedownHandle"},{name:"moveEventName",handle:"mousemoveHandle"},{name:"upEventName",handle:"mouseupHandle"},{name:"leaveEventName",handle:"mouseupHandle"}],this.isIos11=navigator.userAgent.includes("iPhone")&&navigator.userAgent.includes("11_4_1"),this.upSwitch=!1,this.mouseInfo={moveCount:0,moveTaskId:0},this.mousedownHandle=function(e){var r=t.toolInstance,i=r.whiteboardNode,n=r.whiteboardStore;if(r.canDraw&&t.toolInstance.downCommonHandle(e)){t.updateUpSwitchHandle(!0);var a=t.toolInstance.getMouseStartPoint(e),s=a.clientX,c=a.clientY,d=n.basicExtraState.customImage.url,l=n.basicState.type===o.ZegoWhitebaordViewToolCustomImage&&d?p.Image:n.basicState.type,u=l===p.Image?{x:s,y:c,ex:0,ey:0,url:d,hash:""}:[s,c];t.toolInstance.updateMousePointsHandle(s,c),t.toolInstance.updateProtoGraphic(Y(Y({graphic_id:x()},n.basicState),{type:l,x:0,y:0,px:0,py:0,data:u,operate_id:x(),is_end_draw:!1,zorder:t.toolInstance.serviceHandle.createZorder()})),t.realTimeStartHandle(),t.mouseInfo.moveCount=0,t.mouseInfo.moveTaskId=0,t.toolInstance.toolAddEL(i,"moveEventName",t.mousemoveHandle)}},this.mousemoveHandle=function(e){if(t.toolInstance.canDraw&&(!(e instanceof TouchEvent)||t.toolInstance.downCommonHandle(e))){var r=t.toolInstance,i=r.protoGraphic,o=r.whiteboardNode;if(e instanceof MouseEvent&&!e.buttons)return t.toolInstance.toolRmEl(o,"moveEventName",t.mousemoveHandle),t.toolInstance.deleteHandle(i.graphic_id),void t.toolInstance.initDrawHandle();var n=t.toolInstance.getMouseChangedPoint(e);t.toolInstance.updateGraphicsDataHandle(n);var s=i.type===p.Image?a.ZegoWhiteboardViewImageCustom:void 0;t.drawGraphicsHandle(i,h.Local,s),t.realTimeDrawHandle(),t.catchMouseMoveException()}},this.mouseupHandle=function(){if(t.toolInstance.canDraw&&t.upSwitch){var e=t.toolInstance,r=e.protoGraphic,i=e.graphicList,o=e.whiteboardNode;t.toolInstance.toolRmEl(o,"moveEventName",t.mousemoveHandle),t.updateUpSwitchHandle(!1),t.mouseInfo.moveCount=0,t.mouseInfo.moveTaskId=0;var n=r.graphic_id,a=r.type;if(n&&t.toolInstance.updateBoxHandle(r)){if(a===p.Pencil){var s=t.toolInstance.getGraphicsHandle(n);if(!s)return;var c=B(r.data);q(s)[0].setAttribute("d",U(p.Pencil,c).d),t.toolInstance.updateProtoGraphic({data:c})}else if(a===p.Image){var d=r.data,l=d.x,u=d.y,h=d.ex,f=d.ey;if(l===h||u===f)return t.toolInstance.deleteHandle(r.graphic_id),void t.toolInstance.initDrawHandle();t.checkImageRect(d),r.initX=d.x,r.initY=d.y,r.oldData=Y({},d)}r.is_end_draw=!0;var g=JSON.parse(JSON.stringify(r));t.toolInstance.setGraphicsDomZorder(g),i.push(g),t.realTimeEndHandle()}t.toolInstance.initDrawHandle()}},this.toolInstance=e}return e.prototype.catchMouseMoveException=function(){var e=this;this.mouseInfo.moveTaskId||(this.mouseInfo.moveTaskId=window.setTimeout((function(){if(e.mouseInfo.moveCount<5){var t=e.toolInstance.userNode.querySelector("#zego-whiteboard-input");t||((t=document.createElement("input")).id="zego-whiteboard-input",t.tabIndex=-1,e.toolInstance.userNode.insertBefore(t,e.toolInstance.userNode.firstChild)),t.focus()}}),200)),this.mouseInfo.moveCount++},e.prototype.realTimeStartHandle=function(){var e=this.toolInstance.protoGraphic;e.type!==p.Image&&this.toolInstance.updateToRemoteNewHandle([e],u.Create)},e.prototype.realTimeDrawHandle=function(){var e=this.toolInstance,t=e.protoGraphic,r=e.whiteboardStore;if(t.type!==p.Image)if(t.type===p.Pencil){var i=r.realTimeState.localDrawCount,o=t.data;if(o.length%i==2){var n=JSON.parse(JSON.stringify(t));n.data=B(o.slice(o.length-i)),this.toolInstance.updateToRemoteNewHandle([n],u.Append)}}else this.toolInstance.updateToRemoteNewHandle([t],u.Update)},e.prototype.realTimeEndHandle=function(){var e=this.toolInstance.protoGraphic;this.toolInstance.updateToRemoteNewHandle([e],e.type===p.Image?u.Create:u.Update)},e.prototype.bindEventsHandle=function(){var e=this;if(!this.bindFlag){this.bindFlag=!0;var t=this.toolInstance.whiteboardNode;this.eventList.forEach((function(r){var i=r.name,o=r.handle;"moveEventName"!==i&&e.toolInstance.toolAddEL(t,i,e[o])}))}},e.prototype.removeEventsHandle=function(){var e=this;if(this.bindFlag){this.bindFlag=!1;var t=this.toolInstance.whiteboardNode;this.eventList.forEach((function(r){var i=r.name,o=r.handle;e.toolInstance.toolRmEl(t,i,e[o])}))}},e.prototype.drawGraphicsHandle=function(e,t,r){switch(e.type){case p.Pencil:this.drawGraphicsPath(e,t);break;case p.Line:this.drawGraphicsLine(e,t);break;case p.Ellipse:this.drawGraphicsEllipse(e,t);break;case p.Rect:this.drawGraphicsRect(e,t);break;case p.Image:r===a.ZegoWhiteboardViewImageCustom?this.drawCustomImage(e):this.drawGraphicsImage(e,t)}},e.prototype.updateGraphicsHandle=function(e){switch(e.type){case p.Pencil:this.drawGraphicsPath(e,h.Remote);break;case p.Line:this.drawGraphicsLine(e,h.Remote);break;case p.Ellipse:this.drawGraphicsEllipse(e,h.Remote);break;case p.Rect:this.drawGraphicsRect(e,h.Remote);break;case p.Image:this.updateGraphicsImage(e,h.Remote)}},e.prototype.drawGraphicsLine=function(e,t,r,i,o,n){void 0===r&&(r="none"),void 0===i&&(i=1),void 0===o&&(o="round"),void 0===n&&(n="round");var a=this.toolInstance.whiteboardStore,s=e.data,c=e.graphic_id,d=e.color,l=e.x,u=e.y,h=U(p.Line,s),f=h.x1,g=h.y1,m=h.x2,v=h.y2,y=""+a.reservedPrefix.graphicsSvg+c,S=""+a.reservedPrefix.graphics+c,b=H(y,S,"line",e.zorder);b[1]&&this.toolInstance.appendGraphicsDomHandle(b[1],p.Line),this.toolInstance.triggerAnimateHandle(b[0],t),z(b[0],[{attr:"fill",value:r},{attr:"opacity",value:i},{attr:"stroke",value:d},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:o},{attr:"stroke-linecap",value:n},{attr:"x1",value:f},{attr:"y1",value:g},{attr:"x2",value:m},{attr:"y2",value:v},{attr:"transform",value:"translate("+(l||0)+", "+(u||0)+")"}])},e.prototype.drawGraphicsRect=function(e,t,r,i,o,n){void 0===r&&(r="none"),void 0===i&&(i=1),void 0===o&&(o="round"),void 0===n&&(n="round");var a=this.toolInstance.whiteboardStore,s=e.data,c=e.graphic_id,d=e.color,l=e.x,u=e.y,h=U(p.Rect,s),f=h.width,g=h.height,m=h.x,v=h.y;if(f&&g){var y=""+a.reservedPrefix.graphicsSvg+c,S=""+a.reservedPrefix.graphics+c,b=H(y,S,"rect",e.zorder);b[1]&&this.toolInstance.appendGraphicsDomHandle(b[1],p.Rect),this.toolInstance.triggerAnimateHandle(b[0],t),z(b[0],[{attr:"fill",value:r},{attr:"opacity",value:i},{attr:"stroke",value:d},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:o},{attr:"stroke-linecap",value:n},{attr:"width",value:f},{attr:"height",value:g},{attr:"x",value:m},{attr:"y",value:v},{attr:"transform",value:"translate("+(l||0)+", "+(u||0)+")"}])}},e.prototype.drawGraphicsPath=function(e,t,r,i,o){void 0===r&&(r="none"),void 0===i&&(i="round"),void 0===o&&(o="round");var n=this.toolInstance.whiteboardStore,a=e.color,s=e.graphic_id,c=e.x,d=e.y,l=e.data;if(!(l.length<4)){var u=U(p.Pencil,l).d,h=""+n.reservedPrefix.graphicsSvg+s,f=""+n.reservedPrefix.graphics+s,g=H(h,f,"path",e.zorder);g[1]&&this.toolInstance.appendGraphicsDomHandle(g[1],p.Pencil),this.toolInstance.triggerAnimateHandle(g[0],t),z(g[0],[{attr:"fill",value:r},{attr:"d",value:u},{attr:"stroke",value:a},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:i},{attr:"stroke-linecap",value:o},{attr:"transform",value:"translate("+(c||0)+", "+(d||0)+")"}])}},e.prototype.drawGraphicsEllipse=function(e,t,r,i,o,n){void 0===r&&(r="none"),void 0===i&&(i=1),void 0===o&&(o="round"),void 0===n&&(n="round");var a=this.toolInstance.whiteboardStore,s=e.color,c=e.data,d=e.graphic_id,l=e.x,u=e.y,h=U(p.Ellipse,c),f=h.cx,g=h.cy,m=h.rx,v=h.ry,y=""+a.reservedPrefix.graphicsSvg+d,S=""+a.reservedPrefix.graphics+d,b=H(y,S,"ellipse",e.zorder);b[1]&&this.toolInstance.appendGraphicsDomHandle(b[1],p.Ellipse),this.toolInstance.triggerAnimateHandle(b[0],t),z(b[0],[{attr:"fill",value:r},{attr:"opacity",value:i},{attr:"stroke",value:s},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:o},{attr:"stroke-linecap",value:n},{attr:"cx",value:f},{attr:"cy",value:g},{attr:"rx",value:m},{attr:"ry",value:v},{attr:"transform",value:"translate("+(l||0)+", "+(u||0)+")"}])},e.prototype.drawGraphicImage=function(e,t,r){var i=this;return new Promise((function(o,n){var a=new Image;a.onload=function(){var n=i.toolInstance,s=n.whiteboardStore,c=n.graphicList,d=i.getScaleRect(a.width,a.height),l=d.width,h=d.height,f={x:t,y:r,ex:t+l,ey:r+h,url:e,hash:""},g=x(),m=i.toolInstance.serviceHandle.createZorder(),v=""+s.reservedPrefix.graphicsSvg+g,y=""+s.reservedPrefix.graphics+g,S=H(v,y,"image",m);if(S[1]&&i.toolInstance.appendGraphicsDomHandle(S[1],p.Image),z(S[0],[{attr:"width",value:l},{attr:"height",value:h},{attr:"crossorigin",value:"anonymous"},{attr:"href",value:e},{attr:"transform",value:"translate("+t+", "+r+")"}]),i.isIos11&&S[0].setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e),i.toolInstance.updateProtoGraphic(Y(Y({graphic_id:g},s.basicState),{type:p.Image,x:0,y:0,px:0,py:0,initX:t,initY:r,data:f,oldData:Y({},f),zorder:m})),i.toolInstance.updateOffsetHandle(),i.toolInstance.updateScrollHandle(),i.toolInstance.updateBoxHandle(i.toolInstance.protoGraphic)){var b=JSON.parse(JSON.stringify(i.toolInstance.protoGraphic));b.is_end_draw=!0,b.operate_id=x(),c.push(b),i.toolInstance.updateToRemoteNewHandle([b],u.Create)}i.toolInstance.initDrawHandle(),o(e)},a.onerror=n,a.src=e}))},e.prototype.drawCustomImage=function(e){var t=e.graphic_id,r=this.toolInstance.whiteboardStore,i=r.basicExtraState.customImage,o=i.w,n=i.h,a=e.data,s=a.x,c=a.y,d=a.ex,l=a.ey,u=a.url,h=""+r.reservedPrefix.graphicsSvg+t,f=""+r.reservedPrefix.graphics+t,g=H(h,f,"image",e.zorder);g[1]&&this.toolInstance.appendGraphicsDomHandle(g[1],p.Image);var m=Number((Math.abs(d-s)/o).toFixed(7)),v=Number((Math.abs(l-c)/n).toFixed(7));z(g[0],[{attr:"width",value:o},{attr:"height",value:n},{attr:"crossorigin",value:"anonymous"},{attr:"href",value:u},{attr:"transform",value:"translate("+Math.min(s,d)+", "+Math.min(c,l)+") scale("+m+", "+v+")"}]),this.isIos11&&g[0].setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u)},e.prototype.drawGraphicsImage=function(e,t){var r=this,i=e.graphic_id,o=e.zorder,n=e.data;this.checkImageRect(n);var a=n.x,s=n.y,c=n.ex,d=n.ey,l=n.url,u=this.toolInstance.appendImageDomHandle(i,o),h=u[0],p=u[1],f=u[2],g=new Image;g.onload=function(){var t=r.getScaleRect(g.width,g.height),i=t.width,o=t.height,n=Number(((c-a)/i).toFixed(7)),u=Number(((d-s)/o).toFixed(7));z(p,[{attr:"width",value:i},{attr:"height",value:o},{attr:"crossorigin",value:"anonymous"},{attr:"href",value:l},{attr:"transform",value:"translate("+a+", "+s+") scale("+n+", "+u+")"}]),r.isIos11&&p.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l),h.appendChild(p);var m=r.toolInstance.getBoxInfoByGraphic(e);if(m){var v=m.x,y=m.y,S=m.width,b=m.height;f.style.cssText+="width:"+S+"px;height:"+b+"px;left:"+v+"px;top:"+y+"px;"}},g.src=l},e.prototype.updateGraphicsImage=function(e,t){var r=this.toolInstance.whiteboardStore,i=e.graphic_id,o=e.data;this.checkImageRect(o);var n=o.x,a=o.y,s=o.ex,c=o.ey,d=""+r.reservedPrefix.graphicsSvg+i,l=""+r.reservedPrefix.graphics+i,u=H(d,l,"image",e.zorder)[0];if(u){var h=+u.getAttribute("width"),p=+u.getAttribute("height"),f=Number(((s-n)/h).toFixed(7)),g=Number(((c-a)/p).toFixed(7));u.setAttribute("transform","translate("+n+", "+a+") scale("+f+", "+g+")")}},e.prototype.checkImageRect=function(e){var t=e.x,r=e.y,i=e.ex,o=e.ey;t>i&&(e.x=i,e.ex=t),r>o&&(e.y=o,e.ey=r)},e.prototype.getScaleRect=function(e,t){return{width:e,height:t}},e.prototype.getSize=function(e,t){return t===h.Local?this.toolInstance.whiteboardStore.basicExtraState.drawSize:N(e.size,e.type,this.toolInstance.viewInfo.viewportWidth,!1)},e.prototype.updateUpSwitchHandle=function(e){this.upSwitch=e},e}(),Q=function(){return(Q=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},K=function(){function e(e){var t=this;this.bindFlag=!1,this.canCreate=!0,this.chInput=!1,this.allowTouchEnd=!0,this.mouseupHandle=function(e){e instanceof TouchEvent?t.allowTouchEnd&&(t.upEventHandle(e),t.allowTouchEnd=!1):t.upEventHandle(e)},this.upEventHandle=function(e){if(t.toolInstance.canDraw&&t.toolInstance.downCommonHandle(e))if(t.canCreate){var r=t.toolInstance.getMouseChangedPoint(e),i=r.clientX,o=r.clientY;if(!t.checkAddHandle(i,o))return;t.addTextGraphics("",i,o)}else t.canCreate=!0},this.toolInstance=e}return e.prototype.updateContentHandle=function(e){var t=this.toolInstance.whiteboardStore.textareaHPadding,r=e.value,i=e.previousSibling,o=Number(i.style.maxWidth.split("px")[0])-2*t,n=i.parentNode,a=document.createElement("span");a.style.cssText="position: absolute; z-index: -100; font-size: inherit; font-family: inherit; visibility: hidden; display: inline-block;line-height: 1;",n.appendChild(a);for(var s="",c=0,d=0,l=r;d<l.length;d++){var u=l[d];if("\n"===u)s+="\n",c=0;else{var h=this.textSizeHandle(a,u);(c+=h)>o?(s+="\n"+u,c=h):s+=u}}n.removeChild(a),i.innerHTML=s,e.value=s},e.prototype.addTextareaDomHandle=function(e){var t=this.toolInstance.whiteboardStore,r=e.graphic_id,i=e.data,o=document.createElement("textarea"),n=""+t.reservedPrefix.graphics+r;o.setAttribute("id",n),o.setAttribute("tabindex","-1"),o.setAttribute("spellcheck","false"),o.setAttribute("maxlength",""+t.maxlength),navigator.userAgent.includes("iPhone")&&navigator.userAgent.includes("11_4_1")&&(o.style.padding="0 "+Math.max(t.textareaHPadding-3,0)+"px");var a=V(i).text;return o.value=a,o},e.prototype.addPreDomHandle=function(e){var t=this.toolInstance,r=t.viewInfo,i=t.whiteboardStore,o=e.size,n=e.data,a=e.type,s=V(n).text,c=document.createElement("pre");c.innerHTML=s;var d=N(o,a,r.viewportWidth,!1),l=i.textareaHPadding,u=i.textareaVPadding;return l*=2,u*=2,c.style.cssText="min-height:"+(d*i.lineHeight+u)+"px;min-width:"+(d+l)+"px;",c},e.prototype.addTextareaConDomHandle=function(e){var t=this.toolInstance,r=t.viewInfo,i=t.whiteboardStore,o=e.size,n=e.color,a=e.data,s=e.graphic_id,c=e.type,d=e.attributes,l=e.zorder,u=JSON.parse(d||i.basicState.attributes),h=u.bold,p=u.italic,f=N(o,c,r.viewportWidth,!1),g=V(a),m=g.beginX,v=g.beginY,y=document.createElement("div"),S=""+i.reservedPrefix.textareaCon+s;return y.setAttribute("id",S),l&&y.setAttribute("data-z",l+""),y.style.cssText="font-size:"+f+"px;font-style:"+(p?"italic":"normal")+";font-weight:"+(h?"bold":"normal")+";left:"+m+"px;top:"+v+"px;color:"+n+";caret-color:"+n+";",y},e.prototype.textSizeHandle=function(e,t){return" "===t&&(t=t.replace(/ /g,"&nbsp")),e.innerHTML=t,e.getBoundingClientRect().width},e.prototype.checkValueHandle=function(e){var t=this.toolInstance.whiteboardStore.maxlength;return e.length>t&&(e=e.slice(0,t)),e},e.prototype.initHeightHandle=function(e){var t=e.previousSibling;e.scrollTop=0,e.style.height="initial",t.style.height="initial",t.style.maxHeight="initial"},e.prototype.updateHeightHandle=function(e){var t=this.toolInstance.whiteboardStore.lineHeight,r=e.previousSibling,i=r.style.height,o=Number(r.style.maxHeight.split("px")[0]),n=e.parentNode.style.fontSize,a=Number(n.split("px")[0]);e.style.height=a*t+"px";var s=e.scrollHeight+"px";e.scrollHeight>o&&(s=i),r.style.height=s,e.style.height=s},e.prototype.inputCallbackHandle=function(e){var t=e.target,r=t.previousSibling,i=this.checkValueHandle(t.value);t.value=i,r.innerHTML=i,this.updateHeightHandle(t),!this.chInput&&this.updateToRemoteHandle(e)},e.prototype.chInputCallbackHandle=function(e){this.chInput=!1,this.updateToRemoteHandle(e)},e.prototype.updateToRemoteHandle=function(e){var t=e.target,r=t.parentNode,i=this.toolInstance,o=i.whiteboardStore,n=i.graphicList,a=t.id.split(o.reservedPrefix.graphics)[1],s=t.value,c=this.toolInstance.getDataFromGraphicList(a,"data").data,d=V(c),l=d.beginX,h=d.beginY,p=n.findIndex((function(e){return e.graphic_id===a})),f=n[p];f&&("blur"===e.type?(f.is_end_draw=!0,s?(this.updateContentHandle(t),this.toolInstance.updateBoxHandle(f,"blur"),f.data=W(t.value,l,h),this.toolInstance.updateToRemoteNewHandle([f],u.Update)):(D(r),D(this.toolInstance.getBoxHandle(a)),n.splice(p,1),this.toolInstance.updateToRemoteNewHandle([f],u.Delete)),this.toolInstance.initDrawHandle()):(this.updateContentHandle(t),f.is_end_draw=!1,f.data=W(t.value,l,h),this.toolInstance.updateToRemoteNewHandle([f],u.Update)))},e.prototype.bindTextareaInputEventHandle=function(e){var t=this;e.addEventListener("input",(function(e){t.inputCallbackHandle(e)})),e.addEventListener("compositionstart",(function(e){t.chInput=!0})),e.addEventListener("compositionend",(function(e){t.chInputCallbackHandle(e)})),e.addEventListener("keydown",(function(e){9===e.keyCode&&e.preventDefault()}))},e.prototype.bindTextareaFocusEvent=function(e,t){var r=this,i=t.data,o=V(i),n=o.beginX,a=o.beginY;e.addEventListener("focus",(function(e){var t=e.target;t.parentNode.style.borderColor="red";var i=t.id.split(r.toolInstance.whiteboardStore.reservedPrefix.graphics)[1];r.toolInstance.setDataToGraphicList(i,{oldData:W(t.value,n,a)})}))},e.prototype.bindTextareaBlurEvents=function(e){var t=this;e.addEventListener("blur",(function(e){var r=t.toolInstance,i=r.graphicsBoxConNode,o=r.whiteboardStore,n=e.target,a=n.parentNode,s=n.id.split(o.reservedPrefix.graphics)[1];t.initHeightHandle(n),t.updatePointerEvents(2,i.querySelector(t.toolInstance.getBoxSelHandle(s))),a.style.borderColor="transparent",t.canCreate=!1,t.updateToRemoteHandle(e),t.allowTouchEnd||(t.allowTouchEnd=!0)}))},e.prototype.updatePointerEvents=function(e,t){var r=this,i=this.toolInstance,o=i.graphicsBoxConNode,n=i.whiteboardStore;1===e?(Array.prototype.slice.call(q(o),0).forEach((function(e){var t=r.toolInstance.getGraphicsHandle(e.id.split(n.reservedPrefix.graphicsBox)[1]);t&&"DIV"===t.nodeName&&(e.style.pointerEvents="initial")})),o.style.pointerEvents="none",t&&(t.style.pointerEvents="none")):(o.style.pointerEvents="initial",t&&(t.style.pointerEvents="initial"))},e.prototype.checkAddHandle=function(e,t){var r=this.calMaxSizeHandle(e,t),i=r.maxWidth,o=r.maxHeight,n=this.toolInstance,a=n.whiteboardStore,s=n.viewInfo,c=a.textareaHPadding,d=a.basicState,l=a.lineHeight,u=a.textareaVPadding,h=N(d.fontSize,p.Text,s.viewportWidth,!1);return!(2*c+h>i-12||2*u+h*l>o-12)},e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolAddEL(e,"upEventName",this.mouseupHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolRmEl(e,"upEventName",this.mouseupHandle)}},e.prototype.addTextGraphics=function(e,t,r){var i=this.toolInstance,o=i.whiteboardStore,n=i.protoGraphic,a=i.graphicList;this.toolInstance.updateProtoGraphic(Q(Q({graphic_id:x(),x:0,y:0,px:0,py:0,operate_id:x(),is_end_draw:!!e,zorder:this.toolInstance.serviceHandle.createZorder(),data:W(e,t+"",r+"")},o.basicState),{size:o.basicState.fontSize}));var s=Q({},n);a.push(s),this.drawGraphicsHandle(s,!e),this.toolInstance.setGraphicsDomZorder(s);var c=this.toolInstance.updateBoxHandle(s);!e&&this.updatePointerEvents(1,c),this.toolInstance.updateToRemoteNewHandle([s],u.Create)},e.prototype.drawGraphicsHandle=function(e,t){var r=e.x,i=e.y,o=this.addTextareaDomHandle(e),n=this.addPreDomHandle(e),a=this.addTextareaConDomHandle(e);a.appendChild(n),a.appendChild(o),a.style.transform="translate("+(r||0)+"px, "+(i||0)+"px)",this.toolInstance.appendGraphicsDomHandle(a,p.Text),this.bindTextareaInputEventHandle(o),this.bindTextareaFocusEvent(o,e);var s,c=this.toolInstance.whiteboardStore,d=c.downEventName,l=c.moveEventName,u=c.upEventName;s=o,[d,l,u].forEach((function(e){s.addEventListener(e,(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}))})),t&&(this.initMaxSizeHandle(o),o.focus(),this.updatePointerEvents(1,null)),this.bindTextareaBlurEvents(o)},e.prototype.updateGraphicsHandle=function(e){var t=this.toolInstance,r=t.viewInfo,i=t.whiteboardStore,o=e.graphic_id,n=e.data,a=e.size,s=e.color,c=e.x,d=e.y,l=e.type,u=e.attributes,h=JSON.parse(u||i.basicState.attributes),p=h.bold,f=h.italic,g=N(a,l,r.viewportWidth,!1),m=V(n),v=m.beginX,y=m.beginY,S=m.text,b=this.toolInstance.getGraphicsHandle(o);if(b){var E=q(b),C=E[0],_=E[1];_.value=S,b.style.cssText="font-size: "+g+"px;font-style:"+(f?"italic":"normal")+";font-weight:"+(p?"bold":"normal")+";left: "+v+"px;top: "+y+"px;color: "+s+";transform: translate("+c+"px, "+d+"px);caret-color:"+s+";";var T=S.split("\n").length*g*i.lineHeight+2*i.textareaVPadding;C.innerHTML=S,C.style.height=T+"px",_.value=S,_.style.height=T+"px"}},e.prototype.focusHandle=function(e){this.toolInstance.setDataToGraphicList(e,{selected:!1});var t=this.toolInstance.getBoxHandle(e);t&&(t.style.borderColor="transparent"),this.updatePointerEvents(1,t);var r=this.toolInstance.getGraphicsHandle(e);if(r){var i=q(r)[1];this.initMaxSizeHandle(i),r.style.borderColor="red",i.style.height="100%",i.focus();var o=this.toolInstance.graphicList.filter((function(t){return t.graphic_id===e}))[0];o.operate_id=x(),o.is_end_draw=!1,this.toolInstance.updateToRemoteNewHandle([o],u.Update)}},e.prototype.backUpdateGraphicsHandle=function(e){var t=e.graphic_id,r=e.data,i=V(r).text,o=this.toolInstance.getGraphicsHandle(t);if(o){var n=q(o),a=n[0];n[1].value=i,a.innerHTML=i;var s=o.getBoundingClientRect(),c=s.width,d=s.height,l=this.toolInstance.getBoxHandle(t);l&&(l.style.cssText+="width:"+c+"px;height:"+d+"px;"),this.toolInstance.setDataToGraphicList(t,{data:r})}},e.prototype.initMaxSizeHandle=function(e){var t=e.getBoundingClientRect(),r=t.left,i=t.top,o=this.toolInstance.transLocationHandle({clientX:r,clientY:i}),n=o.clientX,a=o.clientY,s=this.calMaxSizeHandle(n,a),c=s.maxWidth,d=s.maxHeight,l=e.previousSibling;l.style.maxHeight=d+"px",l.style.maxWidth=c+"px"},e.prototype.calMaxSizeHandle=function(e,t){var r,i=this.toolInstance,o=i.viewInfo,n=i.whiteboardStore,a=o.viewHeight,s=o.viewWidth,c=o.isScroll,d=o.zoom,l=o.zoomTX,u=o.zoomTY,h=o.offsetPageX,p=o.offsetPageY,f=o.viewportHeight,g=o.viewportWidth,m=o.isOriginScroll,v=0;return c?(r=Math.floor(s-(e-h)),v=Math.floor(a-(t-p)),m&&(r-=n.scrollbarSize,v-=n.scrollbarSize)):(r=Math.floor(g-(e-h)+l/d),v=Math.floor(f-(t-p)+u/d)),{maxWidth:r-=2*n.boxBorderWidth,maxHeight:v-=2*n.boxBorderWidth}},e}(),$=function(){function e(e){var t=this;this.bindFlag=!1,this.boxRectMap={},this.mouseDownHandle=function(e){if(t.toolInstance.canDraw){var r=t.toolInstance,i=r.whiteboardNode;r.graphicList.forEach((function(e){if(e.type!==p.Laser){var r=t.toolInstance.getBoxHandle(e.graphic_id);r&&(t.boxRectMap[e.graphic_id]=r.getBoundingClientRect())}})),t.mousemoveHandle(e),t.toolInstance.toolAddEL(i,"moveEventName",t.mousemoveHandle)}},this.mousemoveHandle=function(e){if(t.toolInstance.canDraw){var r=t.toolInstance.graphicList,i=e instanceof TouchEvent?e.changedTouches[0]:e,o=i.clientX,n=i.clientY,a=0,s="";r.forEach((function(e){var r=t.boxRectMap[e.graphic_id];if(r){var i=r.left,c=r.right,d=r.top,l=r.bottom;if(o>=i&&o<=c&&n>=d&&n<=l){var u=e.zorder||1;(!a||u>a)&&(a=u,s=e.graphic_id)}}})),s?(delete t.boxRectMap[s],r.forEach((function(e){return e.selected=e.graphic_id===s&&t.toolInstance.getGraphicIsEndDraw(e.graphic_id)})),t.toolInstance.deleteSelectedGraphics()):r.forEach((function(e){return e.selected=!1}))}},this.mouseUpHandle=function(){if(t.toolInstance.canDraw){t.boxRectMap={};var e=t.toolInstance.whiteboardNode;t.toolInstance.toolRmEl(e,"moveEventName",t.mousemoveHandle)}},this.toolInstance=e}return e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolAddEL(e,"downEventName",this.mouseDownHandle),this.toolInstance.toolAddEL(e,"upEventName",this.mouseUpHandle),this.toolInstance.toolAddEL(e,"leaveEventName",this.mouseUpHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolRmEl(e,"downEventName",this.mouseDownHandle),this.toolInstance.toolRmEl(e,"upEventName",this.mouseUpHandle),this.toolInstance.toolRmEl(e,"leaveEventName",this.mouseUpHandle)}},e}(),ee=(r(256),r(240),function(){return(ee=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)}),te=function(){function e(e){var t=this;this.bindFlag=!1,this.eventList=[{name:"downEventName",handle:"mousedownHandle"},{name:"moveEventName",handle:"mousemoveHandle"},{name:"upEventName",handle:"mouseupHandle"},{name:"leaveEventName",handle:"mouseupHandle"}],this.noMoveUp=!0,this.isWillMove=!1,this.moveCount=0,this.selectBoxMap={l:0,t:0,r:0,b:0,box:document.createElement("div")},this.imageEditBoxMap={w:0,h:0,tx:0,ty:0,x:0,y:0,mx:0,my:0,tx1:0,ty1:0,w0:0,h0:0,board:8,wdiff:9,tdiff:4,interrupt:!1,target:null,graphic:null,parent:document.createElement("div"),box:document.createElement("div"),img:document.createElementNS("http://www.w3.org/2000/svg","image")},this.upSwitch=!0,this.mousedownHandle=function(e){if(t.toolInstance.canDraw&&t.toolInstance.downCommonHandle(e)&&t.startImageEditTarget(e)){t.setGraphicsBox(),t.imageEditBoxMap.interrupt=!1;var r=t.selectBoxMap,i=r.l,o=r.t,n=r.r,a=r.b,s=t.toolInstance.getMouseStartPoint(e),c=s.clientX,d=s.clientY,l=t.toolInstance,u=l.graphicList,h=l.whiteboardStore,f=l.whiteboardNode,g=t.getCoverHandle(e);if(g){var m=g.rect,v=m.left,y=m.top,S=m.right,b=m.bottom,E=t.toolInstance.transLocationHandle({clientX:v,clientY:y}),C=t.toolInstance.transLocationHandle({clientX:S,clientY:b});v=E.clientX,y=E.clientY,S=C.clientX,b=C.clientY;L=n>i&&v>=i&&y>=o&&S<=n&&b<=a;var _=g.graphic,T=_.graphic_id,R=_.selected,I=_.type;L||(R||u.forEach((function(e){return e.selected=e.graphic_id===T})),1===u.filter((function(e){return e.selected})).length?I===p.Image?(t.initImageEditBox(g.graphic),t.hideSelectBox(!1)):(t.hideImageEditBox(),t.initSelectBox(v,y,S,b)):t.hideImageEditBox()),R&&I===p.Text&&1==u.filter((function(e){return e.selected})).length&&(t.noMoveUp=T,setTimeout((function(){return t.hideSelectBox(!1)}),50)),t.isWillMove=!0}else{var L;(L=n>i&&i<=c&&c<=n&&o<=d&&d<=a)?t.isWillMove=!0:t.hideSelectBox(!0)}t.moveCount=0,t.toolInstance.updateMousePointsHandle(c,d),t.isWillMove?u.forEach((function(e){e.selected&&(e.px=e.x,e.py=e.y,e.is_end_draw=!1,e.operate_id=x())})):(t.toolInstance.updateProtoGraphic(ee(ee({graphic_id:x()},h.basicState),{x:0,y:0,px:0,py:0,data:[c,d]})),t.hideImageEditBox(),t.hideSelectBox(!0)),t.toolInstance.toolAddEL(f,"moveEventName",t.mousemoveHandle)}},this.mousemoveHandle=function(e){if(t.toolInstance.canDraw){if(e instanceof MouseEvent&&!e.buttons)return t.resetMouse();if(t.moveImageEditTarget(e)){t.moveCount++,t.noMoveUp=!1;var r=t.toolInstance.getMouseChangedPoint(e);if(t.isWillMove)t.updateGraphicsOnMoving(r);else{t.toolInstance.updateGraphicsDataHandle(r);var i=t.toolInstance.protoGraphic;t.svgTool.drawGraphicsRect(i,h.Local,i.color,.3),t.moveCount%10==0&&t.updateBoxBorderOnSelector()}}}},this.mouseupHandle=function(){if(!t.toolInstance.canDraw)return t.endImageEditTarget();if(t.toolInstance.toolRmEl(t.toolInstance.whiteboardNode,"moveEventName",t.mousemoveHandle),!0===t.noMoveUp)return t.endImageEditTarget();(t.isWillMove?(t.selectBoxMap.l=+t.selectBoxMap.box.style.left.replace("px",""),t.selectBoxMap.t=+t.selectBoxMap.box.style.top.replace("px",""),t.lastMoveHandle()):t.setSelectBox(),!t.imageEditBoxMap.interrupt&&t.noMoveUp&&t.toolInstance.getGraphicIsEndDraw(t.noMoveUp))&&t.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolText).focusHandle(t.noMoveUp);t.resetMouse()},this.toolInstance=e,this.svgTool=e.getInstanceHandle(o.ZegoWhiteboardViewToolLine),this.setGraphicsBox()}return e.prototype.moveImageEditTargetL=function(e,t,r){var i=this.imageEditBoxMap,o=i.x,n=i.mx,a=i.w,s=i.h,c=i.tx,d=i.ty,l=i.parent,u=i.board;if(e<=n){e=o-e;var h=0|(r?e-a:e+a),p=0|(r?c-e+a:c-e);l.style.cssText+="width:"+h+"px;transform:translate("+p+"px,"+d+"px);",l.children[4].style.cssText+="left:"+(h/2-u)+"px;",l.children[6].style.cssText+="left:"+(h/2-u)+"px;",this.imageEditBoxMap.tx1=p,this.imageEditBoxMap.ty1=d,this.updateSVGImageAttr(h,s,p,d)}else this.moveImageEditTargetR(e,0,!0)},e.prototype.moveImageEditTargetR=function(e,t,r){var i=this.imageEditBoxMap,o=i.x,n=i.mx,a=i.w,s=i.h,c=(i.tx,i.tx1),d=i.ty1,l=i.parent,u=i.board;e>n?(e=0|(r?e-o-a:e-o+a),l.style.cssText+="width:"+e+"px;",l.children[4].style.cssText+="left:"+(e/2-u)+"px;",l.children[6].style.cssText+="left:"+(e/2-u)+"px;",this.updateSVGImageAttr(e,s,c,d)):this.moveImageEditTargetL(e,0,!0)},e.prototype.moveImageEditTargetT=function(e,t,r){var i=this.imageEditBoxMap,o=i.y,n=i.my,a=i.w,s=i.h,c=i.tx,d=i.ty,l=i.parent,u=i.board;if(t<=n){t=o-t;var h=0|(r?t-s:t+s),p=0|(r?d-t+s:d-t);l.style.cssText+="height:"+h+"px;transform:translate("+c+"px,"+p+"px);",l.children[5].style.cssText+="top:"+(h/2-u)+"px;",l.children[7].style.cssText+="top:"+(h/2-u)+"px;",this.imageEditBoxMap.tx1=c,this.imageEditBoxMap.ty1=p,this.updateSVGImageAttr(a,h,c,p)}else this.moveImageEditTargetB(0,t,!0)},e.prototype.moveImageEditTargetB=function(e,t,r){var i=this.imageEditBoxMap,o=i.y,n=i.my,a=i.w,s=i.h,c=i.tx1,d=i.ty1,l=i.parent,u=i.board;t>n?(t=0|(r?t-o-s:t-o+s),l.style.cssText+="height:"+t+"px;",l.children[5].style.cssText+="top:"+(t/2-u)+"px;",l.children[7].style.cssText+="top:"+(t/2-u)+"px;",this.updateSVGImageAttr(a,t,c,d)):this.moveImageEditTargetT(0,t,!0)},e.prototype.moveImageEditTargetLT=function(e,t,r){var i=this.imageEditBoxMap,o=i.x,n=i.y,a=i.mx,s=i.my,c=i.w,d=i.h,l=i.tx,u=i.ty,h=i.parent,p=i.board;if(e>o-4&&t>n-4||e<o-4&&t<n-4)if(c<=d&&e<=a||d<c&&t<=s){var f=0,g=0,m=0,v=0;if(r?(e=Math.min(o-e-c,n-t-d),d<c?(g=e,f=Math.round(c*g/d),v=u-e,m=Math.round(l-c*e/d)):(f=e,g=Math.round(f*d/c),m=l-e,v=Math.round(u-d*e/c))):(t-=n,e=(e-=o)<0||t<0?Math.max(e,t):Math.min(e,t),d<c?(g=d-e,f=Math.round(c*g/d),v=u+e,m=Math.round(l+c*e/d)):(f=c-e,g=Math.round(f*d/c),m=l+e,v=Math.round(u+d*e/c))),f<0||g<0)return;f|=0,g|=0,m|=0,v|=0,h.style.cssText+="width:"+f+"px;height:"+g+"px;transform:translate("+m+"px,"+v+"px);",h.children[4].style.cssText+="left:"+(f/2-p)+"px;",h.children[6].style.cssText+="left:"+(f/2-p)+"px;",h.children[5].style.cssText+="top:"+(g/2-p)+"px;",h.children[7].style.cssText+="top:"+(g/2-p)+"px;",this.imageEditBoxMap.tx1=m,this.imageEditBoxMap.ty1=v,this.updateSVGImageAttr(f,g,m,v)}else this.moveImageEditTargetRB(e,t,!0)},e.prototype.moveImageEditTargetRB=function(e,t,r){var i=this.imageEditBoxMap,o=i.x,n=i.y,a=i.mx,s=i.my,c=i.w,d=i.h,l=i.tx1,u=i.ty1,h=i.parent,p=i.board;if(e>o-4&&t>n-4||e<o-4&&t<n-4)if(c<=d&&e>=a||d<c&&t>=s){e-=o,t-=n;var f=0,g=0;if(r?d<c?(g=Math.min(e,t)-d,f=Math.round(c*g/d)):(f=Math.min(e,t)-c,g=Math.round(f*d/c)):(e=e<0||t<0?Math.max(e,t):Math.min(e,t),d<c?(g=e+d,f=Math.round(c*g/d)):(f=e+c,g=Math.round(f*d/c))),f<0||g<0)return;f|=0,g|=0,h.style.cssText+="width:"+f+"px;height:"+g+"px;",h.children[4].style.cssText+="left:"+(f/2-p)+"px;",h.children[6].style.cssText+="left:"+(f/2-p)+"px;",h.children[5].style.cssText+="top:"+(g/2-p)+"px;",h.children[7].style.cssText+="top:"+(g/2-p)+"px;",this.updateSVGImageAttr(f,g,l,u)}else this.moveImageEditTargetLT(e,t,!0)},e.prototype.moveImageEditTargetLB=function(e,t,r){var i=this.imageEditBoxMap,o=i.x,n=i.y,a=i.mx,s=i.my,c=i.w,d=i.h,l=i.tx,u=i.ty,h=i.parent,p=i.board;if(e<o-4&&t>n-4||e>o-4&&t<n-4)if(c<=d&&e<a||d<c&&t>s){var f=0,g=0,m=0,v=u;r?(e=Math.min(o-e-c,t-n-d),e=Math.abs(e),d<c?(g=e,f=Math.round(c*g/d)):(f=e,g=Math.round(f*d/c)),m=l-f,v=u+d):(t-=n,e=(e-=o)<0||t>0?Math.min(-e,t):-Math.min(e,-t),d<c?(g=d+e,m=l+c-(f=Math.round(c*g/d))):(f=c+e,g=Math.round(f*d/c),m=l-e)),f|=0,g|=0,m|=0,v|=0,h.style.cssText+="width:"+f+"px;height:"+g+"px;transform:translate("+m+"px,"+v+"px);",h.children[4].style.cssText+="left:"+(f/2-p)+"px;",h.children[6].style.cssText+="left:"+(f/2-p)+"px;",h.children[5].style.cssText+="top:"+(g/2-p)+"px;",h.children[7].style.cssText+="top:"+(g/2-p)+"px;",this.imageEditBoxMap.tx1=m,this.imageEditBoxMap.ty1=v,this.updateSVGImageAttr(f,g,m,v)}else this.moveImageEditTargetRT(e,t,!0)},e.prototype.moveImageEditTargetRT=function(e,t,r){var i=this.imageEditBoxMap,o=i.x,n=i.y,a=i.mx,s=i.my,c=i.w,d=i.h,l=i.tx,u=i.ty,h=i.parent,p=i.board;if(e>o-4&&t<n-4||e<o-4&&t>n-4)if(c<=d&&e>a||d<c&&t<s){var f=0,g=0,m=l,v=0;r?(e=Math.min(e-o-c,n-t-d),e=Math.abs(e),d<c?(g=e,f=Math.round(c*g/d)):(f=e,g=Math.round(f*d/c)),m=l+c,v=u-g):(t-=n,e=(e-=o)<0||t>0?-Math.min(-e,t):Math.min(e,-t),d<c?(g=d+e,f=Math.round(c*g/d),v=u-e):(f=c+e,v=u+d-(g=Math.round(f*d/c)))),f|=0,g|=0,m|=0,v|=0,h.style.cssText+="width:"+f+"px;height:"+g+"px;transform:translate("+m+"px,"+v+"px);",h.children[4].style.cssText+="left:"+(f/2-p)+"px;",h.children[6].style.cssText+="left:"+(f/2-p)+"px;",h.children[5].style.cssText+="top:"+(g/2-p)+"px;",h.children[7].style.cssText+="top:"+(g/2-p)+"px;",this.imageEditBoxMap.tx1=m,this.imageEditBoxMap.ty1=v,this.updateSVGImageAttr(f,g,m,v)}else this.moveImageEditTargetLB(e,t,!0)},e.prototype.startImageEditTarget=function(e){this.endImageEditTarget();var t=e.target,r=t.className;if(r.includes("operation-point-desktop")){if(this.imageEditBoxMap.graphic){this.imageEditBoxMap.graphic.operate_id=x(),this.imageEditBoxMap.graphic.is_end_draw=!1,this.toolInstance.updateToRemoteNewHandle([this.imageEditBoxMap.graphic],u.Update);var i=this.imageEditBoxMap.graphic.oldData;Object.assign(i,this.imageEditBoxMap.graphic.data)}this.imageEditBoxMap.target=t;var o=window.getComputedStyle(this.imageEditBoxMap.parent),n=o.transform.match(/(-?\d+),\s?(-?\d+)\)$/)||[],a=this.toolInstance.getMouseChangedPoint(e),s=a.clientX,c=a.clientY;this.imageEditBoxMap.w=+o.width.replace("px",""),this.imageEditBoxMap.h=+o.height.replace("px",""),this.imageEditBoxMap.tx=+n[1]||0,this.imageEditBoxMap.ty=+n[2]||0,this.imageEditBoxMap.x=s,this.imageEditBoxMap.y=c;var d=r.substr(r.lastIndexOf(" ")+1);"L"==d?this.imageEditBoxMap.mx=s+this.imageEditBoxMap.w:"R"==d?this.imageEditBoxMap.mx=s-this.imageEditBoxMap.w:"T"==d?this.imageEditBoxMap.my=c+this.imageEditBoxMap.h:"B"==d?this.imageEditBoxMap.my=c-this.imageEditBoxMap.h:"LT"==d?(this.imageEditBoxMap.mx=s+this.imageEditBoxMap.w,this.imageEditBoxMap.my=c+this.imageEditBoxMap.h):"RB"==d?(this.imageEditBoxMap.mx=s-this.imageEditBoxMap.w,this.imageEditBoxMap.my=c-this.imageEditBoxMap.h):"LB"==d?(this.imageEditBoxMap.mx=s+this.imageEditBoxMap.w,this.imageEditBoxMap.my=c-this.imageEditBoxMap.h):"RT"==d&&(this.imageEditBoxMap.mx=s-this.imageEditBoxMap.w,this.imageEditBoxMap.my=c+this.imageEditBoxMap.h);var l=this.toolInstance,h=l.whiteboardNode,p=l.conNode;return this.toolInstance.toolAddEL(h,"moveEventName",this.mousemoveHandle),p.style.cursor=r.replace(/.+cursor-(\w+).+/,"$1")+"-resize",!1}return!0},e.prototype.moveImageEditTarget=function(e){var t=this.imageEditBoxMap,r=t.target,i=t.interrupt;if(!r)return!i;var o=r.className.substr(r.className.lastIndexOf(" ")+1),n=this.toolInstance.getMouseChangedPoint(e),a=n.clientX,s=n.clientY;return this["moveImageEditTarget"+o](a,s),!1},e.prototype.endImageEditTarget=function(){var e=this.imageEditBoxMap,t=e.target,r=e.graphic;if(t&&r){var i=r.data,o=i.x,n=i.y;r.initX=o-r.x,r.initY=n-r.y,r.is_end_draw=!0,this.toolInstance.updateToRemoteNewHandle([r],u.Update)}this.imageEditBoxMap.target=null,this.toolInstance.conNode.style.cursor="auto"},e.prototype.initImageEditBox=function(e){var t,r=e.graphic_id,i=null===(t=this.toolInstance.getGraphicsHandle(r))||void 0===t?void 0:t.children[0];if(i){var o=this.imageEditBoxMap,n=o.parent,a=o.board,s=o.wdiff,c=o.tdiff,d=e.data,l=d.x,u=d.y,h=d.ex-l+s,p=d.ey-u+s;l-=c,u-=c,l|=0,u|=0,this.imageEditBoxMap.tx1=l,this.imageEditBoxMap.ty1=u,this.imageEditBoxMap.graphic=e,this.imageEditBoxMap.w0=+i.getAttribute("width"),this.imageEditBoxMap.h0=+i.getAttribute("height"),this.imageEditBoxMap.img=i,this.imageEditBoxMap.box=this.toolInstance.getBoxHandle(r),n.style.cssText+="display:block;width:"+h+"px;height:"+p+"px;transform:translate("+l+"px,"+u+"px);",n.children[4].style.cssText+="left:"+(h/2-a)+"px;",n.children[6].style.cssText+="left:"+(h/2-a)+"px;",n.children[5].style.cssText+="top:"+(p/2-a)+"px;",n.children[7].style.cssText+="top:"+(p/2-a)+"px;"}},e.prototype.hideImageEditBox=function(e){this.imageEditBoxMap.target=null,this.imageEditBoxMap.graphic=null,this.imageEditBoxMap.interrupt=!!e;var t=this.imageEditBoxMap.parent;t&&(t.style.display="none")},e.prototype.updateSVGImageAttr=function(e,t,r,i){var o=this.imageEditBoxMap,n=o.w0,a=o.h0,s=o.wdiff,c=o.tdiff,d=o.img,l=o.box,u=o.graphic;if(d&&l){e|=0,t|=0,r|=0,i|=0,l.style.cssText+="width:"+e+"px;height:"+t+"px;left:"+r+"px;top:"+i+"px;",e-=s,t-=s,r+=c,i+=c;var h=Number((e/n).toFixed(7)),p=Number((t/a).toFixed(7));d.setAttribute("transform","translate("+r+", "+i+") scale("+h+", "+p+")");var f=null==u?void 0:u.data;f.x=r,f.y=i,f.ex=r+e,f.ey=i+t}},e.prototype.setGraphicsBox=function(){var e=this.toolInstance.whiteboardNode;this.selectBoxMap.box=e.querySelector(".graphics-box"),this.imageEditBoxMap.parent=e.querySelector(".img-editor-box")},e.prototype.initSelectBox=function(e,t,r,i){this.selectBoxMap.l=e,this.selectBoxMap.t=t,this.selectBoxMap.r=r,this.selectBoxMap.b=i,r-=e,i-=t,this.selectBoxMap.box.style.cssText+="left:"+e+"px;top:"+t+"px;width:"+r+"px;height:"+i+"px;display:block;"},e.prototype.hideSelectBox=function(e){this.selectBoxMap.l=0,this.selectBoxMap.t=0,this.selectBoxMap.r=0,this.selectBoxMap.b=0,this.selectBoxMap.box.style.display="none",e&&this.toolInstance.graphicList.forEach((function(e){return e.selected=!1}))},e.prototype.setSelectBox=function(){var e,t=this;if("none"===(null===(e=this.imageEditBoxMap.parent)||void 0===e?void 0:e.style.display)){var r=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,o=0,n=0;this.toolInstance.graphicList.forEach((function(e){if(e.selected){var a=t.toolInstance.getBoxInfoByGraphic(e);if(a){var s=a.x,c=a.y,d=a.width,l=a.height;r=Math.min(r,s),i=Math.min(i,c),o=Math.max(o,s+d),n=Math.max(n,c+l)}}})),o>0&&n>0&&(this.selectBoxMap.l=r,this.selectBoxMap.t=i,this.selectBoxMap.r=o,this.selectBoxMap.b=n,o-=r,n-=i,this.selectBoxMap.box.style.cssText+="left:"+r+"px;top:"+i+"px;width:"+o+"px;height:"+n+"px;display:block;")}},e.prototype.lastMoveHandle=function(){var e=this.toolInstance.graphicList.filter((function(e){return!!e.selected&&(e.is_end_draw=!0,!0)}));this.toolInstance.updateToRemoteNewHandle(e,u.Move)},e.prototype.resetMouse=function(){var e=this.toolInstance,t=e.protoGraphic,r=e.whiteboardNode;this.toolInstance.toolRmEl(r,"moveEventName",this.mousemoveHandle);var i=this.toolInstance.getGraphicsHandle(t.graphic_id);D(null==i?void 0:i.parentElement),this.toolInstance.initDrawHandle(),this.isWillMove=!1,this.noMoveUp=!0},e.prototype.updateGraphicsOnMoving=function(e){var t=this,r=e.clientX,i=e.clientY;this.toolInstance.updateMousePointsHandle(r,i);var o=this.toolInstance.calMoveHandle(),n=o[0],a=o[1],s=this.imageEditBoxMap,c=s.tdiff,d=s.parent,l=s.graphic,h=null==l?void 0:l.graphic_id,f=this.toolInstance.graphicList.filter((function(e){return e.selected}));f.forEach((function(e){t.toolInstance.updateGraphicsOffsetHandle(e,n,a);var r=e.graphic_id,i=e.type;if(i===p.Image){var o=(e.initX||0)+e.x|0,s=(e.initY||0)+e.y|0,l=e.data,u=e.oldData;u.x=l.x,u.y=l.y,u.ex=l.ex,u.ey=l.ey,l.ex=o+l.ex-l.x,l.ey=s+l.ey-l.y,l.x=o,l.y=s,t.toolInstance.moveGraphicsHandle(r,o,s),h===r&&(o-=c,s-=c,t.imageEditBoxMap.tx1=o,t.imageEditBoxMap.ty1=s,d.style.cssText+="transform:translate("+o+"px,"+s+"px)")}else i!==p.Laser&&t.toolInstance.moveGraphicsHandle(r,e.x,e.y);t.toolInstance.updateBoxHandle(e)}));var g=this.selectBoxMap,m=g.l,v=g.t,y=this.toolInstance.mousePoints,S=y.boxX,b=y.boxY;this.selectBoxMap.box.style.cssText+="left:"+(m+S)+"px;top:"+(v+b)+"px;",this.moveCount%10==0&&this.toolInstance.updateToRemoteNewHandle(f,u.Move)},e.prototype.updateBoxBorderOnSelector=function(){var e=this,t=this.toolInstance,r=t.protoGraphic,i=t.graphicList,o=this.toolInstance.getGraphicsHandle(r.graphic_id);if(o){var n=o.getBoundingClientRect(),a=n.left,s=n.right,c=n.top,d=n.bottom;i.forEach((function(t){if(t.type!==p.Laser){var r=e.toolInstance.getGraphicsHandle(t.graphic_id);if(r){var i=r.getBoundingClientRect(),o=i.left,n=i.top,l=i.right,u=i.bottom;o===l&&l++,n===u&&u++,t.selected=Math.max(a,o)<Math.min(s,l)&&Math.max(c,n)<Math.min(d,u)&&e.toolInstance.getGraphicIsEndDraw(t.graphic_id)}}}))}},e.prototype.getCoverHandle=function(e){var t=this,r=e instanceof TouchEvent?e.changedTouches[0]:e,i=r.clientX,o=r.clientY,n=0,a=null,s=null;return this.toolInstance.graphicList.forEach((function(e){if(e.type!==p.Laser&&t.toolInstance.getGraphicIsEndDraw(e.graphic_id)){var r=t.toolInstance.getBoxHandle(e.graphic_id);if(r){var c=r.getBoundingClientRect(),d=c.left,l=c.top,u=c.right,h=c.bottom;if(i>=d&&i<=u&&o>=l&&o<=h){var f=e.zorder||1;(!n||f>n)&&(n=f,a=e,s=c)}}}})),a&&s?{graphic:a,rect:s}:null},e.prototype.updateUpSwitchHandle=function(e){this.upSwitch=e},e.prototype.bindEventsHandle=function(){var e=this;if(!this.bindFlag){this.bindFlag=!0;var t=this.toolInstance.whiteboardNode;this.eventList.forEach((function(r){var i=r.name,o=r.handle;"moveEventName"!==i&&e.toolInstance.toolAddEL(t,i,e[o])}))}},e.prototype.removeEventsHandle=function(){var e=this;if(this.bindFlag){this.bindFlag=!1;var t=this.toolInstance.whiteboardNode;this.eventList.forEach((function(r){var i=r.name,o=r.handle;e.toolInstance.toolRmEl(t,i,e[o])}))}},e.prototype.hideImageEditBoxByList=function(e){var t,r=null===(t=this.imageEditBoxMap.graphic)||void 0===t?void 0:t.graphic_id;e.some((function(e){return e.graphic_id===r}))&&this.hideImageEditBox()},e.prototype.hideImageEditBoxByIds=function(e){var t,r=null===(t=this.imageEditBoxMap.graphic)||void 0===t?void 0:t.graphic_id;e.some((function(e){return e===r}))&&this.hideImageEditBox()},e.prototype.updateSelectorBoxHandle=function(e,t){this.hideImageEditBoxByIds(t),this.hideImageEditBoxByList(e),this.toolInstance.graphicList.some((function(r){return r.selected&&(t.some((function(e){return e===r.graphic_id}))||e.some((function(e){return e.graphic_id===r.graphic_id})))}))&&this.hideSelectBox(!0)},e}(),re=r(1),ie=function(){return(ie=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},oe=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<r;t++)for(var n=arguments[t],a=0,s=n.length;a<s;a++,o++)i[o]=n[a];return i},ne=re.b.bind(null,"wb.v."),ae=function(){function e(e){this.mousePoints={sx:-1,sy:-1,ex:-1,ey:-1,boxX:0,boxY:0},this.instancesMap={},this.canDraw=!0,this.graphicTaskList=[],this.undoList=[],this.redoList=[],this.doTaskSeq=0,this.canDo=!0,this.graphicExtraMap={};var t=e.whiteboardID,r=e.graphicList,i=e.zoomNode,o=e.conNode,n=e.serviceHandle,a=e.whiteboardStore,s=e.graphicsConNode,c=e.graphicsBoxConNode,d=e.viewInfo,l=e.whiteboardNode;this.whiteboardID=t,this.conNode=o,this.zoomNode=i,this.userNode=i.parentNode,this.graphicsConNode=s,this.whiteboardNode=l,this.graphicsBoxConNode=c,this.graphicList=r,this.serviceHandle=n,this.whiteboardStore=a,this.viewInfo=d,this.updateOffsetHandle(),this.updateScrollHandle(),this.initDrawHandle()}return e.prototype.getTranslateXY=function(e){if(!e)return{x:0,y:0};var t=e.match(/translate\((-?\d*.?\d*)px(\,\s*(-?\d*.?\d*)px)?\)/);return{x:+t[1]||0,y:+t[3]||0}},e.prototype.getPageTranslateXY=function(){var e=this.viewInfo,t=e.zoom,r=e.isScroll,i=e.direction,o=e.page,n=e.viewportWidth,a=e.viewportHeight,c=0,d=0;if(!r){var l=this.whiteboardNode.style.transform;if(l){var u=this.getTranslateXY(l);i===s.Horizontal?(c=u.x+((o||1)-1)*n*t,d=u.y):(c=u.x,d=u.y+((o||1)-1)*a*t)}}return{x:c,y:d}},e.prototype.clearRealTimeInterval=function(e){clearInterval(this.graphicExtraMap[e].realTimeId),delete this.graphicExtraMap[e]},e.prototype.realTimeHandle=function(e,t){var r=this,i=t.graphic_id,o=t.is_end_draw,n=t.operate_id,a=this.whiteboardStore.realTimeState,s=a.remoteDrawDelay,c=a.remoteDrawCount,d=a.remoteDrawEndDelay;this.graphicList.some((function(a){var l;if(a.graphic_id===i&&a.operate_id===n){if(o)o&&(null===(l=r.graphicExtraMap[i])||void 0===l?void 0:l.realTimeId)&&(r.clearRealTimeInterval(i),re.a.info(ne("gra.remote_draw_realtime_end"),i));else{var u=a.data;r.graphicExtraMap[i]&&r.graphicExtraMap[i].realTimeId?u.push.apply(u,t.data):(r.graphicExtraMap[i]=r.graphicExtraMap[i]||{},r.graphicExtraMap[i].realTimeIndex=0,r.graphicExtraMap[i].realTimeId=setInterval((function(t){var i,o=r.graphicList.find((function(e){return e.graphic_id===t}));if(o&&r.graphicExtraMap[t]){var n=o.data,a=r.graphicExtraMap[t].realTimeIndex>=n.length;a?a&&Date.now()-r.graphicExtraMap[t].realTimeLast>d&&(o.is_end_draw=!0,r.clearRealTimeInterval(t),re.a.info(ne("gra.remote_draw_realtime_timeout"),t)):(r.graphicExtraMap[t].realTimeLast=Date.now(),(o=JSON.parse(JSON.stringify(o))).data=n.slice(0,r.graphicExtraMap[t].realTimeIndex+=c),e.drawGraphicsPath(o,h.Remote))}else!o&&(null===(i=r.graphicExtraMap[t])||void 0===i?void 0:i.realTimeId)&&(r.clearRealTimeInterval(t),re.a.info(ne("gra.remote_draw_realtime_deleted"),t))}),s,i))}return!0}return!1}))},e.prototype.createHandle=function(e,t,r){var i=e.graphic_id;if(!this.graphicList.some((function(e){return e.graphic_id===i})))switch(this.graphicList.push(e),e.type){case p.Text:t.drawGraphicsHandle(e,!1);break;default:r.drawGraphicsHandle(e,h.UnReDo)}},e.prototype.moveHandle=function(e,t){var r=e.graphic_id,i=e.x,o=e.y,n=e.type;if(n===p.Image)this.assingImageGraphicData(e,u.Move),t.updateGraphicsImage(e,h.UnReDo);else{this.setDataToGraphicList(r,{x:i,y:o});var a=n===p.Laser?""+1/this.viewInfo.zoom:void 0;this.moveGraphicsHandle(r,i,o,a)}},e.prototype.updateHandle=function(e,t,r){switch(e.type){case p.Text:t.backUpdateGraphicsHandle(e);break;case p.Image:this.assingImageGraphicData(e,u.Update),r.updateGraphicsImage(e,h.UnReDo)}},e.prototype.assingImageGraphicData=function(e,t){var r=e.graphic_id;this.graphicList.some((function(i){if(i.graphic_id===r){if(Object.assign(i.data,e.data),Object.assign(i.oldData,e.oldData),t===u.Move)i.x=e.x,i.y=e.y,i.px=e.px,i.py=e.py;else if(t===u.Update){var o=i.data,n=o.x,a=o.y;i.initX=n-i.x,i.initY=a-i.y}return!0}return!1}))},e.prototype.reverseGraphicByMove=function(e){if(e.x=[e.px||0,e.px=e.x][0],e.y=[e.py||0,e.py=e.y][0],e.type===p.Image){var t=e.data,r=t.ex-t.x,i=t.ey-t.y;t.x=e.x+(e.initX||0),t.y=e.y+(e.initY||0),t.ex=t.x+r,t.ey=t.y+i}},e.prototype.resetImageGraphicOrigin=function(e){var t=e.data,r=t.x,i=t.y;e.initX=r-e.x,e.initY=i-e.y},e.prototype.createUndoData=function(e){var t=this;if(!e.length)return[];var r=JSON.parse(JSON.stringify(e)),i=r[0],o=i.action,n=i.type,a=i.oldData,s=i.data;if(o===u.Create||o===u.Append||o===u.Update)switch(n){case p.Text:var c=V(a).text,d=V(s).text;if(!c&&!d)return[];c?(i.action=d?u.Update:u.Create,i.data=a,i.oldData=s):i.action=u.Delete;break;case p.Pencil:case p.Line:case p.Rect:case p.Ellipse:i.action=u.Delete;break;case p.Image:o===u.Create?i.action=u.Delete:(i.data=a,i.oldData=s,this.resetImageGraphicOrigin(i))}else o===u.Delete?r.forEach((function(e){e.action=u.Create,e.type===p.Image&&t.resetImageGraphicOrigin(e)})):o===u.Move&&r.forEach((function(e){return t.reverseGraphicByMove(e)}));return r.forEach((function(e){e.operate_id=x(),e.is_end_draw=!0})),r},e.prototype.reverseData=function(e){var t=this;e.length&&e.forEach((function(e){var r=e.action,i=e.data,o=e.oldData;switch(r){case u.Create:e.action=u.Delete;break;case u.Delete:e.action=u.Create;break;case u.Move:t.reverseGraphicByMove(e);break;case u.Update:e.data=o,e.oldData=i}e.operate_id=x(),e.is_end_draw=!0}))},e.prototype.triggerAnimateHandle=function(e,t){t===h.Remote?e.classList.add("transition"):e.classList.remove("transition")},e.prototype.transLocationHandle=function(e){var t=e.clientX,r=e.clientY,i=this.offsetData,o=i.offsetLeft,n=i.offsetTop,a=this.scrollData,s=a.scrollLeft,c=a.scrollTop,d=this.getPageTranslateXY(),l=d.x,u=d.y,h=this.viewInfo,p=h.zoom,f=h.offsetPageX,g=h.offsetPageY;return{clientX:Math.round((t-o+s-l)/p+f),clientY:Math.round((r-n+c-u)/p+g)}},e.prototype.transLocationOrigin=function(e){var t=e.clientX,r=e.clientY,i=this.viewInfo,o=i.offsetPageX,n=i.offsetPageY,a=this.viewInfo.scrollX||0,s=this.viewInfo.scrollY||0;return{clientX:Math.round(t+a+o),clientY:Math.round(r+s+n)}},e.prototype.bindEventsHandle=function(e){this.initDrawHandle();var t=this.instancesMap[e];t&&t.bindEventsHandle()},e.prototype.removeEventsHandle=function(e){var t=this.instancesMap[e];t&&t.removeEventsHandle()},e.prototype.moveGraphicsHandle=function(e,t,r,i){var o=this.getGraphicsHandle(e);if(o)if("g"===o.tagName){var n=q(o)[0];i=(i=n.getAttribute("transform")||"")&&i.includes("scale(")?i.replace(/.*(scale\(\d+(.\d+)?,(\s*)?\d+(.\d+)?\)).*/," $1"):"",n.setAttribute("transform","translate("+(t||0)+", "+(r||0)+")"+i)}else{var a="translate("+(t||0)+"px, "+(r||0)+"px)",s=o.style.transform.match(/scale\((\d*.?\d*)\)/),c=s?s[1]:"";!i&&c?a=a+" scale("+c+")":i&&(a=a+" scale("+i+")"),o.style.transform=a}},e.prototype.getGraphicsHandle=function(e,t){void 0===t&&(t=this.userNode);var r=this.getGraphicsSelHandle(e),i=t.querySelector(r);return i&&(i=i.parentNode),i},e.prototype.batchGetGraphicsHandle=function(e,t){return void 0===e&&(e=this.userNode),e.querySelectorAll("[id^="+t+"]")},e.prototype.getGraphicsSelHandle=function(e){return"#"+this.whiteboardStore.reservedPrefix.graphics+e},e.prototype.getBoxSelHandle=function(e){return"#"+this.whiteboardStore.reservedPrefix.graphicsBox+e},e.prototype.updateOffsetHandle=function(){this.offsetData=function(e){var t=0,r=0;if(e)for(t+=e.offsetTop,r+=e.offsetLeft;e.offsetParent;)t+=e.offsetParent.offsetTop,r+=e.offsetParent.offsetLeft,e=e.offsetParent;return{offsetTop:t,offsetLeft:r}}(this.conNode)},e.prototype.updateScrollHandle=function(){this.scrollData=function(e){var t=0,r=0;if(e)for(t+=e.scrollTop,r+=e.scrollLeft;e.parentNode;)t+=e.parentNode.scrollTop||0,r+=e.parentNode.scrollLeft||0,e=e.parentNode;return{scrollTop:t,scrollLeft:r}}(this.conNode)},e.prototype.updateGraphicsOffsetHandle=function(e,t,r){var i=e.x,o=e.y;e.x=i+t,e.y=o+r},e.prototype.calMoveHandle=function(){var e=this.mousePoints,t=e.sx,r=e.sy,i=e.ex,o=e.ey;return-1!==t&&-1!==r?(this.mousePoints.boxX+=i-t,this.mousePoints.boxY+=o-r,[i-t,o-r]):[0,0]},e.prototype.updateMousePointsHandle=function(e,t){null==e||null==t?this.mousePoints={sx:-1,sy:-1,ex:-1,ey:-1,boxX:0,boxY:0}:(-1!==this.mousePoints.ex&&-1!==this.mousePoints.ey&&(this.mousePoints.sx=this.mousePoints.ex,this.mousePoints.sy=this.mousePoints.ey),this.mousePoints.ex=e,this.mousePoints.ey=t)},e.prototype.updateToRemoteNewHandle=function(e,t,r,i,o,n){if(void 0===r&&(r=!0),e.length){var a=function(e,t){var r=e.length>1?l.Multi:l.Single,i=JSON.parse(JSON.stringify(e));return i.forEach((function(e){e.action_type=r,t&&(e.action=t),delete e.selected,delete e.fontSize,delete e.bgColor})),i}(e,t);if((!i||!i.isUndoAndRedo)&&(this.redoList.length=0),r){var s=this.graphicTaskList.length,c={taskStatus:s?v.Pending:v.InProgress,graphicList:a};!s&&this.graphicTaskList.push(c),this.syncUpdateToRemoteQueue(c)}else this.unSyncUpdateToRemoteQueue(a,i,o,n)}},e.prototype.unSyncUpdateToRemoteQueue=function(e,t,r,i){var o=this;this.serviceHandle.updateToRemoteHandle(this.whiteboardID,e,(function(){if(!t||!t.isUndoAndRedo){var i=o.createUndoData(e);o.undoList.push(i)}r&&r()}),(function(e){o.serviceHandle.actionCustomListener("error",e),i&&i(e)}))},e.prototype.syncUpdateToRemoteQueue=function(e){var t=this;e.taskStatus===v.Pending?-1===this.graphicTaskList.findIndex((function(e){return e.taskStatus===v.Pending}))?this.graphicTaskList.push(e):this.mergegGraphicTaskList(e):this.serviceHandle.updateToRemoteHandle(this.whiteboardID,e.graphicList,(function(){t.graphicTaskCallbackHandle(m.success)}),(function(e){t.graphicTaskCallbackHandle(m.error,e)}))},e.prototype.filterUndoAndRedo=function(e){var t=this;return e.filter((function(e){var r=e.action,i=e.graphic_id,o=t.graphicList.findIndex((function(e){return e.graphic_id===i}));return-1===o&&r===u.Create||-1!==o&&(r===u.Delete||r===u.Move||r===u.Update||r===u.Append)}))},e.prototype.undoNewHandle=function(){var e=this;if((!this.graphicTaskList[0]||this.graphicTaskList[0].taskStatus!==v.InProgress)&&this.canDo){var t=this.undoList.length;if(t){var r=this.filterUndoAndRedo(this.undoList[t-1]);r.length?(this.canDo=!1,this.updateToRemoteNewHandle(r,void 0,!1,{isUndoAndRedo:!0},(function(){e.undoList.pop();var t=JSON.parse(JSON.stringify(r));e.updateLocalHandle(t),e.reverseData(t),e.redoList.push(t),e.canDo=!0}),(function(t){e.canDo=!0}))):this.undoList.pop()}}},e.prototype.redoNewHandle=function(){var e=this;if((!this.graphicTaskList[0]||this.graphicTaskList[0].taskStatus!==v.InProgress)&&this.canDo){var t=this.redoList.length;if(t){var r=this.filterUndoAndRedo(this.redoList[t-1]);r.length?(this.canDo=!1,this.updateToRemoteNewHandle(r,void 0,!1,{isUndoAndRedo:!0},(function(){e.redoList.pop();var t=JSON.parse(JSON.stringify(r));e.updateLocalHandle(t),e.reverseData(t),e.undoList.push(t),e.canDo=!0}),(function(t){e.canDo=!0}))):this.redoList.pop()}}},e.prototype.findLastTaskIndex=function(e,t){var r=this.graphicTaskList.slice(1);r.reverse();var i=r.findIndex((function(r){return r.graphicList[0][e]===t}));return-1!==i?r.length-i:-1},e.prototype.mergeMoveActionTaskList=function(e){var t=e.graphicList[0].operate_id,r=this.findLastTaskIndex("operate_id",t);-1===r?this.graphicTaskList.push(e):this.graphicTaskList.splice(r+1,1,e)},e.prototype.mergeOtherActionTaskList=function(e){switch(e.graphicList[0].type){case p.Text:this.mergeTextTaskList(e);break;case p.Pencil:this.mergePathTaskList(e);break;case p.Ellipse:case p.Rect:case p.Line:case p.Image:this.mergeOtherTaskList(e)}},e.prototype.mergeLaserTaskList=function(e){var t=e.graphicList[0],r=t.action,i=t.graphic_id;if(r===u.Move){var o=this.findLastTaskIndex("graphic_id",i);-1===o?this.graphicTaskList.push(e):this.graphicTaskList.splice(o,1,e)}else this.graphicTaskList.push(e)},e.prototype.mergeTextTaskList=function(e){var t=e.graphicList[0].operate_id;this.findLastTaskIndex("operate_id",t);this.graphicTaskList.push(e)},e.prototype.mergePathTaskList=function(e){var t=e.graphicList[0],r=t.operate_id,i=t.action,o=this.findLastTaskIndex("operate_id",r);if(-1===o)this.graphicTaskList.push(e);else{var n=this.graphicTaskList[o];n.graphicList[0].action===u.Create||i===u.Update?this.graphicTaskList.push(e):n.graphicList.forEach((function(t,r){t.data=t.data.concat(e.graphicList[r].data)}))}},e.prototype.mergeOtherTaskList=function(e){var t=e.graphicList[0].operate_id,r=this.findLastTaskIndex("operate_id",t);-1===r?this.graphicTaskList.push(e):this.graphicTaskList[r].graphicList[0].action===u.Create?this.graphicTaskList.push(e):this.graphicTaskList.splice(r,1,e)},e.prototype.mergegGraphicTaskList=function(e){var t=e.graphicList[0],r=t.action;t.type===p.Laser?this.mergeLaserTaskList(e):r===u.Move?this.mergeMoveActionTaskList(e):this.mergeOtherActionTaskList(e)},e.prototype.graphicTaskCallbackHandle=function(e,t){var r=this.graphicTaskList[0];if(r)if(r.taskStatus===v.InProgress){var i=r.graphicList[0],o=i.is_end_draw,n=i.type;if(o)if(e===m.success){if(n!==p.Laser){var a=this.createUndoData(r.graphicList);this.undoList.push(a)}}else{if(n!==p.Laser){a=this.createUndoData(r.graphicList);this.updateLocalHandle(a)}this.serviceHandle.actionCustomListener("error",t)}else e===m.error&&this.serviceHandle.actionCustomListener("error",t);this.graphicTaskList.shift();var s=this.graphicTaskList[0];s&&(s.taskStatus=v.InProgress)&&this.syncUpdateToRemoteQueue(s)}else r.taskStatus=v.InProgress,this.syncUpdateToRemoteQueue(r)},e.prototype.updateLocalHandle=function(e){var t=this;re.a.info(ne("gra.draw_local"),JSON.stringify(e)),this.updateOffsetHandle(),this.updateScrollHandle();var r=this.getInstanceHandle(o.ZegoWhiteboardViewToolText),i=this.getInstanceHandle(o.ZegoWhiteboardViewToolLine),n=this.getInstanceHandle(o.ZegoWhiteboardViewToolSelector);n.hideImageEditBox(),n.hideSelectBox(!0),e.forEach((function(e){switch(e.action){case u.Delete:t.deleteHandle(e.graphic_id);break;case u.Create:t.createHandle(e,r,i),t.updateBoxHandle(e);break;case u.Move:t.moveHandle(e,i),t.updateBoxHandle(e);break;case u.Update:t.updateHandle(e,r,i),t.updateBoxHandle(e)}}))},e.prototype.updatePushLocalHandle=function(e,t){var r=this;re.a.info(ne("gra.remote_draw"),JSON.stringify({graphicList:e,delGraphicList:t,actionMsg:"transValue"})),this.updateOffsetHandle(),this.updateScrollHandle(),e.sort((function(e,t){return(e.zorder||0)-(t.zorder||0)})),t.forEach((function(e){return r.deleteHandle(e)}));var i=this.instancesMap[o.ZegoWhiteboardViewToolLaser],n=this.instancesMap[o.ZegoWhiteboardViewToolText],a=this.instancesMap[o.ZegoWhiteboardViewToolLine],s=this.instancesMap[o.ZegoWhiteboardViewToolSelector];s&&s.updateSelectorBoxHandle(e,t),e.forEach((function(e){var t=e.graphic_id,o=e.type,s=r.graphicList.some((function(r){return t===r.graphic_id&&(e.type!==p.RealTime&&(Object.assign(r,e),o===p.Image&&Object.assign(r.data,e.data)),!0)}));s||(o===p.Image&&(e.oldData=ie({},e.data)),r.graphicList.push(e));var c="#"+r.whiteboardStore.reservedPrefix.graphicsBox+t;switch(s=s&&!!r.whiteboardNode.querySelector(c),o){case p.Laser:i.drawGraphicsHandle(e,!1);break;case p.Text:s?n.updateGraphicsHandle(e):n.drawGraphicsHandle(e,!1),r.updateBoxHandle(e);break;default:o===p.RealTime?r.realTimeHandle(a,e):(s?(o===p.Pencil&&e.is_end_draw&&r.graphicExtraMap[t]&&(r.clearRealTimeInterval(t),re.a.info(ne("gra.remote_draw_realtime_end"),t)),a.updateGraphicsHandle(e)):a.drawGraphicsHandle(e,h.Remote),r.updateBoxHandle(e))}}))},e.prototype.deleteHandle=function(e){var t;D(this.getBoxHandle(e));var r=this.getGraphicsHandle(e);D("g"===(null==r?void 0:r.tagName)?r.parentNode:r);var i=this.graphicList.findIndex((function(t){return t.graphic_id===e}));if(-1!==i){var o=null===(t=this.graphicExtraMap[e])||void 0===t?void 0:t.realTimeId;o&&clearInterval(o),this.graphicList.splice(i,1)}},e.prototype.updateBoxHandle=function(e,t){if(e.type===p.Laser)return null;var r=this.getBoxInfoByGraphic(e);if(!r)return null;var i=r.x,o=r.y,n=r.width,a=r.height,s=e.type,c=e.graphic_id,d=e.zorder,l=this.getBoxHandle(c);if(!l){(l=document.createElement("div")).setAttribute("id",""+this.whiteboardStore.reservedPrefix.graphicsBox+c),s===p.Text&&(l.style.pointerEvents="initial");var u=null;if(d)for(var h=this.graphicsBoxConNode.querySelectorAll("[data-z]"),f=0;f<h.length;f++)if(+(h[f].getAttribute("data-z")||"")>d){u=h[f];break}this.graphicsBoxConNode.insertBefore(l,u),d&&this.updateGraphicsDomIndex(d)}return"blur"!==t&&(l.style.left=i+"px",l.style.top=o+"px"),l.style.width=n+"px",l.style.height=a+"px",d&&l.setAttribute("data-z",d+""),l},e.prototype.updateGraphicsDomIndex=function(e){var t=this,r=Array.from(this.graphicsBoxConNode.querySelectorAll('[data-z="'+e+'"]')).map((function(e){return e.id.replace(/\D/g,"")}));if(r.length>1){var i=Array.from(this.graphicsConNode.querySelectorAll('[data-z="'+e+'"]')),o=i.map((function(e){return e.id.replace(/\D/g,"")}));if(r.join()!==o.join()){var n=i[i.length-1].nextSibling;r.forEach((function(e){t.graphicsConNode.insertBefore(i[o.findIndex((function(t){return t===e}))],n)}))}}},e.prototype.getInstanceHandle=function(e){var t=this.instancesMap[e];if(!t){switch(e){case o.ZegoWhiteboardViewToolLaser:t=new J(this);break;case o.ZegoWhiteboardViewToolLine:t=new X(this);break;case o.ZegoWhiteboardViewToolText:t=new K(this);break;case o.ZegoWhiteboardViewToolEraser:t=new $(this);break;case o.ZegoWhiteboardViewToolSelector:t=new te(this)}this.instancesMap[e]=t}return t},e.prototype.getBoxHandle=function(e){var t=this.getBoxSelHandle(e);return this.userNode.querySelector(t)},e.prototype.getUserName=function(){return this.serviceHandle.getUserName()},e.prototype.setGraphicsDomZorder=function(e){var t=e.graphic_id,r=e.type,i=e.zorder,o=this.whiteboardStore.reservedPrefix,n=o.textareaCon,a=o.graphicsSvg,s=o.graphicsBox,c=r===p.Text?"#"+n+t:"#"+a+t,d=this.whiteboardNode.querySelector(c);d&&i&&d.setAttribute("data-z",i+""),c="#"+s+t,(d=this.whiteboardNode.querySelector(c))&&i&&d.setAttribute("data-z",i+"")},e.prototype.appendGraphicsDomHandle=function(e,t){if(p.Laser===t)this.graphicsConNode.appendChild(e);else{var r=+(e.getAttribute("data-z")||"");if(r)for(var i=this.graphicsConNode.querySelectorAll("[data-z]"),o=0;o<i.length;o++)if(+(i[o].getAttribute("data-z")||"")>r)return void this.graphicsConNode.insertBefore(e,i[o]);var n=this.graphicsConNode.querySelector("[id^="+this.whiteboardStore.reservedPrefix.laserCon+"]");this.graphicsConNode.insertBefore(e,n)}},e.prototype.appendImageDomHandle=function(e,t){var r=this.whiteboardStore.reservedPrefix,i=r.graphicsSvg,o=r.graphics,n=r.laserCon,a=r.graphicsBox,s=""+i+e,c=""+o+e,d=document.createElementNS("http://www.w3.org/2000/svg","svg"),l=document.createElementNS("http://www.w3.org/2000/svg","g"),u=document.createElementNS("http://www.w3.org/2000/svg","image");d.id=s,d.setAttribute("xmlns","http://www.w3.org/2000/svg"),d.setAttribute("version","1.1"),d.appendChild(l),u.id=c;var h=document.createElement("div");if(h.setAttribute("id",""+a+e),t){d.setAttribute("data-z",t+""),h.setAttribute("data-z",t+"");for(var p=this.graphicsConNode.querySelectorAll("[data-z]"),f=0;f<p.length;f++)if(+(p[f].getAttribute("data-z")||"")>t){this.graphicsConNode.insertBefore(d,p[f]);var g=this.graphicsBoxConNode.querySelectorAll("[data-z]")[f];return this.graphicsBoxConNode.insertBefore(h,g),[l,u,h]}}var m=this.graphicsConNode.querySelector("[id ^= "+n+"]");return this.graphicsConNode.insertBefore(d,m),this.graphicsBoxConNode.appendChild(h),[l,u,h]},e.prototype.resetImageBox=function(){var e=this;this.graphicList.forEach((function(t){if(t.type===p.Image){var r=e.getBoxHandle(t.graphic_id),i=t.y+(t.initY||0);r&&Math.abs(Number(r.style.top.replace("px",""))-i)>3&&e.updateBoxHandle(t)}}))},e.prototype.checkMultipointHandle=function(e){return e.touches.length>1},e.prototype.downCommonHandle=function(e){if(e instanceof TouchEvent){if(this.checkMultipointHandle(e))return!1;"touchstart"!==e.type&&e.preventDefault()}else if(e instanceof MouseEvent&&(e.button||"mouseup"!==e.type&&!e.buttons))return!1;return this.updateOffsetHandle(),this.updateScrollHandle(),!0},e.prototype.updateProtoGraphic=function(e){if(e)Object.assign(this.protoGraphic,e);else{var t=this.whiteboardStore.basicState.type;this.protoGraphic=ie(ie({graphic_id:"",data:[],oldData:"",selected:!1,x:0,y:0,px:0,py:0},this.whiteboardStore.basicState),{type:t,operate_id:"",is_end_draw:!0})}},e.prototype.updateGraphicsDataHandle=function(e){var t=null;switch(this.protoGraphic.type){case p.Pencil:(t=this.protoGraphic.data).push(e.clientX),t.push(e.clientY);break;case p.Image:(t=this.protoGraphic.data).ex=e.clientX,t.ey=e.clientY;break;default:(t=this.protoGraphic.data).splice(2,2,e.clientX,e.clientY)}},e.prototype.initDrawHandle=function(){this.updateProtoGraphic(),this.updateMousePointsHandle()},e.prototype.getBoxInfoByGraphic=function(e){var t=e.type,r=e.graphic_id,i=this.getGraphicsHandle(r);if(!i)return null;var o=t===p.Text||t===p.Image?0:e.size||this.whiteboardStore.basicState.size,n=this.viewInfo.zoom,a=this.whiteboardStore.boxBorderWidth,s=i.getBoundingClientRect(),c=s.left,d=s.top,l=s.width,u=s.height,h=this.transLocationHandle({clientX:c,clientY:d}),f=h.clientX,g=h.clientY;return{x:c=Math.floor(f-a-o/2),y:d=Math.floor(g-a-o/2),width:l=Math.ceil(l/n+o+a),height:u=Math.ceil(u/n+o+a)}},e.prototype.getMouseStartPoint=function(e){var t;if(e instanceof MouseEvent){var r=e,i=r.clientX,o=r.clientY;t=this.transLocationHandle({clientX:i,clientY:o})}else{var n=e.touches[0];i=n.clientX,o=n.clientY;t=this.transLocationHandle({clientX:i,clientY:o})}return t},e.prototype.getMouseChangedPoint=function(e){var t;if(e instanceof MouseEvent){var r=e,i=r.clientX,o=r.clientY;t=this.transLocationHandle({clientX:i,clientY:o})}else{var n=e.changedTouches[0];i=n.clientX,o=n.clientY;t=this.transLocationHandle({clientX:i,clientY:o})}return t},e.prototype.setDataToGraphicList=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var i=0,o=this.graphicList.length;i<o;i++){var n=this.graphicList[i];if(e===n.graphic_id){Object.assign.apply(Object,oe([n],t));break}}},e.prototype.getDataFromGraphicList=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var i={},o=function(r,o){var a=n.graphicList[r];if(e===a.graphic_id)return t.forEach((function(e){i[e]=a[e]})),"break"},n=this,a=0,s=this.graphicList.length;a<s;a++){var c=o(a,s);if("break"===c)break}return i},e.prototype.filterExistingHandle=function(e){var t=this;return e.filter((function(e){var r=e.graphic_id;return e.action===u.Create||t.graphicList.some((function(e){return e.graphic_id===r}))}))},e.prototype.clearLocalHandle=function(){this.graphicTaskList.length=0;var e=this.whiteboardStore.basicState.type;if(e!==o.ZegoWhiteboardViewToolClick&&0!==e){var t=this.getInstanceHandle(e===o.ZegoWhiteboardViewToolPen||e===o.ZegoWhiteboardViewToolRect||e===o.ZegoWhiteboardViewToolEllipse||e===o.ZegoWhitebaordViewToolCustomImage?o.ZegoWhiteboardViewToolLine:e);t.removeEventsHandle(),t.bindEventsHandle()}this.undoList.length=0,this.redoList.length=0;var r=this.getInstanceHandle(o.ZegoWhiteboardViewToolLaser),i=r.findLaserHandle();this.graphicList.length=0,this.graphicsConNode.innerHTML="",i&&r.addLaserHandle(i)},e.prototype.reverseZoomHandle=function(e){var t=this;if(e===o.ZegoWhiteboardViewToolLaser){var r=this.viewInfo.zoom,i=this.whiteboardStore.reservedPrefix.laserCon;this.batchGetGraphicsHandle(this.graphicsConNode,i).forEach((function(e){var i=e.style.transform,o=t.getTranslateXY(i),n=o.x,a=o.y;e.style.transform="translate("+n+"px, "+a+"px) scale("+1/r+")"}))}},e.prototype.getGraphicIsEndDraw=function(e){return this.serviceHandle.getGraphicIsEndDraw(e)},e.prototype.clearPage=function(e){var t=this;this.updateGraphicPage(),this.graphicList.forEach((function(r){var i;(null===(i=r.page)||void 0===i?void 0:i.includes(e))&&t.getGraphicIsEndDraw(r.graphic_id)?r.selected=!0:r.selected=!1})),this.deleteSelectedGraphics("clearPage")},e.prototype.deleteSelectedGraphics=function(e){var t=this;if(this.canDraw||"clearPage"===e){var r=this.graphicList.filter((function(e){return e.is_end_draw=!0,e.operate_id=x(),!!e.selected&&t.getGraphicIsEndDraw(e.graphic_id)}));if(r.length){var i=this.getInstanceHandle(o.ZegoWhiteboardViewToolSelector);i.hideImageEditBox(),i.hideSelectBox(!0),r.forEach((function(e){return t.deleteHandle(e.graphic_id)})),re.a.info(ne("mod.deleteSelectedGraphics"),JSON.stringify({page:this.viewInfo.page,params:r.map((function(e){return e.graphic_id+","+e.page}))})),this.updateToRemoteNewHandle(r,u.Delete)}}},e.prototype.updateGraphicPage=function(){var e=this,t=this.graphicList.filter((function(t){return e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id))}));this.viewInfo.vpageAspecCache?t.forEach((function(t){var r=e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id)),i=r||{offsetTop:0,offsetHeight:0},o=i.offsetTop,n=i.offsetHeight,a=e.getPageByAspec(o,o+n);t.page=a||[e.viewInfo.page||1]})):!this.serviceHandle.getFileInfo(this.whiteboardID)&&this.conNode?t.forEach((function(t){var r=e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id)),i=[];if(1===e.viewInfo.direction){var o=r||{offsetLeft:0,offsetWidth:0},n=o.offsetLeft,a=o.offsetWidth;i=e.getPageByViewInfo(n,n+a,e.viewInfo.viewportWidth)}else{var s=r||{offsetTop:0,offsetHeight:0},c=s.offsetTop,d=s.offsetHeight;i=e.getPageByViewInfo(c,c+d,e.viewInfo.viewportHeight)}t.page=i||[e.viewInfo.page||1]})):this.graphicList.forEach((function(t){t.page=[e.viewInfo.page||1]}))},e.prototype.getPageByAspec=function(e,t){var r=this.viewInfo.vpageAspecCache;if(!r.hasOwnProperty("2"))return[1];for(var i=r.vs,o=r[i].h;o<=e&&r[i+1];)o+=r[i+1].h,i++;for(var n=i;o<=t&&r[n+1];)o+=r[n+1].h,n++;if(n===i)return[r[i].p];if(n-i>1){var a=new Array(n-i-1).fill(null);return a=a.map((function(e,t){return r[i+t+1].p})),oe([r[i].p],a,[r[n].p])}return[r[i].p,r[n].p]},e.prototype.getPageByViewInfo=function(e,t,r){var i=Math.floor(e/r)+1,o=Math.floor(t/r)+1;if(o===i)return[i];if(o-i>1){var n=new Array(o-i-1).fill(null).map((function(e,t){return i+t+1}));return oe([i],n,[o])}return[i,o]},e.prototype.toolAddEL=function(e,t,r){try{var i=this.whiteboardStore[t];if(i&&e.addEventListener(i,r),this.whiteboardStore.isTouch){var o=this.whiteboardStore[t+"PcTouch"];o&&e.addEventListener(o,r)}}catch(e){}},e.prototype.toolRmEl=function(e,t,r){try{var i=this.whiteboardStore[t];if(i&&e.removeEventListener(i,r),this.whiteboardStore.isTouch){var o=this.whiteboardStore[t+"PcTouch"];o&&e.removeEventListener(o,r)}}catch(e){}},e}(),se=r(0),ce=function(e,t,r,i){return new(r||(r=Promise))((function(o,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},de=function(e,t){var r,i,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},le=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<r;t++)for(var n=arguments[t],a=0,s=n.length;a<s;a++,o++)i[o]=n[a];return i},ue=function(){function e(e){this.snapshotResult={image:""},this.canvasRatio=window.devicePixelRatio||1,this.toolInstance=e,this.file=this.toolInstance.serviceHandle.getFileInfo(this.toolInstance.whiteboardID),this.snapshotId=String(Date.now())}return e.prototype.snapshot=function(e){var t=this;return new Promise((function(r,i){return ce(t,void 0,void 0,(function(){var t,i;return de(this,(function(o){return e&&(this.snapshotResult.userData=e),this.createCtx(),this.setWbBgColor(),this.file&&(t={action:se.c.Snapshot,ctx:this.docsCtx,snapshotId:this.snapshotId},this.toolInstance.conNode.dispatchEvent(new CustomEvent(se.b.Whiteboard,{detail:t}))),this.wbSnapshot(),(null===(i=this.file)||void 0===i?void 0:i.fileType)===d.PPTH5?this.snapshotResolve=r:(this.snapshotResult.image=this.mergeCanvas(),r(this.snapshotResult)),[2]}))}))}))},e.prototype.getH5Snapshot=function(e){var t=this,r=this.toolInstance.viewInfo,i=r.viewportWidth,o=r.viewportHeight,n=new Image;n.src=e,n.onload=function(){t.docsCtx.drawImage(n,0,0,i,o),t.snapshotResult.image=t.mergeCanvas(),t.snapshotResolve(t.snapshotResult)}},e.prototype.mergeCanvas=function(){var e=this.toolInstance.viewInfo,t=e.viewportWidth,r=e.viewportHeight,i=document.createElement("canvas");i.width=t*this.canvasRatio,i.height=r*this.canvasRatio;var o=i.getContext("2d");return o.scale(this.canvasRatio,this.canvasRatio),o.drawImage(this.docsCanvas,0,0,t,r),o.drawImage(this.wbCanvas,0,0,t,r),i.toDataURL("image/png",1)},e.prototype.createCtx=function(){var e=this.toolInstance.viewInfo,t=e.viewportWidth,r=e.viewportHeight;this.wbCanvas=document.createElement("canvas"),this.wbCanvas.width=t*this.canvasRatio,this.wbCanvas.height=r*this.canvasRatio,this.wbCtx=this.wbCanvas.getContext("2d"),this.wbCtx.scale(this.canvasRatio,this.canvasRatio),this.docsCanvas=document.createElement("canvas"),this.docsCanvas.width=t*this.canvasRatio,this.docsCanvas.height=r*this.canvasRatio,this.docsCtx=this.docsCanvas.getContext("2d"),this.docsCtx.scale(this.canvasRatio,this.canvasRatio)},e.prototype.setWbBgColor=function(){var e=this.toolInstance.whiteboardStore;this.file?"rgb(241, 243, 244)"!==e.basicState.bgColor&&this.setBgColor(this.wbCtx,e.basicState.bgColor):this.setBgColor(this.wbCtx,e.basicState.bgColor)},e.prototype.setBgColor=function(e,t){var r=this.toolInstance.viewInfo,i=r.viewportWidth,o=r.viewportHeight;e.fillStyle=t,e.fillRect(0,0,i,o)},e.prototype.wbSnapshot=function(){var e=this.sortGraphics();if(e)for(var t=0,r=e;t<r.length;t++){var i=r[t],o=this.getCorrectData(i);switch(i.type){case p.Pencil:case p.Line:this.renderPencil(i,this.wbCtx,o);break;case p.Rect:this.renderRect(i,this.wbCtx,o);break;case p.Ellipse:this.renderEllipse(i,this.wbCtx,o);break;case p.Text:this.renderText(i,this.wbCtx,o);break;case p.Image:this.renderImage(i,this.wbCtx,o)}}},e.prototype.renderPencil=function(e,t,r){var i=function(e){for(var t=e.length,r=.1,i=t-4,o=[e[0],e[1]],n=[],a=0;a<t-2;a+=2){var s=a?e[a-2]:e[0],c=a?e[a-1]:e[1],d=e[a+0],l=e[a+1],u=e[a+2],h=e[a+3],p=a!==i?e[a+4]:u,f=a!==i?e[a+5]:h,g=Number(d)+(u-s)/6*r,m=Number(l)+(h-c)/6*r,v=Number(u)-(p-d)/6*r,y=Number(h)-(f-l)/6*r;n.push([g,m,v,y,u,h])}return{moveTo:o,path:n}}(r);this.setCtxStyle(e,t),t.beginPath(),t.moveTo(i.moveTo[0],i.moveTo[1]),i.path.forEach((function(e){t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])})),t.stroke()},e.prototype.renderRect=function(e,t,r){var i=r[0],o=r[1],n=r[2]-i,a=r[3]-o;this.setCtxStyle(e,t),t.beginPath(),t.strokeRect(i,o,n,a)},e.prototype.renderEllipse=function(e,t,r){var i=r[0],o=r[1],n=(r[2]-i)/2,a=(r[3]-o)/2,s=i+n,c=o+a,d=n>a?Math.abs(n):Math.abs(a);this.setCtxStyle(e,t),t.beginPath(),t.save(),t.translate(s,c),t.scale(n/d,a/d),t.arc(0,0,d,0,2*Math.PI),t.restore(),t.stroke()},e.prototype.renderText=function(e,t,r){this.setCtxStyle(e,t);var i=r.split(","),o=i[0],n=i[1],a=i[2],s=this.toolInstance.getGraphicsHandle(e.graphic_id),c=this.getComputedFs(s.querySelector("pre")||s,"fontSize"),d=this.getComputedLh(s.querySelector("pre")||s,"lineHeight",c),l=(d-1)/2,u=a.split("\n"),h=this.toolInstance.whiteboardStore,p=h.textareaHPadding,f=h.textareaConBorderWidth;u.forEach((function(e,r){var i=+o+p+f,a=+n+c*d*r+c*l*1+f;t.fillText(""+e,i,a)}))},e.prototype.getComputedStyle=function(e,t,r){var i=window.getComputedStyle(e)[t];return r?r(i):i},e.prototype.getComputedLh=function(e,t,r){return this.getComputedStyle(e,t,(function(e){var t=1.2;return e.includes("px")&&(t=+e.replace(/px/,"")/r),t}))},e.prototype.getComputedFs=function(e,t){return this.getComputedStyle(e,t,(function(e){var t=12;return e.includes("px")&&(t=+e.replace(/px/,"")),t}))},e.prototype.renderImage=function(e,t,r){var i=r[0],o=r[1],n=r[2]-i,a=r[3]-o,s=this.toolInstance.graphicsConNode.querySelector("#"+this.toolInstance.whiteboardStore.reservedPrefix.graphics+e.graphic_id);"image"===(null==s?void 0:s.nodeName)&&t.drawImage(s,i,o,n,a)},e.prototype.setCtxStyle=function(e,t){var r=this.toolInstance.viewInfo.viewportWidth,i=N(e.size,p.Pencil,r,!1);if(t.strokeStyle=e.color,t.fillStyle=e.color,e.type!==p.Text)t.lineWidth=i,t.lineJoin="round",t.lineCap="round";else{var o=this.toolInstance.getGraphicsHandle(e.graphic_id),n=this.getComputedFs(o.querySelector("pre")||o,"fontSize")+"px",a="string"==typeof e.attributes?JSON.parse(e.attributes):{},s=a.bold?"bold":"",c=a.italic?"italic":"",d=window.getComputedStyle(o.querySelector("pre")||o).fontFamily.replace(/"/g,"");t.textBaseline="hanging",t.font=c+" "+s+" "+n+" "+d+" "}},e.prototype.sortGraphics=function(){var e=this;return JSON.parse(JSON.stringify(this.toolInstance.graphicList)).filter((function(t){return e.toolInstance.getGraphicsHandle(t.graphic_id)})).sort((function(e,t){return(e.zorder||0)-(t.zorder||0)}))},e.prototype.getCorrectData=function(e){var t=e.type,r=e.data;switch(t){case p.Image:var i=e.data;r=this.correctData([i.x,i.y,i.ex,i.ey]);break;case p.Pencil:case p.Line:case p.Rect:case p.Ellipse:var o=this.correctData(e.data);r=this.getTransData(e,o);break;case p.Text:var n=e.data.split(","),a=n[2],s=this.correctData([+n[0],+n[1]]),c=this.getTransData(e,le(s));r=le(c,[a]).join(",")}return r},e.prototype.correctData=function(e){var t,r=this.toolInstance.viewInfo,i=r.direction,o=r.page,n=r.viewportWidth,a=r.viewportHeight,s=r.scrollY,c=r.isScroll;return 0===i?e:(1===i&&o?t=e.map((function(e,t){return t%2==0&&(e-=(o-1)*n),e})):2===i&&o&&(t=e.map((function(e,t){return t%2==1&&(e-=c?s:(o-1)*a),e}))),t)},e.prototype.getTransData=function(e,t){var r=e.x,i=e.y;return t.map((function(e,t){return e+=t%2==0?r:i}))},e}();function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var pe,fe,ge,me,ve,ye=function(){return(ye=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Se=function(e,t,r,i){return new(r||(r=Promise))((function(o,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},be=function(e,t){var r,i,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},Ee=re.b.bind(null,"wb.v."),Ce=function(){function e(e,t,r){var i=this;this.operationModes={none:!1,scroll:!0,draw:!0,zoom:!0},this.activited=!1,this.viewInfo={},this.graphicList=[],this.scrollLogTimer=null,this.snapshotInstances={},this.scrollHandle=function(e){if(i.operationModes.scroll&&i.viewInfo.isOriginScroll&&!i.viewInfo.ticking&&!i.viewInfo.draging){i.stopLocalDrawHandle(!0);var t=i.viewInfo.zoom,r=e.target,o=r.scrollTop,n=r.scrollLeft,a=Math.ceil(o/t),c=Math.ceil(n/t),d=0,l=0;i.viewInfo.direction===s.Vertical&&a!==i.viewInfo.scrollY?(i.viewInfo.scrollY=a,l=Number((a/i.viewInfo.viewHeight).toFixed(7)),i.checkEmitScrollHandle(d,l,1,!0)):i.viewInfo.direction===s.Horizontal&&c!==i.viewInfo.scrollX&&(i.viewInfo.scrollX=c,d=Number((c/i.viewInfo.viewWidth).toFixed(7)),i.checkEmitScrollHandle(d,l,1,!0))}},this.handleDragStart=function(e){if(!i.operationModes.none&&i.operationModes.zoom&&(i.viewInfo.zoomX=i.viewInfo.zoomY=0,i.viewInfo.zoom>1&&!i.toolInstance.canDraw&&i.parentDom)){var t=e instanceof TouchEvent?e.changedTouches[0]:e,r=t.clientX,o=t.clientY;i.viewInfo.zoomX=r,i.viewInfo.zoomY=o}},this.handleDragEnd=function(e){i.handleDragEvent(e,!0)},this.handleDragEvent=function(e,t){!i.operationModes.none&&i.operationModes.zoom&&("touchmove"===e.type&&e.preventDefault(),i.viewInfo.zoom>1&&i.viewInfo.zoomX&&!i.toolInstance.canDraw&&(t||!i.viewInfo.ticking)&&(requestAnimationFrame((function(){e instanceof MouseEvent&&!t&&e.buttons<1||i.dragPage(e,!!t),i.viewInfo.ticking=!1})),i.viewInfo.ticking=!0))},this.docsviewEventCallback=function(e){var t=e.detail,r=t.action;r!==se.c.H5Snapshot&&re.a.info(Ee("mod.zegodocsevent"),JSON.stringify(t)),r===se.c.Page?i.handleDocsPageEvent(t):r===se.c.ZoomDrag?i.viewInfo.isScroll&&(i.viewInfo.ticking=!t.notify):r===se.c.TargetClick?i.serviceHandle.appendH5Extra(i.whiteboardID,t.data):r===se.c.DocsAspect?i.viewInfo.vpageAspecCache=t.data:r===se.c.H5Snapshot?i.getH5SnapshotResult(t):r===se.c.ReloadView&&i.reinitView()},this.whiteboardID=e,this.whiteboardStore=t,this.serviceHandle=r}return e.prototype.setWhiteboardTransform=function(e,t){var r=this.viewInfo,i=r.viewportWidth,o=r.viewportHeight,n=r.zoom,a=r.direction,c=this.viewInfo.page||1;a===s.Horizontal?e-=(c-1)*i*n:t-=(c-1)*o*n,this.whiteboardNode.style.cssText+="transform:translate("+e+"px,"+t+"px) scale("+n+");"},e.prototype.dragPage=function(e,t){var r=this.viewInfo,i=r.zoom,o=r.zoomTX,n=r.zoomTY,a=r.zoomX,s=r.zoomY,c=r.viewportWidth,d=r.viewportHeight,l=e instanceof TouchEvent?e.changedTouches[0]:e,u=o+l.clientX-a,h=n+l.clientY-s,p=c*(1-i);u>0?u=0:u<p&&(u=p),p=d*(1-i),h>0?h=0:h<p&&(h=p),t?(this.viewInfo.zoomTX=u,this.viewInfo.zoomTY=h,this.viewInfo.zoomX=0,this.viewInfo.zoomY=0):this.setWhiteboardTransform(u,h)},e.prototype.initDragEvents=function(){this.viewInfo.hasOwnProperty("offsetPageX")||(this.viewInfo.offsetPageX=0,this.viewInfo.offsetPageY=0,this.viewInfo.zoom=1,this.viewInfo.zoomX=0,this.viewInfo.zoomY=0,this.viewInfo.zoomTX=0,this.viewInfo.zoomTY=0),this.parentDom&&!this.getFileInfo()&&(this.parentDom.addEventListener("mousedown",this.handleDragStart),this.parentDom.addEventListener("mousemove",this.handleDragEvent),this.parentDom.addEventListener("mouseup",this.handleDragEnd),this.parentDom.addEventListener("mouseleave",this.handleDragEnd),this.whiteboardStore.isTouch&&(this.parentDom.addEventListener("touchstart",this.handleDragStart),this.parentDom.addEventListener("touchmove",this.handleDragEvent),this.parentDom.addEventListener("touchend",this.handleDragEnd)))},e.prototype.updateBindEvents=function(){switch(this.toolInstance.removeEventsHandle(o.ZegoWhiteboardViewToolLaser),this.toolInstance.removeEventsHandle(o.ZegoWhiteboardViewToolLine),this.toolInstance.removeEventsHandle(o.ZegoWhiteboardViewToolText),this.toolInstance.removeEventsHandle(o.ZegoWhiteboardViewToolSelector),this.toolInstance.removeEventsHandle(o.ZegoWhiteboardViewToolEraser),this.whiteboardStore.basicState.type){case o.ZegoWhiteboardViewToolPen:case o.ZegoWhiteboardViewToolLine:case o.ZegoWhiteboardViewToolEllipse:case o.ZegoWhiteboardViewToolRect:case o.ZegoWhitebaordViewToolCustomImage:this.toolInstance.bindEventsHandle(o.ZegoWhiteboardViewToolLine);break;case o.ZegoWhiteboardViewToolLaser:this.toolInstance.bindEventsHandle(o.ZegoWhiteboardViewToolLaser);break;case o.ZegoWhiteboardViewToolText:this.toolInstance.bindEventsHandle(o.ZegoWhiteboardViewToolText);break;case o.ZegoWhiteboardViewToolSelector:this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolSelector),this.toolInstance.bindEventsHandle(o.ZegoWhiteboardViewToolSelector);break;case o.ZegoWhiteboardViewToolEraser:this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolEraser),this.toolInstance.bindEventsHandle(o.ZegoWhiteboardViewToolEraser)}},e.prototype.initToolHandle=function(){this.toolInstance?(this.penetrateEventHandle(this.whiteboardStore.basicState.type),this.toolInstance.zoomNode=this.zoomNode,this.toolInstance.conNode=this.parentDom,this.toolInstance.graphicsConNode=this.graphicsConNode,this.toolInstance.whiteboardNode=this.whiteboardNode,this.toolInstance.graphicsBoxConNode=this.graphicsBoxConNode):(this.toolInstance=new ae({whiteboardID:this.whiteboardID,zoomNode:this.zoomNode,conNode:this.parentDom,graphicsConNode:this.graphicsConNode,whiteboardNode:this.whiteboardNode,graphicsBoxConNode:this.graphicsBoxConNode,serviceHandle:this.serviceHandle,graphicList:this.graphicList,whiteboardStore:this.whiteboardStore,viewInfo:this.viewInfo}),this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolLaser),this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolLine),this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolText),this.setToolType(this.whiteboardStore.basicState.type),this.hookSetToolType())},e.prototype.updateStateSizeHandle=function(e,t){var r=this.viewInfo.viewportWidth;e&&(this.whiteboardStore.basicState.size=e),t&&(this.whiteboardStore.basicState.fontSize=t);var i=this.whiteboardStore.basicState,o=i.size,n=i.fontSize;this.whiteboardStore.basicExtraState.drawSize=N(o,p.Line,r,!1),this.whiteboardStore.basicExtraState.drawFontSize=N(n,p.Text,r,!1)},e.prototype.getDocsViewAspect=function(e,t,r,i){var o,n=e.firstChild;if(n){var a=t.fileType,c="0"==e.getAttribute("data-mode"),l=Number(e.getAttribute("data-page")),u=n.clientWidth,h=n.clientHeight;if(u&&h||(u=+n.style.width.replace("px",""),h=+n.style.height.replace("px","")),a===d.PPTH5){var p=e.previousElementSibling;p&&(p.style.zIndex="0")}var f=null===(o=e.parentElement)||void 0===o?void 0:o.parentElement,g=f.clientWidth,m=f.clientHeight,v=c&&h>i;this.updateViewInfo({isScroll:c,isOriginScroll:v,direction:s.Vertical,pageCount:l,viewWidth:u,viewHeight:h,viewportWidth:r,viewportHeight:i,page:this.viewInfo.page||1,zoom:this.viewInfo.zoom||1,parentWidth:g,parentHeight:m})}return{x:0,y:0,width:this.viewInfo.viewportWidth,height:this.viewInfo.viewportHeight}},e.prototype.getWhiteboardAspect=function(e,t,r){var i=this.getAspectRatio().split(":").map((function(e){return+e})),o=i[0],n=i[1];if(r){var a=o,c=n;this.viewInfo.direction===s.Vertical?c=n/this.viewInfo.pageCount:this.viewInfo.direction===s.Horizontal&&(a=o/this.viewInfo.pageCount);var d=this.getWhiteboardLayout(e,t,a,c),l={parentWidth:e,parentHeight:t,viewWidth:d.width,viewHeight:d.height,viewportWidth:d.width,viewportHeight:d.height};return this.viewInfo.direction===s.Vertical?l.viewHeight=d.height*this.viewInfo.pageCount:this.viewInfo.direction===s.Horizontal&&(l.viewWidth=d.width*this.viewInfo.pageCount),this.updateViewInfo(l),d}var u={page:1,pageCount:1,zoom:1,direction:s.Center,parentWidth:e,parentHeight:t,viewWidth:e,viewHeight:t,viewportWidth:e,viewportHeight:t},h=Math.round(n/(o*t/e));if(h>=2)u.viewWidth=e,u.viewHeight=h*t,u.pageCount=h,u.direction=s.Vertical;else{var p=Math.round(o/(n*e/t));p>=2&&(u.viewWidth=p*e,u.viewHeight=t,u.pageCount=p,u.direction=s.Horizontal)}return this.updateViewInfo(u),{x:0,y:0,width:u.viewportWidth,height:u.viewportHeight}},e.prototype.getWhiteboardLayout=function(e,t,r,i){var o=e,n=i*o/r;return(n>t||Math.abs(n-t)<=1)&&(o=t*e/n|0,n=t),{x:(e-o)/2,y:(t-(n|=0))/2,width:o,height:n}},e.prototype.createModule=function(e,t){var r=this,i=this.getFileInfo(),o=document.getElementById(e),n=o.clientWidth,a=o.clientHeight,s=t&&!i?{x:this.viewInfo.zoomTX/this.viewInfo.viewportWidth,y:this.viewInfo.zoomTY/this.viewInfo.viewportHeight}:{x:0,y:0},c=i?this.getDocsViewAspect(o,i,n,a):this.getWhiteboardAspect(n,a,t),d=c.x,l=c.y,u=c.width,h=c.height,p=this.whiteboardStore.reservedPrefix,f=p.whiteboardZoom,g=p.whiteboardCon,m=p.whiteboard,v=p.boxContainer,y=p.graphicsContainer,S=p.graphicsBgContainer,b=document.createDocumentFragment();[S,y,v].forEach((function(e){var t=document.createElement("div");t.id=""+e+r.whiteboardID,b.appendChild(t)}));var E=this.getElementChild(b);this.graphicsBgConNode=E[0],this.graphicsConNode=E[1],this.graphicsBoxConNode=E[2],this.createGraphicsBox();var C=this.viewInfo,_=C.viewWidth,T=C.viewHeight,R=C.viewportWidth,I=C.viewportHeight;if(this.whiteboardNode=document.createElement("div"),this.whiteboardNode.id=""+m+this.whiteboardID,this.whiteboardNode.style.cssText+="width:"+_+"px;height:"+T+"px;",this.whiteboardNode.appendChild(b),i)this.parentDom=o,this.zoomNode=o.parentNode,o.innerHTML="",o.appendChild(this.whiteboardNode),this.viewInfo.isScroll&&o.addEventListener("scroll",this.scrollHandle),this.handleDocsviewEvent(o);else if(this.parentDom=o.querySelector("#"+g+this.whiteboardID),t&&this.parentDom)this.parentDom.innerHTML="",this.parentDom.style.cssText+="left:"+d+"px;top:"+l+"px;width:"+u+"px;height:"+h+"px;",this.parentDom.appendChild(this.whiteboardNode),this.viewInfo.zoomTX=s.x*R|0,this.viewInfo.zoomTY=s.y*I|0,this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY);else{var L=document.createElement("div");L.id=""+f+this.whiteboardID,this.zoomNode=L;var w=document.createElement("div");w.id=""+g+this.whiteboardID,w.style.cssText="width:100%;height:100%;overflow:hidden",w.appendChild(this.whiteboardNode),L.appendChild(w),o.appendChild(L),this.parentDom=w}this.parentDom.style.userSelect="none",this.serviceHandle.setViewportSize(this.whiteboardID,R,I),this.serviceHandle.setSize(this.whiteboardID,_,T)},e.prototype.activitView=function(){var e;if(this.setActivited(!0),this.parentDom){var t=(null===(e=this.getFileInfo())||void 0===e?void 0:e.fileID)||"";re.a.setExtraConfig({wbId:this.whiteboardID,fileID:t});var r=this.parentDom.parentElement;if(r){var i=r.id;r=r.parentElement,Array.from(this.getElementChild(r)).forEach((function(e){e.style.display=e.id===i?"block":"none"}))}this.graphicsBgConNode.style.backgroundColor=t?"rgba(255,255,255,0)":this.whiteboardStore.basicState.bgColor}},e.prototype.updateViewInfo=function(e){Object.assign(this.viewInfo,e)},e.prototype.removeElement=function(e){if(e){var t=e.parentNode;t?t.removeChild(e):e.remove?e.remove():e.removeNode()}},e.prototype.getElementChild=function(e){return e.children||e.childNodes},e.prototype.stopLocalDrawHandle=function(e){try{var t=this.whiteboardStore.basicState.type,r=o.ZegoWhiteboardViewToolLaser,i=o.ZegoWhiteboardViewToolSelector,n=o.ZegoWhiteboardViewToolText;switch(t){case r:var a=this.toolInstance.getInstanceHandle(r);a&&a.pushActualPlaceHandle();break;case i:var s=this.toolInstance.getInstanceHandle(i);if(s){var c=document.activeElement;c&&c.id&&this.whiteboardNode.querySelector("#"+c.id)&&"TEXTAREA"===c.tagName?c.blur():(this.toolInstance.updateOffsetHandle(),this.toolInstance.updateScrollHandle(),s.mouseupHandle(),s.hideImageEditBox(!0),this.clearSelectedHandle())}break;case n:var d=document.activeElement;d&&d.id&&this.whiteboardNode.querySelector("#"+d.id)&&"TEXTAREA"===d.tagName&&d.blur();break;case o.ZegoWhiteboardViewToolPen:case o.ZegoWhiteboardViewToolRect:case o.ZegoWhiteboardViewToolLine:case o.ZegoWhiteboardViewToolEllipse:case o.ZegoWhitebaordViewToolCustomImage:var l=this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolLine);l&&(this.toolInstance.updateOffsetHandle(),this.toolInstance.updateScrollHandle(),l.mouseupHandle())}e&&this.toolInstance.resetImageBox()}catch(e){}},e.prototype.clearSelectedHandle=function(){this.graphicsBoxConNode.querySelector(".graphics-box").style.display="none",this.graphicList.forEach((function(e){return e.selected=!1}))},e.prototype.setClassNameHandle=function(e){var t,r=this.whiteboardStore.reservedPrefix,i=r.whiteboard,n=r.whiteboardCon,a=r.whiteboardZoom;null===(t=this.zoomNode.parentNode)||void 0===t||t.querySelectorAll("[id^="+i+"]").forEach((function(t){-1===t.id.indexOf(""+n)&&-1===t.id.indexOf(""+a)&&(t.className=o[e]||"")}))},e.prototype.penetrateEventHandle=function(e){var t=this.getFileInfo();if(t&&t.fileType===d.PPTH5&&this.parentDom){var r=this.operationModes.none||e!==o.ZegoWhiteboardViewToolClick?"initial":"none";this.parentDom.style.pointerEvents=r,this.graphicsBoxConNode.style.pointerEvents=r}},e.prototype.checkEmitScrollHandle=function(e,t,r,i){var o=this;null===this.scrollLogTimer&&re.a.info(Ee("mod.emit_scroll"),JSON.stringify({whiteboardID:this.whiteboardID,horizontalPercent:e,verticalPercent:t,step:r,notify:i})),clearTimeout(this.scrollLogTimer),this.scrollLogTimer=setTimeout((function(){re.a.info(Ee("mod.emit_scroll"),JSON.stringify({whiteboardID:o.whiteboardID,horizontalPercent:e,verticalPercent:t,step:r,notify:i})),clearTimeout(o.scrollLogTimer),o.scrollLogTimer=null}),100),this.emitScroll(e,t,1,!0)},e.prototype.emitScroll=function(e,t,r,i){i&&this.serviceHandle.scroll(this.whiteboardID,e,t,r),this.serviceHandle.loadCurrentGraphics(this.whiteboardID,e,t)},e.prototype.jumpPage=function(e,t,r,i,o,n){this.stopLocalDrawHandle(),re.a.info(Ee("mod.jump_page"),JSON.stringify({params:{left:e,top:t,hPercent:r,vPercent:i,step:o}}));var a=this.getFileInfo(),c=this.viewInfo.pageCount;if(!n&&c>=1&&this.viewInfo.page<=c)if(this.viewInfo.direction===s.Horizontal){var d=Math.min(Math.round(r*c)+1,c);this.updateViewInfo({offsetPageX:e,page:d}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY)}else if(a&&this.parentDom){var l={action:se.c.Page,vPercent:i,step:o,notify:n};this.parentDom.dispatchEvent(new CustomEvent(se.b.Whiteboard,{detail:l}))}else{d=Math.min(Math.round(i*c)+1,c);this.updateViewInfo({offsetPageY:t,page:d}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY)}a||this.serviceHandle.actionCustomListener("viewScroll",{id:this.whiteboardID,horizontalPercent:r,verticalPercent:i,page:this.getCurrentPage(),step:o})},e.prototype.handleDocsviewEvent=function(e){var t={action:se.c.WbInit,id:this.whiteboardID};e.dispatchEvent(new CustomEvent(se.b.Whiteboard,{detail:t})),e.addEventListener(se.b.Docs,this.docsviewEventCallback)},e.prototype.handleDocsPageEvent=function(e){var t=this.viewInfo,r=t.viewHeight,i=t.zoom,o=e.y,n=e.page,a=e.pageCount,s=e.scroll,c=e.step,d=e.notify,l=Number((o/i/r).toFixed(7));this.viewInfo.page=n,this.viewInfo.pageCount=a,s||(this.viewInfo.offsetPageY=o/i|0),d?this.emitScroll(0,l,c,!0):this.serviceHandle.updateCache({whiteboardID:this.whiteboardID,verticalPercent:l,pptStep:c}),this.serviceHandle.actionCustomListener("viewScroll",{id:this.whiteboardID,horizontalPercent:0,verticalPercent:l,page:n,step:c})},e.prototype.getH5SnapshotResult=function(e){var t=e.dataUrl,r=e.snapshotId;this.snapshotInstances[r].getH5Snapshot(t)},e.prototype.hookSetToolType=function(){this.updateBindEvents(),this.clearSelectedHandle()},e.prototype.setDragStyle=function(e){if(this.parentDom){var t=this.operationModes.zoom&&0===e;this.parentDom.style.cursor=t?"move":"auto";var r={action:se.c.WbDrag,enable:this.operationModes.scroll,drag:t};this.parentDom.dispatchEvent(new CustomEvent(se.b.Whiteboard,{detail:r}))}},e.prototype.addImageGraphic=function(e,t,r){var i=this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolLine),n=this.toolInstance.transLocationOrigin({clientX:t,clientY:r});return i.drawGraphicImage(e,n.clientX,n.clientY)},e.prototype.reinitView=function(){this.parentDom=null,this.init(this.viewInfo.parent,!0),this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolLaser).updateLaserConSize()},e.prototype.createGraphicsBox=function(){this.graphicsBoxConNode.innerHTML='\n        <div class="img-editor-box">\n            <div class="operation-point-desktop left-top cursor-nwse LT"></div>\n            <div class="operation-point-desktop right-top cursor-nesw RT"></div>\n            <div class="operation-point-desktop left-bottom cursor-nesw LB"></div>\n            <div class="operation-point-desktop right-bottom cursor-nwse RB"></div>\n            <div class="operation-point-desktop top cursor-ns T"></div>\n            <div class="operation-point-desktop right cursor-ew R"></div>\n            <div class="operation-point-desktop bottom cursor-ns B"></div>\n            <div class="operation-point-desktop left cursor-ew L"></div>\n        </div>\n        <div class="graphics-box"></div>'},e.prototype.init=function(e,t){this.viewInfo.parent=e,this.parentDom||this.createModule(e,!!t),this.initToolHandle(),this.updateBindEvents(),this.updateStateSizeHandle(),this.initDragEvents(),this.activitView();var r=this.serviceHandle.getScrollPercent(this.whiteboardID),i=r.horizontalPercent,o=r.verticalPercent,n=r.pptStep;t?this.emitScroll(i,o,n,!1):(this.scrollToHandle(i,o,n,!1),this.playAnimation(this.serviceHandle.getH5Extra(this.whiteboardID),!1)),re.a.info(Ee("mod.init"),JSON.stringify({horizontalPercent:i,verticalPercent:o,step:n,result:this.viewInfo}));var a=this.zoomNode.parentNode,s=a.clientWidth,c=a.clientHeight;Math.abs(s-this.viewInfo.parentWidth)>2||Math.abs(c-this.viewInfo.parentHeight)},e.prototype.setSelfSize=function(){var e=this.viewInfo,t=e.viewWidth,r=e.viewHeight;this.serviceHandle.setSize(this.whiteboardID,t,r)},e.prototype.setActivited=function(e){this.activited=e},e.prototype.isActivited=function(){return this.activited},e.prototype.scrollToHandle=function(e,t,r,i){var o=this;this.stopLocalDrawHandle(!i),r=r||1;var n=this.viewInfo,a=n.zoom,c=n.viewWidth,d=n.viewHeight,l=Math.ceil(e*c),u=Math.ceil(t*d);if(this.emitScroll(e,t,r,i),this.viewInfo.isScroll&&this.parentDom){if(this.viewInfo.ticking=!0,this.viewInfo.direction===s.Horizontal?(this.parentDom.scrollLeft=l*a,this.viewInfo.scrollX=l):(this.parentDom.scrollTop=u*a,this.viewInfo.scrollY=u),setTimeout((function(){return o.viewInfo.ticking=!1}),34),!i){var h={action:se.c.Page,y:u*this.viewInfo.zoom,step:r,notify:i};this.parentDom.dispatchEvent(new CustomEvent(se.b.Whiteboard,{detail:h}))}}else this.jumpPage(l,u,e,t,r,i)},e.prototype.clearLaserHandle=function(e){this.toolInstance&&this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolLaser).clearLaserHandle(e)},e.prototype.clearLocalHandle=function(){this.toolInstance.clearLocalHandle(),this.createGraphicsBox()},e.prototype.updateRemoteToLocal=function(e,t){this.toolInstance.updatePushLocalHandle(e,t)},e.prototype.destroyDomHandle=function(){if(this.parentDom){re.a.info(Ee("mod.destroy_dom"),JSON.stringify({domID:this.parentDom.id}));var e={action:se.c.WbDestroy,id:this.whiteboardID};this.parentDom.dispatchEvent(new CustomEvent(se.b.Whiteboard,{detail:e})),this.removeElement(this.parentDom.parentElement),this.parentDom=null}},e.prototype.playAnimation=function(e,t){var r,i={action:se.c.TargetClick,data:e,isPush:t};null===(r=this.parentDom)||void 0===r||r.dispatchEvent(new CustomEvent(se.b.Whiteboard,{detail:i}))},e.prototype.clear=function(){var e=this;if(!this.operationModes.none&&this.operationModes.draw){re.a.info(Ee("mod.clear"),JSON.stringify({whiteboardID:this.whiteboardID}));var t=C(i.ZegoWhiteboardViewErrorClearFail),r=this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolSelector);r.hideImageEditBox(),r.hideSelectBox(!0),this.serviceHandle.clearView(this.whiteboardID,(function(){try{e.clearLocalHandle(),re.a.info(Ee("mod.clear_cb"),"success")}catch(r){re.a.error(Ee("mod.clear_cb"),JSON.stringify(t)),e.serviceHandle.actionCustomListener("error",t)}}),(function(){re.a.error(Ee("mod.clear_cb"),JSON.stringify(t)),e.serviceHandle.actionCustomListener("error",t)}))}},e.prototype.clearCurrentPage=function(){!this.operationModes.none&&this.operationModes.draw&&this.toolInstance&&this.toolInstance.clearPage(this.viewInfo.page||1)},e.prototype.scroll=function(e,t){if(this.operationModes.none||!this.operationModes.scroll)return!1;if(isNaN(+e)||isNaN(+t)){var r=C(i.ZegoWhiteboardViewErrorParamInvalid,"参数错误: horizontalPercent、verticalPercent取值为0~1",!0);return re.a.error(Ee("mod.scroll"),JSON.stringify(r)),this.serviceHandle.actionCustomListener("error",r),!1}if(re.a.info(Ee("mod.scroll"),JSON.stringify({params:{horizontalPercent:e,verticalPercent:t}})),e<0&&(e=0),e>1&&(e=1),t<0&&(t=0),t>1&&(t=1),e=Number(e.toFixed(7)),t=Number(t.toFixed(7)),re.a.info(Ee("mod.scroll"),JSON.stringify({transParams:{horizontalPercent:e,verticalPercent:t}})),this.viewInfo.pageCount>1&&this.viewInfo.page>0){if(this.parentDom&&this.getFileInfo()){var o={action:se.c.Page,vPercent:t,step:1,notify:!0};return this.parentDom.dispatchEvent(new CustomEvent(se.b.Whiteboard,{detail:o})),!0}if(this.viewInfo.direction===s.Horizontal){var n=e*this.viewInfo.viewWidth|0;(a=Math.round(n/this.viewInfo.viewportWidth)+1)<=this.viewInfo.pageCount&&(this.updateViewInfo({offsetPageX:n,page:a}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY),this.scrollToHandle(e,0,1,!0))}else{var a,c=t*this.viewInfo.viewHeight|0;(a=Math.round(c/this.viewInfo.viewportHeight)+1)<=this.viewInfo.pageCount&&(this.updateViewInfo({offsetPageY:c,page:a}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY),this.scrollToHandle(0,t,1,!0))}return!0}return!1},e.prototype.getCurrentScrollPercent=function(){return ye(ye({},this.serviceHandle.getScrollPercent(this.whiteboardID)),{direction:this.viewInfo.direction})},e.prototype.getHorizontalPercent=function(){return this.getCurrentScrollPercent().horizontalPercent},e.prototype.getVerticalPercent=function(){return this.getCurrentScrollPercent().verticalPercent},e.prototype.undo=function(){!this.operationModes.none&&this.operationModes.draw&&(this.serviceHandle.isElectron?this.serviceHandle.undo(this.whiteboardID):this.toolInstance.undoNewHandle())},e.prototype.redo=function(){!this.operationModes.none&&this.operationModes.draw&&(this.serviceHandle.isElectron?this.serviceHandle.redo(this.whiteboardID):this.toolInstance.redoNewHandle())},e.prototype.getAspectRatio=function(){return this.serviceHandle.getAspectRatio(this.whiteboardID)},e.prototype.getFileInfo=function(){return this.serviceHandle.getFileInfo(this.whiteboardID)},e.prototype.getID=function(){return this.whiteboardID},e.prototype.getName=function(){return this.serviceHandle.getModName(this.whiteboardID)},e.prototype.getCreateTime=function(){return this.serviceHandle.getCreateTime(this.whiteboardID)},e.prototype.getRoomID=function(){return this.serviceHandle.getRoomID(this.whiteboardID)},e.prototype.getCurrentPage=function(){return this.viewInfo.page||1},e.prototype.getPageCount=function(){return this.viewInfo.pageCount||1},e.prototype.setBackgroundColor=function(e){if(this.operationModes.none||!this.operationModes.draw)return!1;if(re.a.info(Ee("mod.setBackgroundColor"),JSON.stringify({params:{color:e}})),!F(e)){var t=C(i.ZegoWhiteboardViewErrorParamInvalid,"参数错误: color仅支持16进制、rgba",!0);return re.a.error(Ee("mod.setBackgroundColor"),JSON.stringify(t)),this.serviceHandle.actionCustomListener("error",t),!1}return this.whiteboardStore.basicState.bgColor=e,this.graphicsBgConNode.style.backgroundColor=e,!0},e.prototype.getBackgroundColor=function(){return this.whiteboardStore.basicState.bgColor},e.prototype.setToolType=function(e){var t;if(this.operationModes.none)return!1;if(e=e||0,re.a.info(Ee("mod.setToolType"),JSON.stringify({params:e})),e===o.ZegoWhiteboardViewToolClick&&(null===(t=this.getFileInfo())||void 0===t?void 0:t.fileType)!==d.PPTH5)return!1;if(-1!==Object.keys(o).indexOf(""+e)||0===e)return this.toolInstance?(this.toolInstance.canDraw=this.operationModes.draw&&!!e&&e!==o.ZegoWhiteboardViewToolClick,this.setClassNameHandle(e),this.setDragStyle(e),this.penetrateEventHandle(e),this.whiteboardStore.basicState.type===e||(this.whiteboardStore.basicState.type=e,this.hookSetToolType()),!0):(this.whiteboardStore.basicState.type=e,!0);var r=C(i.ZegoWhiteboardViewErrorParamInvalid);return re.a.error(Ee("mod.setToolType"),JSON.stringify(r)),this.serviceHandle.actionCustomListener("error",r),!1},e.prototype.getToolType=function(){return this.whiteboardStore.basicState.type||null},e.prototype.setBrushColor=function(e){if(this.operationModes.none||!this.operationModes.draw)return!1;if(re.a.info(Ee("mod.setBrushColor"),JSON.stringify({params:e})),!F(e)){var t=C(i.ZegoWhiteboardViewErrorParamInvalid,"参数错误：color仅支持16进制、rgba",!0);return re.a.error(Ee("mod.setBrushColor"),JSON.stringify(t)),this.serviceHandle.actionCustomListener("error",t),!1}return this.whiteboardStore.basicState.color=e,!0},e.prototype.getBrushColor=function(){return this.whiteboardStore.basicState.color},e.prototype.setBrushSize=function(e){if(this.operationModes.none||!this.operationModes.draw)return!1;if(re.a.info(Ee("mod.setBrushSize"),JSON.stringify({params:e})),function(e){return/^([1-9]|[1-9]\d|100)$/.test(""+e)&&"number"==typeof e}(e))return this.updateStateSizeHandle(e),!0;var t=C(i.ZegoWhiteboardViewErrorParamInvalid,"参数错误: 画笔粗细为100内的正整数",!0);return re.a.error(Ee("mod.setBrushSize"),JSON.stringify(t)),this.serviceHandle.actionCustomListener("error",t),!1},e.prototype.getBrushSize=function(){return this.whiteboardStore.basicState.size},e.prototype.setTextSize=function(e){if(this.operationModes.none||!this.operationModes.draw)return!1;if(re.a.info(Ee("mod.setTextSize"),JSON.stringify({params:e})),function(e){return/^([1-9]|[1-9]\d|100)$/.test(""+e)&&"number"==typeof e}(e))return this.updateStateSizeHandle(void 0,e),!0;var t=C(i.ZegoWhiteboardViewErrorParamInvalid,"参数错误: 文本大小为100内的正整数",!0);return re.a.error(Ee("mod.setTextSize"),JSON.stringify(t)),this.serviceHandle.actionCustomListener("error",t),!1},e.prototype.setFontSize=function(e){return!(this.operationModes.none||!this.operationModes.draw)&&this.setTextSize(e)},e.prototype.getTextSize=function(){return this.whiteboardStore.basicState.fontSize},e.prototype.getFontSize=function(){return this.getTextSize()},e.prototype.setScaleFactor=function(e,t,r){var i=+e;if((!i||i<1)&&(i=1),!this.operationModes.none&&this.operationModes.zoom&&this.viewInfo.zoom!==i&&this.getToolType()!==o.ZegoWhiteboardViewToolClick){if(re.a.info(Ee("mod.setScaleFactor"),JSON.stringify({params:{zoom:i,x:t,y:r}})),this.viewInfo.zoom=i,this.getFileInfo()){if(this.parentDom){var n={action:se.c.WbScale,zoom:i,x:t,y:r};this.parentDom.dispatchEvent(new CustomEvent(se.b.Whiteboard,{detail:n}))}}else this.viewInfo.zoomTX=this.viewInfo.viewportWidth*(1-i)*.5|0,this.viewInfo.zoomTY=this.viewInfo.viewportHeight*(1-i)*.5|0,this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY);this.toolInstance.reverseZoomHandle(o.ZegoWhiteboardViewToolLaser),this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolLaser).updateLaserConSize()}},e.prototype.getScaleFactor=function(){return{scaleFactor:this.viewInfo.zoom,scaleOffsetX:0,scaleOffsetY:0}},e.prototype.getScaleOffsetX=function(){return this.getScaleFactor().scaleOffsetX},e.prototype.getScaleOffsetY=function(){return this.getScaleFactor().scaleOffsetY},e.prototype.setFontItalic=function(e){if(this.operationModes.none||!this.operationModes.draw||"boolean"!=typeof e)return!1;var t=this.whiteboardStore.basicState.attributes,r=JSON.parse(t);return r.italic=e,this.whiteboardStore.basicState.attributes=JSON.stringify(r),re.a.info(Ee("mod.setFontItalic"),JSON.stringify({params:e,result:this.whiteboardStore.basicState.attributes})),!0},e.prototype.isFontItalic=function(){return JSON.parse(this.whiteboardStore.basicState.attributes).italic},e.prototype.setFontBold=function(e){if(this.operationModes.none||!this.operationModes.draw||"boolean"!=typeof e)return!1;re.a.info(Ee("mod.setFontBold"),JSON.stringify({params:e}));var t=this.whiteboardStore.basicState.attributes,r=JSON.parse(t);return r.bold=e,this.whiteboardStore.basicState.attributes=JSON.stringify(r),re.a.info(Ee("mod.setFontBold"),JSON.stringify({params:e,result:this.whiteboardStore.basicState.attributes})),!0},e.prototype.isFontBold=function(){return JSON.parse(this.whiteboardStore.basicState.attributes).bold},e.prototype.addText=function(e,t,r){if(!this.operationModes.none&&this.operationModes.draw&&this.getToolType()===o.ZegoWhiteboardViewToolText)if(!e||!j(t)||!j(r)||t<0||r<0||t>this.viewInfo.viewportWidth||r>this.viewInfo.viewportHeight){var n=C(i.ZegoWhiteboardViewErrorParamInvalid);this.serviceHandle.actionCustomListener("error",n)}else{var a=this.toolInstance.getInstanceHandle(o.ZegoWhiteboardViewToolText);this.toolInstance.updateOffsetHandle(),this.toolInstance.updateScrollHandle();var s=this.toolInstance.transLocationOrigin({clientX:t,clientY:r});t=s.clientX,r=s.clientY,a.addTextGraphics(e,t,r),re.a.info(Ee("mod.addText"),JSON.stringify({params:{text:e,positionX:t,positionY:r}}))}},e.prototype.deleteSelectedGraphics=function(){!this.operationModes.none&&this.operationModes.draw&&this.toolInstance.deleteSelectedGraphics()},e.prototype.addImage=function(e,t,r,o,n){var s=this,c=this.viewInfo.viewportWidth,d=this.viewInfo.viewportHeight,l=a.ZegoWhiteboardViewImageGraphic,u=a.ZegoWhiteboardViewImageCustom;if(this.operationModes.none||!this.operationModes.draw){var h=C(i.ZegoWhiteboardViewErrorGraphicUnableDraw);return Promise.reject(h)}if(!o||e!==l&&e!==u||!j(t)||!j(r)||e===l&&(t<0||r<0||t>c||r>d)||e===u&&"string"!=typeof o){h=C(i.ZegoWhiteboardViewErrorParamInvalid);return Promise.reject(h)}var p=e===l?10485760:512e3;if("string"==typeof o){var f=o;if(!f.startsWith("https://")){h=C(i.ZegoWhiteboardViewErrorGraphicIllegalUrl);return Promise.reject(h)}return new Promise((function(n,a){var c=new XMLHttpRequest;c.open("HEAD",f,!0),c.onreadystatechange=function(){if(4==c.readyState){if(200!=c.status){var d=C(i.ZegoWhiteboardViewErrorInvalidRsp);return a(d)}var l=(c.getResponseHeader("Content-Type")||"").replace("image/",""),h=+c.getResponseHeader("Content-Length");if(!"jpg,jpeg,png,svg+xml".includes(l)){d=C(i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return a(d)}if(h>p){d=C(i.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return a(d)}if(re.a.info(Ee("mod.addImage"),JSON.stringify({params:{type:e,positionX:t,positionY:r,address:o}})),e===u){s.whiteboardStore.basicExtraState.customImage.url=f;var g=new Image;g.onload=function(){s.whiteboardStore.basicExtraState.customImage.w=g.width,s.whiteboardStore.basicExtraState.customImage.h=g.height},g.src=f,n(f)}else s.addImageGraphic(f,t,r).then(n)}},c.onerror=function(){var e=C(i.ZegoWhiteboardViewErrorInvalidRsp);a(e)},c.send(null)}))}if(this.serviceHandle.isElectron&&e===l&&"object"===he(o))return o=o,re.a.info(Ee("mod.addImage"),JSON.stringify({params:{type:e,positionX:t,positionY:r,address:o.path}})),this.serviceHandle.uploadImage(o.path,n).then((function(e){return s.addImageGraphic(e,t,r)}));var g=(o=o).type.replace("image/","");if(!"jpg,jpeg,png,svg+xml".includes(g)){h=C(i.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return Promise.reject(h)}if(o.size>p){h=C(i.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return Promise.reject(h)}return re.a.info(Ee("mod.addImage"),JSON.stringify({params:{type:e,positionX:t,positionY:r,address:o.name}})),this.serviceHandle.uploadImage(o,n).then((function(e){return s.addImageGraphic(e,t,r)}))},e.prototype.setWhiteboardOperationMode=function(e){if(e&&j(e)){var t=!!(e%2),r=!t&&[2,6,10,14].includes(e),i=!t&&[4,6,12,14].includes(e),n=!t&&[8,10,12,14].includes(e);Object.assign(this.operationModes,{none:t,scroll:r,draw:i,zoom:n});var a=this.whiteboardStore.basicState.type;this.toolInstance&&(this.toolInstance.canDraw=i&&!!a&&a!==o.ZegoWhiteboardViewToolClick),this.setDragStyle(a),this.penetrateEventHandle(a),re.a.info(Ee("mod.setWhiteboardOperationMode"),JSON.stringify({params:e,result:this.operationModes}))}},e.prototype.snapshot=function(e){return Se(this,void 0,void 0,(function(){var t,r,i;return be(this,(function(o){switch(o.label){case 0:return t=null==e?void 0:e.userData,r=new ue(this.toolInstance),this.snapshotInstances[r.snapshotId]=r,[4,r.snapshot(t)];case 1:return i=o.sent(),delete this.snapshotInstances[r.snapshotId],[2,i]}}))}))},e}(),_e=re.b.bind(null,"wb.m."),Te=function(){function e(e,t){this.modIdMapInstance={},this.fileInfoMap={},this.signallingDelay=0,this.store=t,this.serviceHandle=e,this.registerLoadfileListener(),this.registerPushCallbackHandle(),this.registerPullCallbackHandle()}return e.prototype.registerLoadfileListener=function(){var e=this;document.body.addEventListener("loadfile",(function(t){var r=t.detail.fileID;e.fileInfoMap[r]=t.detail,re.a.info(_e("update_file_info"),JSON.stringify({fileID:r,detail:t.detail}))}))},e.prototype.registerPushCallbackHandle=function(){var e=this;this.serviceHandle.bindListener("pushClearPageGraphics",(function(t){e.signallingDelay?setTimeout((function(){e.clearGraphicsPushCallback(t)}),e.signallingDelay):e.clearGraphicsPushCallback(t)})),this.serviceHandle.bindListener("pushDrawPageGraphics",(function(t,r){e.signallingDelay?setTimeout((function(){e.drawGraphicsPushCallback(t,r)}),e.signallingDelay):e.drawGraphicsPushCallback(t,r)})),this.serviceHandle.bindListener("pushAddMod",(function(t){e.signallingDelay?setTimeout((function(){e.addModPushCallback(t)}),e.signallingDelay):e.addModPushCallback(t)})),this.serviceHandle.bindListener("pushRemovedMod",(function(t){e.signallingDelay?setTimeout((function(){e.removedModPushCallback(t)}),e.signallingDelay):e.removedModPushCallback(t)})),this.serviceHandle.bindListener("pushScroll",(function(t,r,i,o){e.signallingDelay?setTimeout((function(){e.scrollPushCallback(t,r,i,o)}),e.signallingDelay):e.scrollPushCallback(t,r,i,o)})),this.serviceHandle.bindListener("h5ExtraAppendedNotify",(function(t,r){e.signallingDelay?setTimeout((function(){e.h5ExtraAppendedPushCallback(t,r)}),e.signallingDelay):e.h5ExtraAppendedPushCallback(t,r)}))},e.prototype.registerPullCallbackHandle=function(){var e=this;this.serviceHandle.bindListener("getPageGraphicsList",(function(t,r,i){var o=e.getMapInstance(t);o&&o.updateRemoteToLocal(r,i)})),this.serviceHandle.bindListener("scroll",(function(e){var t=e.whiteboardID,r=e.code,i=e.msg;0===r?re.a.info(_e("mod.scroll_cb"),JSON.stringify({whiteboardID:t})):re.a.error(_e("mod.scroll_cb"),JSON.stringify(C(r,i)))})),this.serviceHandle.bindListener("appendH5ExtraCallback",(function(t){var r=t.whiteboardID,i=t.code,o=t.msg,n=t.modExtra;if(0===i)re.a.info(_e("mod.append_h5extra_cb"),"whiteboardID="+r+",modExtra="+n);else{var a=C(i,o);re.a.error(_e("mod.append_h5extra_cb"),JSON.stringify(a)),e.serviceHandle.actionCustomListener("error",a)}}))},e.prototype.addModPushCallback=function(e){var t=this.getMapInstance(e);t||(re.a.info(_e("mod.remote_add"),JSON.stringify({whiteboardID:e})),t=new Ce(e,this.store,this.serviceHandle),this.setMapInstance(t)),this.serviceHandle.actionCustomListener("viewAdd",t)},e.prototype.removedModPushCallback=function(e){var t=this.getMapInstance(e);t&&(re.a.info(_e("mod.remote_removed"),JSON.stringify({whiteboardID:e})),t.destroyDomHandle(),t=null,this.deleteMapInstance(e),this.serviceHandle.actionCustomListener("viewRemoved",e))},e.prototype.scrollPushCallback=function(e,t,r,i){var o=this.getMapInstance(e);o&&(re.a.info(_e("mod.remote_scroll"),JSON.stringify({whiteboardID:e,horizontalPercent:t,verticalPercent:r,step:i,actionMsg:"transValue"})),o.isActivited()&&o.scrollToHandle(t,r,i,!1))},e.prototype.h5ExtraAppendedPushCallback=function(e,t){var r=this.getMapInstance(e);r&&(re.a.info(_e("mod.remote_h5extra"),"whiteboardID="+e+",modExtra="+t),r.isActivited()&&r.playAnimation(t,!0))},e.prototype.clearGraphicsPushCallback=function(e){var t=this.getMapInstance(e);t&&(re.a.info(_e("mod.remote_clear"),JSON.stringify({whiteboardID:e})),t.clearLocalHandle())},e.prototype.drawGraphicsPushCallback=function(e,t){var r=this.getMapInstance(e);if(r){var i=[],o=[];t.forEach((function(e){var t=e.del_graphic_id_list,r=e.graphic_list;i=i.concat(t),r.forEach((function(e){e.data&&(e.data.length||e.data.url)&&!o.some((function(t){return t.graphic_id===e.graphic_id}))&&o.push(e)}))})),r.updateRemoteToLocal(o,i)}},e.prototype.setFileInfo=function(e){var t;if(e.fileInfo){var r=e.fileInfo,i=r.fileID,o=r.fileName,n=this.fileInfoMap[i];(n=n&&n[o])&&(e.aspectWidth=n.width,e.aspectHeight=n.height,e.pageCount=n.pageCount,re.a.info(_e("update_file_info"),JSON.stringify({fileID:i,detail:(t={fileID:i},t[o]=n,t)})))}},e.prototype.deleteMapInstance=function(e){delete this.modIdMapInstance[e]},e.prototype.getMapInstance=function(e){return this.modIdMapInstance[e]},e.prototype.setMapInstance=function(e){this.modIdMapInstance[e.getID()]=e},e.prototype.activitedView=function(e){Object.values(this.modIdMapInstance).forEach((function(t){t.setActivited(t.getID()==e)}))},e.prototype.checkAttachingParent=function(e){return!!document.getElementById(e)},e.prototype.checkCreatingView=function(e){return!(!e||!e.roomID||!e.name||isNaN(+e.aspectWidth)||!+e.aspectWidth||isNaN(+e.aspectHeight)||!+e.aspectHeight||isNaN(+e.pageCount)||!+e.pageCount)},e.prototype.checkViewName=function(e){return e.name.length<=50},e.prototype.setDeferredRenderingTime=function(e){this.signallingDelay=e||0},e.prototype.clear=function(e){Object.values(this.modIdMapInstance).forEach((function(t){t&&t.clearLaserHandle(e)})),re.a.info(_e("clear"))},e.prototype.getViewList=function(){var e=this;return new Promise((function(t,r){e.serviceHandle.getModList(1,(function(o){try{Object.keys(e.modIdMapInstance).forEach((function(t){-1===o.indexOf(t)&&e.deleteMapInstance(t)})),o.forEach((function(t){e.modIdMapInstance[t]||e.setMapInstance(new Ce(t,e.store,e.serviceHandle));var r=e.getMapInstance(t);r&&r.setSelfSize()})),re.a.info(_e("getViewList"),JSON.stringify(Object.keys(e.modIdMapInstance)));var n=Object.values(e.modIdMapInstance).sort((function(t,r){return e.serviceHandle.getCreateTime(r.getID())-e.serviceHandle.getCreateTime(t.getID())}));t(n)}catch(e){re.a.error(_e("getViewList"),JSON.stringify(e)),r(C(i.ZegoWhiteboardViewErrorGetListFail))}}),(function(e){re.a.error(_e("getViewList"),JSON.stringify(e)),r(e)}))}))},e.prototype.createView=function(e){var t=this;return new Promise((function(r,o){if(re.a.info(_e("createView"),JSON.stringify(e)),!t.checkCreatingView(e)){var n=C(i.ZegoWhiteboardViewErrorParamInvalid,"参数错误：roomID、name为字符串，aspectWidth、aspectHeight、pageCount为正整数",!0);return re.a.error(_e("createView"),JSON.stringify(n)),void o(n)}if(!t.checkViewName(e)){n=C(i.ZegoWhiteboardViewErrorViewNameLimit);return re.a.error(_e("createView"),JSON.stringify(n)),void o(n)}t.setFileInfo(e),t.serviceHandle.createMod(e,(function(e){try{var n=t.getMapInstance(e);n||(n=new Ce(e,t.store,t.serviceHandle),t.setMapInstance(n),re.a.info(_e("createView"),"success")),r(n)}catch(e){re.a.error(_e("createView"),JSON.stringify(e)),o(C(i.ZegoWhiteboardViewErrorViewCreateFail))}}),(function(e){re.a.error(_e("createView"),JSON.stringify(e)),o(e)}))}))},e.prototype.destroyView=function(e){var t=this;return new Promise((function(r,o){if(!e||!e.getID){var n=C(i.ZegoWhiteboardViewErrorViewNotExist);return re.a.error(_e("destroyView"),JSON.stringify({whiteboardView:e,errorData:n})),void o(n)}t.serviceHandle.destroyMod(e.getID(),(function(){try{t.deleteMapInstance(e.getID()),e.destroyDomHandle(),e=null,re.a.info(_e("destroyView"),"success"),r()}catch(e){re.a.error(_e("destroyView"),JSON.stringify(e)),o(C(i.ZegoWhiteboardViewErrorDestroyFail))}}),(function(e){re.a.error(_e("destroyView"),JSON.stringify(e)),o(e)}))}))},e.prototype.attachView=function(e,t){var r=this;return new Promise((function(o,n){if(!r.checkAttachingParent(t)){var a=C(i.ZegoWhiteboardViewErrorViewParentNotExist);return re.a.error(_e("attachView"),JSON.stringify({parent:t,errorData:a})),void n(a)}if(!e||!e.getID){a=C(i.ZegoWhiteboardViewErrorViewNotExist);return re.a.error(_e("attachView"),JSON.stringify({whiteboardView:e,errorData:a})),void n(a)}re.a.info(_e("attachView"),JSON.stringify({whiteboardID:e.getID(),parent:t}));try{var s=e;s.init(t),r.setMapInstance(s),r.activitedView(s.getID()),re.a.info(_e("attachView"),"success"),o()}catch(e){re.a.error(_e("attachView"),JSON.stringify(e)),n(C(i.ZegoWhiteboardViewErrorAttachFail))}}))},e.prototype.on=function(e,t){return re.a.info(_e("on"),JSON.stringify({event:e})),this.serviceHandle.bindCustomListener(e,t)},e.prototype.off=function(e,t){return re.a.info(_e("off"),JSON.stringify({event:e})),this.serviceHandle.deleteCustomListener(e,t)},e}(),Re=function(){this.reservedPrefix={whiteboardZoom:"zego-whiteboard-zoom",fileWhiteboardCon:"zego-docsview-con",whiteboardCon:"zego-whiteboard-con",whiteboard:"zego-whiteboard",laserContainer:"zego-other-container",graphicsBgContainer:"zego-graphics-bg-container",graphicsContainer:"zego-graphics-container",graphicsSvg:"zego-svg",textareaCon:"zego-textarea",laserCon:"zego-laser",graphics:"zego-graphics",boxContainer:"zego-box-container",graphicsBox:"zego-graphics-box"},this.basicState={type:o.ZegoWhiteboardViewToolPen,size:6,fontSize:24,color:"#0044FF",bgColor:"rgb(241, 243, 244)",attributes:'{"bold": false, "italic": false}'},this.basicExtraState={drawSize:0,drawFontSize:0,customImage:{url:"",w:80,h:80}},this.realTimeState={localDrawCount:10,remoteDrawDelay:4,remoteDrawCount:2,remoteDrawEndDelay:1e4},this.isTouch="ontouchstart"in document.body||navigator.maxTouchPoints>0,this.boxPadding=0,this.textareaBoxPadding=24,this.textareaHPadding=6,this.textareaVPadding=0,this.textareaConBorderWidth=1,this.lineHeight=1.5,this.boxBorderWidth=2,this.maxlength=200,this.scrollbarSize=20,this.initLaserX=0,this.initLaserY=0,this.hiddenLaserX=-100,this.hiddenLaserY=-100,this.hiddenLaserDelay=5e3,this.wheelEventName="wheel",this.downEventName="mousedown",this.upEventName="mouseup",this.moveEventName="mousemove",this.leaveEventName="mouseleave",this.isTouch&&(this.downEventNamePcTouch="touchstart",this.upEventNamePcTouch="touchend",this.moveEventNamePcTouch="touchmove")},Ie=(r(242),function(){function e(e,t){this.isElectron=!1,this.customListenerList={error:[],viewAdd:[],viewRemoved:[],viewScroll:[]},this.isElectron="electron"===t,this.whiteboardStore=e}return e.prototype.bindCustomListener=function(e,t){return!!this.customListenerList[e]&&("function"==typeof t&&(-1==this.customListenerList[e].indexOf(t)&&this.customListenerList[e].push(t),!0))},e.prototype.deleteCustomListener=function(e,t){if(!this.customListenerList[e])return!1;var r=this.customListenerList[e];return t?r.splice(r.indexOf(t),1):this.customListenerList[e]=[],!0},e.prototype.actionCustomListener=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.customListenerList[e]&&this.customListenerList[e].forEach((function(e){e.apply(void 0,t)}))},e}()),Le=r(153),we=r.n(Le),Me=r(98),ke=r(17),Pe=function(){return(Pe=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},xe=function(e,t,r,i){return new(r||(r=Promise))((function(o,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},De=function(e,t){var r,i,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},Ne=function(){function e(){this.axiosInstance=we.a.create(),this.config=null,this.domains={}}return e.prototype.setConfig=function(e){if(!this.config){var t=e.isTestEnv?"https://docservice-test.zego.im":"https://docservice.zego.im";this.domains={cvt:t+"/doc/cvt_doc",query:t+"/doc/query_status",access:t+"/doc/access"},this.config={platform:32,app_id:e.appID,web_token:e.token,id_name:e.userID}}},e.prototype.isConfiged=function(){return!!this.config},e.prototype.uploadImage=function(e,t){return xe(this,void 0,void 0,(function(){var r=this;return De(this,(function(i){return[2,new Promise((function(i,o){return xe(r,void 0,void 0,(function(){var r,n,a,s,c,d,l,u,h,p;return De(this,(function(f){switch(f.label){case 0:return f.trys.push([0,9,,10]),r=e.name,n=e.size,a=r.substr(r.lastIndexOf(".")+1).toLowerCase(),[4,Object(Me.a)(e)];case 1:return s=f.sent(),[4,this.queryStatus(s)];case 2:return c=f.sent(),d=c.status,l=c.oss,u=c.file_id,d!==se.l.UPLOADING?[3,4]:[4,this.upload(l,e,r,s,a,t,i)];case 3:return f.sent(),[3,8];case 4:return d!==se.l.CONVERTED?[3,6]:(h=i,[4,this.load(u)]);case 5:return h.apply(void 0,[f.sent()]),[3,8];case 6:return[4,this.repeatQuery(r,s,n,"",i)];case 7:f.sent(),f.label=8;case 8:return[3,10];case 9:return p=f.sent(),o(p),[3,10];case 10:return[2]}}))}))}))]}))}))},e.prototype.repeatQuery=function(e,t,r,i,o){return xe(this,void 0,void 0,(function(){var n,a,s,c,d=this;return De(this,(function(l){switch(l.label){case 0:return[4,this.queryStatus(t,i)];case 1:return n=l.sent(),a=n.status,s=n.file_id,a===se.l.CONVERTED&&o?(c=o,[4,this.load(s)]):[3,3];case 2:return c.apply(void 0,[l.sent()]),[3,6];case 3:return a!==se.l.UPLOADED?[3,5]:[4,this.cvt(e,t,r,o)];case 4:return l.sent(),[3,6];case 5:a!==se.l.WAITING&&a!==se.l.CONVERTING||setTimeout((function(){return xe(d,void 0,void 0,(function(){return De(this,(function(n){switch(n.label){case 0:return[4,this.repeatQuery(e,t,r,i,o)];case 1:return n.sent(),[2]}}))}))}),2e3),l.label=6;case 6:return[2]}}))}))},e.prototype.queryStatus=function(e,t){return xe(this,void 0,void 0,(function(){var r,i,o,n,a,s;return De(this,(function(c){switch(c.label){case 0:return r=Pe(Pe({},this.config),t?{task_id:t}:{file_hash:e,file_type:se.j.ZegoDocsViewFileTypeIMG,expect_file_type:ke.a.IMG}),[4,this.axiosInstance({method:"post",url:this.domains.query,timeout:ke.b,data:r})];case 1:return i=c.sent().data,o=i.ret,n=i.status,a=i.file_id,s=i.oss,0===o.code?[2,{status:n,file_id:a,oss:s}]:[2]}}))}))},e.prototype.upload=function(e,t,r,i,o,n,a){return xe(this,void 0,void 0,(function(){var s,c,d;return De(this,(function(l){switch(l.label){case 0:return s=e.host+"/"+e.object_name+"?."+o,c=Object(Me.b)(e),(d=new FormData).append("OSSAccessKeyId",c.OSSAccessKeyId),d.append("x-oss-security-token",c.securityToken),d.append("signature",c.signature),d.append("policy",c.policy),d.append("successActionStatus",c.successActionStatus),d.append("key",c.objectName),d.append("file",t),d.append("name",r),[4,this.axiosInstance({method:"post",url:c.url,data:d,timeout:ke.c,onUploadProgress:function(e){if(n){var t=e.total,o=e.loaded;n({fileName:r,fileHash:i,uploadPercent:Math.floor(o/t*100)})}}})];case 1:return l.sent(),this.cvt(r,i,t.size,void 0),a(s),[2]}}))}))},e.prototype.cvt=function(e,t,r,i){return xe(this,void 0,void 0,(function(){var o;return De(this,(function(n){switch(n.label){case 0:return[4,this.axiosInstance({method:"post",url:this.domains.cvt,timeout:ke.b,data:Pe(Pe({},this.config),{file_name:e,file_hash:t,file_size:r,file_type:se.j.ZegoDocsViewFileTypeIMG,expect_file_type:ke.a.IMG,export_high_quality_images:!1})})];case 1:return 0===(o=n.sent().data).ret.code&&i?[4,this.repeatQuery(e,t,r,o.task_id,i)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},e.prototype.load=function(e){return xe(this,void 0,void 0,(function(){var t,r;return De(this,(function(i){switch(i.label){case 0:return[4,this.axiosInstance({method:"post",url:this.domains.access,timeout:ke.b,data:Pe(Pe({},this.config),{file_id:e})})];case 1:if(0===(t=i.sent().data).ret.code)return r=t.file_name.substr(t.file_name.lastIndexOf(".")+1).toLowerCase(),[2,t.original_file_urls[0]+"?."+r];throw Object(se.m)(t.ret.code,t.ret.message)}}))}))},e}(),Ae=(r(160),r(286),r(162),r(166),r(167),r(168),r(169),r(170),r(171),r(172),r(287),r(173),r(174),r(175),r(176),r(177),r(179),r(180),r(181),r(182),r(183),r(184),r(185),r(186),r(187),r(188),r(189),function(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}),Oe=function(e,t,r,i){var o=i.charCodeAt(t);e[t]=i.charCodeAt(r),e[r]=o},Ue=function(e){for(var t=e.split(","),r=new Uint8Array(Int32Array.from([+t[0],+t[1]]).buffer),i=unescape(encodeURIComponent(t.slice(2).join(","))).split("").map((function(e){return e.charCodeAt()})),o=0;o<r.length;o+=4)Ae(r,o,o+3),Ae(r,o+1,o+2);var n=new Uint8Array(r.length+i.length);return n.set(r),n.set(i,r.length),btoa(String.fromCharCode.apply(null,n))},ze=function(e){for(var t=atob(e),r=new Uint8Array(t.length),i=0;i<8;i+=4)Oe(r,i,i+3,t),Oe(r,i+1,i+2,t);for(;i<t.length;i++)r[i]=t.charCodeAt(i);return Array.from(new Int32Array(r.buffer,0,2)).join(",")+","+decodeURIComponent(escape(String.fromCharCode.apply(String,Array.from(r.subarray(8)))))},He=function(e){var t=unescape(encodeURIComponent(e)).split("").map((function(e){return e.charCodeAt()}));return btoa(String.fromCharCode.apply(null,new Uint8Array(t)))},Be=function(e){for(var t=atob(e),r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return decodeURIComponent(escape(String.fromCharCode.apply(String,Array.from(r))))},qe=function(e,t,r,i){return Math.round(i?e*t/r:e*r/t)},Ve=function(e,t){var r=e.type,i=e.data,o=e.oldData,n=e.action,a=e.is_end_draw;if(r===p.Text)t?(e.data=ze(i),o&&(e.oldData=ze(o))):(e.data=Ue(i),o&&(e.oldData=Ue(o)));else if(r===p.Image)t?(e.data=JSON.parse(Be(i)),o&&(e.oldData=JSON.parse(Be(o)))):(e.data=He(i),o&&(e.oldData=He(o)));else if(t){for(var s=atob(i||""),c=new Uint8Array(s.length),d=0;d<s.length;d+=4)Oe(c,d,d+3,s),Oe(c,d+1,d+2,s);e.data=Array.from(new Int32Array(c.buffer)),e.data=e.data.slice(r!==p.RealTime&&e.data.length%2?1:0)}else{var l=i.slice();(r!==p.Pencil||a||n!==u.Create&&n!==u.Append)&&l.unshift(l.length/2);for(c=new Uint8Array(Int32Array.from(l).buffer),d=0;d<c.length;d+=4)Ae(c,d,d+3),Ae(c,d+1,d+2);e.data=btoa(String.fromCharCode.apply(null,c))}},We=function(e,t,r){var i=e.type,o=e.px,n=e.py,a=e.x,s=e.y,c=S.placeWidth;if(e.px&&(e.px=qe(o,t,c,r)),e.py&&(e.py=qe(n,t,c,r)),e.x=qe(a,t,c,r),e.y=qe(s,t,c,r),i===p.Text){var d=e.data.split(",");d[0]=qe(+d[0],t,c,r)+"",d[1]=qe(+d[1],t,c,r)+"",e.data=d.join(",")}else if(i===p.Image){var l;if(r)(l=e.data).x=qe(l.x,t,c,r),l.y=qe(l.y,t,c,r),l.ex=qe(l.ex,t,c,r),l.ey=qe(l.ey,t,c,r),e.initX=l.x,e.initY=l.y,l.x+=e.x,l.y+=e.y,l.ex+=e.x,l.ey+=e.y;else(l=e.data).x=qe(l.x,t,c,r),l.y=qe(l.y,t,c,r),l.ex=qe(l.ex,t,c,r),l.ey=qe(l.ey,t,c,r),e.data=JSON.stringify(l)}else e.data=e.data.map((function(e){return qe(e,t,c,r)}))};!function(e){e[e.Initiative=1]="Initiative",e[e.Inner=2]="Inner"}(pe||(pe={})),function(e){e[e.InProgress=1]="InProgress",e[e.Pending=2]="Pending",e[e.Resolve=3]="Resolve",e[e.Reject=4]="Reject"}(fe||(fe={})),function(e){e[e.success=1]="success",e[e.error=2]="error"}(ge||(ge={})),function(e){e[e.SetMod=1]="SetMod",e[e.ClearPageGraphics=2]="ClearPageGraphics",e[e.DrawPageGraphics=3]="DrawPageGraphics"}(me||(me={})),function(e){e[e.Add=1]="Add",e[e.Removed=2]="Removed",e[e.Modify=3]="Modify"}(ve||(ve={}));var Fe,Ge=(Fe=function(e,t){return(Fe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}Fe(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),je=function(){return(je=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ze=function(e,t,r,i){return new(r||(r=Promise))((function(o,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},Je=function(e,t){var r,i,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},Ye=re.b.bind(null,"wb.s."),Xe=function(e){function t(t){var r,i=e.call(this,t.whiteboardStore,"web")||this;i.modIdMapData={},i.listenerList={},i.graphicLimit=100,i.modLimit=50,i.modListSeq=0,i.zorderSeq=1,i.zorderStep=(r=Math.sqrt(Math.sqrt(+P(M())))*Math.random()|0)>99?.3*r|0:r<3?r+10*Math.random()|0:r,i.graphicMap={};var o=t.stateCenter,n=t.socketCenter;return i.stateCenter=o,i.socketCenter=n,i.docsService=new Ne,i}return Ge(t,e),t.prototype.transModInfo=function(e,t){var r={room_id:""},i={ar_w:1,ar_h:1,x:0,y:0,w:0,h:0,z:0};if(e){var o=JSON.parse(e),n=o.file_info;n&&(o.file_info={fileID:n.file_id,fileName:n.file_name,fileType:+n.file_type,authKey:n.auth_key}),r=o}return t&&(i=JSON.parse(t)),{modContent:r,modPos:i}},t.prototype.createModInfo=function(e){var t={room_id:e.roomID};if(e.fileInfo){var r=e.fileInfo,i=r.fileID,o=r.fileName,n=r.fileType,a=r.authKey;t.file_info={file_id:i,file_name:o,file_type:n,auth_key:a}}return e.pageCount&&(t.whiteboard_page_count=e.pageCount),{modContent:t,modPos:{x:0,y:0,w:0,h:0,z:0,ar_w:e.aspectWidth,ar_h:e.aspectHeight}}},t.prototype.getModHeader=function(){return{sdk_version:1,id_name:this.stateCenter.idName}},t.prototype.getModInfo=function(e){var t=this;return new Promise((function(r,i){t.queueWSCmdHandler("/eduv1/get_mod","/eduv1/get_mod",{header:t.getModHeader(),body:JSON.stringify({mod_id_list:e})},(function(e){t.handleGetModInfoRsp(e,r,i)}))}))},t.prototype.posToPageNum=function(e,t,r,i,o,n,a){var c=r.cx,d=r.cy,l=0;return c&&d&&(i+=n,o+=a,l=(l=(l=e===s.Horizontal?i<=0?0:Math.floor(i/c):o<=0?0:Math.floor(o/d))>t-1?t-1:l)>99?99:l),l},t.prototype.mapPageNumList=function(e){for(var t=[],r=Math.min.apply(Math,e),i=Math.max.apply(Math,e),o=r;o<=i;o++)t.push(o);return t},t.prototype.judgeGraphicPage=function(e,t){var r=this,i=this.getMap(e),o=i.innerDirection,n=i.innerPageSize,a=i.innerPageCount,s=[],c=t.type,d=t.x,l=t.y;switch(c){case p.Text:var u=V(t.data),h=u.beginX,f=u.beginY,g=this.posToPageNum(o,a,n,Number(h),Number(f),d,l);s=this.mapPageNumList([g]);break;case p.Pencil:case p.Line:case p.Rect:case p.Ellipse:case p.Laser:var m=[];t.data.forEach((function(e,t,i){t%2||m.push(r.posToPageNum(o,a,n,i[t],i[t+1],d,l))})),s=this.mapPageNumList(m);break;case p.Image:var v=t.data,y=v.x,S=v.y,b=v.ex,E=v.ey,C=this.posToPageNum(o,a,n,y,S,0,0),_=this.posToPageNum(o,a,n,b,E,0,0);s=this.mapPageNumList([C,_])}return s},t.prototype.checkProtoGraphic=function(e){var t=e.action,r=e.action_type,i=e.graphic_id,o=e.type,n=e.data,a=e.color,s=e.size,c=e.x,d=e.y,l=e.zorder,h=e.attributes,f=e.operate_id,g=e.is_end_draw,m={action:t,action_type:r,graphic_id:i,type:o,operate_id:f,is_end_draw:g};return t===u.Create||t===u.Append?(m.x=c,m.y=d,m.data=n,m.zorder=l,m.color=a,m.size=s,o===p.Text&&(m.attributes=h)):t===u.Update?(m.data=n,m.zorder=l,m.x=c,m.y=d,o===p.Text?(m.color=a,m.size=s,m.attributes=h):o===p.Image||(m.color=a,m.size=s)):t===u.Move&&(m.x=c,m.y=d,m.zorder=l),o!==p.Pencil||g||t!==u.Create&&t!==u.Append||(m.type=p.RealTime),m},t.prototype.mapDrawPages=function(e,t){var r=this,i=this.getMap(e),o=i.graphicListSeqs,n=[],a=[];t.forEach((function(t){var s=r.judgeGraphicPage(e,t);delete t.oldData,t.color=G(t.color,!1),We(t,i.viewWidth,!1),Ve(t,!1);var c=!1,d=r.checkProtoGraphic(t);s.forEach((function(e){a.includes(e)||a.push(e);var r=o[e],i=je({},d);c&&t.type===p.RealTime&&t.action===u.Append&&(i.data=""),n.push({page:e,graphic_list_seq:r,draw_list:[i]}),c=!0}))}));var s=[];return a.forEach((function(e){var t={page:e,draw_list:[]};n.forEach((function(r){r.page===e&&(t.draw_list=t.draw_list.concat(r.draw_list),t.graphic_list_seq=r.graphic_list_seq)})),s.push(t)})),s},t.prototype.splitPage=function(e,t,r){var i=this.getMap(e);if(i&&t&&r){var o=1,n=0,a=0;t>=r?(n=a=r,(o=Math.ceil(t/r))>100&&(n=Math.ceil(t/99),o=100),i.innerDirection=s.Horizontal):(a=n=t,(o=Math.ceil(r/t))>100&&(a=Math.ceil(r/99),o=100),i.innerDirection=s.Vertical),i.innerPageCount=o;for(var c=0;c<o;c++)i.graphicListSeqs[c]=0,i.pullMarks[c]=!1;i.innerPageSize.cx=n,i.innerPageSize.cy=a,re.a.info(Ye("mod.split_page"),JSON.stringify({whiteboardID:e,viewWidth:t,viewHeight:r,innerPageCx:n,innerPageCy:a,innerPageCount:o}))}},t.prototype.updateMap=function(e){var t=this.getMap(e.whiteboardID);if(t){var r=e.modPropSeq;r&&Object.assign(t.modPropSeq,r),delete e.modPropSeq,Object.assign(t,e)}else this.modIdMapData[e.whiteboardID]=je({graphicListSeqs:{0:0},pullMarks:{0:!1},modSeq:0,undoList:[],redoList:[],viewWidth:0,viewHeight:0,viewportWidth:0,viewportHeight:0,innerPageCount:1,innerDirection:s.Horizontal,innerPageSize:{cx:0,cy:0},modType:1,modSubtype:1,operateTimes:0,inProgress:!1,modSendSwitch:!0,graphicSendSwitch:!0,modifyModTaskList:[],moveTaskList:[]},e)},t.prototype.getMap=function(e){return this.modIdMapData[e]},t.prototype.deleteMap=function(e){delete this.modIdMapData[e]},t.prototype.getModPropSeq=function(e){return this.modIdMapData[e].modPropSeq},t.prototype.updateMapByMod=function(e){var t=e.mod_content,r=e.mod_pos,i=this.transModInfo(t,r),o=i.modContent,n=i.modPos;this.updateMap({whiteboardID:e.mod_id,name:e.mod_title,aspectWidth:n.ar_w,aspectHeight:n.ar_h,roomID:o.room_id,fileInfo:Object.freeze(o.file_info),createTime:e.mod_create_time?+e.mod_create_time:0,horizontalPercent:e.mod_horizontal_percent,verticalPercent:e.mod_vertical_percent,pptStep:e.mod_reserve,modType:e.mod_type,modSubtype:e.mod_subtype,modSeq:e.mod_seq,modExtra:e.mod_extra,outPageCount:o.whiteboard_page_count,modPropSeq:{mod_title:e.mod_seq,mod_type:e.mod_seq,mod_subtype:e.mod_seq,mod_pos:e.mod_seq,mod_status:e.mod_seq,mod_content:e.mod_seq,mod_extra:e.mod_seq,mod_reserve:e.mod_seq,mod_delete_flag:e.mod_seq,mod_horizontal_percent:e.mod_seq,mod_vertical_percent:e.mod_seq}})},t.prototype.updateMapByModifyModOption=function(e,t,r){var i=e.mod_id,o=e.mod_title,n=e.mod_horizontal_percent,a=e.mod_vertical_percent,s=e.mod_reserve,c=e.mod_extra,d=e.is_modify_mod_horizontal_percent,l=e.is_modify_mod_vertical_percent,u=e.is_modify_mod_reserve,h=e.is_modify_mod_title,p=e.is_modify_mod_extra,f=this.getModPropSeq(i),g=f.mod_horizontal_percent,m=f.mod_vertical_percent,v=f.mod_reserve,y=f.mod_title,S=f.mod_extra,b=this.getMap(i),E={isPushScroll:!1,horizontalPercent:b.horizontalPercent,verticalPercent:b.verticalPercent,pptStep:b.pptStep};if(d&&t>g){E.isPushScroll=!0,E.horizontalPercent=+n;var C={whiteboardID:i,horizontalPercent:E.horizontalPercent,modPropSeq:{mod_horizontal_percent:t}};re.a.info(Ye("mod.update_h_percent"),JSON.stringify(C)),this.updateMap(C)}if(l&&t>m){E.isPushScroll=!0,E.verticalPercent=+a,E.pptStep=+s;var _={whiteboardID:i,verticalPercent:E.verticalPercent,pptStep:E.pptStep,modPropSeq:{mod_vertical_percent:t}};re.a.info(Ye("mod.update_v_percent"),JSON.stringify(_)),this.updateMap(_)}if(u&&t>v){E.isPushScroll=!0,E.pptStep=+s;var T={whiteboardID:i,pptStep:E.pptStep,modPropSeq:{mod_reserve:t}};re.a.info(Ye("mod.update_step"),JSON.stringify(T)),this.updateMap(T)}if(E.isPushScroll&&r&&(this.pushScrollHandle(i,E.horizontalPercent,E.verticalPercent,E.pptStep),this.updateMap({whiteboardID:i,modExtra:""})),h&&t>y){var R={whiteboardID:i,name:o,modPropSeq:{mod_title:t}};re.a.info(Ye("mod.update_name"),JSON.stringify(R)),this.updateMap(R)}if(p&&t>S){var I={whiteboardID:i,modExtra:c,modPropSeq:{mod_extra:t}};if(r){var L=this.checkH5ExtraHandle(i,c,!0);L&&this.pushExtraHandle(i,L)}re.a.info(Ye("mod.update_h5extra"),"mod_id="+i+",mod_extra="+c),this.updateMap(I)}},t.prototype.checkH5ExtraHandle=function(e,t,r){try{var i="",o=this.getH5Extra(e),n=JSON.parse(t);if(o){var a=JSON.parse(o),s=a.H5_target,c=s.s,d=s.p,l=s.e,u=n.H5_target,h=u.s,p=u.p,f=u.e;if(h===c&&p===d)if(r)if(f.length<l.length)i=t;else if(f.length>l.length)n.H5_target.e=f.slice(l.length),i=JSON.stringify(n);else{var g=[];f.forEach((function(e,t){l.findIndex((function(t){return e.id===t.id}))!==t&&g.push(e)}));var m=f[f.length-1];i=g.length?(n.H5_target.e=g,JSON.stringify(n)):m.s?(n.H5_target.e=[m],JSON.stringify(n)):""}else{var v=l.findIndex((function(e){return e.s&&f[0].id===e.id}));-1!==v&&l.splice(v,1),a.H5_target.e=l.concat(f),i=JSON.stringify(a)}else i=t}else i=t;return i}catch(e){return""}},t.prototype.updateMapByGraphicListSeqs=function(e,t){var r=this.getMap(e).graphicListSeqs,i=t.graphicListSeqs;t.pages.forEach((function(e,t){r[e]=i[t]}))},t.prototype.setModSendSwitch=function(e,t){this.modIdMapData[e].modSendSwitch=t},t.prototype.getModSendSwitch=function(e){var t=this.modIdMapData[e];return!t||t.modSendSwitch},t.prototype.clearPullMarks=function(e){var t=this;re.a.info(Ye("mod.clear_pull_mark"),"init pull mark");var r=e?[e]:Object.keys(this.modIdMapData);Object.values(r).forEach((function(e){var r=t.modIdMapData[e];Object.keys(r.pullMarks).forEach((function(e){r.pullMarks[+e]=!1}))}))},t.prototype.updateModifyModTaskList=function(e){re.a.info(Ye("mod.modify_task_update"),JSON.stringify(e));var t=e.data.mod_id,r=this.getMap(t),i=e.status,o=e.push;if(i===fe.InProgress)r.modifyModTaskList.splice(0,r.modifyModTaskList.length,e);else if(o)r.modifyModTaskList.push(e);else{var n=r.modifyModTaskList.findIndex((function(e){return e.push===o&&e.status===fe.Pending}));-1===n?r.modifyModTaskList.push(e):Object.assign(r.modifyModTaskList[n].data,e.data)}},t.prototype.modifyModSendBefore=function(e){var t=e.mod_id,r=this.getModSendSwitch(t);this.setModSendSwitch(t,!1);var i={data:e,push:!1,status:r?fe.InProgress:fe.Pending};return this.updateModifyModTaskList(i),r},t.prototype.cachePushModifyModTaskHandle=function(e){var t=this;re.a.info(Ye("mod.remote_modify_cache_handle"),JSON.stringify(e)),e.forEach((function(e){var r=e.pushModSeq,i=e.data,o=i.mod_id;r>t.getMap(o).modSeq&&(re.a.info(Ye("mod.update_seq"),JSON.stringify({whiteboardID:o,modSeq:r})),t.updateMap({modSeq:r,whiteboardID:o})),t.updateMapByModifyModOption(i,r,!0)}))},t.prototype.modifyModRspAfter=function(e,t){var r=t.modifyModOption,i=t.success,o=t.error,n=t.errorData,a=r.mod_id,s=this.getMap(a).modifyModTaskList,c=s.filter((function(e){return!e.push&&e.status===fe.Pending}))[0];if(this.cachePushModifyModTaskHandle(s.filter((function(e){return e.push}))),c)re.a.info(Ye("mod.local_modify_cache_handle"),JSON.stringify(c)),this.setModSendSwitch(a,!0),this.setMod(c.data,i,o);else if(this.setModSendSwitch(a,!0),1===e)re.a.info(Ye("mod.modify_cb"),JSON.stringify({whiteboardID:a})),i(a);else{var d=this.getOldModInfoByModifyModOption(r);re.a.error(Ye("mod.modify_cb"),JSON.stringify({errorData:n,backModInfo:d})),o(n,d)}},t.prototype.getOldModInfoByModifyModOption=function(e){var t={};return Object.keys(e).forEach((function(r){r.includes("mod_id")||r.includes("is_modify_mod")||(t[r]=e[r])})),t},t.prototype.checkScroll=function(e,t,r,i){var o=this.getMap(e);if(o){var n=o.horizontalPercent,a=o.verticalPercent,s=o.pptStep,c=!1,d={mod_id:e};return t!==n&&(d.mod_horizontal_percent=t,d.is_modify_mod_horizontal_percent=!0,c=d),r===a&&i===s||(d.mod_vertical_percent=r,d.is_modify_mod_vertical_percent=!0,d.mod_reserve=i,d.is_modify_mod_reserve=!0,c=d),c}return!1},t.prototype.updateRemoteImageGraphicData=function(e){e.forEach((function(e){var t=e.type,r=e.action,i=e.x,o=e.y;if(t===p.Image&&(r===u.Update||r===u.Create)){var n=e.data,a=n.x,s=n.y,c=n.ex,d=n.ey;n.x=a-i,n.y=s-o,n.ex=c-i,n.ey=d-o}}))},t.prototype.checkSendLengthHandle=function(e){var t=JSON.stringify(JSON.stringify(JSON.stringify(e))).length;if(t>4700){var r=C(i.ZegoWhiteboardViewErrorGraphicDataLimit);return r.length=t,re.a.error(Ye("gra.draw_cb"),JSON.stringify(r)),this.actionCustomListener("error",r),!1}return!0},t.prototype.getPageGraphicsList=function(e,t,r){var i=this;if(re.a.info(Ye("gra.get_list"),JSON.stringify({whiteboardID:e,pages:t,graphicListSeqs:r})),!r){var o=this.getMap(e).graphicListSeqs;r=t.map((function(e){return o[e]}))}this.queueWSCmdHandler("/eduv1/get_page_graphics","/eduv1/get_page_graphics",{header:this.getModHeader(),body:JSON.stringify({mod_id:e,pages:t,graphic_list_seqs:r,limit:this.graphicLimit})},(function(t){i.handleGetPageGraphicsListRsp(e,t)}))},t.prototype.setGraphicMap=function(e){var t=this;e.forEach((function(e){var r=e.graphic_id,i=e.is_end_draw,o=e.server_timestamp,n=e.operate_id,a=e.type;t.graphicMap[r]={is_end_draw:!n||i,server_timestamp:o,operate_id:n,type:a}}))},t.prototype.clearGraphicMap=function(){this.graphicMap={}},t.prototype.setMod=function(e,t,r){var i=this,o=e.mod_id;this.modifyModSendBefore(e)&&this.queueWSCmdHandler("/eduv1/modify_mod","/eduv1/modify_mod",{header:this.getModHeader(),body:JSON.stringify(je({mod_seq:this.getMap(o).modSeq},e))},(function(o){i.handleSetModRsp(e,o,t,r)}))},t.prototype.getGraphicTimeout=function(e){try{var t=this.stateCenter.serverTimeOffset;return 1e3*Number(this.graphicMap[e].server_timestamp)-t}catch(e){return 0}},t.prototype.getGraphicIsEndDraw=function(e){try{return!!(this.graphicMap[e].is_end_draw||(new Date).getTime()<this.getGraphicTimeout(e))}catch(e){return!0}},t.prototype.updateToRemoteHandle=function(e,t,r,o){var n=this;t=JSON.parse(JSON.stringify(t)),this.updateRemoteImageGraphicData(t);var a=this.mapDrawPages(e,t);if(a.length)if(this.checkSendLengthHandle(a)){re.a.info(Ye("gra.draw"),JSON.stringify(a));var s={header:this.getModHeader(),body:JSON.stringify({mod_id:e,draw_pages:a})};this.queueWSCmdHandler("/eduv1/draw_page_graphics","/eduv1/draw_page_graphics",s,(function(i){n.handleUpdateToRemoteRsp(e,t,i,r,o)}))}else o(C(i.ZegoWhiteboardViewErrorGraphicNumLimit))},t.prototype.actionListener=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.listenerList[e]&&(t=this.listenerList)[e].apply(t,r)},t.prototype.bindListener=function(e,t){this.listenerList[e]=t},t.prototype.getModName=function(e){var t=this.getMap(e);return t?t.name:""},t.prototype.getUserName=function(){return this.stateCenter.idName},t.prototype.getCreateTime=function(e){var t=this.getMap(e);return t?t.createTime:0},t.prototype.getRoomID=function(e){var t=this.getMap(e);return t?t.roomID:""},t.prototype.getPageCount=function(e){var t=this.getMap(e);return t?t.outPageCount:1},t.prototype.setSize=function(e,t,r){var i=this.getMap(e);return!!(i&&t&&r)&&(i.viewHeight=r,i.viewWidth=t,re.a.info(Ye("mod.set_view_size"),JSON.stringify({whiteboardID:e,viewWidth:t,viewHeight:r})),this.splitPage(e,t,r),!0)},t.prototype.setViewportSize=function(e,t,r){var i=this.getMap(e);return!!(i&&t&&r)&&(re.a.info(Ye("mod.set_viewpoart_size"),JSON.stringify({whiteboardID:e,viewportWidth:t,viewportHeight:r})),i.viewportHeight=r,i.viewportWidth=t,!0)},t.prototype.undo=function(e){},t.prototype.redo=function(e){},t.prototype.createMod=function(e,t,r){var i=this,o=this.createModInfo(e),n=o.modContent,a=o.modPos,s={mod_id:x(),mod_title:e.name,mod_subtype:1,mod_type:1,mod_delete_flag:0,mod_content:JSON.stringify(n),mod_horizontal_percent:0,mod_vertical_percent:0,mod_reserve:1,mod_pos:JSON.stringify(a)};re.a.info(Ye("mod.create"),JSON.stringify({params:s})),this.queueWSCmdHandler("/eduv1/create_mod","/eduv1/create_mod",{header:this.getModHeader(),body:JSON.stringify(s)},(function(e){return i.handleCreateModRsp(e,t,r)}))},t.prototype.destroyMod=function(e,t,r){var i=this;this.queueWSCmdHandler("/eduv1/destroy_mod","/eduv1/destroy_mod",{header:this.getModHeader(),body:JSON.stringify({mod_id:e})},(function(e){i.handleDestroyModRsp(e,t,r)}))},t.prototype.clearView=function(e,t,r){var i=this;this.queueWSCmdHandler("/eduv1/clear_page_graphics","/eduv1/clear_page_graphics",{header:this.getModHeader(),body:JSON.stringify({mod_id:e})},(function(o){i.handleClearRsp(o,e,t,r)}))},t.prototype.getModList=function(e,t,r){var i=this;this.queueWSCmdHandler("/eduv1/get_mod_list","/eduv1/get_mod_list",{header:this.getModHeader(),body:JSON.stringify({mod_list_seq:0,limit:this.modLimit,marker:"",mod_type:1})},(function(o){i.handleGetModListRsp(e,o,t,r)}))},t.prototype.scroll=function(e,t,r,i){var o=this,n=this.checkScroll(e,t,r,i);n&&(re.a.info(Ye("mod.scroll"),JSON.stringify(n)),this.setMod(n,(function(e){o.updateMap({whiteboardID:e,modExtra:""}),o.actionListener("scroll",{code:0,whiteboardID:e})}),(function(t){return o.actionListener("scroll",je(je({},t),{whiteboardID:e}))})))},t.prototype.reload=function(){re.a.info(Ye("reload"),"reload whiteboard"),this.clearPullMarks(),this.getModList(pe.Inner)},t.prototype.loadCurrentGraphics=function(e,t,r){for(var i=this.getMap(e),o=i.innerPageCount-1,n=[],a=0;a<=o;a++){!i.pullMarks[a]&&n.push(a)}re.a.info(Ye("gra.load_by_percent"),JSON.stringify({horizontalPercent:t,verticalPercent:r,minPage:0,maxPage:o,pageNumList:n})),n.length&&this.getPageGraphicsList(e,n)},t.prototype.getScrollPercent=function(e){var t=this.getMap(e);return{horizontalPercent:t.horizontalPercent,verticalPercent:t.verticalPercent,pptStep:t.pptStep}},t.prototype.getAspectRatio=function(e){var t=this.getMap(e);return t.aspectWidth+":"+t.aspectHeight},t.prototype.getFileInfo=function(e){var t=this.getMap(e);return t&&t.fileInfo||null},t.prototype.getCurrentPages=function(e,t,r){var i,o,n=this.getMap(e),a=n.viewWidth,c=n.viewHeight,d=n.innerPageSize,l=n.viewportWidth,u=n.viewportHeight;return n.innerDirection===s.Horizontal?(i=Math.floor(a*t/d.cx),o=Math.floor((l+a*t)/d.cx)):(i=Math.floor(c*r/d.cy),o=Math.floor((u+c*r)/d.cy)),{minPage:i,maxPage:o=o>99?99:o>=n.innerPageCount?n.innerPageCount-1:o}},t.prototype.updateCache=function(e){this.updateMap(e)},t.prototype.uploadImage=function(e,t){if(!this.docsService.isConfiged()){var r=re.a.getConfig(),i=r.appid,o=r.userid,n=r.token,a=r.isTestEnv;this.docsService.setConfig({appID:i,userID:o,token:n,isTestEnv:a})}return this.docsService.uploadImage(e,t)},t.prototype.createZorder=function(){return this.zorderSeq+=this.zorderStep},t.prototype.onRemotePush=function(){var e=this;this.queueWSCmdHandler(null,"biz_channel",null,(function(t,r){switch(r){case me.DrawPageGraphics:e.pushDrawPageGraphicsHandle(t);break;case me.SetMod:e.pushSetModHandle(t);break;case me.ClearPageGraphics:e.pushClearPageGraphicsHandle(t)}}))},t.prototype.sendWbMessage=function(e,t,r,i){t&&"string"==typeof t&&(e||this.socketCenter.registerRouter("push_biz_channel",(function(e){var t=e.body.req_body;try{var r=JSON.parse(t).msg_body,o=JSON.parse(r),n=me.ClearPageGraphics;o.page_graphics?n=me.DrawPageGraphics:o.action_list&&(n=me.SetMod),i(o,n)}catch(e){i({},0)}})),e&&r&&"string"==typeof e&&this.socketCenter.sendMessage("biz_channel",r,(function(e,t,r){try{(r=JSON.parse(r)).body=r.body?JSON.parse(r.body):{},i(r)}catch(e){}}),(function(e,t,r,o){try{if("[object Object]"===Object.prototype.toString.call(e))i({header:{code:e.code,message:e.msg,headerSeq:t}});else{var n=JSON.parse(r).header,a=n.code,s=n.message;i({header:{code:a,message:s,headerSeq:t}})}}catch(e){i({header:{code:3000001,message:"内部错误",headerSeq:t}})}})))},t.prototype.queueWSCmdHandler=function(e,t,r,i){var o=this;return new Promise((function(n,a){try{var s={channel:"edu",cmd:e,req_body:JSON.stringify(r)};o.sendWbMessage(e,t,s,(function(e,t){n(e,t),i&&i(e,t)}))}catch(e){a(e)}}))},t.prototype.getH5Extra=function(e){var t=this.getMap(e),r=t?t.modExtra:"";return re.a.info(Ye("mod.get_h5extra"),JSON.stringify({whiteboardID:e,modExtra:r})),r},t.prototype.appendH5Extra=function(e,t){var r=this;if(t){var i=this.checkH5ExtraHandle(e,t,!1),o={mod_id:e,mod_extra:i,is_modify_mod_extra:!0};re.a.info(Ye("mod.append_h5extra"),"mod_id="+e+",mod_extra="+i),this.setMod(o,(function(e){return r.actionListener("appendH5ExtraCallback",{code:0,whiteboardID:e,result:i})}),(function(i){1112===i.code?(re.a.info(Ye("mod.append_h5extra_retry"),"mod_id="+e),r.appendH5Extra(e,t)):r.actionListener("appendH5ExtraCallback",je(je({},i),{whiteboardID:e}))}))}else this.actionListener("appendH5ExtraCallback",{code:10001001,msg:"参数错误",whiteboardID:e})},t.prototype.handleCreateModRsp=function(e,t,r){return Ze(this,void 0,void 0,(function(){var i,o,n,a,s,c,d,l,u;return Je(this,(function(h){switch(h.label){case 0:return i=e.header,o=e.body,n=i.code,a=i.message,0!==n?[3,2]:(s=o.mod_list_seq,c=o.mod_id,this.modListSeq=s,re.a.info(Ye("mod.update_seq"),JSON.stringify({modListSeq:s,actionMsg:"create cb success"})),[4,this.getModInfo([c])]);case 1:return d=h.sent(),l=d[0],this.updateMapByMod(l),t(l.mod_id),[3,3];case 2:u=C(n,a),re.a.error(Ye("mod.create_cb"),JSON.stringify(u)),r(u),h.label=3;case 3:return[2]}}))}))},t.prototype.handleGetModInfoRsp=function(e,t,r){var i=e.header,o=e.body,n=i.code,a=i.message;if(0===n){var s=o.mod_list;re.a.info(Ye("mod.get_info_cb"),"success"),t(s)}else{var c=C(n,a);re.a.error(Ye("mod.get_info_cb"),JSON.stringify(c)),r(c)}},t.prototype.handleSetModRsp=function(e,t,r,i){var o=t.header,n=t.body,a=o.code,s=o.message;if(0===a){var c=n.mod_list_seq,d=n.mod_seq,l=n.mod_id;this.modListSeq=c,re.a.info(Ye("mod.update_seq"),JSON.stringify({whiteboardID:l,modListSeq:c,modSeq:d})),this.updateMap({whiteboardID:l,modSeq:d}),this.updateMapByModifyModOption(e,d,!1),this.modifyModRspAfter(ge.success,{modifyModOption:e,success:r,error:i})}else this.modifyModRspAfter(ge.error,{modifyModOption:e,success:r,error:i,errorData:C(a,s)})},t.prototype.handleDestroyModRsp=function(e,t,r){var i=e.header,o=e.body,n=i.code,a=i.message;if(0===n){var s=o.mod_list_seq,c=o.mod_id;this.modListSeq=s,re.a.info(Ye("mod.update_seq"),JSON.stringify({modListSeq:s,actionMsg:"destroy cb success"})),this.deleteMap(c),t(c)}else{var d=C(n,a);re.a.error(Ye("mod.destroy_cb"),JSON.stringify(d)),r(d)}},t.prototype.handleClearRsp=function(e,t,r,i){var o=e.header,n=e.body,a=o.code,s=o.message;if(0===a){r();var c={pages:n.pages||[],graphicListSeqs:n.graphic_list_seqs||[]};re.a.info(Ye("gra.update_seq"),JSON.stringify(je(je({whiteboardID:t},c),{actionMsg:"clear cb success"}))),this.updateMapByGraphicListSeqs(n.mod_id,c),this.updateMap({whiteboardID:n.mod_id,undoList:[],redoList:[],operateTimes:0}),this.clearGraphicMap()}else{var d=this.getMap(t);if(d&&++d.operateTimes<5)this.clearView(t,r,i);else{var l=C(a,s);re.a.error(Ye("mod.clear_cb"),JSON.stringify(l)),i(l)}}},t.prototype.compareHandle=function(e,t){var r=this;re.a.info(Ye("mod.compare"),"compare local with server");var i=Object.keys(this.modIdMapData),o=[];return t.sort((function(e,t){return t.mod_create_time-e.mod_create_time})),t.forEach((function(t){var n=t.mod_id,a=t.mod_horizontal_percent,s=t.mod_vertical_percent,c=t.mod_reserve;if(o.push(n),-1===i.indexOf(n))e===pe.Inner?r.pushAddMod(t):r.updateMapByMod(t);else{var d=r.getMap(n),l=d.horizontalPercent,u=d.verticalPercent,h=d.pptStep;r.updateMapByMod(t),l===a&&u===s&&c===h||r.pushScrollHandle(n,a,s,c)}})),i.forEach((function(i){-1===t.findIndex((function(e){return e.mod_id===i}))&&(e===pe.Inner?r.pushRemovedMod(i):r.deleteMap(i))})),o},t.prototype.handleGetModListRsp=function(e,t,r,i){var o=t.header,n=t.body,a=o.code,s=o.message;if(0===a){var c=n.mod_list_seq,d=n.mod_list;this.modListSeq=c,re.a.info(Ye("mod.update_seq"),JSON.stringify({modListSeq:c,actionMsg:"get list cb success"}));var l=this.compareHandle(e,d||[]);e===pe.Initiative&&r&&r(l)}else{var u=C(a,s);re.a.error(Ye("mod.get_list_cb"),JSON.stringify(u)),i&&i(u)}},t.prototype.handleGetPageGraphicsListRsp=function(e,t){var r=this,i=t.header,o=t.body,n=i.code,a=i.message;if(0===n){var s=o.pages,c=this.getMap(e);if(!c||!c.viewWidth||!c.viewHeight)return;re.a.info(Ye("gra.get_list_cb"),"success");var d=[],l=[],u=[],h=[],p=[],f=[];s.forEach((function(t){var i=t.graphic_list,o=t.del_graphic_id_list,n=t.page,a=t.ret_graphic_list_seq,s=t.svr_graphic_list_seq;i=i||[],o=o||[],u.push(n),h.push(s),i.forEach((function(e){e.zorder>r.zorderSeq&&(r.zorderSeq=e.zorder),Ve(e,!0),We(e,c.viewWidth,!0),e.color=G(e.color,!0)})),r.setGraphicMap(i),s!==a&&0!==a?(d.push(n),l.push(a)):r.getMap(e).pullMarks[n]=!0,p=p.concat(i),f=f.concat(o)})),this.actionListener("getPageGraphicsList",e,p,f),re.a.info(Ye("gra.update_seq"),JSON.stringify({whiteboardID:e,pages:u,graphicListSeqs:h,actionMsg:"get list cb success"})),this.updateMapByGraphicListSeqs(e,{pages:u,graphicListSeqs:h}),d.length&&(re.a.info(Ye("gra.get_list_cb"),"increment get"),this.getPageGraphicsList(e,d,l))}else re.a.error(Ye("gra.get_list_cb"),JSON.stringify({code:n,msg:a}))},t.prototype.handleUpdateToRemoteRsp=function(e,t,r,i,o){var n=r.header,a=r.body,s=n.code,c=n.message;if(0===s){var d={pages:a.pages,graphicListSeqs:a.graphic_list_seqs};re.a.info(Ye("gra.update_seq"),JSON.stringify(je(je({whiteboardID:e},d),{actionMsg:"draw cb success"}))),this.updateMapByGraphicListSeqs(a.mod_id,d),i(),this.setGraphicMap(t)}else{var l=C(s,c);re.a.error(Ye("gra.draw_cb"),JSON.stringify(l)),o(l)}},t.prototype.pushDrawPageGraphicsHandle=function(e){var t=this,r=e.page_graphics,i=e.mod_id,o=this.getMap(i);if(o&&o.viewWidth&&o.viewHeight){re.a.info(Ye("gra.remote_draw"),JSON.stringify({drawPages:r}));var n=[],a=[],s=[];r.forEach((function(e){var r=e.del_graphic_id_list,i=e.graphic_list,c=e.action_seq,d=e.page;(!o.graphicListSeqs[d]||c>o.graphicListSeqs[d])&&(i&&i.length?(i.forEach((function(e){e.zorder>t.zorderSeq&&(t.zorderSeq=e.zorder),Ve(e,!0),We(e,o.viewWidth,!0),e.color=G(e.color,!0)})),t.setGraphicMap(i)):e.graphic_list=[],e.del_graphic_id_list=r||[],s.push(e),n.push(d),a.push(c))})),re.a.info(Ye("gra.update_seq"),JSON.stringify({whiteboardID:i,pages:n,graphicListSeqs:a,actionMsg:"remote draw"})),this.updateMapByGraphicListSeqs(i,{pages:n,graphicListSeqs:a}),this.actionListener("pushDrawPageGraphics",i,s)}},t.prototype.pushClearPageGraphicsHandle=function(e){var t=e.action_seqs,r=e.pages,i=e.mod_id,o=this.getMap(i);if(o&&o.viewWidth&&o.viewHeight){var n={pages:r,graphicListSeqs:t};re.a.info(Ye("gra.update_seq"),JSON.stringify(je(je({whiteboardID:i},n),{actionMsg:"remote clear"}))),this.updateMapByGraphicListSeqs(i,n),this.actionListener("pushClearPageGraphics",i),this.updateMap({whiteboardID:i,undoList:[],redoList:[],operateTimes:0})}},t.prototype.pushAddMod=function(e){var t=e.mod_id;re.a.info(Ye("mod.update_map"),JSON.stringify({whiteboardID:t,actionMsg:"remote add"})),this.updateMapByMod(e),this.actionListener("pushAddMod",t)},t.prototype.pushRemovedMod=function(e){this.deleteMap(e),this.actionListener("pushRemovedMod",e)},t.prototype.pushModifyMod=function(e){var t=e.mod_id,r=e.mod_seq,i=e.mod_title,o=e.mod_horizontal_percent,n=e.mod_vertical_percent,a=e.mod_reserve,s=e.mod_extra,c=e.is_modify_mod_vertical_percent,d=e.is_modify_mod_horizontal_percent,l=e.is_modify_mod_reserve,u=e.is_modify_mod_title,h=e.is_modify_mod_extra,p=this.getMap(t);if(p)if(this.getModSendSwitch(t)){if(re.a.info(Ye("mod.remote_modify"),"immediate update"),r>p.modSeq){var f={whiteboardID:t,modSeq:r};re.a.info(Ye("mod.update_map"),JSON.stringify(f)),this.updateMap(f)}this.updateMapByModifyModOption(e,r,!0)}else{re.a.info(Ye("mod.remote_modify"),"cache");var g={mod_id:t};u&&Object.assign(g,{mod_title:i,is_modify_mod_title:u}),h&&Object.assign(g,{mod_extra:s,is_modify_mod_extra:h}),d&&Object.assign(g,{mod_horizontal_percent:o,is_modify_mod_horizontal_percent:d}),c&&Object.assign(g,{mod_vertical_percent:n,is_modify_mod_vertical_percent:c,mod_reserve:a,is_modify_mod_reserve:l}),l&&Object.assign(g,{mod_reserve:a,is_modify_mod_reserve:l}),this.updateModifyModTaskList({status:fe.Pending,data:g,push:!0,pushModSeq:r})}},t.prototype.pushExtraHandle=function(e,t){this.actionListener("h5ExtraAppendedNotify",e,t)},t.prototype.pushScrollHandle=function(e,t,r,i){re.a.info(Ye("mod.remote_scroll"),JSON.stringify({whiteboardID:e,horizontalPercent:t,verticalPercent:r,step:i})),t=+t,r=+r,this.actionListener("pushScroll",e,t,r,i)},t.prototype.pushSetModHandle=function(e){var t=e.mod_list_seq,r=e.action_list;if(this.modListSeq=this.modListSeq||0,t>=this.modListSeq){this.modListSeq=t;var i=r[0],o=i.action;o===ve.Removed?this.pushRemovedMod(i.mod_id):o===ve.Add?this.pushAddMod(i):o===ve.Modify&&this.pushModifyMod(i)}else re.a.warn(Ye("mod.remote_push"),JSON.stringify({localModListSeq:this.modListSeq,remoteModListSeq:t,msg:"throw away"}))},t}(Ie),Qe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ke=re.b.bind(null,"wb.m."),$e=function(e){function t(t,r,i){var o=this,n=new Re,a=new Xe({stateCenter:r.stateCenter,socketCenter:r.socketCenter,whiteboardStore:n});return o=e.call(this,a,n)||this,re.a.init({appid:t,isTestEnv:i,version:o.getVersion(),isProd:!0}),o.zegoWebRTC=r,o.onRemotePush=a.onRemotePush.bind(a),o.onRoomStateUpdate=function(e,t){"CONNECTED"===t&&a.reload()}.bind(o),o}return Qe(t,e),t.prototype.loginRoom=function(e,t,r,i){var o=this;return re.a.initRoom({roomid:e,userid:r&&r.userID||"",token:t}),this.zegoWebRTC.setSdkLoginRelateService(["edusvr"]),this.zegoWebRTC.loginRoom(e,t,r,i).then((function(n){o.zegoWebRTC.bindListener("roomStateUpdate",o.onRoomStateUpdate),o.onRemotePush();var a={params:{roomID:e,token:t,user:r,config:i},result:n};return re.a.info(Ke("login"),JSON.stringify(a)),n}))},t.prototype.logoutRoom=function(e){this.zegoWebRTC.logoutRoom(e),re.a.info(Ke("logout"),e)},t.prototype.getVersion=function(){return"1.18.0"},t}(Te);function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var tt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),rt=function(e){function t(t,r){var i=e.call(this,t,r)||this;r="object"===et(r)&&r[0]||r;var o=!/webliveroom\d+/.test(r);return i.zegoWhiteboard=new $e(t,i.zegoWebRTC,o),i}return tt(t,e),t.prototype.loginRoom=function(e,t,r,i){return this.zegoWhiteboard.loginRoom(e,t,r,i)},t.prototype.logoutRoom=function(e){this.zegoWhiteboard.logoutRoom(e)},t.prototype.clear=function(){return this.zegoWhiteboard.clear()},t.prototype.createView=function(e){return this.zegoWhiteboard.createView(e)},t.prototype.destroyView=function(e){return this.zegoWhiteboard.destroyView(e)},t.prototype.attachView=function(e,t){return this.zegoWhiteboard.attachView(e,t)},t.prototype.getViewList=function(){return this.zegoWhiteboard.getViewList()},t.prototype.on=function(t,r){return["error","viewAdd","viewRemoved","viewScroll"].includes(t)?this.zegoWhiteboard.on(t,r):e.prototype.on.call(this,t,r)},t.prototype.off=function(t,r){return["error","viewAdd","viewRemoved","viewScroll"].includes(t)?this.zegoWhiteboard.off(t,r):e.prototype.off.call(this,t)},t.prototype.getVersion=function(){return this.zegoWhiteboard.getVersion()},t.prototype.setDeferredRenderingTime=function(e){return this.zegoWhiteboard.setDeferredRenderingTime(e)},t}(c.ZegoExpressEngine)}])}));